<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Advanced routing</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css">
  </head>
  <body>
    <section id="advanced-routing" class="level1">
      <h1>Advanced routing</h1>
      <section id="rest-parameters" class="level2">
        <h2>Rest parameters</h2>
        <p>If the number of route segments is unknown, you can use rest syntax — for example you might implement GitHub's file viewer like so...</p>
        <pre class="language-bash"><code class="language-bash">/<span class="token punctuation">[</span>org<span class="token punctuation">]</span>/<span class="token punctuation">[</span>repo<span class="token punctuation">]</span>/tree/<span class="token punctuation">[</span>branch<span class="token punctuation">]</span>/<span class="token punctuation">[</span><span class="token punctuation">..</span>.file<span class="token punctuation">]</span></code></pre>
        <p>...in which case a request for <code>/sveltejs/kit/tree/master/documentation/docs/04-advanced-routing.md</code> would result in the following parameters being available to the page:</p>
        <pre class="language-js"><code class="language-js"><span class="token comment">// @noErrors</span>
<span class="token punctuation">{</span>
	<span class="token literal-property property">org</span><span class="token operator">:</span> <span class="token string">'sveltejs'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">repo</span><span class="token operator">:</span> <span class="token string">'kit'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">branch</span><span class="token operator">:</span> <span class="token string">'master'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">'documentation/docs/04-advanced-routing.md'</span>
<span class="token punctuation">}</span></code></pre>
        <blockquote>
          <p><code>src/routes/a/[...rest]/z/+page.svelte</code> will match <code>/a/z</code> (i.e. there's no parameter at all) as well as <code>/a/b/z</code> and <code>/a/b/c/z</code> and so on. Make sure you check that the value of the rest parameter is valid, for example using a <a href="#matching">matcher</a>.</p>
        </blockquote>
        <section id="404-pages" class="level3">
          <h3>404 pages</h3>
          <p>Rest parameters also allow you to render custom 404s. Given these routes...</p>
          <pre class="language-text"><code class="language-text">src/routes/
├ marx-brothers/
│ ├ chico/
│ ├ harpo/
│ ├ groucho/
│ └ +error.svelte
└ +error.svelte</code></pre>
          <p>...the <code>marx-brothers/+error.svelte</code> file will <em>not</em> be rendered if you visit <code>/marx-brothers/karl</code>, because no route was matched. If you want to render the nested error page, you should create a route that matches any <code>/marx-brothers/*</code> request, and return a 404 from it:</p>
          <pre class="language-diff"><code class="language-diff">src/routes/
├ marx-brothers/
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">| ├ [...path]/
</span></span>│ ├ chico/
│ ├ harpo/
│ ├ groucho/
│ └ +error.svelte
└ +error.svelte</code></pre>
          <pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/marx-brothers/[...path]/+page.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> error <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/kit'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">throw</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">'Not Found'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
          <blockquote>
            <p>If you don't handle 404 cases, they will appear in <a href="../30-advanced/20-hooks.html#shared-hooks-handleerror"><code>handleError</code></a></p>
          </blockquote>
        </section>
      </section>
      <section id="optional-parameters" class="level2">
        <h2>Optional parameters</h2>
        <p>A route like <code>[lang]/home</code> contains a parameter named <code>lang</code> which is required. Sometimes it's beneficial to make these parameters optional, so that in this example both <code>home</code> and <code>en/home</code> point to the same page. You can do that by wrapping the parameter in another bracket pair: <code>[[lang]]/home</code></p>
        <p>Note that an optional route parameter cannot follow a rest parameter (<code>[...rest]/[[optional]]</code>), since parameters are matched 'greedily' and the optional parameter would always be unused.</p>
      </section>
      <section id="matching" class="level2">
        <h2>Matching</h2>
        <p>A route like <code>src/routes/archive/[page]</code> would match <code>/archive/3</code>, but it would also match <code>/archive/potato</code>. We don't want that. You can ensure that route parameters are well-formed by adding a <em>matcher</em> — which takes the parameter string (<code>"3"</code> or <code>"potato"</code>) and returns <code>true</code> if it is valid — to your <a href="../50-api-reference/10-configuration.html#files"><code>params</code></a> directory...</p>
        <pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/params/integer.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'@sveltejs/kit'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ParamMatcher<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\d+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token method function property-access">test</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
        <p>...and augmenting your routes:</p>
        <pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">src/routes/archive/[page]
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">src/routes/archive/[page=integer]</span></span></code></pre>
        <p>If the pathname doesn't match, SvelteKit will try to match other routes (using the sort order specified below), before eventually returning a 404.</p>
        <blockquote>
          <p>Matchers run both on the server and in the browser.</p>
        </blockquote>
      </section>
      <section id="sorting" class="level2">
        <h2>Sorting</h2>
        <p>It's possible for multiple routes to match a given path. For example each of these routes would match <code>/foo-abc</code>:</p>
        <pre class="language-bash"><code class="language-bash">src/routes/<span class="token punctuation">[</span><span class="token punctuation">..</span>.catchall<span class="token punctuation">]</span>/+page.svelte
src/routes/<span class="token punctuation">[</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">]</span>/foo/+page.svelte
src/routes/<span class="token punctuation">[</span>b<span class="token punctuation">]</span>/+page.svelte
src/routes/foo-<span class="token punctuation">[</span>c<span class="token punctuation">]</span>/+page.svelte
src/routes/foo-abc/+page.svelte</code></pre>
        <p>SvelteKit needs to know which route is being requested. To do so, it sorts them according to the following rules...</p>
        <ul>
          <li>More specific routes are higher priority (e.g. a route with no parameters is more specific than a route with one dynamic parameter, and so on)</li>
          <li>Parameters with <a href="#matching">matchers</a> (<code>[name=type]</code>) are higher priority than those without (<code>[name]</code>)</li>
          <li><code>[[optional]]</code> and <code>[...rest]</code> parameters are ignored unless they are the final part of the route, in which case they are treated with lowest priority. In other words <code>x/[[y]]/z</code> is treated equivalently to <code>x/z</code> for the purposes of sorting</li>
          <li>Ties are resolved alphabetically</li>
        </ul>
        <p>...resulting in this ordering, meaning that <code>/foo-abc</code> will invoke <code>src/routes/foo-abc/+page.svelte</code>, and <code>/foo-def</code> will invoke <code>src/routes/foo-[c]/+page.svelte</code> rather than less specific routes:</p>
        <pre class="language-bash"><code class="language-bash">src/routes/foo-abc/+page.svelte
src/routes/foo-<span class="token punctuation">[</span>c<span class="token punctuation">]</span>/+page.svelte
src/routes/<span class="token punctuation">[</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">]</span>/foo/+page.svelte
src/routes/<span class="token punctuation">[</span>b<span class="token punctuation">]</span>/+page.svelte
src/routes/<span class="token punctuation">[</span><span class="token punctuation">..</span>.catchall<span class="token punctuation">]</span>/+page.svelte</code></pre>
      </section>
      <section id="encoding" class="level2">
        <h2>Encoding</h2>
        <p>Some characters can't be used on the filesystem — <code>/</code> on Linux and Mac, <code>\ / : * ? " &#x3C; > |</code> on Windows. The <code>#</code> and <code>%</code> characters have special meaning in URLs, and the <code>[ ] ( )</code> characters have special meaning to SvelteKit, so these also can't be used directly as part of your route.</p>
        <p>To use these characters in your routes, you can use hexadecimal escape sequences, which have the format <code>[x+nn]</code> where <code>nn</code> is a hexadecimal character code:</p>
        <ul>
          <li><code>\</code> — <code>[x+5c]</code></li>
          <li><code>/</code> — <code>[x+2f]</code></li>
          <li><code>:</code> — <code>[x+3a]</code></li>
          <li><code>*</code> — <code>[x+2a]</code></li>
          <li><code>?</code> — <code>[x+3f]</code></li>
          <li><code>"</code> — <code>[x+22]</code></li>
          <li><code>&#x3C;</code> — <code>[x+3c]</code></li>
          <li><code>></code> — <code>[x+3e]</code></li>
          <li><code>|</code> — <code>[x+7c]</code></li>
          <li><code>#</code> — <code>[x+23]</code></li>
          <li><code>%</code> — <code>[x+25]</code></li>
          <li><code>[</code> — <code>[x+5b]</code></li>
          <li><code>]</code> — <code>[x+5d]</code></li>
          <li><code>(</code> — <code>[x+28]</code></li>
          <li><code>)</code> — <code>[x+29]</code></li>
        </ul>
        <p>For example, to create a <code>/smileys/:-)</code> route, you would create a <code>src/routes/smileys/[x+3a]-[x+29]/+page.svelte</code> file.</p>
        <p>You can determine the hexadecimal code for a character with JavaScript:</p>
        <pre class="language-js"><code class="language-js"><span class="token string">':'</span><span class="token punctuation">.</span><span class="token method function property-access">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '3a', hence '[x+3a]'</span></code></pre>
        <p>You can also use Unicode escape sequences. Generally you won't need to as you can use the unencoded character directly, but if — for some reason — you can't have a filename with an emoji in it, for example, then you can use the escaped characters. In other words, these are equivalent:</p>
        <pre class="language-text"><code class="language-text">src/routes/[u+d83e][u+dd2a]/+page.svelte
src/routes/🤪/+page.svelte</code></pre>
        <p>The format for a Unicode escape sequence is <code>[u+nnnn]</code> where <code>nnnn</code> is a valid value between <code>0000</code> and <code>10ffff</code>. (Unlike JavaScript string escaping, there's no need to use surrogate pairs to represent code points above <code>ffff</code>.) To learn more about Unicode encodings, consult <a href="https://unicodebook.readthedocs.io/unicode_encodings.html">Programming with Unicode</a>.</p>
        <blockquote>
          <p>Since TypeScript <a href="https://github.com/microsoft/TypeScript/issues/13399">struggles</a> with directories with a leading <code>.</code> character, you may find it useful to encode these characters when creating e.g. <a href="https://en.wikipedia.org/wiki/Well-known_URI"><code>.well-known</code></a> routes: <code>src/routes/[x+2e]well-known/...</code></p>
        </blockquote>
      </section>
      <section id="advanced-layouts" class="level2">
        <h2>Advanced layouts</h2>
        <p>By default, the <em>layout hierarchy</em> mirrors the <em>route hierarchy</em>. In some cases, that might not be what you want.</p>
        <section id="group" class="level3">
          <h3>(group)</h3>
          <p>Perhaps you have some routes that are 'app' routes that should have one layout (e.g. <code>/dashboard</code> or <code>/item</code>), and others that are 'marketing' routes that should have a different layout (<code>/blog</code> or <code>/testimonials</code>). We can group these routes with a directory whose name is wrapped in parentheses — unlike normal directories, <code>(app)</code> and <code>(marketing)</code> do not affect the URL pathname of the routes inside them:</p>
          <pre class="language-diff"><code class="language-diff">src/routes/
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">│ (app)/
</span></span>│ ├ dashboard/
│ ├ item/
│ └ +layout.svelte
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">│ (marketing)/
</span></span>│ ├ about/
│ ├ testimonials/
│ └ +layout.svelte
├ admin/
└ +layout.svelte</code></pre>
          <p>You can also put a <code>+page</code> directly inside a <code>(group)</code>, for example if <code>/</code> should be an <code>(app)</code> or a <code>(marketing)</code> page.</p>
        </section>
        <section id="breaking-out-of-layouts" class="level3">
          <h3>Breaking out of layouts</h3>
          <p>The root layout applies to every page of your app — if omitted, it defaults to <code>&#x3C;slot /></code>. If you want some pages to have a different layout hierarchy than the rest, then you can put your entire app inside one or more groups <em>except</em> the routes that should not inherit the common layouts.</p>
          <p>In the example above, the <code>/admin</code> route does not inherit either the <code>(app)</code> or <code>(marketing)</code> layouts.</p>
        </section>
        <section id="page" class="level3">
          <h3>+page@</h3>
          <p>Pages can break out of the current layout hierarchy on a route-by-route basis. Suppose we have an <code>/item/[id]/embed</code> route inside the <code>(app)</code> group from the previous example:</p>
          <pre class="language-diff"><code class="language-diff">src/routes/
├ (app)/
│ ├ item/
│ │ ├ [id]/
│ │ │ ├ embed/
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">│ │ │ │ └ +page.svelte
</span></span>│ │ │ └ +layout.svelte
│ │ └ +layout.svelte
│ └ +layout.svelte
└ +layout.svelte</code></pre>
          <p>Ordinarily, this would inherit the root layout, the <code>(app)</code> layout, the <code>item</code> layout and the <code>[id]</code> layout. We can reset to one of those layouts by appending <code>@</code> followed by the segment name — or, for the root layout, the empty string. In this example, we can choose from the following options:</p>
          <ul>
            <li><code>+page@[id].svelte</code> - inherits from <code>src/routes/(app)/item/[id]/+layout.svelte</code></li>
            <li><code>+page@item.svelte</code> - inherits from <code>src/routes/(app)/item/+layout.svelte</code></li>
            <li><code>+page@(app).svelte</code> - inherits from <code>src/routes/(app)/+layout.svelte</code></li>
            <li><code>+page@.svelte</code> - inherits from <code>src/routes/+layout.svelte</code></li>
          </ul>
          <pre class="language-diff"><code class="language-diff">src/routes/
├ (app)/
│ ├ item/
│ │ ├ [id]/
│ │ │ ├ embed/
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">│ │ │ │ └ +page@(app).svelte
</span></span>│ │ │ └ +layout.svelte
│ │ └ +layout.svelte
│ └ +layout.svelte
└ +layout.svelte</code></pre>
        </section>
        <section id="layout" class="level3">
          <h3>+layout@</h3>
          <p>Like pages, layouts can <em>themselves</em> break out of their parent layout hierarchy, using the same technique. For example, a <code>+layout@.svelte</code> component would reset the hierarchy for all its child routes.</p>
          <pre class="language-text"><code class="language-text">src/routes/
├ (app)/
│ ├ item/
│ │ ├ [id]/
│ │ │ ├ embed/
│ │ │ │ └ +page.svelte  // uses (app)/item/[id]/+layout.svelte
│ │ │ ├ +layout.svelte  // inherits from (app)/item/+layout@.svelte
│ │ │ └ +page.svelte    // uses (app)/item/+layout@.svelte
│ │ └ +layout@.svelte   // inherits from root layout, skipping (app)/+layout.svelte
│ └ +layout.svelte
└ +layout.svelte</code></pre>
        </section>
        <section id="when-to-use-layout-groups" class="level3">
          <h3>When to use layout groups</h3>
          <p>Not all use cases are suited for layout grouping, nor should you feel compelled to use them. It might be that your use case would result in complex <code>(group)</code> nesting, or that you don't want to introduce a <code>(group)</code> for a single outlier. It's perfectly fine to use other means such as composition (reusable <code>load</code> functions or Svelte components) or if-statements to achieve what you want. The following example shows a layout that rewinds to the root layout and reuses components and functions that other layouts can also use:</p>
          <pre class="language-svelte"><code class="language-svelte">/// file: src/routes/nested/route/+layout@.svelte
&#x3C;script>
	import ReusableLayout from '$lib/ReusableLayout.svelte';
	export let data;
&#x3C;/script>

&#x3C;ReusableLayout {data}>
	&#x3C;slot />
&#x3C;/ReusableLayout></code></pre>
          <pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/nested/route/+layout.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare module <span class="token string">"$lib/reusable-load-function"</span> <span class="token punctuation">{</span>
	<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">reusableLoad</span><span class="token punctuation">(</span>event<span class="token operator">:</span> <span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'@sveltejs/kit'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">LoadEvent</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span>string<span class="token punctuation">,</span> any<span class="token operator">>></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> reusableLoad <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'$lib/reusable-load-function'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Add additional logic here, if needed</span>
	<span class="token keyword control-flow">return</span> <span class="token function">reusableLoad</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
          <p><span style="float: footnote;"><a href="../../index.html#toc">Go to TOC</a></span></p>
        </section>
      </section>
    </section>
  </body>
</html>
