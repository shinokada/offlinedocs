<!doctype html><html lang="cn"><meta charset="utf-8"><title>配置索引</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="outline"content="deep"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="配置索引"class="level1"><h1>配置索引</h1><section id="配置"class="level2"><h2>配置</h2><p><code>vitest</code> 将读取你的项目根目录的 <code>vite.config.ts</code> 文件以匹配插件并设置为你的 Vite 应用程序。如果你想使用不同的配置进行测试，你可以：<ul><li>创建 <code>vitest.config.ts</code>，优先级更高。<li>将 <code>--config</code> 选项传递给 CLI，例如 <code>vitest --config ./path/to/vitest.config.ts</code> 。<li>在 <code>defineConfig</code> 中使用 <code>process.env.VITEST</code> 或 <code>mode</code> 属性（默认值是 <code>test</code>）在 <code>vite.config.ts</code> 中有条件的应用不同的配置。</ul><p>要配置 <code>vitest</code> 本身，请在你的 Vite 配置中添加 <code>test</code> 属性。如果你使用 <code>vite</code> 的 <code>defineConfig</code> 你还需要将 <a href="https://www.tslang.cn/docs/handbook/triple-slash-directives.html#-reference-types-">三斜线指令</a> 写在配置文件的顶部。<p>使用 <code>vite</code> 的 <code>defineConfig</code> 可以参考下面的格式：<pre class="language-ts"><code class="language-ts"><span class="token comment">/// &#x3C;reference types="vitest" /></span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"vite"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>使用 <code>vitest</code> 的 <code>defineConfig</code> 可以参考下面的格式：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"vitest/config"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>如果有需要，你可以获取到 Vitest 的默认选项以扩展它们：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> configDefaults<span class="token punctuation">,</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"vitest/config"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token spread operator">...</span>configDefaults<span class="token punctuation">.</span><span class="token property-access">exclude</span><span class="token punctuation">,</span> <span class="token string">"packages/template/*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="选项"class="level2"><h2>选项</h2><p>当使用单独的 <code>vitest.config.js</code> 时，如果需要，你还可以从另一个配置文件扩展 Vite 的选项：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> mergeConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"vite"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"vitest/config"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">viteConfig</span> <span class="token keyword module">from</span> <span class="token string">"./vite.config"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">mergeConfig</span><span class="token punctuation">(</span>
  viteConfig<span class="token punctuation">,</span>
  <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token punctuation">{</span>
      exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"packages/template/*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote>提醒 除了以下选项，你还可以使用 [Vite](https://vitejs.dev/config/) 中的任何配置选项。 例如，`define` 定义全局变量，或`resolve.alias` 定义别名。</blockquote><section id="include"class="level3"><h3>include</h3><ul><li><strong>类型:</strong> <code>string[]</code><li><strong>默认值:</strong> <code>['**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}']</code></ul><p>匹配包含测试文件的 glob 规则。</section><section id="exclude"class="level3"><h3>exclude</h3><ul><li><strong>类型:</strong> <code>string[]</code><li><strong>默认值:</strong> <code>['**/node_modules/**', '**/dist/**', '**/cypress/**', '**/.{idea,git,cache,output,temp}/**', '**/{karma,rollup,webpack,vite,vitest,jest,ava,babel,nyc,cypress}.config.*']</code></ul><p>匹配排除测试文件的 glob 规则。</section><section id="deps"class="level3"><h3>deps</h3><ul><li><strong>类型:</strong> <code>{ external?, inline? }</code></ul><p>对依赖关系进行内联或外联的处理<section id="depsexternal"class="level4"><h4>deps.external</h4><ul><li><strong>类型:</strong> <code>(string | RegExp)[]</code><li><strong>默认值:</strong> <code>['**/node_modules/**', '**/dist/**']</code></ul><p>Externalize 意味着 Vite 会绕过包到原生 Node.js 中。Vite 的转换器和解析器不会应用外部依赖项，因此不会支持重新加载时的热更新。通常，<code>node_modules</code> 下的包是外部依赖。</section><section id="depsinline"class="level4"><h4>deps.inline</h4><ul><li><strong>类型:</strong> <code>(string | RegExp)[] | true</code><li><strong>默认值:</strong> <code>[]</code></ul><p>Vite 将会处理的内联模块。这有助于处理以 ESM 格式（Node 无法处理）发布 <code>.js</code> 的包。<p>如果为 <code>true</code>，则每个依赖项都将被内联。 在 <a href="https://vitejs.dev/guide/ssr.html#ssr-externals"><code>ssr.noExternal</code></a> 中指定的所有依赖项将默认内联。</section><section id="depsfallbackcjs"class="level4"><h4>deps.fallbackCJS</h4><ul><li><strong>类型</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code></ul><p>当一个依赖项是有效的 ESM 包时，将会尝试根据路径猜测 cjs 版本。<p>如果包在 ESM 和 CJS 模式下具有不同的逻辑，可能会导致一些错误的产生。</section><section id="depsregisternodeloader"class="level4"><h4>deps.registerNodeLoader</h4><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code></ul><p>使用 <a href="https://nodejs.org/api/esm.html#loaders">实验性 Node 加载器</a> 解析 <code>node_modules</code> 中的导入，使用 Vite 解析算法。<p>如果禁用，你的 <code>alias</code> 和 <code>&#x3C;plugin>.resolveId</code> 不会影响 <code>node_modules</code> 或 <code>deps.external</code> 中的导入。</section><section id="depsinteropdefault"class="level4"><h4>deps.interopDefault</h4><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>true</code></ul><p>将 CJS 模块的默认值视为命名导出。</section></section><section id="benchmark"class="level3"><h3>benchmark</h3><ul><li><strong>类型:</strong> <code>{ include?, exclude?, ... }</code></ul><p>运行 <code>vitest bench</code> 时使用的选项。</section><section id="benchmarkinclude"class="level3"><h3>benchmark.include</h3><ul><li><strong>类型:</strong> <code>string[]</code><li><strong>默认值:</strong> <code>['**/*.{bench,benchmark}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}']</code></ul><p>匹配包含基准测试文件的 glob 规则。</section><section id="benchmarkexclude"class="level3"><h3>benchmark.exclude</h3><ul><li><strong>类型:</strong> <code>string[]</code><li><strong>默认值:</strong> <code>['node_modules', 'dist', '.idea', '.git', '.cache']</code></ul><p>匹配排除基准测试文件的 glob 规则。</section><section id="benchmarkincludesource"class="level3"><h3>benchmark.includeSource</h3><ul><li><strong>类型:</strong> <code>string[]</code><li><strong>默认值:</strong> <code>[]</code></ul><p>匹配包含内联基准测试文件的 glob 规则。此选项类似于 <a href="#includesource"><code>includeSource</code></a>。<p>定义后，Vitest 将运行所有匹配的文件，其中包含 <code>import.meta.vitest</code>。</section><section id="benchmarkreporters"class="level3"><h3>benchmark.reporters</h3><ul><li><strong>类型:</strong> <code>Arrayable&#x3C;BenchmarkBuiltinReporters | Reporter></code><li><strong>默认值:</strong> <code>'default'</code></ul><p>用于定义输出的自定义报告器。它可以包含一个或多个内置报告名称、报告实例和(或)自定义报告的路径。</section><section id="benchmarkoutputfile"class="level3"><h3>benchmark.outputFile</h3><ul><li><strong>类型:</strong> <code>string | Record&#x3C;string, string></code></ul><p>当指定了 <code>--reporter=json</code> 选项时，可以将基准测试结果写入文件。 通过提供对象而不是字符串，您可以在使用多个报告器时定义单独的输出。<p>通过 CLI 命令提供对象，请使用以下语法: <code>--outputFile.json=./path --outputFile.junit=./other-path</code>.</section><section id="alias"class="level3"><h3>alias</h3><ul><li><strong>类型:</strong> <code>Record&#x3C;string, string> | Array&#x3C;{ find: string | RegExp, replacement: string, customResolver?: ResolverFunction | ResolverObject }></code></ul><p>在测试内部运行时定义自定义别名。它们将与来自 <code>resolve.alias</code> 的别名合并。</section><section id="globals"class="level3"><h3>globals</h3><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code></ul><p>默认情况下，<code>vitest</code> 不显式提供全局 API。如果你更倾向于使用类似 jest 中的全局 API，可以将 <code>--globals</code> 选项传递给 CLI 或在配置中添加 <code>globals: true</code>。<pre class="language-ts"><code class="language-ts"><span class="token comment">// vite.config.ts</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"vitest/config"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    globals<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>为了可以让全局 API 支持 Typescript，请将 <code>vitest/globals</code> 添加到 <code>tsconfig.json</code> 中的 <code>types</code> 选项中<pre class="language-json"><code class="language-json"><span class="token comment">// tsconfig.json</span>
<span class="token punctuation">{</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"types"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"vitest/globals"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>如果你已经在项目中使用 <a href="https://github.com/antfu/unplugin-auto-import"><code>unplugin-auto-import</code></a>，你也可以直接用它来自动导入这些 API。<pre class="language-ts"><code class="language-ts"><span class="token comment">// vite.config.ts</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"vitest/config"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">AutoImport</span></span> <span class="token keyword module">from</span> <span class="token string">"unplugin-auto-import/vite"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function"><span class="token maybe-class-name">AutoImport</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      imports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"vitest"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      dts<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// generate TypeScript declaration</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="environment"class="level3"><h3>environment</h3><ul><li><strong>类型:</strong> <code>'node' | 'jsdom' | 'happy-dom' | 'edge-runtime' | string</code><li><strong>默认值:</strong> <code>'node'</code></ul><p>Vitest 中的默认测试环境是一个 Node.js 环境。如果你正在构建 Web 端应用程序，你可以使用 <a href="https://github.com/jsdom/jsdom"><code>jsdom</code></a> 或 <a href="https://github.com/capricorn86/happy-dom"><code>happy-dom</code></a> 这种类似浏览器(browser-like)的环境来替代 Node.js。 如果你正在构建边缘计算函数，你可以使用 <a href="https://edge-runtime.vercel.app/packages/vm"><code>edge-runtime</code></a> 环境<p>你可以通过在文件顶部添加包含 <code>@vitest-environment</code> 的文档块或注释，为某个测试文件中的所有测试指定环境：<p>文档块格式:<pre class="language-js"><code class="language-js"><span class="token doc-comment comment">/**
 * <span class="token keyword">@vitest-environment</span> jsdom
 */</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"use jsdom in this test file"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>注释格式:<pre class="language-js"><code class="language-js"><span class="token comment">// @vitest-environment happy-dom</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"use happy-dom in this test file"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>为了与 Jest 兼容，还存在一个配置 <code>@jest-environment</code>：<pre class="language-js"><code class="language-js"><span class="token doc-comment comment">/**
 * <span class="token keyword">@jest-environment</span> jsdom
 */</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"use jsdom in this test file"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>如果你使用 <a href="#threads"><code>--no-threads</code></a> 标志运行 Vitest，你的测试将按以下顺序运行：<code>node</code>, <code>jsdom</code>, <code>happy-dom</code>, <code>edge-runtime</code>, <code>custom environments</code>。 这意味着，具有相同环境的每个测试都组合在一起，但仍按顺序运行。<p>从 0.23.0 开始，你还可以定义自定义环境。 当使用非内置环境时，Vitest 将尝试加载包 <code>vitest-environment-${name}</code>。 该包应导出一个具有 <code>Environment</code> 属性的对象：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Environment</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">"vitest"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Environment</span><span class="token operator">></span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"custom"</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// custom setup</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token function">teardown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// called after all tests with this env have been run</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>Vitest 还通过 <code>vitest/environments</code> 入口导出 <code>builtinEnvironments</code>，以防你只想扩展它。 你可以在 <a href="/guide/environment">测试环境指南</a> 中阅读有关扩展测试环境的更多信息。</section><section id="environmentoptions"class="level3"><h3>environmentOptions</h3><ul><li><strong>类型:</strong> <code>Record&#x3C;'jsdom' | string, unknown></code><li><strong>默认值:</strong> <code>{}</code></ul><p>这些选项被传递给当前 <a href="/#environment"><code>environment</code></a> 的 <code>setup</code> 方法。 默认情况下，如果你将其用作测试环境，则只能配置 JSDOM 选项。</section><section id="update"class="level3"><h3>update</h3><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code></ul><p>更新快照文件。这将更新所有更改的快照并删除过时的快照。</section><section id="watch"class="level3"><h3>watch</h3><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>true</code></ul><p>启动监听模式</section><section id="root"class="level3"><h3>root</h3><ul><li><strong>类型:</strong> <code>string</code></ul><p>项目的根目录</section><section id="reporters"class="level3"><h3>reporters</h3><ul><li><strong>类型:</strong> <code>Reporter | Reporter[]</code><li><strong>默认值:</strong> <code>'default'</code></ul><p>用于输出的自定义 reporters 。 Reporters 可以是 <a href="https://github.com/vitest-dev/vitest/blob/main/packages/vitest/src/types/reporter.ts">一个 Reporter 实例</a> 或选择内置的 reporters 字符串：<ul><li><code>'default'</code> - 当他们经过测试套件<li><code>'verbose'</code> - 保持完整的任务树可见<li><code>'dot'</code> - 将每个任务显示为一个点<li><code>'junit'</code> - JUnit XML 报告器（你可以使用 <code>VITEST_JUNIT_SUITE_NAME</code> 环境变量配置 <code>test suites</code> 标签名称）<li><code>'json'</code> - 给出一个简单的 JSON 总结<li>自定义报告的路径 (例如 <code>'./path/to/reporter.ts'</code>, <code>'@scope/reporter'</code>)</ul></section><section id="outputtruncatelength"class="level3"><h3>outputTruncateLength</h3><ul><li><strong>类型:</strong> <code>number</code><li><strong>默认值:</strong> <code>80</code></ul><p>指定截断输出差异的字符行数，最多 80 个字符。 你可能希望对此进行调整，取决于你的终端窗口宽度。</section><section id="outputdifflines"class="level3"><h3>outputDiffLines</h3><ul><li><strong>类型:</strong> <code>number</code><li><strong>默认值:</strong> <code>15</code></ul><p>指定输出差线的数量，最多 <code>15</code> 个。</section><section id="outputfile"class="level3"><h3>outputFile</h3><ul><li><strong>类型:</strong> <code>string | Record&#x3C;string, string></code></ul><p>当指定 <code>--reporter=json</code> 或 <code>--reporter=junit</code> 时，将测试结果写入一个文件。通过提供对象而不是字符串，你可以在使用多个报告器时定义单独的输出。<p>要通过 CLI 命令提供对象，请使用以下语法：<code>--outputFile.json=./path --outputFile.junit=./other-path</code>。</section><section id="threads"class="level3"><h3>threads</h3><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>true</code></ul><p>通过使用 <a href="https://github.com/tinylibs/tinypool">tinypool</a>（<a href="https://github.com/piscinajs/piscina">Piscina</a> 的轻量级分支）可以启用多线程。<blockquote>警告 此选项与 Jest 的 `--runInBand` 不同。 Vitest 使用工作线程不仅可以并行运行测试，还可以提供隔离。 通过禁用此选项，你的测试将按顺序运行，但在相同的全局上下文中，因此你必须自己提供隔离。<p>如果你依赖全局状态（前端框架通常这样做）或者你的代码依赖于为每个测试单独定义的环境，这可能会导致各种问题。 但是可以提高你的测试速度（最多快 3 倍），这不一定依赖于全局状态或可以轻松绕过它。</blockquote></section><section id="maxthreads"class="level3"><h3>maxThreads</h3><ul><li><strong>类型:</strong> <code>number</code><li><strong>默认值:</strong> 可用的 CPU 数量</ul><p>允许的最大线程数。你也可以使用 <code>VITEST_MAX_THREADS</code> 环境变量。</section><section id="minthreads"class="level3"><h3>minThreads</h3><ul><li><strong>类型:</strong> <code>number</code><li><strong>默认值:</strong> 可用的 CPU 数量</ul><p>允许的最小线程数。你也可以使用 <code>VITEST_MIN_THREADS</code> 环境变量。</section><section id="testtimeout"class="level3"><h3>testTimeout</h3><ul><li><strong>类型:</strong> <code>number</code><li><strong>默认值:</strong> <code>5000</code></ul><p>测试的默认超时时间（以毫秒为单位）。</section><section id="hooktimeout"class="level3"><h3>hookTimeout</h3><ul><li><strong>类型:</strong> <code>number</code><li><strong>默认值:</strong> <code>10000</code></ul><p>钩子(hook)的默认超时时间（以毫秒为单位）。</section><section id="teardowntimeout"class="level3"><h3>teardownTimeout</h3><ul><li><strong>类型:</strong> <code>number</code><li><strong>默认值:</strong> <code>1000</code></ul><p>Vitest 关闭时等待关闭的默认超时时间，以毫秒为单位</section><section id="silent"class="level3"><h3>silent</h3><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code></ul><p>静默模式下启动测试。</section><section id="setupfiles"class="level3"><h3>setupFiles</h3><ul><li><strong>类型:</strong> <code>string | string[]</code></ul><p>setup 文件的路径。它们将运行在每个测试文件之前。<p>你可以在内部使用 <code>process.env.VITEST_WORKER_ID</code> (类似整数的字符串）来区分线程（如果<code>threads: false</code>，那么这个值将永远会是<code>1</code>）。<blockquote>提醒 请注意，如果你正在运行 [`--no-threads`](#threads)，则此设置文件将在同一全局范围内多次运行。 这意味着，你在每次测试之前都在访问同一个全局对象，因此请确保你做的事情没有超出你的需要。</blockquote><p>比如，你可能依赖于一个全局变量：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> config <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"@some-testing-lib"</span><span class="token punctuation">;</span>

<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>globalThis<span class="token punctuation">.</span><span class="token property-access">defined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  config<span class="token punctuation">.</span><span class="token property-access">plugins</span> <span class="token operator">=</span> <span class="token punctuation">[</span>myCoolPlugin<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">computeHeavyThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  globalThis<span class="token punctuation">.</span><span class="token property-access">defined</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// hooks are reset before each suite</span>
<span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

globalThis<span class="token punctuation">.</span><span class="token property-access">resetBeforeEachTest</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></code></pre></section><section id="globalsetup"class="level3"><h3>globalSetup</h3><ul><li><strong>类型:</strong> <code>string | string[]</code></ul><p>全局的 setup 文件的路径，相对于项目的根目录。<p>全局的 setup 文件可以导出命名函数 <code>setup</code> 和 <code>teardown</code> 或返回拆卸函数的 <code>default</code> 函数（<a href="https://github.com/vitest-dev/vitest/blob/main/test/global-setup/vitest.config.ts">示例</a>)。</p>info 提示 可以存在多个 globalSetup。setup 和 teardown 依次执行，而 teardown 则以相反的顺序执行。<blockquote>警告 请注意，全局设置在不同的全局范围内运行，因此你的测试无权访问此处定义的变量。</blockquote></section><section id="watchexclude"class="level3"><h3>watchExclude</h3><ul><li><strong>类型:</strong> <code>string[]</code><li><strong>默认值:</strong> <code>['**/node_modules/**', '**/dist/**']</code></ul><p>触发监视重新运行时要忽略的文件路径的全局 glob 模式。</section><section id="forcereruntriggers"class="level3"><h3>forceRerunTriggers</h3><ul><li><strong>类型</strong>: <code>string[]</code><li><strong>默认值:</strong> <code>['**/package.json/**', '**/vitest.config.*/**', '**/vite.config.*/**']</code></ul><p>将触发整个套件重新运行的文件路径的全局 glob 模式。 如果在 git diff 中找到触发器，则与 --changed 参数配对时，将运行整个测试套件。<p>如果你正在测试调用 CLI 命令时很有用，因为 Vite 无法构建模块依赖图:<pre class="language-ts"><code class="language-ts"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"execute a script"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Vitest cannot rerun this test, if content of `dist/index.js` changes</span>
  <span class="token keyword control-flow">await</span> <span class="token function">execa</span><span class="token punctuation">(</span><span class="token string">"node"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"dist/index.js"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote>提醒 确保你的的文件未被 `watchExclude` 排除。</blockquote></section><section id="isolate"class="level3"><h3>isolate</h3><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>true</code></ul><p>是否为每个测试文件构建隔离环境。 如果你禁用 <a href="#threads"><code>--threads</code></a>，它将不会工作。</section><section id="coverage"class="level3"><h3>coverage</h3><ul><li><strong>类型:</strong> <code>CoverageC8Options | CoverageIstanbulOptions</code><li><strong>默认值:</strong> <code>undefined</code></ul><p>你可以使用 <a href="https://github.com/bcoe/c8"><code>c8</code></a> 或 <a href="https://istanbul.js.org/"><code>istanbul</code></a> 收集测试覆盖率。<section id="provider"class="level4"><h4>provider</h4><ul><li><strong>类型:</strong> <code>'c8' | 'istanbul'</code><li><strong>默认值:</strong> <code>'c8'</code></ul><p>使用 <code>provider</code> 选择收集测试覆盖率的工具。</section><section id="enabled"class="level4"><h4>enabled</h4><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul><p>是否启用收集测试覆盖率。可以使用 <code>--coverage</code> 覆盖 CLI 选项。</section><section id="include-1"class="level4"><h4>include</h4><ul><li><strong>类型:</strong> <code>string[]</code><li><strong>默认值:</strong> <code>['**']</code><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul></section><section id="extension"class="level4"><h4>extension</h4><ul><li><strong>类型:</strong> <code>string | string[]</code><li><strong>默认值:</strong> <code>['.js', '.cjs', '.mjs', '.ts', '.mts', '.cts', '.tsx', '.jsx', '.vue', '.svelte']</code><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul><p>匹配包含测试覆盖率的 glob 规则</section><section id="exclude-1"class="level4"><h4>exclude</h4><ul><li><strong>类型:</strong> <code>string[]</code><li><strong>默认值:</strong></ul><pre class="language-js"><code class="language-js"><span class="token punctuation">[</span>
  <span class="token string">"coverage/**"</span><span class="token punctuation">,</span>
  <span class="token string">"dist/**"</span><span class="token punctuation">,</span>
  <span class="token string">"packages/*/test{,s}/**"</span><span class="token punctuation">,</span>
  <span class="token string">"**/*.d.ts"</span><span class="token punctuation">,</span>
  <span class="token string">"cypress/**"</span><span class="token punctuation">,</span>
  <span class="token string">"test{,s}/**"</span><span class="token punctuation">,</span>
  <span class="token string">"test{,-*}.{js,cjs,mjs,ts,tsx,jsx}"</span><span class="token punctuation">,</span>
  <span class="token string">"**/*{.,-}test.{js,cjs,mjs,ts,tsx,jsx}"</span><span class="token punctuation">,</span>
  <span class="token string">"**/*{.,-}spec.{js,cjs,mjs,ts,tsx,jsx}"</span><span class="token punctuation">,</span>
  <span class="token string">"**/__tests__/**"</span><span class="token punctuation">,</span>
  <span class="token string">"**/{karma,rollup,webpack,vite,vitest,jest,ava,babel,nyc,cypress}.config.*"</span><span class="token punctuation">,</span>
  <span class="token string">"**/.{eslint,mocha,prettier}rc.{js,cjs,yml}"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><ul><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul><p>使用全局模式排除在覆盖范围之外的文件列表。</section><section id="all"class="level4"><h4>all</h4><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul><p>是否将所有文件（包括未测试的文件）包括在报告中。</section><section id="clean"class="level4"><h4>clean</h4><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>true</code><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul><p>运行测试之前是否清除覆盖率结果</section><section id="cleanonrerun"class="level4"><h4>cleanOnRerun</h4><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul><p>是否将所有文件（包括未测试的文件）包括在报告中。</section><section id="clean-1"class="level4"><h4>clean</h4><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>true</code><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul><p>运行测试之前是否清除覆盖率结果</section><section id="cleanonrerun-1"class="level4"><h4>cleanOnRerun</h4><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul><p>监视重新运行时是否清除覆盖率报告</section><section id="reportsdirectory"class="level4"><h4>reportsDirectory</h4><ul><li><strong>类型:</strong> <code>string</code><li><strong>默认值:</strong> <code>'./coverage'</code><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul><p>配置测试覆盖率报告写入的目录。 当使用 <code>c8</code> 提供程序时，将为 <a href="https://nodejs.org/api/cli.html#coverage-output">V8 coverage results</a> 创建临时 <code>/tmp</code> 目录。</section><section id="reporter"class="level4"><h4>reporter</h4><ul><li><strong>类型:</strong> <code>string | string[]</code><li><strong>默认值:</strong> <code>['text', 'html', 'clover', 'json']</code><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul><p>要使用的测试覆盖率报告。详见 <a href="https://istanbul.js.org/docs/advanced/alternative-reporters/">istanbul documentation</a> 来了解报告详情。</section><section id="skipfull"class="level4"><h4>skipFull</h4><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul><p>是否显示具有 100% 语句、分支和函数的测试覆盖率的文件。</section><section id="perfile"class="level4"><h4>perFile</h4><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul><p>检查每个文件的阈值。 有关实际阈值，请参见 <code>lines</code>, <code>functions</code>, <code>branches</code> and <code>statements</code> 。</section><section id="lines"class="level4"><h4>lines</h4><ul><li><strong>类型:</strong> <code>number</code><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul><p>行的阈值。 参考 <a href="https://github.com/istanbuljs/nyc#coverage-thresholds">istanbul documentation</a> 来了解详情。</section><section id="functions"class="level4"><h4>functions</h4><ul><li><strong>类型:</strong> <code>number</code><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul><p>函数的阈值。 参考 <a href="https://github.com/istanbuljs/nyc#coverage-thresholds">istanbul documentation</a> 来了解详情。</section><section id="branches"class="level4"><h4>branches</h4><ul><li><strong>类型:</strong> <code>number</code><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul><p>分支的阈值。 参考 <a href="https://github.com/istanbuljs/nyc#coverage-thresholds">istanbul documentation</a> 来了解详情。</section><section id="statements"class="level4"><h4>statements</h4><ul><li><strong>类型:</strong> <code>number</code><li><strong>可用的测试提供者:</strong> <code>'c8' | 'istanbul'</code></ul><p>语句的阈值。 参考 <a href="https://github.com/istanbuljs/nyc#coverage-thresholds">istanbul documentation</a> 来了解详情。</section><section id="allowexternal"class="level4"><h4>allowExternal</h4><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code><li><strong>可用的测试提供者:</strong> <code>'c8'</code></ul><p>是否允许来自 cwd 外部的文件。</section><section id="excludenodemodules"class="level4"><h4>excludeNodeModules</h4><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>true</code><li><strong>可用的测试提供者:</strong> <code>'c8'</code></ul><p>排除 <code>/node_modules/</code> 下的覆盖范围。</section><section id="src"class="level4"><h4>src</h4><ul><li><strong>类型:</strong> <code>string[]</code><li><strong>默认值:</strong> <code>process.cwd()</code><li><strong>可用的测试提供者:</strong> <code>'c8'</code></ul><p>指定启用 <code>--all</code> 时使用的目录。</section><section id="100"class="level4"><h4>100</h4><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code><li><strong>可用的测试提供者:</strong> <code>'c8'</code></ul><p>为 <code>--check-coverage --lines 100 --functions 100 --branches 100 --statements 100</code> 设置的快捷方式。</section><section id="ignoreclassmethods"class="level4"><h4>ignoreClassMethods</h4><ul><li><strong>类型:</strong> <code>string[]</code><li><strong>默认值:</strong> <code>[]</code><li><strong>可用的测试提供者:</strong> <code>'istanbul'</code></ul><p>设置为要忽略覆盖率的类方法名称数组。 参考 <a href="https://github.com/istanbuljs/nyc#ignoring-methods">istanbul documentation</a> 来了解详情。</section><section id="watermarks"class="level4"><h4>watermarks</h4><ul><li><strong>类型:</strong></ul><pre class="language-ts"><code class="language-ts"><span class="token punctuation">{</span>
  statements<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  functions<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  branches<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  lines<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre><ul><li><strong>默认值:</strong></ul><pre class="language-ts"><code class="language-ts"><span class="token punctuation">{</span>
  statements<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  functions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  branches<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  lines<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre><p>指定语句、行、分支和函数的水印位置。<section id="all-1"class="level5"><h5>all</h5><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> false<li><strong>可用的测试提供者:</strong> <code>'istanbul'</code></ul><p>指定语句、行、分支和函数的水印位置。参考 <a href="https://github.com/istanbuljs/nyc#high-and-low-watermarks">istanbul documentation</a> 来了解详情。</section></section></section><section id="testnamepattern"class="level3"><h3>testNamePattern</h3><ul><li><strong>类型</strong> <code>string | RegExp</code></ul><p>使用与模式匹配的全名运行测试。 如果你将 <code>OnlyRunThis</code> 添加到此属性，将跳过测试名称中不包含单词 <code>OnlyRunThis</code> 的测试。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"vitest"</span><span class="token punctuation">;</span>

<span class="token comment">// run</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"OnlyRunThis"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// skipped</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"doNotRun"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="open"class="level3"><h3>open</h3><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code></ul><p>打开 Vitest UI (WIP: 赞助者计划可用)</section><section id="api"class="level3"><h3>api</h3><ul><li><strong>类型:</strong> <code>boolean | number</code><li><strong>默认值:</strong> <code>false</code></ul><p>提供 API 服务的端口。当设置为 true 时，默认端口为 51204</section><section id="clearmocks"class="level3"><h3>clearMocks</h3><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code></ul><p>是否在每次测试前对所有监听(Spy)调用 <code>.mockClear()</code>。这将清除模拟历史记录，但不会将其实现重置为默认值。</section><section id="mockreset"class="level3"><h3>mockReset</h3><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code></ul><p>是否在每次测试之前对所有监听(Spy)调用 <a href="../api.html#mockreset"><code>.mockReset()</code></a>。 这将清除模拟历史并将其实现重置为空函数（将返回<code>undefined</code>）。</section><section id="restoremocks"class="level3"><h3>restoreMocks</h3><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code></ul><p>是否在每次测试之前对所有监听(Spy)调用 <a href="../api.html#mockrestore"><code>.mockRestore()</code></a>。 这将清除模拟历史并将其实现重置为原始历史。</section><section id="unstubenvs"class="level3"><h3>unstubEnvs</h3><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code><li><strong>版本:</strong> 从 Vitest 0.26.0 开始支持</ul><p>将在每次测试前调用 <a href="../api.html#vi-unstuballenvs"><code>vi.unstubAllEnvs</code></a>。</section><section id="unstubglobals"class="level3"><h3>unstubGlobals</h3><ul><li><strong>类型:</strong> <code>boolean</code><li><strong>默认值:</strong> <code>false</code><li><strong>版本:</strong> 从 Vitest 0.26.0 开始支持</ul><p>将在每次测试前调用 <a href="../api.html#vi-unstuballglobals"><code>vi.unstubAllGlobals</code></a>。</section><section id="transformmode"class="level3"><h3>transformMode</h3><ul><li><strong>类型:</strong> <code>{ web?, ssr? }</code></ul><p>决定模块的转换方式。<section id="transformmodessr"class="level4"><h4>transformMode.ssr</h4><ul><li><strong>类型:</strong> <code>RegExp[]</code><li><strong>默认值:</strong> <code>[/\.([cm]?[jt]sx?|json)$/]</code></ul><p>对指定的文件使用 SSR 转换管道。<br>Vite 插件在处理这些文件时会收到 <code>ssr: true</code> 标志。</section><section id="transformmodeweb"class="level4"><h4>transformMode.web</h4><ul><li><strong>类型:</strong> <code>RegExp[]</code><li><strong>默认值:</strong> <em>除了 <code>transformMode.ssr</code> 以外的所有文件</em></ul><p>首先会进行正常的转换管道（针对浏览器），然后进行 SSR 重写以在 Node 中运行代码。<br>Vite 插件在处理这些文件时会收到 <code>ssr: false</code> 标志。<p>当你使用 JSX 作为 React 以外的组件模型（例如 Vue JSX 或 SolidJS）时，你可能需要进行如下配置以使 <code>.tsx</code> / <code>.jsx</code> 转换为客户端组件：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"vitest/config"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    transformMode<span class="token operator">:</span> <span class="token punctuation">{</span>
      web<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.[jt]sx$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section></section><section id="snapshotformat"class="level3"><h3>snapshotFormat</h3><ul><li><strong>类型:</strong> <code>PrettyFormatOptions</code></ul><p>测试快照的格式选项。这些选项被传递给 <a href="https://www.npmjs.com/package/pretty-format"><code>pretty-format</code></a>。</section><section id="resolvesnapshotpath"class="level3"><h3>resolveSnapshotPath</h3><ul><li><strong>类型</strong>: <code>(testPath: string, snapExtension: string) => string</code><li><strong>默认值</strong>: 存储快照文件在 <code>__snapshots__</code> 目录</ul><p>覆盖快照的默认路径。例如，要在测试文件旁边存储一下快照：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"vitest/config"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">resolveSnapshotPath</span><span class="token operator">:</span> <span class="token punctuation">(</span>testPath<span class="token punctuation">,</span> snapExtension<span class="token punctuation">)</span> <span class="token arrow operator">=></span> testPath <span class="token operator">+</span> snapExtension<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="allowonly"class="level3"><h3>allowOnly</h3><ul><li><strong>类型</strong>: <code>boolean</code><li><strong>默认值</strong>: <code>false</code></ul><p>允许标记为 only 的测试和套件。</section><section id="dangerouslyignoreunhandlederrors"class="level3"><h3>dangerouslyIgnoreUnhandledErrors</h3><ul><li><strong>类型</strong>: <code>boolean</code><li><strong>默认值</strong>: <code>false</code></ul><p>忽略发生的任何未处理的错误。</section><section id="passwithnotests"class="level3"><h3>passWithNoTests</h3><ul><li><strong>类型</strong>: <code>boolean</code><li><strong>默认值</strong>: <code>false</code></ul><p>如果没有找到测试，Vitest 不会失败。</section><section id="logheapusage"class="level3"><h3>logHeapUsage</h3><ul><li><strong>类型</strong>: <code>boolean</code><li><strong>默认值</strong>: <code>false</code></ul><p>每次测试后显示堆的使用情况。用于调试内存是否泄漏。</section><section id="css"class="level3"><h3>css</h3><ul><li><strong>类型</strong>: <code>boolean | { include?, exclude?, modules? }</code></ul><p>配置是否应处理 CSS。 排除后，CSS 文件将被替换为空字符串以绕过后续处理。 CSS 模块将返回一个代理以不影响运行时。<section id="cssinclude"class="level4"><h4>css.include</h4><ul><li><strong>类型</strong>: <code>RegExp | RegExp[]</code><li><strong>默认值</strong>: <code>[]</code></ul><p>将返回匹配正则表达式并将由 Vite 管道处理的实际 CSS 文件。<blockquote>如果需要处理所有 CSS 文件，请使用 `/.+/`。</blockquote></section><section id="cssexclude"class="level4"><h4>css.exclude</h4><ul><li><strong>类型</strong>: <code>RegExp | RegExp[]</code><li><strong>默认值</strong>: <code>[]</code></ul><p>将返回匹配正则表达式的空 CSS 文件。</section><section id="cssmodules"class="level4"><h4>css.modules</h4><ul><li><strong>类型</strong>: <code>{ classNameStrategy? }</code><li><strong>默认值</strong>: <code>{}</code></ul></section><section id="cssmodulesclassnamestrategy"class="level4"><h4>css.modules.classNameStrategy</h4><ul><li><strong>类型</strong>: <code>'stable' | 'scoped' | 'non-scoped'</code><li><strong>默认值</strong>: <code>'stable'</code></ul><p>如果你决定处理 CSS 文件，你可以配置 CSS 模块中的类名是否在限定范围内。 默认情况下，Vitest 会导出一个代理，绕过 CSS 模块处理。 你可以选择以下选项之一：<ul><li><code>stable</code>: 类名将生成为<code>_${name}_${hashedFilename}</code>，这意味着如果 CSS 内容发生变化，生成的类将保持不变，但如果文件名被修改，或者文件名将发生变化 被移动到另一个文件夹。 如果你使用快照功能，此设置很有用。<li><code>scoped</code>: 类名将照常生成，遵照 <code>css.modules.generateScopeName</code> 方法，如果你有的话。 默认情况下，文件名将生成为<code>_${name}_${hash}</code>，其中 hash 包括文件名和文件内容。<li><code>non-scoped</code>: 类名将保留 CSS 中定义的名称。</ul><blockquote>在默认的情况下，Vitest 导出代理会绕过 CSS 模块处理。 如果你依赖类的 CSS 属性，就必须使用 `include` 选项启用 CSS 处理。</blockquote></section></section><section id="maxconcurrency"class="level3"><h3>maxConcurrency</h3><ul><li><strong>类型</strong>: <code>number</code><li><strong>默认值</strong>: <code>5</code></ul><p>使用 <code>test.concurrent</code> 标记允许同时运行的最大测试数量。<p>当出现可用插槽时，超过此限制的测试将排队运行。</section><section id="cache"class="level3"><h3>cache</h3><ul><li><strong>类型</strong>: <code>false | { dir? }</code></ul><p>配置 Vitest 缓存策略的选项。目前 Vitest 为测试结果存储缓存，以便先运行更长且失败的测试。<section id="cachedir"class="level4"><h4>cache.dir</h4><ul><li><strong>类型</strong>: <code>string</code><li><strong>默认值</strong>: <code>node_modules/.vitest</code></ul><p>缓存目录的路径。</section></section><section id="sequence"class="level3"><h3>sequence</h3><ul><li><strong>类型</strong>: <code>{ sequencer?, shuffle?, seed?, hooks? }</code></ul><p>配置测试运行顺序的选项。<section id="sequencesequencer"class="level4"><h4>sequence.sequencer</h4><ul><li><strong>类型</strong>: <code>TestSequencerConstructor</code><li><strong>默认值</strong>: <code>BaseSequencer</code></ul><p>定义分片和排序的自定义类。你可以从 <code>vitest/node</code> 扩展 <code>BaseSequencer</code>，如果你只需要重新定义 <code>sort</code> 和 <code>shard</code> 方法之一，但两者都应该存在。<p>分片是在排序之前进行的，并且只有提供了 <code>--shard</code> 选项的情况下才会生效。</section><section id="sequenceshuffle"class="level4"><h4>sequence.shuffle</h4><ul><li><strong>类型</strong>: <code>boolean</code><li><strong>默认值</strong>: <code>false</code></ul><p>如果你希望测试随机运行，可以使用此选项或 CLI 参数 <a href="/guide/cli"><code>--sequence.shuffle</code></a> 启用它。<p>Vitest 通常使用缓存对测试进行排序，因此长时间运行的测试会更早开始 - 这会使测试运行得更快。 如果你的测试将以随机顺序运行，你将失去这种性能改进，但跟踪意外依赖于先前运行的测试可能很有用。</section><section id="sequenceseed"class="level4"><h4>sequence.seed</h4><ul><li><strong>类型</strong>: <code>number</code><li><strong>默认值</strong>: <code>Date.now()</code></ul><p>如果测试以随机顺序运行，则设置随机化种子。</section><section id="sequencehooks"class="level4"><h4>sequence.hooks</h4><ul><li><strong>类型</strong>: <code>'stack' | 'list' | 'parallel'</code><li><strong>默认值</strong>: <code>'parallel'</code></ul><p>更改钩子的执行顺序。<ul><li><code>stack</code> 将以相反的顺序排列 "after" 钩子，"before" 钩子将按照它们定义的顺序运行<li><code>list</code> 将按照定义的顺序对所有钩子进行排序<li><code>parallel</code> 将并行运行单个组中的钩子（父套件中的钩子仍将在当前套件的钩子之前运行）</ul></section></section><section id="typecheck"class="level3"><h3>typecheck</h3><p>用于配置 <a href="/guide/testing-types">typechecking</a> 测试环境的选项。<section id="typecheckchecker"class="level4"><h4>typecheck.checker</h4><ul><li><strong>类型</strong>: <code>'tsc' | 'vue-tsc' | string</code><li><strong>默认值</strong>: <code>tsc</code></ul><p>设置类型检查的检测器。Vitest 将根据类型生成具有某些参数的进程，以便于解析。 Checker 应该实现与 <code>tsc</code> 相同的输出格式。<p>你需要安装一个包才能使用 typecheker:<ul><li><code>tsc</code> requires <code>typescript</code> package<li><code>vue-tsc</code> requires <code>vue-tsc</code> package</ul><p>你还可以将路径传递到自定义二进制文件或命令名称，该路径会产生与 <code>tsc --noEmit --pretty false</code> 相同的输出。</section><section id="typecheckinclude"class="level4"><h4>typecheck.include</h4><ul><li><strong>类型</strong>: <code>string[]</code><li><strong>默认值</strong>: <code>['**/*.{test,spec}-d.{ts,js}']</code></ul><p>匹配包含测试文件的 glob 规则。</section><section id="typecheckexclude"class="level4"><h4>typecheck.exclude</h4><ul><li><strong>类型</strong>: <code>string[]</code><li><strong>默认值</strong>: <code>['**/node_modules/**', '**/dist/**', '**/cypress/**', '**/.{idea,git,cache,output,temp}/**']</code></ul><p>匹配排除测试文件的 glob 规则。</section><section id="typecheckallowjs"class="level4"><h4>typecheck.allowJs</h4><ul><li><strong>类型</strong>: <code>boolean</code><li><strong>默认值</strong>: <code>false</code></ul><p>检查有 <code>@ts-check</code> 注释的 JS 文件。 如果你在 tsconfig 中启用它，则不会覆盖它。</section><section id="typecheckignoresourceerrors"class="level4"><h4>typecheck.ignoreSourceErrors</h4><ul><li><strong>类型</strong>: <code>boolean</code><li><strong>默认值</strong>: <code>false</code></ul><p>如果 Vitest 在测试文件之外发现错误，不要失败。 这根本不会向你显示非测试错误。<p>默认情况下，如果 Vitest 发现源错误，它将测试套件中抛出失败。</section><section id="typechecktsconfig"class="level4"><h4>typecheck.tsconfig</h4><ul><li><strong>类型</strong>: <code>string</code><li><strong>默认值</strong>: <em>tries to find closest tsconfig.json</em></ul><p>自定义 tsconfig 的路径，相对于项目根目录。</section></section><section id="slowtestthreshold"class="level3"><h3>slowTestThreshold</h3><ul><li><strong>类型</strong>: <code>number</code><li><strong>默认值</strong>: <code>300</code></ul><p>如果测试被认为是缓慢的，那么会在报告结果中显示毫秒值。 <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section></section>