<!doctype html><html lang="cn"><meta charset="utf-8"><title>Testing Types | Guide</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="类型测试"class="level1"><h1>类型测试</h1><p>Vitest 允许你使用 <code>expectTypeOf</code> 或 <code>assertType</code> 语法为你的类型编写测试。默认情况下，<code>*.test-d.ts</code> 文件中的所有测试都被视为类型测试，但你可以使用 <a href="../config.html#typecheck-include"><code>typecheck.include</code></a> 配置选项更改它。<p>在这里，Vitest 调用 <code>tsc</code> 或 <code>vue-tsc</code>，具体取决于你的配置，并解析结果。如果发现任何类型错误，Vitest 还会在你的源代码中打印出类型错误。你可以使用 <a href="../config.html#typecheck-ignoresourceerrors"><code>typecheck.ignoreSourceErrors</code></a> 配置选项禁用它。<p>请记住，Vitest 不运行或编译这些文件，它们仅由编译器静态分析，因此你不能使用任何动态语句。这意味着，你不能使用动态测试名称和 <code>test.each</code>、<code>test.runIf</code>、<code>test.skipIf</code>、<code>test.each</code>、<code>test.concurrent</code> API。但是你可以使用其他 API，例如 <code>test</code>、<code>describe</code>、<code>.only</code>、<code>.skip</code> 和 <code>.todo</code>。<p>使用 CLI 标志，如 <code>--allowOnly</code> 和 <code>-t</code> 也支持类型检查。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assertType<span class="token punctuation">,</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> mount <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./mount.js'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'my types work properly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expectTypeOf</span><span class="token punctuation">(</span>mount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expectTypeOf</span><span class="token punctuation">(</span>mount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">parameter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">toMatchTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// @ts-expect-error name is a string</span>
  <span class="token function">assertType</span><span class="token punctuation">(</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>在测试文件中触发的任何类型错误都将被视为测试错误，因此你可以使用任何类型技巧来测试项目中的类型。<p>你可以在 <a href="../api.html#expecttypeof">API 部分</a> 中查看可能的匹配器列表。<section id="读取错误"class="level2"><h2>读取错误</h2><p>如果你使用的是 <code>expectTypeOf</code> API，可能会注意到难以阅读的错误或意外的错误：<pre class="language-ts"><code class="language-ts"><span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">toEqualTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//             ^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="token comment">// index-c3943160.d.ts(90, 20): Arguments for the rest parameter 'MISMATCH' were not provided.</span></code></pre><p>这是由于 <a href="https://github.com/mmkal/expect-type"><code>expect-type</code></a> 处理类型错误的方式。<p>不幸的是，TypeScript 在不打补丁的情况下不提供类型元数据，因此我们目前无法提供有用的错误消息，但是有 <a href="https://github.com/microsoft/TypeScript/pull/40468"tatger=" _blank">在 TypeScript 项目中工作</a> 来解决这个问题。如果你想要更好的消息，请让 TypeScript 团队查看提到的 PR。<p>如果你发现很难使用 <code>expectTypeOf</code> API 并找出错误，你始终可以使用更简单的 <code>assertType</code> API：<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> answer <span class="token operator">=</span> <span class="token number">42</span>

<span class="token generic-function"><span class="token function">assertType</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">number</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>answer<span class="token punctuation">)</span>
<span class="token comment">// @ts-expect-error answer is not a string</span>
<span class="token generic-function"><span class="token function">assertType</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>answer<span class="token punctuation">)</span></code></pre><blockquote>使用 `@ts-expect-error` 语法时，你可能想确保没有输入错误。你可以通过在 [`test.include`](../config.html#include) 配置选项中包含您的类型文件来做到这一点，因此 Vitest 实际上也会*运行*这些测试并因 `ReferenceError` 而失败。<p>这将通过，因为它预计会出现错误，但 “answer” 这个词有错别字，所以这是一个误报错误：<pre class="language-ts"><code class="language-ts"><span class="token comment">// @ts-expect-error answer is not a string</span>
<span class="token generic-function"><span class="token function">assertType</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>answr<span class="token punctuation">)</span> <span class="token comment">//</span></code></pre></blockquote></section><section id="运行-typechecking"class="level2"><h2>运行 typechecking</h2><p>在 <code>package.json</code> 文件 <code>scripts</code> 部分添加如下命令：<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"typecheck"</span><span class="token operator">:</span> <span class="token string">"vitest typecheck"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>现在你可以运行 typecheck:<pre class="language-sh"><code class="language-sh"># npm
npm run typecheck

# yarn
yarn typecheck

# pnpm
pnpm run typecheck</code></pre><p>Vitest 使用 <code>tsc --noEmit</code> 或 <code>vue-tsc --noEmit</code>，具体取决于你的配置，因此可以从管道中删除这些脚本。 <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>