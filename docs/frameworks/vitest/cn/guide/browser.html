<!doctype html><html lang="cn"><meta charset="utf-8"><title>Browser Mode | Guide</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="浏览器模式-实验性"class="level1"><h1>浏览器模式 (实验性)</h1><p>此页面提供有关 Vitest API 中实验性浏览器模式功能的信息，该功能允许你在浏览器中本地运行测试，提供对窗口和文档等浏览器全局变量的访问。此功能目前正在开发中，API 未来可能会更改。<section id="配置"class="level2"><h2>配置</h2><p>要在 Vitest 配置中激活浏览器模式，你可以使用 <code>--browser</code> 标志或在你的 Vitest 配置文件中将 <code>browser.enabled</code> 字段设置为 <code>true</code>。这是使用浏览器字段的示例配置：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    browser<span class="token operator">:</span> <span class="token punctuation">{</span>
      enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">'chrome'</span><span class="token punctuation">,</span> <span class="token comment">// browser name is required</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="浏览器选项类型"class="level2"><h2>浏览器选项类型:</h2><p>Vitest 中的浏览器选项取决于提供者。如果你传递 <code>--browser</code> 并且未在配置文件中指定其名称，Vitest 将失败。可用选项：<ul><li><code>webdriverio</code> (默认) 支持以下浏览器:<ul><li><code>firefox</code><li><code>chrome</code><li><code>edge</code><li><code>safari</code></ul><li><code>playwright</code> 支持以下浏览器:<ul><li><code>firefox</code><li><code>webkit</code><li><code>chromium</code></ul></ul></section><section id="跨浏览器测试"class="level2"><h2>跨浏览器测试:</h2><p>当你在浏览器选项中指定浏览器名称时，Vitest 将默认尝试使用 <a href="https://webdriver.io/">WebdriverIO</a> 运行指定的浏览器，然后在那里运行测试。此功能使跨浏览器测试易于在 CI 等环境中使用和配置。如果不想使用 WebdriverIO，可以使用 <code>browser.provider</code> 选项配置自定义浏览器提供程序。<p>要使用 CLI 指定浏览器，请使用 <code>--browser</code> 标志后跟浏览器名称，如下所示：<pre class="language-sh"><code class="language-sh">npx vitest --browser=chrome</code></pre><p>或者你可以使用点符号向 CLI 提供浏览器选项：<pre class="language-sh"><code class="language-sh">npx vitest --browser.name=chrome --browser.headless</code></pre><blockquote>NOTE 当使用带有 WebdriverIO 的 Safari 浏览器选项时，需要通过在你的设备上运行 `sudo safaridriver --enable` 来激活`safaridriver`。<p>此外，在运行测试时，Vitest 将尝试安装一些驱动程序用于兼容 <code>safaridriver</code>。</blockquote></section><section id="headless"class="level2"><h2>Headless</h2><p>headless 模式是浏览器模式下可用的另一个选项。在 headless 模式下，浏览器在没有用户界面的情况下在后台运行，这对于运行自动化测试非常有用。Vitest 中的 headless 选项可以设置为布尔值以启用或禁用 headless 模式。<p>这是启用 headless 模式的示例配置：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    browser<span class="token operator">:</span> <span class="token punctuation">{</span>
      enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      headless<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>你还可以在 CLI 中使用 <code>--browser.headless</code> 标志设置 headless 模式，如下所示：<pre class="language-sh"><code class="language-sh">npx vitest --browser.name=chrome --browser.headless</code></pre><p>在这种情况下，Vitest 将使用 Chrome 浏览器以 headless 模式运行。</section><section id="限制"class="level2"><h2>限制</h2><section id="线程阻塞对话框"class="level3"><h3>线程阻塞对话框</h3><p>使用 Vitest 浏览器时，需要注意的是像 <code>alert</code> 或 <code>confirm</code> 这样的线程阻塞对话框不能在本地使用。这是因为它们阻塞了网页，这意味着 Vitest 无法继续与该页面通信，导致执行挂起。<p>在这种情况下，Vitest 为这些 API 提供默认模拟和默认返回值。这确保如果用户不小心使用了同步弹出式 Web API，执行不会挂起。但是，仍然建议用户模拟这些 Web API 以获得更好的体验。在 <a href="/guide/mocking">Mocking</a> 中阅读更多内容。 <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section></section>