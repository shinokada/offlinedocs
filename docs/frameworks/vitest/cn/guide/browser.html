<!doctype html><html lang="cn"><meta charset="utf-8"><title>浏览器模式 | 指南</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="浏览器模式-badge-typewarning实验性badge"><h1 id="浏览器模式-badge-typewarning实验性badge">浏览器模式<badge type="warning">实验性</badge></h1><p>此页面提供有关 Vitest API 中实验性浏览器模式功能的信息，该功能允许你在浏览器中本地运行测试，提供对窗口和文档等浏览器全局变量的访问。此功能目前正在开发中，API 未来可能会更改。<section class="level2"aria-labelledby="如何产生的"><h2 id="如何产生的">如何产生的？</h2><p>我们开发了 Vitest 浏览器模式功能，以帮助改进测试工作流程并实现更准确、可靠的测试结果。这个实验性的测试 API 增加了在本地浏览器环境中运行测试的功能。在本节中，我们将探讨这个功能背后的动机以及它对测试的好处。<section class="level3"aria-labelledby="不同的测试方式"><h3 id="不同的测试方式">不同的测试方式</h3><p>有不同的方法来测试 JavaScript 代码。一些测试框架在 Node.js 中模拟浏览器环境，而其他框架则在真实浏览器中运行测试。在这种情况下，<a href="https://www.npmjs.com/package/jsdom">jsdom</a> 是一个模拟浏览器环境的规范实现，可以与 Jest 或 Vitest 等测试运行器一起使用，而其他测试工具，如 <a href="https://webdriver.io/">WebdriverIO</a> 或 <a href="https://www.cypress.io/">Cypress</a> 则允许开发人员在真实浏览器中测试他们的应用程序，或者在 <a href="https://playwright.dev/">Playwright</a> 的情况下提供一个浏览器引擎。</section><section class="level3"aria-labelledby="模拟警告"><h3 id="模拟警告">模拟警告</h3><p>在模拟环境（如 jsdom 或 happy-dom）中测试 JavaScript 程序简化了测试设置并提供了易于使用的 API，使它们适用于许多项目并增加了对测试结果的信心。然而，需要牢记的是，这些工具仅模拟浏览器环境而不是实际浏览器，这可能导致模拟环境和真实环境之间存在一些差异。因此，测试结果可能会出现误报或漏报。<p>为了在测试中获得最高的水平，测试在真实浏览器环境中进行非常重要。这就是为什么我们开发了 Vitest 的浏览器模式功能，允许开发人员在浏览器中本地运行测试，并获得更准确、可靠的测试结果。通过浏览器级别的测试，开发人员可以更加自信地确保他们的应用程序在真实场景中能够按照预期工作。</section></section><section class="level2"aria-labelledby="缺点"><h2 id="缺点">缺点</h2><p>使用 Vitest 浏览器时，重要的是要考虑以下缺点：<section class="level3"aria-labelledby="早期发展"><h3 id="早期发展">早期发展</h3><p>Vitest 的浏览器模式功能目前仍处于早期开发阶段，因此可能尚未完全优化，也可能存在一些未解决的错误或问题。为了获得更好的测试结果，我们建议用户使用独立的浏览器端测试运行程序（如 WebdriverIO、Cypress 或 Playwright）来增强他们的 Vitest 浏览器体验。</section><section class="level3"aria-labelledby="更长的初始化时间"><h3 id="更长的初始化时间">更长的初始化时间</h3><p>Vitest 浏览器在初始化过程中需要启动提供程序和浏览器，这可能需要一些时间。与其他测试模式相比，这可能导致更长的初始化时间。</section></section><section class="level2"aria-labelledby="配置"><h2 id="配置">配置</h2><p>要在 Vitest 配置中激活浏览器模式，你可以使用 <code>--browser</code> 标志或在你的 Vitest 配置文件中将 <code>browser.enabled</code> 字段设置为 <code>true</code>。这是使用浏览器字段的示例配置：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    browser<span class="token operator">:</span> <span class="token punctuation">{</span>
      enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">'chrome'</span><span class="token punctuation">,</span> <span class="token comment">// browser name is required</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="浏览器选项类型"><h2 id="浏览器选项类型">浏览器选项类型</h2><p>Vitest 中的浏览器选项取决于提供者。如果你传递 <code>--browser</code> 并且未在配置文件中指定其名称，Vitest 将失败。可用选项：<ul><li><code>webdriverio</code> (默认) 支持以下浏览器:<ul><li><code>firefox</code><li><code>chrome</code><li><code>edge</code><li><code>safari</code></ul><li><code>playwright</code> 支持以下浏览器:<ul><li><code>firefox</code><li><code>webkit</code><li><code>chromium</code></ul></ul></section><section class="level2"aria-labelledby="跨浏览器测试"><h2 id="跨浏览器测试">跨浏览器测试</h2><p>当你在浏览器选项中指定浏览器名称时，Vitest 将默认尝试使用 <a href="https://webdriver.io/">WebdriverIO</a> 运行指定的浏览器，然后在那里运行测试。此功能使跨浏览器测试易于在 CI 等环境中使用和配置。如果不想使用 WebdriverIO，可以使用 <code>browser.provider</code> 选项配置自定义浏览器提供程序。<p>要使用 CLI 指定浏览器，请使用 <code>--browser</code> 标志后跟浏览器名称，如下所示：<pre class="language-sh"><code class="language-sh">npx vitest --browser=chrome</code></pre><p>或者你可以使用点符号向 CLI 提供浏览器选项：<pre class="language-sh"><code class="language-sh">npx vitest --browser.name=chrome --browser.headless</code></pre><blockquote>NOTE 当使用带有 WebdriverIO 的 Safari 浏览器选项时，需要通过在你的设备上运行 `sudo safaridriver --enable` 来激活`safaridriver`。<p>此外，在运行测试时，Vitest 将尝试安装一些驱动程序用于兼容 <code>safaridriver</code>。</blockquote></section><section class="level2"aria-labelledby="headless"><h2 id="headless">Headless</h2><p>headless 模式是浏览器模式下可用的另一个选项。在 headless 模式下，浏览器在没有用户界面的情况下在后台运行，这对于运行自动化测试非常有用。Vitest 中的 headless 选项可以设置为布尔值以启用或禁用 headless 模式。<p>这是启用 headless 模式的示例配置：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    browser<span class="token operator">:</span> <span class="token punctuation">{</span>
      enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      headless<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>你还可以在 CLI 中使用 <code>--browser.headless</code> 标志设置 headless 模式，如下所示：<pre class="language-sh"><code class="language-sh">npx vitest --browser.name=chrome --browser.headless</code></pre><p>在这种情况下，Vitest 将使用 Chrome 浏览器以 headless 模式运行。</section><section class="level2"aria-labelledby="限制"><h2 id="限制">限制</h2><section class="level3"aria-labelledby="线程阻塞对话框"><h3 id="线程阻塞对话框">线程阻塞对话框</h3><p>使用 Vitest 浏览器时，需要注意的是像 <code>alert</code> 或 <code>confirm</code> 这样的线程阻塞对话框不能在本地使用。这是因为它们阻塞了网页，这意味着 Vitest 无法继续与该页面通信，导致执行挂起。<p>在这种情况下，Vitest 为这些 API 提供默认模拟和默认返回值。这确保如果用户不小心使用了同步弹出式 Web API，执行不会挂起。但是，仍然建议用户模拟这些 Web API 以获得更好的体验。在 <a href="/guide/mocking">Mocking</a> 中阅读更多内容。 <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section></section>