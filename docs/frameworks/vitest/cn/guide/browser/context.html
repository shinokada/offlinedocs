<!doctype html><html lang="cn"><meta charset="utf-8"><title>Context API | Browser Mode</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="上下文"><h1 id="上下文">上下文</h1><p>Vitest 通过 <code>@vitest/browser/context</code> 入口点公开上下文模块。从 2.0 开始，它公开了一小部分实用程序，这些实用程序可能在测试中对你有用。<section class="level2"aria-labelledby="userevent"><h2 id="userevent"><code>userEvent</code></h2><blockquote>`userEvent` API 的详细说明见[Interactivity API](/guide/browser/interactivity-api).</blockquote><pre class="language-ts"><code class="language-ts"><span class="token doc-comment comment">/**
 * Handler for user interactions. The support is implemented by the browser provider (`playwright` or `webdriverio`).
 * If used with `preview` provider, fallbacks to simulated events via `@testing-library/user-event`.
 * <span class="token keyword">@experimental</span>
 */</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> userEvent<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">setup</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token maybe-class-name">UserEvent</span>
  <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token punctuation">(</span>element<span class="token operator">:</span> <span class="token maybe-class-name">Element</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">UserEventClickOptions</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span>
  <span class="token function-variable function">dblClick</span><span class="token operator">:</span> <span class="token punctuation">(</span>element<span class="token operator">:</span> <span class="token maybe-class-name">Element</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">UserEventDoubleClickOptions</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span>
  <span class="token function-variable function">tripleClick</span><span class="token operator">:</span> <span class="token punctuation">(</span>element<span class="token operator">:</span> <span class="token maybe-class-name">Element</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">UserEventTripleClickOptions</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span>
  <span class="token function-variable function">selectOptions</span><span class="token operator">:</span> <span class="token punctuation">(</span>
    element<span class="token operator">:</span> <span class="token maybe-class-name">Element</span><span class="token punctuation">,</span>
    values<span class="token operator">:</span> <span class="token maybe-class-name">HTMLElement</span> <span class="token operator">|</span> <span class="token maybe-class-name">HTMLElement</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">UserEventSelectOptions</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span>
  <span class="token function-variable function">keyboard</span><span class="token operator">:</span> <span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span>
  <span class="token function-variable function">type</span><span class="token operator">:</span> <span class="token punctuation">(</span>element<span class="token operator">:</span> <span class="token maybe-class-name">Element</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">UserEventTypeOptions</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span>
  <span class="token function-variable function">clear</span><span class="token operator">:</span> <span class="token punctuation">(</span>element<span class="token operator">:</span> <span class="token maybe-class-name">Element</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span>
  <span class="token function-variable function">tab</span><span class="token operator">:</span> <span class="token punctuation">(</span>options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">UserEventTabOptions</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span>
  <span class="token function-variable function">hover</span><span class="token operator">:</span> <span class="token punctuation">(</span>element<span class="token operator">:</span> <span class="token maybe-class-name">Element</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">UserEventHoverOptions</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span>
  <span class="token function-variable function">unhover</span><span class="token operator">:</span> <span class="token punctuation">(</span>element<span class="token operator">:</span> <span class="token maybe-class-name">Element</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">UserEventHoverOptions</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span>
  <span class="token function-variable function">fill</span><span class="token operator">:</span> <span class="token punctuation">(</span>element<span class="token operator">:</span> <span class="token maybe-class-name">Element</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">UserEventFillOptions</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span>
  <span class="token function-variable function">dragAndDrop</span><span class="token operator">:</span> <span class="token punctuation">(</span>source<span class="token operator">:</span> <span class="token maybe-class-name">Element</span><span class="token punctuation">,</span> target<span class="token operator">:</span> <span class="token maybe-class-name">Element</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">UserEventDragAndDropOptions</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span>
<span class="token punctuation">}</span></code></pre></section><section class="level2"aria-labelledby="commands"><h2 id="commands"><code>commands</code></h2><blockquote>Commands API 的详细说明见[Commands API](/guide/browser/commands).</blockquote><pre class="language-ts"><code class="language-ts"><span class="token doc-comment comment">/**
 * Available commands for the browser.
 * A shortcut to `server.commands`.
 */</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> commands<span class="token operator">:</span> <span class="token maybe-class-name">BrowserCommands</span></code></pre></section><section class="level2"aria-labelledby="page"><h2 id="page"><code>page</code></h2><p>页面导出提供了与当前页面交互的实用程序。<blockquote>虽然它从 Playwright 的 `page` 中获取了一些实用程序，但它与 Playwright 的 `page` 并不是同一个对象。由于浏览器上下文是在浏览器中评估的，您的测试无法访问 Playwright 的 `page`，因为它是在服务器上运行的。</blockquote><p>使用 <a href="/guide/browser/commands">Commands API</a> 如果您需要访问 Playwright 的 <code>page</code> 对象。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">export</span> <span class="token keyword">const</span> page<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * Change the size of iframe's viewport.
   */</span>
  <span class="token function">viewport</span><span class="token punctuation">(</span>width<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span>
  <span class="token doc-comment comment">/**
   * Make a screenshot of the test iframe or a specific element.
   * <span class="token keyword">@returns</span> Path to the screenshot file or path and base64.
   */</span>
  <span class="token function">screenshot</span><span class="token punctuation">(</span>options<span class="token operator">:</span> <span class="token maybe-class-name">Omit</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ScreenshotOptions</span><span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token operator">></span> <span class="token operator">&#x26;</span> <span class="token punctuation">{</span> base64<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token builtin">string</span>
    base64<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token punctuation">}</span><span class="token operator">></span>
  <span class="token function">screenshot</span><span class="token punctuation">(</span>options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">ScreenshotOptions</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token operator">></span>
  <span class="token doc-comment comment">/**
   * Extend default `page` object with custom methods.
   */</span>
  <span class="token function">extend</span><span class="token punctuation">(</span>methods<span class="token operator">:</span> <span class="token maybe-class-name">Partial</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">BrowserPage</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">BrowserPage</span>
  <span class="token doc-comment comment">/**
   * Wrap an HTML element in a `Locator`. When querying for elements, the search will always return this element.
   */</span>
  <span class="token function">elementLocator</span><span class="token punctuation">(</span>element<span class="token operator">:</span> <span class="token maybe-class-name">Element</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Locator</span>

  <span class="token doc-comment comment">/**
   * Locator APIs. See its documentation for more details.
   */</span>
  <span class="token function">getByRole</span><span class="token punctuation">(</span>role<span class="token operator">:</span> <span class="token maybe-class-name">ARIARole</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LocatorByRoleOptions</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Locator</span>
  <span class="token function">getByLabelText</span><span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token known-class-name class-name">RegExp</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LocatorOptions</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Locator</span>
  <span class="token function">getByTestId</span><span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token known-class-name class-name">RegExp</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Locator</span>
  <span class="token function">getByAltText</span><span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token known-class-name class-name">RegExp</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LocatorOptions</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Locator</span>
  <span class="token function">getByPlaceholder</span><span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token known-class-name class-name">RegExp</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LocatorOptions</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Locator</span>
  <span class="token function">getByText</span><span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token known-class-name class-name">RegExp</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LocatorOptions</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Locator</span>
  <span class="token function">getByTitle</span><span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token known-class-name class-name">RegExp</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">LocatorOptions</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Locator</span>
<span class="token punctuation">}</span></code></pre><blockquote>The `getBy*` API is explained at [Locators API](/guide/browser/locators).</blockquote></section><section class="level2"aria-labelledby="cdp"><h2 id="cdp"><code>cdp</code></h2><p><code>cdp</code> 导出返回当前的 Chrome DevTools 协议会话。它主要用于库作者在其基础上构建工具。<blockquote>CDP 会话仅适用于 `playwright` provider，并且仅在使用 `chromium` 浏览器时有效。有关详细信息，请参阅 playwright 的 [`CDPSession`](https://playwright.dev/docs/api/class-cdpsession)文档。</blockquote><pre class="language-ts"><code class="language-ts"><span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">cdp</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token maybe-class-name">CDPSession</span></code></pre></section><section class="level2"aria-labelledby="server"><h2 id="server"><code>server</code></h2><p><code>server</code> 导出表示运行 Vitest 服务器的 Node.js 环境。它主要用于调试或根据环境限制测试。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">export</span> <span class="token keyword">const</span> server<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * Vitest 服务运行的平台。
   * 与在服务上调用 `process.platform` 相同。
   */</span>
  platform<span class="token operator">:</span> <span class="token maybe-class-name">Platform</span>
  <span class="token doc-comment comment">/**
   * Vitest 服务的运行版本。
   * 与在服务上调用 `process.version` 相同。
   */</span>
  version<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token doc-comment comment">/**
   *  browser provider 的名字.
   */</span>
  provider<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token doc-comment comment">/**
   * 当前浏览器的名字。
   */</span>
  browser<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token doc-comment comment">/**
   * 浏览器的可用命令。
   */</span>
  commands<span class="token operator">:</span> <span class="token maybe-class-name">BrowserCommands</span>
  <span class="token doc-comment comment">/**
   * 序列化测试配置。
   */</span>
  config<span class="token operator">:</span> <span class="token maybe-class-name">SerializedConfig</span>
<span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section>