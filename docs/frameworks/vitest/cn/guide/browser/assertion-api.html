<!doctype html><html lang="cn"><meta charset="utf-8"><title>Assertion API | Browser Mode</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="assertion-api"><h1 id="assertion-api">Assertion API</h1><p>Vitest 捆绑了 <a href="https://github.com/testing-library/jest-dom"><code>@testing-library/jest-dom</code></a>库，以提供各种开箱即用的 DOM 断言。有关详细文档，请阅读 <code>jest-dom</code> readme：<ul><li><a href="https://github.com/testing-library/jest-dom#toBeDisabled"><code>toBeDisabled</code></a><li><a href="https://github.com/testing-library/jest-dom#toBeEnabled"><code>toBeEnabled</code></a><li><a href="https://github.com/testing-library/jest-dom#toBeEmptyDOMElement"><code>toBeEmptyDOMElement</code></a><li><a href="https://github.com/testing-library/jest-dom#toBeInTheDocument"><code>toBeInTheDocument</code></a><li><a href="https://github.com/testing-library/jest-dom#toBeInvalid"><code>toBeInvalid</code></a><li><a href="https://github.com/testing-library/jest-dom#toBeRequired"><code>toBeRequired</code></a><li><a href="https://github.com/testing-library/jest-dom#toBeValid"><code>toBeValid</code></a><li><a href="https://github.com/testing-library/jest-dom#toBeVisible"><code>toBeVisible</code></a><li><a href="https://github.com/testing-library/jest-dom#toContainElement"><code>toContainElement</code></a><li><a href="https://github.com/testing-library/jest-dom#toContainHTML"><code>toContainHTML</code></a><li><a href="https://github.com/testing-library/jest-dom#toHaveAccessibleDescription"><code>toHaveAccessibleDescription</code></a><li><a href="https://github.com/testing-library/jest-dom#toHaveAccessibleErrorMessage"><code>toHaveAccessibleErrorMessage</code></a><li><a href="https://github.com/testing-library/jest-dom#toHaveAccessibleName"><code>toHaveAccessibleName</code></a><li><a href="https://github.com/testing-library/jest-dom#toHaveAttribute"><code>toHaveAttribute</code></a><li><a href="https://github.com/testing-library/jest-dom#toHaveClass"><code>toHaveClass</code></a><li><a href="https://github.com/testing-library/jest-dom#toHaveFocus"><code>toHaveFocus</code></a><li><a href="https://github.com/testing-library/jest-dom#toHaveFormValues"><code>toHaveFormValues</code></a><li><a href="https://github.com/testing-library/jest-dom#toHaveStyle"><code>toHaveStyle</code></a><li><a href="https://github.com/testing-library/jest-dom#toHaveTextContent"><code>toHaveTextContent</code></a><li><a href="https://github.com/testing-library/jest-dom#toHaveValue"><code>toHaveValue</code></a><li><a href="https://github.com/testing-library/jest-dom#toHaveDisplayValue"><code>toHaveDisplayValue</code></a><li><a href="https://github.com/testing-library/jest-dom#toBeChecked"><code>toBeChecked</code></a><li><a href="https://github.com/testing-library/jest-dom#toBePartiallyChecked"><code>toBePartiallyChecked</code></a><li><a href="https://github.com/testing-library/jest-dom#toHaveRole"><code>toHaveRole</code></a><li><a href="https://github.com/testing-library/jest-dom#toHaveErrorMessage"><code>toHaveErrorMessage</code></a></ul><p>如果使用 TypeScript 或希望在 <code>expect</code> 中获得正确的类型提示，请确保根据使用的提供程序，在 <code>tsconfig</code> 中指定了 <code>@vitest/browser/providers/playwright</code> 或 <code>@vitest/browser/providers/webdriverio</code>。如果使用默认的 <code>preview</code> 提供程序，则可指定 <code>@vitest/browser/matchers</code> 代替。</p>code-group ```json [preview] { "compilerOptions": { "types": [ "@vitest/browser/matchers" ] } } ``` ```json [playwright] { "compilerOptions": { "types": [ "@vitest/browser/providers/playwright" ] } } ``` ```json [webdriverio] { "compilerOptions": { "types": [ "@vitest/browser/providers/webdriverio" ] } } ```<p>浏览器中的测试由于其异步特性，可能会不一致地失败。因此，即使条件延迟（如超时、网络请求或动画），也必须有办法保证断言成功。为此，Vitest 通过 <a href="/api/expect#poll"><code>expect.poll</code></a>和 <code>expect.element</code> API 提供了可重试的断言：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> page <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@vitest/browser/context'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'error banner is rendered'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">triggerError</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// @testing-library 提供内置重试功能的查询</span>
  <span class="token comment">// 它会尝试找到 banner，直到它渲染出来</span>
  <span class="token keyword">const</span> banner <span class="token operator">=</span> <span class="token keyword control-flow">await</span> page<span class="token punctuation">.</span><span class="token method function property-access">getByRole</span><span class="token punctuation">(</span><span class="token string">'alert'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">error</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// Vitest 提供内置重试功能的 `expect.element`</span>
  <span class="token comment">// 它会检查 `element.textContent` 直到等于 “Error!”。</span>
  <span class="token keyword control-flow">await</span> expect<span class="token punctuation">.</span><span class="token method function property-access">element</span><span class="token punctuation">(</span>banner<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveTextContent</span><span class="token punctuation">(</span><span class="token string">'Error!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>`expect.element` 是 `expect.poll(() => element)`的简写，工作方式完全相同。<p><code>toHaveTextContent</code> 和所有其他 <a href="https://github.com/testing-library/jest-dom"><code>@testing-library/jest-dom</code></a>断言在没有内置重试机制的常规<code>expect</code>中仍然可用：<pre class="language-ts"><code class="language-ts"><span class="token comment">// 如果 .textContent 不是 `'Error!'`，则会立即失败。</span>
<span class="token function">expect</span><span class="token punctuation">(</span>banner<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveTextContent</span><span class="token punctuation">(</span><span class="token string">'Error!'</span><span class="token punctuation">)</span></code></pre></blockquote><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section>