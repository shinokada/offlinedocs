<!doctype html><html lang="cn"><meta charset="utf-8"><title>主要功能 | 指南</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="outline"content="deep"><link rel="stylesheet"type="text/css"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="主要功能"><h1 id="主要功能">主要功能</h1><featureslist class="!gap-1 text-lg"><section class="level2"aria-labelledby="一套配置可以运用在多种环境"><h2 id="一套配置可以运用在多种环境">一套配置可以运用在多种环境</h2><div h-2=""><courselink href="https://vueschool.io/lessons/your-first-test?friend=vueuse">通过视频了解如何编写你的第一个测试</courselink><p>与 Vite 的配置、转换器、解析器和插件通用，将会使用应用中的相同配置来运行测试。<p>了解更多信息 <a href="../guide.html#%E9%85%8D%E7%BD%AE-vitest">配置 Vitest</a></div></section><section class="level2"aria-labelledby="监听模式watch-mode"><h2 id="监听模式watch-mode">监听模式(watch mode)</h2><pre class="language-bash"><code class="language-bash">$ vitest</code></pre><p>当你修改源代码或测试文件时，Vitest 智能搜索模块依赖树并只重新运行相关测试，<a href="https://twitter.com/antfu7/status/1468233216939245579">就像 HMR 在 Vite 中的工作方式一样!</a><p><code>vitest</code> <strong>在开发环境下默认</strong> 启动时使用 <code>监听模式</code>，在 CI 环境（当 <code>process.env.CI</code> 出现时）中以 <code>运行模式(run mode)</code> 启动。你可以使用 <code>vitest watch</code> 或 <code>vitest run</code> 明确指定所需的模式。<p>使用 <code>--standalone</code> 标志启动 Vitest，使其在后台运行。它不会运行任何测试，直到测试发生变化。如果源代码发生变化，Vitest 不会运行测试，直到运行了导入源代码的测试为止</section><section class="level2"aria-labelledby="开箱即用的常见-web-支持"><h2 id="开箱即用的常见-web-支持">开箱即用的常见 Web 支持</h2><p>开箱即用的 ES Module / TypeScript / JSX support / PostCSS</section><section class="level2"aria-labelledby="多线程"><h2 id="多线程">多线程</h2><p>默认情况下，Vitest 通过 <a href="https://github.com/tinylibs/tinypool">Tinypool</a>（<a href="https://github.com/piscinajs/piscina">Piscina</a> 的轻量级分叉）使用 <a href="https://nodejs.org/api/child_process.html"><code>node:child_process</code></a>，在多个进程中运行测试文件，允许测试同时运行。如果想进一步加快测试套件的速度，可以考虑启用 <code>--pool=threads</code>，使用 <a href="https://nodejs.org/api/worker_threads.html"><code>node:worker_threads</code></a>来运行测试（注意，某些软件包可能无法使用此设置）。<p>要在单个线程或进程中运行测试，查看 <a href="../config.html#pooloptions"><code>poolOptions</code></a> 了解更多消息。<p>Vitest 还隔离了每个测试文件的运行环境，因此一个文件中的运行环境改变不会影响其他文件。可以通过将 <code>--no-isolate</code> 传递给 CLI 来禁用隔离（以正确性换取运行性能）。</section><section class="level2"aria-labelledby="测试可过滤"><h2 id="测试可过滤">测试可过滤</h2><p>Vitest 提供了许多缩小测试范围的方法，以便在开发过程中加快速度并集中精力。<p>了解更多信息 <a href="guide/filtering">测试筛选</a></section><section class="level2"aria-labelledby="同时运行多个测试"><h2 id="同时运行多个测试">同时运行多个测试</h2><p>在连续的测试中使用 <code>.concurrent</code> 来并行运行它们。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token comment">// The two tests marked with concurrent will be started in parallel</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'serial test'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  it<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  it<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'concurrent test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>如果在测试套件中使用 <code>.concurrent</code>，则其中的每个测试用例都将并发运行。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token comment">// All tests within this suite will be started in parallel</span>
describe<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'concurrent test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  it<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'concurrent test 3'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>你还可以将 <code>.skip</code>、<code>.only</code> 和 <code>.todo</code> 用于并发测试套件和测试用例。<p>了解更多信息 <a href="../api/#concurrent">API 索引</a><blockquote>在异步并发测试中使用快照时，由于 JavaScript 的限制，你需要使用 [测试环境](/guide/test-context) 中的 `expect` 来确保检测到正确的测试。</blockquote></section><section class="level2"aria-labelledby="快照"><h2 id="快照">快照</h2><p>兼容 <a href="https://jestjs.io/zh-Hans/docs/snapshot-testing">Jest 快照测试</a> 功能。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> it <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders correctly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>了解更多信息 <a href="/guide/snapshot">快照</a></section><section class="level2"aria-labelledby="chai-和-jest-的-expect-语法兼容"><h2 id="chai-和-jest-的-expect-语法兼容">Chai 和 Jest 的 <code>expect</code> 语法兼容</h2><p>内置 <a href="https://www.chaijs.com/">Chai</a> 进行断言和与 <a href="https://jestjs.io/docs/expect">Jest expect</a> 兼容的 APIs<p>注意，如果你正在使用添加匹配器的第三方库，将 <a href="../config.html#globals"><code>test.globals</code></a> 设置为 <code>true</code> 将提供更好的兼容性。</section><section class="level2"aria-labelledby="对象模拟mocking"><h2 id="对象模拟mocking">对象模拟(Mocking)</h2><p>内置 <a href="https://github.com/tinylibs/tinyspy">Tinyspy</a> 用于在 <code>vi</code> 对象上使用 <code>jest</code> 兼容的 API 进行对象模拟。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword">const</span> fn <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>vi<span class="token punctuation">.</span><span class="token method function property-access">isMockFunction</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>fn<span class="token punctuation">.</span><span class="token property-access">mock</span><span class="token punctuation">.</span><span class="token property-access">calls</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

fn<span class="token punctuation">.</span><span class="token method function property-access">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> arg<span class="token punctuation">)</span>

<span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>fn<span class="token punctuation">.</span><span class="token property-access">mock</span><span class="token punctuation">.</span><span class="token property-access">results</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span></code></pre><p>Vitest 支持 <a href="https://github.com/capricorn86/happy-dom">happy-dom</a> 或 <a href="https://github.com/jsdom/jsdom">jsdom</a> 来模拟 DOM 和浏览器 API。Vitest 并不内置它们，所以你可能需要安装：<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i -D happy-dom
<span class="token comment"># or</span>
$ <span class="token function">npm</span> i -D jsdom</code></pre><p>然后，更改 <code>environment</code> 配置文件中的选项：<pre class="language-ts"><code class="language-ts"><span class="token comment">// vitest.config.ts</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest/config'</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    environment<span class="token operator">:</span> <span class="token string">'happy-dom'</span><span class="token punctuation">,</span> <span class="token comment">// or 'jsdom', 'node'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>了解更多信息 <a href="/guide/mocking">模拟对象</a></section><section class="level2"aria-labelledby="测试覆盖率"><h2 id="测试覆盖率">测试覆盖率</h2><p>Vitest 通过 <a href="https://v8.dev/blog/javascript-code-coverage"><code>v8</code></a> 支持原生代码覆盖率，通过 <a href="https://istanbul.js.org/"><code>istanbul</code></a> 支持检测代码覆盖率。<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"vitest"</span><span class="token punctuation">,</span>
    <span class="token property">"coverage"</span><span class="token operator">:</span> <span class="token string">"vitest run --coverage"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>可以在配置文件中设置 <code>test.coverage</code> 选项来配置它：<pre class="language-ts"><code class="language-ts"><span class="token comment">// vite.config.ts</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest/config'</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    coverage<span class="token operator">:</span> <span class="token punctuation">{</span>
      reporter<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token string">'json'</span><span class="token punctuation">,</span> <span class="token string">'html'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>了解更多信息 <a href="/guide/coverage">测试覆盖率</a></section><section class="level2"aria-labelledby="源码内联测试"><h2 id="源码内联测试">源码内联测试</h2><p>Vitest 还提供了一种方式，可以运行与你的代码实现放在一起的测试，类似 <a href="https://doc.rust-lang.org/book/ch11-03-test-organization.html#the-tests-module-and-cfgtest">Rust's 模块测试</a>.<p>这使得测试与实现共享相同的闭包，并且能够在不导出的情况下针对私有状态进行测试。同时，它也使开发更加接近反馈循环。<pre class="language-ts"><code class="language-ts"><span class="token comment">// src/index.ts</span>
<span class="token comment">// the implementation</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token spread operator">...</span>args<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> args<span class="token punctuation">.</span><span class="token method function property-access">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> a <span class="token operator">+</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// in-source test suites</span>
<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">vitest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> it<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">vitest</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><p>了解更多信息 <a href="/guide/in-source">源码内联测试</a></section><section class="level2"aria-labelledby="基准测试-实验性-benchmarking"><h2 id="基准测试-实验性-benchmarking">基准测试<badge type="warning">实验性</badge>{#benchmarking}</h2><p>你可以使用 <a href="../api.html#bench"><code>bench</code></a> 运行基准测试通过 <a href="https://github.com/tinylibs/tinybench">Tinybench</a> 函数来比较基准测试结果。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench<span class="token punctuation">,</span> describe <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'sort'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">'normal'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
    x<span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">'reverse'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
    x<span class="token punctuation">.</span><span class="token method function property-access">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><img alt="Benchmark report"img-dark=""src="https://github.com/vitest-dev/vitest/assets/4232207/6f0383ea-38ba-4f14-8a05-ab243afea01d"> <img alt="Benchmark report"img-light=""src="https://github.com/vitest-dev/vitest/assets/4232207/efbcb427-ecf1-4882-88de-210cd73415f6"></section><section class="level2"aria-labelledby="类型测试-实验性-type-testing"><h2 id="类型测试-实验性-type-testing">类型测试<badge type="warning">实验性</badge>{#type-testing}</h2><p>你可以 <a href="/guide/testing-types">编写测试</a> 来捕获类型回归。 Vitest 附带 <a href="https://github.com/mmkal/expect-type"><code>expect-type</code></a> 包，为你提供类似且易于理解的 API。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assertType<span class="token punctuation">,</span> expectTypeOf<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> mount <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./mount.js'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'my types work properly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expectTypeOf</span><span class="token punctuation">(</span>mount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expectTypeOf</span><span class="token punctuation">(</span>mount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">parameter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">toMatchTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// @ts-expect-error name is a string</span>
  <span class="token function">assertType</span><span class="token punctuation">(</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="分片"><h2 id="分片">分片</h2><p>使用 <a href="/guide/cli#shard"><code>--shard</code></a> 和 <a href="/guide/reporters#blob-reporter"><code>--reporter=blob</code></a>标志在不同的计算机上运行测试。可以使用 <code>--merge-reports</code> 命令在 CI 管道的末尾合并所有测试结果：<pre class="language-bash"><code class="language-bash">vitest --shard<span class="token operator">=</span><span class="token number">1</span>/2 --reporter<span class="token operator">=</span>blob
vitest --shard<span class="token operator">=</span><span class="token number">2</span>/2 --reporter<span class="token operator">=</span>blob
vitest --merge-reports --reporter<span class="token operator">=</span>junit --coverage.reporter<span class="token operator">=</span>text</code></pre><p>了解更多信息 <a href="/guide/improving-performance#sharding"><code>性能优化 | 分片</code></a></section><section class="level2"aria-labelledby="环境变量"><h2 id="环境变量">环境变量</h2><p>Vitest 只从 <code>.env</code> 文件中自动加载以 <code>VITE_</code> 为前缀的环境变量，以保持与前端相关测试的兼容性，并遵守 <a href="https://vitejs.dev/guide/env-and-mode.html#env-files">Vite 的既定惯例</a>。要从 <code>.env</code> 文件加载所有环境变量，可以使用从 <code>vite</code> 导入的 <code>loadEnv</code> 方法：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> loadEnv <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vite'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest/config'</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> mode <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// mode defines what ".env.{mode}" file to choose if exists</span>
    env<span class="token operator">:</span> <span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token method function property-access">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></featureslist></section>