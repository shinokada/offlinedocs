<!doctype html><html lang="cn"><meta charset="utf-8"><title>expect</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="expect"><h1 id="expect">expect</h1><p>以下类型在下面的类型签名中被使用。<pre class="language-ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">Awaitable</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token maybe-class-name">PromiseLike</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span></code></pre><p><code>expect</code> 用于创建断言。 在这种情况下， <code>assertions</code> 是可以调用来断言语句的函数。 Vitest 默认提供 <code>chai</code> 断言，并且还在 <code>chai</code> 之上构建了与 <code>Jest</code> 兼容的断言。<p>例如，此代码断言 <code>input</code> 值等于 <code>2</code>。 如果不是，assertions 将抛出错误，并且测试将失败。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>

<span class="token function">expect</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// chai API</span>
<span class="token function">expect</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// jest API</span></code></pre><p>从技术上讲，这个示例没有使用 <a href="../api.html#test"><code>test</code></a> 函数，因此在控制台中你将看到 Nodejs 错误而不是 Vitest 输出。 要了解更多关于 <code>test</code> 的信息，请阅读<a href="/api/">测试 API 参考</a>。<p>此外，<code>expect</code> 可以静态地使用来访问匹配器函数，稍后将会介绍。<blockquote>如果表达式没有类型错误，则 `expect` 对测试类型没有影响。 如果您想使用 Vitest 作为[类型检查器](/guide/testing-types)，请使用 [`expectTypeOf`](/api/expect-typeof) 或 [`assertType`](/api/assert-type) 。</blockquote><section class="level2"aria-labelledby="soft"><h2 id="soft">soft</h2><ul><li><strong>类型:</strong> <code>ExpectStatic &#x26; (actual: any) => Assertions</code></ul><p><code>expect.soft</code> 的功能与 <code>expect</code> 类似，但它不会在断言失败时终止测试执行，而是继续运行并将失败标记为测试失败。 测试过程中遇到的所有错误都会显示出来，直到测试完成。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'expect.soft test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  expect<span class="token punctuation">.</span><span class="token method function property-access">soft</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// mark the test as fail and continue</span>
  expect<span class="token punctuation">.</span><span class="token method function property-access">soft</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// mark the test as fail and continue</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// At the end of the test, the above errors will be output.</span></code></pre><p>它也可以与 <code>expect</code> 一起使用。 如果 <code>expect</code> 断言失败，测试将终止并显示所有错误。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'expect.soft test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  expect<span class="token punctuation">.</span><span class="token method function property-access">soft</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// mark the test as fail and continue</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// failed and terminate the test, all previous errors will be output</span>
  expect<span class="token punctuation">.</span><span class="token method function property-access">soft</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// do not run</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>`expect.soft` 只能在 [`test`](../api.html#test) 函数的内部使用。</blockquote></section><section class="level2"aria-labelledby="not"><h2 id="not">not</h2><p>使用 <code>not</code> 将否定该断言。 例如，此代码断言 <code>input</code> 值不等于 <code>2</code>。 如果相等，断言将抛出错误，测试将失败。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>

<span class="token function">expect</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// chai API</span>
<span class="token function">expect</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// jest API</span></code></pre></section><section class="level2"aria-labelledby="tobe"><h2 id="tobe">toBe</h2><ul><li><strong>类型:</strong> <code>(value: any) => Awaitable&#x3C;void></code></ul><p><code>toBe</code> 可用于断言基元是否相等或对象共享相同的引用。 它相当于调用 <code>expect(Object.is(3, 3)).toBe(true)</code> 。 如果对象不相同，但你想检查它们的结构是否相同，可以使用 <a href="#toequal"><code>toEqual</code></a>。<p>例如，下面的代码检查交易者是否有 13 个苹果。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> stock <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'apples'</span><span class="token punctuation">,</span>
  count<span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'stock has 13 apples'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>stock<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>stock<span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'stocks are the same'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> refStock <span class="token operator">=</span> stock <span class="token comment">// same reference</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>stock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>refStock<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>尽量不要将 <code>toBe</code> 与浮点数一起使用。 由于 JavaScript 对它们进行四舍五入，因此 <code>0.1 + 0.2</code> 并不严格是 <code>0.3</code> 。 要可靠地断言浮点数，请使用 <a href="#tobecloseto"><code>toBeCloseTo</code></a> 断言。</section><section class="level2"aria-labelledby="tobecloseto"><h2 id="tobecloseto">toBeCloseTo</h2><ul><li><strong>类型:</strong> <code>(value: number, numDigits?: number) => Awaitable&#x3C;void></code></ul><p>使用 <code>toBeCloseTo</code> 比较浮点数。可选的 <code>numDigits</code> 参数限制了小数点后要检查的位数。例如：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">fails</span><span class="token punctuation">(</span><span class="token string">'decimals are not equal in javascript'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">0.2</span> <span class="token operator">+</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span> <span class="token comment">// 0.2 + 0.1 is 0.30000000000000004</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'decimals are rounded to 5 after the point'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 0.2 + 0.1 is 0.30000 | "000000000004" removed</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">0.2</span> <span class="token operator">+</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeCloseTo</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token comment">// nothing from 0.30000000000000004 is removed</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">0.2</span> <span class="token operator">+</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeCloseTo</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tobedefined"><h2 id="tobedefined">toBeDefined</h2><ul><li><strong>类型:</strong> <code>() => Awaitable&#x3C;void></code></ul><p><code>toBeDefined</code> 断言值不等于 <code>undefined</code>。有用的用例是检查函数是否有返回任何内容。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">function</span> <span class="token function">getApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token number">3</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'function returned something'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeDefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tobeundefined"><h2 id="tobeundefined">toBeUndefined</h2><ul><li><strong>类型:</strong> <code>() => Awaitable&#x3C;void></code></ul><p>与 <code>toBeDefined</code> 相反，<code>toBeUndefined</code> 断言值 <em>is</em> 等于 <code>undefined</code>。有用的用例是检查函数是否没有返回任何东西。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">function</span> <span class="token function">getApplesFromStock</span><span class="token punctuation">(</span>stock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>stock <span class="token operator">===</span> <span class="token string">'Bill'</span><span class="token punctuation">)</span>
    <span class="token keyword control-flow">return</span> <span class="token number">13</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'mary doesn\'t have a stock'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getApplesFromStock</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeUndefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tobetruthy"><h2 id="tobetruthy">toBeTruthy</h2><ul><li><strong>类型:</strong> <code>() => Awaitable&#x3C;void></code></ul><p><code>toBeTruthy</code>断言值在转换为布尔值时为 true。如果你不关心值，只想知道它可以转换为<code>true</code>，这将非常有用。<p>例如，假设有以下代码，我们不关心 <code>stocks.getInfo</code> 的返回值 - 它可能是一个复杂对象、一个字符串或其他任何值。代码仍然可以正常工作。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Stocks</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stocks.js'</span>

<span class="token keyword">const</span> stocks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Stocks</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
stocks<span class="token punctuation">.</span><span class="token method function property-access">sync</span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span>
<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>stocks<span class="token punctuation">.</span><span class="token method function property-access">getInfo</span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  stocks<span class="token punctuation">.</span><span class="token method function property-access">sell</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token string">'Bill'</span><span class="token punctuation">)</span></code></pre><p>因此，如果要测试 <code>stocks.getInfo</code> 是否真实，可以这样写：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Stocks</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stocks.js'</span>

<span class="token keyword">const</span> stocks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Stocks</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'if we know Bill stock, sell apples to him'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  stocks<span class="token punctuation">.</span><span class="token method function property-access">sync</span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>stocks<span class="token punctuation">.</span><span class="token method function property-access">getInfo</span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>除了 <code>false</code>、<code>null</code>、<code>undefined</code>、<code>NaN</code>、<code>0</code>、<code>-0</code>、<code>0n</code>、<code>""</code> 和 <code>document.all</code> 以外，JavaScript 中的一切都是真实的。</section><section class="level2"aria-labelledby="tobefalsy"><h2 id="tobefalsy">toBeFalsy</h2><ul><li><strong>类型:</strong> <code>() => Awaitable&#x3C;void></code></ul><p><code>toBeFalsy</code> 断言值在转换为布尔值时为 false。如果你不关心值，只想知道它可以转换为<code>false</code>，这将非常有用。<p>例如，假设有以下代码，我们不关心 <code>stocks.stockFailed</code> 的返回值 - 它可能返回任何假值，但代码仍然可以正常工作。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Stocks</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stocks.js'</span>

<span class="token keyword">const</span> stocks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Stocks</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
stocks<span class="token punctuation">.</span><span class="token method function property-access">sync</span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span>
<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>stocks<span class="token punctuation">.</span><span class="token method function property-access">stockFailed</span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  stocks<span class="token punctuation">.</span><span class="token method function property-access">sell</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token string">'Bill'</span><span class="token punctuation">)</span></code></pre><p>因此，如果要测试<code>stocks.stockFailed</code>是否是虚假的，可以这样写：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Stocks</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stocks.js'</span>

<span class="token keyword">const</span> stocks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Stocks</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'if Bill stock hasn\'t failed, sell apples to him'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  stocks<span class="token punctuation">.</span><span class="token method function property-access">syncStocks</span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>stocks<span class="token punctuation">.</span><span class="token method function property-access">stockFailed</span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeFalsy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>除了 <code>false</code>、<code>null</code>、<code>undefined</code>、<code>NaN</code>、<code>0</code>、<code>-0</code>、<code>0n</code>、<code>""</code> 和 <code>document.all</code> 以外，JavaScript 中的一切都是真实的。</section><section class="level2"aria-labelledby="tobenull"><h2 id="tobenull">toBeNull</h2><ul><li><strong>类型:</strong> <code>() => Awaitable&#x3C;void></code></ul><p><code>toBeNull</code> 只是断言某些内容是否为 <code>null</code>。 <code>.toBe(null)</code> 的别名。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">function</span> <span class="token function">apples</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'we don\'t have apples'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">apples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tobenan"><h2 id="tobenan">toBeNaN</h2><ul><li><strong>类型:</strong> <code>() => Awaitable&#x3C;void></code></ul><p><code>toBeNaN</code> 简单地断言某些内容是否为 <code>NaN</code>。toBe(NaN)` 的别名。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">function</span> <span class="token function">getApplesCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  i<span class="token operator">++</span>
  <span class="token keyword control-flow">return</span> i <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token known-class-name class-name">Number</span><span class="token punctuation">.</span><span class="token number">NaN</span> <span class="token operator">:</span> i
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'getApplesCount has some unusual side effects...'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getApplesCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNaN</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getApplesCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNaN</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tobetypeof"><h2 id="tobetypeof">toBeTypeOf</h2><ul><li><strong>类型:</strong> <code>(c: 'bigint' | 'boolean' | 'function' | 'number' | 'object' | 'string' | 'symbol' | 'undefined') => Awaitable&#x3C;void></code></ul><p><code>toBeTypeOf</code> 断言实际值是否属于接收类型。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> actual <span class="token operator">=</span> <span class="token string">'stock'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'stock is type of string'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>actual<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeTypeOf</span><span class="token punctuation">(</span><span class="token string">'string'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tobeinstanceof"><h2 id="tobeinstanceof">toBeInstanceOf</h2><ul><li><strong>类型:</strong> <code>(c: any) => Awaitable&#x3C;void></code></ul><p><code>toBeInstanceOf</code> 断言实际值是否是接收类的实例。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Stocks</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stocks.js'</span>

<span class="token keyword">const</span> stocks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Stocks</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'stocks are instance of Stocks'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>stocks<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeInstanceOf</span><span class="token punctuation">(</span><span class="token maybe-class-name">Stocks</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tobegreaterthan"><h2 id="tobegreaterthan">toBeGreaterThan</h2><ul><li><strong>类型:</strong> <code>(n: number | bigint) => Awaitable&#x3C;void></code></ul><p><code>toBeGreaterThan</code> 断言实际值是否大于接收值。如果数值相等，则测试失败。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> getApples <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stocks.js'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'have more then 10 apples'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeGreaterThan</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tobegreaterthanorequal"><h2 id="tobegreaterthanorequal">toBeGreaterThanOrEqual</h2><ul><li><strong>类型:</strong> <code>(n: number | bigint) => Awaitable&#x3C;void></code></ul><p><code>toBeGreaterThanOrEqual</code> 断言实际值是否大于或等于接收值。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> getApples <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stocks.js'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'have 11 apples or more'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeGreaterThanOrEqual</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tobelessthan"><h2 id="tobelessthan">toBeLessThan</h2><ul><li><strong>类型:</strong> <code>(n: number | bigint) => Awaitable&#x3C;void></code></ul><p><code>toBeLessThan</code> 断言实际值是否小于接收值。如果数值相等，则测试失败。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> getApples <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stocks.js'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'have less then 20 apples'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeLessThan</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tobelessthanorequal"><h2 id="tobelessthanorequal">toBeLessThanOrEqual</h2><ul><li><strong>类型:</strong> <code>(n: number | bigint) => Awaitable&#x3C;void></code></ul><p><code>toBeLessThanOrEqual</code> 断言实际值小于接收值或等于接收值。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> getApples <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stocks.js'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'have 11 apples or less'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeLessThanOrEqual</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="toequal"><h2 id="toequal">toEqual</h2><ul><li><strong>类型:</strong> <code>(received: any) => Awaitable&#x3C;void></code></ul><p><code>toEqual</code> 断言实际值是否等于接收到的值，或者如果它是一个对象，则是否具有相同的结构（递归比较它们）。我们可以通过以下示例看到 <code>toEqual</code> 与 <a href="#tobe"><code>toBe</code></a> 之间的区别：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> stockBill <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'apples'</span><span class="token punctuation">,</span>
  count<span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> stockMary <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'apples'</span><span class="token punctuation">,</span>
  count<span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'stocks have the same properties'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>stockBill<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span>stockMary<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'stocks are not the same'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>stockBill<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>stockMary<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>不会对 `Error` 对象执行 _deep equality_ 。要测试是否抛出了错误，需要使用 [`toThrowError`](#tothrowerror)断言。</blockquote></section><section class="level2"aria-labelledby="tostrictequal"><h2 id="tostrictequal">toStrictEqual</h2><ul><li><strong>类型:</strong> <code>(received: any) => Awaitable&#x3C;void></code></ul><p><code>toStrictEqual</code> 断言实际值是否等于接收到的值，或者如果它是一个对象（递归地比较它们）并且具有相同的类型，则具有相同的结构。<p>与 <a href="#toequal"><code>.toEqual</code></a> 的区别：<ul><li>检查具有 <code>undefined</code> 属性的键。 例如 使用 <code>.toStrictEqual</code> 时， <code>{a: undefined, b: 2}</code> 与 <code>{b: 2}</code> 不匹配。<li>检查数组稀疏性。 例如 使用 <code>.toStrictEqual</code> 时， <code>[, 1]</code> 与 <code>[undefined, 1]</code> 不匹配。<li>检查对象类型是否相等。 例如 具有字段 <code>a</code> 和 <code>b</code> 的类实例不等于具有字段 <code>a</code> 和 <code>b</code> 的文字对象。</ul><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">Stock</span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">type</span> <span class="token operator">=</span> type
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'structurally the same, but semantically different'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Stock</span></span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'apples'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Stock</span></span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toStrictEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'apples'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tocontain"><h2 id="tocontain">toContain</h2><ul><li><strong>类型:</strong> <code>(received: string) => Awaitable&#x3C;void></code></ul><p><code>toContain</code> 断言实际值是否在数组中。<code>toContain</code> 还可以检查一个字符串是否是另一个字符串的子串。自 Vitest 1.0 起，如果我们需要在类似浏览器的环境中运行测试，此断言还可以检查类是否包含在 <code>classList</code> 中，或一个元素是否包含在另一个元素中。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> getAllFruits <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stocks.js'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'the fruit list contains orange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getAllFruits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toContain</span><span class="token punctuation">(</span><span class="token string">'orange'</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#el'</span><span class="token punctuation">)</span>
  <span class="token comment">// element has a class</span>
  <span class="token class-name">expect</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token property-access">classList</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toContain</span><span class="token punctuation">(</span><span class="token string">'flex'</span><span class="token punctuation">)</span>
  <span class="token comment">// element is inside another one</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#wrapper'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toContain</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tocontainequal"><h2 id="tocontainequal">toContainEqual</h2><ul><li><strong>类型:</strong> <code>(received: any) => Awaitable&#x3C;void></code></ul><p><code>toContainEqual</code> 断言数组中是否包含具有特定结构和值的项。 它在每个元素内部的工作方式类似于 <a href="#toequal"><code>toEqual</code></a>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> getFruitStock <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stocks.js'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'apple available'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getFruitStock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toContainEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> fruit<span class="token operator">:</span> <span class="token string">'apple'</span><span class="token punctuation">,</span> count<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tohavelength"><h2 id="tohavelength">toHaveLength</h2><ul><li><strong>类型:</strong> <code>(received: number) => Awaitable&#x3C;void></code></ul><p><code>toHaveLength</code> 断言对象是否具有 <code>.length</code> 属性，并且该属性设置为特定的数值。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'toHaveLength'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveLength</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveLength</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveLength</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// doesn't have .length of 3</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">{</span> length<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveLength</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tohaveproperty"><h2 id="tohaveproperty">toHaveProperty</h2><ul><li><strong>类型:</strong> <code>(key: any, received?: any) => Awaitable&#x3C;void></code></ul><p><code>toHaveProperty</code> 断言对象是否具有提供的引用 <code>key</code> 处的属性。<p>我们还可以提供一个可选的值参数，也称为深相等，就像 <code>toEqual</code> 匹配器一样，用于比较接收到的属性值。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> invoice <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'isActive'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string-property property">'P.O'</span><span class="token operator">:</span> <span class="token string">'12345'</span><span class="token punctuation">,</span>
  <span class="token string-property property">'customer'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    first_name<span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
    last_name<span class="token operator">:</span> <span class="token string">'Doe'</span><span class="token punctuation">,</span>
    <span class="token dom variable">location</span><span class="token operator">:</span> <span class="token string">'China'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">'total_amount'</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
  <span class="token string-property property">'items'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'apples'</span><span class="token punctuation">,</span>
      quantity<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'oranges'</span><span class="token punctuation">,</span>
      quantity<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'John Doe Invoice'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'isActive'</span><span class="token punctuation">)</span> <span class="token comment">// assert that the key exists</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'total_amount'</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span> <span class="token comment">// assert that the key exists and the value is equal</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'account'</span><span class="token punctuation">)</span> <span class="token comment">// assert that this key does not exist</span>

  <span class="token comment">// Deep referencing using dot notation</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'customer.first_name'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'customer.last_name'</span><span class="token punctuation">,</span> <span class="token string">'Doe'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'customer.location'</span><span class="token punctuation">,</span> <span class="token string">'India'</span><span class="token punctuation">)</span>

  <span class="token comment">// Deep referencing using an array containing the key</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'items[0].type'</span><span class="token punctuation">,</span> <span class="token string">'apples'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'items.0.type'</span><span class="token punctuation">,</span> <span class="token string">'apples'</span><span class="token punctuation">)</span> <span class="token comment">// dot notation also works</span>

  <span class="token comment">// Deep referencing using an array containing the keyPath</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'items'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'apples'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'items'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'apples'</span><span class="token punctuation">)</span> <span class="token comment">// string notation also works</span>

  <span class="token comment">// Wrap your key in an array to avoid the key from being parsed as a deep reference</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'P.O'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'12345'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tomatch"><h2 id="tomatch">toMatch</h2><ul><li><strong>类型:</strong> <code>(received: string | regexp) => Awaitable&#x3C;void></code></ul><p><code>toMatch</code> 断言字符串是否与正则表达式或字符串匹配。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'top fruits'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'top fruits include apple, orange and grape'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatch</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">apple</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'applefruits'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatch</span><span class="token punctuation">(</span><span class="token string">'fruit'</span><span class="token punctuation">)</span> <span class="token comment">// toMatch also accepts a string</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>如果错误消息中的值被截断得太厉害，可以在配置文件中增加 [chaiConfig.truncateThreshold](../config.html#chaiconfig-truncatethreshold)。</blockquote></section><section class="level2"aria-labelledby="tomatchobject"><h2 id="tomatchobject">toMatchObject</h2><ul><li><strong>类型:</strong> <code>(received: object | array) => Awaitable&#x3C;void></code></ul><p><code>toMatchObject</code> 断言对象是否匹配另一个对象的部分属性。<p>我们还可以传递一个对象数组。如果想要检查两个数组在元素数量上是否匹配，这将非常有用，与<code>arrayContaining</code>不同，后者允许接收到的数组中有额外的元素。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> johnInvoice <span class="token operator">=</span> <span class="token punctuation">{</span>
  isActive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  customer<span class="token operator">:</span> <span class="token punctuation">{</span>
    first_name<span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
    last_name<span class="token operator">:</span> <span class="token string">'Doe'</span><span class="token punctuation">,</span>
    <span class="token dom variable">location</span><span class="token operator">:</span> <span class="token string">'China'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  total_amount<span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
  items<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'apples'</span><span class="token punctuation">,</span>
      quantity<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'oranges'</span><span class="token punctuation">,</span>
      quantity<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> johnDetails <span class="token operator">=</span> <span class="token punctuation">{</span>
  customer<span class="token operator">:</span> <span class="token punctuation">{</span>
    first_name<span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
    last_name<span class="token operator">:</span> <span class="token string">'Doe'</span><span class="token punctuation">,</span>
    <span class="token dom variable">location</span><span class="token operator">:</span> <span class="token string">'China'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'invoice has john personal details'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>johnInvoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchObject</span><span class="token punctuation">(</span>johnDetails<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'the number of elements must match exactly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Assert that an array of object matches</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> baz<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchObject</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> baz<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tothrowerror"><h2 id="tothrowerror">toThrowError</h2><ul><li><p><strong>类型:</strong> <code>(received: any) => Awaitable&#x3C;void></code><li><p><strong>别名:</strong> <code>toThrow</code></ul><p><code>toThrowError</code> 断言函数在被调用时是否会抛出错误。<p>我们可以提供一个可选参数来测试是否抛出了特定的错误：<ul><li>正则表达式 (regular expression) ：错误消息与模式匹配<li>字符串 (string) ：错误消息包含子字符串</ul><blockquote>必须将代码包装在一个函数中，否则错误将无法被捕获，测试将失败。</blockquote><p>例如，如果我们想要测试 <code>getFruitStock('pineapples')</code> 是否会抛出错误，我们可以这样写：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">function</span> <span class="token function">getFruitStock</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'pineapples'</span><span class="token punctuation">)</span>
    <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span><span class="token punctuation">(</span><span class="token string">'Pineapples are not in stock'</span><span class="token punctuation">)</span>

  <span class="token comment">// Do some other stuff</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'throws on pineapples'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Test that the error message says "stock" somewhere: these are equivalent</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">getFruitStock</span><span class="token punctuation">(</span><span class="token string">'pineapples'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toThrowError</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">stock</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">getFruitStock</span><span class="token punctuation">(</span><span class="token string">'pineapples'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toThrowError</span><span class="token punctuation">(</span><span class="token string">'stock'</span><span class="token punctuation">)</span>

  <span class="token comment">// Test the exact error message</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">getFruitStock</span><span class="token punctuation">(</span><span class="token string">'pineapples'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toThrowError</span><span class="token punctuation">(</span>
    <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^Pineapples are not in stock$</span><span class="token regex-delimiter">/</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>要测试异步函数，请与 [rejects](#rejects) 结合使用。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getAsyncFruitStock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'empty'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'throws on pineapples'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">getAsyncFruitStock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">rejects</span><span class="token punctuation">.</span><span class="token method function property-access">toThrowError</span><span class="token punctuation">(</span><span class="token string">'empty'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></blockquote></section><section class="level2"aria-labelledby="tomatchsnapshot"><h2 id="tomatchsnapshot">toMatchSnapshot</h2><ul><li><strong>类型:</strong> <code>&#x3C;T>(shape?: Partial&#x3C;T> | string, message?: string) => void</code></ul><p>这样可以确保一个值与最近的快照匹配。<p>可以提供一个可选的 <code>hint</code> 字符串参数，它会附加到测试名称的末尾。尽管 Vitest 总是在快照名称的末尾附加一个数字，但简短的描述性提示可能比数字更有用，以区分单个 it 或 test 块中的多个快照。Vitest 会按名称在相应的 <code>.snap</code> 文件中对快照进行排序。<blockquote>当快照不匹配导致测试失败时，如果这种不匹配是预期的，我们可以按 `u` 键一次性更新快照。或者可以传递 `-u` 或 `--update` 命令行选项，使 Vitest 始终更新测试。</blockquote><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'matches snapshot'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Set</span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'snapshot'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>我们还可以提供一个对象的形状，如果我们只是测试对象的形状，而不需要它完全兼容：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'matches snapshot'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Set</span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'snapshot'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">any</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Set</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tomatchinlinesnapshot"><h2 id="tomatchinlinesnapshot">toMatchInlineSnapshot</h2><ul><li><strong>类型:</strong> <code>&#x3C;T>(shape?: Partial&#x3C;T> | string, snapshot?: string, message?: string) => void</code></ul><p>这样可以确保一个值与最近的快照匹配。<p>Vitest 将内联快照字符串参数添加并更新到测试文件中的匹配器（而不是外部的 <code>.snap</code> 文件）。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'matches inline snapshot'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Set</span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'snapshot'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token comment">// Vitest will update following content when updating the snapshot</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchInlineSnapshot</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    {
      "foo": Set {
        "bar",
        "snapshot",
      },
    }
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>我们还可以提供一个对象的形状，如果您只是测试对象的形状，而不需要它完全兼容：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'matches snapshot'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Set</span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'snapshot'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchInlineSnapshot</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> foo<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">any</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Set</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    {
      "foo": Any&#x3C;Set>,
    }
  </span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tomatchfilesnapshot"><h2 id="tomatchfilesnapshot">toMatchFileSnapshot</h2><ul><li><strong>类型:</strong> <code>&#x3C;T>(filepath: string, message?: string) => Promise&#x3C;void></code><li><strong>版本:</strong> 需要 Vitest 0.30.0 以上</ul><p>明确比较或更新快照与显式指定的文件内容（而不是 <code>.snap</code> 文件）。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> it <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'render basic'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">renderHTML</span><span class="token punctuation">(</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword control-flow">await</span> <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchFileSnapshot</span><span class="token punctuation">(</span><span class="token string">'./test/basic.output.html'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>请注意，由于文件系统操作是异步的，您需要在 <code>toMatchFileSnapshot()</code> 中使用 <code>await</code>。</section><section class="level2"aria-labelledby="tothrowerrormatchingsnapshot"><h2 id="tothrowerrormatchingsnapshot">toThrowErrorMatchingSnapshot</h2><ul><li><strong>类型:</strong> <code>(message?: string) => void</code></ul><p>与 <a href="#tomatchsnapshot"><code>toMatchSnapshot</code></a> 相同，但期望的值与 <a href="#tothrowerror"><code>toThrowError</code></a> 相同。</section><section class="level2"aria-labelledby="tothrowerrormatchinginlinesnapshot"><h2 id="tothrowerrormatchinginlinesnapshot">toThrowErrorMatchingInlineSnapshot</h2><ul><li><strong>类型:</strong> <code>(snapshot?: string, message?: string) => void</code></ul><p>与 <a href="#tomatchinlinesnapshot"><code>toMatchInlineSnapshot</code></a> 相同，但期望的值与 <a href="#tothrowerror"><code>toThrowError</code></a> 相同。</section><section class="level2"aria-labelledby="tohavebeencalled"><h2 id="tohavebeencalled">toHaveBeenCalled</h2><ul><li><strong>类型:</strong> <code>() => Awaitable&#x3C;void></code></ul><p>这个断言对于测试函数是否被调用很有用。需要将一个 spy 函数传递给 <code>expect</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> market <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">buy</span><span class="token punctuation">(</span>subject<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> buySpy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">spyOn</span><span class="token punctuation">(</span>market<span class="token punctuation">,</span> <span class="token string">'buy'</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>buySpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>buySpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tohavebeencalledtimes"><h2 id="tohavebeencalledtimes">toHaveBeenCalledTimes</h2><ul><li><strong>类型</strong>: <code>(amount: number) => Awaitable&#x3C;void></code></ul><p>这个断言检查函数被调用的次数是否达到特定次数。需要将一个 spy 函数传递给 <code>expect</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> market <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">buy</span><span class="token punctuation">(</span>subject<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function called two times'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> buySpy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">spyOn</span><span class="token punctuation">(</span>market<span class="token punctuation">,</span> <span class="token string">'buy'</span><span class="token punctuation">)</span>

  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>buySpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tohavebeencalledwith"><h2 id="tohavebeencalledwith">toHaveBeenCalledWith</h2><ul><li><strong>类型</strong>: <code>(...args: any[]) => Awaitable&#x3C;void></code></ul><p>这个断言检查函数是否至少被传递了特定参数调用过一次。需要将一个 spy 函数传递给 <code>expect</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> market <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">buy</span><span class="token punctuation">(</span>subject<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> buySpy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">spyOn</span><span class="token punctuation">(</span>market<span class="token punctuation">,</span> <span class="token string">'buy'</span><span class="token punctuation">)</span>

  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>buySpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>buySpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tohavebeenlastcalledwith"><h2 id="tohavebeenlastcalledwith">toHaveBeenLastCalledWith</h2><ul><li><strong>类型</strong>: <code>(...args: any[]) => Awaitable&#x3C;void></code></ul><p>这个断言检查函数在最后一次调用时是否使用了特定参数。需要将一个 spy 函数传递给 <code>expect</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> market <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">buy</span><span class="token punctuation">(</span>subject<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> buySpy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">spyOn</span><span class="token punctuation">(</span>market<span class="token punctuation">,</span> <span class="token string">'buy'</span><span class="token punctuation">)</span>

  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>buySpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenLastCalledWith</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>buySpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenLastCalledWith</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tohavebeennthcalledwith"><h2 id="tohavebeennthcalledwith">toHaveBeenNthCalledWith</h2><ul><li><strong>类型</strong>: <code>(time: number, ...args: any[]) => Awaitable&#x3C;void></code></ul><p>这个断言检查函数在特定时间是否使用了特定参数进行调用。计数从 1 开始。因此，要检查第二个条目，我们应该写 <code>.toHaveBeenNthCalledWith(2, ...)</code>。<p>需要将一个 spy 函数传递给 <code>expect</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> market <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">buy</span><span class="token punctuation">(</span>subject<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'first call of spy function called with right params'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> buySpy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">spyOn</span><span class="token punctuation">(</span>market<span class="token punctuation">,</span> <span class="token string">'buy'</span><span class="token punctuation">)</span>

  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>buySpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenNthCalledWith</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tohavereturned"><h2 id="tohavereturned">toHaveReturned</h2><ul><li><strong>类型</strong>: <code>() => Awaitable&#x3C;void></code></ul><p>这个断言检查函数是否至少成功返回过一个值（即没有抛出错误）。需要将一个 spy 函数传递给 <code>expect</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">function</span> <span class="token function">getApplesPrice</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token constant">PRICE</span> <span class="token operator">=</span> <span class="token number">10</span>
  <span class="token keyword control-flow">return</span> amount <span class="token operator">*</span> <span class="token constant">PRICE</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function returned a value'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> getPriceSpy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span>getApplesPrice<span class="token punctuation">)</span>

  <span class="token keyword">const</span> price <span class="token operator">=</span> <span class="token function">getPriceSpy</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>getPriceSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveReturned</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tohavereturnedtimes"><h2 id="tohavereturnedtimes">toHaveReturnedTimes</h2><ul><li><strong>类型</strong>: <code>(amount: number) => Awaitable&#x3C;void></code></ul><p>这个断言检查函数是否成功返回了确切次数的值（即没有抛出错误）。需要将一个 spy 函数传递给 <code>expect</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function returns a value two times'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sell <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span>product<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> product <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token function">sell</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">)</span>
  <span class="token function">sell</span><span class="token punctuation">(</span><span class="token string">'bananas'</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>sell<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveReturnedTimes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tohavereturnedwith"><h2 id="tohavereturnedwith">toHaveReturnedWith</h2><ul><li><strong>类型</strong>: <code>(returnValue: any) => Awaitable&#x3C;void></code></ul><p>我们可以调用此断言来检查函数是否至少成功返回过一个带有特定参数的值。需要将一个 spy 函数传递给 <code>expect</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function returns a product'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sell <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span>product<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> product <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token function">sell</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>sell<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveReturnedWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span> product<span class="token operator">:</span> <span class="token string">'apples'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tohavelastreturnedwith"><h2 id="tohavelastreturnedwith">toHaveLastReturnedWith</h2><ul><li><strong>类型</strong>: <code>(returnValue: any) => Awaitable&#x3C;void></code></ul><p>我们可以调用此断言来检查函数是否在最后一次调用时成功返回了带有特定参数的值。需要将一个 spy 函数传递给 <code>expect</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function returns bananas on a last call'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sell <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span>product<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> product <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token function">sell</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">)</span>
  <span class="token function">sell</span><span class="token punctuation">(</span><span class="token string">'bananas'</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>sell<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveLastReturnedWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span> product<span class="token operator">:</span> <span class="token string">'bananas'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tohaventhreturnedwith"><h2 id="tohaventhreturnedwith">toHaveNthReturnedWith</h2><ul><li><strong>类型</strong>: <code>(time: number, returnValue: any) => Awaitable&#x3C;void></code></ul><p>我们可以调用此断言来检查函数是否在特定调用时成功返回了带有特定参数的值。需要将一个 spy 函数传递给 <code>expect</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function returns bananas on second call'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sell <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span>product<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> product <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token function">sell</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">)</span>
  <span class="token function">sell</span><span class="token punctuation">(</span><span class="token string">'bananas'</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>sell<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveNthReturnedWith</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> product<span class="token operator">:</span> <span class="token string">'bananas'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="tosatisfy"><h2 id="tosatisfy">toSatisfy</h2><ul><li><strong>类型:</strong> <code>(predicate: (value: any) => boolean) => Awaitable&#x3C;void></code></ul><p>该断言检查一个值是否满足「某个谓词/certain predicate」。<pre class="language-ts"><code class="language-ts"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'toSatisfy()'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">isOdd</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> value <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!==</span> <span class="token number">0</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'pass with 0'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toSatisfy</span><span class="token punctuation">(</span>isOdd<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'pass with negotiation'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toSatisfy</span><span class="token punctuation">(</span>isOdd<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="resolves"><h2 id="resolves">resolves</h2><ul><li><strong>类型:</strong> <code>Promisify&#x3C;Assertions></code></ul><p><code>resolves</code> 旨在在断言异步代码时消除样板代码。使用它来从待定的 Promise 中解包值，并使用通常的断言来断言其值。如果 Promise 被拒绝，断言将失败。<p>它返回相同的 <code>Assertions</code> 对象，但所有匹配器现在都返回 <code>Promise</code>，因此我们需要使用 <code>await</code>。它也适用于 <code>chai</code> 断言。<p>例如，如果有一个函数，它发出 API 调用并返回一些数据，可以使用以下代码来断言其返回值：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">buyApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/buy/apples'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span>r <span class="token arrow operator">=></span> r<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'buyApples returns new stock id'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// toEqual returns a promise now, so you HAVE to await it</span>
  <span class="token keyword control-flow">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">buyApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">resolves</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// jest API</span>
  <span class="token keyword control-flow">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">buyApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">resolves</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// chai API</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>如果断言没有被等待，那么将得到一个虚假的测试，它将每次都通过。为了确保断言实际上被调用，需要使用 [`expect.assertions(number)`](#expect-assertions)。</blockquote></section><section class="level2"aria-labelledby="rejects"><h2 id="rejects">rejects</h2><ul><li><strong>类型:</strong> <code>Promisify&#x3C;Assertions></code></ul><p><code>rejects</code> 旨在在断言异步代码时消除样板代码。使用它来解包 Promise 被拒绝的原因，并使用通常的断言来断言其值。如果 Promise 成功解决，断言将失败。<p>它返回相同的 <code>Assertions</code> 对象，但所有匹配器现在都返回 <code>Promise</code>，因此需要使用 <code>await</code>。它也适用于 <code>chai</code> 断言。<p>例如，如果有一个在调用时失败的函数，可以使用以下代码来断言失败的原因：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">buyApples</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>id<span class="token punctuation">)</span>
    <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span><span class="token punctuation">(</span><span class="token string">'no id'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'buyApples throws an error when no id provided'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// toThrow returns a promise now, so you HAVE to await it</span>
  <span class="token keyword control-flow">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">buyApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">rejects</span><span class="token punctuation">.</span><span class="token method function property-access">toThrow</span><span class="token punctuation">(</span><span class="token string">'no id'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>如果不等待断言，那么将得到每次都会通过的误报测试。 为了确保确实调用了断言，可以使用 [`expect.assertions(number)`](#expect-assertions)。</blockquote></section><section class="level2"aria-labelledby="expectassertions"><h2 id="expectassertions">expect.assertions</h2><ul><li><strong>类型:</strong> <code>(count: number) => void</code></ul><p>在测试通过或失败后，验证在测试期间调用了特定数量的断言。一个有用的情况是检查异步代码是否被调用了。<p>例如，如果我们有一个异步调用了两个匹配器的函数，我们可以断言它们是否真的被调用了。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">doAsync</span><span class="token punctuation">(</span><span class="token spread operator">...</span>cbs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span>cbs<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">{</span> index <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'all assertions are called'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  expect<span class="token punctuation">.</span><span class="token method function property-access">assertions</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token keyword">function</span> <span class="token function">callback1</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">callback2</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">await</span> <span class="token function">doAsync</span><span class="token punctuation">(</span>callback1<span class="token punctuation">,</span> callback2<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>在使用异步并发测试时，必须使用本地 [Test Context](/guide/test-context.md) 中的 `expect` 来确保正确的测试被检测到。</blockquote></section><section class="level2"aria-labelledby="expecthasassertions"><h2 id="expecthasassertions">expect.hasAssertions</h2><ul><li><strong>类型:</strong> <code>() => void</code></ul><p>在测试通过或失败后，验证在测试期间至少调用了一个断言。一个有用的情况是检查是否调用了异步代码。<p>例如，如果有一个调用回调的代码，我们可以在回调中进行断言，但是如果我们不检查是否调用了断言，测试将始终通过。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> db <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./db.js'</span>

<span class="token keyword">const</span> cbs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">onSelect</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cbs<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// after selecting from db, we call all callbacks</span>
<span class="token keyword">function</span> <span class="token function">select</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> db<span class="token punctuation">.</span><span class="token method function property-access">select</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span>cbs<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span>cb <span class="token arrow operator">=></span> <span class="token function">cb</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'callback was called'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  expect<span class="token punctuation">.</span><span class="token method function property-access">hasAssertions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">onSelect</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// should be called on select</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// if not awaited, test will fail</span>
  <span class="token comment">// if you don't have expect.hasAssertions(), test will pass</span>
  <span class="token keyword control-flow">await</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="expectunreachable"><h2 id="expectunreachable">expect.unreachable</h2><ul><li><strong>类型:</strong> <code>(message?: string) => never</code></ul><p>这种方法用于断言某一行永远不会被执行。<p>例如，如果我们想要测试 <code>build()</code> 因为接收到没有 <code>src</code> 文件夹的目录而抛出异常，并且还要分别处理每个错误，我们可以这样做：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">build</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>dir<span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">'no-src'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/src does not exist</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> errorDirs <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'no-src-folder'</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">]</span>

test<span class="token punctuation">.</span><span class="token method function property-access">each</span><span class="token punctuation">(</span>errorDirs<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'build fails with "%s"'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">await</span> <span class="token function">build</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span>
    expect<span class="token punctuation">.</span><span class="token method function property-access">unreachable</span><span class="token punctuation">(</span><span class="token string">'Should not pass build'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>err<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeInstanceOf</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Error</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span><span class="token property-access">stack</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toContain</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">)</span>

    <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'no-src-folder'</span><span class="token operator">:</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/src does not exist</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token keyword control-flow">break</span>
      <span class="token keyword module">default</span><span class="token operator">:</span>
        <span class="token comment">// to exhaust all error tests</span>
        expect<span class="token punctuation">.</span><span class="token method function property-access">unreachable</span><span class="token punctuation">(</span><span class="token string">'All error test must be handled'</span><span class="token punctuation">)</span>
        <span class="token keyword control-flow">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="expectanything"><h2 id="expectanything">expect.anything</h2><ul><li><strong>类型:</strong> <code>() => any</code></ul><p>该非对称匹配器与相等检查一起使用时，将始终返回 <code>true</code>。如果只想确定属性是否存在，那么它就很有用。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'object has "apples" key'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">{</span> apples<span class="token operator">:</span> <span class="token number">22</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> apples<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">anything</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="expectany"><h2 id="expectany">expect.any</h2><ul><li><strong>类型:</strong> <code>(constructor: unknown) => any</code></ul><p>这个不对称的匹配器在与相等性检查一起使用时，只有当该值是指定构造函数的实例时才会返回<code>true</code>。 如果我们有一个每次生成的值，并且只想知道它是否存在，这将非常有用。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> generateId <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./generators.js'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'"id" is a number'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token function">generateId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">any</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Number</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="expectcloseto"><h2 id="expectcloseto">expect.closeTo</h2><ul><li><strong>类型:</strong> <code>(expected: any, precision?: number) => any</code><li><strong>版本:</strong> 从 Vitest 1.0.0 开始支持</ul><p>在比较对象属性或数组项中的浮点数时，<code>expect.closeTo</code> 非常有用。 如果需要比较数字，请改用 <code>.toBeCloseTo</code> 。<p>可选的 <code>numDigits</code> 参数限制要检查小数点<strong>后</strong>的位数。 对于默认值 <code>2</code> ，测试标准为 <code>Math.abs(expected - received) &#x3C; 0.005 (that is, 10 ** -2 / 2)</code> 。<p>例如，此测试以 5 位精度通过：<pre class="language-js"><code class="language-js"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'compare float in object properties'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'0.1 + 0.2'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sum</span><span class="token operator">:</span> <span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'0.1 + 0.2'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sum</span><span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">closeTo</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="expectarraycontaining"><h2 id="expectarraycontaining">expect.arrayContaining</h2><ul><li><strong>类型:</strong> <code>&#x3C;T>(expected: T[]) => any</code></ul><p>与相等检查一起使用时，如果值是数组且包含指定项，则此非对称匹配器将返回 <code>true</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'basket includes fuji'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> basket <span class="token operator">=</span> <span class="token punctuation">{</span>
    varieties<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Empire'</span><span class="token punctuation">,</span> <span class="token string">'Fuji'</span><span class="token punctuation">,</span> <span class="token string">'Gala'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    count<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>basket<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    count<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    varieties<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">arrayContaining</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Fuji'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>可以将 `expect.not` 与此匹配器一起使用来否定期望值。</blockquote></section><section class="level2"aria-labelledby="expectobjectcontaining"><h2 id="expectobjectcontaining">expect.objectContaining</h2><ul><li><strong>类型:</strong> <code>(expected: any) => any</code></ul><p>当与相等检查一起使用时，如果值的形状相似，该非对称匹配器将返回 <code>true</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'basket has empire apples'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> basket <span class="token operator">=</span> <span class="token punctuation">{</span>
    varieties<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">'Empire'</span><span class="token punctuation">,</span>
        count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>basket<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    varieties<span class="token operator">:</span> <span class="token punctuation">[</span>expect<span class="token punctuation">.</span><span class="token method function property-access">objectContaining</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Empire'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>可以将 `expect.not` 与此匹配器一起使用，以否定预期值。</blockquote></section><section class="level2"aria-labelledby="expectstringcontaining"><h2 id="expectstringcontaining">expect.stringContaining</h2><ul><li><strong>类型:</strong> <code>(expected: any) => any</code></ul><p>当与相等性检查一起使用时，这个不对称的匹配器将在值为字符串且包含指定子字符串时返回<code>true</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'variety has "Emp" in its name'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> variety <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Empire'</span><span class="token punctuation">,</span>
    count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>variety<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">stringContaining</span><span class="token punctuation">(</span><span class="token string">'Emp'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>可以将 `expect.not` 与此匹配器一起使用，以否定预期值。</blockquote></section><section class="level2"aria-labelledby="expectstringmatching"><h2 id="expectstringmatching">expect.stringMatching</h2><ul><li><strong>类型:</strong> <code>(expected: any) => any</code></ul><p>当与相等性检查一起使用时，这个不对称的匹配器将在值为字符串且包含指定子字符串，或者字符串与正则表达式匹配时返回 <code>true</code> 。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'variety ends with "re"'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> variety <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Empire'</span><span class="token punctuation">,</span>
    count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>variety<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">stringMatching</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">re$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>可以将 `expect.not` 与此匹配器一起使用，以否定预期值。</blockquote></section><section class="level2"aria-labelledby="expectaddsnapshotserializer"><h2 id="expectaddsnapshotserializer">expect.addSnapshotSerializer</h2><ul><li><strong>类型:</strong> <code>(plugin: PrettyFormatPlugin) => void</code></ul><p>这个方法添加了在创建快照时调用的自定义序列化程序。这是一个高级功能 - 如果想了解更多，请阅读有关<a href="/guide/snapshot#custom-serializer">自定义序列化程序的指南</a>。<p>如果需要添加自定义序列化程序，应该在 <a href="../config.html#setupfiles"><code>setupFiles</code></a> 中调用此方法。这将影响每个快照。<blockquote>如果以前将 Vue CLI 与 Jest 一起使用，需要安装 [jest-serializer-vue](https://www.npmjs.com/package/jest-serializer-vue)。 否则，的快照将被包裹在一个字符串中，其中 `"` 是要转义的。</blockquote></section><section class="level2"aria-labelledby="expectextend"><h2 id="expectextend">expect.extend</h2><ul><li><strong>类型:</strong> <code>(matchers: MatchersObject) => void</code></ul><p>我们可以使用自定义匹配器扩展默认匹配器。这个函数用于使用自定义匹配器扩展匹配器对象。<p>当我们以这种方式定义匹配器时，还会创建可以像 <code>expect.stringContaining</code> 一样使用的不对称匹配器。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'custom matchers'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  expect<span class="token punctuation">.</span><span class="token method function property-access">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">toBeFoo</span><span class="token operator">:</span> <span class="token punctuation">(</span>received<span class="token punctuation">,</span> expected<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>received <span class="token operator">!==</span> <span class="token string">'foo'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
          <span class="token function-variable function">message</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">expected </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>received<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> to be foo</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          pass<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">toBeFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>如果希望匹配器出现在每个测试中，应该在 [`setupFiles`](../config.html#setupFiles) 中调用此方法。</blockquote><p>这个函数与 Jest 的 <code>expect.extend</code> 兼容，因此任何使用它来创建自定义匹配器的库都可以与 Vitest 一起使用。<p>如果正在使用 TypeScript，自从 Vitest 0.31.0 版本以来，我们可以在环境声明文件（例如：<code>vitest.d.ts</code>）中使用下面的代码扩展默认的 <code>Assertion</code> 接口：<pre class="language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">CustomMatchers</span><span class="token operator">&#x3C;</span><span class="token constant">R</span> <span class="token operator">=</span> <span class="token builtin">unknown</span><span class="token operator">></span></span> <span class="token punctuation">{</span>
  <span class="token function">toBeFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">R</span>
<span class="token punctuation">}</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'vitest'</span> <span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">Assertion</span><span class="token operator">&#x3C;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">></span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token maybe-class-name">CustomMatchers</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">AsymmetricMatchersContaining</span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token maybe-class-name">CustomMatchers</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><blockquote>不要忘记在 `tsconfig.json` 中包含环境声明文件。</blockquote><blockquote>如果想了解更多信息，请查看 [扩展断言 (Matchers) 指南](/guide/extending-matchers)。</blockquote><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>