<!doctype html><html lang="cn"><meta charset="utf-8"><title>API 索引</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="outline"content="deep"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="api-索引"class="level1"><h1>API 索引</h1><p>下面的变量中使用了以下类型签名<pre class="language-ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">Awaitable</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token maybe-class-name">PromiseLike</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">TestFunction</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token maybe-class-name">Awaitable</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span>

<span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">TestOptions</span></span> <span class="token punctuation">{</span>
  timeout<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  retry<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span></code></pre><p>当一个测试函数返回一个 promise 时，Vitest 将等待直到它被解决以收集异步的期望值。 如果 promise 被拒绝，测试将失败。<blockquote>提示 在 Jest 中，`TestFunction` 也可以是 `(done: DoneCallback) => void` 类型。 如果使用此选项，则在调用 `done` 之前测试不会结束。 你可以使用 `async` 函数实现相同的目的，请参阅迁移指南中的[回调](../guide/migration#done-callback)部分。</blockquote><section id="test"class="level2"><h2>test</h2><ul><li><p><strong>类型:</strong> <code>(name: string, fn: TestFunction, timeout?: number | TestOptions) => void</code><li><p><strong>别名:</strong> <code>it</code><p><code>test</code> 定义了一组关于测试期望的方法。它接收测试名称和一个含有测试期望的函数。<p>同时，可以提供一个超时时限（以毫秒为单位）用于指定等待多长时间后终止测试，默认为 5 秒。你也可以通过 <a href="../config.html#testtimeout">testTimeout</a> 选项进行全局配置。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'should work as expected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul><section id="testskip"class="level3"><h3>test.skip</h3><ul><li><p><strong>类型:</strong> <code>(name: string, fn: TestFunction, timeout?: number | TestOptions) => void</code><li><p><strong>别名:</strong> <code>it.skip</code><p>如果你想跳过运行某些测试，但由于一些原因不想删除代码，你可以使用 <code>test.skip</code> 来避免运行它们。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span><span class="token string">'skipped test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 跳过测试，没有错误</span>
  assert<span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="testskipif"class="level3"><h3>test.skipIf</h3><ul><li><p><strong>类型:</strong> <code>(condition: any) => Test</code><li><p><strong>别名:</strong> <code>it.skipIf</code><p>在某些情况下，你可能会在不同的环境中多次运行测试，并且某些测试可能基于特定环境下运行。只要条件成立，你就可以使用 <code>test.skipIf</code> 跳过测试，而不是用 <code>if</code> 包裹测试代码。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> isDev <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">skipIf</span><span class="token punctuation">(</span>isDev<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'prod only test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 只在生产环境下进行测试</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul><blockquote>当 Vitest 作为 [类型检查器](/guide/testing-types) 时，你不能使用此语法。</blockquote></section><section id="testrunif"class="level3"><h3>test.runIf</h3><ul><li><strong>类型:</strong> <code>(condition: any) => Test</code><li><strong>别名:</strong> <code>it.runIf</code></ul><p><a href="#testskipif">test.skipIf</a> 的相反面。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> isDev <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">runIf</span><span class="token punctuation">(</span>isDev<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'dev only test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 只在开发环境下进行测试</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>当 Vitest 作为 [类型检查器](/guide/testing-types) 时，你不能使用此语法。</blockquote></section><section id="testonly"class="level3"><h3>test.only</h3><ul><li><p><strong>类型:</strong> <code>(name: string, fn: TestFunction, timeout?: number) => void</code><li><p><strong>别名:</strong> <code>it.only</code><p>使用 <code>test.only</code> 只允许特定条件的测试套件。这在调试模式下是很有用的。<p>同时，可以提供一个超时时限（以毫秒为单位）用于指定等待多长时间后终止测试，默认为 5 秒。你也可以通过 <a href="../config.html#testtimeout">testTimeout</a> 选项进行全局配置。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">only</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 仅运行此测试（以及仅标记有的其他测试）</span>
  assert<span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>有时候只运行一个特定文件中的 <code>only</code> 测试用例是很有用的，这可以忽略整个测试套件中的所有其他测试用例，避免污染输出。<p>为了做到这一点，运行 <code>vitest</code> 命令并带上包含有问题的测试的特定文件。<pre class="language-text"><code class="language-text"># vitest interesting.test.ts</code></pre></ul></section><section id="testconcurrent"class="level3"><h3>test.concurrent</h3><ul><li><p><strong>类型:</strong> <code>(name: string, fn: TestFunction, timeout?: number) => void</code><li><p><strong>别名:</strong> <code>it.concurrent</code><p><code>test.concurrent</code> 将连续测试标记为并行运行。 它接收测试名称、带有要收集的测试的异步函数以及可选的超时时间（以毫秒为单位）。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token comment">// 标有并发的两个测试将并发运行</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'serial test'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'concurrent test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><code>test.skip</code>、<code>test.only</code> 和 <code>test.todo</code> 适用于并发测试。 以下所有组合均有效：<pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span>
test<span class="token punctuation">.</span><span class="token property-access">skip</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or test.concurrent.skip(/* ... */)</span>
test<span class="token punctuation">.</span><span class="token property-access">only</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or test.concurrent.only(/* ... */)</span>
test<span class="token punctuation">.</span><span class="token property-access">todo</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or test.concurrent.todo(/* ... */)</span></code></pre><p>在异步并发测试中使用快照时，由于 JavaScript 的限制，你需要使用 <a href="/guide/test-context.md">测试环境</a> 中的 <code>expect</code> 来确保检测到正确的测试。<pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul><blockquote>当 Vitest 作为 [类型检查器](/guide/testing-types) 时，你不能使用此语法。</blockquote></section><section id="testtodo"class="level3"><h3>test.todo</h3><ul><li><p><strong>类型:</strong> <code>(name: string) => void</code><li><p><strong>别名:</strong> <code>it.todo</code><p>使用 <code>test.todo</code> 来存根测试，以便稍后实现。 测试报告中将显示一个条目，以便告知你还有多少测试未实现。<pre class="language-ts"><code class="language-ts"><span class="token comment">// 测试的报告中将显示一个记录</span>
test<span class="token punctuation">.</span><span class="token method function property-access">todo</span><span class="token punctuation">(</span><span class="token string">'unimplemented test'</span><span class="token punctuation">)</span></code></pre></ul></section><section id="testfails"class="level3"><h3>test.fails</h3><ul><li><p><strong>类型:</strong> <code>(name: string, fn: TestFunction, timeout?: number) => void</code><li><p><strong>别名:</strong> <code>it.fails</code><p>使用 <code>test.fails</code> 来指示测试断言将显式失败。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword">const</span> <span class="token function-variable function">myAsyncFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Promise</span></span><span class="token punctuation">(</span>resolve <span class="token arrow operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test<span class="token punctuation">.</span><span class="token method function property-access">fails</span><span class="token punctuation">(</span><span class="token string">'fail test'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">myAsyncFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">rejects</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul><blockquote>当 Vitest 作为 [类型检查器](/guide/testing-types) 时，你不能使用此语法。</blockquote></section><section id="testeach"class="level3"><h3>test.each</h3><ul><li><p><strong>类型:</strong> <code>(cases: ReadonlyArray&#x3C;T>, ...args: any[]) => void</code><li><p><strong>别名:</strong> <code>it.each</code><p>当你需要使用不同的变量运行相同的测试时，请使用 <code>test.each</code>。 你可以按照测试参数的顺序，在测试名称插入符合<a href="https://nodejs.org/api/util.html#util_util_format_format_args">printf 格式</a>的参数。<ul><li><code>%s</code>: 字符串<li><code>%d</code>: 数值<li><code>%i</code>: 整数<li><code>%f</code>: 小数<li><code>%j</code>: json 格式<li><code>%o</code>: 对象<li><code>%#</code>: 对应的测试参数下标<li><code>%%</code>: 单个百分比符号 ('%')</ul><pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token method function property-access">each</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'add(%i, %i) -> %i'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 它将返回如下内容</span>
<span class="token comment">// ✓ add(1, 1) -> 2</span>
<span class="token comment">// ✓ add(1, 2) -> 3</span>
<span class="token comment">// ✓ add(2, 1) -> 3</span></code></pre><p>如果你使用对象作为参数，你还可以使用 <code>$</code> 前缀访问对象属性：<pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token method function property-access">each</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'add($a, $b) -> $expected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// this will return</span>
<span class="token comment">// ✓ add(1, 1) -> 2</span>
<span class="token comment">// ✓ add(1, 2) -> 3</span>
<span class="token comment">// ✓ add(2, 1) -> 3</span></code></pre><p>如果你使用对象作为参数，你还可以使用“.”访问对象属性：<pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token property-access">each</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  a             | b      | expected
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span> val<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'1b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span> val<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'2b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span> val<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'3b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">(</span><span class="token string">'add($a.val, $b) -> $expected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token property-access">val</span> <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// this will return</span>
<span class="token comment">// ✓ add(1, b) -> 1b</span>
<span class="token comment">// ✓ add(2, b) -> 2b</span>
<span class="token comment">// ✓ add(3, b) -> 3b</span></code></pre></ul><p>从 Vitest 0.25.3 开始，你可以使用模板字符串表。<ul><li>第一行应该是列名，使用 <code>|</code> 分隔；<li>使用 <code>${value}</code> 语法作为模板文本表达式，为一个或多个后续数据行提供数据。</ul><pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token property-access">each</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  a             | b      | expected
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">          | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">   | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'a'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">        | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'ab'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">         | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">         | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'[object Object]b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span> asd<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'[object Object]b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">(</span><span class="token string">'returns $expected when $a is added $b'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>如果你想访问 <code>TestContext</code>，请在单个测试中使用 <code>describe.each</code>。<blockquote>当使用 Vitest 作为 [type checker](/guide/testing-types) 时，不能使用此语法。</blockquote></section></section><section id="bench"class="level2"><h2>bench</h2><ul><li><strong>类型:</strong> <code>(name: string, fn: BenchFunction, options?: BenchOptions) => void</code></ul><p><code>bench</code> 定义了一个基准。 在 Vitest 术语中，基准是定义一系列操作的函数。 Vitest 多次运行此函数以显示不同的性能结果。<p>Vitest 在底层使用 <a href="https://github.com/tinylibs/tinybench"><code>tinybench</code></a> 库，继承其所有可用选项作为第三个参数。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">bench</span><span class="token punctuation">(</span>
  <span class="token string">'normal sorting'</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
    x<span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> time<span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span></code></pre><pre class="language-ts"><code class="language-ts"><span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">Options</span></span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * time needed for running a benchmark task (milliseconds)
   * <span class="token keyword">@default</span> 500
   */</span>
  time<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>

  <span class="token doc-comment comment">/**
   * number of times that a task should run if even the time option is finished
   * <span class="token keyword">@default</span> 10
   */</span>
  iterations<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>

  <span class="token doc-comment comment">/**
   * function to get the current timestamp in milliseconds
   */</span>
  now<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token builtin">number</span>

  <span class="token doc-comment comment">/**
   * An AbortSignal for aborting the benchmark
   */</span>
  signal<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">AbortSignal</span>

  <span class="token doc-comment comment">/**
   * warmup time (milliseconds)
   * <span class="token keyword">@default</span> 100ms
   */</span>
  warmupTime<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>

  <span class="token doc-comment comment">/**
   * warmup iterations
   * <span class="token keyword">@default</span> 5
   */</span>
  warmupIterations<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>

  <span class="token doc-comment comment">/**
   * setup function to run before each benchmark task (cycle)
   */</span>
  setup<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Hook</span>

  <span class="token doc-comment comment">/**
   * teardown function to run after each benchmark task (cycle)
   */</span>
  teardown<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Hook</span>
<span class="token punctuation">}</span></code></pre><section id="benchskip"class="level3"><h3>bench.skip</h3><ul><li><strong>类型:</strong> <code>(name: string, fn: BenchFunction, options?: BenchOptions) => void</code></ul><p>你可以使用 <code>bench.skip</code> 语法跳过运行某些基准测试。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

bench<span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span><span class="token string">'normal sorting'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
  x<span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="benchonly"class="level3"><h3>bench.only</h3><ul><li><strong>类型:</strong> <code>(name: string, fn: BenchFunction, options?: BenchOptions) => void</code></ul><p>使用 <code>bench.only</code> 仅在指定测试套件中运行某些基准测试。这在调试时很有用。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

bench<span class="token punctuation">.</span><span class="token method function property-access">only</span><span class="token punctuation">(</span><span class="token string">'normal sorting'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
  x<span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="benchtodo"class="level3"><h3>bench.todo</h3><ul><li><strong>类型:</strong> <code>(name: string) => void</code></ul><p>使用 <code>bench.todo</code> 来存根基准测试，以便稍后实现。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

bench<span class="token punctuation">.</span><span class="token method function property-access">todo</span><span class="token punctuation">(</span><span class="token string">'unimplemented test'</span><span class="token punctuation">)</span></code></pre></section></section><section id="describe"class="level2"><h2>describe</h2><p>当你在文件的顶层使用 <code>test</code> 或 <code>bench</code> 时，它们会被收集为它的隐式套件的一部分。 使用 <code>describe</code> 你可以在当前上下文中定义一个新套件，作为一组相关的测试或基准以及其他嵌套套件。 测试套件可让你组织测试和基准测试，从而使报告更加清晰。<pre class="language-ts"><code class="language-ts"><span class="token comment">// basic.spec.ts</span>
<span class="token comment">// organizing tests</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  isActive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'person is defined'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeDefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'is active'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token property-access">isActive</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'age limit'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeLessThanOrEqual</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>如果你需要有测试层次结构，你还可以嵌套描述块：<pre class="language-ts"><code class="language-ts"><span class="token comment">// basic.bench.ts</span>
<span class="token comment">// organizing benchmarks</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench<span class="token punctuation">,</span> describe <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'sort'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">'normal'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
    x<span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">'reverse'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
    x<span class="token punctuation">.</span><span class="token method function property-access">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>如果你有测试或基准的层次结构，你还可以嵌套描述块：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> <span class="token function-variable function">numberToCurrency</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">!==</span> <span class="token string">'number'</span><span class="token punctuation">)</span>
    <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span><span class="token punctuation">(</span><span class="token string">'Value must be a number'</span><span class="token punctuation">)</span>

  <span class="token keyword control-flow">return</span> value
    <span class="token punctuation">.</span><span class="token method function property-access">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\B(?=(\d{3})+(?!\d))</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'numberToCurrency'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'given an invalid number'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'composed of non-numbers to throw error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">numberToCurrency</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toThrowError</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'given a valid number'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'returns the correct currency format'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">numberToCurrency</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token string">'10,000.00'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><section id="describeskip"class="level3"><h3>describe.skip</h3><ul><li><p><strong>类型:</strong> <code>(name: string, fn: TestFunction, options?: number | TestOptions) => void</code><p>在测试套件中使用 <code>describe.skip</code> 避免运行特定的描述块。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> describe<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

describe<span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span><span class="token string">'skipped suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'sqrt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 跳过测试套件，不会有错误</span>
    assert<span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="describeskipif"class="level3"><h3>describe.skipIf</h3><ul><li><p><strong>类型:</strong> <code>(condition: any) => void</code><p>在某些情况下，你可能会在不同的环境中多次运行套件，并且某些套件可能是特定于环境的。你可以使用 <code>describe.skipIf</code> 在条件为真时跳过套件，而不是用 <code>if</code> 包装套件。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> isDev <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>

describe<span class="token punctuation">.</span><span class="token method function property-access">skipIf</span><span class="token punctuation">(</span>isDev<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'prod only test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// this test only runs in production</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul><blockquote>当 Vitest 作为 [类型检查器](/guide/testing-types) 时，你不能使用此语法。</blockquote></section><section id="describeonly"class="level3"><h3>describe.only</h3><ul><li><p><strong>类型:</strong> <code>(name: string, fn: TestFunction, options?: number | TestOptions) => void</code><p>使用 <code>describe.only</code> 仅运行指定的测试套件。<pre class="language-ts"><code class="language-ts"><span class="token comment">// 仅运行此测试套件（以及仅标有的其他测试套件）</span>
describe<span class="token punctuation">.</span><span class="token method function property-access">only</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'sqrt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    assert<span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'other suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 测试套件将会被跳过</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>有时候只运行一个特定文件中的 <code>only</code> 测试用例是很有用的，这可以忽略整个测试套件中的所有其他测试用例，避免污染输出。<p>为了做到这一点，运行 <code>vitest</code> 命令并带上包含有问题的测试的特定文件。<pre class="language-text"><code class="language-text"># vitest interesting.test.ts</code></pre></ul></section><section id="describeconcurrent"class="level3"><h3>describe.concurrent</h3><ul><li><p><strong>类型:</strong> <code>(name: string, fn: TestFunction, options?: number | TestOptions) => void</code><p>使用 <code>describe.concurrent</code> 在测试套件中将每个测试标记为并发。<pre class="language-ts"><code class="language-ts"><span class="token comment">// 该测试套件中的所有测试都将并行运行</span>
describe<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'concurrent test 3'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><code>.skip</code>，<code>.only</code> 和 <code>.todo</code> 可以与并发测试套件一起使用。以下所有组合均有效：<pre class="language-ts"><code class="language-ts">describe<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span>
describe<span class="token punctuation">.</span><span class="token property-access">skip</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or describe.concurrent.skip(/* ... */)</span>
describe<span class="token punctuation">.</span><span class="token property-access">only</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or describe.concurrent.only(/* ... */)</span>
describe<span class="token punctuation">.</span><span class="token property-access">todo</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or describe.concurrent.todo(/* ... */)</span></code></pre></ul><p>在异步并发测试中使用快照时，由于 JavaScript 的限制，你需要使用 <a href="/guide/test-context.md">测试环境</a> 中的 <code>expect</code> 来确保检测到正确的测试。<pre class="language-ts"><code class="language-ts">describe<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>当 Vitest 作为 [类型检查器](/guide/testing-types) 时，你不能使用此语法。</blockquote></section><section id="describeshuffle"class="level3"><h3>describe.shuffle</h3><ul><li><p><strong>类型:</strong> <code>(name: string, fn: TestFunction, options?: number | TestOptions) => void</code><p>Vitest 提供了一种通过 CLI 标志 <a href="../guide/cli"><code>--sequence.shuffle</code></a> 或配置选项 <a href="/config.html#sequence-shuffle"><code>sequence.shuffle</code></a> 来随机运行所有测试的方法，但是如果你只想让测试套件的一部分以随机顺序运行测试，可以使用此标志对其进行标记。<pre class="language-ts"><code class="language-ts">describe<span class="token punctuation">.</span><span class="token method function property-access">shuffle</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'random test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'random test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'random test 3'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 执行顺序依赖于 sequence.seed 的配置选项(默认为 Date.now())</span></code></pre></ul><p><code>.skip</code>，<code>.only</code> 和 <code>.todo</code> 可以与并发测试套件一起使用。以下所有组合均有效：<blockquote>当 Vitest 作为 [类型检查器](/guide/testing-types) 时，你不能使用此语法。</blockquote></section><section id="describetodo"class="level3"><h3>describe.todo</h3><ul><li><p><strong>类型:</strong> <code>(name: string) => void</code><p>使用 <code>describe.todo</code> 将稍后实现的测试套件进行存档。测试报告中将显示一个记录，以便你知道还多少条未实现的测试。<pre class="language-ts"><code class="language-ts"><span class="token comment">// 测试套件的报告中将显示一个记录</span>
describe<span class="token punctuation">.</span><span class="token method function property-access">todo</span><span class="token punctuation">(</span><span class="token string">'unimplemented suite'</span><span class="token punctuation">)</span></code></pre></ul></section><section id="describeeach"class="level3"><h3>describe.each</h3><ul><li><p><strong>类型:</strong> <code>(cases: ReadonlyArray&#x3C;T>, ...args: any[]): (name: string, fn: (...args: T[]) => void, options?: number | TestOptions) => void</code><p>如果你有多个测试依赖相同的数据，可以使用 <code>describe.each</code>。<pre class="language-ts"><code class="language-ts">describe<span class="token punctuation">.</span><span class="token method function property-access">each</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'describe object add($a, $b)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">returns </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expected<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">returned value not be greater than </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expected<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeGreaterThan</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">returned value not be less than </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expected<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeLessThan</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>从 Vitest 0.25.3 开始，你可以使用模板字符串表。<ul><li>第一行应该是列名，使用 <code>|</code> 分隔；<li>使用 <code>${value}</code> 语法作为模板文本表达式，为一个或多个后续数据行提供数据。</ul><pre class="language-ts"><code class="language-ts">describe<span class="token punctuation">.</span><span class="token property-access">each</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  a             | b      | expected
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">          | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">   | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'a'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">        | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'ab'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">         | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">         | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'[object Object]b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span> asd<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'[object Object]b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">(</span><span class="token string">'describe template string add($a, $b)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">returns </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expected<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul><blockquote>当使用 Vitest 作为 [type checker](/guide/testing-types) 时，不能使用此语法。</blockquote></section></section><section id="expect"class="level2"><h2>expect</h2><ul><li><p><strong>类型:</strong> <code>ExpectStatic &#x26; (actual: any) => Assertions</code><p><code>expect</code> 用来创建断言。在当前上下文中，可以使用 <code>assertions</code> 方法来断言一个语句。 Vitest 默认提供 <code>chai</code> 进行断言，同时基于 <code>chai</code> 实现兼容 <code>Jest</code> 的断言语句。<p>例如，这里会断言 <code>input</code> 的值是否等于 <code>2</code> ，如果它们不相等，断言则会抛出错误，并且测试失败。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>

<span class="token function">expect</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// chai API</span>
<span class="token function">expect</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// jest API</span></code></pre><p>从技术上来说，这里并没有使用 <a href="#test"><code>test</code></a> 方法，所以我们在控制台会看到 Nodejs 的报错，而不是 Vitest 的报错。想要了解更多关于 <code>test</code> 的信息，请参阅 <a href="#test">test 章节</a>。<p>此外，<code>expect</code> 可用于静态访问匹配器功能，这个后面会介绍。</ul><blockquote>`expect` has no effect on testing types, if expression doesn't have a type error. If you want to use Vitest as [type checker](/guide/testing-types), use [`expectTypeOf`](#expecttypeof) or [`assertType`](#asserttype).</blockquote><section id="not"class="level3"><h3>not</h3><p>使用 <code>not</code> 将会否定断言。举例，此代码断言 <code>input</code> 的值不等于 <code>2</code>。如果它们相等，断言则会抛出错误，并且测试失败。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>

<span class="token function">expect</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// chai API</span>
<span class="token function">expect</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// jest API</span></code></pre></section><section id="tobe"class="level3"><h3>toBe</h3><ul><li><p><strong>类型:</strong> <code>(value: any) => Awaitable&#x3C;void></code><p><code>toBe</code> 可用于断言基础对象是否相等，或者对象是否共享相同的引用。它相当于调用了 <code>expect(Object.is(3, 3)).toBe(true)</code>。 如果对象不相同，但你想检查它们的结构是否相同，则可以使用 <a href="#toequal"><code>toEqual</code></a>。<p>例如，下面的测试将会检查 stock 是否有 13 个苹果。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> stock <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'apples'</span><span class="token punctuation">,</span>
  count<span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'stock has 13 apples'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>stock<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>stock<span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'stocks are the same'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> refStock <span class="token operator">=</span> stock <span class="token comment">// 相同的引用</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>stock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>refStock<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>尽量不要将 <code>toBe</code> 与浮点数一起使用。由于 JavaScript 会对它们进行四舍五入，例如 <code>0.1 + 0.2</code> 的结果严格来说并不是 <code>0.3</code> 。如果需要可靠地断言浮点数，请使用 <code>toBeCloseTo</code> 进行断言。</ul></section><section id="tobecloseto"class="level3"><h3>toBeCloseTo</h3><ul><li><p><strong>类型:</strong> <code>(value: number, numDigits?: number) => Awaitable&#x3C;void></code><p>使用 <code>toBeCloseTo</code> 进行浮点数的比较。可以选择使用 <code>numDigits</code> 参数限制小数点后的检查位数。例如：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">fails</span><span class="token punctuation">(</span><span class="token string">'decimals are not equal in javascript'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">0.2</span> <span class="token operator">+</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span> <span class="token comment">// 0.2 + 0.1 is 0.30000000000000004</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'decimals are rounded to 5 after the point'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 0.2 + 0.1 is 0.30000 | "000000000004" removed</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">0.2</span> <span class="token operator">+</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeCloseTo</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token comment">// nothing from 0.30000000000000004 is removed</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">0.2</span> <span class="token operator">+</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeCloseTo</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tobedefined"class="level3"><h3>toBeDefined</h3><ul><li><p><strong>类型:</strong> <code>() => Awaitable&#x3C;void></code><p><code>toBeDefined</code> 断言检查值是否不等于 <code>undefined</code> 。在检查函数是否有返回值时非常有用。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> <span class="token function-variable function">getApples</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token number">3</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'function returned something'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeDefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tobeundefined"class="level3"><h3>toBeUndefined</h3><ul><li><p><strong>类型:</strong> <code>() => Awaitable&#x3C;void></code><p>与 <code>toBeDefined</code> 相反，<code>toBeUndefined</code> 断言检查值是否等于 <code>undefined</code> 。在检查函数是否没有返回任何内容时非常有用。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">function</span> <span class="token function">getApplesFromStock</span><span class="token punctuation">(</span>stock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>stock <span class="token operator">===</span> <span class="token string">'Bill'</span><span class="token punctuation">)</span>
    <span class="token keyword control-flow">return</span> <span class="token number">13</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'mary doesn\'t have a stock'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getApplesFromStock</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeUndefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tobetruthy"class="level3"><h3>toBeTruthy</h3><ul><li><p><strong>类型:</strong> <code>() => Awaitable&#x3C;void></code><p><code>toBeTruthy</code> 会将检查值转换为布尔值，断言该值是否为 <code>true</code> 。该方法在当你不关心检查值的内容，而只想知道它是否可以转换为 <code>true</code> 时很有用。<p>例如下面这段代码，我们就不需要关心 <code>stocks.getInfo</code> 的返回值，可能是复杂的对象、字符串或者是其他内容，代码仍然可以运行。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Stocks</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stocks'</span>
<span class="token keyword">const</span> stocks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Stocks</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
stocks<span class="token punctuation">.</span><span class="token method function property-access">sync</span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span>
<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>stocks<span class="token punctuation">.</span><span class="token method function property-access">getInfo</span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  stocks<span class="token punctuation">.</span><span class="token method function property-access">sell</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token string">'Bill'</span><span class="token punctuation">)</span></code></pre><p>所以如果我们想测试 <code>stocks.getInfo</code> 是否为 true，我们可以这样写：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Stocks</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stocks'</span>
<span class="token keyword">const</span> stocks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Stocks</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'if we know Bill stock, sell apples to him'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  stocks<span class="token punctuation">.</span><span class="token method function property-access">sync</span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>stocks<span class="token punctuation">.</span><span class="token method function property-access">getInfo</span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>JavaScript 中除了 <code>false</code> ，<code>0</code> ，<code>''</code> ，<code>null</code> ，<code>undefined</code> 和 <code>NaN</code>，其他一切都是为真。</ul></section><section id="tobefalsy"class="level3"><h3>toBeFalsy</h3><ul><li><p><strong>类型:</strong> <code>() => Awaitable&#x3C;void></code><p><code>toBeFalsy</code> 会将检测值转换为布尔值，断言该值是否为 <code>false</code>。该方法在当你不关心该检查值的内容，但只想知道它是否可以转换为 <code>false</code> 时很有用。<p>例如下面这段代码，我们就不需要关心 <code>stocks.stockFailed</code> 的返回值，可能是复杂的对象、字符串或者是其他内容，代码仍然可以运行。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Stocks</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stocks'</span>
<span class="token keyword">const</span> stocks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Stocks</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
stocks<span class="token punctuation">.</span><span class="token method function property-access">sync</span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span>
<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>stocks<span class="token punctuation">.</span><span class="token method function property-access">stockFailed</span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  stocks<span class="token punctuation">.</span><span class="token method function property-access">sell</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token string">'Bill'</span><span class="token punctuation">)</span></code></pre><p>所以如果我们想测试 <code>stocks.stockFailed</code> 是否为 false，我们可以这样写：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Stocks</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stocks'</span>
<span class="token keyword">const</span> stocks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Stocks</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'if Bill stock hasn\'t failed, sell apples to him'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  stocks<span class="token punctuation">.</span><span class="token method function property-access">syncStocks</span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>stocks<span class="token punctuation">.</span><span class="token method function property-access">stockFailed</span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeFalsy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>JavaScript 中除了 <code>false</code> ，<code>0</code> ，<code>''</code> ，<code>null</code> ，<code>undefined</code> 和 <code>NaN</code>，其他一切都是为真。</ul></section><section id="tobenull"class="level3"><h3>toBeNull</h3><ul><li><p><strong>类型:</strong> <code>() => Awaitable&#x3C;void></code><p><code>toBeNull</code> 将简单地断言检查值是否为 <code>null</code>。 是 <code>.toBe(null)</code> 的别名。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">function</span> <span class="token function">apples</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'we don\'t have apples'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">apples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tobenan"class="level3"><h3>toBeNaN</h3><ul><li><p><strong>类型:</strong> <code>() => Awaitable&#x3C;void></code><p><code>toBeNaN</code> 将简单地断言是否为 <code>NaN</code>，是 <code>.toBe(NaN)</code> 的别名。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">function</span> <span class="token function">getApplesCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  i<span class="token operator">++</span>
  <span class="token keyword control-flow">return</span> i <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">NaN</span> <span class="token operator">:</span> i
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'getApplesCount has some unusual side effects...'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getApplesCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNaN</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getApplesCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNaN</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tobetypeof"class="level3"><h3>toBeTypeOf</h3><ul><li><p><strong>类型:</strong> <code>(c: 'bigint' | 'boolean' | 'function' | 'number' | 'object' | 'string' | 'symbol' | 'undefined') => Awaitable&#x3C;void></code><p><code>toBeTypeOf</code> 用于断言检查值是否属于接收的类型。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword">const</span> actual <span class="token operator">=</span> <span class="token string">'stock'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'stock is type of string'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>actual<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeTypeOf</span><span class="token punctuation">(</span><span class="token string">'string'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tobeinstanceof"class="level3"><h3>toBeInstanceOf</h3><ul><li><p><strong>类型:</strong> <code>(c: any) => Awaitable&#x3C;void></code><p><code>toBeInstanceOf</code> 用于断言检查值是否为接收的类的实例。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Stocks</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stocks'</span>
<span class="token keyword">const</span> stocks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Stocks</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'stocks are instance of Stocks'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>stocks<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeInstanceOf</span><span class="token punctuation">(</span><span class="token maybe-class-name">Stocks</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tobegreaterthan"class="level3"><h3>toBeGreaterThan</h3><ul><li><p><strong>类型:</strong> <code>(n: number | bigint) => Awaitable&#x3C;void></code><p><code>toBeGreaterThan</code> 用于断言检查值是否大于接收值，如果相等将无法通过测试。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> getApples <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stock'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'have more then 10 apples'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeGreaterThan</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tobegreaterthanorequal"class="level3"><h3>toBeGreaterThanOrEqual</h3><ul><li><p><strong>类型:</strong> <code>(n: number | bigint) => Awaitable&#x3C;void></code><p><code>toBeGreaterThanOrEqual</code> 用于断言检查值是否大于等于接收值。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> getApples <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stock'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'have 11 apples or more'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeGreaterThanOrEqual</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tobelessthan"class="level3"><h3>toBeLessThan</h3><ul><li><p><strong>类型:</strong> <code>(n: number | bigint) => Awaitable&#x3C;void></code><p><code>toBeLessThan</code> 用于断言检查值是否小于接收值，如果相等将无法通过测试。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> getApples <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stock'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'have less then 20 apples'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeLessThan</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tobelessthanorequal"class="level3"><h3>toBeLessThanOrEqual</h3><ul><li><p><strong>类型:</strong> <code>(n: number | bigint) => Awaitable&#x3C;void></code><p><code>toBeLessThanOrEqual</code> 用于断言检查值是否小于等于接收值。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> getApples <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stock'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'have 11 apples or less'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeLessThanOrEqual</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="toequal"class="level3"><h3>toEqual</h3><ul><li><p><strong>类型:</strong> <code>(received: any) => Awaitable&#x3C;void></code><p><code>toEqual</code> 断言检查值是否等于接收值，或者是同样的结构，如果是对象类型（将会使用递归的方法进行比较）。在本例中，你可以看到 <code>toEqual</code> 和 <code>toBe</code> 之间的区别：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> stockBill <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'apples'</span><span class="token punctuation">,</span>
  count<span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> stockMary <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'apples'</span><span class="token punctuation">,</span>
  count<span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'stocks have the same properties'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>stockBill<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span>stockMary<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'stocks are not the same'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>stockBill<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>stockMary<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>警告 该方法不会对 `Error` 对象执行深度相同比较。如果要测试是否抛出了某个错误，建议使用 [`toThrowError`](#tothrowerror) 断言。</blockquote></ul></section><section id="tostrictequal"class="level3"><h3>toStrictEqual</h3><ul><li><p><strong>类型:</strong> <code>(received: any) => Awaitable&#x3C;void></code><p><code>toStrictEqual</code> 断言检查值是否等于接收值或者同样的结构，如果是对象类型（将会使用递归的方法进行比较），并且会比较它们是否是相同的类型。<p>与 <a href="#toequal"><code>.toEqual</code></a> 之间的区别：<ul><li>检查属性值为 <code>undefined</code> 的键。例如使用 <code>.toStrictEqual</code> 时， <code>{a: undefined, b: 2}</code> 与 <code>{b: 2}</code> 不会匹配。<li>检查数组的稀疏性。 例如使用 <code>.toStrictEqual</code> 时，<code>[, 1]</code> 与 <code>[undefined, 1]</code> 不会匹配。<li>检查对象类型是否相等。例如具有字段 <code>a</code> 和 <code>b</code> 的实例对象不等于具有字段 <code>a</code> 和 <code>b</code> 的字面量对象。</ul><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">Stock</span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">type</span> <span class="token operator">=</span> type
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'structurally the same, but semantically different'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Stock</span></span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'apples'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Stock</span></span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toStrictEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'apples'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tocontain"class="level3"><h3>toContain</h3><ul><li><p><strong>类型:</strong> <code>(received: string) => Awaitable&#x3C;void></code><p><code>toContain</code> 用于断言检查值是否在数组中。还可以检查一个字符串是否为另一个字符串的子串。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> getAllFruits <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stock'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'the fruit list contains orange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getAllFruits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toContain</span><span class="token punctuation">(</span><span class="token string">'orange'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tocontainequal"class="level3"><h3>toContainEqual</h3><ul><li><p><strong>类型:</strong> <code>(received: any) => Awaitable&#x3C;void></code><p><code>toContainEqual</code> 用于断言在数组中是否包含具有特定结构和值的元素。它就像对每个元素进行 <a href="#toequal"><code>toEqual</code></a> 操作。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> getFruitStock <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./stock'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'apple available'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getFruitStock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toContainEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> fruit<span class="token operator">:</span> <span class="token string">'apple'</span><span class="token punctuation">,</span> count<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tohavelength"class="level3"><h3>toHaveLength</h3><ul><li><p><strong>类型:</strong> <code>(received: number) => Awaitable&#x3C;void></code><p><code>toHaveLength</code> 用于断言一个对象是否具有 <code>.length</code> 属性，并且它被设置为某个数值。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'toHaveLength'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveLength</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveLength</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveLength</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// .length 的值并不是3</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">{</span> length<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveLength</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tohaveproperty"class="level3"><h3>toHaveProperty</h3><ul><li><p><strong>类型:</strong> <code>(key: any, received?: any) => Awaitable&#x3C;void></code><p><code>toHaveProperty</code> 用于断言对象上是否存在指定 <code>key</code> 的属性。<p>同时该方法还提供了一个可选参数，用于进行深度对比，就像使用 <code>toEqual</code> 匹配器来比较接收到的属性值。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> invoice <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'isActive'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string-property property">'P.O'</span><span class="token operator">:</span> <span class="token string">'12345'</span><span class="token punctuation">,</span>
  <span class="token string-property property">'customer'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    first_name<span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
    last_name<span class="token operator">:</span> <span class="token string">'Doe'</span><span class="token punctuation">,</span>
    <span class="token dom variable">location</span><span class="token operator">:</span> <span class="token string">'China'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">'total_amount'</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
  <span class="token string-property property">'items'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'apples'</span><span class="token punctuation">,</span>
      quantity<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'oranges'</span><span class="token punctuation">,</span>
      quantity<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'John Doe Invoice'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'isActive'</span><span class="token punctuation">)</span> <span class="token comment">// 断言 key 存在</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'total_amount'</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span> <span class="token comment">// 断言 key 存在且值相等</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'account'</span><span class="token punctuation">)</span> <span class="token comment">// 断言 key 不存在</span>

  <span class="token comment">// 使用 dot 进行深度引用</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'customer.first_name'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'customer.last_name'</span><span class="token punctuation">,</span> <span class="token string">'Doe'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'customer.location'</span><span class="token punctuation">,</span> <span class="token string">'India'</span><span class="token punctuation">)</span>

  <span class="token comment">// 使用包含 key 的数组进行深度引用</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'items[0].type'</span><span class="token punctuation">,</span> <span class="token string">'apples'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'items.0.type'</span><span class="token punctuation">,</span> <span class="token string">'apples'</span><span class="token punctuation">)</span> <span class="token comment">// 使用 dot 也可以工作</span>

  <span class="token comment">// 在数组中包装你的 key 来避免它作为深度引用</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>invoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'P.O'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'12345'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tomatch"class="level3"><h3>toMatch</h3><ul><li><p><strong>类型:</strong> <code>(received: string | regexp) => Awaitable&#x3C;void></code><p><code>toMatch</code> 用于断言字符串是否匹配指定的正则表达式或字符串。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'top fruits'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'top fruits include apple, orange and grape'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatch</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">apple</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'applefruits'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatch</span><span class="token punctuation">(</span><span class="token string">'fruit'</span><span class="token punctuation">)</span> <span class="token comment">// toMatch 也可以是一个字符串</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tomatchobject"class="level3"><h3>toMatchObject</h3><ul><li><p><strong>类型:</strong> <code>(received: object | array) => Awaitable&#x3C;void></code><p><code>toMatchObject</code> 用于断言对象是否匹配指定的对象属性的子集。<p>我们还可以传递对象数组。如果我们只想检查两个数组的元素数量是否匹配，该方法就会很有用，它不同于 <code>arrayContaining</code> ，它允许接收数组中的额外元素。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> johnInvoice <span class="token operator">=</span> <span class="token punctuation">{</span>
  isActive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  customer<span class="token operator">:</span> <span class="token punctuation">{</span>
    first_name<span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
    last_name<span class="token operator">:</span> <span class="token string">'Doe'</span><span class="token punctuation">,</span>
    <span class="token dom variable">location</span><span class="token operator">:</span> <span class="token string">'China'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  total_amount<span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
  items<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'apples'</span><span class="token punctuation">,</span>
      quantity<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'oranges'</span><span class="token punctuation">,</span>
      quantity<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> johnDetails <span class="token operator">=</span> <span class="token punctuation">{</span>
  customer<span class="token operator">:</span> <span class="token punctuation">{</span>
    first_name<span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
    last_name<span class="token operator">:</span> <span class="token string">'Doe'</span><span class="token punctuation">,</span>
    <span class="token dom variable">location</span><span class="token operator">:</span> <span class="token string">'China'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'invoice has john personal details'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>johnInvoice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchObject</span><span class="token punctuation">(</span>johnDetails<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'the number of elements must match exactly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 断言对象数组是否匹配</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> baz<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchObject</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> baz<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tothrowerror"class="level3"><h3>toThrowError</h3><ul><li><p><strong>类型:</strong> <code>(received: any) => Awaitable&#x3C;void></code><li><p><strong>别名:</strong> <code>toThrow</code><p><code>toThrowError</code> 用于断言函数在调用时是否抛出错误。<p>例如，如果我们想测试 <code>getFruitStock('pineapples')</code> 是否会抛出异常，我们可以这样写：<p>你可以提供一个可选参数来测试是否引发了指定的错误：<ul><li>正则表达式：错误信息通过正则表达式匹配<li>字符串：错误消息包含指定子串</ul><blockquote>提示 你必须将代码包装在一个函数中，否则将无法捕获错误并且断言将会失败。</blockquote><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">function</span> <span class="token function">getFruitStock</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'pineapples'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">DiabetesError</span></span><span class="token punctuation">(</span>
      <span class="token string">'Pineapples is not good for people with diabetes'</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 可以做一些其他的事情</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'throws on pineapples'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 测试错误消息是否在某处显示 "diabetes" ：这些是等效的</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">getFruitStock</span><span class="token punctuation">(</span><span class="token string">'pineapples'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toThrowError</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">diabetes</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">getFruitStock</span><span class="token punctuation">(</span><span class="token string">'pineapples'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toThrowError</span><span class="token punctuation">(</span><span class="token string">'diabetes'</span><span class="token punctuation">)</span>

  <span class="token comment">// 测试确切的错误信息</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">getFruitStock</span><span class="token punctuation">(</span><span class="token string">'pineapples'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toThrowError</span><span class="token punctuation">(</span>
    <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^Pineapples is not good for people with diabetes$</span><span class="token regex-delimiter">/</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>要测试异步函数，请结合使用 [rejects](#rejects)。</blockquote></ul></section><section id="tomatchsnapshot"class="level3"><h3>toMatchSnapshot</h3><ul><li><p><strong>类型:</strong> <code>&#x3C;T>(shape?: Partial&#x3C;T> | string, message?: string) => void</code><p>这可确保某个值匹配最近的快照。<p>你可以提供附加到测试名称的可选 <code>hint</code> 字符串参数。 尽管 Vitest 总是在快照名称的末尾附加一个数字，但在区分单个 it 或测试块中的多个快照时，简短的描述性提示可能比数字更有用。 Vitest 在相应的 <code>.snap</code> 文件中按名称对快照进行排序。<blockquote>提示 当快照不匹配导致测试失败时，如果不匹配是预期的，你可以按 `u` 键更新一次快照。 或者可以通过 `-u` 或 `--update` CLI 选项使 Vitest 始终更新测试。</blockquote><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'matches snapshot'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Set</span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'snapshot'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>如果你只是测试一个对象的结构，并且不需要它是 100% 兼容的，还可以提供一个对象的结构：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'matches snapshot'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Set</span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'snapshot'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">any</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Set</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tomatchinlinesnapshot"class="level3"><h3>toMatchInlineSnapshot</h3><ul><li><p><strong>类型:</strong> <code>&#x3C;T>(shape?: Partial&#x3C;T> | string, snapshot?: string, message?: string) => void</code><p>这可确保某个值匹配最近的快照。<p>Vitest 将 inlineSnapshot 字符串参数添加并更新到测试文件中的匹配器（而不是外部 <code>.snap</code> 文件）。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'matches inline snapshot'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Set</span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'snapshot'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token comment">// 当更新快照时，Vitest 将更新以下内容</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchInlineSnapshot</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    {
      "foo": Set {
        "bar",
        "snapshot",
      },
    }
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>如果你只是测试一个对象的结构，并且不需要它是 100% 兼容的，还可以提供一个对象的结构：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'matches snapshot'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Set</span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'snapshot'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchInlineSnapshot</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> foo<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">any</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Set</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    {
      "foo": Any&#x3C;Set>,
    }
  </span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tothrowerrormatchingsnapshot"class="level3"><h3>toThrowErrorMatchingSnapshot</h3><ul><li><p><strong>类型:</strong> <code>(message?: string) => void</code><p>与 <a href="#toMatchSnapshot"><code>toMatchSnapshot</code></a> 相同，但需要与 <a href="#tothrowerror"><code>toThrowError</code></a> 相同的值。<p>如果函数抛出<code>Error</code>，则快照将是错误消息。 否则，快照将是函数抛出的值。</ul></section><section id="tothrowerrormatchinginlinesnapshot"class="level3"><h3>toThrowErrorMatchingInlineSnapshot</h3><ul><li><p><strong>类型:</strong> <code>(snapshot?: string, message?: string) => void</code><p>与 <a href="#tomatchinlinesnapshot"><code>toMatchInlineSnapshot</code></a> 相同，但需要与 <a href="#tothrowerror"><code>toThrowError</code></a> 相同的值。<p>如果函数抛出<code>Error</code>，则快照将是错误消息。 否则，快照将是函数抛出的值。</ul></section><section id="tohavebeencalled"class="level3"><h3>toHaveBeenCalled</h3><ul><li><p><strong>类型:</strong> <code>() => Awaitable&#x3C;void></code><p>此断言可以测试一个函数是否被调用过。需要给 <code>expect</code> 传递一个监听函数。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> market <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">buy</span><span class="token punctuation">(</span>subject<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> buySpy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">spyOn</span><span class="token punctuation">(</span>market<span class="token punctuation">,</span> <span class="token string">'buy'</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>buySpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>buySpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="tohavebeencalledtimes"class="level3"><h3>toHaveBeenCalledTimes</h3><ul><li><strong>类型</strong>: <code>(amount: number) => Awaitable&#x3C;void></code></ul><p>此断言将会检查一个函数是否被调用了一定的次数。需要给 <code>expect</code> 传递一个监听函数。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> market <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">buy</span><span class="token punctuation">(</span>subject<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function called two times'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> buySpy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">spyOn</span><span class="token punctuation">(</span>market<span class="token punctuation">,</span> <span class="token string">'buy'</span><span class="token punctuation">)</span>

  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>buySpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="tohavebeencalledwith"class="level3"><h3>toHaveBeenCalledWith</h3><ul><li><strong>类型</strong>: <code>(...args: any[]) => Awaitable&#x3C;void></code></ul><p>此断言将会检查一个函数是否被调用过，并且传入了指定的参数。需要给 <code>expect</code> 传递一个监听函数。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> market <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">buy</span><span class="token punctuation">(</span>subject<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> buySpy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">spyOn</span><span class="token punctuation">(</span>market<span class="token punctuation">,</span> <span class="token string">'buy'</span><span class="token punctuation">)</span>

  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>buySpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>buySpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="tohavebeenlastcalledwith"class="level3"><h3>toHaveBeenLastCalledWith</h3><ul><li><strong>类型</strong>: <code>(...args: any[]) => Awaitable&#x3C;void></code></ul><p>此断言将会检查一个函数在最后一次被调用时，是否使用了某些参数。需要给 <code>expect</code> 传递一个监听函数。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> market <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">buy</span><span class="token punctuation">(</span>subject<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> buySpy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">spyOn</span><span class="token punctuation">(</span>market<span class="token punctuation">,</span> <span class="token string">'buy'</span><span class="token punctuation">)</span>

  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>buySpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenLastCalledWith</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>buySpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenLastCalledWith</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="tohavebeennthcalledwith"class="level3"><h3>toHaveBeenNthCalledWith</h3><ul><li><strong>类型</strong>: <code>(time: number, ...args: any[]) => Awaitable&#x3C;void></code></ul><p>此断言将会检查一个函数在第某次调用时是否使用了某些参数，从第 1 次开始。所以如果要检查第 2 次调用，你可以这样写 <code>.toHaveBeenNthCalledWith(2, ...)</code>。<p>需要给 <code>expect</code> 传递一个监听函数。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> market <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">buy</span><span class="token punctuation">(</span>subject<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'first call of spy function called with right params'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> buySpy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">spyOn</span><span class="token punctuation">(</span>market<span class="token punctuation">,</span> <span class="token string">'buy'</span><span class="token punctuation">)</span>

  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  market<span class="token punctuation">.</span><span class="token method function property-access">buy</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>buySpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenNthCalledWith</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'apples'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="tohavereturned"class="level3"><h3>toHaveReturned</h3><ul><li><strong>类型</strong>: <code>() => Awaitable&#x3C;void></code></ul><p>此断言检查一个函数是否至少成功返回了一次值（即没有抛出错误）。需要给 <code>expect</code> 传递一个监听函数。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> <span class="token function-variable function">getApplesPrice</span> <span class="token operator">=</span> <span class="token punctuation">(</span>amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token constant">PRICE</span> <span class="token operator">=</span> <span class="token number">10</span>
  <span class="token keyword control-flow">return</span> amount <span class="token operator">*</span> <span class="token constant">PRICE</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function returned a value'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> getPriceSpy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span>getApplesPrice<span class="token punctuation">)</span>

  <span class="token keyword">const</span> price <span class="token operator">=</span> <span class="token function">getPriceSpy</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>getPriceSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveReturned</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="tohavereturnedtimes"class="level3"><h3>toHaveReturnedTimes</h3><ul><li><strong>类型</strong>: <code>(amount: number) => Awaitable&#x3C;void></code></ul><p>此断言将会检查一个函数是否成功返回了确切的次数（即没有抛出错误）。需要给 <code>expect</code> 传递一个监听函数。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function returns a value two times'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sell <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span>product<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> product <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token function">sell</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">)</span>
  <span class="token function">sell</span><span class="token punctuation">(</span><span class="token string">'bananas'</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>sell<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveReturnedTimes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="tohavereturnedwith"class="level3"><h3>toHaveReturnedWith</h3><ul><li><strong>类型</strong>: <code>(returnValue: any) => Awaitable&#x3C;void></code></ul><p>此断言将会检查一个函数是否至少一次成功返回了指定的值（即没有抛出错误）。需要给 <code>expect</code> 传递一个监听函数。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function returns a product'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sell <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span>product<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> product <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token function">sell</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>sell<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveReturnedWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span> product<span class="token operator">:</span> <span class="token string">'apples'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="tohavelastreturnedwith"class="level3"><h3>toHaveLastReturnedWith</h3><ul><li><strong>类型</strong>: <code>(returnValue: any) => Awaitable&#x3C;void></code></ul><p>此断言将会检查一个函数是否在最后一次被调用时返回了指定的值。需要给 <code>expect</code> 传递一个监听函数。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function returns bananas on a last call'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sell <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span>product<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> product <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token function">sell</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">)</span>
  <span class="token function">sell</span><span class="token punctuation">(</span><span class="token string">'bananas'</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>sell<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveLastReturnedWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span> product<span class="token operator">:</span> <span class="token string">'bananas'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="tohaventhreturnedwith"class="level3"><h3>toHaveNthReturnedWith</h3><ul><li><strong>类型</strong>: <code>(time: number, returnValue: any) => Awaitable&#x3C;void></code></ul><p>此断言将会检查一个函数是否第某次被调用时返回了指定的值。需要给 <code>expect</code> 传递一个监听函数。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'spy function returns bananas on second call'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sell <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span>product<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> product <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token function">sell</span><span class="token punctuation">(</span><span class="token string">'apples'</span><span class="token punctuation">)</span>
  <span class="token function">sell</span><span class="token punctuation">(</span><span class="token string">'bananas'</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>sell<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveNthReturnedWith</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> product<span class="token operator">:</span> <span class="token string">'bananas'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="tosatisfy"class="level3"><h3>toSatisfy</h3><ul><li><strong>类型:</strong> <code>(predicate: (value: any) => boolean) => Awaitable&#x3C;void></code></ul><p>此断言检查一个值是否满足某个谓词。<pre class="language-ts"><code class="language-ts"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'toSatisfy()'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">isOdd</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> value <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!==</span> <span class="token number">0</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'pass with 0'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toSatisfy</span><span class="token punctuation">(</span>isOdd<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'pass with negotiation'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toSatisfy</span><span class="token punctuation">(</span>isOdd<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="resolves"class="level3"><h3>resolves</h3><ul><li><p><strong>类型:</strong> <code>Promisify&#x3C;Assertions></code><p><code>resolves</code> 可以在断言异步代码时有意地删除样板语法。使用它可以从待处理的 <code>Promise</code> 中去展开它的值，并使用通常的断言语句来断言它的值。如果 <code>Promise</code> 被拒绝，则断言将会失败。<p>它返回相同的 <code>Assertions</code> 对象，但所有匹配器现在都是返回 <code>Promise</code>，因此你需要使用 <code>await</code> 去阻塞它。同样也适用于 <code>chai</code> 断言。<p>例如，如果我们有一个函数，它调用 API 并返回一些数据，你可以使用下列代码来断言它的返回值：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">buyApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/buy/apples'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span>r <span class="token arrow operator">=></span> r<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'buyApples returns new stock id'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// toEqual 现在返回一个 Promise ，所以我们必须等待它</span>
  <span class="token keyword control-flow">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">buyApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">resolves</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// jest API</span>
  <span class="token keyword control-flow">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">buyApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">resolves</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// chai API</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>警告 如果没有等待断言，那么我们将有一个每次都会通过的误报测试。为了确保断言确实发生，我们可以使用 [`expect.assertions(number)`](#expect-assertions)。</blockquote></ul></section><section id="rejects"class="level3"><h3>rejects</h3><ul><li><p><strong>类型:</strong> <code>Promisify&#x3C;Assertions></code><p><code>rejects</code> 可以在断言异步代码时有意地删除样板语法。使用它可以来展开 <code>Promise</code> 被拒绝的原因，并使用通常的断言语句来断言它的值。如果 <code>Promise</code> 成功解决，则断言将失败。<p>它返回相同的 <code>Assertions</code> 对象，但所有匹配器现在都返回 <code>Promise</code>，因此你需要使用 <code>await</code> 去阻塞它。同样也适用于 <code>chai</code> 断言。<p>例如，如果我们有一个调用失败的函数，我们可以使用此代码来断言原因：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">buyApples</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>id<span class="token punctuation">)</span>
    <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span><span class="token punctuation">(</span><span class="token string">'no id'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'buyApples throws an error when no id provided'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// toThrow 现在返回一个 Promise ，所以你必须等待它</span>
  <span class="token keyword control-flow">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">buyApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">rejects</span><span class="token punctuation">.</span><span class="token method function property-access">toThrow</span><span class="token punctuation">(</span><span class="token string">'no id'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>警告 如果不等待断言，那么我们将有一个每次都会通过的误报测试。 为确保断言确实发生，我们可以使用 [`expect.assertions(number)`](#expect-assertions)。</blockquote></ul></section><section id="expectassertions"class="level3"><h3>expect.assertions</h3><ul><li><p><strong>类型:</strong> <code>(count: number) => void</code><p>在测试通过或失败后，它将会验证在测试期间调用了多少次断言。它常用于检查异步代码是否被调用了。<p>例如，如果我们有一个异步调用两个匹配器的函数，我们可以断言它们实际上是被调用的。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">doAsync</span><span class="token punctuation">(</span><span class="token spread operator">...</span>cbs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span>cbs<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">{</span> index <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'all assertions are called'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  expect<span class="token punctuation">.</span><span class="token method function property-access">assertions</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token keyword">function</span> <span class="token function">callback1</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">callback2</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">await</span> <span class="token function">doAsync</span><span class="token punctuation">(</span>callback1<span class="token punctuation">,</span> callback2<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="expecthasassertions"class="level3"><h3>expect.hasAssertions</h3><ul><li><p><strong>类型:</strong> <code>() => void</code><p>在测试通过或失败后，它将会验证在测试期间是否至少调用了一个断言。它常用于检查是否调用了异步代码。<p>例如，如果我们有一个调用回调的代码，我们可以在回调中进行断言，但如果我们不检查是否调用了断言，测试将始终通过。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> db <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./db'</span>

<span class="token keyword">const</span> cbs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">onSelect</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cbs<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 从 db 中选择后，我们调用所有的回调</span>
<span class="token keyword">function</span> <span class="token function">select</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> db<span class="token punctuation">.</span><span class="token method function property-access">select</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span>cbs<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span>cb <span class="token arrow operator">=></span> <span class="token function">cb</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'callback was called'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  expect<span class="token punctuation">.</span><span class="token method function property-access">hasAssertions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">onSelect</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 在选择时调用</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 如果不等待，测试将失败</span>
  <span class="token comment">// 如果你没有 expect.hasAssertions()，测试将通过</span>
  <span class="token keyword control-flow">await</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="expectanything"class="level3"><h3>expect.anything</h3><ul><li><p><strong>类型:</strong> <code>() => any</code><p>这种非对称匹配器在与相等检查一起使用时，将始终返回 <code>true</code>。 如果你只是想确保该属性存在时很有用。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'object has "apples" key'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">{</span> apples<span class="token operator">:</span> <span class="token number">22</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> apples<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">anything</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="expectany"class="level3"><h3>expect.any</h3><ul><li><p><strong>类型:</strong> <code>(constructor: unknown) => any</code><p>此非对称匹配器与相等检查一起使用时，仅当 value 是指定构造函数的实例时才会返回 <code>true</code> 。 如果你有一个每次都生成的值，并且只想知道它以正确的类型存在是很有用。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> generateId <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./generators'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'"id" is a number'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token function">generateId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">any</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Number</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="expectarraycontaining"class="level3"><h3>expect.arrayContaining</h3><ul><li><p><strong>类型:</strong> <code>&#x3C;T>(expected: T[]) => any</code><p>当与相等检查一起使用时，如果 value 是一个数组并包含指定的选项，则此非对称匹配器将返回 <code>true</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'basket includes fuji'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> basket <span class="token operator">=</span> <span class="token punctuation">{</span>
    varieties<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Empire'</span><span class="token punctuation">,</span> <span class="token string">'Fuji'</span><span class="token punctuation">,</span> <span class="token string">'Gala'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    count<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>basket<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    count<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    varieties<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">arrayContaining</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Fuji'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>提示 你可以将 `expect.not` 与此匹配器一起使用来否定预期值。</blockquote></ul></section><section id="expectobjectcontaining"class="level3"><h3>expect.objectContaining</h3><ul><li><p><strong>类型:</strong> <code>(expected: any) => any</code><p>当与相等检查一起使用时，如果 value 具有相似的结构，则此非对称匹配器将返回 <code>true</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'basket has empire apples'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> basket <span class="token operator">=</span> <span class="token punctuation">{</span>
    varieties<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">'Empire'</span><span class="token punctuation">,</span>
        count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>basket<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    varieties<span class="token operator">:</span> <span class="token punctuation">[</span>expect<span class="token punctuation">.</span><span class="token method function property-access">objectContaining</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Empire'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>提示 你可以将 `expect.not` 与此匹配器一起使用来否定预期值。</blockquote></ul></section><section id="expectstringcontaining"class="level3"><h3>expect.stringContaining</h3><ul><li><p><strong>类型:</strong> <code>(expected: any) => any</code><p>当与相等检查一起使用时，如果 value 是字符串并且包含指定的子字符串，则此非对称匹配器将返回 <code>true</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'variety has "Emp" in its name'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> variety <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Empire'</span><span class="token punctuation">,</span>
    count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>basket<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">stringContaining</span><span class="token punctuation">(</span><span class="token string">'Emp'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>提示 你可以将 `expect.not` 与此匹配器一起使用来否定预期值。</blockquote></ul></section><section id="expectstringmatching"class="level3"><h3>expect.stringMatching</h3><ul><li><p><strong>类型:</strong> <code>(expected: any) => any</code><p>当与相等检查一起使用时，如果 value 是字符串并且包含指定的子字符串或字符串匹配正则表达式，则此非对称匹配器将返回 <code>true</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'variety ends with "re"'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> variety <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Empire'</span><span class="token punctuation">,</span>
    count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>basket<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">stringMatching</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">re$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>提示 你可以将 `expect.not` 与此匹配器一起使用来否定预期值。</blockquote></ul></section><section id="expectaddsnapshotserializer"class="level3"><h3>expect.addSnapshotSerializer</h3><ul><li><p><strong>类型:</strong> <code>(plugin: PrettyFormatPlugin) => void</code><p>此方法在创建快照时添加调用的自定义序列化程序。 这是高级功能 - 如果你想了解更多信息，请阅读 <a href="/guide/snapshot#custom-serializer">自定义序列化程序指南</a>。<p>如果你要添加自定义序列化程序，则应在 <a href="../config.html#setupfiles"><code>setupFiles</code></a> 中调用此方法。 它将影响每个快照。<blockquote>提示 如果你以前使用 Vue CLI 和 Jest，可能需要安装 [jest-serializer-vue](https://www.npmjs.com/package/jest-serializer-vue)。 否则，你的快照将被包裹在一个字符串中，这会导致 `"` 被转义。</blockquote></ul></section><section id="expectextend"class="level3"><h3>expect.extend</h3><ul><li><p><strong>类型:</strong> <code>(matchers: MatchersObject) => void</code><p>你可以使用自己的扩展默认匹配器。 此函数用于使用自定义匹配器扩展匹配器对象。<p>当你以这种方式定义匹配器时，还创建了可以像 <code>expect.stringContaining</code> 一样使用的不对称匹配器。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'custom matchers'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  expect<span class="token punctuation">.</span><span class="token method function property-access">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">toBeFoo</span><span class="token operator">:</span> <span class="token punctuation">(</span>received<span class="token punctuation">,</span> expected<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>received <span class="token operator">!==</span> <span class="token string">'foo'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
          <span class="token function-variable function">message</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">expected </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>received<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> to be foo</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          pass<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token method function property-access">toBeFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote><p>如果你希望匹配器出现在每个测试中，应该在 <a href="../config.html#setupFiles"><code>setupFiles</code></a> 中调用此方法。</blockquote><p>这个函数与 Jest 的 <code>expect.extend</code> 兼容，因此任何使用它来创建自定义匹配器的库都可以与 Vitest 一起使用。<p>如果你使用的是 TypeScript，可以使用以下代码扩展默认的 Matchers 接口：<pre class="language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">CustomMatchers</span><span class="token operator">&#x3C;</span><span class="token constant">R</span> <span class="token operator">=</span> <span class="token builtin">unknown</span><span class="token operator">></span></span> <span class="token punctuation">{</span>
  <span class="token function">toBeFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">R</span>
<span class="token punctuation">}</span>

<span class="token keyword">declare</span> global <span class="token punctuation">{</span>
  <span class="token keyword">namespace</span> <span class="token maybe-class-name">Vi</span> <span class="token punctuation">{</span>
    <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">Assertion</span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token maybe-class-name">CustomMatchers</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">AsymmetricMatchersContaining</span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token maybe-class-name">CustomMatchers</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>注意: 增加 jest.Matchers 接口也可以工作。</blockquote><blockquote>提示 如果你想了解更多信息，请查看 [关于扩展匹配器的指南](/guide/extending-matchers)。</blockquote></ul></section></section><section id="expecttypeof"class="level2"><h2>expectTypeOf</h2><ul><li><strong>Type:</strong> <code>&#x3C;T>(a: unknown) => ExpectTypeOf</code></ul><section id="not-1"class="level3"><h3>not</h3><ul><li><strong>Type:</strong> <code>ExpectTypeOf</code></ul><p>You can negate all assertions, using <code>.not</code> property.</section><section id="toequaltypeof"class="level3"><h3>toEqualTypeOf</h3><ul><li><strong>Type:</strong> <code>&#x3C;T>(expected: T) => void</code></ul><p>This matcher will check, if types are fully equal to each other. This matcher will not fail, if two objects have different values, but the same type, but will fail, if object is missing a property.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">toEqualTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqualTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqualTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">toEqualTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section id="tomatchtypeof"class="level3"><h3>toMatchTypeOf</h3><ul><li><strong>Type:</strong> <code>&#x3C;T>(expected: T) => void</code></ul><p>This matcher checks if expect type extends provided type. It is different from <code>toEqual</code> and is more similar to expect's <code>toMatch</code>. With this matcher you can check, if an object "matches" a type.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token generic-function"><span class="token function">expectTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">number</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">toMatchTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token generic-function"><span class="token function">expectTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">toMatchTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">number</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section id="extract"class="level3"><h3>extract</h3><ul><li><strong>Type:</strong> <code>ExpectTypeOf&#x3C;ExtractedUnion></code></ul><p>You can use <code>.extract</code> to narrow down types for further testing.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">ResponsiveProp</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">{</span> xs<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span> sm<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span> md<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> getResponsiveProp <span class="token operator">=</span> <span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>_props<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">ResponsiveProp</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">CSSProperties</span></span> <span class="token punctuation">{</span>
  margin<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  padding<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> cssProperties<span class="token operator">:</span> <span class="token maybe-class-name">CSSProperties</span> <span class="token operator">=</span> <span class="token punctuation">{</span> margin<span class="token operator">:</span> <span class="token string">'1px'</span><span class="token punctuation">,</span> padding<span class="token operator">:</span> <span class="token string">'2px'</span> <span class="token punctuation">}</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token function">getResponsiveProp</span><span class="token punctuation">(</span>cssProperties<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token generic-function"><span class="token function">extract</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> xs<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// extracts the last type from a union</span>
  <span class="token punctuation">.</span><span class="token generic-function"><span class="token function">toEqualTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token punctuation">{</span>
    xs<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">CSSProperties</span>
    sm<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">CSSProperties</span>
    md<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">CSSProperties</span>
  <span class="token punctuation">}</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token function">getResponsiveProp</span><span class="token punctuation">(</span>cssProperties<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token generic-function"><span class="token function">extract</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// extracts an array from a union</span>
  <span class="token punctuation">.</span><span class="token generic-function"><span class="token function">toEqualTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">CSSProperties</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><blockquote>If no type is found in the union, `.extract` will return `never`.</blockquote></section><section id="exclude"class="level3"><h3>exclude</h3><ul><li><strong>Type:</strong> <code>ExpectTypeOf&#x3C;NonExcludedUnion></code></ul><p>You can use <code>.exclude</code> to remove types from a union for further testing.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">ResponsiveProp</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">{</span> xs<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span> sm<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span> md<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> getResponsiveProp <span class="token operator">=</span> <span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>_props<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">ResponsiveProp</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">CSSProperties</span></span> <span class="token punctuation">{</span>
  margin<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  padding<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> cssProperties<span class="token operator">:</span> <span class="token maybe-class-name">CSSProperties</span> <span class="token operator">=</span> <span class="token punctuation">{</span> margin<span class="token operator">:</span> <span class="token string">'1px'</span><span class="token punctuation">,</span> padding<span class="token operator">:</span> <span class="token string">'2px'</span> <span class="token punctuation">}</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token function">getResponsiveProp</span><span class="token punctuation">(</span>cssProperties<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token generic-function"><span class="token function">exclude</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token generic-function"><span class="token function">exclude</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> xs<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span> <span class="token punctuation">}</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// or just .exclude&#x3C;unknown[] | { xs?: unknown }>()</span>
  <span class="token punctuation">.</span><span class="token generic-function"><span class="token function">toEqualTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">CSSProperties</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><blockquote>If no type is found in the union, `.exclude` will return `never`.</blockquote></section><section id="returns"class="level3"><h3>returns</h3><ul><li><strong>Type:</strong> <code>ExpectTypeOf&#x3C;ReturnValue></code></ul><p>You can use <code>.returns</code> to extract return value of a function type.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">returns</span><span class="token punctuation">.</span><span class="token method function property-access">toBeVoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> a<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">returns</span><span class="token punctuation">.</span><span class="token method function property-access">toEqualTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><blockquote>If used on a non-function type, it will return `never`, so you won't be able to chain it with other matchers.</blockquote></section><section id="parameters"class="level3"><h3>parameters</h3><ul><li><strong>Type:</strong> <code>ExpectTypeOf&#x3C;Parameters></code></ul><p>You can extract function arguments with <code>.parameters</code> to perform assertions on its value. Parameters are returned as an array.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">NoParam</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">void</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">HasParam</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">void</span>

<span class="token generic-function"><span class="token function">expectTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">NoParam</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">parameters</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">toEqualTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token generic-function"><span class="token function">expectTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">HasParam</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">parameters</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">toEqualTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><blockquote>If used on a non-function type, it will return `never`, so you won't be able to chain it with other matchers.</blockquote><blockquote>You can also use [`.toBeCallableWith`](#tobecallablewith) matcher as a more expressive assertion.</blockquote></section><section id="parameter"class="level3"><h3>parameter</h3><ul><li><strong>Type:</strong> <code>(nth: number) => ExpectTypeOf</code></ul><p>You can extract a certain function argument with <code>.parameter(number)</code> call to perform other assertions on it.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">parameter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">parameter</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><blockquote>If used on a non-function type, it will return `never`, so you won't be able to chain it with other matchers.</blockquote></section><section id="constructorparameters"class="level3"><h3>constructorParameters</h3><ul><li><strong>Type:</strong> <code>ExpectTypeOf&#x3C;ConstructorParameters></code></ul><p>You can extract constructor parameters as an array of values and perform assertions on them with this method.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">constructorParameters</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">toEqualTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span>
  <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token known-class-name class-name">Date</span><span class="token punctuation">]</span>
<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><blockquote>If used on a non-function type, it will return `never`, so you won't be able to chain it with other matchers.</blockquote><blockquote>You can also use [`.toBeConstructibleWith`](#tobeconstructiblewith) matcher as a more expressive assertion.</blockquote></section><section id="instance"class="level3"><h3>instance</h3><ul><li><strong>Type:</strong> <code>ExpectTypeOf&#x3C;ConstructableInstance></code></ul><p>This property gives access to matchers that can be performed on an instance of the provided class.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">instance</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'toISOString'</span><span class="token punctuation">)</span></code></pre><blockquote>If used on a non-function type, it will return `never`, so you won't be able to chain it with other matchers.</blockquote></section><section id="items"class="level3"><h3>items</h3><ul><li><strong>Type:</strong> <code>ExpectTypeOf&#x3C;T></code></ul><p>You can get array item type with <code>.items</code> to perform further assertions.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">items</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">toEqualTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">number</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">items</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">toEqualTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section id="resolves-1"class="level3"><h3>resolves</h3><ul><li><strong>Type:</strong> <code>ExpectTypeOf&#x3C;ResolvedPromise></code></ul><p>This matcher extracts resolved value of a <code>Promise</code>, so you can perform other assertions on it.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> <span class="token function-variable function">asyncFunc</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token number">123</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span>asyncFunc<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">returns</span><span class="token punctuation">.</span><span class="token property-access">resolves</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">resolves</span><span class="token punctuation">.</span><span class="token method function property-access">toBeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><blockquote>If used on a non-promise type, it will return `never`, so you won't be able to chain it with other matchers.</blockquote></section><section id="guards"class="level3"><h3>guards</h3><ul><li><strong>Type:</strong> <code>ExpectTypeOf&#x3C;Guard></code></ul><p>This matcher extracts guard value (e.g., <code>v is number</code>), so you can perform assertions on it.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> isString <span class="token operator">=</span> <span class="token punctuation">(</span>v<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> v <span class="token keyword">is</span> <span class="token builtin">string</span> <span class="token arrow operator">=></span> <span class="token keyword">typeof</span> v <span class="token operator">===</span> <span class="token string">'string'</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span>isString<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">guards</span><span class="token punctuation">.</span><span class="token method function property-access">toBeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><blockquote>Returns `never`, if the value is not a guard function, so you won't be able to chain it with other matchers.</blockquote></section><section id="asserts"class="level3"><h3>asserts</h3><ul><li><strong>Type:</strong> <code>ExpectTypeOf&#x3C;Assert></code></ul><p>This matcher extracts assert value (e.g., <code>assert v is number</code>), so you can perform assertions on it.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> assertNumber <span class="token operator">=</span> <span class="token punctuation">(</span>v<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">asserts</span> v <span class="token keyword">is</span> <span class="token builtin">number</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> v <span class="token operator">!==</span> <span class="token string">'number'</span><span class="token punctuation">)</span>
    <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">TypeError</span></span><span class="token punctuation">(</span><span class="token string">'Nope !'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span>assertNumber<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">asserts</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><blockquote>Returns `never`, if the value is not an assert function, so you won't be able to chain it with other matchers.</blockquote></section><section id="tobeany"class="level3"><h3>toBeAny</h3><ul><li><strong>Type:</strong> <code>() => void</code></ul><p>With this matcher you can check, if provided type is <code>any</code> type. If the type is too specific, the test will fail.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token generic-function"><span class="token function">expectTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">any</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeAny</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword module">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeAny</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeAny</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section id="tobeunknown"class="level3"><h3>toBeUnknown</h3><ul><li><strong>Type:</strong> <code>() => void</code></ul><p>This matcher checks, if provided type is <code>unknown</code> type.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeUnknown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword module">as</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeUnknown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeUnknown</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section id="tobenever"class="level3"><h3>toBeNever</h3><ul><li><strong>Type:</strong> <code>() => void</code></ul><p>This matcher checks, if provided type is a <code>never</code> type.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token generic-function"><span class="token function">expectTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">never</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNever</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">never</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">returns</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNever</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section id="tobefunction"class="level3"><h3>toBeFunction</h3><ul><li><strong>Type:</strong> <code>() => void</code></ul><p>This matcher checks, if provided type is a <code>functon</code>.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">never</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section id="tobeobject"class="level3"><h3>toBeObject</h3><ul><li><strong>Type:</strong> <code>() => void</code></ul><p>This matcher checks, if provided type is an <code>object</code>.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section id="tobearray"class="level3"><h3>toBeArray</h3><ul><li><strong>Type:</strong> <code>() => void</code></ul><p>This matcher checks, if provided type is <code>Array&#x3C;T></code>.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section id="tobestring"class="level3"><h3>toBeString</h3><ul><li><strong>Type:</strong> <code>() => void</code></ul><p>This matcher checks, if provided type is a <code>string</code>.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section id="tobeboolean"class="level3"><h3>toBeBoolean</h3><ul><li><strong>Type:</strong> <code>() => void</code></ul><p>This matcher checks, if provided type is <code>boolean</code>.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeBoolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeBoolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token generic-function"><span class="token function">expectTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">boolean</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeBoolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section id="tobevoid"class="level3"><h3>toBeVoid</h3><ul><li><strong>Type:</strong> <code>() => void</code></ul><p>This matcher checks, if provided type is <code>void</code>.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">returns</span><span class="token punctuation">.</span><span class="token method function property-access">toBeVoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token generic-function"><span class="token function">expectTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeVoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section id="tobesymbol"class="level3"><h3>toBeSymbol</h3><ul><li><strong>Type:</strong> <code>() => void</code></ul><p>This matcher checks, if provided type is a <code>symbol</code>.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Symbol</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeSymbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token generic-function"><span class="token function">expectTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">symbol</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeSymbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section id="tobenull-1"class="level3"><h3>toBeNull</h3><ul><li><strong>Type:</strong> <code>() => void</code></ul><p>This matcher checks, if provided type is <code>null</code>.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token generic-function"><span class="token function">expectTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token keyword null nil">null</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token keyword nil">undefined</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section id="tobeundefined-1"class="level3"><h3>toBeUndefined</h3><ul><li><strong>Type:</strong> <code>() => void</code></ul><p>This matcher checks, if provided type is <code>undefined</code>.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token keyword nil">undefined</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeUndefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token generic-function"><span class="token function">expectTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token keyword nil">undefined</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeUndefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeUndefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section id="tobenullable"class="level3"><h3>toBeNullable</h3><ul><li><strong>Type:</strong> <code>() => void</code></ul><p>This matcher checks, if you can use <code>null</code> or <code>undefined</code> with provided type.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token generic-function"><span class="token function">expectTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword nil">undefined</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNullable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token generic-function"><span class="token function">expectTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword null nil">null</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNullable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token generic-function"><span class="token function">expectTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword nil">undefined</span> <span class="token operator">|</span> <span class="token keyword null nil">null</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNullable</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section id="tobecallablewith"class="level3"><h3>toBeCallableWith</h3><ul><li><strong>Type:</strong> <code>() => void</code></ul><p>This matcher ensures you can call provided function with a set of parameters.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">NoParam</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">void</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">HasParam</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">void</span>

<span class="token generic-function"><span class="token function">expectTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">NoParam</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeCallableWith</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token generic-function"><span class="token function">expectTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">HasParam</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeCallableWith</span><span class="token punctuation">(</span><span class="token string">'some string'</span><span class="token punctuation">)</span></code></pre><blockquote>If used on a non-function type, it will return `never`, so you won't be able to chain it with other matchers.</blockquote></section><section id="tobeconstructiblewith"class="level3"><h3>toBeConstructibleWith</h3><ul><li><strong>Type:</strong> <code>() => void</code></ul><p>This matcher ensures you can create a new instance with a set of constructor parameters.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeConstructibleWith</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Date</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeConstructibleWith</span><span class="token punctuation">(</span><span class="token string">'01-01-2000'</span><span class="token punctuation">)</span></code></pre><blockquote>If used on a non-function type, it will return `never`, so you won't be able to chain it with other matchers.</blockquote></section><section id="tohaveproperty-1"class="level3"><h3>toHaveProperty</h3><ul><li><strong>Type:</strong> <code>&#x3C;K extends keyof T>(property: K) => ExpectTypeOf&#x3C;T[K></code></ul><p>This matcher checks if a property exists on provided object. If it exists, it also returns the same set of matchers for the type of this property, so you can chain assertions one after another.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span>

<span class="token function">expectTypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expectTypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section></section><section id="asserttype"class="level2"><h2>assertType</h2><ul><li><strong>Type:</strong> <code>&#x3C;T>(value: T): void</code></ul><p>You can use this function as an alternative for <code>expectTypeOf</code> to easily assert that argument type is equal to provided generic.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assertType <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">function</span> <span class="token function">concat</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token keyword">function</span> <span class="token function">concat</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token keyword">function</span> <span class="token function">concat</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span>

<span class="token generic-function"><span class="token function">assertType</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token generic-function"><span class="token function">assertType</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">number</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// @ts-expect-error wrong types</span>
<span class="token function">assertType</span><span class="token punctuation">(</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></section><section id="setup-and-teardown"class="level2"><h2>Setup and Teardown</h2><p>这些功能允许我们连接到测试的生命周期，以避免重复设置和拆卸代码。 它们适用于当前上下文：如果它们在顶层使用，则适用于文件；如果它们在 <code>describe</code> 块内，则适用于当前测试套件。<section id="beforeeach"class="level3"><h3>beforeEach</h3><ul><li><p><strong>类型:</strong> <code>beforeEach(fn: () => Awaitable&#x3C;void>, timeout?: number)</code><p>注册一个回调,在当前上下文中的每个测试运行之前被调用。 如果函数返回一个 <code>Promise</code>，<code>Vitest</code> 会等到 <code>Promise</code> 解决后再运行测试。<p>或者，我们可以传递一个超时（以毫秒为单位），定义在终止之前等待多长时间。 默认值为 5 秒。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> beforeEach <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 在每次测试运行之前清除模拟并添加一些测试数据</span>
  <span class="token keyword control-flow">await</span> <span class="token function">stopMocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword control-flow">await</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'John'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>这里的 <code>beforeEach</code> 确保为每个测试都添加用户。<p>从 Vitest v0.10.0 开始，<code>beforeEach</code> 还接受一个可选的清理功能（相当于 <code>afterEach</code>）。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> beforeEach <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 在所有测试运行之前调用一次</span>
  <span class="token keyword control-flow">await</span> <span class="token function">prepareSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 清理方法，在所有测试运行后调用一次</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">await</span> <span class="token function">resetSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="aftereach"class="level3"><h3>afterEach</h3><ul><li><p><strong>类型:</strong> <code>afterEach(fn: () => Awaitable&#x3C;void>, timeout?: number)</code><p>注册一个回调,在当前上下文中的每个测试运行之后被调用。 如果函数返回一个 Promise ，Vitest 会等到 Promise 解决后再继续。<p>或者，你可以设置超时（以毫秒为单位）以指定在终止前等待多长时间。 默认值为 5 秒。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> afterEach <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token function">clearTestingData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 每次测试运行后清除测试数据</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>这里的 <code>afterEach</code> 确保在每次测试运行后清除测试数据。</ul></section><section id="beforeall"class="level3"><h3>beforeAll</h3><ul><li><p><strong>类型:</strong> <code>beforeAll(fn: () => Awaitable&#x3C;void>, timeout?: number)</code><p>注册一个回调，在开始运行当前上下文中的所有测试之前被调用一次。 如果函数返回一个 <code>Promise</code>，<code>Vitest</code> 会等到 <code>Promise</code> 解决后再运行测试。<p>或者，你可以提供超时（以毫秒为单位）以指定在终止之前等待多长时间。 默认值为 5 秒。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> beforeAll <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token function">startMocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 在所有测试运行之前调用一次</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>这里的 <code>beforeAll</code> 确保在测试运行之前设置模拟数据。<p>从 Vitest v0.10.0 开始，<code>beforeAll</code> 还可以接受一个可选的清理功能（相当于 <code>afterAll</code>）。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> beforeAll <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 在所有测试运行之前调用一次</span>
  <span class="token keyword control-flow">await</span> <span class="token function">startMocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 清理函数，在所有测试运行后调用一次</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">await</span> <span class="token function">stopMocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="afterall"class="level3"><h3>afterAll</h3><ul><li><p><strong>类型:</strong> <code>afterAll(fn: () => Awaitable&#x3C;void>, timeout?: number)</code><p>注册一个回调，在当前上下文中运行所有测试后被调用一次。 如果函数返回一个 Promise，Vitest 会等到 Promise 解决后再继续。<p>或者，你可以提供超时（以毫秒为单位）以指定在终止之前等待多长时间。 默认值为 5 秒。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> afterAll <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">afterAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token function">stopMocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 在所有测试运行后调用此方法</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul><p>这里的 <code>afterAll</code> 确保在所有测试运行后调用 <code>stopMocking</code> 方法。</section></section><section id="vi"class="level2"><h2>Vi</h2><p>Vitest 通过 <strong>vi</strong> 提供工具函数来帮助你。你可以 <code>import { vi } from 'vitest'</code> 或 <strong>全局地</strong> 访问它 (当 <a href="../config.html#globals">globals configuration</a> <strong>启用</strong> 时)。<section id="viadvancetimersbytime"class="level3"><h3>vi.advanceTimersByTime</h3><ul><li><p><strong>类型:</strong> <code>(ms: number) => Vitest</code><p>就像 <code>runAllTimers</code> 一样工作，但会在经过几毫秒后结束。例如，这将输出 <code>1, 2, 3</code> 并且不会抛出：<pre class="language-ts"><code class="language-ts"><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>

vi<span class="token punctuation">.</span><span class="token method function property-access">advanceTimersByTime</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span></code></pre></ul></section><section id="viadvancetimerstonexttimer"class="level3"><h3>vi.advanceTimersToNextTimer</h3><ul><li><p><strong>类型:</strong> <code>() => Vitest</code><p>调用下一个可调用的计时器。这在每个计时器调用间隔内进行断言很有用。你可以链式调用它来自己管理计时器。<pre class="language-ts"><code class="language-ts"><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>

vi<span class="token punctuation">.</span><span class="token method function property-access">advanceTimersToNextTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// log 1</span>
  <span class="token punctuation">.</span><span class="token method function property-access">advanceTimersToNextTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// log 2</span>
  <span class="token punctuation">.</span><span class="token method function property-access">advanceTimersToNextTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// log 3</span></code></pre></ul></section><section id="vigettimercount"class="level3"><h3>vi.getTimerCount</h3><ul><li><p><strong>类型:</strong> <code>() => number</code><p>获取等待计时器的数量。</ul></section><section id="viclearallmocks"class="level3"><h3>vi.clearAllMocks</h3><p>将在所有对象监听(spies)上调用 <a href="../api.html#mockclear"><code>.mockClear()</code></a>。这将清除模拟对象(mock)历史，但不会将其实现重置为默认实现。</section><section id="viclearalltimers"class="level3"><h3>vi.clearAllTimers</h3><p>删除所有计划运行的计时器。这些计时器后续将不会运行。</section><section id="vidynamicimportsettled"class="level3"><h3>vi.dynamicImportSettled</h3><p>等待加载所有导入。 如果你有一个开始导入模块的同步调用时很有用，否则你不能等待。</section><section id="vifn"class="level3"><h3>vi.fn</h3><ul><li><p><strong>类型:</strong> <code>(fn?: Function) => CallableMockInstance</code><p>为函数创建一个监听，但也可以在没有监听的情况下启动。每次调用函数时，存储其调用参数、返回值和实例。此外，你可以使用 <a href="#mockinstance-methods">methods</a> 操纵它的行为。 如果没有给出函数，mock 将在调用时返回 <code>undefined</code>。<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> getApples <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">getApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">expect</span><span class="token punctuation">(</span>getApples<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>getApples<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveReturnedWith</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

getApples<span class="token punctuation">.</span><span class="token method function property-access">mockReturnValueOnce</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">getApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>getApples<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveNthReturnedWith</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span></code></pre></ul></section><section id="vigetmockedsystemtime"class="level3"><h3>vi.getMockedSystemTime</h3><ul><li><p><strong>类型</strong>: <code>() => Date | null</code><p>返回使用 <code>setSystemTime</code> 设置的模拟的当前日期。如果日期没有被模拟，将返回 <code>null</code>。</ul></section><section id="vigetrealsystemtime"class="level3"><h3>vi.getRealSystemTime</h3><ul><li><p><strong>类型</strong>: <code>() => number</code><p>使用 <code>vi.useFakeTimers</code> 时，会模拟 <code>Date.now</code> 调用。如果需要获取毫秒级的实时时间，你可以调用这个函数。</ul></section><section id="vimock"class="level3"><h3>vi.mock</h3><ul><li><p><strong>类型</strong>: <code>(path: string, factory?: () => unknown) => void</code><p>用另一个模块替换提供的 <code>path</code> 中的所有导入模块。你可以在路径中使用配置的 Vite 别名。对 <code>vi.mock</code> 的调用被提升，所以你在哪里调用它并不重要。它将始终在所有导入之前执行。<blockquote>`vi.mock` 仅适用于使用 `import` 关键字导入的模块。它不适用于 `require`。<p>Vitest 静态分析你的文件来提升 <code>vi.mock</code>。 这意味着你不能使用不是直接从 vitest 包（例如，从某些实用程序文件）导入的 vi。要解决此问题，请始终将 <code>vi.mock</code> 与从 vitest 导入的 <code>vi</code> 一起使用，或启用 <a href="../config.html#globals"><code>globals</code></a> 配置选项。</blockquote><p>如果定义了 <code>factory</code>，则所有导入都将返回其结果。Vitest 只调用一次工厂并缓存所有后续导入的结果，直到调用 <a href="#vi-unmock"><code>vi.unmock</code></a> 或 <a href="#vi-dounmock"><code>vi.doUnmock</code></a> 为止。<p>与 <code>jest</code> 不同，工厂可以是异步的，因此你可以在内部使用 <a href="#vi-importactual"><code>vi.importActual</code></a> 或作为第一个参数接收的助手来获取原始模块。<pre class="language-ts"><code class="language-ts">vi<span class="token punctuation">.</span><span class="token method function property-access">mock</span><span class="token punctuation">(</span><span class="token string">'./path/to/module.js'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>importOriginal<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> mod <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">importOriginal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token spread operator">...</span>mod<span class="token punctuation">,</span>
    <span class="token comment">// replace some exports</span>
    namedExport<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>`vi.mock` 被提升（换句话说，_moved_）到**文件顶部**。 这意味着无论何时你编写它（无论是在 `beforeEach` 还是 `test` 中），它实际上都会在此之前被调用。<p>这也意味着你不能在工厂内部使用在工厂外部定义的任何变量。<p>如果你需要在工厂内部使用变量，请尝试 <a href="#vi-domock"><code>vi.doMock</code></a>。它的工作方式相同，但没有被提升。请注意，它只会模拟后续导入。</blockquote><blockquote>如果你正在模拟具有默认导出的模块，则需要在返回的工厂函数对象中提供一个 `default` 键。这是一个特定于 ES 模块的警告，因此 `jest` 文档可能会有所不同，因为 `jest` 使用 CommonJS 模块。例如，<pre class="language-ts"><code class="language-ts">vi<span class="token punctuation">.</span><span class="token method function property-access">mock</span><span class="token punctuation">(</span><span class="token string">'./path/to/module.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token punctuation">{</span> myDefaultKey<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    namedExport<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// etc...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></blockquote><p>如果你正在模拟的文件同级有一个 <code>__mocks__</code> 文件夹，并且没有提供工厂，Vitest 将尝试在 <code>__mocks__</code> 子文件夹中找到一个具有相同名称的文件，并将其用作实际模块。 如果你正在模拟一个依赖项，Vitest 将尝试在项目的 <a href="../config.html#root">root</a> 中找到一个 <code>__mocks__</code> 文件夹（默认是 <code>process.cwd()</code>）。<p>例如，你具有以下类似的文件结构：<pre class="language-text"><code class="language-text">- __mocks__
  - axios.js
- src
  __mocks__
    - increment.js
  - increment.js
- tests
  - increment.test.js</code></pre><p>如果你在未提供工厂的情况下在测试文件中调用 <code>vi.mock</code>，它将在 <code>__mocks__</code> 文件夹中找到一个文件以用作模块：<pre class="language-ts"><code class="language-ts"><span class="token comment">// increment.test.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token comment">// axios is a default export from `__mocks__/axios.js`</span>
<span class="token keyword module">import</span> <span class="token imports">axios</span> <span class="token keyword module">from</span> <span class="token string">'axios'</span>
<span class="token comment">// increment is a named export from `src/__mocks__/increment.js`</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> increment <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'../increment.js'</span>

vi<span class="token punctuation">.</span><span class="token method function property-access">mock</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>
vi<span class="token punctuation">.</span><span class="token method function property-access">mock</span><span class="token punctuation">(</span><span class="token string">'../increment.js'</span><span class="token punctuation">)</span>

axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/apples/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span></code></pre><blockquote>请注意，如果你不调用 `vi.mock`，模块**不会**自动模拟。</blockquote><p>如果没有提供 <code>__mocks__</code> 文件夹或工厂，Vitest 将导入原始模块并自动模拟其所有导出。有关应用的规则，请参阅 <a href="/guide/mocking#%E8%87%AA%E5%8A%A8%E6%A8%A1%E6%8B%9F%E7%AE%97%E6%B3%95-automocking-algorithm">自动模拟算法</a>。</ul></section><section id="vidomock"class="level3"><h3>vi.doMock</h3><ul><li><p><strong>类型</strong>: <code>(path: string, factory?: () => unknown) => void</code><p>与 <a href="#vi-mock"><code>vi.mock</code></a> 相同，但它不会提升到文件顶部，因此你可以在全局文件范围内引用变量。模块的下一次导入将被模拟。 这不会模拟在调用之前导入的模块。</ul><pre class="language-ts"><code class="language-ts"><span class="token comment">// ./increment.js</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token builtin">number</span> <span class="token arrow operator">=></span> <span class="token builtin">number</span> <span class="token operator">+</span> <span class="token number">1</span></code></pre><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> beforeEach<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> increment <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./increment.js'</span>

<span class="token comment">// the module is not mocked, because vi.doMock is not called yet</span>
<span class="token function">increment</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">2</span>

<span class="token keyword">let</span> mockedIncrement <span class="token operator">=</span> <span class="token number">100</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// simple doMock doesn't clear the previous cache, so we need to clear it manually here</span>
  vi<span class="token punctuation">.</span><span class="token method function property-access">doUnmock</span><span class="token punctuation">(</span><span class="token string">'./increment.js'</span><span class="token punctuation">)</span>
  <span class="token comment">// you can access variables inside a factory</span>
  vi<span class="token punctuation">.</span><span class="token method function property-access">doMock</span><span class="token punctuation">(</span><span class="token string">'./increment.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">increment</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> mockedIncrement<span class="token operator">++</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'importing the next module imports mocked one'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// original import WAS NOT MOCKED, because vi.doMock is evaluated AFTER imports</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> increment<span class="token operator">:</span> mockedIncrement <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./increment.js'</span><span class="token punctuation">)</span>
  <span class="token comment">// new import returns mocked module</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">mockedIncrement</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">mockedIncrement</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">mockedIncrement</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="vimocked"class="level3"><h3>vi.mocked</h3><ul><li><p><strong>类型</strong>: <code>&#x3C;T>(obj: T, deep?: boolean) => MaybeMockedDeep&#x3C;T></code><li><p><strong>类型</strong>: <code>&#x3C;T>(obj: T, options?: { partial?: boolean; deep?: boolean }) => MaybePartiallyMockedDeep&#x3C;T></code><p>TypeScript 的类型助手。实际上只是返回传递的对象。<p>当 <code>partial</code> 为 <code>true</code> 时，它会期望 <code>Partial&#x3C;T></code> 作为返回值。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports">example</span> <span class="token keyword module">from</span> <span class="token string">'./example'</span>
vi<span class="token punctuation">.</span><span class="token method function property-access">mock</span><span class="token punctuation">(</span><span class="token string">'./example'</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'1+1 equals 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  vi<span class="token punctuation">.</span><span class="token method function property-access">mocked</span><span class="token punctuation">(</span>example<span class="token punctuation">.</span><span class="token property-access">calc</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">mockRestore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> res <span class="token operator">=</span> example<span class="token punctuation">.</span><span class="token method function property-access">calc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="viimportactual"class="level3"><h3>vi.importActual</h3><ul><li><p><strong>类型</strong>: <code>&#x3C;T>(path: string) => Promise&#x3C;T></code><p>导入模块，如果它应该被模拟，则绕过所有检查。如果你想部分模拟模块，这可能会很有用。<pre class="language-ts"><code class="language-ts">vi<span class="token punctuation">.</span><span class="token method function property-access">mock</span><span class="token punctuation">(</span><span class="token string">'./example'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token keyword control-flow">await</span> vi<span class="token punctuation">.</span><span class="token method function property-access">importActual</span><span class="token punctuation">(</span><span class="token string">'./example'</span><span class="token punctuation">)</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span>axios<span class="token punctuation">,</span> get<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="viimportmock"class="level3"><h3>vi.importMock</h3><ul><li><p><strong>类型</strong>: <code>&#x3C;T>(path: string) => Promise&#x3C;MaybeMockedDeep&#x3C;T>></code><p>导入一个被模拟的包含其所有属性 (包括嵌套属性) 的模块。遵循与 <a href="#vi-mock"><code>vi.mock</code></a> 相同的规则。有关应用的规则，请参阅 <a href="/guide/mocking#%E8%87%AA%E5%8A%A8%E6%A8%A1%E6%8B%9F%E7%AE%97%E6%B3%95-automocking-algorithm">自动模拟算法</a>。</ul></section><section id="viresetallmocks"class="level3"><h3>vi.resetAllMocks</h3><p>将在所有对象监听(spies)上调用 <a href="../api.html#mockreset"><code>.mockReset()</code></a>。这将清除模拟对象历史并将其实现重置为空函数（将返回 <code>undefined</code>）。</section><section id="viresetconfig"class="level3"><h3>vi.resetConfig</h3><ul><li><strong>类型</strong>: <code>RuntimeConfig</code></ul><p>如果之前调用了 <a href="../api.html#vi-setconfig"><code>vi.setConfig</code></a>，这会将配置重置为原始状态。</section><section id="viresetmodules"class="level3"><h3>vi.resetModules</h3><ul><li><p><strong>类型</strong>: <code>() => Vitest</code><p>通过清除所有模块的缓存来重置模块的注册表。在我们对隔离测试本地状态冲突的模块时很有用。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  vi<span class="token punctuation">.</span><span class="token method function property-access">resetModules</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'change state'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> mod <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./some/path'</span><span class="token punctuation">)</span>
  mod<span class="token punctuation">.</span><span class="token method function property-access">changeLocalState</span><span class="token punctuation">(</span><span class="token string">'new value'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mod<span class="token punctuation">.</span><span class="token method function property-access">getlocalState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token string">'new value'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'module has old state'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> mod <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./some/path'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mod<span class="token punctuation">.</span><span class="token method function property-access">getlocalState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token string">'old value'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul><blockquote>不重置模拟注册表。要清除模拟注册表，请使用 [`vi.unmock`](#vi-unmock) 或 [`vi.doUnmock`](#vi-dounmock)。</blockquote></section><section id="virestoreallmocks"class="level3"><h3>vi.restoreAllMocks</h3><p>将在所有对象监听(spies)上调用 <a href="../api.html#mockrestore"><code>.mockRestore()</code></a>。这将清除模拟对象历史并将其实现重置为原始实现。</section><section id="virestorecurrentdate"class="level3"><h3>vi.restoreCurrentDate</h3><ul><li><p><strong>类型</strong>: <code>() => void</code><p>将 <code>Date</code> 恢复为系统时间。</ul></section><section id="vistubenv"class="level3"><h3>vi.stubEnv</h3><ul><li><p><strong>类型:</strong> <code>(name: string, value: string) => Vitest</code><li><p><strong>版本:</strong> 从 Vitest 0.26.0 开始支持<p>更改 <code>process.env</code> 和 <code>import.meta.env</code> 上的环境变量值。你可以通过调用 <code>vi.unstubAllEnvs</code> 恢复它的值。</ul><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token comment">// `process.env.NODE_ENV` and `import.meta.env.NODE_ENV`</span>
<span class="token comment">// are "development" before calling "vi.stubEnv"</span>

vi<span class="token punctuation">.</span><span class="token method function property-access">stubEnv</span><span class="token punctuation">(</span><span class="token string">'NODE_ENV'</span><span class="token punctuation">,</span> <span class="token string">'production'</span><span class="token punctuation">)</span>

process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span>
<span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span>
<span class="token comment">// doesn't change other envs</span>
<span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">MODE</span> <span class="token operator">===</span> <span class="token string">'development'</span></code></pre><blockquote>你也可以通过简单地分配它来更改值，但是你将无法使用 `vi.unstubAllEnvs` 来恢复以前的值：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">MODE</span> <span class="token operator">=</span> <span class="token string">'test'</span></code></pre></blockquote><blockquote>Vitest 将所有 `import.meta.env` 调用转换为 `process.env`，因此它们可以在运行时轻松更改。 Node.js 只支持字符串值作为 env 参数，而 Vite 支持几种内置的 env 作为布尔值（即 `SSR`、`DEV`、`PROD`）。为了模仿 Vite，将 "truthy" 值设置为 env：使用 `''` 来代替 `false`，使用 `'1'` 来代替 `true`。<p>但请注意，在这种情况下，你不能依赖 <code>import.meta.env.DEV === false</code>。使用 <code>!import.meta.env.DEV</code>。这也会影响简单的分配，而不仅仅是 <code>vi.stubEnv</code> 方法。</blockquote></section><section id="viunstuballenvs"class="level3"><h3>vi.unstubAllEnvs</h3><ul><li><p><strong>类型:</strong> <code>() => Vitest</code><li><p><strong>版本:</strong> 从 Vitest 0.26.0 开始支持<p>恢复使用 <code>vi.stubEnv</code> 更改的所有 <code>import.meta.env</code> 和 <code>process.env</code> 值。第一次调用时，Vitest 会记住原始值并存储它，直到再次调用 <code>unstubAllEnvs</code>。</ul><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token comment">// `process.env.NODE_ENV` and `import.meta.env.NODE_ENV`</span>
<span class="token comment">// are "development" before calling stubEnv</span>

vi<span class="token punctuation">.</span><span class="token method function property-access">stubEnv</span><span class="token punctuation">(</span><span class="token string">'NODE_ENV'</span><span class="token punctuation">,</span> <span class="token string">'production'</span><span class="token punctuation">)</span>

process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span>
<span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span>

vi<span class="token punctuation">.</span><span class="token method function property-access">stubEnv</span><span class="token punctuation">(</span><span class="token string">'NODE_ENV'</span><span class="token punctuation">,</span> <span class="token string">'staging'</span><span class="token punctuation">)</span>

process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'staging'</span>
<span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'staging'</span>

vi<span class="token punctuation">.</span><span class="token method function property-access">unstubAllEnvs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// restores to the value that were stored before the first "stubEnv" call</span>
process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>
<span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span></code></pre></section><section id="vistubglobal"class="level3"><h3>vi.stubGlobal</h3><ul><li><p><strong>类型:</strong> <code>(name: string | number | symbol, value: uknown) => Vitest</code><p>改变全局变量的值。 你可以通过调用 <code>vi.unstubAllGlobals</code> 恢复其原始值。</ul><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token comment">// `innerWidth` is "0" before callling stubGlobal</span>

vi<span class="token punctuation">.</span><span class="token method function property-access">stubGlobal</span><span class="token punctuation">(</span><span class="token string">'innerWidth'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>

innerWidth <span class="token operator">===</span> <span class="token number">100</span>
globalThis<span class="token punctuation">.</span><span class="token property-access">innerWidth</span> <span class="token operator">===</span> <span class="token number">100</span>
<span class="token comment">// if you are using jsdom or happy-dom</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerWidth</span> <span class="token operator">===</span> <span class="token number">100</span></code></pre><blockquote>你也可以通过简单地将其分配给 `globalThis` 或 `window` 来更改值（如果你使用的是 `jsdom` 或 `happy-dom` 环境），但是您将无法使用 `vi.unstubAllGlobals` 来恢复原始值：<pre class="language-ts"><code class="language-ts">globalThis<span class="token punctuation">.</span><span class="token property-access">innerWidth</span> <span class="token operator">=</span> <span class="token number">100</span>
<span class="token comment">// if you are using jsdom or happy-dom</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerWidth</span> <span class="token operator">=</span> <span class="token number">100</span></code></pre></blockquote></section><section id="viunstuballglobals"class="level3"><h3>vi.unstubAllGlobals</h3><ul><li><p><strong>类型:</strong> <code>() => Vitest</code><li><p><strong>版本:</strong> 从 Vitest 0.26.0 开始支持<p>恢复 <code>globalThis</code>/<code>global</code>（和 <code>window</code>/<code>top</code>/<code>self</code>/<code>parent</code>，如果你使用 <code>jsdom</code> 或 <code>happy-dom</code> 环境）的所有全局值被 <code>vi.stubGlobal</code> 更改。第一次调用时，Vitest 会记住原始值并存储它，直到再次调用 <code>unstubAllGlobals</code>。</ul><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">Mock</span> <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// IntersectionObserver is "undefined" before calling "stubGlobal"</span>

vi<span class="token punctuation">.</span><span class="token method function property-access">stubGlobal</span><span class="token punctuation">(</span><span class="token string">'IntersectionObserver'</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Mock</span><span class="token punctuation">)</span>

<span class="token maybe-class-name">IntersectionObserver</span> <span class="token operator">===</span> <span class="token maybe-class-name">Mock</span>
global<span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">IntersectionObserver</span></span> <span class="token operator">===</span> <span class="token maybe-class-name">Mock</span>
globalThis<span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">IntersectionObserver</span></span> <span class="token operator">===</span> <span class="token maybe-class-name">Mock</span>
<span class="token comment">// if you are using jsdom or happy-dom</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">IntersectionObserver</span></span> <span class="token operator">===</span> <span class="token maybe-class-name">Mock</span>

vi<span class="token punctuation">.</span><span class="token method function property-access">unstubAllGlobals</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

globalThis<span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">IntersectionObserver</span></span> <span class="token operator">===</span> <span class="token keyword nil">undefined</span>
<span class="token string">'IntersectionObserver'</span> <span class="token keyword">in</span> globalThis <span class="token operator">===</span> <span class="token boolean">false</span>
<span class="token comment">// throws ReferenceError, because it's not defined</span>
<span class="token maybe-class-name">IntersectionObserver</span> <span class="token operator">===</span> <span class="token keyword nil">undefined</span></code></pre></section><section id="virunallticks"class="level3"><h3>vi.runAllTicks</h3><ul><li><p><strong>类型:</strong> <code>() => Vitest</code><p>调用每个微任务。它们通常排列在 <code>proccess.nextTick</code> 中。它也将运行它们自己安排的所有微任务。</ul></section><section id="virunalltimers"class="level3"><h3>vi.runAllTimers</h3><ul><li><p><strong>类型:</strong> <code>() => Vitest</code><p>此方法将调用每个被创建的计时器，直到计时器队列为空。这意味着在 <code>runAllTimers</code> 期间调用的每个计时器都将被触发。如果你有一个无限的区间，它会在 10000 次尝试后抛出。例如，这将输出 <code>1, 2, 3</code>：<pre class="language-ts"><code class="language-ts"><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">)</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>

vi<span class="token punctuation">.</span><span class="token method function property-access">runAllTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></ul></section><section id="virunonlypendingtimers"class="level3"><h3>vi.runOnlyPendingTimers</h3><ul><li><p><strong>类型:</strong> <code>() => Vitest</code><p>此方法将调用在 <code>vi.useFakeTimers()</code> 调用之后创建的每个计时器。它不会触发在其调用期间创建的任何计时器。例如，这只会输出 <code>1</code>：<pre class="language-ts"><code class="language-ts"><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>

vi<span class="token punctuation">.</span><span class="token method function property-access">runOnlyPendingTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></ul></section><section id="visetsystemtime"class="level3"><h3>vi.setSystemTime</h3><ul><li><p><strong>类型</strong>: <code>(date: string | number | Date) => void</code><p>将当前日期设置为一个过去的日期。所有 <code>Date</code> 调用都将返回此日期。<p>有助于你测试依赖当前日期的任何内容 —— 例如，你代码中的 <a href="https://github.com/moment/luxon/">luxon</a> 调用。<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Date</span></span><span class="token punctuation">(</span><span class="token number">1998</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span>

vi<span class="token punctuation">.</span><span class="token method function property-access">useFakeTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
vi<span class="token punctuation">.</span><span class="token method function property-access">setSystemTime</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span>

<span class="token function">expect</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token method function property-access">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

vi<span class="token punctuation">.</span><span class="token method function property-access">useRealTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></ul></section><section id="visetconfig"class="level3"><h3>vi.setConfig</h3><ul><li><strong>类型</strong>: <code>RuntimeConfig</code></ul><p>更新当前测试文件的配置。在执行测试时，你只影响使用的值。</section><section id="vispyon"class="level3"><h3>vi.spyOn</h3><ul><li><p><strong>类型:</strong> <code>&#x3C;T, K extends keyof T>(object: T, method: K, accessType?: 'get' | 'set') => MockInstance</code><p>在对象的方法或 getter/setter 上创建一个监听。<pre class="language-ts"><code class="language-ts"><span class="token keyword">let</span> apples <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">getApples</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token number">13</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> spy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">spyOn</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'getApples'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> apples<span class="token punctuation">)</span>
apples <span class="token operator">=</span> <span class="token number">1</span>

<span class="token function">expect</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token method function property-access">getApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveReturnedWith</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></code></pre></ul></section><section id="vistubglobal-1"class="level3"><h3>vi.stubGlobal</h3><ul><li><p><strong>类型</strong>: <code>(key: keyof globalThis &#x26; Window, value: any) => Vitest</code><p>给全局变量赋值。 如果你使用 <code>jsdom</code> 或 <code>happy-dom</code>，也可以将值放在 <code>window</code> 对象上。<p>请参考<a href="/guide/mocking.html#globals">"全局 Mock" 部分</a>查看更多。</ul></section><section id="viunmock"class="level3"><h3>vi.unmock</h3><ul><li><p><strong>类型</strong>: <code>(path: string) => void</code><p>从模拟注册表中删除模块。所有对导入的调用都将返回原始模块，即使它之前被模拟过。此调用被提升（移动）到文件的顶部，因此它只会取消模拟在 <code>setupFiles</code> 中定义的模块，例如。</ul></section><section id="vidounmock"class="level3"><h3>vi.doUnmock</h3><ul><li><p><strong>类型</strong>: <code>(path: string) => void</code><p>与 <a href="#vi-unmock"><code>vi.unmock</code></a> 相同，但不会提升到文件顶部。模块的下一次导入将导入原始模块而不是模拟。这不会取消模拟以前导入的模块。</ul><pre class="language-ts"><code class="language-ts"><span class="token comment">// ./increment.js</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token builtin">number</span> <span class="token arrow operator">=></span> <span class="token builtin">number</span> <span class="token operator">+</span> <span class="token number">1</span></code></pre><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> increment <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./increment.js'</span>

<span class="token comment">// increment is already mocked, because vi.mock is hoisted</span>
<span class="token function">increment</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">100</span>

<span class="token comment">// this is hoisted, and factory is called before the import on line 1</span>
vi<span class="token punctuation">.</span><span class="token method function property-access">mock</span><span class="token punctuation">(</span><span class="token string">'./increment.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">increment</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// all calls are mocked, and `increment` always returns 100</span>
<span class="token function">increment</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">100</span>
<span class="token function">increment</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">100</span>

<span class="token comment">// this is not hoisted, so other import will return unmocked module</span>
vi<span class="token punctuation">.</span><span class="token method function property-access">doUnmock</span><span class="token punctuation">(</span><span class="token string">'./increment.js'</span><span class="token punctuation">)</span>

<span class="token comment">// this STILL returns 100, because `vi.doUnmock` doesn't reevaluate a module</span>
<span class="token function">increment</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">100</span>
<span class="token function">increment</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">100</span>

<span class="token comment">// the next import is unmocked, now `increment` is the original function that returns count + 1</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> increment<span class="token operator">:</span> unmockedIncrement <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./increment.js'</span><span class="token punctuation">)</span>

<span class="token function">unmockedIncrement</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">2</span>
<span class="token function">unmockedIncrement</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">31</span></code></pre></section><section id="viusefaketimers"class="level3"><h3>vi.useFakeTimers</h3><ul><li><p><strong>类型:</strong> <code>() => Vitest</code><p>要启用模拟计时器，你需要调用此方法。它将包装对计时器的所有进一步调用 (例如 <code>setTimeout</code>、<code>setInterval</code>、<code>clearTimeout</code>、<code>clearInterval</code>、<code>nextTick</code>、<code>setImmediate</code>、<code>clearImmediate</code> 和 <code>Date</code>)，直到 <a href="#vi-useRealTimers"><code>vi.useRealTimers()</code></a> 被调用。<p>它的内部实现基于 <a href="https://github.com/sinonjs/fake-timers"><code>@sinonjs/fake-timers</code></a>。</ul></section><section id="viuserealtimers"class="level3"><h3>vi.useRealTimers</h3><ul><li><p><strong>类型:</strong> <code>() => Vitest</code><p>当计时器结束时，你可以调用此方法，将模拟计时器恢复其原始实现。之前运行的所有计时器将不会恢复。</ul></section></section><section id="mockinstance-methods"class="level2"><h2>MockInstance Methods</h2><section id="getmockname"class="level3"><h3>getMockName</h3><ul><li><p><strong>类型:</strong> <code>() => string</code><p>它返回使用 <code>.mockName(name)</code> 方法设置给模拟对象的名称。</ul></section><section id="mockclear"class="level3"><h3>mockClear</h3><ul><li><p><strong>类型:</strong> <code>() => MockInstance</code><p>清除每一个对象模拟调用的所有信息。调用后，<a href="#mock-calls"><code>spy.mock.calls</code></a>、<a href="#mock-results"><code>spy.mock.results</code></a> 将返回空数组。 如果你需要清理不同断言之间的对象监听，这会很有用。<p>如果你希望在每次测试之前自动调用此方法，你可以在配置中启用 <a href="../config.html#clearmocks"><code>clearMocks</code></a> 设置。</ul></section><section id="mockname"class="level3"><h3>mockName</h3><ul><li><p><strong>类型:</strong> <code>(name: string) => MockInstance</code><p>设置内部模拟对象名称。有助于查看哪些模拟对象导致断言失败。</ul></section><section id="mockimplementation"class="level3"><h3>mockImplementation</h3><ul><li><p><strong>类型:</strong> <code>(fn: Function) => MockInstance</code><p>接收一个用于模拟对象实现的函数。<p>例如:<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> mockFn <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">mockImplementation</span><span class="token punctuation">(</span>apples <span class="token arrow operator">=></span> apples <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">// or: vi.fn(apples => apples + 1);</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">NelliesBucket</span> <span class="token operator">=</span> <span class="token function">mockFn</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">BobsBucket</span> <span class="token operator">=</span> <span class="token function">mockFn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token maybe-class-name">NelliesBucket</span> <span class="token operator">===</span> <span class="token number">1</span> <span class="token comment">// true</span>
<span class="token maybe-class-name">BobsBucket</span> <span class="token operator">===</span> <span class="token number">2</span> <span class="token comment">// true</span>

mockFn<span class="token punctuation">.</span><span class="token property-access">mock</span><span class="token punctuation">.</span><span class="token property-access">calls</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token comment">// true</span>
mockFn<span class="token punctuation">.</span><span class="token property-access">mock</span><span class="token punctuation">.</span><span class="token property-access">calls</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">1</span> <span class="token comment">// true</span></code></pre></ul></section><section id="mockimplementationonce"class="level3"><h3>mockImplementationOnce</h3><ul><li><p><strong>类型:</strong> <code>(fn: Function) => MockInstance</code><p>接收一个只会被对象模拟函数调用一次，用于模拟对象实现的函数。可以链式调用，以便多个函数调用产生不同的结果。<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> myMockFn <span class="token operator">=</span> vi
  <span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockImplementationOnce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockImplementationOnce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token boolean">false</span><span class="token punctuation">)</span>

<span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// false</span></code></pre><p>当对象模拟函数执行完毕，它将调用 <code>vi.fn(() => defaultValue)</code> 或 <code>.mockImplementation(() => defaultValue)</code> 设置的默认实现。如果它们被调用：<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> myMockFn <span class="token operator">=</span> vi
  <span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token string">'default'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockImplementationOnce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token string">'first call'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockImplementationOnce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token string">'second call'</span><span class="token punctuation">)</span>

<span class="token comment">// 'first call', 'second call', 'default', 'default'</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></ul></section><section id="mockrejectedvalue"class="level3"><h3>mockRejectedValue</h3><ul><li><p><strong>类型:</strong> <code>(value: any) => MockInstance</code><p>当异步函数被调用时，接收一个将被拒绝 ( reject ) 的错误。<pre class="language-ts"><code class="language-ts"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'async test'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> asyncMock <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">mockRejectedValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span><span class="token punctuation">(</span><span class="token string">'Async error'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword control-flow">await</span> <span class="token function">asyncMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// throws "Async error"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="mockrejectedvalueonce"class="level3"><h3>mockRejectedValueOnce</h3><ul><li><p><strong>类型:</strong> <code>(value: any) => MockInstance</code><p>接收一个只会被对象模拟函数拒绝一次的值。如果链式调用，每个连续调用都将拒绝传入的值。<pre class="language-ts"><code class="language-ts"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'async test'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> asyncMock <span class="token operator">=</span> vi
    <span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">mockResolvedValueOnce</span><span class="token punctuation">(</span><span class="token string">'first call'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">mockRejectedValueOnce</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span><span class="token punctuation">(</span><span class="token string">'Async error'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword control-flow">await</span> <span class="token function">asyncMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// first call</span>
  <span class="token keyword control-flow">await</span> <span class="token function">asyncMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// throws "Async error"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="mockreset"class="level3"><h3>mockReset</h3><ul><li><p><strong>类型:</strong> <code>() => MockInstance</code><p>执行 <code>mockClear</code> 同样的操作，并将内部实现设置为空函数 (调用时返回 <code>undefined</code> )。当你想要完全重置一个模拟对象为其初始状态时，这会很有用。<p>如果你希望在每次测试之前自动调用此方法，你可以在配置中启用 <a href="../config.html#mockreset"><code>mockReset</code></a> 设置。</ul></section><section id="mockrestore"class="level3"><h3>mockRestore</h3><ul><li><p><strong>类型:</strong> <code>() => MockInstance</code><p>执行 <code>mockReset</code> 同样的操作，并将内部实现恢复为初始的函数。<p>请注意，从 <code>vi.fn()</code> 恢复模拟对象会将实现设置为返回 <code>undefined</code> 的空函数。恢复 <code>vi.fn(impl)</code> 会将实现恢复为 <code>impl</code>。<p>如果你希望在每次测试之前自动调用此方法，我们可以在配置中启用 <a href="../config.html#restoremocks"><code>restoreMocks</code></a> 设置。</ul></section><section id="mockresolvedvalue"class="level3"><h3>mockResolvedValue</h3><ul><li><p><strong>类型:</strong> <code>(value: any) => MockInstance</code><p>当异步函数被调用时，接收一个将被决议 ( resolve ) 的值。<pre class="language-ts"><code class="language-ts"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'async test'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> asyncMock <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">mockResolvedValue</span><span class="token punctuation">(</span><span class="token number">43</span><span class="token punctuation">)</span>

  <span class="token keyword control-flow">await</span> <span class="token function">asyncMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 43</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="mockresolvedvalueonce"class="level3"><h3>mockResolvedValueOnce</h3><ul><li><p><strong>类型:</strong> <code>(value: any) => MockInstance</code><p>接收一个只会被对象模拟函数决议一次的值。如果链式调用，每个连续调用都将决议传入的值。<pre class="language-ts"><code class="language-ts"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'async test'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> asyncMock <span class="token operator">=</span> vi
    <span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">mockResolvedValue</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">mockResolvedValueOnce</span><span class="token punctuation">(</span><span class="token string">'first call'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">mockResolvedValueOnce</span><span class="token punctuation">(</span><span class="token string">'second call'</span><span class="token punctuation">)</span>

  <span class="token keyword control-flow">await</span> <span class="token function">asyncMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// first call</span>
  <span class="token keyword control-flow">await</span> <span class="token function">asyncMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// second call</span>
  <span class="token keyword control-flow">await</span> <span class="token function">asyncMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// default</span>
  <span class="token keyword control-flow">await</span> <span class="token function">asyncMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// default</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="mockreturnthis"class="level3"><h3>mockReturnThis</h3><ul><li><p><strong>类型:</strong> <code>() => MockInstance</code><p>设置内部实现返回 <code>this</code> 上下文。</ul></section><section id="mockreturnvalue"class="level3"><h3>mockReturnValue</h3><ul><li><p><strong>类型:</strong> <code>(value: any) => MockInstance</code><p>接收一个调用对象模拟函数时将返回的值。<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> mock <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
mock<span class="token punctuation">.</span><span class="token method function property-access">mockReturnValue</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
<span class="token function">mock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 42</span>
mock<span class="token punctuation">.</span><span class="token method function property-access">mockReturnValue</span><span class="token punctuation">(</span><span class="token number">43</span><span class="token punctuation">)</span>
<span class="token function">mock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 43</span></code></pre></ul></section><section id="mockreturnvalueonce"class="level3"><h3>mockReturnValueOnce</h3><ul><li><p><strong>类型:</strong> <code>(value: any) => MockInstance</code><p>接收一个只会被对象模拟函数返回一次的值。如果链式调用，每个连续调用都会返回传入的值。当没有更多的 <code>mockReturnValueOnce</code> 值要使用时，调用由 <code>mockImplementation</code> 或其他 <code>mockReturn*</code> 方法指定的函数。<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> myMockFn <span class="token operator">=</span> vi
  <span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockReturnValue</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockReturnValueOnce</span><span class="token punctuation">(</span><span class="token string">'first call'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockReturnValueOnce</span><span class="token punctuation">(</span><span class="token string">'second call'</span><span class="token punctuation">)</span>

<span class="token comment">// 'first call', 'second call', 'default', 'default'</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></ul></section></section><section id="mockinstance-properties"class="level2"><h2>MockInstance Properties</h2><section id="mockcalls"class="level3"><h3>mock.calls</h3><p>这是一个包含每个调用的所有参数的数组。数组的每一项都是该调用的参数。<p>如果一个函数被调用两次，并依次使用以下参数 <code>fn(arg1, arg2)</code>、<code>fn(arg3, arg4)</code>，那么 <code>mock.calls</code> 将是：<pre class="language-js"><code class="language-js"><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">'arg1'</span><span class="token punctuation">,</span> <span class="token string">'arg2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'arg3'</span><span class="token punctuation">,</span> <span class="token string">'arg4'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span></code></pre></section><section id="mocklastcall"class="level3"><h3>mock.lastCall</h3><p>这包含最后一次调用的参数。 如果未调用 spy，将返回 <code>undefined</code>。</section><section id="mockresults"class="level3"><h3>mock.results</h3><p>这是一个包含所有函数 <code>return</code> 的值的数组。该数组的一项是具有 <code>type</code> 和 <code>value</code> 属性的对象。可用类型有：<ul><li><p><code>'return'</code> - function returned without throwing.<li><p><code>'throw'</code> - function threw a value.<p><code>value</code> 属性包含返回值或抛出的错误。<p>如果函数返回 <code>result</code> ，然后抛出错误，那么 <code>mock.results</code> 将是：</ul><pre class="language-js"><code class="language-js"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'return'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'result'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'throw'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span></code></pre></section><section id="mockinstances"class="level3"><h3>mock.instances</h3><p>这是一个数组，包含在使用 <code>new</code> 关键字调用 mock 时实例化的所有实例。 请注意，这是函数的实际上下文（<code>this</code>），而不是返回值。<p>例如，如果 mock 是用 <code>new MyClass()</code> 实例化的，那么 <code>mock.instances</code> 将是一个包含一个值的数组：<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">MyClass</span> <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">expect</span><span class="token punctuation">(</span><span class="token maybe-class-name">MyClass</span><span class="token punctuation">.</span><span class="token property-access">mock</span><span class="token punctuation">.</span><span class="token property-access">instances</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></code></pre><p>如果从构造函数返回一个值，它将不在 <code>instances</code> 数组中，而是在 <code>results</code> 中：<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">Spy</span> <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">method</span><span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Spy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">expect</span><span class="token punctuation">(</span><span class="token maybe-class-name">Spy</span><span class="token punctuation">.</span><span class="token property-access">mock</span><span class="token punctuation">.</span><span class="token property-access">instances</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token maybe-class-name">Spy</span><span class="token punctuation">.</span><span class="token property-access">mock</span><span class="token punctuation">.</span><span class="token property-access">results</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section></section>