<!doctype html><html lang="cn"><meta charset="utf-8"><title>Test API 索引</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="outline"content="deep"><link rel="stylesheet"type="text/css"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="test-api-索引"><h1 id="test-api-索引">Test API 索引</h1><p>下面的类型签名中使用了以下类型：<pre class="language-ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">Awaitable</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token maybe-class-name">PromiseLike</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">TestFunction</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token maybe-class-name">Awaitable</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span>

<span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">TestOptions</span></span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * 如果执行时间过长，测试将失败
   */</span>
  timeout<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token doc-comment comment">/**
   * 如果测试失败，将重试特定次数
   *
   * <span class="token keyword">@default</span> 0
   */</span>
  retry<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token doc-comment comment">/**
   * 即使每次都失败，也会重复多次相同的测试
   * 如果有 "retry" 选项并且失败，它将在每个周期中使用每次重试
   * 对于调试随机故障很有用
   *
   * <span class="token keyword">@default</span> 0
   */</span>
  repeats<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span></code></pre><p>当测试函数返回承诺时，运行程序将等待它被解析以收集异步期望。 如果承诺被拒绝，测试就会失败。<blockquote>在 Jest 中，`TestFunction` 也可以是 `(done: DoneCallback) => void` 类型。如果使用这种形式，测试将在调用 `done` 之前不会结束。也可以使用 `async` 函数来实现相同的效果，请参阅[迁移指南中的回调完成部分](/guide/migration#回调完成)。函数来实现相同的效果，请参阅[迁移指南中的回调完成部分](/guide/migration#回调完成)。</blockquote><p>大多数选项都支持点语法和对象语法，允许您使用您喜欢的任何样式。</p>code-group ```ts [dot-syntax] import { test } from 'vitest'<p>test.skip('skipped test', () => { // 一些现在失败的逻辑 })<pre class="language-text"><code class="language-text">```ts [object-syntax]
import { test } from 'vitest'

test('skipped test', { skip: true }, () => {
  // 一些现在失败的逻辑
})</code></pre><section class="level2"aria-labelledby="test"><h2 id="test">test</h2><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, timeout?: number | TestOptions) => void</code><li><strong>别名:</strong> <code>it</code></ul><p><code>test</code> 定义了一组相关的期望。 它接收测试名称和保存测试期望的函数。<p>或者，我们可以提供超时（以毫秒为单位）来指定终止前等待的时间。 默认为 5 秒，可以通过 <a href="../config.html#testtimeout">testTimeout</a> 进行全局配置<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'should work as expected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><section class="level3"aria-labelledby="test-extended"><h3 id="test-extended">test.extend</h3><ul><li><strong>类型:</strong> <code>&#x3C;T extends Record&#x3C;string, any>>(fixtures: Fixtures&#x3C;T>): TestAPI&#x3C;ExtraContext &#x26; T></code><li><strong>别名:</strong> <code>it.extend</code></ul><p>使用 <code>test.extend</code> 来使用自定义的 fixtures 扩展测试上下文。这将返回一个新的 <code>test</code>，它也是可扩展的，因此可以根据需要扩展更多的 fixtures 或覆盖现有的 fixtures。有关更多信息，请参阅<a href="/guide/test-context.html#test-extend">扩展测试上下文</a>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> archive <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> myTest <span class="token operator">=</span> test<span class="token punctuation">.</span><span class="token method function property-access">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">todos</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> task <span class="token punctuation">}</span><span class="token punctuation">,</span> use<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    todos<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword control-flow">await</span> <span class="token function">use</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span>
    todos<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  archive<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">myTest</span><span class="token punctuation">(</span><span class="token string">'add item'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> todos <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>todos<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

  todos<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>todos<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level3"aria-labelledby="testskip"><h3 id="testskip">test.skip</h3><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, timeout?: number | TestOptions) => void</code><li><strong>别名:</strong> <code>it.skip</code></ul><p>如果想跳过运行某些测试，但又不想删代码，可以使用 <code>test.skip</code> 来跳过这些测试。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span><span class="token string">'skipped test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Test skipped, no error</span>
  assert<span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>还可以通过在 <a href="/guide/test-context">context</a> 上动态调用 <code>skip</code> 来跳过测试：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'skipped test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  context<span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// Test skipped, no error</span>
  assert<span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level3"aria-labelledby="testskipif"><h3 id="testskipif">test.skipIf</h3><ul><li><strong>类型:</strong> <code>(condition: any) => Test</code><li><strong>别名:</strong> <code>it.skipIf</code></ul><p>在某些情况下，可能会需要在不同的环境下多次运行测试，而且某些测试可能是特定于环境的。我们这时候可以通过使用 <code>test.skipIf</code> 来跳过测试，而不是用 <code>if</code> 来封装测试代码。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> isDev <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">skipIf</span><span class="token punctuation">(</span>isDev<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'prod only test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// this test only runs in production</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>在将 Vitest 用作[类型检查器](/guide/testing-types)时，不能使用此语法。</blockquote></section><section class="level3"aria-labelledby="testrunif"><h3 id="testrunif">test.runIf</h3><ul><li><strong>类型:</strong> <code>(condition: any) => Test</code><li><strong>别名:</strong> <code>it.runIf</code></ul><p>与 <a href="#test-skipif">test.skipIf</a> 相反。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> isDev <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">runIf</span><span class="token punctuation">(</span>isDev<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'dev only test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// this test only runs in development</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>在将 Vitest 用作[类型检查器](/guide/testing-types)时，不能使用此语法。</blockquote></section><section class="level3"aria-labelledby="testonly"><h3 id="testonly">test.only</h3><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, timeout?: number) => void</code><li><strong>别名:</strong> <code>it.only</code></ul><p>使用 <code>test.only</code> 仅运行给定 测试套件 中的某些测试。这在调试时非常有用。<p>可选择提供超时（以毫秒为单位），用于指定终止前的等待时间。默认值为 5 秒，可通过 <a href="../config.html#testtimeout">testTimeout</a> 进行全局配置。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">only</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Only this test (and others marked with only) are run</span>
  assert<span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>有时，只运行某个文件中的 "测试"，而忽略整个 测试套件 中的所有其他测试是非常有用的，因为这些测试会污染输出。<p>为此，请使用包含相关测试的特定文件运行 <code>vitest</code>。<pre class="language-text"><code class="language-text"># vitest interesting.test.ts</code></pre></section><section class="level3"aria-labelledby="testconcurrent"><h3 id="testconcurrent">test.concurrent</h3><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, timeout?: number) => void</code><li><strong>别名:</strong> <code>it.concurrent</code></ul><p><code>test.concurrent</code> 标记并行运行的连续测试。它接收测试名称、包含要收集的测试的异步函数以及可选的超时（以毫秒为单位）。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token comment">// The two tests marked with concurrent will be run in parallel</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'serial test'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'concurrent test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><code>test.skip</code>、 <code>test.only</code> 和 <code>test.todo</code> 适用于并发测试。以下所有组合均有效：<pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span>
test<span class="token punctuation">.</span><span class="token property-access">skip</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or test.concurrent.skip(/* ... */)</span>
test<span class="token punctuation">.</span><span class="token property-access">only</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or test.concurrent.only(/* ... */)</span>
test<span class="token punctuation">.</span><span class="token property-access">todo</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or test.concurrent.todo(/* ... */)</span></code></pre><p>运行并发测试时，快照和断言必须使用本地<a href="/guide/test-context.md">测试上下文</a>中的 <code>expect</code>，以确保检测到正确的测试。<pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>在将 Vitest 用作[类型检查器](/guide/testing-types)时，不能使用此语法。</blockquote></section><section class="level3"aria-labelledby="testsequential"><h3 id="testsequential">test.sequential</h3><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, timeout?: number) => void</code></ul><p><code>test.sequential</code> 标记一个测试为顺序测试。如果要在 <code>describe.concurrent</code> 中或使用 <code>--sequence.concurrent</code> 命令选项按顺序运行测试，这一点非常有用。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token comment">// with config option { sequence: { concurrent: true } }</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

test<span class="token punctuation">.</span><span class="token method function property-access">sequential</span><span class="token punctuation">(</span><span class="token string">'sequential test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
test<span class="token punctuation">.</span><span class="token method function property-access">sequential</span><span class="token punctuation">(</span><span class="token string">'sequential test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// within concurrent suite</span>
describe<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  test<span class="token punctuation">.</span><span class="token method function property-access">sequential</span><span class="token punctuation">(</span><span class="token string">'sequential test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  test<span class="token punctuation">.</span><span class="token method function property-access">sequential</span><span class="token punctuation">(</span><span class="token string">'sequential test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level3"aria-labelledby="testtodo"><h3 id="testtodo">test.todo</h3><ul><li><strong>类型:</strong> <code>(name: string | Function) => void</code><li><strong>别名:</strong> <code>it.todo</code></ul><p>使用 <code>test.todo</code> 来存根测试，以便稍后实施。测试报告中将显示一个条目，以便知道还有多少测试需要执行。<pre class="language-ts"><code class="language-ts"><span class="token comment">// An entry will be shown in the report for this test</span>
test<span class="token punctuation">.</span><span class="token method function property-access">todo</span><span class="token punctuation">(</span><span class="token string">'unimplemented test'</span><span class="token punctuation">)</span></code></pre></section><section class="level3"aria-labelledby="testfails"><h3 id="testfails">test.fails</h3><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, timeout?: number) => void</code><li><strong>别名:</strong> <code>it.fails</code></ul><p>使用 <code>test.fails</code> 明确表示断言将失败。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">function</span> <span class="token function">myAsyncFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Promise</span></span><span class="token punctuation">(</span>resolve <span class="token arrow operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
test<span class="token punctuation">.</span><span class="token method function property-access">fails</span><span class="token punctuation">(</span><span class="token string">'fail test'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">myAsyncFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">rejects</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>在将 Vitest 用作[类型检查器](/guide/testing-types)时，不能使用此语法。</blockquote></section><section class="level3"aria-labelledby="testeach"><h3 id="testeach">test.each</h3><ul><li><strong>类型:</strong> <code>(cases: ReadonlyArray&#x3C;T>, ...args: any[]) => void</code><li><strong>别名:</strong> <code>it.each</code></ul><blockquote>`test.each` 是为了与 Jest 兼容而提供的，Vitest 还提供了 [`test.for`](#test-for)，并集成了 [`TestContext`](/guide/test-context)。</blockquote><p>当需要使用不同变量运行同一测试时，请使用 <code>test.each</code>。 我们可以按照测试功能参数的顺序，在测试名称中注入带有 <a href="https://nodejs.org/api/util.html#util_util_format_format_args">printf formatting</a> 的参数。<ul><li><code>%s</code>: string<li><code>%d</code>: number<li><code>%i</code>: integer<li><code>%f</code>: floating point value<li><code>%j</code>: json<li><code>%o</code>: object<li><code>%#</code>: index of the test case<li><code>%%</code>: single percent sign ('%')</ul><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">each</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'add(%i, %i) -> %i'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// this will return</span>
<span class="token comment">// ✓ add(1, 1) -> 2</span>
<span class="token comment">// ✓ add(1, 2) -> 3</span>
<span class="token comment">// ✓ add(2, 1) -> 3</span></code></pre><p>如果使用对象作为参数，也可以使用前缀 <code>$</code> 访问对象属性：<pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token method function property-access">each</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'add($a, $b) -> $expected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// this will return</span>
<span class="token comment">// ✓ add(1, 1) -> 2</span>
<span class="token comment">// ✓ add(1, 2) -> 3</span>
<span class="token comment">// ✓ add(2, 1) -> 3</span></code></pre><p>如果使用对象作为参数，也可以使用 <code>.</code> 访问对象属性：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

test<span class="token punctuation">.</span><span class="token property-access">each</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  a             | b      | expected
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span> val<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'1b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span> val<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'2b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span> val<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'3b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">(</span><span class="token string">'add($a.val, $b) -> $expected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token property-access">val</span> <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// this will return</span>
<span class="token comment">// ✓ add(1, b) -> 1b</span>
<span class="token comment">// ✓ add(2, b) -> 2b</span>
<span class="token comment">// ✓ add(3, b) -> 3b</span></code></pre><p>从 Vitest 0.25.3 开始，还可以使用模板字符串表。<ul><li>第一行应为列名，用 <code>|</code> 分隔；<li>使用 <code>${value}</code> 语法，以模板字面表达式的形式提供后面一行或多行数据。<li></ul><pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token property-access">each</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  a             | b      | expected
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">          | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">   | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'a'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">        | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'ab'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">         | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">         | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'[object Object]b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span> asd<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'[object Object]b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">(</span><span class="token string">'returns $expected when $a is added $b'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>Vitest 使用 chai `format` 方法处理 `$values`。如果数值太短，可以在配置文件中增加 [chaiConfig.truncateThreshold](../config.html#chaiconfig-truncatethreshold)。</blockquote><blockquote>在将 Vitest 用作[类型检查器](/guide/testing-types)时，不能使用此语法。</blockquote></section><section class="level3"aria-labelledby="testfor"><h3 id="testfor">test.for</h3><ul><li><strong>Alias:</strong> <code>it.for</code></ul><p>作为 <code>test.each</code> 的替代，提供 <a href="/guide/test-context"><code>TestContext</code></a>。<p>与 <code>test.each</code> 的区别在于如何在参数中提供数组情况。 其他非数组情况（包括模板字符串的使用）完全相同。<pre class="language-ts"><code class="language-ts"><span class="token comment">// `each` spreads array case</span>
test<span class="token punctuation">.</span><span class="token method function property-access">each</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'add(%i, %i) -> %i'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span> <span class="token comment">// [!code --]</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// `for` doesn't spread array case</span>
test<span class="token punctuation">.</span><span class="token keyword control-flow">for</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'add(%i, %i) -> %i'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span> <span class="token comment">// [!code ++]</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>第二个参数是 <a href="/guide/test-context"><code>TestContext</code></a>，可用于并发快照等<pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token property-access">concurrent</span><span class="token punctuation">.</span><span class="token keyword control-flow">for</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'add(%i, %i)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">matchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section></section><section class="level2"aria-labelledby="bench"><h2 id="bench">bench</h2><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: BenchFunction, options?: BenchOptions) => void</code></ul><p><code>bench</code> 定义了一个基准。在 Vitest 术语中，基准是定义一系列操作的函数。Vitest 会多次运行该函数，以显示不同的性能结果。<p>Vitest 使用了 <a href="https://github.com/tinylibs/tinybench"><code>tinybench</code></a>库，继承其所有可用作第三个参数的选项。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">bench</span><span class="token punctuation">(</span>
  <span class="token string">'normal sorting'</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
    x<span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> time<span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span></code></pre><pre class="language-ts"><code class="language-ts"><span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">Options</span></span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * 运行基准任务所需时间（毫秒）
   * <span class="token keyword">@default</span> 500
   */</span>
  time<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>

  <span class="token doc-comment comment">/**
   * 如果连时间选项都已完成，任务应运行的次数
   * <span class="token keyword">@default</span> 10
   */</span>
  iterations<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>

  <span class="token doc-comment comment">/**
   * 函数以毫秒为单位获取当前时间戳
   */</span>
  now<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token builtin">number</span>

  <span class="token doc-comment comment">/**
   * 用于中止基准测试的中止信号
   */</span>
  signal<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">AbortSignal</span>

  <span class="token doc-comment comment">/**
   * 任务失败时抛出（如果为 true，事件将不起作用）
   */</span>
  throws<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>

  <span class="token doc-comment comment">/**
   * 预热时间（毫秒）
   * <span class="token keyword">@default</span> 100ms
   */</span>
  warmupTime<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>

  <span class="token doc-comment comment">/**
   * 热身迭代
   * <span class="token keyword">@default</span> 5
   */</span>
  warmupIterations<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>

  <span class="token doc-comment comment">/**
   * 在每个基准任务（周期）之前运行的设置函数
   */</span>
  setup<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Hook</span>

  <span class="token doc-comment comment">/**
   * 在每个基准任务（周期）之后运行的拆机函数
   */</span>
  teardown<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Hook</span>
<span class="token punctuation">}</span></code></pre><section class="level3"aria-labelledby="benchskip"><h3 id="benchskip">bench.skip</h3><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: BenchFunction, options?: BenchOptions) => void</code></ul><p>可以使用 "bench.skip "语法跳过运行某些基准。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

bench<span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span><span class="token string">'normal sorting'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
  x<span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level3"aria-labelledby="benchonly"><h3 id="benchonly">bench.only</h3><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: BenchFunction, options?: BenchOptions) => void</code></ul><p>使用 <code>bench.only</code> 仅运行给定测试套件中的某些基准。这在调试时非常有用。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

bench<span class="token punctuation">.</span><span class="token method function property-access">only</span><span class="token punctuation">(</span><span class="token string">'normal sorting'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
  x<span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level3"aria-labelledby="benchtodo"><h3 id="benchtodo">bench.todo</h3><ul><li><strong>类型:</strong> <code>(name: string | Function) => void</code></ul><p>使用 <code>bench.todo</code> 来存根基准，以便以后实施。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

bench<span class="token punctuation">.</span><span class="token method function property-access">todo</span><span class="token punctuation">(</span><span class="token string">'unimplemented test'</span><span class="token punctuation">)</span></code></pre></section></section><section class="level2"aria-labelledby="describe"><h2 id="describe">describe</h2><p>当在文件的顶层使用 <code>test</code> 或 <code>bench</code> 时，它们会作为隐式套件的一部分被收集起来。使用 <code>describe</code> 可以在当前上下文中定义一个新的测试套件，作为一组相关测试或基准以及其他嵌套测试套件。测试套件可让组织测试和基准，使报告更加清晰。<pre class="language-ts"><code class="language-ts"><span class="token comment">// basic.spec.ts</span>
<span class="token comment">// organizing tests</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  isActive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'person is defined'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeDefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'is active'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token property-access">isActive</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'age limit'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeLessThanOrEqual</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><pre class="language-ts"><code class="language-ts"><span class="token comment">// basic.bench.ts</span>
<span class="token comment">// organizing benchmarks</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench<span class="token punctuation">,</span> describe <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'sort'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">'normal'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
    x<span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">'reverse'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
    x<span class="token punctuation">.</span><span class="token method function property-access">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>如果测试或基准具有层次结构，还可以嵌套描述块：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">function</span> <span class="token function">numberToCurrency</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">!==</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">TypeError</span></span><span class="token punctuation">(</span><span class="token string">'Value must be a number'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> value
    <span class="token punctuation">.</span><span class="token method function property-access">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\B(?=(\d{3})+(?!\d))</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'numberToCurrency'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'given an invalid number'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'composed of non-numbers to throw error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">numberToCurrency</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toThrowError</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'given a valid number'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'returns the correct currency format'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">numberToCurrency</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token string">'10,000.00'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><section class="level3"aria-labelledby="describeskip"><h3 id="describeskip">describe.skip</h3><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, options?: number | TestOptions) => void</code></ul><p>在套件中使用 <code>describe.skip</code> 可避免运行特定的 describe 块。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> describe<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

describe<span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span><span class="token string">'skipped suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'sqrt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// Suite skipped, no error</span>
    assert<span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level3"aria-labelledby="describeskipif"><h3 id="describeskipif">describe.skipIf</h3><ul><li><strong>类型:</strong> <code>(condition: any) => void</code></ul><p>在某些情况下，可能会在不同的环境下多次运行套件，其中一些测试套件可能是特定于环境的。可以使用 <code>describe.skipIf</code> 来跳过条件为真时的套件，而不是使用 <code>if</code> 来封装套件。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> isDev <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>

describe<span class="token punctuation">.</span><span class="token method function property-access">skipIf</span><span class="token punctuation">(</span>isDev<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'prod only test suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// this test suite only runs in production</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>将 Vitest 用作[类型检查器](/guide/testing-types)时，你不能使用此语法。</blockquote></section><section class="level3"aria-labelledby="describerunif"><h3 id="describerunif">describe.runIf</h3><ul><li><strong>类型:</strong> <code>(condition: any) => void</code></ul><p>与 <a href="#describe-skipif">describe.skipIf</a> 相反。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> describe<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> isDev <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>

describe<span class="token punctuation">.</span><span class="token method function property-access">runIf</span><span class="token punctuation">(</span>isDev<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'dev only test suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// this test suite only runs in development</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>将 Vitest 用作[类型检查器](/guide/testing-types)时，你不能使用此语法。</blockquote></section><section class="level3"aria-labelledby="describeonly"><h3 id="describeonly">describe.only</h3><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, options?: number | TestOptions) => void</code></ul><p>使用 <code>describe.only</code> 只运行某些测试套件<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> describe<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token comment">// Only this suite (and others marked with only) are run</span>
describe<span class="token punctuation">.</span><span class="token method function property-access">only</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'sqrt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    assert<span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'other suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ... will be skipped</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>In order to do that run <code>vitest</code> with specific file containing the tests in question.<p>有时，只运行某个文件中的测试套件，而忽略整个测试套件中的所有其他测试是非常有用的，因为这些测试会污染输出。<p>要做到这一点，请在包含相关测试的特定文件中运行 <code>vitest</code>。<pre class="language-text"><code class="language-text"># vitest interesting.test.ts</code></pre></section><section class="level3"aria-labelledby="describeconcurrent"><h3 id="describeconcurrent">describe.concurrent</h3><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, options?: number | TestOptions) => void</code></ul><p>测试套件中的 <code>describe.concurrent</code> 会将所有测试标记为并发测试<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token comment">// All suites and tests within this suite will be run in parallel</span>
describe<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'concurrent suite 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test inner 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">/* ... */</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test inner 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">/* ... */</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'concurrent test 3'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><code>.skip</code>、<code>.only</code>和<code>.todo</code>适用于并发测试套件。以下所有组合都有效：<pre class="language-ts"><code class="language-ts">describe<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span>
describe<span class="token punctuation">.</span><span class="token property-access">skip</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or describe.concurrent.skip(/* ... */)</span>
describe<span class="token punctuation">.</span><span class="token property-access">only</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or describe.concurrent.only(/* ... */)</span>
describe<span class="token punctuation">.</span><span class="token property-access">todo</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or describe.concurrent.todo(/* ... */)</span></code></pre><p>运行并发测试时，快照和断言必须使用本地<a href="/guide/test-context.md">测试上下文</a>中的 <code>expect</code> ，以确保检测到正确的测试。<pre class="language-ts"><code class="language-ts">describe<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>在将 Vitest 用作[类型检查器](/guide/testing-types)时，不能使用此语法。</blockquote></section><section class="level3"aria-labelledby="describesequential"><h3 id="describesequential">describe.sequential</h3><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, options?: number | TestOptions) => void</code></ul><p>测试套件中的 <code>describe.sequential</code> 会将每个测试标记为顺序测试。如果需要在 <code>describe.concurrent</code> 中或使用 <code>--sequence.concurrent</code> 命令选项按顺序运行测试，这一点非常有用。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

describe<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  describe<span class="token punctuation">.</span><span class="token method function property-access">sequential</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'sequential test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">/* ... */</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'sequential test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">/* ... */</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level3"aria-labelledby="describeshuffle"><h3 id="describeshuffle">describe.shuffle</h3><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, options?: number | TestOptions) => void</code></ul><p>Vitest 通过 CLI 标志 <a href="../guide/cli"><code>--sequence.shuffle</code></a> 或配置选项 <a href="/config.html#sequence-shuffle"><code>sequence.shuffle</code></a>，提供了一种以随机顺序运行所有测试的方法，但如果只想让测试套件的一部分以随机顺序运行测试，可以用这个标志来标记它。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

describe<span class="token punctuation">.</span><span class="token method function property-access">shuffle</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'random test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'random test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'random test 3'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// order depends on sequence.seed option in config (Date.now() by default)</span></code></pre><p><code>.skip</code>、<code>.only</code>和<code>.todo</code>适用于随机测试套件。<blockquote>在将 Vitest 用作[类型检查器](/guide/testing-types)时，不能使用此语法。</blockquote></section><section class="level3"aria-labelledby="describetodo"><h3 id="describetodo">describe.todo</h3><ul><li><strong>类型:</strong> <code>(name: string | Function) => void</code></ul><p>使用 <code>describe.todo</code> 来暂存待以后实施的套件。测试报告中会显示一个条目，这样就能知道还有多少测试需要执行。<pre class="language-ts"><code class="language-ts"><span class="token comment">// An entry will be shown in the report for this suite</span>
describe<span class="token punctuation">.</span><span class="token method function property-access">todo</span><span class="token punctuation">(</span><span class="token string">'unimplemented suite'</span><span class="token punctuation">)</span></code></pre></section><section class="level3"aria-labelledby="describeeach"><h3 id="describeeach">describe.each</h3><ul><li><strong>类型:</strong> <code>(cases: ReadonlyArray&#x3C;T>, ...args: any[]): (name: string | Function, fn: (...args: T[]) => void, options?: number | TestOptions) => void</code></ul><p>如果有多个测试依赖于相同的数据，请使用 <code>describe.each</code> 。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

describe<span class="token punctuation">.</span><span class="token method function property-access">each</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'describe object add($a, $b)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">returns </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expected<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">returned value not be greater than </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expected<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeGreaterThan</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">returned value not be less than </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expected<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeLessThan</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>从 Vitest 0.25.3 开始，还可以使用模板字符串表。<ul><li>第一行应为列名，用 <code>|</code> 分隔；<li>使用 <code>${value}</code> 语法，以模板字面表达式的形式提供后面一行或多行数据。</ul><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

describe<span class="token punctuation">.</span><span class="token property-access">each</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  a             | b      | expected
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">          | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">   | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'a'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">        | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'ab'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">         | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">         | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'[object Object]b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span> asd<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'[object Object]b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">(</span><span class="token string">'describe template string add($a, $b)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">returns </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expected<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>在将 Vitest 用作[类型检查器](/guide/testing-types)时，不能使用此语法。</blockquote></section></section><section class="level2"aria-labelledby="setup-and-teardown"><h2 id="setup-and-teardown">Setup and Teardown</h2><p>通过这些函数，我们可以挂钩测试的生命周期，避免重复设置和拆卸代码。它们适用于当前上下文：如果在顶层使用，则适用于文件；如果在 <code>describe</code> 块内使用，则适用于当前测试套件。 将 Vitest 作为类型检查器运行时，不会调用这些钩子。<section class="level3"aria-labelledby="beforeeach"><h3 id="beforeeach">beforeEach</h3><ul><li><strong>类型:</strong> <code>beforeEach(fn: () => Awaitable&#x3C;void>, timeout?: number)</code></ul><p>注册一个回调函数，在当前上下文中的每个测试运行前调用。 如果函数返回一个 Promise ，Vitest 会等待承诺解析后再运行测试。<p>作为选项，可以传递一个超时（以毫秒为单位），定义终止前需要等待的时间。默认值为 5 秒。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> beforeEach <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Clear mocks and add some testing data after before each test run</span>
  <span class="token keyword control-flow">await</span> <span class="token function">stopMocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword control-flow">await</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'John'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>这里， <code>beforeEach</code> 确保每次测试都会添加用户。<p><code>beforeEach</code> 还接受一个可选的清理函数（相当于 <code>afterEach</code>）。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> beforeEach <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// called once before each test run</span>
  <span class="token keyword control-flow">await</span> <span class="token function">prepareSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// clean up function, called once after each test run</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">await</span> <span class="token function">resetSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level3"aria-labelledby="aftereach"><h3 id="aftereach">afterEach</h3><ul><li><strong>类型 :</strong> <code>afterEach(fn: () => Awaitable&#x3C;void>, timeout?: number)</code></ul><p>注册一个回调函数，在当前上下文中的每个测试完成后调用。 如果函数返回一个承诺，Vitest 会等待承诺解析后再继续。<p>可以选择提供一个超时（毫秒），用于指定终止前的等待时间。默认值为 5 秒。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> afterEach <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token function">clearTestingData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// clear testing data after each test run</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>在这里，<code>afterEach</code> 可确保在每次测试运行后清除测试数据。<blockquote>Vitest 在 1.3.0 新增 [`onTestFinished`](#ontestfinished)。你可以在测试执行过程中调用它，以便在测试运行结束后清理任何状态。</blockquote></section><section class="level3"aria-labelledby="beforeall"><h3 id="beforeall">beforeAll</h3><ul><li><strong>类型:</strong> <code>beforeAll(fn: () => Awaitable&#x3C;void>, timeout?: number)</code></ul><p>注册一个回调函数，在开始运行当前上下文中的所有测试之前调用一次。 如果函数返回一个 Promise ，Vitest 会等待承诺解析后再运行测试。<p>可以选择提供一个超时（毫秒），用于指定终止前的等待时间。默认值为 5 秒。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> beforeAll <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token function">startMocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// called once before all tests run</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>这里的 <code>beforeAll</code> 确保在测试运行前设置好模拟数据。<p><code>beforeAll</code> 还接受一个可选的清理函数（相当于 <code>afterAll</code>）。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> beforeAll <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// called once before all tests run</span>
  <span class="token keyword control-flow">await</span> <span class="token function">startMocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// clean up function, called once after all tests run</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">await</span> <span class="token function">stopMocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level3"aria-labelledby="afterall"><h3 id="afterall">afterAll</h3><ul><li><strong>类型:</strong> <code>afterAll(fn: () => Awaitable&#x3C;void>, timeout?: number)</code></ul><p>注册一个回调函数，以便在当前上下文中所有测试运行完毕后调用一次。 如果函数返回一个 Promise ，Vitest 会等待承诺解析后再继续。<p>你还可以选择提供超时（毫秒），以指定终止前的等待时间。默认值为 5 秒。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> afterAll <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">afterAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token function">stopMocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// this method is called after all tests run</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>这里的 <code>afterAll</code> 确保在所有测试运行后调用 <code>stopMocking</code> 方法。</section></section><section class="level2"aria-labelledby="test-hooks"><h2 id="test-hooks">Test Hooks</h2><p>Vitest 提供了一些 hooks，你可以在 <em>测试执行期间</em> 调用这些钩子，以便在测试运行结束后清理状态。<blockquote>如果在测试体之外调用这些 hooks ，则会出错。</blockquote><section class="level3"aria-labelledby="ontestfinished"><h3 id="ontestfinished">onTestFinished</h3><p>这个 hook 总是在测试运行结束后调用。它在 <code>afterEach</code> 之后被调用，因为它们会影响测试结果。它接收一个包含当前测试结果的 <code>TaskResult</code> 。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> onTestFinished<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'performs a query'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">connectDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">onTestFinished</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> db<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  db<span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * FROM users'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>如果要并发运行测试，应该始终使用测试上下文中的 `onTestFinished` ，因为 Vitest 不会在全局 hook 中跟踪并发测试：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'performs a query'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> onTestFinished <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">connectDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">onTestFinished</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> db<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  db<span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * FROM users'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></blockquote><p>这个 hook 在创建可重复使用的逻辑时特别有用：<pre class="language-ts"><code class="language-ts"><span class="token comment">// 这可以是一个单独的文件</span>
<span class="token keyword">function</span> <span class="token function">getTestDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">connectMockedDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">onTestFinished</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> db<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword control-flow">return</span> db
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'performs a user query'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">getTestDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * from users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'performs an organization query'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">getTestDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * from organizations'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>该钩子总是以相反顺序调用，不受 [`sequence.hooks`](../config.html#sequence-hooks) 选项的影响。</blockquote></section><section class="level3"aria-labelledby="ontestfailed"><h3 id="ontestfailed">onTestFailed</h3><p>只有在测试失败后才会调用这个 hook 。它在 <code>afterEach</code> 之后被调用，因为它们会影响测试结果。它将接收一个包含当前测试结果的 <code>TaskResult</code> 。这个 hook 对调试非常有用。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> onTestFailed<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'performs a query'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">connectDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">onTestFailed</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">result</span><span class="token punctuation">.</span><span class="token property-access">errors</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  db<span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * FROM users'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>如果要并发运行测试，应始终使用测试上下文中的 `onTestFailed` ，因为 Vitest 不会在全局 hook 中跟踪并发测试：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'performs a query'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> onTestFailed <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">connectDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">onTestFailed</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">errors</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  db<span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * FROM users'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></blockquote><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section></section>