<!doctype html><html lang="cn"><meta charset="utf-8"><title>API 索引</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="outline"content="deep"><link rel="stylesheet"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="api-索引"><h1 id="api-索引">API 索引</h1><p>下面的变量中使用了以下类型签名<pre class="language-ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">Awaitable</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token maybe-class-name">PromiseLike</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">TestFunction</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token maybe-class-name">Awaitable</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span>

<span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">TestOptions</span></span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * 如果测试执行时间过长，将会导致测试失败。
   */</span>
  timeout<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token doc-comment comment">/**
   * 如果测试失败，将会重试指定次数。
   *
   * <span class="token keyword">@default</span> 0
   */</span>
  retry<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token doc-comment comment">/**
   * 即使每次测试失败，也会多次重复相同的测试
   * 如果您有 "retry" 选项并且它失败了，它将在每个周期中使用每个重试
   * 用于调试随机失败的情况非常有用
   *
   * <span class="token keyword">@default</span> 0
   */</span>
  repeats<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span></code></pre><p>当一个测试函数返回一个 promise 时，Vitest 将等待直到它被解决以收集异步的期望值。 如果 promise 被拒绝，测试将失败。<blockquote>提示 在 Jest 中，`TestFunction` 也可以是 `(done: DoneCallback) => void` 类型。 如果使用此选项，则在调用 `done` 之前测试不会结束。 你可以使用 `async` 函数实现相同的目的，请参阅迁移指南中的[回调](../guide/migration#done-callback)部分。</blockquote><section class="level2"aria-labelledby="test"><h2 id="test">test</h2><ul><li><p><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, timeout?: number | TestOptions) => void</code><li><p><strong>别名:</strong> <code>it</code><p><code>test</code> 定义了一组关于测试期望的方法。它接收测试名称和一个含有测试期望的函数。<p>同时，可以提供一个超时时限（以毫秒为单位）用于指定等待多长时间后终止测试，默认为 5 秒。你也可以通过 <a href="../config.html#testtimeout">testTimeout</a> 选项进行全局配置。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'should work as expected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul><section class="level3"aria-labelledby="testextend"><h3 id="testextend">test.extend</h3><ul><li><p><strong>类型:</strong> <code>&#x3C;T extends Record&#x3C;string, any>>(fixtures: Fixtures&#x3C;T>): TestAPI&#x3C;ExtraContext &#x26; T></code><li><p><strong>别名:</strong> <code>it.extend</code><li><p><strong>版本:</strong> Vitest 0.32.3<p>使用 <code>test.extend</code> 来扩展带有自定义装置的测试上下文。这将返回一个新的 <code>test</code> 并且它也是可扩展的，因此你可以根据需要通过扩展它来组合更多装置或覆盖现有装置。有关详细信息，请参阅<a href="/guide/test-context.html#test-extend">扩展测试上下文</a>。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> archive <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> myTest <span class="token operator">=</span> test<span class="token punctuation">.</span><span class="token method function property-access">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">todos</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> task <span class="token punctuation">}</span><span class="token punctuation">,</span> use<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    todos<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword control-flow">await</span> <span class="token function">use</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span>
    todos<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  archive<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">myTest</span><span class="token punctuation">(</span><span class="token string">'add item'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> todos <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>todos<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

  todos<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>todos<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section class="level3"aria-labelledby="testskip"><h3 id="testskip">test.skip</h3><ul><li><p><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, timeout?: number | TestOptions) => void</code><li><p><strong>别名:</strong> <code>it.skip</code><p>如果你想跳过运行某些测试，但由于一些原因不想删除代码，你可以使用 <code>test.skip</code> 来避免运行它们。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span><span class="token string">'skipped test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 跳过测试，没有错误</span>
  assert<span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>你还可以通过在其 <a href="/guide/test-context">测试上下文</a> 上动态调用 <code>skip</code> 来跳过测试：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'skipped test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  context<span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// Test skipped, no error</span>
  assert<span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section class="level3"aria-labelledby="testskipif"><h3 id="testskipif">test.skipIf</h3><ul><li><p><strong>类型:</strong> <code>(condition: any) => Test</code><li><p><strong>别名:</strong> <code>it.skipIf</code><p>在某些情况下，你可能会在不同的环境中多次运行测试，并且某些测试可能基于特定环境下运行。只要条件成立，你就可以使用 <code>test.skipIf</code> 跳过测试，而不是用 <code>if</code> 包裹测试代码。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> isDev <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">skipIf</span><span class="token punctuation">(</span>isDev<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'prod only test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 只在生产环境下进行测试</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul><blockquote>当 Vitest 作为 [类型检查器](/guide/testing-types) 时，你不能使用此语法。</blockquote></section><section class="level3"aria-labelledby="testrunif"><h3 id="testrunif">test.runIf</h3><ul><li><strong>类型:</strong> <code>(condition: any) => Test</code><li><strong>别名:</strong> <code>it.runIf</code></ul><p><a href="#testskipif">test.skipIf</a> 的相反面。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> isDev <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">runIf</span><span class="token punctuation">(</span>isDev<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'dev only test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 只在开发环境下进行测试</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>当 Vitest 作为 [类型检查器](/guide/testing-types) 时，你不能使用此语法。</blockquote></section><section class="level3"aria-labelledby="testonly"><h3 id="testonly">test.only</h3><ul><li><p><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, timeout?: number) => void</code><li><p><strong>别名:</strong> <code>it.only</code><p>使用 <code>test.only</code> 只允许特定条件的测试套件。这在调试模式下是很有用的。<p>同时，可以提供一个超时时限（以毫秒为单位）用于指定等待多长时间后终止测试，默认为 5 秒。你也可以通过 <a href="../config.html#testtimeout">testTimeout</a> 选项进行全局配置。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">only</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 仅运行此测试（以及仅标记有的其他测试）</span>
  assert<span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>有时候只运行一个特定文件中的 <code>only</code> 测试用例是很有用的，这可以忽略整个测试套件中的所有其他测试用例，避免污染输出。<p>为了做到这一点，运行 <code>vitest</code> 命令并带上包含有问题的测试的特定文件。<pre class="language-text"><code class="language-text"># vitest interesting.test.ts</code></pre></ul></section><section class="level3"aria-labelledby="testconcurrent"><h3 id="testconcurrent">test.concurrent</h3><ul><li><p><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, timeout?: number) => void</code><li><p><strong>别名:</strong> <code>it.concurrent</code><p><code>test.concurrent</code> 将连续测试标记为并行运行。 它接收测试名称、带有要收集的测试的异步函数以及可选的超时时间（以毫秒为单位）。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token comment">// 标有并发的两个测试将并发运行</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'serial test'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'concurrent test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><code>test.skip</code>、<code>test.only</code> 和 <code>test.todo</code> 适用于并发测试。 以下所有组合均有效：<pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span>
test<span class="token punctuation">.</span><span class="token property-access">skip</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or test.concurrent.skip(/* ... */)</span>
test<span class="token punctuation">.</span><span class="token property-access">only</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or test.concurrent.only(/* ... */)</span>
test<span class="token punctuation">.</span><span class="token property-access">todo</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or test.concurrent.todo(/* ... */)</span></code></pre><p>在异步并发测试中使用快照时，由于 JavaScript 的限制，你需要使用 <a href="/guide/test-context.md">测试环境</a> 中的 <code>expect</code> 来确保检测到正确的测试。<pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul><blockquote>当 Vitest 作为 [类型检查器](/guide/testing-types) 时，你不能使用此语法。</blockquote></section><section class="level3"aria-labelledby="testtodo"><h3 id="testtodo">test.todo</h3><ul><li><p><strong>类型:</strong> <code>(name: string | Function) => void</code><li><p><strong>别名:</strong> <code>it.todo</code><p>使用 <code>test.todo</code> 来存根测试，以便稍后实现。 测试报告中将显示一个条目，以便告知你还有多少测试未实现。<pre class="language-ts"><code class="language-ts"><span class="token comment">// 测试的报告中将显示一个记录</span>
test<span class="token punctuation">.</span><span class="token method function property-access">todo</span><span class="token punctuation">(</span><span class="token string">'unimplemented test'</span><span class="token punctuation">)</span></code></pre></ul></section><section class="level3"aria-labelledby="testfails"><h3 id="testfails">test.fails</h3><ul><li><p><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, timeout?: number) => void</code><li><p><strong>别名:</strong> <code>it.fails</code><p>使用 <code>test.fails</code> 来指示测试断言将显式失败。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">function</span> <span class="token function">myAsyncFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Promise</span></span><span class="token punctuation">(</span>resolve <span class="token arrow operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
test<span class="token punctuation">.</span><span class="token method function property-access">fails</span><span class="token punctuation">(</span><span class="token string">'fail test'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">myAsyncFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">rejects</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul><blockquote>当 Vitest 作为 [类型检查器](/guide/testing-types) 时，你不能使用此语法。</blockquote></section><section class="level3"aria-labelledby="testeach"><h3 id="testeach">test.each</h3><ul><li><p><strong>类型:</strong> <code>(cases: ReadonlyArray&#x3C;T>, ...args: any[]) => void</code><li><p><strong>别名:</strong> <code>it.each</code><p>当你需要使用不同的变量运行相同的测试时，请使用 <code>test.each</code>。 你可以按照测试参数的顺序，在测试名称插入符合<a href="https://nodejs.org/api/util.html#util_util_format_format_args">printf 格式</a>的参数。<ul><li><code>%s</code>: 字符串<li><code>%d</code>: 数值<li><code>%i</code>: 整数<li><code>%f</code>: 小数<li><code>%j</code>: json 格式<li><code>%o</code>: 对象<li><code>%#</code>: 对应的测试参数下标<li><code>%%</code>: 单个百分比符号 ('%')</ul><pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token method function property-access">each</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'add(%i, %i) -> %i'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 它将返回如下内容</span>
<span class="token comment">// ✓ add(1, 1) -> 2</span>
<span class="token comment">// ✓ add(1, 2) -> 3</span>
<span class="token comment">// ✓ add(2, 1) -> 3</span></code></pre><p>如果你使用对象作为参数，你还可以使用 <code>$</code> 前缀访问对象属性：<pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token method function property-access">each</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'add($a, $b) -> $expected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// this will return</span>
<span class="token comment">// ✓ add(1, 1) -> 2</span>
<span class="token comment">// ✓ add(1, 2) -> 3</span>
<span class="token comment">// ✓ add(2, 1) -> 3</span></code></pre><p>如果你使用对象作为参数，你还可以使用“.”访问对象属性：<pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token property-access">each</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  a             | b      | expected
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span> val<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'1b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span> val<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'2b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span> val<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'3b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">(</span><span class="token string">'add($a.val, $b) -> $expected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token property-access">val</span> <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// this will return</span>
<span class="token comment">// ✓ add(1, b) -> 1b</span>
<span class="token comment">// ✓ add(2, b) -> 2b</span>
<span class="token comment">// ✓ add(3, b) -> 3b</span></code></pre></ul><p>从 Vitest 0.25.3 开始，你可以使用模板字符串表。<ul><li>第一行应该是列名，使用 <code>|</code> 分隔；<li>使用 <code>${value}</code> 语法作为模板文本表达式，为一个或多个后续数据行提供数据。</ul><pre class="language-ts"><code class="language-ts">test<span class="token punctuation">.</span><span class="token property-access">each</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  a             | b      | expected
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">          | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">   | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'a'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">        | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'ab'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">         | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">         | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'[object Object]b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span> asd<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'[object Object]b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">(</span><span class="token string">'returns $expected when $a is added $b'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>如果你想访问 <code>TestContext</code>，请在单个测试中使用 <code>describe.each</code>。<blockquote>Vitest processes `$values` with chai `format` method. If the value is too truncated, you can increase [chaiConfig.truncateThreshold](../config.html#chaiconfig-truncatethreshold) in your config file.</blockquote><blockquote>当使用 Vitest 作为 [type checker](/guide/testing-types) 时，不能使用此语法。</blockquote></section></section><section class="level2"aria-labelledby="bench"><h2 id="bench">bench</h2><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: BenchFunction, options?: BenchOptions) => void</code></ul><p><code>bench</code> 定义了一个基准。 在 Vitest 术语中，基准是定义一系列操作的函数。 Vitest 多次运行此函数以显示不同的性能结果。<p>Vitest 在底层使用 <a href="https://github.com/tinylibs/tinybench"><code>tinybench</code></a> 库，继承其所有可用选项作为第三个参数。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">bench</span><span class="token punctuation">(</span>
  <span class="token string">'normal sorting'</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
    x<span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> time<span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span></code></pre><pre class="language-ts"><code class="language-ts"><span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">Options</span></span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * time needed for running a benchmark task (milliseconds)
   * <span class="token keyword">@default</span> 500
   */</span>
  time<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>

  <span class="token doc-comment comment">/**
   * number of times that a task should run if even the time option is finished
   * <span class="token keyword">@default</span> 10
   */</span>
  iterations<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>

  <span class="token doc-comment comment">/**
   * function to get the current timestamp in milliseconds
   */</span>
  now<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token builtin">number</span>

  <span class="token doc-comment comment">/**
   * An AbortSignal for aborting the benchmark
   */</span>
  signal<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">AbortSignal</span>

  <span class="token doc-comment comment">/**
   * warmup time (milliseconds)
   * <span class="token keyword">@default</span> 100ms
   */</span>
  warmupTime<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>

  <span class="token doc-comment comment">/**
   * warmup iterations
   * <span class="token keyword">@default</span> 5
   */</span>
  warmupIterations<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>

  <span class="token doc-comment comment">/**
   * setup function to run before each benchmark task (cycle)
   */</span>
  setup<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Hook</span>

  <span class="token doc-comment comment">/**
   * teardown function to run after each benchmark task (cycle)
   */</span>
  teardown<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Hook</span>
<span class="token punctuation">}</span></code></pre><section class="level3"aria-labelledby="benchskip"><h3 id="benchskip">bench.skip</h3><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: BenchFunction, options?: BenchOptions) => void</code></ul><p>你可以使用 <code>bench.skip</code> 语法跳过运行某些基准测试。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

bench<span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span><span class="token string">'normal sorting'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
  x<span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level3"aria-labelledby="benchonly"><h3 id="benchonly">bench.only</h3><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: BenchFunction, options?: BenchOptions) => void</code></ul><p>使用 <code>bench.only</code> 仅在指定测试套件中运行某些基准测试。这在调试时很有用。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

bench<span class="token punctuation">.</span><span class="token method function property-access">only</span><span class="token punctuation">(</span><span class="token string">'normal sorting'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
  x<span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level3"aria-labelledby="benchtodo"><h3 id="benchtodo">bench.todo</h3><ul><li><strong>类型:</strong> <code>(name: string | Function) => void</code></ul><p>使用 <code>bench.todo</code> 来存根基准测试，以便稍后实现。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

bench<span class="token punctuation">.</span><span class="token method function property-access">todo</span><span class="token punctuation">(</span><span class="token string">'unimplemented test'</span><span class="token punctuation">)</span></code></pre></section></section><section class="level2"aria-labelledby="describe"><h2 id="describe">describe</h2><p>当你在文件的顶层使用 <code>test</code> 或 <code>bench</code> 时，它们会被收集为它的隐式套件的一部分。 使用 <code>describe</code> 你可以在当前上下文中定义一个新套件，作为一组相关的测试或基准以及其他嵌套套件。 测试套件可让你组织测试和基准测试，从而使报告更加清晰。<pre class="language-ts"><code class="language-ts"><span class="token comment">// basic.spec.ts</span>
<span class="token comment">// organizing tests</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  isActive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'person is defined'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeDefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'is active'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token property-access">isActive</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'age limit'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeLessThanOrEqual</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><pre class="language-ts"><code class="language-ts"><span class="token comment">// basic.bench.ts</span>
<span class="token comment">// organizing benchmarks</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench<span class="token punctuation">,</span> describe <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'sort'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">'normal'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
    x<span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">'reverse'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
    x<span class="token punctuation">.</span><span class="token method function property-access">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>如果你需要有测试层次结构，你还可以嵌套描述块：<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">function</span> <span class="token function">numberToCurrency</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">!==</span> <span class="token string">'number'</span><span class="token punctuation">)</span>
    <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span><span class="token punctuation">(</span><span class="token string">'Value must be a number'</span><span class="token punctuation">)</span>

  <span class="token keyword control-flow">return</span> value
    <span class="token punctuation">.</span><span class="token method function property-access">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\B(?=(\d{3})+(?!\d))</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'numberToCurrency'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'given an invalid number'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'composed of non-numbers to throw error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">numberToCurrency</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toThrowError</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'given a valid number'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'returns the correct currency format'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">numberToCurrency</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token string">'10,000.00'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><section class="level3"aria-labelledby="describeskip"><h3 id="describeskip">describe.skip</h3><ul><li><p><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, options?: number | TestOptions) => void</code><p>在测试套件中使用 <code>describe.skip</code> 避免运行特定的描述块。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> describe<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

describe<span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span><span class="token string">'skipped suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'sqrt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 跳过测试套件，不会有错误</span>
    assert<span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section class="level3"aria-labelledby="describeskipif"><h3 id="describeskipif">describe.skipIf</h3><ul><li><p><strong>类型:</strong> <code>(condition: any) => void</code><p>在某些情况下，你可能会在不同的环境中多次运行套件，并且某些套件可能是特定于环境的。你可以使用 <code>describe.skipIf</code> 在条件为真时跳过套件，而不是用 <code>if</code> 包装套件。</ul><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assert<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> isDev <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>

test<span class="token punctuation">.</span><span class="token method function property-access">skipIf</span><span class="token punctuation">(</span>isDev<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'prod only test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 仅在生产中运行</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>当 Vitest 作为 [类型检查器](/guide/testing-types) 时，你不能使用此语法。</blockquote></section><section class="level3"aria-labelledby="describeonly"><h3 id="describeonly">describe.only</h3><ul><li><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, options?: number | TestOptions) => void</code></ul><p>使用 <code>describe.only</code> 仅运行指定的测试套件。<pre class="language-ts"><code class="language-ts"><span class="token comment">// 仅运行此测试套件（以及仅标有的其他测试套件）</span>
describe<span class="token punctuation">.</span><span class="token method function property-access">only</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'sqrt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    assert<span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">sqrt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'other suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 测试套件将会被跳过</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>有时候只运行一个特定文件中的 <code>only</code> 测试用例是很有用的，这可以忽略整个测试套件中的所有其他测试用例，避免污染输出。<p>为了做到这一点，运行 <code>vitest</code> 命令并带上包含有问题的测试的特定文件。<pre class="language-text"><code class="language-text"># vitest interesting.test.ts</code></pre></section><section class="level3"aria-labelledby="describeconcurrent"><h3 id="describeconcurrent">describe.concurrent</h3><ul><li><p><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, options?: number | TestOptions) => void</code><p>使用 <code>describe.concurrent</code> 在测试套件中将每个测试标记为并发。<pre class="language-ts"><code class="language-ts"><span class="token comment">// 该测试套件中的所有测试都将并行运行</span>
describe<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  test<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'concurrent test 3'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><code>.skip</code>，<code>.only</code> 和 <code>.todo</code> 可以与并发测试套件一起使用。以下所有组合均有效：<pre class="language-ts"><code class="language-ts">describe<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span>
describe<span class="token punctuation">.</span><span class="token property-access">skip</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or describe.concurrent.skip(/* ... */)</span>
describe<span class="token punctuation">.</span><span class="token property-access">only</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or describe.concurrent.only(/* ... */)</span>
describe<span class="token punctuation">.</span><span class="token property-access">todo</span><span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token comment">// or describe.concurrent.todo(/* ... */)</span></code></pre></ul><p>在异步并发测试中使用快照时，由于 JavaScript 的限制，你需要使用 <a href="/guide/test-context.md">测试环境</a> 中的 <code>expect</code> 来确保检测到正确的测试。<pre class="language-ts"><code class="language-ts">describe<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote>当 Vitest 作为 [类型检查器](/guide/testing-types) 时，你不能使用此语法。</blockquote></section><section class="level3"aria-labelledby="describesequential"><h3 id="describesequential">describe.sequential</h3><ul><li><p><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, options?: number | TestOptions) => void</code><p>测试套件中的 <code>describe.sequential</code> 将每个测试标记为连续的。如果你想在 <code>describe.concurrent</code> 中或使用 <code>--sequence.concurrent</code> 命令选项按顺序运行测试，这非常有用。<pre class="language-ts"><code class="language-ts">describe<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'concurrent test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  describe<span class="token punctuation">.</span><span class="token method function property-access">sequential</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'sequential test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">/* ... */</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'sequential test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">/* ... */</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section class="level3"aria-labelledby="describeshuffle"><h3 id="describeshuffle">describe.shuffle</h3><ul><li><p><strong>类型:</strong> <code>(name: string | Function, fn: TestFunction, options?: number | TestOptions) => void</code><p>Vitest 提供了一种通过 CLI 标志 <a href="../guide/cli"><code>--sequence.shuffle</code></a> 或配置选项 <a href="/config.html#sequence-shuffle"><code>sequence.shuffle</code></a> 来随机运行所有测试的方法，但是如果你只想让测试套件的一部分以随机顺序运行测试，可以使用此标志对其进行标记。<pre class="language-ts"><code class="language-ts">describe<span class="token punctuation">.</span><span class="token method function property-access">shuffle</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'random test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'random test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'random test 3'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 执行顺序依赖于 sequence.seed 的配置选项(默认为 Date.now())</span></code></pre></ul><p><code>.skip</code>，<code>.only</code> 和 <code>.todo</code> 可以与并发测试套件一起使用。以下所有组合均有效：<blockquote>当 Vitest 作为 [类型检查器](/guide/testing-types) 时，你不能使用此语法。</blockquote></section><section class="level3"aria-labelledby="describetodo"><h3 id="describetodo">describe.todo</h3><ul><li><p><strong>类型:</strong> <code>(name: string | Function) => void</code><p>使用 <code>describe.todo</code> 将稍后实现的测试套件进行存档。测试报告中将显示一个记录，以便你知道还多少条未实现的测试。<pre class="language-ts"><code class="language-ts"><span class="token comment">// 测试套件的报告中将显示一个记录</span>
describe<span class="token punctuation">.</span><span class="token method function property-access">todo</span><span class="token punctuation">(</span><span class="token string">'unimplemented suite'</span><span class="token punctuation">)</span></code></pre></ul></section><section class="level3"aria-labelledby="describeeach"><h3 id="describeeach">describe.each</h3><ul><li><p><strong>类型:</strong> <code>(cases: ReadonlyArray&#x3C;T>, ...args: any[]): (name: string | Function, fn: (...args: T[]) => void, options?: number | TestOptions) => void</code><p>如果你有多个测试依赖相同的数据，可以使用 <code>describe.each</code>。<pre class="language-ts"><code class="language-ts">describe<span class="token punctuation">.</span><span class="token method function property-access">each</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> expected<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'describe object add($a, $b)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">returns </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expected<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">returned value not be greater than </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expected<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeGreaterThan</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">returned value not be less than </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expected<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBeLessThan</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>从 Vitest 0.25.3 开始，你可以使用模板字符串表。<ul><li>第一行应该是列名，使用 <code>|</code> 分隔；<li>使用 <code>${value}</code> 语法作为模板文本表达式，为一个或多个后续数据行提供数据。</ul><pre class="language-ts"><code class="language-ts">describe<span class="token punctuation">.</span><span class="token property-access">each</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  a             | b      | expected
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">          | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">   | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'a'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">        | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'ab'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">         | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">         | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'[object Object]b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">{</span> asd<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'[object Object]b'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">(</span><span class="token string">'describe template string add($a, $b)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> expected <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">returns </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expected<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul><blockquote>当使用 Vitest 作为 [type checker](/guide/testing-types) 时，不能使用此语法。</blockquote></section></section><section class="level2"aria-labelledby="setup-and-teardown"><h2 id="setup-and-teardown">Setup and Teardown</h2><p>这些功能允许我们连接到测试的生命周期，以避免重复设置和拆卸代码。 它们适用于当前上下文：如果它们在顶层使用，则适用于文件；如果它们在 <code>describe</code> 块内，则适用于当前测试套件。<section class="level3"aria-labelledby="beforeeach"><h3 id="beforeeach">beforeEach</h3><ul><li><p><strong>类型:</strong> <code>beforeEach(fn: () => Awaitable&#x3C;void>, timeout?: number)</code><p>注册一个回调,在当前上下文中的每个测试运行之前被调用。 如果函数返回一个 <code>Promise</code>，<code>Vitest</code> 会等到 <code>Promise</code> 解决后再运行测试。<p>或者，我们可以传递一个超时（以毫秒为单位），定义在终止之前等待多长时间。 默认值为 5 秒。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> beforeEach <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 在每次测试运行之前清除模拟并添加一些测试数据</span>
  <span class="token keyword control-flow">await</span> <span class="token function">stopMocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword control-flow">await</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'John'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>这里的 <code>beforeEach</code> 确保为每个测试都添加用户。<p>从 Vitest v0.10.0 开始，<code>beforeEach</code> 还接受一个可选的清理功能（相当于 <code>afterEach</code>）。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> beforeEach <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 在所有测试运行之前调用一次</span>
  <span class="token keyword control-flow">await</span> <span class="token function">prepareSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 清理方法，在所有测试运行后调用一次</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">await</span> <span class="token function">resetSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section class="level3"aria-labelledby="aftereach"><h3 id="aftereach">afterEach</h3><ul><li><p><strong>类型:</strong> <code>afterEach(fn: () => Awaitable&#x3C;void>, timeout?: number)</code><p>注册一个回调,在当前上下文中的每个测试运行之后被调用。 如果函数返回一个 Promise ，Vitest 会等到 Promise 解决后再继续。<p>或者，你可以设置超时（以毫秒为单位）以指定在终止前等待多长时间。 默认值为 5 秒。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> afterEach <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token function">clearTestingData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 每次测试运行后清除测试数据</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>这里的 <code>afterEach</code> 确保在每次测试运行后清除测试数据。</ul></section><section class="level3"aria-labelledby="beforeall"><h3 id="beforeall">beforeAll</h3><ul><li><p><strong>类型:</strong> <code>beforeAll(fn: () => Awaitable&#x3C;void>, timeout?: number)</code><p>注册一个回调，在开始运行当前上下文中的所有测试之前被调用一次。 如果函数返回一个 <code>Promise</code>，<code>Vitest</code> 会等到 <code>Promise</code> 解决后再运行测试。<p>或者，你可以提供超时（以毫秒为单位）以指定在终止之前等待多长时间。 默认值为 5 秒。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> beforeAll <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token function">startMocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 在所有测试运行之前调用一次</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>这里的 <code>beforeAll</code> 确保在测试运行之前设置模拟数据。<p>从 Vitest v0.10.0 开始，<code>beforeAll</code> 还可以接受一个可选的清理功能（相当于 <code>afterAll</code>）。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> beforeAll <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 在所有测试运行之前调用一次</span>
  <span class="token keyword control-flow">await</span> <span class="token function">startMocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 清理函数，在所有测试运行后调用一次</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">await</span> <span class="token function">stopMocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section class="level3"aria-labelledby="afterall"><h3 id="afterall">afterAll</h3><ul><li><p><strong>类型:</strong> <code>afterAll(fn: () => Awaitable&#x3C;void>, timeout?: number)</code><p>注册一个回调，在当前上下文中运行所有测试后被调用一次。 如果函数返回一个 Promise，Vitest 会等到 Promise 解决后再继续。<p>或者，你可以提供超时（以毫秒为单位）以指定在终止之前等待多长时间。 默认值为 5 秒。<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> afterAll <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">afterAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token function">stopMocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 在所有测试运行后调用此方法</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul><p>这里的 <code>afterAll</code> 确保在所有测试运行后调用 <code>stopMocking</code> 方法。 <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section></section>