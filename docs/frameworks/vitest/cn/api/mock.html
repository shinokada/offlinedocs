<!doctype html><html lang="cn"><meta charset="utf-8"><title>Mock Functions</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="mock-functions"class="level1"><h1>Mock Functions</h1><p>You can create a spy function (mock) to track its execution with <code>vi.fn</code> method. If you want to track a method on an already created object, you can use <code>vi.spyOn</code> method:<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> fn <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span>
fn<span class="token punctuation">.</span><span class="token property-access">mock</span><span class="token punctuation">.</span><span class="token property-access">calls</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token punctuation">[</span><span class="token string">'hello world'</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> market <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">getApples</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token number">100</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> getApplesSpy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">spyOn</span><span class="token punctuation">(</span>market<span class="token punctuation">,</span> <span class="token string">'getApples'</span><span class="token punctuation">)</span>
market<span class="token punctuation">.</span><span class="token method function property-access">getApples</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
getApplesSpy<span class="token punctuation">.</span><span class="token property-access">mock</span><span class="token punctuation">.</span><span class="token property-access">calls</span><span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">===</span> <span class="token number">1</span></code></pre><p>You should use spy assertions (e.g., <a href="/api/expect#tohavebeencalled"><code>toHaveBeenCalled</code></a>) on <a href="/api/expect"><code>expect</code></a> to assert spy result. This API reference describes available properties and methods to manipulate spy behavior.<section id="getmockname"class="level2"><h2>getMockName</h2><ul><li><p><strong>Type:</strong> <code>() => string</code><p>Use it to return the name given to mock with method <code>.mockName(name)</code>.</ul></section><section id="mockclear"class="level2"><h2>mockClear</h2><ul><li><p><strong>Type:</strong> <code>() => MockInstance</code><p>Clears all information about every call. After calling it, <a href="#mock-calls"><code>spy.mock.calls</code></a>, <a href="#mock-results"><code>spy.mock.results</code></a> will return empty arrays. It is useful if you need to clean up spy between different assertions.<p>If you want this method to be called before each test automatically, you can enable <a href="../config.html#clearmocks"><code>clearMocks</code></a> setting in config.</ul></section><section id="mockname"class="level2"><h2>mockName</h2><ul><li><p><strong>Type:</strong> <code>(name: string) => MockInstance</code><p>Sets internal mock name. Useful to see what mock has failed the assertion.</ul></section><section id="mockimplementation"class="level2"><h2>mockImplementation</h2><ul><li><p><strong>Type:</strong> <code>(fn: Function) => MockInstance</code><p>Accepts a function that will be used as an implementation of the mock.<p>For example:<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> mockFn <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">mockImplementation</span><span class="token punctuation">(</span>apples <span class="token arrow operator">=></span> apples <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">// or: vi.fn(apples => apples + 1);</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">NelliesBucket</span> <span class="token operator">=</span> <span class="token function">mockFn</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">BobsBucket</span> <span class="token operator">=</span> <span class="token function">mockFn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token maybe-class-name">NelliesBucket</span> <span class="token operator">===</span> <span class="token number">1</span> <span class="token comment">// true</span>
<span class="token maybe-class-name">BobsBucket</span> <span class="token operator">===</span> <span class="token number">2</span> <span class="token comment">// true</span>

mockFn<span class="token punctuation">.</span><span class="token property-access">mock</span><span class="token punctuation">.</span><span class="token property-access">calls</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token comment">// true</span>
mockFn<span class="token punctuation">.</span><span class="token property-access">mock</span><span class="token punctuation">.</span><span class="token property-access">calls</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">1</span> <span class="token comment">// true</span></code></pre></ul></section><section id="mockimplementationonce"class="level2"><h2>mockImplementationOnce</h2><ul><li><p><strong>Type:</strong> <code>(fn: Function) => MockInstance</code><p>Accepts a function that will be used as an implementation of the mock for one call to the mocked function. Can be chained so that multiple function calls produce different results.<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> myMockFn <span class="token operator">=</span> vi
  <span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockImplementationOnce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockImplementationOnce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token boolean">false</span><span class="token punctuation">)</span>

<span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// false</span></code></pre><p>When the mocked function runs out of implementations, it will invoke the default implementation that was set with <code>vi.fn(() => defaultValue)</code> or <code>.mockImplementation(() => defaultValue)</code> if they were called:<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> myMockFn <span class="token operator">=</span> vi
  <span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token string">'default'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockImplementationOnce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token string">'first call'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockImplementationOnce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token string">'second call'</span><span class="token punctuation">)</span>

<span class="token comment">// 'first call', 'second call', 'default', 'default'</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></ul></section><section id="mockrejectedvalue"class="level2"><h2>mockRejectedValue</h2><ul><li><p><strong>Type:</strong> <code>(value: any) => MockInstance</code><p>Accepts an error that will be rejected, when async function will be called.<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> asyncMock <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">mockRejectedValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span><span class="token punctuation">(</span><span class="token string">'Async error'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword control-flow">await</span> <span class="token function">asyncMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// throws "Async error"</span></code></pre></ul></section><section id="mockrejectedvalueonce"class="level2"><h2>mockRejectedValueOnce</h2><ul><li><p><strong>Type:</strong> <code>(value: any) => MockInstance</code><p>Accepts a value that will be rejected for one call to the mock function. If chained, every consecutive call will reject passed value.<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> asyncMock <span class="token operator">=</span> vi
  <span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockResolvedValueOnce</span><span class="token punctuation">(</span><span class="token string">'first call'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockRejectedValueOnce</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span><span class="token punctuation">(</span><span class="token string">'Async error'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword control-flow">await</span> <span class="token function">asyncMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// first call</span>
<span class="token keyword control-flow">await</span> <span class="token function">asyncMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// throws "Async error"</span></code></pre></ul></section><section id="mockreset"class="level2"><h2>mockReset</h2><ul><li><p><strong>Type:</strong> <code>() => MockInstance</code><p>Does what <code>mockClear</code> does and makes inner implementation an empty function (returning <code>undefined</code>, when invoked). This is useful when you want to completely reset a mock back to its initial state.<p>If you want this method to be called before each test automatically, you can enable <a href="../config.html#mockreset"><code>mockReset</code></a> setting in config.</ul></section><section id="mockrestore"class="level2"><h2>mockRestore</h2><ul><li><p><strong>Type:</strong> <code>() => MockInstance</code><p>Does what <code>mockReset</code> does and restores inner implementation to the original function.<p>Note that restoring mock from <code>vi.fn()</code> will set implementation to an empty function that returns <code>undefined</code>. Restoring a <code>vi.fn(impl)</code> will restore implementation to <code>impl</code>.<p>If you want this method to be called before each test automatically, you can enable <a href="../config.html#restoreMocks"><code>restoreMocks</code></a> setting in config.</ul></section><section id="mockresolvedvalue"class="level2"><h2>mockResolvedValue</h2><ul><li><p><strong>Type:</strong> <code>(value: any) => MockInstance</code><p>Accepts a value that will be resolved, when async function will be called.<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> asyncMock <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">mockResolvedValue</span><span class="token punctuation">(</span><span class="token number">43</span><span class="token punctuation">)</span>

<span class="token keyword control-flow">await</span> <span class="token function">asyncMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 43</span></code></pre></ul></section><section id="mockresolvedvalueonce"class="level2"><h2>mockResolvedValueOnce</h2><ul><li><p><strong>Type:</strong> <code>(value: any) => MockInstance</code><p>Accepts a value that will be resolved for one call to the mock function. If chained, every consecutive call will resolve passed value.<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> asyncMock <span class="token operator">=</span> vi
  <span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockResolvedValue</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockResolvedValueOnce</span><span class="token punctuation">(</span><span class="token string">'first call'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockResolvedValueOnce</span><span class="token punctuation">(</span><span class="token string">'second call'</span><span class="token punctuation">)</span>

<span class="token keyword control-flow">await</span> <span class="token function">asyncMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// first call</span>
<span class="token keyword control-flow">await</span> <span class="token function">asyncMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// second call</span>
<span class="token keyword control-flow">await</span> <span class="token function">asyncMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// default</span>
<span class="token keyword control-flow">await</span> <span class="token function">asyncMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// default</span></code></pre></ul></section><section id="mockreturnthis"class="level2"><h2>mockReturnThis</h2><ul><li><p><strong>Type:</strong> <code>() => MockInstance</code><p>Sets inner implementation to return <code>this</code> context.</ul></section><section id="mockreturnvalue"class="level2"><h2>mockReturnValue</h2><ul><li><p><strong>Type:</strong> <code>(value: any) => MockInstance</code><p>Accepts a value that will be returned whenever the mock function is called.<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> mock <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
mock<span class="token punctuation">.</span><span class="token method function property-access">mockReturnValue</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
<span class="token function">mock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 42</span>
mock<span class="token punctuation">.</span><span class="token method function property-access">mockReturnValue</span><span class="token punctuation">(</span><span class="token number">43</span><span class="token punctuation">)</span>
<span class="token function">mock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 43</span></code></pre></ul></section><section id="mockreturnvalueonce"class="level2"><h2>mockReturnValueOnce</h2><ul><li><p><strong>Type:</strong> <code>(value: any) => MockInstance</code><p>Accepts a value that will be returned for one call to the mock function. If chained, every consecutive call will return the passed value. When there are no more <code>mockReturnValueOnce</code> values to use, call a function specified by <code>mockImplementation</code> or other <code>mockReturn*</code> methods.<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> myMockFn <span class="token operator">=</span> vi
  <span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockReturnValue</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockReturnValueOnce</span><span class="token punctuation">(</span><span class="token string">'first call'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">mockReturnValueOnce</span><span class="token punctuation">(</span><span class="token string">'second call'</span><span class="token punctuation">)</span>

<span class="token comment">// 'first call', 'second call', 'default', 'default'</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">myMockFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></ul></section><section id="mockcalls"class="level2"><h2>mock.calls</h2><p>This is an array containing all arguments for each call. One item of the array is the arguments of that call.<p>If a function was invoked twice with the following arguments <code>fn(arg1, arg2)</code>, <code>fn(arg3, arg4)</code> in that order, then <code>mock.calls</code> will be:<pre class="language-js"><code class="language-js"><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">'arg1'</span><span class="token punctuation">,</span> <span class="token string">'arg2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'arg3'</span><span class="token punctuation">,</span> <span class="token string">'arg4'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span></code></pre></section><section id="mocklastcall"class="level2"><h2>mock.lastCall</h2><p>This contains the arguments of the last call. If spy wasn't called, will return <code>undefined</code>.</section><section id="mockresults"class="level2"><h2>mock.results</h2><p>This is an array containing all values, that were <code>returned</code> from the function. One item of the array is an object with properties <code>type</code> and <code>value</code>. Available types are:<ul><li><code>'return'</code> - function returned without throwing.<li><code>'throw'</code> - function threw a value.</ul><p>The <code>value</code> property contains returned value or thrown error.<p>If function returned <code>result</code>, then threw an error, then <code>mock.results</code> will be:<pre class="language-js"><code class="language-js"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'return'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'result'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'throw'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span></code></pre></section><section id="mockinstances"class="level2"><h2>mock.instances</h2><p>This is an array containing all instances that were instantiated when mock was called with a <code>new</code> keyword. Note, this is an actual context (<code>this</code>) of the function, not a return value.<blockquote>If mock was instantiated with `new MyClass()`, then `mock.instances` will be an array with one value:<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token maybe-class-name">MyClass</span> <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token maybe-class-name">MyClass</span><span class="token punctuation">.</span><span class="token property-access">mock</span><span class="token punctuation">.</span><span class="token property-access">instances</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> a</code></pre><p>If you return a value from constructor, it will not be in <code>instances</code> array, but instead inside <code>results</code>:<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token maybe-class-name">Spy</span> <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">method</span><span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Spy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token maybe-class-name">Spy</span><span class="token punctuation">.</span><span class="token property-access">mock</span><span class="token punctuation">.</span><span class="token property-access">instances</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!==</span> a
<span class="token maybe-class-name">Spy</span><span class="token punctuation">.</span><span class="token property-access">mock</span><span class="token punctuation">.</span><span class="token property-access">results</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> a</code></pre></blockquote><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>