<!doctype html><html lang="en"><meta charset="utf-8"><title>Features | Guide</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="outline"content="deep"><link rel="stylesheet"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="features"><h1 id="features">Features</h1><featureslist class="!gap-1 text-lg"><div h-2=""><courselink href="https://vueschool.io/lessons/your-first-test?friend=vueuse">Learn how to write your first test by Video</courselink><section class="level2"aria-labelledby="shared-config-between-test-dev-and-build"><h2 id="shared-config-between-test-dev-and-build">Shared Config between Test, Dev and Build</h2><p>Vite's config, transformers, resolvers, and plugins. Use the same setup from your app to run the tests.<p>Learn more at <a href="../guide.html#configuring-vitest">Configuring Vitest</a>.</section><section class="level2"aria-labelledby="watch-mode"><h2 id="watch-mode">Watch Mode</h2><pre class="language-bash"><code class="language-bash">$ vitest</code></pre><p>When you modify your source code or the test files, Vitest smartly searches the module graph and only reruns the related tests, <a href="https://twitter.com/antfu7/status/1468233216939245579">just like how HMR works in Vite!</a><p><code>vitest</code> starts in <code>watch mode</code> <strong>by default in development environment</strong> and <code>run mode</code> in CI environment (when <code>process.env.CI</code> presents) smartly. You can use <code>vitest watch</code> or <code>vitest run</code> to explicitly specify the desired mode.</section><section class="level2"aria-labelledby="common-web-idioms-out-of-the-box"><h2 id="common-web-idioms-out-of-the-box">Common Web Idioms Out-Of-The-Box</h2><p>Out-of-the-box ES Module / TypeScript / JSX support / PostCSS</section><section class="level2"aria-labelledby="threads"><h2 id="threads">Threads</h2><p>Workers multi-threading via <a href="https://github.com/tinylibs/tinypool">Tinypool</a> (a lightweight fork of <a href="https://github.com/piscinajs/piscina">Piscina</a>), allowing tests to run simultaneously. Threads are enabled by default in Vitest, and can be disabled by passing <code>--no-threads</code> in the CLI.<p>Vitest also isolates each file's environment so env mutations in one file don't affect others. Isolation can be disabled by passing <code>--no-isolate</code> to the CLI (trading correctness for run performance).</section><section class="level2"aria-labelledby="test-filtering"><h2 id="test-filtering">Test Filtering</h2><p>Vitest provided many ways to narrow down the tests to run in order to speed up testing so you can focus on development.<p>Learn more about <a href="./filtering.md">Test Filtering</a>.</section><section class="level2"aria-labelledby="running-tests-concurrently"><h2 id="running-tests-concurrently">Running Tests Concurrently</h2><p>Use <code>.concurrent</code> in consecutive tests to run them in parallel.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token comment">// The two tests marked with concurrent will be run in parallel</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'serial test'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  it<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  it<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'concurrent test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>If you use <code>.concurrent</code> on a suite, every test in it will be run in parallel.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token comment">// All tests within this suite will be run in parallel</span>
describe<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'suite'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'concurrent test 1'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'concurrent test 2'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  it<span class="token punctuation">.</span><span class="token method function property-access">concurrent</span><span class="token punctuation">(</span><span class="token string">'concurrent test 3'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> expect <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>You can also use <code>.skip</code>, <code>.only</code>, and <code>.todo</code> with concurrent suites and tests. Read more in the <a href="../api.html#test-concurrent">API Reference</a>.<blockquote>When running concurrent tests, Snapshots and Assertions must use `expect` from the local [Test Context](/guide/test-context.md) to ensure the right test is detected.</blockquote></section><section class="level2"aria-labelledby="snapshot"><h2 id="snapshot">Snapshot</h2><p><a href="https://jestjs.io/docs/snapshot-testing">Jest-compatible</a> snapshot support.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> it <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders correctly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Learn more at <a href="/guide/snapshot">Snapshot</a>.</section><section class="level2"aria-labelledby="chai-and-jest-expect-compatibility"><h2 id="chai-and-jest-expect-compatibility">Chai and Jest <code>expect</code> Compatibility</h2><p><a href="https://www.chaijs.com/">Chai</a> is built-in for assertions plus <a href="https://jestjs.io/docs/expect">Jest <code>expect</code></a>-compatible APIs.<p>Notice that if you are using third-party libraries that add matchers, setting <code>test.globals</code> to <code>true</code> will provide better compatibility.</section><section class="level2"aria-labelledby="mocking"><h2 id="mocking">Mocking</h2><p><a href="https://github.com/tinylibs/tinyspy">Tinyspy</a> is built-in for mocking with <code>jest</code>-compatible APIs on <code>vi</code> object.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword">const</span> fn <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token function">expect</span><span class="token punctuation">(</span>vi<span class="token punctuation">.</span><span class="token method function property-access">isMockFunction</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>fn<span class="token punctuation">.</span><span class="token property-access">mock</span><span class="token punctuation">.</span><span class="token property-access">calls</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

fn<span class="token punctuation">.</span><span class="token method function property-access">mockImplementation</span><span class="token punctuation">(</span>arg <span class="token arrow operator">=></span> arg<span class="token punctuation">)</span>

<span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token function">expect</span><span class="token punctuation">(</span>fn<span class="token punctuation">.</span><span class="token property-access">mock</span><span class="token punctuation">.</span><span class="token property-access">results</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span></code></pre><p>Vitest supports both <a href="https://github.com/capricorn86/happy-dom">happy-dom</a> or <a href="https://github.com/jsdom/jsdom">jsdom</a> for mocking DOM and browser APIs. They don't come with Vitest, you might need to install them:<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i -D happy-dom
<span class="token comment"># or</span>
$ <span class="token function">npm</span> i -D jsdom</code></pre><p>After that, change the <code>environment</code> option in your config file:<pre class="language-ts"><code class="language-ts"><span class="token comment">// vitest.config.ts</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest/config'</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    environment<span class="token operator">:</span> <span class="token string">'happy-dom'</span><span class="token punctuation">,</span> <span class="token comment">// or 'jsdom', 'node'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Learn more at <a href="/guide/mocking">Mocking</a>.</section><section class="level2"aria-labelledby="coverage"><h2 id="coverage">Coverage</h2><p>Vitest supports Native code coverage via <a href="https://v8.dev/blog/javascript-code-coverage"><code>v8</code></a> and instrumented code coverage via <a href="https://istanbul.js.org/"><code>istanbul</code></a>.<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"vitest"</span><span class="token punctuation">,</span>
    <span class="token property">"coverage"</span><span class="token operator">:</span> <span class="token string">"vitest run --coverage"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Learn more at <a href="/guide/coverage">Coverage</a>.</section><section class="level2"aria-labelledby="in-source-testing"><h2 id="in-source-testing">In-Source Testing</h2><p>Vitest also provides a way to run tests within your source code along with the implementation, similar to <a href="https://doc.rust-lang.org/book/ch11-03-test-organization.html#the-tests-module-and-cfgtest">Rust's module tests</a>.<p>This makes the tests share the same closure as the implementations and able to test against private states without exporting. Meanwhile, it also brings the feedback loop closer for development.<pre class="language-ts"><code class="language-ts"><span class="token comment">// src/index.ts</span>

<span class="token comment">// the implementation</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token spread operator">...</span>args<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> args<span class="token punctuation">.</span><span class="token method function property-access">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> a <span class="token operator">+</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// in-source test suites</span>
<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">vitest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> it<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">vitest</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><p>Learn more at <a href="/guide/in-source">In-source testing</a>.</section><section class="level2"aria-labelledby="benchmarking-badge-typewarningexperimentalbadge"><h2 id="benchmarking-badge-typewarningexperimentalbadge">Benchmarking<badge type="warning">Experimental</badge></h2><p>Since Vitest 0.23.0, you can run benchmark tests with <a href="../api.html#bench"><code>bench</code></a> function via <a href="https://github.com/tinylibs/tinybench">Tinybench</a> to compare performance results.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> bench<span class="token punctuation">,</span> describe <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'sort'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">'normal'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
    x<span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">bench</span><span class="token punctuation">(</span><span class="token string">'reverse'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
    x<span class="token punctuation">.</span><span class="token method function property-access">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="type-testing-badge-typewarningexperimentalbadge"><h2 id="type-testing-badge-typewarningexperimentalbadge">Type Testing<badge type="warning">Experimental</badge></h2><p>Since Vitest 0.25.0 you can <a href="/guide/testing-types">write tests</a> to catch type regressions. Vitest comes with <a href="https://github.com/mmkal/expect-type"><code>expect-type</code></a> package to provide you with a similar and easy to understand API.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assertType<span class="token punctuation">,</span> expectTypeOf <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> mount <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./mount.js'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'my types work properly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expectTypeOf</span><span class="token punctuation">(</span>mount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBeFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expectTypeOf</span><span class="token punctuation">(</span>mount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">parameter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">toMatchTypeOf</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// @ts-expect-error name is a string</span>
  <span class="token function">assertType</span><span class="token punctuation">(</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></div></featureslist></section>