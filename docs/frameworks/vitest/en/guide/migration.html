<!doctype html><html lang="en"><meta charset="utf-8"><title>Migration Guide | Guide</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="migration-guide"><h1 id="migration-guide">Migration Guide</h1><section class="level2"aria-labelledby="migrating-from-jest"><h2 id="migrating-from-jest">Migrating from Jest</h2><p>Vitest has been designed with a Jest compatible API, in order to make the migration from Jest as simple as possible. Despite those efforts, you may still run into the following differences:<section class="level3"aria-labelledby="globals-as-a-default"><h3 id="globals-as-a-default">Globals as a Default</h3><p>Jest has their <a href="https://jestjs.io/docs/api">globals API</a> enabled by default. Vitest does not. You can either enable globals via <a href="../config.html#globals">the <code>globals</code> configuration setting</a> or update your code to use imports from the <code>vitest</code> module instead.<p>If you decide to keep globals disabled, be aware that common libraries like <a href="https://testing-library.com/"><code>testing-library</code></a> will not run auto DOM <a href="https://testing-library.com/docs/svelte-testing-library/api/#cleanup">cleanup</a>.</section><section class="level3"aria-labelledby="module-mocks"><h3 id="module-mocks">Module mocks</h3><p>When mocking a module in Jest, the factory argument's return value is the default export. In Vitest, the factory argument has to return an object with each export explicitly defined. For example, the following <code>jest.mock</code> would have to be updated as follows:<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> jest.mock('./some-path', () => 'hello')
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> vi.mock('./some-path', () => ({
</span><span class="token prefix inserted">+</span><span class="token line">   default: 'hello',
</span><span class="token prefix inserted">+</span><span class="token line"> })</span></span></code></pre><p>For more details please refer to the <a href="/api/vi#vi-mock"><code>vi.mock</code> api section</a>.</section><section class="level3"aria-labelledby="auto-mocking-behaviour"><h3 id="auto-mocking-behaviour">Auto-Mocking Behaviour</h3><p>Unlike Jest, mocked modules in <code>&#x3C;root>/__mocks__</code> are not loaded unless <code>vi.mock()</code> is called. If you need them to be mocked in every test, like in Jest, you can mock them inside <a href="../config.html#setupfiles"><code>setupFiles</code></a>.</section><section class="level3"aria-labelledby="importing-the-original-of-a-mocked-package"><h3 id="importing-the-original-of-a-mocked-package">Importing the original of a mocked package</h3><p>If you are only partially mocking a package, you might have previously used Jest's function <code>requireActual</code>. In Vitest, you should replace these calls with <code>vi.importActual</code>.<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> const { cloneDeep } = jest.requireActual('lodash/cloneDeep')
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const { cloneDeep } = await vi.importActual('lodash/cloneDeep')</span></span></code></pre></section><section class="level3"aria-labelledby="envs"><h3 id="envs">Envs</h3><p>Just like Jest, Vitest sets <code>NODE_ENV</code> to <code>test</code>, if it wasn't set before. Vitest also has a counterpart for <code>JEST_WORKER_ID</code> called <code>VITEST_POOL_ID</code> (always less than or equal to <code>maxThreads</code>), so if you rely on it, don't forget to rename it. Vitest also exposes <code>VITEST_WORKER_ID</code> which is a unique ID of a running worker - this number is not affected by <code>maxThreads</code>, and will increase with each created worker.<p>If you want to modify the envs, you will use <a href="https://jestjs.io/docs/jest-object#jestreplacepropertyobject-propertykey-value">replaceProperty API</a> in Jest, you can use <a href="https://vitest.dev/api/vi.html#vi-stubenv">vi.stubEnv</a> to do it also in Vitest.</section><section class="level3"aria-labelledby="done-callback"><h3 id="done-callback">Done Callback</h3><p>From Vitest v0.10.0, the callback style of declaring tests is deprecated. You can rewrite them to use <code>async</code>/<code>await</code> functions, or use Promise to mimic the callback style.<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> it('should work', (done) => {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> it('should work', () => new Promise(done => {
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   // ...
</span><span class="token prefix unchanged"> </span><span class="token line">   done()
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> })
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> }))</span></span></code></pre></section><section class="level3"aria-labelledby="hooks"><h3 id="hooks">Hooks</h3><p><code>beforeAll</code>/<code>beforeEach</code> hooks may return <a href="../api.html#setup-and-teardown">teardown function</a> in Vitest. Because of that you may need to rewrite your hooks declarations, if they return something other than <code>undefined</code> or <code>null</code>:<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> beforeEach(() => setActivePinia(createTestingPinia()))
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> beforeEach(() => { setActivePinia(createTestingPinia()) })</span></span></code></pre></section><section class="level3"aria-labelledby="types"><h3 id="types">Types</h3><p>Vitest doesn't expose a lot of types on <code>Vi</code> namespace, it exists mainly for compatibility with matchers, so you might need to import types directly from <code>vitest</code> instead of relying on <code>Vi</code> namespace:<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> let fn: jest.Mock&#x3C;string, [string]>
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import type { Mock } from 'vitest'
</span><span class="token prefix inserted">+</span><span class="token line"> let fn: Mock&#x3C;[string], string></span></span></code></pre><p>Also, Vitest has <code>Args</code> type as a first argument instead of <code>Returns</code>, as you can see in diff.</section><section class="level3"aria-labelledby="timers"><h3 id="timers">Timers</h3><p>Vitest doesn't support Jest's legacy timers.</section><section class="level3"aria-labelledby="vue-snapshots"><h3 id="vue-snapshots">Vue Snapshots</h3><p>This is not a Jest-specific feature, but if you previously were using Jest with vue-cli preset, you will need to install <a href="https://github.com/eddyerburgh/jest-serializer-vue"><code>jest-serializer-vue</code></a> package, and use it inside <a href="../config.html#setupfiles">setupFiles</a>:<p><code>vite.config.js</code><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vite'</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">setupFiles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./tests/unit/setup.js'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><code>tests/unit/setup.js</code><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports">vueSnapshotSerializer</span> <span class="token keyword module">from</span> <span class="token string">'jest-serializer-vue'</span>

expect<span class="token punctuation">.</span><span class="token method function property-access">addSnapshotSerializer</span><span class="token punctuation">(</span>vueSnapshotSerializer<span class="token punctuation">)</span></code></pre><p>Otherwise your snapshots will have a lot of escaped <code>"</code> characters. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section></section>