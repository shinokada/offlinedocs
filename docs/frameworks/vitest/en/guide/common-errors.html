<!doctype html><html lang="en"><meta charset="utf-8"><title>Common Errors | Guide</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="common-errors"><h1 id="common-errors">Common Errors</h1><section class="level2"aria-labelledby="cannot-find-module-relative-path"><h2 id="cannot-find-module-relative-path">Cannot find module './relative-path'</h2><p>If you receive an error that module cannot be found, it might mean several different things:<ul><li><ol><li>You misspelled the path. Make sure the path is correct.</ol><li><ol start="2"><li>It's possible that you rely on <code>baseUrl</code> in your <code>tsconfig.json</code>. Vite doesn't take into account <code>tsconfig.json</code> by default, so you might need to install <a href="https://www.npmjs.com/package/vite-tsconfig-paths"><code>vite-tsconfig-paths</code></a> yourself, if you rely on this behaviour.</ol></ul><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest/config'</span>
<span class="token keyword module">import</span> <span class="token imports">tsconfigPaths</span> <span class="token keyword module">from</span> <span class="token string">'vite-tsconfig-paths'</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">tsconfigPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Or rewrite your path to not be relative to root:<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import helpers from 'src/helpers'
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import helpers from '../src/helpers'</span></span></code></pre><ul><li><ol start="3"><li>Make sure you don't have relative <a href="../config.html#alias">aliases</a>. Vite treats them as relative to the file where the import is instead of the root.</ol></ul><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest/config'</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'@/'</span><span class="token operator">:</span> <span class="token string">'./src/'</span><span class="token punctuation">,</span> <span class="token comment">// [!code --]</span>
      <span class="token string-property property">'@/'</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span><span class="token string">'./src/'</span><span class="token punctuation">,</span> <span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">pathname</span><span class="token punctuation">,</span> <span class="token comment">// [!code ++]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="cannot-mock-mocked-filejs-because-it-is-already-loaded"><h2 id="cannot-mock-mocked-filejs-because-it-is-already-loaded">Cannot mock "./mocked-file.js" because it is already loaded</h2><p>This error happens when <code>vi.mock</code> method is called on a module that was already loaded. Vitest throws this error because this call has no effect since cached modules are preferred.<p>Remember that <code>vi.mock</code> is always hoisted - it means that the module was loaded before the test file started executing - most likely in a setup file. To fix the error, remove the import or clear the cache at the end of a setup file - beware that setup file and your test file will reference different modules in that case.<pre class="language-ts"><code class="language-ts"><span class="token comment">// setupFile.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> sideEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./mocked-file.js'</span>

<span class="token function">sideEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

vi<span class="token punctuation">.</span><span class="token method function property-access">resetModules</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="failed-to-terminate-worker"><h2 id="failed-to-terminate-worker">Failed to terminate worker</h2><p>This error can happen when NodeJS's <code>fetch</code> is used with default <a href="../config.html#threads"><code>pool: 'threads'</code></a>. This issue is tracked on issue <a href="https://github.com/vitest-dev/vitest/issues/3077">Timeout abort can leave process(es) running in the background #3077</a>.<p>As work-around you can switch to <a href="../config.html#forks"><code>pool: 'forks'</code></a> or <a href="../config.html#vmforks"><code>pool: 'vmForks'</code></a>.</p>code-group ```ts [vitest.config.js] import { defineConfig } from 'vitest/config'<p>export default defineConfig({ test: { pool: 'forks', }, })<pre class="language-text"><code class="language-text">```bash [CLI]
vitest --pool=forks</code></pre></section><section class="level2"aria-labelledby="segfaults-and-native-code-errors"><h2 id="segfaults-and-native-code-errors">Segfaults and native code errors</h2><p>Running <a href="https://nodejs.org/api/addons.html">native NodeJS modules</a> in <code>pool: 'threads'</code> can run into cryptic errors coming from the native code.<ul><li><code>Segmentation fault (core dumped)</code><li><code>thread '&#x3C;unnamed>' panicked at 'assertion failed</code><li><code>Abort trap: 6</code><li><code>internal error: entered unreachable code</code></ul><p>In these cases the native module is likely not built to be multi-thread safe. As work-around, you can switch to <code>pool: 'forks'</code> which runs the test cases in multiple <code>node:child_process</code> instead of multiple <code>node:worker_threads</code>.</p>code-group ```ts [vitest.config.js] import { defineConfig } from 'vitest/config'<p>export default defineConfig({ test: { pool: 'forks', }, })<pre class="language-text"><code class="language-text">```bash [CLI]
vitest --pool=forks</code></pre><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>