<!doctype html><html lang="en"><meta charset="utf-8"><title>Commands | Browser Mode</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="outline"content="deep"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="commands"><h1 id="commands">Commands</h1><p>Command is a function that invokes another function on the server and passes down the result back to the browser. Vitest exposes several built-in commands you can use in your browser tests.<section class="level2"aria-labelledby="built-in-commands"><h2 id="built-in-commands">Built-in Commands</h2><section class="level3"aria-labelledby="files-handling"><h3 id="files-handling">Files Handling</h3><p>You can use <code>readFile</code>, <code>writeFile</code> and <code>removeFile</code> API to handle files inside your browser tests. All paths are resolved relative to the test file even if they are called in a helper function located in another file.<p>By default, Vitest uses <code>utf-8</code> encoding but you can override it with options.<blockquote>This API follows [`server.fs`](https://vitejs.dev/config/server-options.html#server-fs-allow) limitations for security reasons.</blockquote><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> server <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@vitest/browser/context'</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> readFile<span class="token punctuation">,</span> writeFile<span class="token punctuation">,</span> removeFile <span class="token punctuation">}</span> <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token property-access">commands</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'handles files'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> file <span class="token operator">=</span> <span class="token string">'./test.txt'</span>

  <span class="token keyword control-flow">await</span> <span class="token function">writeFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">'hello world'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span>

  <span class="token keyword control-flow">await</span> <span class="token function">removeFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section></section><section class="level2"aria-labelledby="cdp-session"><h2 id="cdp-session">CDP Session</h2><p>Vitest exposes access to raw Chrome Devtools Protocol via the <code>cdp</code> method exported from <code>@vitest/browser/context</code>. It is mostly useful to library authors to build tools on top of it.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> cdp <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@vitest/browser/context'</span>

<span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>
input<span class="token punctuation">.</span><span class="token method function property-access">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword control-flow">await</span> <span class="token function">cdp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">'Input.dispatchKeyEvent'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'keyDown'</span><span class="token punctuation">,</span>
  text<span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">expect</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveValue</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span></code></pre><blockquote>CDP session works only with `playwright` provider and only when using `chromium` browser. You can read more about it in playwright's [`CDPSession`](https://playwright.dev/docs/api/class-cdpsession) documentation.</blockquote></section><section class="level2"aria-labelledby="custom-commands"><h2 id="custom-commands">Custom Commands</h2><p>You can also add your own commands via <a href="../config.html#browser-commands"><code>browser.commands</code></a> config option. If you develop a library, you can provide them via a <code>config</code> hook inside a plugin:<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Plugin</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'vitest/config'</span>
<span class="token keyword module">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">BrowserCommand</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'vitest/node'</span>

<span class="token keyword">const</span> myCustomCommand<span class="token operator">:</span> <span class="token maybe-class-name">BrowserCommand</span><span class="token operator">&#x3C;</span><span class="token punctuation">[</span>arg1<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> arg2<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  testPath<span class="token punctuation">,</span>
  provider
<span class="token punctuation">}</span><span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>provider<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">===</span> <span class="token string">'playwright'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>testPath<span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> someValue<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">provider </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>provider<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is not supported</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">BrowserCommands</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Plugin</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'vitest:custom-commands'</span><span class="token punctuation">,</span>
    <span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token punctuation">{</span>
          browser<span class="token operator">:</span> <span class="token punctuation">{</span>
            commands<span class="token operator">:</span> <span class="token punctuation">{</span>
              myCustomCommand<span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Then you can call it inside your test by importing it from <code>@vitest/browser/context</code>:<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> commands <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@vitest/browser/context'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'custom command works correctly'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> commands<span class="token punctuation">.</span><span class="token method function property-access">myCustomCommand</span><span class="token punctuation">(</span><span class="token string">'test1'</span><span class="token punctuation">,</span> <span class="token string">'test2'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> someValue<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// if you are using TypeScript, you can augment the module</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'@vitest/browser/context'</span> <span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">BrowserCommands</span></span> <span class="token punctuation">{</span>
    <span class="token function-variable function">myCustomCommand</span><span class="token operator">:</span> <span class="token punctuation">(</span>arg1<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> arg2<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span>
      someValue<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token operator">></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><blockquote>Custom functions will override built-in ones if they have the same name.</blockquote><section class="level3"aria-labelledby="custom-playwright-commands"><h3 id="custom-playwright-commands">Custom <code>playwright</code> commands</h3><p>Vitest exposes several <code>playwright</code> specific properties on the command context.<ul><li><code>page</code> references the full page that contains the test iframe. This is the orchestrator HTML and you most likely shouldn't touch it to not break things.<li><code>frame</code> is an async method that will resolve tester <a href="https://playwright.dev/docs/api/class-frame"><code>Frame</code></a>. It has a simillar API to the <code>page</code>, but it doesn't support certain methods. If you need to query an element, you should prefer using <code>context.iframe</code> instead because it is more stable and faster.<li><code>iframe</code> is a <a href="https://playwright.dev/docs/api/class-framelocator"><code>FrameLocator</code></a> that should be used to query other elements on the page.<li><code>context</code> refers to the unique <a href="https://playwright.dev/docs/api/class-browsercontext">BrowserContext</a>.</ul><pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">BrowserCommand</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest/node'</span>

<span class="token keyword module">export</span> <span class="token keyword">const</span> myCommand<span class="token operator">:</span> <span class="token maybe-class-name">BrowserCommand</span><span class="token operator">&#x3C;</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>
  ctx<span class="token punctuation">,</span>
  arg1<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  arg2<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token property-access">provider</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">===</span> <span class="token string">'playwright'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token keyword control-flow">await</span> ctx<span class="token punctuation">.</span><span class="token property-access">iframe</span><span class="token punctuation">.</span><span class="token method function property-access">findByRole</span><span class="token punctuation">(</span><span class="token string">'alert'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> screenshot <span class="token operator">=</span> <span class="token keyword control-flow">await</span> element<span class="token punctuation">.</span><span class="token method function property-access">screenshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// do something with the screenshot</span>
    <span class="token keyword control-flow">return</span> difference
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><blockquote>If you are using TypeScript, don't forget to add `@vitest/browser/providers/playwright` to your `tsconfig` "compilerOptions.types" field to get autocompletion in the config and on `userEvent` and `page` options:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"types"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"@vitest/browser/providers/playwright"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></blockquote></section><section class="level3"aria-labelledby="custom-webdriverio-commands"><h3 id="custom-webdriverio-commands">Custom <code>webdriverio</code> commands</h3><p>Vitest exposes some <code>webdriverio</code> specific properties on the context object.<ul><li><code>browser</code> is the <code>WebdriverIO.Browser</code> API.</ul><p>Vitest automatically switches the <code>webdriver</code> context to the test iframe by calling <code>browser.switchToFrame</code> before the command is called, so <code>$</code> and <code>$$</code> methods refer to the elements inside the iframe, not in the orchestrator, but non-webdriver APIs will still refer to the parent frame context.<blockquote>If you are using TypeScript, don't forget to add `@vitest/browser/providers/webdriverio` to your `tsconfig` "compilerOptions.types" field to get autocompletion:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"types"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"@vitest/browser/providers/webdriverio"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></blockquote><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></section>