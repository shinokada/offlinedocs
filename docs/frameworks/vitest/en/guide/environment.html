<!doctype html><html lang="en"><meta charset="utf-8"><title>Test Environment</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="test-environment"class="level1"><h1>Test Environment</h1><p>Vitest provides <a href="../config.html#environment"><code>environment</code></a> option to run code inside a specific environment. You can modify how environment behaves with <a href="../config.html#environmentoptions"><code>environmentOptions</code></a> option.<p>By default, you can use these environments:<ul><li><code>node</code> is default environment<li><code>jsdom</code> emulates browser environment by providing Browser API, uses <a href="https://github.com/jsdom/jsdom"><code>jsdom</code></a> package<li><code>happy-dom</code> emulates browser environment by providing Browser API, and considered to be faster than jsdom, but lacks some API, uses <a href="https://github.com/capricorn86/happy-dom"><code>happy-dom</code></a> package<li><code>edge-runtime</code> emulates Vercel's <a href="https://edge-runtime.vercel.app/">edge-runtime</a>, uses <a href="https://www.npmjs.com/package/@edge-runtime/vm"><code>@edge-runtime/vm</code></a> package</ul><section id="environments-for-specific-files"class="level2"><h2>Environments for specific files</h2><p>When setting <code>environment</code> option in your config, it will apply to all the test files in your project. To have more fine-grained control, you can use control comments to specify environment for specific files. Control comments are comments that start with <code>@vitest-environment</code> and are followed by the environment name:<pre class="language-ts"><code class="language-ts"><span class="token comment">// @vitest-environment jsdom</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token dom variable">window</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">not</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token string">'undefined'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Or you can also set <a href="https://vitest.dev/config/#environmentmatchglobs"><code>environmentMatchGlobs</code></a> option specifying the environment based on the glob patterns.</section><section id="custom-environment"class="level2"><h2>Custom Environment</h2><p>Starting from 0.23.0, you can create your own package to extend Vitest environment. To do so, create package with the name <code>vitest-environment-${name}</code>. That package should export an object with the shape of <code>Environment</code>:<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Environment</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Environment</span><span class="token operator">></span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'custom'</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// custom setup</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token function">teardown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// called after all tests with this env have been run</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>You also have access to default Vitest environments through <code>vitest/environments</code> entry:<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> builtinEnvironments<span class="token punctuation">,</span> populateGlobal <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest/environments'</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>builtinEnvironments<span class="token punctuation">)</span> <span class="token comment">// { jsdom, happy-dom, node, edge-runtime }</span></code></pre><p>Vitest also provides <code>populateGlobal</code> utility function, which can be used to move properties from object into the global namespace:<pre class="language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">PopulateOptions</span></span> <span class="token punctuation">{</span>
  <span class="token comment">// should non-class functions be bind to the global namespace</span>
  bindFunctions<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">PopulateResult</span></span> <span class="token punctuation">{</span>
  <span class="token comment">// a list of all keys that were copied, even if value doesn't exist on original object</span>
  keys<span class="token operator">:</span> <span class="token known-class-name class-name">Set</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token operator">></span>
  <span class="token comment">// a map of original object that might have been overridden with keys</span>
  <span class="token comment">// you can return these values inside `teardown` function</span>
  originals<span class="token operator">:</span> <span class="token known-class-name class-name">Map</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">symbol</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">populateGlobal</span><span class="token punctuation">(</span>global<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> original<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> options<span class="token operator">:</span> <span class="token maybe-class-name">PopulateOptions</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">PopulateResult</span></code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>