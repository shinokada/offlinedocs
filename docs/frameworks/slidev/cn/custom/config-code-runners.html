<!doctype html><html lang="cn"><meta charset="utf-8"><title>配置代码运行器</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="配置代码运行器"><h1 id="配置代码运行器">配置代码运行器</h1><environment type="client"><p>在 Monaco 代码运行器中运行自定义语言。<p>Slidev 内置了对 JavaScript 与 TypeScript 运行器。 它们能直接在浏览器中运行，但 <strong>没有</strong> 沙盒环境的保护。 如果你想要更高级的集成, 你可以提供自己的代码运行器，将代码发送到远程服务器、在 Web Worker 中运行，或者以你希望的任何方式运行。<p>你需要创建含以下内容的 <code>./setup/code-runners.ts</code> 文件:<pre class="language-ts"><code class="language-ts"><span class="token keyword">declare</span> <span class="token keyword">const</span> <span class="token function-variable function">executePythonCodeRemotely</span><span class="token operator">:</span> <span class="token punctuation">(</span>code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token operator">></span>
<span class="token keyword">declare</span> <span class="token keyword">const</span> <span class="token function-variable function">sanitizeHtml</span><span class="token operator">:</span> <span class="token punctuation">(</span>html<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token builtin">string</span>
<span class="token comment">// ---cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineCodeRunnersSetup <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@slidev/types'</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineCodeRunnersSetup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">python</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 以某种方式执行代码并获取输出</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">executePythonCodeRemotely</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        text<span class="token operator">:</span> result
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">html</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        html<span class="token operator">:</span> <span class="token function">sanitizeHtml</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 也可以添加其他语言。键是语言id，值是运行器函数</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><section class="level2"aria-labelledby="运行上下文"><h2 id="运行上下文">运行上下文</h2><p>第二个传入参数 <code>ctx</code> 是运行的上下文, 包含了以下属性:<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">CodeRunnerOutputs</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'@slidev/types'</span>
<span class="token keyword module">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">CodeToHastOptions</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'shiki'</span>
<span class="token comment">// ---cut---</span>
<span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">CodeRunnerContext</span></span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * 通过 `runnerOptions` 属性传递给运行器的选项。
   */</span>
  options<span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">unknown</span><span class="token operator">></span>
  <span class="token doc-comment comment">/**
   * 使用 Shiki 高亮代码。
   */</span>
  <span class="token function-variable function">highlight</span><span class="token operator">:</span> <span class="token punctuation">(</span>code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> lang<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Partial</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">CodeToHastOptions</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token builtin">string</span>
  <span class="token doc-comment comment">/**
   * 使用其他代码运行器运行代码。
   */</span>
  <span class="token function-variable function">run</span><span class="token operator">:</span> <span class="token punctuation">(</span>code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> lang<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">CodeRunnerOutputs</span><span class="token operator">></span>
<span class="token punctuation">}</span></code></pre></section><section class="level2"aria-labelledby="运行器输出"><h2 id="运行器输出">运行器输出</h2><p>运行器可以返回文本或 HTML 输出，或者一个要挂载的 HTML 元素。更多详情请参考 <a href="https://github.com/slidevjs/slidev/blob/main/packages/types/src/code-runner.ts">code-runner.ts</a> 的类型定义。</section><section class="level2"aria-labelledby="附加运行依赖"><h2 id="附加运行依赖">附加运行依赖</h2><p>默认地，Slidev 将扫描 Markdown 源文件并自动为运行器导入必要的 JavaScript 依赖项。如果你希望手动指定依赖，你可以在 slide 的 frontmatter 中使用 <code>monacoRunAdditionalDeps</code> 选项:<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">monacoRunAdditionalDeps</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> ./path/to/dependency
  <span class="token punctuation">-</span> lodash<span class="token punctuation">-</span>es</code></pre><p>::: tip 这些路径是相对于 <code>snippets</code> 目录解析的。并且依赖项的名称应该与代码中导入的名称完全相同。 ::: <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></environment></section>