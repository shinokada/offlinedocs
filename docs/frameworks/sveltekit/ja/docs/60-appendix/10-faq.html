<!doctype html><html lang="ja"><meta charset="utf-8"><title>Frequently asked questions</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="frequently-asked-questions"><h1 id="frequently-asked-questions">Frequently asked questions</h1><section class="level2"aria-labelledby="other-resources"><h2 id="other-resources">Other resources</h2><p><a href="https://svelte.jp/faq">Svelte FAQ</a> と <a href="https://github.com/sveltejs/vite-plugin-svelte/blob/main/docs/faq.md"><code>vite-plugin-svelte</code> FAQ</a> も、これらのライブラリに起因する疑問点には役立ちますのでご参照ください。</section><section class="level2"aria-labelledby="what-can-i-make-with-sveltekit"><h2 id="what-can-i-make-with-sveltekit">What can I make with SvelteKit?</h2><p>SvelteKit can be used to create most kinds of applications. Out of the box, SvelteKit supports many features including:<ul><li>Dynamic page content with <a href="../20-core-concepts/20-load.html">load</a> functions and <a href="../20-core-concepts/10-routing.html#server">API routes</a>.<li>SEO-friendly dynamic content with <a href="../60-appendix/30-glossary.html#ssr">server-side rendering (SSR)</a>.<li>User-friendly progressively-enhanced interactive pages with SSR and <a href="../20-core-concepts/30-form-actions.html">Form Actions</a>.<li>Static pages with <a href="../20-core-concepts/40-page-options.html#prerender">prerendering</a>.</ul><p>SvelteKit can also be deployed to a wide spectrum of hosted architectures via <a href="../20-core-concepts/50-adapters.html">adapters</a>. In cases where SSR is used (or server-side logic is added without prerendering), those functions will be adapted to the target backend. Some examples include:<ul><li>Self-hosted dynamic web applications with a <a href="/docs/adapter-node">Node.js backend</a>.<li>Serverless web applications with backend loaders and APIs deployed as remote functions. See <a href="/docs/adapter-auto">zero-config deployments</a> for popular deployment options.<li><a href="/docs/adapter-static">Static pre-rendered sites</a> such as a blog or multi-page site hosted on a CDN or static host. Statically-generated sites are shipped without a backend.<li><a href="/docs/single-page-apps">Single-page Applications (SPAs)</a> with client-side routing and rendering for API-driven dynamic content. SPAs are shipped without a backend and are not server-rendered. This option is commonly chosen when bundling SvelteKit with an app written in PHP, .Net, Java, C, Golang, Rust, etc.<li>A mix of the above; some routes can be static, and some routes can use backend functions to fetch dynamic information. This can be configured with <a href="../20-core-concepts/40-page-options.html">page options</a> that includes the option to opt out of SSR.</ul><p>In order to support SSR, a JS backend — such as Node.js or Deno-based server, serverless function, or edge function — is required.<p>It is also possible to write custom adapters or leverage community adapters to deploy SvelteKit to more platforms such as specialized server environments, browser extensions, or native applications. See <a href="./integrations">integrations</a> for more examples and integrations.</section><section class="level2"aria-labelledby="sveltekit-で-hmr-を使うにはどうすればよいですか-"><h2 id="sveltekit-で-hmr-を使うにはどうすればよいですか-">SvelteKit で HMR を使うにはどうすればよいですか？</h2><p>SvelteKit は <a href="https://github.com/sveltejs/svelte-hmr">svelte-hmr</a> によってデフォルトで HMR が有効になっています。<a href="https://svelte.jp/blog/whats-the-deal-with-sveltekit">Rich の 2020 Svelte Summit のプレゼンテーション</a> を見たことがあるなら、より強力そうに見えるバージョンの HMR をご覧になったかもしれません。あのデモでは <code>svelte-hmr</code> の <code>preserveLocalState</code> フラグがオンになっていました。このフラグは想定外の動作やエッジケースにつながる可能性があるため、現在はデフォルトでオフになっています。でもご心配なく、SvelteKit で HMR を利用することはできます！もしローカルの状態を保持したい場合は、<a href="https://github.com/sveltejs/svelte-hmr">svelte-hmr</a> ページに説明があるように、<code>@hmr:keep</code> または <code>@hmr:keep-all</code> ディレクティブを使用することができます。</section><section class="level2"aria-labelledby="packagejson-の詳細をアプリケーションに含めるにはどうすればよいですか-"><h2 id="packagejson-の詳細をアプリケーションに含めるにはどうすればよいですか-">package.json の詳細をアプリケーションに含めるにはどうすればよいですか？</h2><p>SvelteKit では <a href="./configuration"><code>svelte.config.js</code></a> が ES module であることを想定しているため、JSON ファイルを直接要求することはできません。アプリケーションに、アプリケーションのバージョン番号やその他の情報を <code>package.json</code> から読み込みたい場合は、このように JSON を読み込むことができます:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: svelte.config.js</span>
<span class="token comment">// @filename: index.js</span>
<span class="token comment">/// &#x3C;reference types="@types/node" /></span>
<span class="token keyword module">import</span> <span class="token punctuation">{</span> <span class="token constant">URL</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'node:url'</span><span class="token punctuation">;</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> readFileSync <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'node:fs'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> fileURLToPath <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'node:url'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">fileURLToPath</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'package.json'</span><span class="token punctuation">,</span> <span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section class="level2"aria-labelledby="パッケージをインクルードしようとするとエラーが発生するのですがどうすれば直せますか-"><h2 id="パッケージをインクルードしようとするとエラーが発生するのですがどうすれば直せますか-">パッケージをインクルードしようとするとエラーが発生するのですが、どうすれば直せますか？</h2><p>ライブラリのインクルードに関する問題は、ほとんどが不適切なパッケージングによるものです。ライブラリのパッケージングが Node.js に対応しているかどうかは、<a href="https://publint.dev/">publint の web サイト</a> でチェックできます。<p>以下は、ライブラリが正しくパッケージングされているかどうかをチェックする際に気を付けるべき点です:<ul><li><code>exports</code> は <code>main</code> や <code>module</code> などの他のエントリーポイントのフィールドよりも優先されます。<code>exports</code> フィールドを追加すると、deep import を妨げることになるため、後方互換性が失われる場合があります。<li><code>"type": "module"</code> が指定されていない限り、ESM ファイルは <code>.mjs</code> で終わる必要があり、CommonJS ファイルは <code>.cjs</code> で終わる必要があります。<li><code>exports</code> が定義されていない場合、<code>main</code> を定義する必要があり、それは CommonJS ファイル か ESM ファイル でなければならず、前項に従わなければなりません。<code>module</code> フィールドが定義されている場合、ESM ファイルを参照している必要があります。<li>Svelte コンポーネントは、コンパイルされていない <code>.svelte</code> ファイルとして配布し、パッケージに含まれる JS は ESM のみとして記述していなければなりません。TypeScript などのカスタムスクリプトや SCSS などのスタイル言語は、それぞれ vanilla JS と CSS にするために前処理(preprocess)をしなければなりません。Svelte ライブラリのパッケージングには、<a href="./packaging"><code>svelte-package</code></a> を使用することを推奨しています。このパッケージによって、これらの作業が行われます。</ul><p>ライブラリが ESM バージョンを配布している場合、特に Svelte コンポーネントライブラリがその依存関係に含まれている場合、Vite を使用するとブラウザ上で最適に動作します。ライブラリの作者に ESM バージョンを提供するよう提案すると良いでしょう。しかし、CommonJS (CJS) の依存関係も上手く扱えるようにするため、デフォルトで、<a href="https://github.com/sveltejs/vite-plugin-svelte/blob/main/docs/faq.md#what-is-going-on-with-vite-and-pre-bundling-dependencies"><code>vite-plugin-svelte</code> が Vite にそれらを事前バンドルするよう指示します</a>。Vite は <code>esbuild</code> を使ってそれらを ESM に変換します。<p>それでもまだ問題が解消されない場合は、<a href="https://github.com/vitejs/vite/issues">Vite の issue tracker</a> と 該当のライブラリの issue tracker を検索することを推奨します。<a href="https://vitejs.dev/config/#dep-optimization-options"><code>optimizeDeps</code></a> や <a href="https://vitejs.dev/config/#ssr-options"><code>ssr</code></a> の設定値をいじることで問題を回避できる場合もありますが、これはあくまで一時的な回避策とし、問題のあるライブラリの修正を優先したほうが良いでしょう。</section><section class="level2"aria-labelledby="sveltekit-で-view-transitions-api-を使うにはどうすればよいですか-"><h2 id="sveltekit-で-view-transitions-api-を使うにはどうすればよいですか-">SvelteKit で view transitions API を使うにはどうすればよいですか？</h2><p>SvelteKit では <a href="https://developer.chrome.com/docs/web-platform/view-transitions/">view transitions</a> 向けの特別なインテグレーションはありませんが、<a href="../50-api-reference/30-modules.html#$app-navigation-onnavigate"><code>onNavigate</code></a> の中で <code>document.startViewTransition</code> を呼び出すことにより、クライアントサイドナビゲーション毎に view transition をトリガーすることができます。<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2339 2810</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> onNavigate <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'$app/navigation'</span><span class="token punctuation">;</span>

<span class="token function">onNavigate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">navigation</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">startViewTransition</span><span class="token punctuation">)</span> <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>

	<span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
		<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">startViewTransition</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
			<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword control-flow">await</span> navigation<span class="token punctuation">.</span><span class="token property-access">complete</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>もっと詳しく知りたければ、Svelte ブログの <a href="https://svelte.jp/blog/view-transitions">"Unlocking view transitions"</a> をご参照ください。</section><section class="level2"aria-labelledby="sveltekit-で-x-を使うにはどうすればよいですか-"><h2 id="sveltekit-で-x-を使うにはどうすればよいですか-">SvelteKit で X を使うにはどうすればよいですか？</h2><p><a href="./integrations">ドキュメントのインテグレーションのセクション</a> をしっかり読み込んでください。それでも問題が解決しない場合のために、よくある問題の解決策を以下に示します。</section><section class="level2"aria-labelledby="データベースのセットアップはどう行えばよいですか-"><h2 id="データベースのセットアップはどう行えばよいですか-">データベースのセットアップはどう行えばよいですか？</h2><p>データベースにクエリするコードを <a href="./routing#server">サーバールート(server route)</a> に置いてください。.svelte ファイルの中でデータベースにクエリしないでください。コネクションをすぐにセットアップし、シングルトンとしてアプリ全体からクライアントにアクセスできるように <code>db.js</code> のようなものを作ると良いでしょう。<code>hooks.server.js</code> で1回セットアップするコードを実行し、データベースヘルパーを必要とするすべてのエンドポイントにインポートできます。</section><section class="level2"aria-labelledby="document-や-window-に依存しているクライアントサイドオンリーなライブラリはどう使えばよいですか-"><h2 id="document-や-window-に依存しているクライアントサイドオンリーなライブラリはどう使えばよいですか-"><code>document</code> や <code>window</code> に依存しているクライアントサイドオンリーなライブラリはどう使えばよいですか？</h2><p>もし <code>document</code> や <code>window</code> 変数にアクセスする必要があったり、クライアントサイドだけで実行するコードが必要な場合は、<code>browser</code> チェックでラップしてください:<pre class="language-js"><code class="language-js"><span class="token comment">/// &#x3C;reference types="@sveltejs/kit" /></span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> browser <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'$app/environment'</span><span class="token punctuation">;</span>

<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>browser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// client-only code here</span>
<span class="token punctuation">}</span></code></pre><p>コンポーネントが最初に DOM にレンダリングされた後にコードを実行したい場合は、<code>onMount</code> で実行することもできます:<pre class="language-js"><code class="language-js"><span class="token comment">// @filename: ambient.d.ts</span>
<span class="token comment">// @lib: ES2015</span>
declare module <span class="token string">'some-browser-only-library'</span><span class="token punctuation">;</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> onMount <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'svelte'</span><span class="token punctuation">;</span>

<span class="token function">onMount</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> method <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'some-browser-only-library'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>使用したいライブラリに副作用がなければ静的にインポートすることができますし、サーバー側のビルドでツリーシェイクされ、<code>onMount</code> が自動的に no-op に置き換えられます:<pre class="language-js"><code class="language-js"><span class="token comment">// @filename: ambient.d.ts</span>
<span class="token comment">// @lib: ES2015</span>
declare module <span class="token string">'some-browser-only-library'</span><span class="token punctuation">;</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> onMount <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'svelte'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> method <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'some-browser-only-library'</span><span class="token punctuation">;</span>

<span class="token function">onMount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
	<span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>最後に、<code>{#await}</code> ブロックのご使用も検討してみてください:<pre class="language-svelte"><code class="language-svelte">&#x3C;! file: index.svelte --->
&#x3C;script>
	import { browser } from '$app/environment';

	const ComponentConstructor = browser ?
		import('some-browser-only-library').then((module) => module.Component) :
		new Promise(() => {});
&#x3C;/script>

{#await ComponentConstructor}
	&#x3C;p>Loading...&#x3C;/p>
{:then component}
	&#x3C;svelte:component this={component} />
{:catch error}
	&#x3C;p>Something went wrong: {error.message}&#x3C;/p>
{/await}</code></pre></section><section class="level2"aria-labelledby="別のバックエンド-api-サーバーを使用するにはどうすれば良いですか-"><h2 id="別のバックエンド-api-サーバーを使用するにはどうすれば良いですか-">別のバックエンド API サーバーを使用するにはどうすれば良いですか？</h2><p>外部の API サーバーにデータをリクエストするのに <a href="./load#making-fetch-requests"><code>event.fetch</code></a> を使用することができますが、<a href="https://developer.mozilla.org/ja/docs/Web/HTTP/CORS">CORS</a> に対応しなければならず、一般的にはリクエストのプリフライトが必要になり、結果として高レイテンシーになるなど、複雑になることにご注意ください。別のサブドメインへのリクエストも、追加の DNS ルックアップや TLS セットアップなどのためにレイテンシーが増加する可能性があります。この方法を使いたい場合は、<a href="./hooks#server-hooks-handlefetch"><code>handleFetch</code></a> が参考になるかもしれません。<p>別の方法は、頭痛の種である CORS をバイパスするためのプロキシーをセットアップすることです。本番環境では、<code>/api</code> などのパスを API サーバーに書き換えます(rewrite)。ローカルの開発環境では、Vite の <a href="https://vitejs.dev/config/server-options.html#server-proxy"><code>server.proxy</code></a> オプションを使用します。<p>本番環境で書き換え(rewrite)をセットアップする方法は、デプロイ先のプラットフォームに依存します。もし、書き換える方法がなければ、代わりに <a href="./routing#server">API route</a> を追加します:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/api/[...path]/+server.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>RequestHandler<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params<span class="token punctuation">,</span> url <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://my-api-server.com/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span><span class="token property-access">path</span> <span class="token operator">+</span> url<span class="token punctuation">.</span><span class="token property-access">search</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>(必要に応じて、<code>POST</code>/<code>PATCH</code> などのリクエストもプロキシし、<code>request.headers</code> も転送(forward)する必要があることにご注意ください)</section><section class="level2"aria-labelledby="ミドルウェアmiddlewareを使うにはどうすればよいですか-"><h2 id="ミドルウェアmiddlewareを使うにはどうすればよいですか-">ミドルウェア(middleware)を使うにはどうすればよいですか？</h2><p><code>adapter-node</code> は、プロダクションモードで使用するためのミドルウェアを自分のサーバで構築します。開発モードでは、Vite プラグインを使用して Vite にミドルウェア(middleware) を追加することができます。例えば:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2322</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare module <span class="token string">'@sveltejs/kit/vite'</span><span class="token punctuation">;</span> <span class="token comment">// TODO this feels unnecessary, why can't it 'see' the declarations?</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> sveltekit <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/kit/vite'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'vite'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Plugin<span class="token punctuation">}</span></span> */</span>
<span class="token keyword">const</span> myPlugin <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'log-request-middleware'</span><span class="token punctuation">,</span>
	<span class="token function">configureServer</span><span class="token punctuation">(</span><span class="token parameter">server</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		server<span class="token punctuation">.</span><span class="token property-access">middlewares</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
			<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Got request </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span><span class="token property-access">url</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'vite'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>UserConfig<span class="token punctuation">}</span></span> */</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>myPlugin<span class="token punctuation">,</span> <span class="token function">sveltekit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> config<span class="token punctuation">;</span></code></pre><p>順序を制御する方法など、詳しくは <a href="https://vitejs.dev/guide/api-plugin.html#configureserver">Vite の <code>configureServer</code> のドキュメント</a> をご覧ください。</section><section class="level2"aria-labelledby="yarn-2-で動作しますか-"><h2 id="yarn-2-で動作しますか-">Yarn 2 で動作しますか？</h2><p>多少は。Plug'n'Play 機能、通称 'pnp' は動きません (Node のモジュール解決アルゴリズムから逸脱しており、SvelteKitが<a href="https://blog.sindresorhus.com/get-ready-for-esm-aa53530b3f77">数多くのライブラリ</a>とともに使用している<a href="https://github.com/yarnpkg/berry/issues/638">ネイティブの JavaScript モジュールではまだ動作しません</a>)。<a href="https://yarnpkg.com/configuration/yarnrc#nodeLinker"><code>.yarnrc.yml</code></a> で <code>nodeLinker: 'node-modules'</code> を使用して pnp を無効にできますが、おそらく npm や <a href="https://pnpm.io/">pnpm</a> を使用するほうが簡単でしょう。同じように高速で効率的ですが、互換性に頭を悩ませることはありません。</section><section class="level2"aria-labelledby="yarn-3-を使用するにはどうすれば良いですか-"><h2 id="yarn-3-を使用するにはどうすれば良いですか-">Yarn 3 を使用するにはどうすれば良いですか？</h2><p>現時点の、最新の Yarn (version 3) の ESM サポート は <a href="https://github.com/yarnpkg/berry/pull/2161">experimental</a> であるようです。<p>結果は異なるかもしれませんが、下記が有効なようです。<p>最初に新しいアプリケーションを作成します:<pre class="language-sh"><code class="language-sh">yarn create svelte myapp
cd myapp</code></pre><p>And enable Yarn Berry:<pre class="language-sh"><code class="language-sh">yarn set version berry
yarn install</code></pre><section class="level3"aria-labelledby="yarn-3-global-cache"><h3 id="yarn-3-global-cache">Yarn 3 global cache</h3><p>Yarn Berry の興味深い機能の1つに、ディスク上のプロジェクトごとに複数のコピーを持つのではなく、パッケージ用に単一のグローバルキャッシュを持つことができる、というのがあります。しかし、<code>enableGlobalCache</code> の設定を true にするとビルドが失敗するため、<code>.yarnrc.yml</code> ファイルに以下を追加することを推奨します:<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">nodeLinker</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>modules</code></pre><p>これによってパッケージはローカルの node_modules ディレクトリにダウンロードされますが、上記の問題は回避され、現時点では Yarn の version 3 を使用するベストな方法となります。 <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></section>