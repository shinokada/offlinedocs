<!doctype html><html lang="ja"><meta charset="utf-8"><title>ルーティング</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="ルーティング"class="level1"><h1>ルーティング</h1><p>SvelteKit の中心は、 <em>ファイルシステムベースのルーター</em> です。アプリのルート(routes) — 例えばユーザーがアクセスできる URL パス — は、コードベースのディレクトリによって定義されます:<ul><li><code>src/routes</code> は最上位のルート(the root route)です<li><code>src/routes/about</code> は <code>/about</code> ルート(route)を作成します<li><code>src/routes/blog/[slug]</code> は <em>パラメータ</em> <code>slug</code> を使ったルート(route)を作成します。パラメータは、ユーザーからのリクエストが <code>/blog/hello-world</code> のようなページに行われた場合に、動的にデータを読み込むために使用することができます</ul><blockquote><p><a href="configuration">プロジェクトの設定</a> を編集することで、<code>src/routes</code> から別のディレクトリに変更することができます。</blockquote><p>ルート(route)のディレクトリはそれぞれ1つ以上の <em>ルートファイル(route files)</em> を格納します。ルートファイル(route files)には <code>+</code> という接頭辞が付いているので、それで見分けることができます。<section id="page"class="level2"><h2>+page</h2></section><section id="pagesvelte"class="level2"><h2>+page.svelte</h2><p><code>+page.svelte</code> コンポーネントはアプリのページを定義します。デフォルトでは、ページは最初のリクエストではサーバー (<a href="glossary#ssr">SSR</a>) でレンダリングされ、その後のナビゲーションではブラウザ (<a href="glossary#csr">CSR</a>) でレンダリングされます。<pre class="language-svelte"><code class="language-svelte">/// file: src/routes/+page.svelte
&#x3C;h1>Hello and welcome to my site!&#x3C;/h1>
&#x3C;a href="/about">About my site&#x3C;/a></code></pre><pre class="language-svelte"><code class="language-svelte">/// file: src/routes/about/+page.svelte
&#x3C;h1>About this site&#x3C;/h1>
&#x3C;p>TODO...&#x3C;/p>
&#x3C;a href="/">Home&#x3C;/a></code></pre><pre class="language-svelte"><code class="language-svelte">/// file: src/routes/blog/[slug]/+page.svelte
&#x3C;script>
	/** @type {import('./$types').PageData} */
	export let data;
&#x3C;/script>

&#x3C;h1>{data.title}&#x3C;/h1>
&#x3C;div>{@html data.content}&#x3C;/div></code></pre><blockquote><p>SvelteKit では、ルート(routes)間のナビゲーションに、フレームワーク固有の <code>&#x3C;Link></code> コンポーネントではなく、<code>&#x3C;a></code> 要素を使用します。</blockquote></section><section id="pagejs"class="level2"><h2>+page.js</h2><p>ページではたびたび、レンダリングの前になんらかのデータを読み込む必要があります。これに対応するため、<code>load</code> 関数をエクスポートする <code>+page.js</code> (または、TypeScript をお使いの場合は <code>+page.ts</code>) モジュールを追加しています:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/blog/[slug]/+page.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> error <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/kit'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token property-access">slug</span> <span class="token operator">===</span> <span class="token string">'hello-world'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
			# <span class="token string">'Hello world!'</span><span class="token punctuation">,</span>
			<span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'Welcome to our blog. Lorem ipsum dolor sit amet...'</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword control-flow">throw</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">'Not found'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>この関数は <code>+page.svelte</code> とともに実行されます。サーバーサイドレンダリング中はサーバーで実行され、クライアントサイドナビゲーション中はブラウザで実行されます。API の詳細は <a href="load"><code>load</code></a> をご参照ください。<p><code>+page.js</code> では、<code>load</code> だけでなくページの動作(behaviour)を設定するための値をエクスポートすることができます:<ul><li><code>export const prerender = true</code> または <code>false</code> または <code>'auto'</code><li><code>export const ssr = true</code> または <code>false</code><li><code>export const csr = true</code> または <code>false</code></ul><p>これらに関するより詳しい情報は <a href="page-options">page options</a> をご覧ください。</section><section id="pageserverjs"class="level2"><h2>+page.server.js</h2><p><code>load</code> 関数をサーバー上でのみ実行できるようにしたい場合 — 例えば、データベースからデータを取得したり、API キーのようなプライベートな<a href="modules#$env-static-private">環境変数</a>にアクセスしたりする必要がある場合 — <code>+page.js</code> を <code>+page.server.js</code> にリネームし、<code>PageLoad</code> 型を <code>PageServerLoad</code> に変更します。<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/blog/[slug]/+page.server.js</span>

<span class="token comment">// @filename: ambient.d.ts</span>
declare global <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token function-variable function">getPostFromDatabase</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">slug</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
		# string<span class="token punctuation">;</span>
		<span class="token literal-property property">content</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token exports"><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">;</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> error <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/kit'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> post <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getPostFromDatabase</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token property-access">slug</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>post<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword control-flow">return</span> post<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword control-flow">throw</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">'Not found'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>クライアントサイドナビゲーション中は、SvelteKit はサーバーからこのデータを読み込みます。つまり、その戻り値は <a href="https://github.com/rich-harris/devalue">devalue</a> によってシリアライズできなければならないということです。この API の詳細については <a href="load"><code>load</code></a> をご参照ください。<p><code>+page.js</code> のように、<code>+page.server.js</code> は <a href="page-options">page options</a> (<code>prerender</code>、<code>ssr</code>、<code>csr</code>) をエクスポートできます。<p>また、<code>+page.server.js</code> ファイルは <em>actions</em> をエクスポートできます。<code>load</code> がサーバーからデータを読み取る場合、<code>actions</code> は <code>&#x3C;form></code> 要素を使用してサーバーにデータを書き込むことができます。これらの使い方を学ぶには、<a href="form-actions">form actions</a> セクションをご参照ください。</section><section id="error"class="level2"><h2>+error</h2><p><code>load</code> 中にエラーが発生した場合、SvelteKit はデフォルトのエラーページをレンダリングします。<code>+error.svelte</code> を追加することで、ルート(route) ごとにエラーページをカスタマイズすることができます:<pre class="language-svelte"><code class="language-svelte">/// file: src/routes/blog/[slug]/+error.svelte
&#x3C;script>
	import { page } from '$app/stores';
&#x3C;/script>

&#x3C;h1>{$page.status}: {$page.error.message}&#x3C;/h1></code></pre><p>SvelteKit は、ツリーを上がって (walk up the tree) 最も近いエラー境界 (error boundary) を探します — もし上記のファイルが存在しない場合は、デフォルトのエラーページをレンダリングする前に <code>src/routes/blog/+error.svelte</code> を探しに行き、その次に <code>src/routes/+error.svelte</code> を探します。もしそれも失敗した場合は (または、最上位の <code>+error</code> の '上に' 位置する最上位の <code>+layout</code> の <code>load</code> 関数からエラーがスローされた場合)、SvelteKit は静的なフォールバックエラーページをレンダリングします。これは <code>src/error.html</code> ファイルを作成することでカスタマイズ可能です。<p><code>+layout(.server).js</code> の <code>load</code> 関数の内側でエラーが発生した場合、ツリーの中で最も近くにあるエラー境界はそのレイアウトの上位にある <code>+error.svelte</code> ファイルです (隣ではありません)。<p>ルート(route)が見つからない場合 (404)、<code>src/routes/+error.svelte</code> (または、もしこのファイルが存在しない場合はデフォルトのエラーページ) が使われます。<blockquote><p>エラーが <a href="hooks#server-hooks-handle"><code>handle</code></a> の内側や <a href="#server">+server.js</a> リクエストハンドラ の内側で発生した場合は、<code>+error.svelte</code> は使用されません。</blockquote><p>エラーハンドリングに関する詳細は <a href="errors">こちら</a> からお読み頂けます。</section><section id="layout"class="level2"><h2>+layout</h2><p>これまで、ページを完全に独立したコンポーネントとして扱ってきました — ナビゲーションを行うと、既存の <code>+page.svelte</code> コンポーネントが破棄され、新しいページコンポーネントで置き換えられます。<p>しかし多くのアプリでは、トップレベルのナビゲーションやフッターのように <em>全ての</em> ページで表示されるべき要素があります。全ての <code>+page.svelte</code> にそれらを繰り返し配置する代わりに、<em>レイアウト(layouts)</em> に配置することができます。</section><section id="layoutsvelte"class="level2"><h2>+layout.svelte</h2><p>全てのページに適用するレイアウトを作成するには、<code>src/routes/+layout.svelte</code> というファイルを作成します。デフォルトのレイアウト (あなたが作成していない場合に SvelteKit が使用するもの) は以下のようなものです…<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>slot</span><span class="token punctuation">></span></span></code></pre><p>…しかし、お望みのマークアップ(markup)、スタイル(styles)、動作(behaviour)を追加することができます。唯一の要求事項は、コンポーネントにページコンテンツのための <code>&#x3C;slot></code> を含めることです。例えば、nav bar を追加してみましょう:<pre class="language-html"><code class="language-html">/// file: src/routes/+layout.svelte
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>nav</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>About<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/settings<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Settings<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>nav</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>slot</span><span class="token punctuation">></span></span></code></pre><p><code>/</code>、<code>/about</code>、<code>/settings</code> のためのページを作成する場合…<pre class="language-html"><code class="language-html">/// file: src/routes/+page.svelte
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span></code></pre><pre class="language-html"><code class="language-html">/// file: src/routes/about/+page.svelte
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span>About<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span></code></pre><pre class="language-html"><code class="language-html">/// file: src/routes/settings/+page.svelte
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span>Settings<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span></code></pre><p>… nav は常に表示され、3つのページのための a 要素をそれぞれクリックしても <code>&#x3C;h1></code> が置き換わるだけです。<p>レイアウトは <em>ネスト</em> させることができます。例えば、単一の <code>/settings</code> ページだけでなく、<code>/settings/profile</code> や <code>/settings/notifications</code> のような共有のサブメニューを持つネストしたページがあるとします (実例としては、<a href="https://github.com/settings">github.com/settings</a> をご参照ください)。<p><code>/settings</code> 配下のページにのみ適用されるレイアウトを作成することができます (トップレベルの nav を持つ最上位のレイアウト(root layout)を継承しています):<pre class="language-svelte"><code class="language-svelte">/// file: src/routes/settings/+layout.svelte
&#x3C;script>
	/** @type {import('./$types').LayoutData} */
	export let data;
&#x3C;/script>

&#x3C;h1>Settings&#x3C;/h1>

&#x3C;div class="submenu">
	{#each data.sections as section}
		&#x3C;a href="/settings/{section.slug}">{section.title}&#x3C;/a>
	{/each}
&#x3C;/div>

&#x3C;slot>&#x3C;/slot></code></pre><p>デフォルトでは、各レイアウトはその上にあるレイアウトを継承します。そうしたくない場合は、<a href="advanced-routing#advanced-layouts">advanced layouts</a> が役に立つでしょう。</section><section id="layoutjs"class="level2"><h2>+layout.js</h2><p><code>+page.svelte</code> が <code>+page.js</code> からデータを読み込むように、<code>+layout.svelte</code> コンポーネントは <code>+layout.js</code> の <a href="load"><code>load</code></a> 関数からデータを取得することができます。<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/settings/+layout.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">sections</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">{</span> <span class="token literal-property property">slug</span><span class="token operator">:</span> <span class="token string">'profile'</span><span class="token punctuation">,</span> # <span class="token string">'Profile'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">{</span> <span class="token literal-property property">slug</span><span class="token operator">:</span> <span class="token string">'notifications'</span><span class="token punctuation">,</span> # <span class="token string">'Notifications'</span> <span class="token punctuation">}</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><code>+layout.js</code> が <a href="page-options">page options</a> (<code>prerender</code>、<code>ssr</code>、<code>csr</code>) をエクスポートする場合、それは子ページのデフォルトとしても使用されます。<p>レイアウトの <code>load</code> 関数から返されるデータは全ての子ページで利用することができます:<pre class="language-svelte"><code class="language-svelte">/// file: src/routes/settings/profile/+page.svelte
&#x3C;script>
	/** @type {import('./$types').PageData} */
	export let data;

	console.log(data.sections); // [{ slug: 'profile', # 'Profile' }, ...]
&#x3C;/script></code></pre><blockquote><p>しばしば、ページ間をナビゲーションしているときにレイアウトデータが変更されないことがあります。SvelteKit は必要に応じてインテリジェントに <a href="load"><code>load</code></a> 関数を再実行します。</blockquote></section><section id="layoutserverjs"class="level2"><h2>+layout.server.js</h2><p>サーバー上でレイアウトの <code>load</code> 関数を実行するためには、それを <code>+layout.server.js</code> に移動し、<code>LayoutLoad</code> 型を <code>LayoutServerLoad</code> に変更します。<p><code>+layout.js</code> と同様に、<code>+layout.server.js</code> では <a href="page-options">page options</a> — <code>prerender</code>、<code>ssr</code>、<code>csr</code> をエクスポートすることができます。</section><section id="server"class="level2"><h2>+server</h2><p>ページと同様に、<code>+server.js</code> ファイル (よく 'API ルート(API route)' または 'エンドポイント(endpoint)' とも呼ばれる) でルート(routes) を定義でき、これによってレスポンスを完全にコントロールすることができます。<code>+server.js</code> ファイル (または <code>+server.ts</code>) は <code>GET</code>、<code>POST</code>、<code>PATCH</code>、<code>PUT</code>、<code>DELETE</code>、<code>OPTIONS</code> といった HTTP verbs に対応する関数をエクスポートします。これは <code>RequestEvent</code> を引数に取り、<a href="https://developer.mozilla.org/ja/docs/Web/API/Response"><code>Response</code></a> オブジェクトを返します。<p>例えば、<code>GET</code> ハンドラーを使用した <code>/api/random-number</code> ルート(route)を作成できます:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/api/random-number/+server.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> error <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/kit'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>RequestHandler<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> url <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> min <span class="token operator">=</span> <span class="token known-class-name class-name">Number</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token property-access">searchParams</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'min'</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> max <span class="token operator">=</span> <span class="token known-class-name class-name">Number</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token property-access">searchParams</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'max'</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> d <span class="token operator">=</span> max <span class="token operator">-</span> min<span class="token punctuation">;</span>

	<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">||</span> d <span class="token operator">&#x3C;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword control-flow">throw</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">'min and max must be numbers, and min must be less than max'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">const</span> random <span class="token operator">=</span> min <span class="token operator">+</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> d<span class="token punctuation">;</span>

	<span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token known-class-name class-name">String</span><span class="token punctuation">(</span>random<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><code>Response</code> の第一引数には <a href="https://developer.mozilla.org/ja/docs/Web/API/ReadableStream"><code>ReadableStream</code></a> を指定することができ、大量のデータをストリームしたり、server-sent events を作成したりすることができます (AWS Lambda のような、レスポンスをバッファするプラットフォームにデプロイする場合は除きます)。<p>便宜上、<code>@sveltejs/kit</code> の <a href="modules#sveltejs-kit-error"><code>error</code></a>、<a href="modules#sveltejs-kit-redirect"><code>redirect</code></a>、<a href="modules#sveltejs-kit-json"><code>json</code></a> メソッドを使用することは可能です (ただし、使用する必要はありません)。<p>エラーがスローされる場合 (<code>throw error(...)</code> によるスローや、予期せぬエラーがスローされるどちらでも)、レスポンスは <code>Accept</code> ヘッダーに応じて、そのエラーの JSON 表現か、<code>src/error.html</code> でカスタマイズすることができるフォールバックエラーページとなります。この場合、<a href="#error"><code>+error.svelte</code></a> コンポーネントはレンダリングされません。エラーハンドリングに関する詳細は <a href="errors">こちら</a> からお読み頂けます。<blockquote><p><code>OPTIONS</code> ハンドラを作成する場合、Vite が <code>Access-Control-Allow-Origin</code> ヘッダーと <code>Access-Control-Allow-Methods</code> ヘッダーを注入することにご注意ください。本番環境では、あなたが明示的に追加しない限り注入されないはずです。</blockquote></section><section id="receiving-data"class="level2"><h2>Receiving data</h2><p><code>+server.js</code> ファイルは、<code>POST</code>/<code>PUT</code>/<code>PATCH</code>/<code>DELETE</code>/<code>OPTIONS</code> ハンドラをエクスポートすることで、完全な API を作成することができます:<pre class="language-svelte"><code class="language-svelte">/// file: src/routes/add/+page.svelte
&#x3C;script>
	let a = 0;
	let b = 0;
	let total = 0;

	async function add() {
		const response = await fetch('/api/add', {
			method: 'POST',
			body: JSON.stringify({ a, b }),
			headers: {
				'content-type': 'application/json'
			}
		});

		total = await response.json();
	}
&#x3C;/script>

&#x3C;input type="number" bind:value={a}> +
&#x3C;input type="number" bind:value={b}> =
{total}

&#x3C;button on:click={add}>Calculate&#x3C;/button></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/api/add/+server.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> json <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/kit'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>RequestHandler<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">POST</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> a<span class="token punctuation">,</span> b <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> request<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword control-flow">return</span> <span class="token function">json</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>一般的には、ブラウザからサーバーにデータを送信する方法としては <a href="form-actions">form actions</a> のほうがより良い方法です。</blockquote></section><section id="content-negotiation"class="level2"><h2>Content negotiation</h2><p><code>+server.js</code> ファイルは <code>+page</code> ファイルと同じディレクトリに置くことができ、これによって同じルート(route)がページにも API エンドポイントにもなるようにすることができます。これがどちらなのか判断するために、SvelteKit は以下のルールを適用します:<ul><li><code>PUT</code>/<code>PATCH</code>/<code>DELETE</code>/<code>OPTIONS</code> リクエストは、ページには適用されないため、常に <code>+server.js</code> で処理されます。<li><code>GET</code>/<code>POST</code> リクエストは、<code>accept</code> ヘッダーが <code>text/html</code> を優先している場合 (言い換えると、ブラウザのページリクエストの場合)、ページリクエストとして扱われます。それ以外の場合は <code>+server.js</code> で処理されます。</ul></section><section id="types"class="level2"><h2>$types</h2><p>これまでの例を通してずっと、<code>$types.d.ts</code> ファイルからインポートしてきました。これは、TypeScript (または JavaScript を JSDoc の型アノテーションと) 使用している場合に最上位のファイル(root files)を扱う際に型の安全性をもたらすために SvelteKit が隠しディレクトリに作成するファイルです。<p>例えば、<code>export let data</code> に <code>PageData</code> (または <code>LayoutData</code> の場合は <code>+layout.svelte</code> ファイル) にアノテーションを付けると、<code>data</code> の型は <code>load</code> の戻り値であると TypeScript に伝えることができます:<pre class="language-svelte"><code class="language-svelte">/// file: src/routes/blog/[slug]/+page.svelte
&#x3C;script>
	/** @type {import('./$types').PageData} */
	export let data;
&#x3C;/script></code></pre><p><code>load</code> 関数に <code>PageLoad</code>、<code>PageServerLoad</code>、<code>LayoutLoad</code>、<code>LayoutServerLoad</code> (それぞれ <code>+page.js</code>、<code>+page.server.js</code>、<code>+layout.js</code>、<code>+layout.server.js</code>) というアノテーションを付けると、<code>params</code> と戻り値が正しく型付けされることが保証されるでしょう。<p>VS Code や、language server protocol と TypeScript plugin をサポートする IDE を使用している場合は、これらの型を <em>完全に</em> 省略することができます！ Svelte の IDE ツール類があなたのために正しい型を挿入してくれるので、あなたはご自身で型を書くことなく型チェックすることができます。これはコマンドラインツール <code>svelte-check</code> でも機能します。<p><code>$types</code> の省略については、私たちの<a href="https://svelte.jp/blog/zero-config-type-safety">ブログ記事</a>でより詳細な情報をお読み頂けます。</section><section id="その他のファイル"class="level2"><h2>その他のファイル</h2><p>ルート(route)ディレクトリ内のその他のファイルは SvelteKit から無視されます。つまり、コンポーネントやユーティリティモジュールを、それらを必要とするルート(routes)に配置することができます。<p>コンポーネントやモジュールが複数のルート(routes)から必要な場合、<a href="modules#$lib"><code>$lib</code></a> にそれらを配置すると良いでしょう。</section><section id="その他の参考資料"class="level2"><h2>その他の参考資料</h2><ul><li><a href="https://learn.svelte.jp/tutorial/pages">Tutorial: Routing</a><li><a href="https://learn.svelte.jp/tutorial/get-handlers">Tutorial: API routes</a><li><a href="advanced-routing">Docs: Advanced routing</a> <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></ul></section></section>