<!doctypehtml><html lang="ja"><meta charset="utf-8"><title>Adapters</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="adapters"class="level1"><h1>Adapters</h1><p>SvelteKit アプリをデプロイする前に、それをデプロイ先の環境に <em>合わせる(adapt)</em> 必要があります。adapter は、ビルドされたアプリをインプットとして受け取り、デプロイ用のアウトプットを生成する小さなプラグインです。<p>デフォルトでは、プロジェクトは <code>@sveltejs/adapter-auto</code> を使用するように設定されており、プロダクション環境を検出して可能な限り適切な adapter を選択します。もし(まだ)プラットフォームがサポートされていなければ、<a href="../20-core-concepts/50-adapters.html#community-adapters">custom adapter をインストール</a>するか、<a href="../20-core-concepts/50-adapters.html#writing-custom-adapters">custom adapter を作成</a>する必要があるかもしれません。<blockquote><p>新しい環境のサポートを追加することに関しては、<a href="https://github.com/sveltejs/kit/tree/master/packages/adapter-auto">adapter-auto の README</a> をご参照ください。</blockquote><section id="サポートされている環境"class="level2"><h2>サポートされている環境</h2><p>SvelteKit は、公式にサポートされている adapter を多数提供しています。<p>以下のプラットフォームには、デフォルトの adapter である <code>adapter-auto</code> でデプロイが可能です。<ul><li><a href="https://developers.cloudflare.com/pages/">Cloudflare Pages</a> — <a href="https://github.com/sveltejs/kit/tree/master/packages/adapter-cloudflare"><code>adapter-cloudflare</code></a><li><a href="https://netlify.com">Netlify</a> — <a href="https://github.com/sveltejs/kit/tree/master/packages/adapter-netlify"><code>adapter-netlify</code></a><li><a href="https://vercel.com">Vercel</a> — <a href="https://github.com/sveltejs/kit/tree/master/packages/adapter-vercel"><code>adapter-vercel</code></a></ul><section id="nodejs"class="level3"><h3>Node.js</h3><p>シンプルな Node サーバーを作成するには、<a href="https://github.com/sveltejs/kit/tree/master/packages/adapter-node"><code>@sveltejs/adapter-node</code></a> パッケージをインストールし、<code>svelte.config.js</code> を更新します:<pre class="language-diff"><code class="language-diff">/// file: svelte.config.js
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">import adapter from '@sveltejs/adapter-auto';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import adapter from '@sveltejs/adapter-node';</span></span></code></pre><p>これにより、<code>vite build</code> は自己完結型の Node アプリを <code>build</code> ディレクトリの中に生成します。adapter にはオプションを渡すことができ、例えば出力ディレクトリをカスタマイズできます:<pre class="language-diff"><code class="language-diff">/// file: svelte.config.js
import adapter from '@sveltejs/adapter-node';

export default {
	kit: {
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">		adapter: adapter()
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">		adapter: adapter({ out: 'my-output-directory' })
</span></span>	}
};</code></pre></section><section id="静的サイトstatic-sites"class="level3"><h3>静的サイト(Static sites)</h3><p>ほとんどの adapter は、サイト内の <a href="../20-core-concepts/40-page-options.html#prerender">プリレンダリング可能な</a> ページについて、静的な HTML を生成します。アプリ全体がプリレンダリング可能な場合は、<a href="https://github.com/sveltejs/kit/tree/master/packages/adapter-static"><code>@sveltejs/adapter-static</code></a> を使用して <em>全ての</em> ページ について静的な HTML を生成することができます。完全に静的なサイトは、<a href="https://pages.github.com/">GitHub Pages</a> のような静的ホストなど、さまざまなプラットフォームでホストすることができます。<pre class="language-diff"><code class="language-diff">/// file: svelte.config.js
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">import adapter from '@sveltejs/adapter-auto';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import adapter from '@sveltejs/adapter-static';</span></span></code></pre><p><code>adapter-static</code> を使用し、<a href="https://github.com/sveltejs/kit/tree/master/packages/adapter-static#spa-mode">fallback page の設定と SSR の無効化</a> を行えば、シングルページアプリ(SPA)を生成することができます。<blockquote><p>SvelteKit をデプロイする環境に対して <a href="../20-core-concepts/40-page-options.html#trailingslash"><code>trailingSlash</code></a> が適切に設定されているかよく確かめてください。<code>/a</code> に対するリクエストを受け取っても <code>/a.html</code> をレンダリングしない環境の場合、<code>/a.html</code> の代わりに <code>/a/index.html</code> を生成するために <code>trailingSlash: 'always'</code> を設定する必要があります。</blockquote></section><section id="プラットフォーム固有の情報"class="level3"><h3>プラットフォーム固有の情報</h3><p>adapter によっては、リクエストに関する追加情報にアクセスすることができます。例えば、Cloudflare Workers の場合は KV namespaces などを含む <code>env</code> オブジェクトにアクセスできます。これは <a href="../30-advanced/20-hooks.html">hooks</a> や <a href="../20-core-concepts/10-routing.html#server">サーバールート(server routes)</a> で使用される <code>RequestEvent</code> に、<code>platform</code> プロパティとして渡されます — 詳しくは、各 adapter のドキュメントをご参照ください。</section></section><section id="コミュニティが提供する-adapter"class="level2"><h2>コミュニティが提供する adapter</h2><p>加えて、他のプラットフォーム向けに、<a href="https://sveltesociety.dev/components#adapters">コミュニティによって提供されている adapter</a> もございます。パッケージマネージャーで該当の adapter をインストールした後、<code>svelte.config.js</code> を更新してください:<pre class="language-diff"><code class="language-diff">/// file: svelte.config.js
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">import adapter from '@sveltejs/adapter-auto';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import adapter from 'svelte-adapter-[x]';</span></span></code></pre></section><section id="custom-adapter-を作成する"class="level2"><h2>custom adapter を作成する</h2><p>似ているプラットフォーム向けの <a href="https://github.com/sveltejs/kit/tree/master/packages">adapter のソースを探し</a>、それをコピーするところから始めることを推奨します。<p>Adapter Package は <code>Adapter</code> を作成する以下の API を実装する必要があります:<pre class="language-js"><code class="language-js"><span class="token comment">// @filename: ambient.d.ts</span>
type <span class="token maybe-class-name">AdapterSpecificOptions</span> <span class="token operator">=</span> any<span class="token punctuation">;</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token doc-comment comment">/** <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>AdapterSpecificOptions<span class="token punctuation">}</span></span> <span class="token parameter">options</span> */</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'@sveltejs/kit'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Adapter<span class="token punctuation">}</span></span> */</span>
	<span class="token keyword">const</span> adapter <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'adapter-package-name'</span><span class="token punctuation">,</span>
		<span class="token keyword">async</span> <span class="token function">adapt</span><span class="token punctuation">(</span><span class="token parameter">builder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// adapter implementation</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword control-flow">return</span> adapter<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><code>Adapter</code> とそのパラメータの型は <a href="https://github.com/sveltejs/kit/blob/master/packages/kit/types/index.d.ts">types/index.d.ts</a> にあります。<p><code>adapt</code> メソッドの中では、adapter がすべきことがたくさんあります:<ul><li>build ディレクトリの掃除<li><code>builder.writeClient</code>、<code>builder.writeServer</code>、<code>builder.writePrerendered</code> を用いて SvelteKit のアウトプットを書き出す<li>コードの出力:<ul><li><code>${builder.getServerDirectory()}/index.js</code> から <code>Server</code> をインポートする<li><code>builder.generateManifest({ relativePath })</code> で生成された manifest でアプリをインスタンス化する<li>プラットフォームからのリクエストをリスンし、必要に応じて標準の <a href="https://developer.mozilla.org/ja/docs/Web/API/Request">Request</a> に変換し、<code>server.respond(request, { getClientAddress })</code> 関数を呼び出して <a href="https://developer.mozilla.org/ja/docs/Web/API/Response">Response</a> を生成し、応答する<li><code>server.respond</code> に渡される <code>platform</code> オプションを通して、SvelteKit にプラットフォーム固有の情報を公開する<li>必要に応じて、対象プラットフォームで動作するように <code>fetch</code> をグローバルに shim する。SvelteKit は <code>node-fetch</code> を使用できるプラットフォーム向けに <code>@sveltejs/kit/install-fetch</code> ヘルパーを提供しています</ul><li>必要に応じて、ターゲットプラットフォームに依存ライブラリをインストールするのを避けるために出力ファイルをバンドルする<li>対象プラットフォームの正しい場所にユーザーの静的ファイルや生成した JS/CSS ファイルを設置する</ul><p>可能であれば、adapter の出力は <code>build/</code> ディレクトリに、中間出力は <code>.svelte-kit/[adapter-name]</code> に置くことを推奨します。<blockquote><p>adapter API はバージョン 1.0 のリリース前に変更される可能性があります。 <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></blockquote></section></section>