<!doctype html><html lang="ja"><meta charset="utf-8"><title>Web standards</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="web-standards"><h1 id="web-standards">Web standards</h1><p>このドキュメントを通じて、SvelteKit の土台となっている標準の <a href="https://developer.mozilla.org/en-US/docs/Web/API">Web API</a> を参照することができます。私たちは車輪の再発明をするのではなく、<em>プラットフォームを使用します</em> 。つまり、既存の Web 開発スキルが SvelteKit にも活用できるということです。逆に言えば、SvelteKit の学習に時間を割くことは、あなたが他の場所でも通用する良い Web 開発者になるのに役立つでしょう。<p>これらの API は、全てのモダンブラウザはもちろん、Cloudflare Workers、Deno、Vercel Edge Functions といったブラウザ以外の環境でも使用することができます。開発中や、(AWS Lambda を含む) Node ベースの環境向けの <a href="adapters">adapters</a> では、必要に応じて polyfill で利用できるようにしています (現時点においては。Node は急速により多くの Web 標準のサポートを追加しています)。<p>具体的には、以下のことが楽にできるでしょう:<section class="level2"aria-labelledby="fetch-apis"><h2 id="fetch-apis">Fetch APIs</h2><p>SvelteKit は、ネットワーク越しにデータを取得するために <a href="https://developer.mozilla.org/ja/docs/Web/API/fetch"><code>fetch</code></a> を使用します。ブラウザだけでなく、<a href="hooks">hooks</a> や <a href="routing#server">サーバールート(server routes)</a> の中でも使用することができます。<blockquote><p><a href="load"><code>load</code></a> 関数、<a href="hooks#server-hooks">server hooks</a>、<a href="routing#server">API routes</a> の中では特別なバージョンの <code>fetch</code> を使用することができ、サーバーサイドレンダリング中に、HTTP をコールすることなく、クレデンシャルを保持したまま、直接エンドポイント(endpoints)を呼び出すことができます。(<code>load</code> の外側のサーバーサイドコードでクレデンシャル付きの fetch を行う場合は、明示的に <code>cookie</code> や <code>authorization</code> ヘッダーなどを渡さなければなりません。) また、通常のサーバーサイドの <code>fetch</code> では絶対パスの URL が必要となりますが、特別なバージョンの <code>fetch</code> では相対パスのリクエストが可能です。</blockquote><p><code>fetch</code> 自体の他に、<a href="https://developer.mozilla.org/ja/docs/Web/API/Fetch_API">Fetch API</a> には以下のインターフェイスが含まれています:</section><section class="level2"aria-labelledby="request"><h2 id="request">Request</h2><p><a href="https://developer.mozilla.org/ja/docs/Web/API/Request"><code>Request</code></a> のインスタンスは <a href="hooks">hooks</a> や <a href="routing#server">サーバールート(server routes)</a> で <code>event.request</code> という形でアクセスすることができます。これには <code>request.json()</code> や <code>request.formData()</code> など、エンドポイントに送られたデータを取得するための便利なメソッドが含まれています。</section><section class="level2"aria-labelledby="response"><h2 id="response">Response</h2><p><a href="https://developer.mozilla.org/ja/docs/Web/API/Response"><code>Response</code></a> のインスタンスは <code>await fetch(...)</code> と <code>+server.js</code> ファイル内のハンドラーから返されます。本質的には、SvelteKit アプリは <code>Request</code> を <code>Response</code> に変換するマシンです。</section><section class="level2"aria-labelledby="headers"><h2 id="headers">Headers</h2><p><a href="https://developer.mozilla.org/ja/docs/Web/API/Headers"><code>Headers</code></a> インターフェイスでは、受け取った <code>request.headers</code> を読み取り、送信する <code>response.headers</code> をセットすることができます。例えば以下のように、<code>request.headers</code> を取得して、<a href="modules#sveltejs-kit-json"><code>json</code> という便利な関数</a>を使用して <code>response.headers</code> を変更し送信することができます:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2461</span>
<span class="token comment">/// file: src/routes/what-is-my-user-agent/+server.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> json <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/kit'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>RequestHandler<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// log all headers</span>
	<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token spread operator">...</span>request<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// create a JSON Response using a header we received</span>
	<span class="token keyword control-flow">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token comment">// retrieve a specific header</span>
		<span class="token literal-property property">userAgent</span><span class="token operator">:</span> request<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'user-agent'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token comment">// set a header on the response</span>
		<span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">'x-custom-header'</span><span class="token operator">:</span> <span class="token string">'potato'</span> <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section><section class="level2"aria-labelledby="formdata"><h2 id="formdata">FormData</h2><p>HTML のネイティブのフォーム送信を扱う場合は、<a href="https://developer.mozilla.org/ja/docs/Web/API/FormData"><code>FormData</code></a> オブジェクトを使用します。<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2461</span>
<span class="token comment">/// file: src/routes/hello/+server.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> json <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/kit'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>RequestHandler<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">POST</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword control-flow">await</span> event<span class="token punctuation">.</span><span class="token property-access">request</span><span class="token punctuation">.</span><span class="token method function property-access">formData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// log all fields</span>
	<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token spread operator">...</span>body<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword control-flow">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token comment">// get a specific field's value</span>
		<span class="token literal-property property">name</span><span class="token operator">:</span> body<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">'world'</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section><section class="level2"aria-labelledby="stream-apis"><h2 id="stream-apis">Stream APIs</h2><p>ほとんどの場合、エンドポイント(endpoints) は 上記の <code>userAgent</code> の例のように、完全なデータを返します。たまに、1度ではメモリに収まらない大きすぎるレスポンスを返したり、チャンクで配信したりしなければならないことがあります。このような場合のために、プラットフォームは <a href="https://developer.mozilla.org/ja/docs/Web/API/Streams_API">streams</a> — <a href="https://developer.mozilla.org/ja/docs/Web/API/ReadableStream">ReadableStream</a>、<a href="https://developer.mozilla.org/ja/docs/Web/API/WritableStream">WritableStream</a>、<a href="https://developer.mozilla.org/ja/docs/Web/API/TransformStream">TransformStream</a> を提供しています。</section><section class="level2"aria-labelledby="url-apis"><h2 id="url-apis">URL APIs</h2><p>URL は <a href="https://developer.mozilla.org/ja/docs/Web/API/URL"><code>URL</code></a> インターフェイスで表現され、<code>origin</code> や <code>pathname</code> のような便利なプロパティが含まれています (ブラウザでは <code>hash</code> なども)。このインターフェイスは、<a href="hooks">hooks</a> と <a href="routing#server">サーバールート(server routes)</a> では <code>event.url</code>、<a href="routing#page">ページ(pages)</a> では <a href="modules#$app-stores"><code>$page.url</code></a>、<a href="modules#$app-navigation"><code>beforeNavigate</code> と <code>afterNavigate</code></a> では <code>from</code> と <code>to</code>、など、様々な場所で使われています。</section><section class="level2"aria-labelledby="urlsearchparams"><h2 id="urlsearchparams">URLSearchParams</h2><p>URL が存在する場所であれば、<a href="https://developer.mozilla.org/ja/docs/Web/API/URLSearchParams"><code>URLSearchParams</code></a> のインスタンスである <code>url.searchParams</code> を使用してクエリパラメータにアクセスできます:<pre class="language-js"><code class="language-js"><span class="token comment">// @filename: ambient.d.ts</span>
declare global <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token constant">URL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token exports"><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">;</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword">const</span> foo <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token property-access">searchParams</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section class="level2"aria-labelledby="web-crypto"><h2 id="web-crypto">Web Crypto</h2><p><a href="https://developer.mozilla.org/ja/docs/Web/API/Web_Crypto_API">Web Crypto API</a> を、グローバルの <code>crypto</code> 経由で使用することができます。内部では <a href="configuration#csp">Content Security Policy</a> ヘッダーで使用されていますが、例えば UUID を生成するのにもお使い頂けます。<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> uuid <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token method function property-access">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section>