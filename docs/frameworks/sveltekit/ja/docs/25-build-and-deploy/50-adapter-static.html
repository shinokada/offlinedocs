<!doctype html><html lang="ja"><meta charset="utf-8"><title>Static site generation</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="static-site-generation"class="level1"><h1>Static site generation</h1><p>SvelteKit を static site generator (SSG) として使用するには、<a href="https://github.com/sveltejs/kit/tree/master/packages/adapter-static"><code>adapter-static</code></a> を使用します。<p>この adapter はサイト全体を静的なファイルのコレクションとしてプリレンダリングします。もし、一部のページのみをプリレンダリングしたい場合、別の adapter と <a href="page-options#prerender"><code>prerender</code> オプション</a> を組み合わせて使用する必要があります。<section id="使い方"class="level2"><h2>使い方</h2><p><code>npm i -D @sveltejs/adapter-static</code> を実行してインストールし、<code>svelte.config.js</code> にこの adapter を追加します:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2307</span>
<span class="token comment">/// file: svelte.config.js</span>
<span class="token keyword module">import</span> <span class="token imports">adapter</span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/adapter-static'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">kit</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">adapter</span><span class="token operator">:</span> <span class="token function">adapter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token comment">// default options are shown. On some platforms</span>
			<span class="token comment">// these options are set automatically — see below</span>
			<span class="token literal-property property">pages</span><span class="token operator">:</span> <span class="token string">'build'</span><span class="token punctuation">,</span>
			<span class="token literal-property property">assets</span><span class="token operator">:</span> <span class="token string">'build'</span><span class="token punctuation">,</span>
			<span class="token literal-property property">fallback</span><span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span>
			<span class="token literal-property property">precompress</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
			<span class="token literal-property property">strict</span><span class="token operator">:</span> <span class="token boolean">true</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>…そして <a href="page-options#prerender"><code>prerender</code></a> オプションを最上位のレイアウト(root layout)に追加します:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/+layout.js</span>
<span class="token comment">// This can be false if you're using a fallback (i.e. SPA mode)</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> prerender <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></code></pre><blockquote><p>SvelteKit の <a href="page-options#trailingslash"><code>trailingSlash</code></a> オプションを、あなたの環境に対して適切に設定しなければなりません。もしあなたのホスト環境が、<code>/a</code> へのリクエストを受け取ったときに <code>/a.html</code> をレンダリングしない場合、<code>/a/index.html</code> を作成するために <code>trailingSlash: 'always'</code> を設定する必要があります。</blockquote></section><section id="ゼロコンフィグサポート"class="level2"><h2>ゼロコンフィグサポート</h2><p>ゼロコンフィグサポートがあるプラットフォームもあります (将来増える予定):<ul><li><a href="https://vercel.com">Vercel</a></ul><p>これらのプラットフォームでは、adapter のオプションを省略することで、<code>adapter-static</code> が最適な設定を提供できるようになります:<pre class="language-diff"><code class="language-diff">/// file: svelte.config.js
export default {
	kit: {
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">		adapter: adapter({...}),
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">		adapter: adapter(),
</span></span>		}
	}
};</code></pre></section><section id="options"class="level2"><h2>Options</h2></section><section id="pages"class="level2"><h2>pages</h2><p>プリレンダリングされたページを書き込むディレクトリです。デフォルトは <code>build</code> です。</section><section id="assets"class="level2"><h2>assets</h2><p>静的なアセット (<code>static</code> のコンテンツと、SvelteKit が生成するクライアントサイドの JS と CSS) を書き込むディレクトリです。通常は <code>pages</code> と同じにするべきで、デフォルトでは、それがどんな値だったとしても、<code>pages</code> の値になります。しかし、まれな状況では、出力されるページとアセットを別々の場所にする必要があるかもしれません。</section><section id="fallback"class="level2"><h2>fallback</h2><p>SPA モードのための<a href="#spa-mode-add-fallback-page">フォールバックページ(fallback page)</a>を指定します。例えば、<code>index.html</code> や <code>200.html</code>、<code>404.html</code> などです。</section><section id="precompress"class="level2"><h2>precompress</h2><p><code>true</code> の場合、brotli や gzip でファイルを事前圧縮(precompress)します。これによって <code>.br</code> ファイルや <code>.gz</code> ファイルが生成されます。</section><section id="strict"class="level2"><h2>strict</h2><p>デフォルトでは <code>adapter-static</code> は、アプリの全てのページとエンドポイント (もしあれば) がプリレンダリングされているか、もしくは <code>fallback</code> オプションが設定されているかをチェックします。このチェックは、アプリの一部が最終的な出力に含まれずアクセスできない状態なのに誤って公開されてしまうのを防ぐために存在します。もし、それでも良いことがわかっている場合 (例えばあるページが条件付きでしか存在しない場合)、<code>strict</code> を <code>false</code> に設定してこのチェックをオフにすることができます。</section><section id="spa-モード"class="level2"><h2>SPA モード</h2><p><code>adapter-static</code> を使用し、<strong>フォールバックページ(fallback page)</strong> を指定することで、シングルページアプリ(SPA)を作成することができます。<blockquote><p>ほとんどの場合、これはおすすめできません: SEO に悪影響を与え、知覚的なパフォーマンスが低下する傾向があり、もし JavaScript が失敗したり無効になっていたりする場合 (これは<a href="https://kryogenix.org/code/browser/everyonehasjs.html">あなたが思うより頻繁に</a>発生します)、ユーザーはアプリにアクセスできなくなります.</blockquote><p>もし、プリレンダリングされるルート(routes)がないシンプルな SPA を作成したい場合は、必要な設定はこのようになります:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2307</span>
<span class="token comment">/// file: svelte.config.js</span>
<span class="token keyword module">import</span> <span class="token imports">adapter</span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/adapter-static'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">kit</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">adapter</span><span class="token operator">:</span> <span class="token function">adapter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token literal-property property">fallback</span><span class="token operator">:</span> <span class="token string">'200.html'</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token literal-property property">prerender</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">entries</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/+layout.js</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> ssr <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></code></pre><p>SPA にしたいページのみ<a href="#spa-mode-turn-off-prerendering">プリレンダリングを無効化することで</a>、アプリの一部のみを SPA にすることもできます。<p>これらのオプションを1つずつ見ていきましょう:</section><section id="フォールバックページfallback-pageを追加する"class="level2"><h2>フォールバックページ(fallback page)を追加する</h2><p>フォールバックページ(fallback page)とは、SvelteKit がページテンプレート(例: <code>app.html</code>)から作成する HTML ページで、アプリをロードし正しいルート(routes)にナビゲートします。例えば、静的 web ホスティングである <a href="https://surge.sh/help/adding-a-200-page-for-client-side-routing">Surge</a> では、静的なアセットやプリレンダリングページに対応しないリクエストを処理する <code>200.html</code> ファイルを追加する必要があります。このファイルはこのように作成することができます:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2307</span>
<span class="token comment">/// file: svelte.config.js</span>
<span class="token keyword module">import</span> <span class="token imports">adapter</span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/adapter-static'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">kit</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">adapter</span><span class="token operator">:</span> <span class="token function">adapter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token literal-property property">fallback</span><span class="token operator">:</span> <span class="token string">'200.html'</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><blockquote><p>ただし、この動作を設定する方法はあなたのホスティングソリューションに依存するので、Sveltekit の管轄外です。リクエストをリダイレクトする方法については、ホスティング環境のドキュメントを検索することをおすすめします。</blockquote></section><section id="プリレンダリングをオフにする"class="level2"><h2>プリレンダリングをオフにする</h2><p>SPA モードで動作させる場合、最上位のレイアウト(root layout)の <a href="page-options#prerender"><code>prerender</code></a> オプションを省略することができ (または、デフォルト値の <code>false</code> を設定)、<code>prerender</code> オプションが設定されているページのみ、ビルド時にプリレンダリングされます。<p>SvelteKit はプリレンダリング可能なページを探すためにアプリのエントリーポイントをクロールします。ブラウザから読み込めないページが原因で <code>svelte-kit build</code> が失敗する場合は、<code>config.kit.prerender.entries</code> を <code>[]</code> に設定することでこれを防ぐことができます (<code>config.kit.prerender.enabled</code> を <code>false</code> に設定してもこの効果がありますが、フォールバックページが生成されなくなってしまいます)。<p>アプリの一部のみプリレンダリングをオフにすることで、その他の部分をプリレンダリングすることもできます。</section><section id="ssr-をオフにする"class="level2"><h2>ssr をオフにする</h2><p>開発中、SvelteKit はあなたのルート(routes)をサーバーサイドでレンダリングしようとします。つまり、ブラウザでのみ利用可能なもの (例えば <code>window</code> オブジェクト) にアクセスすると、たとえ最終的に出力されるアプリとしては有効であっても、エラーとなります。Sveltekit の開発モードの動作を SPA に合わせるには、<a href="page-options#ssr"><code>export const ssr = false</code></a> を最上位(root) の <code>+layout</code> に追加します。このオプションをアプリの一部に追加して、その他の部分をプリレンダリングすることもできます。</section><section id="apache"class="level2"><h2>Apache</h2><p>SPA を <a href="https://httpd.apache.org/">Apache</a> で実行する場合は、<code>static/.htaccess</code> ファイルを追加し、リクエストをフォールバックページ(fallback page)にルーティングする必要があります:<pre class="language-text"><code class="language-text">&#x3C;IfModule mod_rewrite.c>
	RewriteEngine On
	RewriteBase /
	RewriteRule ^200\.html$ - [L]
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_FILENAME} !-d
	RewriteRule . /200.html [L]
&#x3C;/IfModule></code></pre></section><section id="github-pages"class="level2"><h2>GitHub Pages</h2><p>GitHub Pages 向けにビルドするときは、<a href="configuration#paths"><code>paths.base</code></a> をあなたのリポジトリ名に合わせて更新するようにしてください。サイトが root からではなく <a href="https://your-username.github.io/your-repo-name">https://your-username.github.io/your-repo-name</a> から提供されるためです。<p>GitHub が提供する Jekyll が、あなたのサイトを管理するのを防ぐために、空の <code>.nojekyll</code> ファイルを static フォルダに追加する必要があります。Jekyll を無効にしたくない場合は、kit の <code>appDir</code> 設定オプションを <code>'app_'</code> またはアンダースコアで始まらないものに変更します。詳細は、GitHub の <a href="https://docs.github.com/en/pages/setting-up-a-github-pages-site-with-jekyll/about-github-pages-and-jekyll#configuring-jekyll-in-your-github-pages-site">Jekyll のドキュメント</a> をご参照ください。<p>GitHub Pages 向けの設定は以下のようになるでしょう:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: svelte.config.js</span>
<span class="token keyword">const</span> dev <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">argv</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">'dev'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'@sveltejs/kit'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Config<span class="token punctuation">}</span></span> */</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">kit</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">paths</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">base</span><span class="token operator">:</span> dev <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'/your-repo-name'</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">// If you are not using a .nojekyll file, change your appDir to something not starting with an underscore.</span>
		<span class="token comment">// For example, instead of '_app', use 'app_', 'internal', etc.</span>
		<span class="token literal-property property">appDir</span><span class="token operator">:</span> <span class="token string">'internal'</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section>