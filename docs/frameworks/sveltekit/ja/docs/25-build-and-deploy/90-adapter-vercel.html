<!doctype html><html lang="ja"><meta charset="utf-8"><title>Vercel</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="vercel"class="level1"><h1>Vercel</h1><p>Vercel にデプロイする場合は、<a href="https://github.com/sveltejs/kit/tree/master/packages/adapter-vercel"><code>adapter-vercel</code></a> を使用します。<p><a href="adapter-auto"><code>adapter-auto</code></a> を使用している場合、この adapter は自動でインストールされますが、この adapter 自体をプロジェクトに追加すれば Vercel 固有のオプションを指定できるようになります。<section id="使い方"class="level2"><h2>使い方</h2><p><code>npm i -D @sveltejs/adapter-vercel</code> を実行してインストールし、<code>svelte.config.js</code> にこの adapter を追加します:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2307</span>
<span class="token comment">/// file: svelte.config.js</span>
<span class="token keyword module">import</span> <span class="token imports">adapter</span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/adapter-vercel'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">kit</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token comment">// default options are shown</span>
		<span class="token literal-property property">adapter</span><span class="token operator">:</span> <span class="token function">adapter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token comment">// if true, will deploy the app using edge functions</span>
			<span class="token comment">// (https://vercel.com/docs/concepts/functions/edge-functions)</span>
			<span class="token comment">// rather than serverless functions</span>
			<span class="token literal-property property">edge</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

			<span class="token comment">// an array of dependencies that esbuild should treat</span>
			<span class="token comment">// as external when bundling functions</span>
			<span class="token literal-property property">external</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

			<span class="token comment">// if true, will split your app into multiple functions</span>
			<span class="token comment">// instead of creating a single one for the entire app</span>
			<span class="token literal-property property">split</span><span class="token operator">:</span> <span class="token boolean">false</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></section><section id="環境変数"class="level2"><h2>環境変数</h2><p>Vercel では<a href="https://vercel.com/docs/concepts/projects/environment-variables#system-environment-variables">デプロイメント固有の環境変数</a>一式を使用できます。他の環境変数と同様、<code>$env/static/private</code> と <code>$env/dynamic/private</code> からアクセスでき (詳細は後述)、public のほうからはアクセスできません。クライアントからこれらの変数にアクセスするには:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2305</span>
<span class="token comment">/// file: +layout.server.js</span>
<span class="token keyword module">import</span> <span class="token punctuation">{</span> <span class="token constant">VERCEL_COMMIT_REF</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'$env/static/private'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">deploymentGitBranch</span><span class="token operator">:</span> <span class="token constant">VERCEL_COMMIT_REF</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-svelte"><code class="language-svelte">/// file: +layout.svelte
&#x3C;script>
	/** @type {import('./$types').LayoutServerData} */
	export let data;
&#x3C;/script>

&#x3C;p>This staging environment was deployed from {data.deploymentGitBranch}.&#x3C;/p></code></pre><p>Vercel でビルドする場合、これらの変数は全てビルド時と実行時で変わらないため、<code>$env/dynamic/private</code> ではなく、変数を静的に置換しデッドコードの削除などの最適化ができる <code>$env/static/private</code> の使用をおすすめします。<code>edge: true</code> にしてデプロイする場合は、<code>$env/static/private</code> を使用しなければなりません。<code>$env/dynamic/private</code> と <code>$env/dynamic/public</code> は、現在のところ Vercel の edge functions では設定されないためです。</section><section id="notes"class="level2"><h2>Notes</h2></section><section id="vercel-functions"class="level2"><h2>Vercel functions</h2><p>プロジェクトの root にある <code>/api</code> ディレクトリにある Vercel functions はデプロイメントに含まれません。これらは SvelteKit アプリの <a href="https://kit.svelte.jp../20-core-concepts/10-routing.html#server">サーバーエンドポイント(server endpoints)</a> として実装する必要があります。</section><section id="node-version"class="level2"><h2>Node version</h2><p>ある時期より前に作成されたプロジェクトはデフォルトで Node 14 を使用していますが、SvelteKit には Node 16 以降が必要です。<a href="https://vercel.com/docs/concepts/functions/serverless-functions/runtimes/node-js#node.js-version">プロジェクトの設定で Node のバージョンを変更する</a>ことができます。</section><section id="トラブルシューティング"class="level2"><h2>トラブルシューティング</h2></section><section id="ファイルシステムにアクセスする"class="level2"><h2>ファイルシステムにアクセスする</h2><p>Serverless/Edge 環境では、<code>fs.readFileSync</code> などのメソッドでファイルシステムにアクセスすることはできません。もしこのような方法でファイルにアクセスする必要がある場合、アプリのビルド中に<a href="https://kit.svelte.jp../20-core-concepts/40-page-options.html#prerender">プリレンダリング</a>でこれを行ってください。例えば、ブログを持っていて、CMS でコンテンツを管理したくない場合、コンテンツをプリレンダリングし (またはコンテンツを取得するエンドポイントをプリレンダリングし)、新しいコンテンツを追加するたびにブログを再デプロイする必要があります。<span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section>