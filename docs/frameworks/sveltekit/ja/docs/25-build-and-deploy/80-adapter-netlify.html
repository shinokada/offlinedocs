<!doctype html><html lang="ja"><meta charset="utf-8"><title>Netlify</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="netlify"><h1 id="netlify">Netlify</h1><p>Netlify にデプロイする場合は、<a href="https://github.com/sveltejs/kit/tree/master/packages/adapter-netlify"><code>adapter-netlify</code></a> を使用します。<p><a href="adapter-auto"><code>adapter-auto</code></a> を使用している場合、この adapter は自動でインストールされますが、この adapter 自体をプロジェクトに追加すれば Netlify 固有のオプションを指定できるようになります。<section class="level2"aria-labelledby="使い方---usage--"><h2 id="使い方---usage--">使い方</h2><p><code>npm i -D @sveltejs/adapter-netlify</code> を実行してインストールし、<code>svelte.config.js</code> にこの adapter を追加します:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2307</span>
<span class="token comment">/// file: svelte.config.js</span>
<span class="token keyword module">import</span> <span class="token imports">adapter</span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/adapter-netlify'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">kit</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token comment">// default options are shown</span>
		<span class="token literal-property property">adapter</span><span class="token operator">:</span> <span class="token function">adapter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token comment">// if true, will create a Netlify Edge Function rather</span>
			<span class="token comment">// than using standard Node-based functions</span>
			<span class="token literal-property property">edge</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

			<span class="token comment">// if true, will split your app into multiple functions</span>
			<span class="token comment">// instead of creating a single one for the entire app.</span>
			<span class="token comment">// if `edge` is true, this option cannot be used</span>
			<span class="token literal-property property">split</span><span class="token operator">:</span> <span class="token boolean">false</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>そして、プロジェクトの root に <a href="https://docs.netlify.com/configure-builds/file-based-configuration">netlify.toml</a> ファイルを置くのを忘れないでください。このファイルの <code>build.publish</code> に基づいて静的なアセットをどこに書き込むか決定します。こちらのサンプルの設定をご覧ください:<pre class="language-toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">build</span><span class="token punctuation">]</span>
	<span class="token key property">command</span> <span class="token punctuation">=</span> <span class="token string">"npm run build"</span>
	<span class="token key property">publish</span> <span class="token punctuation">=</span> <span class="token string">"build"</span></code></pre><p><code>netlify.toml</code> ファイルが見つからない、もしくは <code>build.publish</code> の値が見つからない場合、<code>"build"</code> のデフォルト値が使用されます。Netlify の UI で publish ディレクトリを他の場所に設定する場合は、<code>netlify.toml</code> にも同じ場所を設定するか、<code>"build"</code> のデフォルト値を使用する必要があることにご注意ください。</section><section class="level2"aria-labelledby="node-version"><h2 id="node-version">Node version</h2><p>新しいプロジェクトではデフォルトで Node 16 が使用されます。しかし、少し前に作成したプロジェクトをアップグレードする場合、古いバージョンで止まってしまうかもしれません。手動で Node 16 以降を指定する場合、詳細は <a href="https://docs.netlify.com/configure-builds/manage-dependencies/#node-js-and-javascript">Netlify のドキュメント</a>をご参照ください。</section><section class="level2"aria-labelledby="netlify-edge-functions"><h2 id="netlify-edge-functions">Netlify Edge Functions</h2><p>SvelteKit は <a href="https://docs.netlify.com/netlify-labs/experimental-features/edge-functions/">Netlify Edge Functions</a> をサポートしています。<code>adapter</code> 関数に <code>edge: true</code> オプションを渡すと、サイト訪問者に近い場所にデプロイされる Deno ベースの edge function でサーバーサイドレンダリングが行われるようになります。<code>false</code> を設定した場合 (デフォルト)、サイトは Node ベースの Netlify Functions にデプロイされます。<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2307</span>
<span class="token comment">/// file: svelte.config.js</span>
<span class="token keyword module">import</span> <span class="token imports">adapter</span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/adapter-netlify'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">kit</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">adapter</span><span class="token operator">:</span> <span class="token function">adapter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token comment">// will create a Netlify Edge Function using Deno-based</span>
			<span class="token comment">// rather than using standard Node-based functions</span>
			<span class="token literal-property property">edge</span><span class="token operator">:</span> <span class="token boolean">true</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></section><section class="level2"aria-labelledby="sveltekit-の機能を代替する-netlify-の機能---netlify-alternatives-to-sveltekit-functionality--"><h2 id="sveltekit-の機能を代替する-netlify-の機能---netlify-alternatives-to-sveltekit-functionality--">SvelteKit の機能を代替する Netlify の機能</h2><p>Netlify の機能に依存することなく、SvelteKit が直接提供する機能を使ってアプリを構築することができます。こういった機能は SvelteKit のほうを選択すると、開発モードでその機能を使用でき、インテグレーションテストが可能になり、Netlify から切り替えることになった場合に他の adapter で動作させることができます。しかし、シナリオによっては Netlify のほうの機能を使用したほうが有益な場合もあります。例えば、すでに Netlify でホストされているアプリを SvelteKit に移行する場合です。</section><section class="level2"aria-labelledby="リダイレクトルールredirect-rules"><h2 id="リダイレクトルールredirect-rules">リダイレクトルール(Redirect rules)</h2><p>コンパイル時に、リダイレクトルールは自動で <code>_redirects</code> ファイルに追記されます (もし存在しない場合は、作成されます)。つまり:<ul><li><code>_redirects</code> のほうが<a href="https://docs.netlify.com/routing/redirects/#rule-processing-order">優先度が高い</a>ため、<code>netlify.toml</code> にある <code>[[redirects]]</code> には決してマッチしません。そのため、ルールは常に <a href="https://docs.netlify.com/routing/redirects/#syntax-for-the-redirects-file"><code>_redirects</code> ファイル</a>に記載してください。<li><code>_redirects</code> には、<code>/* /foobar/:splat</code> のようなカスタムの "catch all" ルールを置くべきではありません。そうしないと、自動で追加されたルールが適用されなくなります。Netlify は<a href="https://docs.netlify.com/routing/redirects/#rule-processing-order">最初にマッチしたルール</a>だけを処理するからです。</ul></section><section class="level2"aria-labelledby="netlify-forms"><h2 id="netlify-forms">Netlify Forms</h2><ol><li><a href="https://docs.netlify.com/forms/setup/#html-forms">こちら</a>にあるように、例えば <code>/routes/contact/+page.svelte</code> に、Netlify HTML form を作成します。(hidden の <code>form-name</code> input 要素を追加するのを忘れずに！)<li>Netlify の build bot はデプロイ時にあなたの HTML ファイルをパースします。つまり、あなたの form は HTML として<a href="https://kit.svelte.jp../20-core-concepts/40-page-options.html#prerender">プリレンダリング</a>されるようにしておかないといけません。あなたの <code>contact.svelte</code> に <code>export const prerender = true</code> を追加してそのページだけプリレンダリングするか、または <code>kit.prerender.force: true</code> オプションを設定して全てのページをプリレンダリングするようにしておくか、で対応できます。<li>あなたの Netlify form に <code>&#x3C;form netlify ... action="/success"></code> のような<a href="https://docs.netlify.com/forms/setup/#success-messages">カスタムの成功メッセージ</a>がある場合、それに対応する <code>/routes/success/+page.svelte</code> が存在しプリレンダリングされるか確認してください。</ol></section><section class="level2"aria-labelledby="netlify-functions"><h2 id="netlify-functions">Netlify Functions</h2><p>この adapter によって、SvelteKit エンドポイントは <a href="https://docs.netlify.com/functions/overview/">Netlify Functions</a> としてホストされます。Netlify function ハンドラには追加のコンテキストがあり、<a href="https://docs.netlify.com/visitor-access/identity/">Netlify Identity</a> 情報が含まれています。このコンテキストは、あなたの hooks や <code>+page.server</code> と <code>+layout.server</code> エンドポイント の中で <code>event.platform.context</code> フィールドを介してアクセスできます。adapter config の <code>edge</code> プロパティが <code>false</code> の場合は<a href="https://docs.netlify.com/functions/overview/">serverless functions</a>、<code>true</code> の場合は <a href="https://docs.netlify.com/edge-functions/overview/#app">edge functions</a> となります。<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2705 7006</span>
<span class="token comment">/// file: +page.server.js</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">load</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> context <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token property-access">platform</span><span class="token punctuation">.</span><span class="token property-access">context</span><span class="token punctuation">;</span>
	<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// shows up in your functions log in the Netlify app</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>さらに、ディレクトリを追加して <code>netlify.toml</code> に設定を追加することで、独自の Netlify functions を追加することができます。例えば:<pre class="language-toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">build</span><span class="token punctuation">]</span>
	<span class="token key property">command</span> <span class="token punctuation">=</span> <span class="token string">"npm run build"</span>
	<span class="token key property">publish</span> <span class="token punctuation">=</span> <span class="token string">"build"</span>

<span class="token punctuation">[</span><span class="token table class-name">functions</span><span class="token punctuation">]</span>
	<span class="token key property">directory</span> <span class="token punctuation">=</span> <span class="token string">"functions"</span></code></pre></section><section class="level2"aria-labelledby="トラブルシューティング---troubleshooting--"><h2 id="トラブルシューティング---troubleshooting--">トラブルシューティング</h2></section><section class="level2"aria-labelledby="ファイルシステムにアクセスする---accessing-the-file-system--"><h2 id="ファイルシステムにアクセスする---accessing-the-file-system--">ファイルシステムにアクセスする</h2><p>Serverless/Edge 環境では、<code>fs.readFileSync</code> などのメソッドでファイルシステムにアクセスすることはできません。もしこのような方法でファイルにアクセスする必要がある場合、アプリのビルド中に<a href="https://kit.svelte.jp../20-core-concepts/40-page-options.html#prerender">プリレンダリング</a>でこれを行ってください。例えば、ブログを持っていて、CMS でコンテンツを管理したくない場合、コンテンツをプリレンダリングし (またはコンテンツを取得するエンドポイントをプリレンダリングし)、新しいコンテンツを追加するたびにブログを再デプロイする必要があります。 <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section>