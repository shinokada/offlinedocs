<!doctype html><html lang="ja"><meta charset="utf-8"><title>adapter を書く</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="adapter-を書く"class="level1"><h1>adapter を書く</h1><p>あなたが使いたい環境向けの adapter がまだ存在しない場合は、ご自身で adapter を作成することができます。あなたが使いたい環境に似ているプラットフォームの <a href="https://github.com/sveltejs/kit/tree/master/packages">adapter のソースを見て</a>、コピーするところから始めることをおすすめします。<p>Adapter パッケージは以下の API を実装しなければなりません。これによって <code>Adapter</code> が作られます:<pre class="language-js"><code class="language-js"><span class="token comment">// @filename: ambient.d.ts</span>
type <span class="token maybe-class-name">AdapterSpecificOptions</span> <span class="token operator">=</span> any<span class="token punctuation">;</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token doc-comment comment">/** <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>AdapterSpecificOptions<span class="token punctuation">}</span></span> <span class="token parameter">options</span> */</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'@sveltejs/kit'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Adapter<span class="token punctuation">}</span></span> */</span>
	<span class="token keyword">const</span> adapter <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'adapter-package-name'</span><span class="token punctuation">,</span>
		<span class="token keyword">async</span> <span class="token function">adapt</span><span class="token punctuation">(</span><span class="token parameter">builder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// adapter implementation</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword control-flow">return</span> adapter<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><code>Adapter</code> の型とそのパラメータは <a href="https://github.com/sveltejs/kit/blob/master/packages/kit/types/index.d.ts">types/index.d.ts</a> にて利用可能です。<p><code>adapt</code> メソッドの中で、adapter が行うべきことがいくつかあります:<ul><li>build ディレクトリの掃除<li>SvelteKit の出力を <code>builder.writeClient</code>、<code>builder.writeServer</code>、<code>builder.writePrerendered</code> で書き出す<li>これらのコードを出力する:<ul><li><code>${builder.getServerDirectory()}/index.js</code> から <code>Server</code> をインポートする<li><code>builder.generateManifest({ relativePath })</code> で生成された manifest でアプリをインスタンス化する<li>必要に応じて、プラットフォームからのリクエストをリスン(Listen)しそのリクエストを標準の <a href="https://developer.mozilla.org/ja/docs/Web/API/Request">Request</a> に変換し、<code>server.respond(request, { getClientAddress })</code> 関数を呼び出して <a href="https://developer.mozilla.org/ja/docs/Web/API/Response">Response</a> を生成して応答する<li><code>server.respond</code> に渡される <code>platform</code> オプションを使用してプラットフォーム固有の情報を SvelteKit に公開する<li>必要に応じて、ターゲットのプラットフォームで動作するよう <code>fetch</code> をグローバルにシム(shim)する。SvelteKit は、プラットフォームが <code>node-fetch</code> を使用できるようにするための <code>@sveltejs/kit/install-fetch</code> ヘルパーを提供しています</ul><li>必要に応じて、ターゲットのプラットフォームで依存関係(dependencies)をインストールするのを避けるため、出力をバンドルする<li>ユーザーの静的ファイルと生成された JS/CSS をターゲットのプラットフォームにとって適切な場所に配置する</ul><p>可能であれば、adapter の出力は <code>build/</code> ディレクトリに置き、中間出力は <code>.svelte-kit/[adapter-name]</code> に置くことをおすすめします。 <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section>