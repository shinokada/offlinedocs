<!doctypehtml><html lang="en"><meta charset="utf-8"><title>How do I fix the error I'm getting trying to include a package?</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="how-do-i-fix-the-error-im-getting-trying-to-include-a-package"class="level1"><h1>How do I fix the error I'm getting trying to include a package?</h1><p>Vite's SSR support has become fairly stable since Vite 2.7. Most issues related to including a library are due to incorrect packaging.<p>Libraries work best with Vite when they distribute an ESM version and you may wish to suggest this to library authors. Here are a few things to keep in mind when checking if a library is packaged correctly:<ul><li><code>exports</code> takes precedence over the other entry point fields such as <code>main</code> and <code>module</code>. Adding an <code>exports</code> field may not be backwards-compatible as it prevents deep imports.<li>ESM files should end with <code>.mjs</code> unless <code>"type": "module"</code> is set in which any case CommonJS files should end with <code>.cjs</code>.<li><code>main</code> should be defined if <code>exports</code> is not. It should be either a CommonJS or ESM file and adhere to the previous bullet. If a <code>module</code> field is defined, it should refer to an ESM file.<li>Svelte components should be distributed entirely as ESM and have a <code>svelte</code> field defining the entry point.</ul><p>It is encouraged to make sure the dependencies of external Svelte components provide an ESM version. However, in order to handle CommonJS dependencies <a href="https://github.com/sveltejs/vite-plugin-svelte/blob/main/docs/faq.md#what-is-going-on-with-vite-and-pre-bundling-dependencies"><code>vite-plugin-svelte</code> will look for any CJS dependencies of external Svelte components</a> and ask Vite to pre-bundle them by automatically adding them to Vite's <code>optimizeDeps.include</code> which will use <code>esbuild</code> to convert them to ESM. A side effect of this approach is that it takes longer to load the initial page. If this becomes noticable, try setting <a href="https://github.com/sveltejs/vite-plugin-svelte/blob/main/docs/config.md#prebundlesveltelibraries">experimental.prebundleSvelteLibraries: true</a> in <code>svelte.config.js</code>. Note that this option is experimental.<p>If you are still encountering issues we recommend checking <a href="https://github.com/sveltejs/kit/issues/2086">the list of known Vite issues most commonly affecting SvelteKit users</a> and searching both <a href="https://github.com/vitejs/vite/issues">the Vite issue tracker</a> and the issue tracker of the library in question. Sometimes issues can be worked around by fiddling with the <a href="https://vitejs.dev/config/#dep-optimization-options"><code>optimizeDeps</code></a> or <a href="https://vitejs.dev/config/#ssr-options"><code>ssr</code></a> config values. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section>