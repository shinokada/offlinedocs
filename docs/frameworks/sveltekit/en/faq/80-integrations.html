<!doctype html><html lang="en"><meta charset="utf-8"><title>How do I use X with SvelteKit?</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../Vivliostyle/read-html-download-pdf/docs/themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="how-do-i-use-x-with-sveltekit"><h1 id="how-do-i-use-x-with-sveltekit">How do I use X with SvelteKit?</h1><p>Make sure you've read the <a href="docs/integrations">documentation section on integrations</a>. If you're still having trouble, solutions to common issues are listed below.<section class="level2"aria-labelledby="how-do-i-setup-a-database"><h2 id="how-do-i-setup-a-database">How do I setup a database?</h2><p>Put the code to query your database in a <a href="docs/routing#server">server route</a> - don't query the database in .svelte files. You can create a <code>db.js</code> or similar that sets up a connection immediately and makes the client accessible throughout the app as a singleton. You can execute any one-time setup code in <code>hooks.js</code> and import your database helpers into any endpoint that needs them.</section><section class="level2"aria-labelledby="how-do-i-use-a-client-side-only-library-that-depends-on-document-or-window"><h2 id="how-do-i-use-a-client-side-only-library-that-depends-on-document-or-window">How do I use a client-side only library that depends on <code>document</code> or <code>window</code>?</h2><p>If you need access to the <code>document</code> or <code>window</code> variables or otherwise need code to run only on the client-side you can wrap it in a <code>browser</code> check:<pre class="language-js"><code class="language-js"><span class="token comment">/// &#x3C;reference types="@sveltejs/kit" /></span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> browser <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'$app/environment'</span><span class="token punctuation">;</span>

<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>browser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// client-only code here</span>
<span class="token punctuation">}</span></code></pre><p>You can also run code in <code>onMount</code> if you'd like to run it after the component has been first rendered to the DOM:<pre class="language-js"><code class="language-js"><span class="token comment">// @filename: ambient.d.ts</span>
<span class="token comment">// @lib: ES2015</span>
declare module <span class="token string">'some-browser-only-library'</span><span class="token punctuation">;</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> onMount <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'svelte'</span><span class="token punctuation">;</span>

<span class="token function">onMount</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> method <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'some-browser-only-library'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>If the library you'd like to use is side-effect free you can also statically import it and it will be tree-shaken out in the server-side build where <code>onMount</code> will be automatically replaced with a no-op:<pre class="language-js"><code class="language-js"><span class="token comment">// @filename: ambient.d.ts</span>
<span class="token comment">// @lib: ES2015</span>
declare module <span class="token string">'some-browser-only-library'</span><span class="token punctuation">;</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> onMount <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'svelte'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> method <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'some-browser-only-library'</span><span class="token punctuation">;</span>

<span class="token function">onMount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
	<span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Otherwise, if the library has side effects and you'd still prefer to use static imports, check out <a href="https://github.com/bluwy/vite-plugin-iso-import">vite-plugin-iso-import</a> to support the <code>?client</code> import suffix. The import will be stripped out in SSR builds. However, note that you will lose the ability to use VS Code Intellisense if you use this method.<pre class="language-js"><code class="language-js"><span class="token comment">// @filename: ambient.d.ts</span>
<span class="token comment">// @lib: ES2015</span>
declare module <span class="token string">'some-browser-only-library?client'</span><span class="token punctuation">;</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> onMount <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'svelte'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> method <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'some-browser-only-library?client'</span><span class="token punctuation">;</span>

<span class="token function">onMount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
	<span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section class="level2"aria-labelledby="how-do-i-use-a-different-backend-api-server"><h2 id="how-do-i-use-a-different-backend-api-server">How do I use a different backend API server?</h2><p>You can use <a href="docs/load#making-fetch-requests"><code>event.fetch</code></a> to request data from an external API server, but be aware that you would need to deal with <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">CORS</a>, which will result in complications such as generally requiring requests to be preflighted resulting in higher latency. Requests to a separate subdomain may also increase latency due to an additional DNS lookup, TLS setup, etc. If you wish to use this method, you may find <a href="docs/hooks#server-hooks-handlefetch"><code>handleFetch</code></a> helpful.<p>Another approach is to set up a proxy to bypass CORS headaches. In production, you would rewrite a path like <code>/api</code> to the API server; for local development, use Vite's <a href="https://vitejs.dev/config/server-options.html#server-proxy"><code>server.proxy</code></a> option.<p>How to setup rewrites in production will depend on your deployment platform. If rewrites aren't an option, you could alternatively add an <a href="https://kit.svelte.dev../20-core-concepts/10-routing.html#server">API route</a>:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/api/[...path]/+server.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>RequestHandler<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params<span class="token punctuation">,</span> url <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://my-api-server.com/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span><span class="token property-access">path</span> <span class="token operator">+</span> url<span class="token punctuation">.</span><span class="token property-access">search</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>(Note that you may also need to proxy <code>POST</code>/<code>PATCH</code> etc requests, and forward <code>request.headers</code>, depending on your needs.)</section><section class="level2"aria-labelledby="how-do-i-use-middleware"><h2 id="how-do-i-use-middleware">How do I use middleware?</h2><p><code>adapter-node</code> builds a middleware that you can use with your own server for production mode. In dev, you can add middleware to Vite by using a Vite plugin. For example:<pre class="language-js"><code class="language-js"><span class="token comment">// @filename: ambient.d.ts</span>
declare module <span class="token string">'@sveltejs/kit/vite'</span><span class="token punctuation">;</span> <span class="token comment">// TODO this feels unnecessary, why can't it 'see' the declarations?</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> sveltekit <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/kit/vite'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'vite'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Plugin<span class="token punctuation">}</span></span> */</span>
<span class="token keyword">const</span> myPlugin <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'log-request-middleware'</span><span class="token punctuation">,</span>
	<span class="token function">configureServer</span><span class="token punctuation">(</span><span class="token parameter">server</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		server<span class="token punctuation">.</span><span class="token property-access">middlewares</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
			<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Got request </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span><span class="token property-access">url</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'vite'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>UserConfig<span class="token punctuation">}</span></span> */</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>myPlugin<span class="token punctuation">,</span> <span class="token function">sveltekit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> config<span class="token punctuation">;</span></code></pre><p>See <a href="https://vitejs.dev/guide/api-plugin.html#configureserver">Vite's <code>configureServer</code> docs</a> for more details including how to control ordering.</section><section class="level2"aria-labelledby="does-it-work-with-yarn-2"><h2 id="does-it-work-with-yarn-2">Does it work with Yarn 2?</h2><p>Sort of. The Plug'n'Play feature, aka 'pnp', is broken (it deviates from the Node module resolution algorithm, and <a href="https://github.com/yarnpkg/berry/issues/638">doesn't yet work with native JavaScript modules</a> which SvelteKit — along with an <a href="https://blog.sindresorhus.com/get-ready-for-esm-aa53530b3f77">increasing number of packages</a> — uses). You can use <code>nodeLinker: 'node-modules'</code> in your <a href="https://yarnpkg.com/configuration/yarnrc#nodeLinker"><code>.yarnrc.yml</code></a> file to disable pnp, but it's probably easier to just use npm or <a href="https://pnpm.io/">pnpm</a>, which is similarly fast and efficient but without the compatibility headaches.</section><section class="level2"aria-labelledby="how-do-i-use-with-yarn-3"><h2 id="how-do-i-use-with-yarn-3">How do I use with Yarn 3?</h2><p>Currently ESM Support within the latest Yarn (version 3) is considered <a href="https://github.com/yarnpkg/berry/pull/2161">experimental</a>.<p>The below seems to work although your results may vary.<p>First create a new application:<pre class="language-sh"><code class="language-sh">yarn create svelte myapp
cd myapp</code></pre><p>And enable Yarn Berry:<pre class="language-sh"><code class="language-sh">yarn set version berry
yarn install</code></pre><p><strong>Yarn 3 global cache</strong><p>One of the more interesting features of Yarn Berry is the ability to have a single global cache for packages, instead of having multiple copies for each project on the disk. However, setting <code>enableGlobalCache</code> to true causes building to fail, so it is recommended to add the following to the <code>.yarnrc.yml</code> file:<pre class="language-text"><code class="language-text">nodeLinker: node-modules</code></pre><p>This will cause packages to be downloaded into a local node_modules directory but avoids the above problem and is your best bet for using version 3 of Yarn at this point in time. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>