<!doctype html><html lang="en"><meta charset="utf-8"><title>Loading data</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="loading-data"class="level1"><h1>Loading data</h1><p>Before a <a href="../20-core-concepts/10-routing.html#page-page-svelte"><code>+page.svelte</code></a> component (and its containing <a href="../20-core-concepts/10-routing.html#layout-layout-svelte"><code>+layout.svelte</code></a> components) can be rendered, we often need to get some data. This is done by defining <code>load</code> functions.<section id="page-data"class="level2"><h2>Page data</h2><p>A <code>+page.svelte</code> file can have a sibling <code>+page.js</code> (or <code>+page.ts</code>) that exports a <code>load</code> function, the return value of which is available to the page via the <code>data</code> prop:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/blog/[slug]/+page.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">post</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			# <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Title for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span><span class="token property-access">slug</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> goes here</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
			<span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Content for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span><span class="token property-access">slug</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> goes here</span><span class="token template-punctuation string">`</span></span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-svelte"><code class="language-svelte">/// file: src/routes/blog/[slug]/+page.svelte
&#x3C;script>
	/** @type {import('./$types').PageData} */
	export let data;
&#x3C;/script>

&#x3C;h1>{data.post.title}&#x3C;/h1>
&#x3C;div>{@html data.post.content}&#x3C;/div></code></pre><p>Thanks to the generated <code>$types</code> module, we get full type safety.<p>A <code>load</code> function in a <code>+page.js</code> file runs both on the server and in the browser. If your <code>load</code> function should <em>always</em> run on the server (because it uses private environment variables, for example, or accesses a database) then you can put it in a <code>+page.server.js</code> instead.<p>A more realistic version of your blog post's <code>load</code> function, that only runs on the server and pulls data from a database, might look like this:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/blog/[slug]/+page.server.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare module <span class="token string">'$lib/server/database'</span> <span class="token punctuation">{</span>
	<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getPost</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">slug</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> # string<span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> db</span> <span class="token keyword module">from</span> <span class="token string">'$lib/server/database'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">post</span><span class="token operator">:</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">getPost</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token property-access">slug</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Notice that the type changed from <code>PageLoad</code> to <code>PageServerLoad</code>, because server-only <code>load</code> functions can access additional arguments. To understand when to use <code>+page.js</code> and when to use <code>+page.server.js</code>, see <a href="../20-core-concepts/20-load.html#shared-vs-server">Shared vs server</a>.</section><section id="layout-data"class="level2"><h2>Layout data</h2><p>Your <code>+layout.svelte</code> files can also load data, via <code>+layout.js</code> or <code>+layout.server.js</code>.<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/blog/[slug]/+layout.server.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare module <span class="token string">'$lib/server/database'</span> <span class="token punctuation">{</span>
	<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getPostSummaries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token known-class-name class-name">Array</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> # string<span class="token punctuation">,</span> <span class="token literal-property property">slug</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token operator">>></span>
<span class="token punctuation">}</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> db</span> <span class="token keyword module">from</span> <span class="token string">'$lib/server/database'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">posts</span><span class="token operator">:</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">getPostSummaries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-svelte"><code class="language-svelte">/// file: src/routes/blog/[slug]/+layout.svelte
&#x3C;script>
	/** @type {import('./$types').LayoutData} */
	export let data;
&#x3C;/script>

&#x3C;main>
	&#x3C;!-- +page.svelte is rendered here -->
	&#x3C;slot />
&#x3C;/main>

&#x3C;aside>
	&#x3C;h2>More posts&#x3C;/h2>
	&#x3C;ul>
		{#each data.posts as post}
			&#x3C;li>
				&#x3C;a href="/blog/{post.slug}">
					{post.title}
				&#x3C;/a>
			&#x3C;/li>
		{/each}
	&#x3C;/ul>
&#x3C;/aside></code></pre><p>Data returned from layout <code>load</code> functions is available to child <code>+layout.svelte</code> components and the <code>+page.svelte</code> component as well as the layout that it 'belongs' to.<pre class="language-diff"><code class="language-diff">/// file: src/routes/blog/[slug]/+page.svelte
<span class="token deleted-arrow deleted"><span class="token prefix deleted">&#x3C;</span><span class="token line">script>
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">	import { page } from '$app/stores';
</span></span>
	/** @type {import('./$types').PageData} */
	export let data;

<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">	// we can access `data.posts` because it's returned from
</span><span class="token prefix inserted">+</span><span class="token line">	// the parent layout `load` function
</span><span class="token prefix inserted">+</span><span class="token line">	$: index = data.posts.findIndex(post => post.slug === $page.params.slug);
</span><span class="token prefix inserted">+</span><span class="token line">	$: next = data.posts[index - 1];
</span></span><span class="token deleted-arrow deleted"><span class="token prefix deleted">&#x3C;</span><span class="token line">/script>
</span></span>
<span class="token deleted-arrow deleted"><span class="token prefix deleted">&#x3C;</span><span class="token line">h1>{data.post.title}&#x3C;/h1>
</span><span class="token prefix deleted">&#x3C;</span><span class="token line">div>{@html data.post.content}&#x3C;/div>
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">{#if next}
</span><span class="token prefix inserted">+</span><span class="token line">	&#x3C;p>Next post: &#x3C;a href="/blog/{next.slug}">{next.title}&#x3C;/a>&#x3C;/p>
</span><span class="token prefix inserted">+</span><span class="token line">{/if}</span></span></code></pre><blockquote><p>If multiple <code>load</code> functions return data with the same key, the last one 'wins' — the result of a layout <code>load</code> returning <code>{ a: 1, b: 2 }</code> and a page <code>load</code> returning <code>{ b: 3, c: 4 }</code> would be <code>{ a: 1, b: 3, c: 4 }</code>.</blockquote></section><section id="pagedata"class="level2"><h2>$page.data</h2><p>The <code>+page.svelte</code> component, and each <code>+layout.svelte</code> component above it, has access to its own data plus all the data from its parents.<p>In some cases, we might need the opposite — a parent layout might need to access page data or data from a child layout. For example, the root layout might want to access a <code>title</code> property returned from a <code>load</code> function in <code>+page.js</code> or <code>+page.server.js</code>. This can be done with <code>$page.data</code>:<pre class="language-svelte"><code class="language-svelte">/// file: src/routes/+layout.svelte
&#x3C;script>
	import { page } from '$app/stores';
&#x3C;/script>

&#x3C;svelte:head>
	&#x3C;title>{$page.data.title}&#x3C;/title>
&#x3C;/svelte:head></code></pre><p>Type information for <code>$page.data</code> is provided by <code>App.PageData</code>.</section><section id="shared-vs-server"class="level2"><h2>Shared vs server</h2><p>As we've seen, there are two types of <code>load</code> function:<ul><li><code>+page.js</code> and <code>+layout.js</code> files export <code>load</code> functions that are <em>shared</em> between server and browser<li><code>+page.server.js</code> and <code>+layout.server.js</code> files export <code>load</code> functions that are <em>server-only</em></ul><p>Conceptually, they're the same thing, but there are some important differences to be aware of.</section><section id="input"class="level2"><h2>Input</h2><p>Both shared and server-only <code>load</code> functions have access to properties describing the request (<code>params</code>, <code>route</code> and <code>url</code>) and various functions (<code>depends</code>, <code>fetch</code> and <code>parent</code>). These are described in the following sections.<p>Server-only <code>load</code> functions are called with a <code>ServerLoadEvent</code>, which inherits <code>clientAddress</code>, <code>cookies</code>, <code>locals</code>, <code>platform</code> and <code>request</code> from <code>RequestEvent</code>.<p>Shared <code>load</code> functions are called with a <code>LoadEvent</code>, which has a <code>data</code> property. If you have <code>load</code> functions in both <code>+page.js</code> and <code>+page.server.js</code> (or <code>+layout.js</code> and <code>+layout.server.js</code>), the return value of the server-only <code>load</code> function is the <code>data</code> property of the shared <code>load</code> function's argument.</section><section id="output"class="level2"><h2>Output</h2><p>A shared <code>load</code> function can return an object containing any values, including things like custom classes and component constructors.<p>A server-only <code>load</code> function must return data that can be serialized with <a href="https://github.com/rich-harris/devalue">devalue</a> — anything that can be represented as JSON plus things like <code>BigInt</code>, <code>Date</code>, <code>Map</code>, <code>Set</code> and <code>RegExp</code>, or repeated/cyclical references — so that it can be transported over the network.</section><section id="when-to-use-which"class="level2"><h2>When to use which</h2><p>Server-only <code>load</code> functions are convenient when you need to access data directly from a database or filesystem, or need to use private environment variables.<p>Shared <code>load</code> functions are useful when you need to <code>fetch</code> data from an external API and don't need private credentials, since SvelteKit can get the data directly from the API rather than going via your server. They are also useful when you need to return something that can't be serialized, such as a Svelte component constructor.<p>In rare cases, you might need to use both together — for example, you might need to return an instance of a custom class that was initialised with data from your server.</section><section id="using-url-data"class="level2"><h2>Using URL data</h2><p>Often the <code>load</code> function depends on the URL in one way or another. For this, the <code>load</code> function provides you with <code>url</code>, <code>route</code> and <code>params</code>.</section><section id="url"class="level2"><h2>url</h2><p>An instance of <a href="https://developer.mozilla.org/en-US/docs/Web/API/URL"><code>URL</code></a>, containing properties like the <code>origin</code>, <code>hostname</code>, <code>pathname</code> and <code>searchParams</code> (which contains the parsed query string as a <a href="https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams"><code>URLSearchParams</code></a> object). <code>url.hash</code> cannot be accessed during <code>load</code>, since it is unavailable on the server.<blockquote><p>In some environments this is derived from request headers during server-side rendering. If you're using <a href="../20-core-concepts/50-adapters.html#supported-environments-node-js">adapter-node</a>, for example, you may need to configure the adapter in order for the URL to be correct.</blockquote></section><section id="route"class="level2"><h2>route</h2><p>Contains the name of the current route directory, relative to <code>src/routes</code>:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/a/[b]/[...c]/+page.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> route <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '/a/[b]/[...c]'</span>
<span class="token punctuation">}</span></code></pre></section><section id="params"class="level2"><h2>params</h2><p><code>params</code> is derived from <code>url.pathname</code> and <code>route.id</code>.<p>Given a <code>route.id</code> of <code>/a/[b]/[...c]</code> and a <code>url.pathname</code> of <code>/a/x/y/z</code>, the <code>params</code> object would look like this:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
	<span class="token property">"b"</span><span class="token operator">:</span> <span class="token string">"x"</span><span class="token punctuation">,</span>
	<span class="token property">"c"</span><span class="token operator">:</span> <span class="token string">"y/z"</span>
<span class="token punctuation">}</span></code></pre></section><section id="making-fetch-requests"class="level2"><h2>Making fetch requests</h2><p>To get data from an external API or a <code>+server.js</code> handler, you can use the provided <code>fetch</code> function, which behaves identically to the <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch">native <code>fetch</code> web API</a> with a few additional features:<ul><li>it can be used to make credentialed requests on the server, as it inherits the <code>cookie</code> and <code>authorization</code> headers for the page request<li>it can make relative requests on the server (ordinarily, <code>fetch</code> requires a URL with an origin when used in a server context)<li>internal requests (e.g. for <code>+server.js</code> routes) go direct to the handler function when running on the server, without the overhead of an HTTP call<li>during server-side rendering, the response will be captured and inlined into the rendered HTML. Note that headers will <em>not</em> be serialized, unless explicitly included via <a href="../30-advanced/20-hooks.html#server-hooks-handle"><code>filterSerializedResponseHeaders</code></a>. Then, during hydration, the response will be read from the HTML, guaranteeing consistency and preventing an additional network request - if you got a warning in your browser console when using the browser <code>fetch</code> instead of the <code>load</code> <code>fetch</code>, this is why.</ul><pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/items/[id]/+page.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> fetch<span class="token punctuation">,</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/items/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> item <span class="token operator">=</span> <span class="token keyword control-flow">await</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>Cookies will only be passed through if the target host is the same as the SvelteKit application or a more specific subdomain of it.</blockquote></section><section id="cookies-and-headers"class="level2"><h2>Cookies and headers</h2><p>A server-only <code>load</code> function can get and set <a href="../50-api-reference/40-types.html#public-types-cookies"><code>cookies</code></a>.<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/+layout.server.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare module <span class="token string">'$lib/server/database'</span> <span class="token punctuation">{</span>
	<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">sessionid</span><span class="token operator">:</span> string <span class="token operator">|</span> <span class="token keyword nil">undefined</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">avatar</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> db</span> <span class="token keyword module">from</span> <span class="token string">'$lib/server/database'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> cookies <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> sessionid <span class="token operator">=</span> cookies<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'sessionid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">getUser</span><span class="token punctuation">(</span>sessionid<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>When setting cookies, be aware of the <code>path</code> property. By default, the <code>path</code> of a cookie is the current pathname. If you for example set a cookie at page <code>admin/user</code>, the cookie will only be available within the <code>admin</code> pages by default. In most cases you likely want to set <code>path</code> to <code>'/'</code> to make the cookie available throughout your app.</blockquote><p>Both server-only and shared <code>load</code> functions have access to a <code>setHeaders</code> function that, when running on the server, can set headers for the response. (When running in the browser, <code>setHeaders</code> has no effect.) This is useful if you want the page to be cached, for example:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2322 1360</span>
<span class="token comment">/// file: src/routes/products/+page.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> fetch<span class="token punctuation">,</span> setHeaders <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://cms.example.com/products.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// cache the page for the same length of time</span>
	<span class="token comment">// as the underlying data</span>
	<span class="token function">setHeaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token literal-property property">age</span><span class="token operator">:</span> response<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string-property property">'cache-control'</span><span class="token operator">:</span> response<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'cache-control'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword control-flow">return</span> response<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Setting the same header multiple times (even in separate <code>load</code> functions) is an error — you can only set a given header once. You cannot add a <code>set-cookie</code> header with <code>setHeaders</code> — use <code>cookies.set(name, value, options)</code> instead.</section><section id="using-parent-data"class="level2"><h2>Using parent data</h2><p>Occasionally it's useful for a <code>load</code> function to access data from a parent <code>load</code> function, which can be done with <code>await parent()</code>:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/+layout.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/abc/+layout.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> parent <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">b</span><span class="token operator">:</span> a <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/abc/+page.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> parent <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> a<span class="token punctuation">,</span> b <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">c</span><span class="token operator">:</span> a <span class="token operator">+</span> b <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-svelte"><code class="language-svelte">&#x3C;script>
	/** @type {import('./$types').PageData} */
	export let data;
&#x3C;/script>

&#x3C;!-- renders `1 + 2 = 3` -->
&#x3C;p>{data.a} + {data.b} = {data.c}&#x3C;/p></code></pre><blockquote><p>Notice that the <code>load</code> function in <code>+page.js</code> receives the merged data from both layout <code>load</code> functions, not just the immediate parent.</blockquote><p>Inside <code>+page.server.js</code> and <code>+layout.server.js</code>, <code>parent</code> returns data from parent <code>+layout.server.js</code> files.<p>In <code>+page.js</code> or <code>+layout.js</code> it will return data from parent <code>+layout.js</code> files. However, a missing <code>+layout.js</code> is treated as a <code>({ data }) => data</code> function, meaning that it will also return data from parent <code>+layout.server.js</code> files that are not 'shadowed' by a <code>+layout.js</code> file<p>Take care not to introduce waterfalls when using <code>await parent()</code>. Here, for example, <code>getData(params)</code> does not depend on the result of calling <code>parent()</code>, so we should call it first to avoid a delayed render.<pre class="language-diff"><code class="language-diff">/// file: +page.js
/** @type {import('./$types').PageLoad} */
export async function load({ params, parent }) {
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">	const parentData = await parent();
</span></span>	const data = await getData(params);
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">	const parentData = await parent();
</span></span>
	return {
		...data
		meta: { ...parentData.meta, ...data.meta }
	};
}</code></pre></section><section id="errors"class="level2"><h2>Errors</h2><p>If an error is thrown during <code>load</code>, the nearest <a href="../20-core-concepts/10-routing.html#error"><code>+error.svelte</code></a> will be rendered. For <em>expected</em> errors, use the <code>error</code> helper from <code>@sveltejs/kit</code> to specify the HTTP status code and an optional message:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/admin/+layout.server.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare namespace <span class="token maybe-class-name">App</span> <span class="token punctuation">{</span>
	<span class="token keyword">interface</span> <span class="token class-name">Locals</span> <span class="token punctuation">{</span>
		user<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
			<span class="token literal-property property">isAdmin</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> error <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/kit'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> locals <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>locals<span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword control-flow">throw</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">,</span> <span class="token string">'not logged in'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>locals<span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token property-access">isAdmin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword control-flow">throw</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">,</span> <span class="token string">'not an admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>If an <em>unexpected</em> error is thrown, SvelteKit will invoke <a href="../30-advanced/20-hooks.html#shared-hooks-handleerror"><code>handleError</code></a> and treat it as a 500 Internal Error.</section><section id="redirects"class="level2"><h2>Redirects</h2><p>To redirect users, use the <code>redirect</code> helper from <code>@sveltejs/kit</code> to specify the location to which they should be redirected alongside a <code>3xx</code> status code.<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/user/+layout.server.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare namespace <span class="token maybe-class-name">App</span> <span class="token punctuation">{</span>
	<span class="token keyword">interface</span> <span class="token class-name">Locals</span> <span class="token punctuation">{</span>
		user<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> redirect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/kit'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> locals <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>locals<span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword control-flow">throw</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token number">307</span><span class="token punctuation">,</span> <span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></section><section id="promise-unwrapping"class="level2"><h2>Promise unwrapping</h2><p>Top-level promises will be awaited, which makes it easy to return multiple promises without creating a waterfall:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/+page.server.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-svelte"><code class="language-svelte">&#x3C;script>
	/** @type {import('./$types').PageData} */
	export let data;

	console.log(data.a); // 'a'
	console.log(data.b); // 'b'
	console.log(data.c.value); // `Promise {...}`
&#x3C;/script></code></pre></section><section id="parallel-loading"class="level2"><h2>Parallel loading</h2><p>When rendering (or navigating to) a page, SvelteKit runs all <code>load</code> functions concurrently, avoiding a waterfall of requests. During client-side navigation, the result of calling multiple server-only <code>load</code> functions are grouped into a single response. Once all <code>load</code> functions have returned, the page is rendered.</section><section id="invalidation"class="level2"><h2>Invalidation</h2><p>SvelteKit tracks the dependencies of each <code>load</code> function to avoid re-running it unnecessarily during navigation.<p>For example, given a pair of <code>load</code> functions like these...<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/blog/[slug]/+page.server.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare module <span class="token string">'$lib/server/database'</span> <span class="token punctuation">{</span>
	<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getPost</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">slug</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> # string<span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> db</span> <span class="token keyword module">from</span> <span class="token string">'$lib/server/database'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">post</span><span class="token operator">:</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">getPost</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token property-access">slug</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/blog/[slug]/+layout.server.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare module <span class="token string">'$lib/server/database'</span> <span class="token punctuation">{</span>
	<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getPostSummaries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token known-class-name class-name">Array</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> # string<span class="token punctuation">,</span> <span class="token literal-property property">slug</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token operator">>></span>
<span class="token punctuation">}</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> db</span> <span class="token keyword module">from</span> <span class="token string">'$lib/server/database'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">posts</span><span class="token operator">:</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">getPostSummaries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>...the one in <code>+page.server.js</code> will re-run if we navigate from <code>/blog/trying-the-raw-meat-diet</code> to <code>/blog/i-regret-my-choices</code> because <code>params.slug</code> has changed. The one in <code>+layout.server.js</code> will not, because the data is still valid. In other words, we won't call <code>db.getPostSummaries()</code> a second time.<p>A <code>load</code> function that calls <code>await parent()</code> will also re-run if a parent <code>load</code> function is re-run.</section><section id="manual-invalidation"class="level2"><h2>Manual invalidation</h2><p>You can also re-run <code>load</code> functions that apply to the current page using <a href="../50-api-reference/30-modules.html#$app-navigation-invalidate"><code>invalidate(url)</code></a>, which re-runs all <code>load</code> functions that depend on <code>url</code>, and <a href="../50-api-reference/30-modules.html#$app-navigation-invalidateall"><code>invalidateAll()</code></a>, which re-runs every <code>load</code> function.<p>A <code>load</code> function depends on <code>url</code> if it calls <code>fetch(url)</code> or <code>depends(url)</code>. Note that <code>url</code> can be a custom identifier that starts with <code>[a-z]:</code>:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/random-number/+page.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> fetch<span class="token punctuation">,</span> depends <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// load reruns when `invalidate('https://api.example.com/random-number')` is called...</span>
	<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/random-number'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// ...or when `invalidate('app:random')` is called</span>
	<span class="token function">depends</span><span class="token punctuation">(</span><span class="token string">'app:random'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token keyword control-flow">await</span> response<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-svelte"><code class="language-svelte">/// file: src/routes/random-number/+page.svelte
&#x3C;script>
	import { invalidateAll } from '$app/navigation';

	/** @type {import('./$types').PageData} */
	export let data;

	function rerunLoadFunction() {
		// any of these will cause the `load` function to re-run
		invalidate('app:random');
		invalidate('https://api.example.com/random-number');
		invalidate(url => url.href.includes('random-number'));
		invalidateAll();
	}
&#x3C;/script>

&#x3C;p>random number: {data.number}&#x3C;/p>
&#x3C;button on:click={rerunLoadFunction}>Update random number&#x3C;/button></code></pre><p>To summarize, a <code>load</code> function will re-run in the following situations:<ul><li>It references a property of <code>params</code> whose value has changed<li>It references a property of <code>url</code> (such as <code>url.pathname</code> or <code>url.search</code>) whose value has changed<li>It calls <code>await parent()</code> and a parent <code>load</code> function re-ran<li>It declared a dependency on a specific URL via <a href="#making-fetch-requests"><code>fetch</code></a> or <a href="../50-api-reference/40-types.html#public-types-loadevent"><code>depends</code></a>, and that URL was marked invalid with <a href="../50-api-reference/30-modules.html#$app-navigation-invalidate"><code>invalidate(url)</code></a><li>All active <code>load</code> functions were forcibly re-run with <a href="../50-api-reference/30-modules.html#$app-navigation-invalidateall"><code>invalidateAll()</code></a></ul><p>Note that re-running a <code>load</code> function will update the <code>data</code> prop inside the corresponding <code>+layout.svelte</code> or <code>+page.svelte</code>; it does <em>not</em> cause the component to be recreated. As a result, internal state is preserved. If this isn't what you want, you can reset whatever you need to reset inside an <a href="../50-api-reference/30-modules.html#$app-navigation-afternavigate"><code>afterNavigate</code></a> callback, and/or wrap your component in a <a href="https://svelte.dev/docs#template-syntax-key"><code>{#key ...}</code></a> block.</section><section id="shared-state"class="level2"><h2>Shared state</h2><p>In many server environments, a single instance of your app will serve multiple users. For that reason, per-request or per-user state must not be stored in shared variables outside your <code>load</code> functions, but should instead be stored in <code>event.locals</code>. <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section>