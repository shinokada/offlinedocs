<!doctype html><html lang="en"><meta charset="utf-8"><title>Loading data</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="loading-data"><h1 id="loading-data">Loading data</h1><p>Before a <a href="routing#page-page-svelte"><code>+page.svelte</code></a> component (and its containing <a href="routing#layout-layout-svelte"><code>+layout.svelte</code></a> components) can be rendered, we often need to get some data. This is done by defining <code>load</code> functions.<section class="level2"aria-labelledby="page-data"><h2 id="page-data">Page data</h2><p>A <code>+page.svelte</code> file can have a sibling <code>+page.js</code> that exports a <code>load</code> function, the return value of which is available to the page via the <code>data</code> prop:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/blog/[slug]/+page.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">post</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			# <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Title for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span><span class="token property-access">slug</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> goes here</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
			<span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Content for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span><span class="token property-access">slug</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> goes here</span><span class="token template-punctuation string">`</span></span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-svelte"><code class="language-svelte">&#x3C;! file: src/routes/blog/[slug]/+page.svelte --->
&#x3C;script>
	/** @type {import('./$types').PageData} */
	export let data;
&#x3C;/script>

&#x3C;h1>{data.post.title}&#x3C;/h1>
&#x3C;div>{@html data.post.content}&#x3C;/div></code></pre><p>Thanks to the generated <code>$types</code> module, we get full type safety.<p>A <code>load</code> function in a <code>+page.js</code> file runs both on the server and in the browser (unless combined with <code>export const ssr = false</code>, in which case it will <a href="https://kit.svelte.dev../20-core-concepts/40-page-options.html#ssr">only run in the browser</a>). If your <code>load</code> function should <em>always</em> run on the server (because it uses private environment variables, for example, or accesses a database) then it would go in a <code>+page.server.js</code> instead.<p>A more realistic version of your blog post's <code>load</code> function, that only runs on the server and pulls data from a database, might look like this:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/blog/[slug]/+page.server.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare module <span class="token string">'$lib/server/database'</span> <span class="token punctuation">{</span>
	<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getPost</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">slug</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> # string<span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> db</span> <span class="token keyword module">from</span> <span class="token string">'$lib/server/database'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">post</span><span class="token operator">:</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">getPost</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token property-access">slug</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Notice that the type changed from <code>PageLoad</code> to <code>PageServerLoad</code>, because server <code>load</code> functions can access additional arguments. To understand when to use <code>+page.js</code> and when to use <code>+page.server.js</code>, see <a href="load#universal-vs-server">Universal vs server</a>.</section><section class="level2"aria-labelledby="layout-data"><h2 id="layout-data">Layout data</h2><p>Your <code>+layout.svelte</code> files can also load data, via <code>+layout.js</code> or <code>+layout.server.js</code>.<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/blog/[slug]/+layout.server.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare module <span class="token string">'$lib/server/database'</span> <span class="token punctuation">{</span>
	<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getPostSummaries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token known-class-name class-name">Array</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> # string<span class="token punctuation">,</span> <span class="token literal-property property">slug</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token operator">>></span>
<span class="token punctuation">}</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> db</span> <span class="token keyword module">from</span> <span class="token string">'$lib/server/database'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">posts</span><span class="token operator">:</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">getPostSummaries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-svelte"><code class="language-svelte">&#x3C;! file: src/routes/blog/[slug]/+layout.svelte --->
&#x3C;script>
	/** @type {import('./$types').LayoutData} */
	export let data;
&#x3C;/script>

&#x3C;main>
	&#x3C;!-- +page.svelte is rendered in this &#x3C;slot> -->
	&#x3C;slot />
&#x3C;/main>

&#x3C;aside>
	&#x3C;h2>More posts&#x3C;/h2>
	&#x3C;ul>
		{#each data.posts as post}
			&#x3C;li>
				&#x3C;a href="/blog/{post.slug}">
					{post.title}
				&#x3C;/a>
			&#x3C;/li>
		{/each}
	&#x3C;/ul>
&#x3C;/aside></code></pre><p>Data returned from layout <code>load</code> functions is available to child <code>+layout.svelte</code> components and the <code>+page.svelte</code> component as well as the layout that it 'belongs' to.<pre class="language-diff"><code class="language-diff">/// file: src/routes/blog/[slug]/+page.svelte
<span class="token deleted-arrow deleted"><span class="token prefix deleted">&#x3C;</span><span class="token line">script>
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">	import { page } from '$app/stores';
</span></span>
	/** @type {import('./$types').PageData} */
	export let data;

<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">	// we can access `data.posts` because it's returned from
</span><span class="token prefix inserted">+</span><span class="token line">	// the parent layout `load` function
</span><span class="token prefix inserted">+</span><span class="token line">	$: index = data.posts.findIndex(post => post.slug === $page.params.slug);
</span><span class="token prefix inserted">+</span><span class="token line">	$: next = data.posts[index - 1];
</span></span><span class="token deleted-arrow deleted"><span class="token prefix deleted">&#x3C;</span><span class="token line">/script>
</span></span>
<span class="token deleted-arrow deleted"><span class="token prefix deleted">&#x3C;</span><span class="token line">h1>{data.post.title}&#x3C;/h1>
</span><span class="token prefix deleted">&#x3C;</span><span class="token line">div>{@html data.post.content}&#x3C;/div>
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">{#if next}
</span><span class="token prefix inserted">+</span><span class="token line">	&#x3C;p>Next post: &#x3C;a href="/blog/{next.slug}">{next.title}&#x3C;/a>&#x3C;/p>
</span><span class="token prefix inserted">+</span><span class="token line">{/if}</span></span></code></pre><blockquote><p>If multiple <code>load</code> functions return data with the same key, the last one 'wins' — the result of a layout <code>load</code> returning <code>{ a: 1, b: 2 }</code> and a page <code>load</code> returning <code>{ b: 3, c: 4 }</code> would be <code>{ a: 1, b: 3, c: 4 }</code>.</blockquote></section><section class="level2"aria-labelledby="pagedata"><h2 id="pagedata">$page.data</h2><p>The <code>+page.svelte</code> component, and each <code>+layout.svelte</code> component above it, has access to its own data plus all the data from its parents.<p>In some cases, we might need the opposite — a parent layout might need to access page data or data from a child layout. For example, the root layout might want to access a <code>title</code> property returned from a <code>load</code> function in <code>+page.js</code> or <code>+page.server.js</code>. This can be done with <code>$page.data</code>:<pre class="language-svelte"><code class="language-svelte">&#x3C;! file: src/routes/+layout.svelte --->
&#x3C;script>
	import { page } from '$app/stores';
&#x3C;/script>

&#x3C;svelte:head>
	&#x3C;title>{$page.data.title}&#x3C;/title>
&#x3C;/svelte:head></code></pre><p>Type information for <code>$page.data</code> is provided by <code>App.PageData</code>.</section><section class="level2"aria-labelledby="universal-vs-server"><h2 id="universal-vs-server">Universal vs server</h2><p>As we've seen, there are two types of <code>load</code> function:<ul><li><code>+page.js</code> and <code>+layout.js</code> files export <em>universal</em> <code>load</code> functions that run both on the server and in the browser<li><code>+page.server.js</code> and <code>+layout.server.js</code> files export <em>server</em> <code>load</code> functions that only run server-side</ul><p>Conceptually, they're the same thing, but there are some important differences to be aware of.</section><section class="level2"aria-labelledby="when-does-which-load-function-run"><h2 id="when-does-which-load-function-run">When does which load function run?</h2><p>Server <code>load</code> functions <em>always</em> run on the server.<p>By default, universal <code>load</code> functions run on the server during SSR when the user first visits your page. They will then run again during hydration, reusing any responses from <a href="#making-fetch-requests">fetch requests</a>. All subsequent invocations of universal <code>load</code> functions happen in the browser. You can customize the behavior through <a href="page-options">page options</a>. If you disable <a href="page-options#ssr">server side rendering</a>, you'll get an SPA and universal <code>load</code> functions <em>always</em> run on the client.<p>A <code>load</code> function is invoked at runtime, unless you <a href="page-options#prerender">prerender</a> the page — in that case, it's invoked at build time.</section><section class="level2"aria-labelledby="input"><h2 id="input">Input</h2><p>Both universal and server <code>load</code> functions have access to properties describing the request (<code>params</code>, <code>route</code> and <code>url</code>) and various functions (<code>fetch</code>, <code>setHeaders</code>, <code>parent</code>, <code>depends</code> and <code>untrack</code>). These are described in the following sections.<p>Server <code>load</code> functions are called with a <code>ServerLoadEvent</code>, which inherits <code>clientAddress</code>, <code>cookies</code>, <code>locals</code>, <code>platform</code> and <code>request</code> from <code>RequestEvent</code>.<p>Universal <code>load</code> functions are called with a <code>LoadEvent</code>, which has a <code>data</code> property. If you have <code>load</code> functions in both <code>+page.js</code> and <code>+page.server.js</code> (or <code>+layout.js</code> and <code>+layout.server.js</code>), the return value of the server <code>load</code> function is the <code>data</code> property of the universal <code>load</code> function's argument.</section><section class="level2"aria-labelledby="output"><h2 id="output">Output</h2><p>A universal <code>load</code> function can return an object containing any values, including things like custom classes and component constructors.<p>A server <code>load</code> function must return data that can be serialized with <a href="https://github.com/rich-harris/devalue">devalue</a> — anything that can be represented as JSON plus things like <code>BigInt</code>, <code>Date</code>, <code>Map</code>, <code>Set</code> and <code>RegExp</code>, or repeated/cyclical references — so that it can be transported over the network. Your data can include <a href="#streaming-with-promises">promises</a>, in which case it will be streamed to browsers.</section><section class="level2"aria-labelledby="when-to-use-which"><h2 id="when-to-use-which">When to use which</h2><p>Server <code>load</code> functions are convenient when you need to access data directly from a database or filesystem, or need to use private environment variables.<p>Universal <code>load</code> functions are useful when you need to <code>fetch</code> data from an external API and don't need private credentials, since SvelteKit can get the data directly from the API rather than going via your server. They are also useful when you need to return something that can't be serialized, such as a Svelte component constructor.<p>In rare cases, you might need to use both together — for example, you might need to return an instance of a custom class that was initialised with data from your server.</section><section class="level2"aria-labelledby="using-url-data"><h2 id="using-url-data">Using URL data</h2><p>Often the <code>load</code> function depends on the URL in one way or another. For this, the <code>load</code> function provides you with <code>url</code>, <code>route</code> and <code>params</code>.</section><section class="level2"aria-labelledby="url"><h2 id="url">url</h2><p>An instance of <a href="https://developer.mozilla.org/en-US/docs/Web/API/URL"><code>URL</code></a>, containing properties like the <code>origin</code>, <code>hostname</code>, <code>pathname</code> and <code>searchParams</code> (which contains the parsed query string as a <a href="https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams"><code>URLSearchParams</code></a> object). <code>url.hash</code> cannot be accessed during <code>load</code>, since it is unavailable on the server.<blockquote><p>In some environments this is derived from request headers during server-side rendering. If you're using <a href="adapter-node">adapter-node</a>, for example, you may need to configure the adapter in order for the URL to be correct.</blockquote></section><section class="level2"aria-labelledby="route"><h2 id="route">route</h2><p>Contains the name of the current route directory, relative to <code>src/routes</code>:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/a/[b]/[...c]/+page.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> route <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '/a/[b]/[...c]'</span>
<span class="token punctuation">}</span></code></pre></section><section class="level2"aria-labelledby="params"><h2 id="params">params</h2><p><code>params</code> is derived from <code>url.pathname</code> and <code>route.id</code>.<p>Given a <code>route.id</code> of <code>/a/[b]/[...c]</code> and a <code>url.pathname</code> of <code>/a/x/y/z</code>, the <code>params</code> object would look like this:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
	<span class="token property">"b"</span><span class="token operator">:</span> <span class="token string">"x"</span><span class="token punctuation">,</span>
	<span class="token property">"c"</span><span class="token operator">:</span> <span class="token string">"y/z"</span>
<span class="token punctuation">}</span></code></pre></section><section class="level2"aria-labelledby="making-fetch-requests"><h2 id="making-fetch-requests">Making fetch requests</h2><p>To get data from an external API or a <code>+server.js</code> handler, you can use the provided <code>fetch</code> function, which behaves identically to the <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch">native <code>fetch</code> web API</a> with a few additional features:<ul><li>It can be used to make credentialed requests on the server, as it inherits the <code>cookie</code> and <code>authorization</code> headers for the page request.<li>It can make relative requests on the server (ordinarily, <code>fetch</code> requires a URL with an origin when used in a server context).<li>Internal requests (e.g. for <code>+server.js</code> routes) go directly to the handler function when running on the server, without the overhead of an HTTP call.<li>During server-side rendering, the response will be captured and inlined into the rendered HTML by hooking into the <code>text</code>, <code>json</code> and <code>arrayBuffer</code> methods of the <code>Response</code> object. Note that headers will <em>not</em> be serialized, unless explicitly included via <a href="hooks#server-hooks-handle"><code>filterSerializedResponseHeaders</code></a>.<li>During hydration, the response will be read from the HTML, guaranteeing consistency and preventing an additional network request - if you received a warning in your browser console when using the browser <code>fetch</code> instead of the <code>load</code> <code>fetch</code>, this is why.</ul><pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/items/[id]/+page.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> fetch<span class="token punctuation">,</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/items/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> item <span class="token operator">=</span> <span class="token keyword control-flow">await</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section><section class="level2"aria-labelledby="cookies"><h2 id="cookies">Cookies</h2><p>A server <code>load</code> function can get and set <a href="types#public-types-cookies"><code>cookies</code></a>.<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/+layout.server.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare module <span class="token string">'$lib/server/database'</span> <span class="token punctuation">{</span>
	<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">sessionid</span><span class="token operator">:</span> string <span class="token operator">|</span> <span class="token keyword nil">undefined</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">avatar</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> db</span> <span class="token keyword module">from</span> <span class="token string">'$lib/server/database'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> cookies <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> sessionid <span class="token operator">=</span> cookies<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'sessionid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">getUser</span><span class="token punctuation">(</span>sessionid<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Cookies will only be passed through the provided <code>fetch</code> function if the target host is the same as the SvelteKit application or a more specific subdomain of it.<p>For example, if SvelteKit is serving my.domain.com:<ul><li>domain.com WILL NOT receive cookies<li>my.domain.com WILL receive cookies<li>api.domain.com WILL NOT receive cookies<li>sub.my.domain.com WILL receive cookies</ul><p>Other cookies will not be passed when <code>credentials: 'include'</code> is set, because SvelteKit does not know which domain which cookie belongs to (the browser does not pass this information along), so it's not safe to forward any of them. Use the <a href="hooks#server-hooks-handlefetch">handleFetch hook</a> to work around it.</section><section class="level2"aria-labelledby="headers"><h2 id="headers">Headers</h2><p>Both server and universal <code>load</code> functions have access to a <code>setHeaders</code> function that, when running on the server, can set headers for the response. (When running in the browser, <code>setHeaders</code> has no effect.) This is useful if you want the page to be cached, for example:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2322 1360</span>
<span class="token comment">/// file: src/routes/products/+page.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> fetch<span class="token punctuation">,</span> setHeaders <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://cms.example.com/products.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// cache the page for the same length of time</span>
	<span class="token comment">// as the underlying data</span>
	<span class="token function">setHeaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token literal-property property">age</span><span class="token operator">:</span> response<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string-property property">'cache-control'</span><span class="token operator">:</span> response<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'cache-control'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword control-flow">return</span> response<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Setting the same header multiple times (even in separate <code>load</code> functions) is an error — you can only set a given header once. You cannot add a <code>set-cookie</code> header with <code>setHeaders</code> — use <code>cookies.set(name, value, options)</code> instead.</section><section class="level2"aria-labelledby="using-parent-data"><h2 id="using-parent-data">Using parent data</h2><p>Occasionally it's useful for a <code>load</code> function to access data from a parent <code>load</code> function, which can be done with <code>await parent()</code>:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/+layout.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/abc/+layout.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> parent <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">b</span><span class="token operator">:</span> a <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/abc/+page.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> parent <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> a<span class="token punctuation">,</span> b <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">c</span><span class="token operator">:</span> a <span class="token operator">+</span> b <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-svelte"><code class="language-svelte">&#x3C;! file: src/routes/abc/+page.svelte --->
&#x3C;script>
	/** @type {import('./$types').PageData} */
	export let data;
&#x3C;/script>

&#x3C;!-- renders `1 + 2 = 3` -->
&#x3C;p>{data.a} + {data.b} = {data.c}&#x3C;/p></code></pre><blockquote><p>Notice that the <code>load</code> function in <code>+page.js</code> receives the merged data from both layout <code>load</code> functions, not just the immediate parent.</blockquote><p>Inside <code>+page.server.js</code> and <code>+layout.server.js</code>, <code>parent</code> returns data from parent <code>+layout.server.js</code> files.<p>In <code>+page.js</code> or <code>+layout.js</code> it will return data from parent <code>+layout.js</code> files. However, a missing <code>+layout.js</code> is treated as a <code>({ data }) => data</code> function, meaning that it will also return data from parent <code>+layout.server.js</code> files that are not 'shadowed' by a <code>+layout.js</code> file<p>Take care not to introduce waterfalls when using <code>await parent()</code>. Here, for example, <code>getData(params)</code> does not depend on the result of calling <code>parent()</code>, so we should call it first to avoid a delayed render.<pre class="language-diff"><code class="language-diff">/// file: +page.js
/** @type {import('./$types').PageLoad} */
export async function load({ params, parent }) {
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">	const parentData = await parent();
</span></span>	const data = await getData(params);
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">	const parentData = await parent();
</span></span>
	return {
		...data
		meta: { ...parentData.meta, ...data.meta }
	};
}</code></pre></section><section class="level2"aria-labelledby="errors"><h2 id="errors">Errors</h2><p>If an error is thrown during <code>load</code>, the nearest <a href="routing#error"><code>+error.svelte</code></a> will be rendered. For <a href="/docs/errors#expected-errors"><em>expected</em></a> errors, use the <code>error</code> helper from <code>@sveltejs/kit</code> to specify the HTTP status code and an optional message:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/admin/+layout.server.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare namespace <span class="token maybe-class-name">App</span> <span class="token punctuation">{</span>
	<span class="token keyword">interface</span> <span class="token class-name">Locals</span> <span class="token punctuation">{</span>
		user<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
			<span class="token literal-property property">isAdmin</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> error <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/kit'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> locals <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>locals<span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">error</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">,</span> <span class="token string">'not logged in'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>locals<span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token property-access">isAdmin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">error</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">,</span> <span class="token string">'not an admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Calling <code>error(...)</code> will throw an exception, making it easy to stop execution from inside helper functions.<p>If an <a href="/docs/errors#unexpected-errors"><em>unexpected</em></a> error is thrown, SvelteKit will invoke <a href="hooks#shared-hooks-handleerror"><code>handleError</code></a> and treat it as a 500 Internal Error.<blockquote><p><a href="migrating-to-sveltekit-2#redirect-and-error-are-no-longer-thrown-by-you">In SvelteKit 1.x</a> you had to <code>throw</code> the error yourself</blockquote></section><section class="level2"aria-labelledby="redirects"><h2 id="redirects">Redirects</h2><p>To redirect users, use the <code>redirect</code> helper from <code>@sveltejs/kit</code> to specify the location to which they should be redirected alongside a <code>3xx</code> status code. Like <code>error(...)</code>, calling <code>redirect(...)</code> will throw an exception, making it easy to stop execution from inside helper functions.<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/user/+layout.server.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare namespace <span class="token maybe-class-name">App</span> <span class="token punctuation">{</span>
	<span class="token keyword">interface</span> <span class="token class-name">Locals</span> <span class="token punctuation">{</span>
		user<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> redirect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/kit'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> locals <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>locals<span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">redirect</span><span class="token punctuation">(</span><span class="token number">307</span><span class="token punctuation">,</span> <span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>Don't use <code>redirect()</code> inside a <code>try {...}</code> block, as the redirect will immediately trigger the catch statement.</blockquote><p>In the browser, you can also navigate programmatically outside of a <code>load</code> function using <a href="modules#$app-navigation-goto"><code>goto</code></a> from <a href="modules#$app-navigation"><code>$app.navigation</code></a>.<blockquote><p><a href="migrating-to-sveltekit-2#redirect-and-error-are-no-longer-thrown-by-you">In SvelteKit 1.x</a> you had to <code>throw</code> the <code>redirect</code> yourself</blockquote></section><section class="level2"aria-labelledby="streaming-with-promises"><h2 id="streaming-with-promises">Streaming with promises</h2><p>When using a server <code>load</code>, promises will be streamed to the browser as they resolve. This is useful if you have slow, non-essential data, since you can start rendering the page before all the data is available:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/blog/[slug]/+page.server.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare global <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token function-variable function">loadPost</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">slug</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> # string<span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> <span class="token function-variable function">loadComments</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">slug</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> <span class="token literal-property property">content</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token exports"><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">;</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token comment">// make sure the `await` happens at the end, otherwise we</span>
		<span class="token comment">// can't start loading comments until we've loaded the post</span>
		<span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token function">loadComments</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token property-access">slug</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token literal-property property">post</span><span class="token operator">:</span> <span class="token keyword control-flow">await</span> <span class="token function">loadPost</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token property-access">slug</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>This is useful for creating skeleton loading states, for example:<pre class="language-svelte"><code class="language-svelte">&#x3C;! file: src/routes/blog/[slug]/+page.svelte --->
&#x3C;script>
	/** @type {import('./$types').PageData} */
	export let data;
&#x3C;/script>

&#x3C;h1>{data.post.title}&#x3C;/h1>
&#x3C;div>{@html data.post.content}&#x3C;/div>

{#await data.comments}
	Loading comments...
{:then comments}
	{#each comments as comment}
		&#x3C;p>{comment.content}&#x3C;/p>
	{/each}
{:catch error}
	&#x3C;p>error loading comments: {error.message}&#x3C;/p>
{/await}</code></pre><p>When streaming data, be careful to handle promise rejections correctly. More specifically, the server could crash with an "unhandled promise rejection" error if a lazy-loaded promise fails before rendering starts (at which point it's caught) and isn't handling the error in some way. When using SvelteKit's <code>fetch</code> directly in the <code>load</code> function, SvelteKit will handle this case for you. For other promises, it is enough to attach a noop-<code>catch</code> to the promise to mark it as handled.<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/+page.server.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> fetch <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> ok_manual <span class="token operator">=</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ok_manual<span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		ok_manual<span class="token punctuation">,</span>
		<span class="token literal-property property">ok_fetch</span><span class="token operator">:</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/fetch/that/could/fail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token literal-property property">dangerous_unhandled</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>On platforms that do not support streaming, such as AWS Lambda, responses will be buffered. This means the page will only render once all promises resolve. If you are using a proxy (e.g. NGINX), make sure it does not buffer responses from the proxied server.</blockquote><blockquote><p>Streaming data will only work when JavaScript is enabled. You should avoid returning promises from a universal <code>load</code> function if the page is server rendered, as these are <em>not</em> streamed — instead, the promise is recreated when the function reruns in the browser.</blockquote><blockquote><p>The headers and status code of a response cannot be changed once the response has started streaming, therefore you cannot <code>setHeaders</code> or throw redirects inside a streamed promise.</blockquote><blockquote><p><a href="migrating-to-sveltekit-2#top-level-promises-are-no-longer-awaited">In SvelteKit 1.x</a> top-level promises were automatically awaited, only nested promises were streamed.</blockquote></section><section class="level2"aria-labelledby="parallel-loading"><h2 id="parallel-loading">Parallel loading</h2><p>When rendering (or navigating to) a page, SvelteKit runs all <code>load</code> functions concurrently, avoiding a waterfall of requests. During client-side navigation, the result of calling multiple server <code>load</code> functions are grouped into a single response. Once all <code>load</code> functions have returned, the page is rendered.</section><section class="level2"aria-labelledby="rerunning-load-functions"><h2 id="rerunning-load-functions">Rerunning load functions</h2><p>SvelteKit tracks the dependencies of each <code>load</code> function to avoid rerunning it unnecessarily during navigation.<p>For example, given a pair of <code>load</code> functions like these...<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/blog/[slug]/+page.server.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare module <span class="token string">'$lib/server/database'</span> <span class="token punctuation">{</span>
	<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getPost</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">slug</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> # string<span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> db</span> <span class="token keyword module">from</span> <span class="token string">'$lib/server/database'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">post</span><span class="token operator">:</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">getPost</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token property-access">slug</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/blog/[slug]/+layout.server.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare module <span class="token string">'$lib/server/database'</span> <span class="token punctuation">{</span>
	<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getPostSummaries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token known-class-name class-name">Array</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> # string<span class="token punctuation">,</span> <span class="token literal-property property">slug</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token operator">>></span>
<span class="token punctuation">}</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> db</span> <span class="token keyword module">from</span> <span class="token string">'$lib/server/database'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">posts</span><span class="token operator">:</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">getPostSummaries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>...the one in <code>+page.server.js</code> will rerun if we navigate from <code>/blog/trying-the-raw-meat-diet</code> to <code>/blog/i-regret-my-choices</code> because <code>params.slug</code> has changed. The one in <code>+layout.server.js</code> will not, because the data is still valid. In other words, we won't call <code>db.getPostSummaries()</code> a second time.<p>A <code>load</code> function that calls <code>await parent()</code> will also rerun if a parent <code>load</code> function is rerun.<p>Dependency tracking does not apply <em>after</em> the <code>load</code> function has returned — for example, accessing <code>params.x</code> inside a nested <a href="#streaming-with-promises">promise</a> will not cause the function to rerun when <code>params.x</code> changes. (Don't worry, you'll get a warning in development if you accidentally do this.) Instead, access the parameter in the main body of your <code>load</code> function.<p>Search parameters are tracked independently from the rest of the url. For example, accessing <code>event.url.searchParams.get("x")</code> inside a <code>load</code> function will make that <code>load</code> function re-run when navigating from <code>?x=1</code> to <code>?x=2</code>, but not when navigating from <code>?x=1&#x26;y=1</code> to <code>?x=1&#x26;y=2</code>.</section><section class="level2"aria-labelledby="untracking-dependencies"><h2 id="untracking-dependencies">Untracking dependencies</h2><p>In rare cases, you may wish to exclude something from the dependency tracking mechanism. You can do this with the provided <code>untrack</code> function:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/+page.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> untrack<span class="token punctuation">,</span> url <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Untrack url.pathname so that path changes don't trigger a rerun</span>
	<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">untrack</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> url<span class="token punctuation">.</span><span class="token property-access">pathname</span> <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'Welcome!'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></section><section class="level2"aria-labelledby="manual-invalidation"><h2 id="manual-invalidation">Manual invalidation</h2><p>You can also rerun <code>load</code> functions that apply to the current page using <a href="modules#$app-navigation-invalidate"><code>invalidate(url)</code></a>, which reruns all <code>load</code> functions that depend on <code>url</code>, and <a href="modules#$app-navigation-invalidateall"><code>invalidateAll()</code></a>, which reruns every <code>load</code> function. Server load functions will never automatically depend on a fetched <code>url</code> to avoid leaking secrets to the client.<p>A <code>load</code> function depends on <code>url</code> if it calls <code>fetch(url)</code> or <code>depends(url)</code>. Note that <code>url</code> can be a custom identifier that starts with <code>[a-z]:</code>:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: src/routes/random-number/+page.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> fetch<span class="token punctuation">,</span> depends <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// load reruns when `invalidate('https://api.example.com/random-number')` is called...</span>
	<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/random-number'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// ...or when `invalidate('app:random')` is called</span>
	<span class="token function">depends</span><span class="token punctuation">(</span><span class="token string">'app:random'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token keyword control-flow">await</span> response<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-svelte"><code class="language-svelte">&#x3C;! file: src/routes/random-number/+page.svelte --->
&#x3C;script>
	import { invalidate, invalidateAll } from '$app/navigation';

	/** @type {import('./$types').PageData} */
	export let data;

	function rerunLoadFunction() {
		// any of these will cause the `load` function to rerun
		invalidate('app:random');
		invalidate('https://api.example.com/random-number');
		invalidate(url => url.href.includes('random-number'));
		invalidateAll();
	}
&#x3C;/script>

&#x3C;p>random number: {data.number}&#x3C;/p>
&#x3C;button on:click={rerunLoadFunction}>Update random number&#x3C;/button></code></pre></section><section class="level2"aria-labelledby="when-do-load-functions-rerun"><h2 id="when-do-load-functions-rerun">When do load functions rerun?</h2><p>To summarize, a <code>load</code> function will rerun in the following situations:<ul><li>It references a property of <code>params</code> whose value has changed<li>It references a property of <code>url</code> (such as <code>url.pathname</code> or <code>url.search</code>) whose value has changed. Properties in <code>request.url</code> are <em>not</em> tracked<li>It calls <code>url.searchParams.get(...)</code>, <code>url.searchParams.getAll(...)</code> or <code>url.searchParams.has(...)</code> and the parameter in question changes. Accessing other properties of <code>url.searchParams</code> will have the same effect as accessing <code>url.search</code>.<li>It calls <code>await parent()</code> and a parent <code>load</code> function reran<li>It declared a dependency on a specific URL via <a href="#making-fetch-requests"><code>fetch</code></a> (universal load only) or <a href="types#public-types-loadevent"><code>depends</code></a>, and that URL was marked invalid with <a href="modules#$app-navigation-invalidate"><code>invalidate(url)</code></a><li>All active <code>load</code> functions were forcibly rerun with <a href="modules#$app-navigation-invalidateall"><code>invalidateAll()</code></a></ul><p><code>params</code> and <code>url</code> can change in response to a <code>&#x3C;a href=".."></code> link click, a <a href="form-actions#get-vs-post"><code>&#x3C;form></code> interaction</a>, a <a href="modules#$app-navigation-goto"><code>goto</code></a> invocation, or a <a href="modules#sveltejs-kit-redirect"><code>redirect</code></a>.<p>Note that rerunning a <code>load</code> function will update the <code>data</code> prop inside the corresponding <code>+layout.svelte</code> or <code>+page.svelte</code>; it does <em>not</em> cause the component to be recreated. As a result, internal state is preserved. If this isn't what you want, you can reset whatever you need to reset inside an <a href="modules#$app-navigation-afternavigate"><code>afterNavigate</code></a> callback, and/or wrap your component in a <a href="https://svelte.dev/docs#template-syntax-key"><code>{#key ...}</code></a> block.</section><section class="level2"aria-labelledby="implications-for-authentication"><h2 id="implications-for-authentication">Implications for authentication</h2><p>A couple features of loading data have important implications for auth checks:<ul><li>Layout <code>load</code> functions do not run on every request, such as during client side navigation between child routes. <a href="load#rerunning-load-functions-when-do-load-functions-rerun">(When do load functions rerun?)</a><li>Layout and page <code>load</code> functions run concurrently unless <code>await parent()</code> is called. If a layout <code>load</code> throws, the page <code>load</code> function runs, but the client will not receive the returned data.</ul><p>There are a few possible strategies to ensure an auth check occurs before protected code.<p>To prevent data waterfalls and preserve layout <code>load</code> caches:<ul><li>Use <a href="hooks">hooks</a> to protect multiple routes before any <code>load</code> functions run<li>Use auth guards directly in <code>+page.server.js</code> <code>load</code> functions for route specific protection</ul><p>Putting an auth guard in <code>+layout.server.js</code> requires all child pages to call <code>await parent()</code> before protected code. Unless every child page depends on returned data from <code>await parent()</code>, the other options will be more performant.</section><section class="level2"aria-labelledby="further-reading"><h2 id="further-reading">Further reading</h2><ul><li><a href="https://learn.svelte.dev/tutorial/page-data">Tutorial: Loading data</a><li><a href="https://learn.svelte.dev/tutorial/error-basics">Tutorial: Errors and redirects</a><li><a href="https://learn.svelte.dev/tutorial/await-parent">Tutorial: Advanced loading</a> <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></ul></section></section>