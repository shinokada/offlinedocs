<!doctype html><html lang="en"><meta charset="utf-8"><title>Cloudflare Workers</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="cloudflare-workers"class="level1"><h1>Cloudflare Workers</h1><p>To deploy to <a href="https://workers.cloudflare.com/">Cloudflare Workers</a>, use <a href="https://github.com/sveltejs/kit/tree/master/packages/adapter-cloudflare-workers"><code>adapter-cloudflare-workers</code></a>.<p>Unless you have a specific reason to use this adapter, we recommend using <a href="adapter-cloudflare"><code>adapter-cloudflare</code></a> instead.<blockquote><p>Requires <a href="https://developers.cloudflare.com/workers/wrangler/get-started/">Wrangler v2</a>.</blockquote><section id="usage"class="level2"><h2>Usage</h2><p>Install with <code>npm i -D @sveltejs/adapter-cloudflare-workers</code>, then add the adapter to your <code>svelte.config.js</code>:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2307</span>
<span class="token comment">/// file: svelte.config.js</span>
<span class="token keyword module">import</span> <span class="token imports">adapter</span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/adapter-cloudflare-workers'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">kit</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">adapter</span><span class="token operator">:</span> <span class="token function">adapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></section><section id="basic-configuration"class="level2"><h2>Basic Configuration</h2><p>This adapter expects to find a <a href="https://developers.cloudflare.com/workers/platform/sites/configuration">wrangler.toml</a> file in the project root. It should look something like this:<pre class="language-toml"><code class="language-toml">/// file: wrangler<span class="token punctuation">.</span>toml
<span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"&#x3C;your-service-name>"</span>
<span class="token key property">account_id</span> <span class="token punctuation">=</span> <span class="token string">"&#x3C;your-account-id>"</span>

<span class="token key property">main</span> <span class="token punctuation">=</span> <span class="token string">"./.cloudflare/worker.js"</span>
<span class="token key property">site.bucket</span> <span class="token punctuation">=</span> <span class="token string">"./.cloudflare/public"</span>

<span class="token key property">build.command</span> <span class="token punctuation">=</span> <span class="token string">"npm run build"</span>

<span class="token key property">compatibility_date</span> <span class="token punctuation">=</span> <span class="token string">"2021-11-12"</span>
<span class="token key property">workers_dev</span> <span class="token punctuation">=</span> <span class="token boolean">true</span></code></pre><p><code>&#x3C;your-service-name></code> can be anything. <code>&#x3C;your-account-id></code> can be found by logging into your <a href="https://dash.cloudflare.com">Cloudflare dashboard</a> and grabbing it from the end of the URL:<pre class="language-text"><code class="language-text">https://dash.cloudflare.com/&#x3C;your-account-id></code></pre><blockquote><p>You should add the <code>.cloudflare</code> directory (or whichever directories you specified for <code>main</code> and <code>site.bucket</code>) to your <code>.gitignore</code>.</blockquote><p>You will need to install <a href="https://developers.cloudflare.com/workers/wrangler/get-started/">wrangler</a> and log in, if you haven't already:<pre class="language-text"><code class="language-text">npm i -g wrangler
wrangler login</code></pre><p>Then, you can build your app and deploy it:<pre class="language-sh"><code class="language-sh">wrangler publish</code></pre></section><section id="custom-config"class="level2"><h2>Custom config</h2><p>If you would like to use a config file other than <code>wrangler.toml</code>, you can do like so:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2307</span>
<span class="token comment">/// file: svelte.config.js</span>
<span class="token keyword module">import</span> <span class="token imports">adapter</span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/adapter-cloudflare-workers'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">kit</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">adapter</span><span class="token operator">:</span> <span class="token function">adapter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">config</span><span class="token operator">:</span> <span class="token string">'&#x3C;your-wrangler-name>.toml'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></section><section id="environment-variables"class="level2"><h2>Environment variables</h2><p>The <a href="https://developers.cloudflare.com/workers/runtime-apis/fetch-event#parameters"><code>env</code></a> object, containing KV/DO namespaces etc, is passed to SvelteKit via the <code>platform</code> property along with <code>context</code> and <code>caches</code>, meaning you can access it in hooks and endpoints:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 7031</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">POST</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request<span class="token punctuation">,</span> platform <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> x <span class="token operator">=</span> platform<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">YOUR_DURABLE_OBJECT_NAMESPACE</span><span class="token punctuation">.</span><span class="token method function property-access">idFromName</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>To make these types available to your app, reference them in your <code>src/app.d.ts</code>:<pre class="language-diff"><code class="language-diff">/// file: src/app.d.ts
declare global {
	namespace App {
		interface Platform {
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">			env?: {
</span><span class="token prefix inserted">+</span><span class="token line">				YOUR_KV_NAMESPACE: KVNamespace;
</span><span class="token prefix inserted">+</span><span class="token line">				YOUR_DURABLE_OBJECT_NAMESPACE: DurableObjectNamespace;
</span><span class="token prefix inserted">+</span><span class="token line">			};
</span></span>		}
	}
}

export {};</code></pre><blockquote><p><code>platform.env</code> is only available in the production build. Use <a href="https://developers.cloudflare.com/workers/cli-wrangler">wrangler</a> to test it locally</blockquote></section><section id="troubleshooting"class="level2"><h2>Troubleshooting</h2></section><section id="accessing-the-file-system"class="level2"><h2>Accessing the file system</h2><p>You can't access the file system through methods like <code>fs.readFileSync</code> in Serverless/Edge environments. If you need to access files that way, do that during building the app through <a href="https://kit.svelte.dev../20-core-concepts/40-page-options.html#prerender">prerendering</a>. If you have a blog for example and don't want to manage your content through a CMS, then you need to prerender the content (or prerender the endpoint from which you get it) and redeploy your blog everytime you add new content.<span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section>