<!doctype html><html lang="en"><meta charset="utf-8"><title>Cloudflare Pages</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="cloudflare-pages"><h1 id="cloudflare-pages">Cloudflare Pages</h1><p>To deploy to <a href="https://developers.cloudflare.com/pages/">Cloudflare Pages</a>, use <a href="https://github.com/sveltejs/kit/tree/master/packages/adapter-cloudflare"><code>adapter-cloudflare</code></a>.<p>This adapter will be installed by default when you use <a href="adapter-auto"><code>adapter-auto</code></a>, but adding it to your project is recommended so that <code>event.platform</code> is automatically typed.<section class="level2"aria-labelledby="comparisons"><h2 id="comparisons">Comparisons</h2><ul><li><code>adapter-cloudflare</code> – supports all SvelteKit features; builds for <a href="https://blog.cloudflare.com/cloudflare-pages-goes-full-stack/">Cloudflare Pages</a><li><code>adapter-cloudflare-workers</code> – supports all SvelteKit features; builds for Cloudflare Workers<li><code>adapter-static</code> – only produces client-side static assets; compatible with Cloudflare Pages</ul><blockquote><p>Unless you have a specific reason to use <code>adapter-cloudflare-workers</code>, it's recommended that you use this adapter instead. Both adapters have equivalent functionality, but Cloudflare Pages offers features like GitHub integration with automatic builds and deploys, preview deployments, instant rollback and so on.</blockquote></section><section class="level2"aria-labelledby="usage"><h2 id="usage">Usage</h2><p>Install with <code>npm i -D @sveltejs/adapter-cloudflare</code>, then add the adapter to your <code>svelte.config.js</code>:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2307</span>
<span class="token comment">/// file: svelte.config.js</span>
<span class="token keyword module">import</span> <span class="token imports">adapter</span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/adapter-cloudflare'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">kit</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">adapter</span><span class="token operator">:</span> <span class="token function">adapter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token comment">// See below for an explanation of these options</span>
			<span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/*'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'&#x3C;all>'</span><span class="token punctuation">]</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></section><section class="level2"aria-labelledby="options"><h2 id="options">Options</h2><p>The <code>routes</code> option allows you to customise the <a href="https://developers.cloudflare.com/pages/platform/functions/routing/#create-a-_routesjson-file"><code>_routes.json</code></a> file generated by <code>adapter-cloudflare</code>.<ul><li><code>include</code> defines routes that will invoke a function, and defaults to <code>['/*']</code><li><code>exclude</code> defines routes that will <em>not</em> invoke a function — this is a faster and cheaper way to serve your app's static assets. This array can include the following special values:<ul><li><code>&#x3C;build></code> contains your app's build artifacts (the files generated by Vite)<li><code>&#x3C;files></code> contains the contents of your <code>static</code> directory<li><code>&#x3C;prerendered></code> contains a list of prerendered pages<li><code>&#x3C;all></code> (the default) contains all of the above</ul></ul><p>You can have up to 100 <code>include</code> and <code>exclude</code> rules combined. Generally you can omit the <code>routes</code> options, but if (for example) your <code>&#x3C;prerendered></code> paths exceed that limit, you may find it helpful to manually create an <code>exclude</code> list that includes <code>'/articles/*'</code> instead of the auto-generated <code>['/articles/foo', '/articles/bar', '/articles/baz', ...]</code>.</section><section class="level2"aria-labelledby="deployment"><h2 id="deployment">Deployment</h2><p>Please follow the <a href="https://developers.cloudflare.com/pages/get-started">Get Started Guide</a> for Cloudflare Pages to begin.<p>When configuring your project settings, you must use the following settings:<ul><li><strong>Framework preset</strong> – None<li><strong>Build command</strong> – <code>npm run build</code> or <code>vite build</code><li><strong>Build output directory</strong> – <code>.svelte-kit/cloudflare</code><li><strong>Environment variables</strong><ul><li><code>NODE_VERSION</code>: <code>16</code></ul></ul><blockquote><p>You need to add a <code>NODE_VERSION</code> environment variable to both the "production" and "preview" environments. You can add this during project setup or later in the Pages project settings. SvelteKit requires Node <code>16.14</code> or later, so you should use <code>16</code> as the <code>NODE_VERSION</code> value.</blockquote></section><section class="level2"aria-labelledby="bindings"><h2 id="bindings">Bindings</h2><p>The <a href="https://developers.cloudflare.com/workers/runtime-apis/fetch-event#parameters"><code>env</code></a> object contains your project's <a href="https://developers.cloudflare.com/workers/platform/environment-variables/">bindings</a>, which consist of KV/DO namespaces, etc. It is passed to SvelteKit via the <code>platform</code> property, along with <code>context</code> and <code>caches</code>, meaning that you can access it in hooks and endpoints:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 7031</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">POST</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request<span class="token punctuation">,</span> platform <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> x <span class="token operator">=</span> platform<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">YOUR_DURABLE_OBJECT_NAMESPACE</span><span class="token punctuation">.</span><span class="token method function property-access">idFromName</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>SvelteKit's built-in <code>$env</code> module should be preferred for environment variables.</blockquote><p>To make these types available to your app, reference them in your <code>src/app.d.ts</code>:<pre class="language-diff"><code class="language-diff">/// file: src/app.d.ts
declare global {
	namespace App {
		interface Platform {
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">			env?: {
</span><span class="token prefix inserted">+</span><span class="token line">				YOUR_KV_NAMESPACE: KVNamespace;
</span><span class="token prefix inserted">+</span><span class="token line">				YOUR_DURABLE_OBJECT_NAMESPACE: DurableObjectNamespace;
</span><span class="token prefix inserted">+</span><span class="token line">			};
</span></span>		}
	}
}

export {};</code></pre><blockquote><p><code>platform.env</code> is only available in the production build. Use <a href="https://developers.cloudflare.com/workers/cli-wrangler">wrangler</a> to test it locally.</blockquote></section><section class="level2"aria-labelledby="notes"><h2 id="notes">Notes</h2><p>Functions contained in the <code>/functions</code> directory at the project's root will <em>not</em> be included in the deployment, which is compiled to a <a href="https://developers.cloudflare.com/pages/platform/functions/#advanced-mode">single <code>_worker.js</code> file</a>. Functions should be implemented as <a href="https://kit.svelte.dev../20-core-concepts/10-routing.html#server">server endpoints</a> in your SvelteKit app.<p>The <code>_headers</code> and <code>_redirects</code> files specific to Cloudflare Pages can be used for static asset responses (like images) by putting them into the <code>/static</code> folder.<p>However, they will have no effect on responses dynamically rendered by SvelteKit, which should return custom headers or redirect responses from <a href="https://kit.svelte.dev../20-core-concepts/10-routing.html#server">server endpoints</a> or with the <a href="https://kit.svelte.dev../30-advanced/20-hooks.html#server-hooks-handle"><code>handle</code></a> hook.</section><section class="level2"aria-labelledby="troubleshooting"><h2 id="troubleshooting">Troubleshooting</h2></section><section class="level2"aria-labelledby="accessing-the-file-system"><h2 id="accessing-the-file-system">Accessing the file system</h2><p>You can't access the file system through methods like <code>fs.readFileSync</code> in Serverless/Edge environments. If you need to access files that way, do that during building the app through <a href="https://kit.svelte.dev../20-core-concepts/40-page-options.html#prerender">prerendering</a>. If you have a blog for example and don't want to manage your content through a CMS, then you need to prerender the content (or prerender the endpoint from which you get it) and redeploy your blog everytime you add new content. <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section>