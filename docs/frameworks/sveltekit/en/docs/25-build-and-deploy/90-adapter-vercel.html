<!doctype html><html lang="en"><meta charset="utf-8"><title>Vercel</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../Vivliostyle/read-html-download-pdf/docs/themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="vercel"><h1 id="vercel">Vercel</h1><p>To deploy to Vercel, use <a href="https://github.com/sveltejs/kit/tree/master/packages/adapter-vercel"><code>adapter-vercel</code></a>.<p>This adapter will be installed by default when you use <a href="adapter-auto"><code>adapter-auto</code></a>, but adding it to your project allows you to specify Vercel-specific options.<section class="level2"aria-labelledby="usage"><h2 id="usage">Usage</h2><p>Install with <code>npm i -D @sveltejs/adapter-vercel</code>, then add the adapter to your <code>svelte.config.js</code>:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2307 2345</span>
<span class="token comment">/// file: svelte.config.js</span>
<span class="token keyword module">import</span> <span class="token imports">adapter</span> <span class="token keyword module">from</span> <span class="token string">'@sveltejs/adapter-vercel'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">kit</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">adapter</span><span class="token operator">:</span> <span class="token function">adapter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token comment">// see the 'Deployment configuration' section below</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></section><section class="level2"aria-labelledby="deployment-configuration"><h2 id="deployment-configuration">Deployment configuration</h2><p>To control how your routes are deployed to Vercel as functions, you can specify deployment configuration, either through the option shown above or with <a href="../20-core-concepts/40-page-options.html#config"><code>export const config</code></a> inside <code>+server.js</code>, <code>+page(.server).js</code> and <code>+layout(.server).js</code> files.<p>For example you could deploy some parts of your app as <a href="https://vercel.com/docs/concepts/functions/edge-functions">Edge Functions</a>...<pre class="language-js"><code class="language-js"><span class="token comment">/// file: about/+page.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'@sveltejs/adapter-vercel'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Config<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">runtime</span><span class="token operator">:</span> <span class="token string">'edge'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>...and others as <a href="https://vercel.com/docs/concepts/functions/serverless-functions">Serverless Functions</a> (note that by specifying <code>config</code> inside a layout, it applies to all child pages):<pre class="language-js"><code class="language-js"><span class="token comment">/// file: admin/+layout.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'@sveltejs/adapter-vercel'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Config<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">runtime</span><span class="token operator">:</span> <span class="token string">'nodejs18.x'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>The following options apply to all functions:<ul><li><code>runtime</code>: <code>'edge'</code>, <code>'nodejs16.x'</code> or <code>'nodejs18.x'</code>. By default, the adapter will select <code>'nodejs16.x'</code> or <code>'nodejs18.x'</code> depending on the Node version your project is configured to use on the Vercel dashboard<li><code>regions</code>: an array of <a href="https://vercel.com/docs/concepts/edge-network/regions">edge network regions</a> (defaulting to <code>["iad1"]</code> for serverless functions) or <code>'all'</code> if <code>runtime</code> is <code>edge</code> (its default). Note that multiple regions for serverless functions are only supported on Enterprise plans<li><code>split</code>: if <code>true</code>, causes a route to be deployed as an individual function. If <code>split</code> is set to <code>true</code> at the adapter level, all routes will be deployed as individual functions</ul><p>Additionally, the following options apply to edge functions:<ul><li><code>envVarsInUse</code>: an array of environment variables that should be accessible inside the edge function<li><code>external</code>: an array of dependencies that esbuild should treat as external when bundling functions. This should only be used to exclude optional dependencies that will not run outside Node</ul><p>And the following option apply to serverless functions:<ul><li><code>memory</code>: the amount of memory available to the function. Defaults to <code>1024</code> Mb, and can be decreased to <code>128</code> Mb or <a href="https://vercel.com/docs/concepts/limits/overview#serverless-function-memory">increased</a> in 64Mb increments up to <code>3008</code> Mb on Pro or Enterprise accounts<li><code>maxDuration</code>: maximum execution duration of the function. Defaults to <code>10</code> seconds for Hobby accounts, <code>60</code> for Pro and <code>900</code> for Enterprise<li><code>isr</code>: configuration Incremental Static Regeneration, described below</ul><p>If your functions need to access data in a specific region, it's recommended that they be deployed in the same region (or close to it) for optimal performance.</section><section class="level2"aria-labelledby="incremental-static-regeneration"><h2 id="incremental-static-regeneration">Incremental Static Regeneration</h2><p>Vercel supports <a href="https://vercel.com/docs/concepts/incremental-static-regeneration/overview">Incremental Static Regeneration</a> (ISR), which provides the performance and cost advantages of prerendered content with the flexibility of dynamically rendered content.<p>To add ISR to a route, include the <code>isr</code> property in your <code>config</code> object:<pre class="language-js"><code class="language-js"><span class="token comment">/// file: blog/[slug]/+page.server.js</span>
<span class="token comment">// @filename: ambient.d.ts</span>
declare module <span class="token string">'$env/static/private'</span> <span class="token punctuation">{</span>
	<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token constant">BYPASS_TOKEN</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token punctuation">{</span> <span class="token constant">BYPASS_TOKEN</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'$env/static/private'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">isr</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token comment">// Expiration time (in seconds) before the cached asset will be re-generated by invoking the Serverless Function.</span>
		<span class="token comment">// Setting the value to `false` means it will never expire.</span>
		<span class="token literal-property property">expiration</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span>

		<span class="token comment">// Random token that can be provided in the URL to bypass the cached version of the asset, by requesting the asset</span>
		<span class="token comment">// with a __prerender_bypass=&#x3C;token> cookie.</span>
		<span class="token comment">//</span>
		<span class="token comment">// Making a `GET` or `HEAD` request with `x-prerender-revalidate: &#x3C;token>` will force the asset to be re-validated.</span>
		<span class="token literal-property property">bypassToken</span><span class="token operator">:</span> <span class="token constant">BYPASS_TOKEN</span><span class="token punctuation">,</span>

		<span class="token comment">// List of valid query parameters. Other parameters (such as utm tracking codes) will be ignored,</span>
		<span class="token comment">// ensuring that they do not result in content being regenerated unnecessarily</span>
		<span class="token literal-property property">allowQuery</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'search'</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>The <code>expiration</code> property is required; all others are optional.</section><section class="level2"aria-labelledby="environment-variables"><h2 id="environment-variables">Environment variables</h2><p>Vercel makes a set of <a href="https://vercel.com/docs/concepts/projects/environment-variables#system-environment-variables">deployment-specific environment variables</a> available. Like other environment variables, these are accessible from <code>$env/static/private</code> and <code>$env/dynamic/private</code> (sometimes — more on that later), and inaccessible from their public counterparts. To access one of these variables from the client:<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2305</span>
<span class="token comment">/// file: +layout.server.js</span>
<span class="token keyword module">import</span> <span class="token punctuation">{</span> <span class="token constant">VERCEL_COMMIT_REF</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'$env/static/private'</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./$types'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LayoutServerLoad<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">deploymentGitBranch</span><span class="token operator">:</span> <span class="token constant">VERCEL_COMMIT_REF</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-svelte"><code class="language-svelte">/// file: +layout.svelte
&#x3C;script>
	/** @type {import('./$types').LayoutServerData} */
	export let data;
&#x3C;/script>

&#x3C;p>This staging environment was deployed from {data.deploymentGitBranch}.&#x3C;/p></code></pre><p>Since all of these variables are unchanged between build time and run time when building on Vercel, we recommend using <code>$env/static/private</code> — which will statically replace the variables, enabling optimisations like dead code elimination — rather than <code>$env/dynamic/private</code>. If you're deploying with <code>edge: true</code> you must either use <code>$env/static/private</code> or populate the <code>envVarsInUse</code> configuration.</section><section class="level2"aria-labelledby="notes"><h2 id="notes">Notes</h2></section><section class="level2"aria-labelledby="vercel-functions"><h2 id="vercel-functions">Vercel functions</h2><p>If you have Vercel functions contained in the <code>api</code> directory at the project's root, any requests for <code>/api/*</code> will <em>not</em> be handled by SvelteKit. You should implement these as <a href="https://kit.svelte.dev../20-core-concepts/10-routing.html#server">API routes</a> in your SvelteKit app instead, unless you need to use a non-JavaScript language in which case you will need to ensure that you don't have any <code>/api/*</code> routes in your SvelteKit app.</section><section class="level2"aria-labelledby="node-version"><h2 id="node-version">Node version</h2><p>Projects created before a certain date will default to using Node 14, while SvelteKit requires Node 16 or later. You can <a href="https://vercel.com/docs/concepts/functions/serverless-functions/runtimes/node-js#node.js-version">change the Node version in your project settings</a>.</section><section class="level2"aria-labelledby="troubleshooting"><h2 id="troubleshooting">Troubleshooting</h2></section><section class="level2"aria-labelledby="accessing-the-file-system"><h2 id="accessing-the-file-system">Accessing the file system</h2><p>You can't access the file system through methods like <code>fs.readFileSync</code> in Serverless/Edge environments. If you need to access files that way, do that during building the app through <a href="https://kit.svelte.dev../20-core-concepts/40-page-options.html#prerender">prerendering</a>. If you have a blog for example and don't want to manage your content through a CMS, then you need to prerender the content (or prerender the endpoint from which you get it) and redeploy your blog everytime you add new content. <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section>