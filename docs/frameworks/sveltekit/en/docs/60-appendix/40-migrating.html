<!doctype html><html lang="en"><meta charset="utf-8"><title>Migrating from Sapper</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="migrating-from-sapper"><h1 id="migrating-from-sapper">Migrating from Sapper</h1><p>rank: 1<p>SvelteKit is the successor to Sapper and shares many elements of its design.<p>If you have an existing Sapper app that you plan to migrate to SvelteKit, there are a number of changes you will need to make. You may find it helpful to view <a href="additional-resources#examples">some examples</a> while migrating.<section class="level2"aria-labelledby="packagejson"><h2 id="packagejson">package.json</h2></section><section class="level2"aria-labelledby="type-module"><h2 id="type-module">type: "module"</h2><p>Add <code>"type": "module"</code> to your <code>package.json</code>. You can do this step separately from the rest as part of an incremental migration if you are using Sapper 0.29.3 or newer.</section><section class="level2"aria-labelledby="dependencies"><h2 id="dependencies">dependencies</h2><p>Remove <code>polka</code> or <code>express</code>, if you're using one of those, and any middleware such as <code>sirv</code> or <code>compression</code>.</section><section class="level2"aria-labelledby="devdependencies"><h2 id="devdependencies">devDependencies</h2><p>Remove <code>sapper</code> from your <code>devDependencies</code> and replace it with <code>@sveltejs/kit</code> and whichever <a href="adapters">adapter</a> you plan to use (see <a href="migrating#project-files-configuration">next section</a>).</section><section class="level2"aria-labelledby="scripts"><h2 id="scripts">scripts</h2><p>Any scripts that reference <code>sapper</code> should be updated:<ul><li><code>sapper build</code> should become <code>vite build</code> using the Node <a href="adapters">adapter</a><li><code>sapper export</code> should become <code>vite build</code> using the static <a href="adapters">adapter</a><li><code>sapper dev</code> should become <code>vite dev</code><li><code>node __sapper__/build</code> should become <code>node build</code></ul></section><section class="level2"aria-labelledby="project-files"><h2 id="project-files">Project files</h2><p>The bulk of your app, in <code>src/routes</code>, can be left where it is, but several project files will need to be moved or updated.</section><section class="level2"aria-labelledby="configuration"><h2 id="configuration">Configuration</h2><p>Your <code>webpack.config.js</code> or <code>rollup.config.js</code> should be replaced with a <code>svelte.config.js</code>, as documented <a href="configuration">here</a>. Svelte preprocessor options should be moved to <code>config.preprocess</code>.<p>You will need to add an <a href="adapters">adapter</a>. <code>sapper build</code> is roughly equivalent to <a href="https://github.com/sveltejs/kit/tree/main/packages/adapter-node">adapter-node</a> while <code>sapper export</code> is roughly equivalent to <a href="https://github.com/sveltejs/kit/tree/main/packages/adapter-static">adapter-static</a>, though you might prefer to use an adapter designed for the platform you're deploying to.<p>If you were using plugins for filetypes that are not automatically handled by <a href="https://vitejs.dev">Vite</a>, you will need to find Vite equivalents and add them to the <a href="project-structure#project-files-vite-config-js">Vite config</a>.</section><section class="level2"aria-labelledby="srcclientjs"><h2 id="srcclientjs">src/client.js</h2><p>This file has no equivalent in SvelteKit. Any custom logic (beyond <code>sapper.start(...)</code>) should be expressed in your <code>+layout.svelte</code> file, inside an <code>onMount</code> callback.</section><section class="level2"aria-labelledby="srcserverjs"><h2 id="srcserverjs">src/server.js</h2><p>When using <code>adapter-node</code> the equivalent is a <a href="adapter-node#custom-server">custom server</a>. Otherwise, this file has no direct equivalent, since SvelteKit apps can run in serverless environments.</section><section class="level2"aria-labelledby="srcservice-workerjs"><h2 id="srcservice-workerjs">src/service-worker.js</h2><p>Most imports from <code>@sapper/service-worker</code> have equivalents in <a href="modules#$service-worker"><code>$service-worker</code></a>:<ul><li><code>files</code> is unchanged<li><code>routes</code> has been removed<li><code>shell</code> is now <code>build</code><li><code>timestamp</code> is now <code>version</code></ul></section><section class="level2"aria-labelledby="srctemplatehtml"><h2 id="srctemplatehtml">src/template.html</h2><p>The <code>src/template.html</code> file should be renamed <code>src/app.html</code>.<p>Remove <code>%sapper.base%</code>, <code>%sapper.scripts%</code> and <code>%sapper.styles%</code>. Replace <code>%sapper.head%</code> with <code>%sveltekit.head%</code> and <code>%sapper.html%</code> with <code>%sveltekit.body%</code>. The <code>&#x3C;div id="sapper"></code> is no longer necessary.</section><section class="level2"aria-labelledby="srcnode_modules"><h2 id="srcnode_modules">src/node_modules</h2><p>A common pattern in Sapper apps is to put your internal library in a directory inside <code>src/node_modules</code>. This doesn't work with Vite, so we use <a href="modules#$lib"><code>src/lib</code></a> instead.</section><section class="level2"aria-labelledby="pages-and-layouts"><h2 id="pages-and-layouts">Pages and layouts</h2></section><section class="level2"aria-labelledby="renamed-files"><h2 id="renamed-files">Renamed files</h2><p>Routes now are made up of the folder name exclusively to remove ambiguity, the folder names leading up to a <code>+page.svelte</code> correspond to the route. See <a href="routing">the routing docs</a> for an overview. The following shows a old/new comparison:<table><thead><tr><th>Old<th>New<tbody><tr><td>routes/about/index.svelte<td>routes/about/+page.svelte<tr><td>routes/about.svelte<td>routes/about/+page.svelte</table><p>Your custom error page component should be renamed from <code>_error.svelte</code> to <code>+error.svelte</code>. Any <code>_layout.svelte</code> files should likewise be renamed <code>+layout.svelte</code>. <a href="routing#other-files">Any other files are ignored</a>.</section><section class="level2"aria-labelledby="imports"><h2 id="imports">Imports</h2><p>The <code>goto</code>, <code>prefetch</code> and <code>prefetchRoutes</code> imports from <code>@sapper/app</code> should be replaced with <code>goto</code>, <code>preloadData</code> and <code>preloadCode</code> imports respectively from <a href="modules#$app-navigation"><code>$app/navigation</code></a>.<p>The <code>stores</code> import from <code>@sapper/app</code> should be replaced — see the <a href="migrating#pages-and-layouts-stores">Stores</a> section below.<p>Any files you previously imported from directories in <code>src/node_modules</code> will need to be replaced with <a href="modules#$lib"><code>$lib</code></a> imports.</section><section class="level2"aria-labelledby="preload"><h2 id="preload">Preload</h2><p>As before, pages and layouts can export a function that allows data to be loaded before rendering takes place.<p>This function has been renamed from <code>preload</code> to <a href="load"><code>load</code></a>, it now lives in a <code>+page.js</code> (or <code>+layout.js</code>) next to its <code>+page.svelte</code> (or <code>+layout.svelte</code>), and its API has changed. Instead of two arguments — <code>page</code> and <code>session</code> — there is a single <code>event</code> argument.<p>There is no more <code>this</code> object, and consequently no <code>this.fetch</code>, <code>this.error</code> or <code>this.redirect</code>. Instead, you can get <a href="load#making-fetch-requests"><code>fetch</code></a> from the input methods, and both <a href="load#errors"><code>error</code></a> and <a href="load#redirects"><code>redirect</code></a> are now thrown.</section><section class="level2"aria-labelledby="stores"><h2 id="stores">Stores</h2><p>In Sapper, you would get references to provided stores like so:<pre class="language-js"><code class="language-js"><span class="token comment">// @filename: ambient.d.ts</span>
declare module <span class="token string">'@sapper/app'</span><span class="token punctuation">;</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> stores <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@sapper/app'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> preloading<span class="token punctuation">,</span> page<span class="token punctuation">,</span> session <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">stores</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>page</code> store still exists; <code>preloading</code> has been replaced with a <code>navigating</code> store that contains <code>from</code> and <code>to</code> properties. <code>page</code> now has <code>url</code> and <code>params</code> properties, but no <code>path</code> or <code>query</code>.<p>You access them differently in SvelteKit. <code>stores</code> is now <code>getStores</code>, but in most cases it is unnecessary since you can import <code>navigating</code>, and <code>page</code> directly from <a href="modules#$app-stores"><code>$app/stores</code></a>.</section><section class="level2"aria-labelledby="routing"><h2 id="routing">Routing</h2><p>Regex routes are no longer supported. Instead, use <a href="advanced-routing#matching">advanced route matching</a>.</section><section class="level2"aria-labelledby="segments"><h2 id="segments">Segments</h2><p>Previously, layout components received a <code>segment</code> prop indicating the child segment. This has been removed; you should use the more flexible <code>$page.url.pathname</code> value to derive the segment you're interested in.</section><section class="level2"aria-labelledby="urls"><h2 id="urls">URLs</h2><p>In Sapper, all relative URLs were resolved against the base URL — usually <code>/</code>, unless the <code>basepath</code> option was used — rather than against the current page.<p>This caused problems and is no longer the case in SvelteKit. Instead, relative URLs are resolved against the current page (or the destination page, for <code>fetch</code> URLs in <code>load</code> functions) instead. In most cases, it's easier to use root-relative (i.e. starts with <code>/</code>) URLs, since their meaning is not context-dependent.</section><section class="level2"aria-labelledby="-attributes"><h2 id="-attributes">&#x3C;a> attributes</h2><ul><li><code>sapper:prefetch</code> is now <code>data-sveltekit-preload-data</code><li><code>sapper:noscroll</code> is now <code>data-sveltekit-noscroll</code></ul></section><section class="level2"aria-labelledby="endpoints"><h2 id="endpoints">Endpoints</h2><p>In Sapper, <a href="routing#server">server routes</a> received the <code>req</code> and <code>res</code> objects exposed by Node's <code>http</code> module (or the augmented versions provided by frameworks like Polka and Express).<p>SvelteKit is designed to be agnostic as to where the app is running — it could be running on a Node server, but could equally be running on a serverless platform or in a Cloudflare Worker. For that reason, you no longer interact directly with <code>req</code> and <code>res</code>. Your endpoints will need to be updated to match the new signature.<p>To support this environment-agnostic behavior, <code>fetch</code> is now available in the global context, so you don't need to import <code>node-fetch</code>, <code>cross-fetch</code>, or similar server-side fetch implementations in order to use it.</section><section class="level2"aria-labelledby="integrations"><h2 id="integrations">Integrations</h2><p>See <a href="./integrations">integrations</a> for detailed information about integrations.</section><section class="level2"aria-labelledby="html-minifier"><h2 id="html-minifier">HTML minifier</h2><p>Sapper includes <code>html-minifier</code> by default. SvelteKit does not include this, but you can add it as a prod dependency and then use it through a <a href="hooks#server-hooks-handle">hook</a>:<pre class="language-js"><code class="language-js"><span class="token comment">// @filename: ambient.d.ts</span>
<span class="token comment">/// &#x3C;reference types="@sveltejs/kit" /></span>
declare module <span class="token string">'html-minifier'</span><span class="token punctuation">;</span>

<span class="token comment">// @filename: index.js</span>
<span class="token comment">// cut---</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> minify <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'html-minifier'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> building <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'$app/environment'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> minification_options <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">collapseBooleanAttributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token literal-property property">collapseWhitespace</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token literal-property property">conservativeCollapse</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token literal-property property">decodeEntities</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token literal-property property">html5</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token literal-property property">ignoreCustomComments</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^#</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token literal-property property">minifyCSS</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token literal-property property">minifyJS</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token literal-property property">removeAttributeQuotes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token literal-property property">removeComments</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// some hydration code needs comments, so leave them in</span>
	<span class="token literal-property property">removeOptionalTags</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token literal-property property">removeRedundantAttributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token literal-property property">removeScriptTypeAttributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token literal-property property">removeStyleLinkTypeAttributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token literal-property property">sortAttributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token literal-property property">sortClassName</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'@sveltejs/kit'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Handle<span class="token punctuation">}</span></span> */</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> event<span class="token punctuation">,</span> resolve <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> page <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

	<span class="token keyword control-flow">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token function-variable function">transformPageChunk</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> html<span class="token punctuation">,</span> done <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
			page <span class="token operator">+=</span> html<span class="token punctuation">;</span>
			<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword control-flow">return</span> building <span class="token operator">?</span> <span class="token function">minify</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> minification_options<span class="token punctuation">)</span> <span class="token operator">:</span> page<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Note that <code>prerendering</code> is <code>false</code> when using <code>vite preview</code> to test the production build of the site, so to verify the results of minifying, you'll need to inspect the built HTML files directly. <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section>