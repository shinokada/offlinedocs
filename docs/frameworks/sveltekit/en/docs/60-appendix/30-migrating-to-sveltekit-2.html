<!doctype html><html lang="en"><meta charset="utf-8"><title>Migrating to SvelteKit v2</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="migrating-to-sveltekit-v2"><h1 id="migrating-to-sveltekit-v2">Migrating to SvelteKit v2</h1><p>Upgrading from SvelteKit version 1 to version 2 should be mostly seamless. There are a few breaking changes to note, which are listed here. You can use <code>npx svelte-migrate@latest sveltekit-2</code> to migrate some of these changes automatically.<p>We highly recommend upgrading to the most recent 1.x version before upgrading to 2.0, so that you can take advantage of targeted deprecation warnings. We also recommend <a href="https://svelte.dev/docs/v4-migration-guide">updating to Svelte 4</a> first: Later versions of SvelteKit 1.x support it, and SvelteKit 2.0 requires it.<section class="level2"aria-labelledby="redirect-and-error-are-no-longer-thrown-by-you"><h2 id="redirect-and-error-are-no-longer-thrown-by-you"><code>redirect</code> and <code>error</code> are no longer thrown by you</h2><p>Previously, you had to <code>throw</code> the values returned from <code>error(...)</code> and <code>redirect(...)</code> yourself. In SvelteKit 2 this is no longer the case — calling the functions is sufficient.<pre class="language-diff"><code class="language-diff">import { error } from '@sveltejs/kit'

...
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> throw error(500, 'something went wrong');
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> error(500, 'something went wrong');</span></span></code></pre><p><code>svelte-migrate</code> will do these changes automatically for you.<p>If the error or redirect is thrown inside a <code>try {...}</code> block (hint: don't do this!), you can distinguish them from unexpected errors using <a href="../50-api-reference/30-modules.html#sveltejs-kit-ishttperror"><code>isHttpError</code></a> and <a href="../50-api-reference/30-modules.html#sveltejs-kit-isredirect"><code>isRedirect</code></a> imported from <code>@sveltejs/kit</code>.</section><section class="level2"aria-labelledby="path-is-required-when-setting-cookies"><h2 id="path-is-required-when-setting-cookies">path is required when setting cookies</h2><p>When receiving a <code>Set-Cookie</code> header that doesn't specify a <code>path</code>, browsers will <a href="https://www.rfc-editor.org/rfc/rfc6265#section-5.1.4">set the cookie path</a> to the parent of the resource in question. This behaviour isn't particularly helpful or intuitive, and frequently results in bugs because the developer expected the cookie to apply to the domain as a whole.<p>As of SvelteKit 2.0, you need to set a <code>path</code> when calling <code>cookies.set(...)</code>, <code>cookies.delete(...)</code> or <code>cookies.serialize(...)</code> so that there's no ambiguity. Most of the time, you probably want to use <code>path: '/'</code>, but you can set it to whatever you like, including relative paths — <code>''</code> means 'the current path', <code>'.'</code> means 'the current directory'.<pre class="language-diff"><code class="language-diff">export function load({ cookies }) {
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    cookies.set(name, value);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    cookies.set(name, value, { path: '/' });
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return { response }
</span></span>}</code></pre><p><code>svelte-migrate</code> will add comments highlighting the locations that need to be adjusted.</section><section class="level2"aria-labelledby="top-level-promises-are-no-longer-awaited"><h2 id="top-level-promises-are-no-longer-awaited">Top-level promises are no longer awaited</h2><p>In SvelteKit version 1, if the top-level properties of the object returned from a <code>load</code> function were promises, they were automatically awaited. With the introduction of <a href="https://svelte.dev/blog/streaming-snapshots-sveltekit">streaming</a> this behavior became a bit awkward as it forces you to nest your streamed data one level deep.<p>As of version 2, SvelteKit no longer differentiates between top-level and non-top-level promises. To get back the blocking behavior, use <code>await</code> (with <code>Promise.all</code> to prevent waterfalls, where appropriate):<pre class="language-diff"><code class="language-diff">// If you have a single promise
export function load({ fetch }) {
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    const response = fetch(...).then(r => r.json());
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    const response = await fetch(...).then(r => r.json());
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return { response }
</span></span>}</code></pre><pre class="language-diff"><code class="language-diff">// If you have multiple promises
export function load({ fetch }) {
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    const a = fetch(...).then(r => r.json());
</span><span class="token prefix deleted">-</span><span class="token line">    const b = fetch(...).then(r => r.json());
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    const [a, b] = await Promise.all([
</span><span class="token prefix inserted">+</span><span class="token line">      fetch(...).then(r => r.json()),
</span><span class="token prefix inserted">+</span><span class="token line">      fetch(...).then(r => r.json()),
</span><span class="token prefix inserted">+</span><span class="token line">    ]);
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return { a, b };
</span></span>}</code></pre></section><section class="level2"aria-labelledby="goto-changes"><h2 id="goto-changes">goto(...) changes</h2><p><code>goto(...)</code> no longer accepts external URLs. To navigate to an external URL, use <code>window.location.href = url</code>. The <code>state</code> object now determines <code>$page.state</code> and must adhere to the <code>App.PageState</code> interface, if declared. See <a href="shallow-routing">shallow routing</a> for more details.</section><section class="level2"aria-labelledby="paths-are-now-relative-by-default"><h2 id="paths-are-now-relative-by-default">paths are now relative by default</h2><p>In SvelteKit 1, <code>%sveltekit.assets%</code> in your <code>app.html</code> was replaced with a relative path by default (i.e. <code>.</code> or <code>..</code> or <code>../..</code> etc, depending on the path being rendered) during server-side rendering unless the <a href="../50-api-reference/10-configuration.html#paths"><code>paths.relative</code></a> config option was explicitly set to <code>false</code>. The same was true for <code>base</code> and <code>assets</code> imported from <code>$app/paths</code>, but only if the <code>paths.relative</code> option was explicitly set to <code>true</code>.<p>This inconsistency is fixed in version 2. Paths are either always relative or always absolute, depending on the value of <a href="../50-api-reference/10-configuration.html#paths"><code>paths.relative</code></a>. It defaults to <code>true</code> as this results in more portable apps: if the <code>base</code> is something other than the app expected (as is the case when viewed on the <a href="https://archive.org/">Internet Archive</a>, for example) or unknown at build time (as is the case when deploying to <a href="https://ipfs.tech/">IPFS</a> and so on), fewer things are likely to break.</section><section class="level2"aria-labelledby="server-fetches-are-not-trackable-anymore"><h2 id="server-fetches-are-not-trackable-anymore">Server fetches are not trackable anymore</h2><p>Previously it was possible to track URLs from <code>fetch</code>es on the server in order to rerun load functions. This poses a possible security risk (private URLs leaking), and as such it was behind the <code>dangerZone.trackServerFetches</code> setting, which is now removed.</section><section class="level2"aria-labelledby="preloadcode-arguments-must-be-prefixed-with-base"><h2 id="preloadcode-arguments-must-be-prefixed-with-base"><code>preloadCode</code> arguments must be prefixed with <code>base</code></h2><p>SvelteKit exposes two functions, <a href="../50-api-reference/30-modules.html#$app-navigation-preloadcode"><code>preloadCode</code></a> and <a href="../50-api-reference/30-modules.html#$app-navigation-preloaddata"><code>preloadData</code></a>, for programmatically loading the code and data associated with a particular path. In version 1, there was a subtle inconsistency — the path passed to <code>preloadCode</code> did not need to be prefixed with the <code>base</code> path (if set), while the path passed to <code>preloadData</code> did.<p>This is fixed in SvelteKit 2 — in both cases, the path should be prefixed with <code>base</code> if it is set.<p>Additionally, <code>preloadCode</code> now takes a single argument rather than <em>n</em> arguments.</section><section class="level2"aria-labelledby="resolvepath-has-been-removed"><h2 id="resolvepath-has-been-removed"><code>resolvePath</code> has been removed</h2><p>SvelteKit 1 included a function called <code>resolvePath</code> which allows you to resolve a route ID (like <code>/blog/[slug]</code>) and a set of parameters (like <code>{ slug: 'hello' }</code>) to a pathname. Unfortunately the return value didn't include the <code>base</code> path, limiting its usefulness in cases where <code>base</code> was set.<p>As such, SvelteKit 2 replaces <code>resolvePath</code> with a (slightly better named) function called <code>resolveRoute</code>, which is imported from <code>$app/paths</code> and which takes <code>base</code> into account.<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">import { resolvePath } from '@sveltejs/kit';
</span><span class="token prefix deleted">-</span><span class="token line">import { base } from '$app/paths';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import { resolveRoute } from '$app/paths';
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">const path = base + resolvePath('/blog/[slug]', { slug });
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">const path = resolveRoute('/blog/[slug]', { slug });</span></span></code></pre><p><code>svelte-migrate</code> will do the method replacement for you, though if you later prepend the result with <code>base</code>, you need to remove that yourself.</section><section class="level2"aria-labelledby="improved-error-handling"><h2 id="improved-error-handling">Improved error handling</h2><p>Errors are handled inconsistently in SvelteKit 1. Some errors trigger the <code>handleError</code> hook but there is no good way to discern their status (for example, the only way to tell a 404 from a 500 is by seeing if <code>event.route.id</code> is <code>null</code>), while others (such as 405 errors for <code>POST</code> requests to pages without actions) don't trigger <code>handleError</code> at all, but should. In the latter case, the resulting <code>$page.error</code> will deviate from the <a href="../50-api-reference/40-types.html#app-error"><code>App.Error</code></a> type, if it is specified.<p>SvelteKit 2 cleans this up by calling <code>handleError</code> hooks with two new properties: <code>status</code> and <code>message</code>. For errors thrown from your code (or library code called by your code) the status will be <code>500</code> and the message will be <code>Internal Error</code>. While <code>error.message</code> may contain sensitive information that should not be exposed to users, <code>message</code> is safe.</section><section class="level2"aria-labelledby="dynamic-environment-variables-cannot-be-used-during-prerendering"><h2 id="dynamic-environment-variables-cannot-be-used-during-prerendering">Dynamic environment variables cannot be used during prerendering</h2><p>The <code>$env/dynamic/public</code> and <code>$env/dynamic/private</code> modules provide access to <em>run time</em> environment variables, as opposed to the <em>build time</em> environment variables exposed by <code>$env/static/public</code> and <code>$env/static/private</code>.<p>During prerendering in SvelteKit 1, they are one and the same. As such, prerendered pages that make use of 'dynamic' environment variables are really 'baking in' build time values, which is incorrect. Worse, <code>$env/dynamic/public</code> is populated in the browser with these stale values if the user happens to land on a prerendered page before navigating to dynamically-rendered pages.<p>Because of this, dynamic environment variables can no longer be read during prerendering in SvelteKit 2 — you should use the <code>static</code> modules instead. If the user lands on a prerendered page, SvelteKit will request up-to-date values for <code>$env/dynamic/public</code> from the server (by default from a module called <code>_env.js</code> — this can be configured with <code>config.kit.env.publicModule</code>) instead of reading them from the server-rendered HTML.</section><section class="level2"aria-labelledby="form-and-data-have-been-removed-from-useenhance-callbacks"><h2 id="form-and-data-have-been-removed-from-useenhance-callbacks"><code>form</code> and <code>data</code> have been removed from <code>use:enhance</code> callbacks</h2><p>If you provide a callback to <a href="../20-core-concepts/30-form-actions.html#progressive-enhancement-use-enhance"><code>use:enhance</code></a>, it will be called with an object containing various useful properties.<p>In SvelteKit 1, those properties included <code>form</code> and <code>data</code>. These were deprecated some time ago in favour of <code>formElement</code> and <code>formData</code>, and have been removed altogether in SvelteKit 2.</section><section class="level2"aria-labelledby="forms-containing-file-inputs-must-use-multipartform-data"><h2 id="forms-containing-file-inputs-must-use-multipartform-data">Forms containing file inputs must use <code>multipart/form-data</code></h2><p>If a form contains an <code>&#x3C;input type="file"></code> but does not have an <code>enctype="multipart/form-data"</code> attribute, non-JS submissions will omit the file. SvelteKit 2 will throw an error if it encounters a form like this during a <code>use:enhance</code> submission to ensure that your forms work correctly when JavaScript is not present.</section><section class="level2"aria-labelledby="generated-tsconfigjson-is-more-strict"><h2 id="generated-tsconfigjson-is-more-strict">Generated <code>tsconfig.json</code> is more strict</h2><p>Previously, the generated <code>tsconfig.json</code> was trying its best to still produce a somewhat valid config when your <code>tsconfig.json</code> included <code>paths</code> or <code>baseUrl</code>. In SvelteKit 2, the validation is more strict and will warn when you use either <code>paths</code> or <code>baseUrl</code> in your <code>tsconfig.json</code>. These settings are used to generate path aliases and you should use <a href="configuration#alias">the <code>alias</code> config</a> option in your <code>svelte.config.js</code> instead, to also create a corresponding alias for the bundler.</section><section class="level2"aria-labelledby="getrequest-no-longer-throws-errors"><h2 id="getrequest-no-longer-throws-errors"><code>getRequest</code> no longer throws errors</h2><p>The <code>@sveltejs/kit/node</code> module exports helper functions for use in Node environments, including <code>getRequest</code> which turns a Node <a href="https://nodejs.org/api/http.html#class-httpclientrequest"><code>ClientRequest</code></a> into a standard <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request"><code>Request</code></a> object.<p>In SvelteKit 1, <code>getRequest</code> could throw if the <code>Content-Length</code> header exceeded the specified size limit. In SvelteKit 2, the error will not be thrown until later, when the request body (if any) is being read. This enables better diagnostics and simpler code.</section><section class="level2"aria-labelledby="vitepreprocess-is-no-longer-exported-from-sveltejskitvite"><h2 id="vitepreprocess-is-no-longer-exported-from-sveltejskitvite"><code>vitePreprocess</code> is no longer exported from <code>@sveltejs/kit/vite</code></h2><p>Since <code>@sveltejs/vite-plugin-svelte</code> is now a peer dependency, SvelteKit 2 no longer re-exports <code>vitePreprocess</code>. You should import it directly from <code>@sveltejs/vite-plugin-svelte</code>.</section><section class="level2"aria-labelledby="updated-dependency-requirements"><h2 id="updated-dependency-requirements">Updated dependency requirements</h2><p>SvelteKit 2 requires Node <code>18.13</code> or higher, and the following minimum dependency versions:<ul><li><code>svelte@4</code><li><code>vite@5</code><li><code>typescript@5</code><li><code>@sveltejs/vite-plugin-svelte@3</code> (this is now required as a <code>peerDependency</code> of SvelteKit — previously it was directly depended upon)<li><code>@sveltejs/adapter-cloudflare@3</code> (if you're using these adapters)<li><code>@sveltejs/adapter-cloudflare-workers@2</code><li><code>@sveltejs/adapter-netlify@3</code><li><code>@sveltejs/adapter-node@2</code><li><code>@sveltejs/adapter-static@3</code><li><code>@sveltejs/adapter-vercel@4</code></ul><p><code>svelte-migrate</code> will update your <code>package.json</code> for you.<p>As part of the TypeScript upgrade, the generated <code>tsconfig.json</code> (the one your <code>tsconfig.json</code> extends from) now uses <code>"moduleResolution": "bundler"</code> (which is recommended by the TypeScript team, as it properly resolves types from packages with an <code>exports</code> map in package.json) and <code>verbatimModuleSyntax</code> (which replaces the existing <code>importsNotUsedAsValues</code>and <code>preserveValueImports</code> flags — if you have those in your <code>tsconfig.json</code>, remove them. <code>svelte-migrate</code> will do this for you). <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section>