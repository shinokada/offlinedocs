<!doctype html><html lang="en"><meta charset="utf-8"><title>Publishing</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="layout"content="docs"><meta name="permalink"content="/docs/handbook/declaration-files/publishing.html"><meta name="oneline"content="How to get your d.ts files to users"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><p>Now that you have authored a declaration file following the steps of this guide, it is time to publish it to npm. There are two main ways you can publish your declaration files to npm:<ol><li>bundling with your npm package<li>publishing to the <a href="https://www.npmjs.com/~types">@types organization</a> on npm.</ol><p>If your types are generated by your source code, publish the types with your source code. Both TypeScript and JavaScript projects can generate types via <a href="/tsconfig#declaration"><code>declaration</code></a>.<p>Otherwise, we recommend submitting the types to DefinitelyTyped, which will publish them to the <code>@types</code> organization on npm.<section id="including-declarations-in-your-npm-package"class="level2"><h2>Including declarations in your npm package</h2><p>If your package has a main <code>.js</code> file, you will need to indicate the main declaration file in your <code>package.json</code> file as well. Set the <code>types</code> property to point to your bundled declaration file. For example:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"awesome"</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"Vandelay Industries"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"./lib/main.js"</span><span class="token punctuation">,</span>
  <span class="token property">"types"</span><span class="token operator">:</span> <span class="token string">"./lib/main.d.ts"</span>
<span class="token punctuation">}</span></code></pre><p>Note that the <code>"typings"</code> field is synonymous with <code>types</code>, and could be used as well.<p>Also note that if your main declaration file is named <code>index.d.ts</code> and lives at the root of the package (next to <code>index.js</code>) you do not need to mark the <code>types</code> property, though it is advisable to do so.</section><section id="dependencies"class="level2"><h2>Dependencies</h2><p>All dependencies are managed by npm. Make sure all the declaration packages you depend on are marked appropriately in the <code>"dependencies"</code> section in your <code>package.json</code>. For example, imagine we authored a package that used Browserify and TypeScript.<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"browserify-typescript-extension"</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"Vandelay Industries"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"./lib/main.js"</span><span class="token punctuation">,</span>
  <span class="token property">"types"</span><span class="token operator">:</span> <span class="token string">"./lib/main.d.ts"</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"browserify"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"@types/browserify"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"typescript"</span><span class="token operator">:</span> <span class="token string">"next"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Here, our package depends on the <code>browserify</code> and <code>typescript</code> packages. <code>browserify</code> does not bundle its declaration files with its npm packages, so we needed to depend on <code>@types/browserify</code> for its declarations. <code>typescript</code>, on the other hand, packages its declaration files, so there was no need for any additional dependencies.<p>Our package exposes declarations from each of those, so any user of our <code>browserify-typescript-extension</code> package needs to have these dependencies as well. For that reason, we used <code>"dependencies"</code> and not <code>"devDependencies"</code>, because otherwise our consumers would have needed to manually install those packages. If we had just written a command line application and not expected our package to be used as a library, we might have used <code>devDependencies</code>.</section><section id="red-flags"class="level2"><h2>Red flags</h2><section id="-reference-path-"class="level3"><h3><code>/// &#x3C;reference path="..." /></code></h3><p><em>Don't</em> use <code>/// &#x3C;reference path="..." /></code> in your declaration files.<pre class="language-ts"><code class="language-ts"><span class="token comment">/// &#x3C;reference path="../typescript/lib/typescriptServices.d.ts" /></span>
<span class="token spread operator">...</span><span class="token punctuation">.</span></code></pre><p><em>Do</em> use <code>/// &#x3C;reference types="..." /></code> instead.<pre class="language-ts"><code class="language-ts"><span class="token comment">/// &#x3C;reference types="typescript" /></span>
<span class="token spread operator">...</span><span class="token punctuation">.</span></code></pre><p>Make sure to revisit the <a href="/docs/handbook/declaration-files/library-structures.html#consuming-dependencies">Consuming dependencies</a> section for more information.</section><section id="packaging-dependent-declarations"class="level3"><h3>Packaging dependent declarations</h3><p>If your type definitions depend on another package:<ul><li><em>Don't</em> combine it with yours, keep each in their own file.<li><em>Don't</em> copy the declarations in your package either.<li><em>Do</em> depend on the npm type declaration package if it doesn't package its declaration files.</ul></section></section><section id="version-selection-with-typesversions"class="level2"><h2>Version selection with <code>typesVersions</code></h2><p>When TypeScript opens a <code>package.json</code> file to figure out which files it needs to read, it first looks at a field called <code>typesVersions</code>.<section id="folder-redirects-using-"class="level4"><h4>Folder redirects (using <code>*</code>)</h4><p>A <code>package.json</code> with a <code>typesVersions</code> field might look like this:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"package-name"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"types"</span><span class="token operator">:</span> <span class="token string">"./index.d.ts"</span><span class="token punctuation">,</span>
  <span class="token property">"typesVersions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">">=3.1"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"ts3.1/*"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>This <code>package.json</code> tells TypeScript to first check the current version of TypeScript. If it's 3.1 or later, TypeScript figures out the path you've imported relative to the package, and reads from the package's <code>ts3.1</code> folder.<p>That's what that <code>{ "*": ["ts3.1/*"] }</code> means - if you're familiar with <a href="/tsconfig#paths">path mapping</a>, it works exactly like that.<p>In the above example, if we're importing from <code>"package-name"</code>, TypeScript will try to resolve from <code>[...]/node_modules/package-name/ts3.1/index.d.ts</code> (and other relevant paths) when running in TypeScript 3.1. If we import from <code>package-name/foo</code>, we'll try to look for <code>[...]/node_modules/package-name/ts3.1/foo.d.ts</code> and <code>[...]/node_modules/package-name/ts3.1/foo/index.d.ts</code>.<p>What if we're not running in TypeScript 3.1 in this example? Well, if none of the fields in <code>typesVersions</code> get matched, TypeScript falls back to the <code>types</code> field, so here TypeScript 3.0 and earlier will be redirected to <code>[...]/node_modules/package-name/index.d.ts</code>.</section><section id="file-redirects"class="level4"><h4>File redirects</h4><p>When you want to only change the resolution for a single file at a time, you can tell TypeScript the file to resolve differently by passing in the exact filenames:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"package-name"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"types"</span><span class="token operator">:</span> <span class="token string">"./index.d.ts"</span><span class="token punctuation">,</span>
  <span class="token property">"typesVersions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"&#x3C;4.0"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"index.d.ts"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"index.v3.d.ts"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>On TypeScript 4.0 and above, an import for <code>"package-name"</code> would resolve to <code>./index.d.ts</code> and for 3.9 and below <code>"./index.v3.d.ts</code>.</section></section><section id="matching-behavior"class="level2"><h2>Matching behavior</h2><p>The way that TypeScript decides on whether a version of the compiler &#x26; language matches is by using Node's <a href="https://github.com/npm/node-semver#ranges">semver ranges</a>.</section><section id="multiple-fields"class="level2"><h2>Multiple fields</h2><p><code>typesVersions</code> can support multiple fields where each field name is specified by the range to match on.<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"package-name"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0"</span><span class="token punctuation">,</span>
  <span class="token property">"types"</span><span class="token operator">:</span> <span class="token string">"./index.d.ts"</span><span class="token punctuation">,</span>
  <span class="token property">"typesVersions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">">=3.2"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"ts3.2/*"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">">=3.1"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"ts3.1/*"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Since ranges have the potential to overlap, determining which redirect applies is order-specific. That means in the above example, even though both the <code>>=3.2</code> and the <code>>=3.1</code> matchers support TypeScript 3.2 and above, reversing the order could have different behavior, so the above sample would not be equivalent to the following.<pre class="language-jsonc"><code class="language-jsonc">{
  "name": "package-name",
  "version": "1.0",
  "types": "./index.d.ts",
  "typesVersions": {
    // NOTE: this doesn't work!
    ">=3.1": { "*": ["ts3.1/*"] },
    ">=3.2": { "*": ["ts3.2/*"] }
  }
}</code></pre></section><section id="publish-to-types"class="level2"><h2>Publish to <a href="https://www.npmjs.com/~types">@types</a></h2><p>Packages under the <a href="https://www.npmjs.com/~types">@types</a> organization are published automatically from <a href="https://github.com/DefinitelyTyped/DefinitelyTyped">DefinitelyTyped</a> using the <a href="https://github.com/microsoft/DefinitelyTyped-tools/tree/master/packages/publisher">types-publisher tool</a>. To get your declarations published as an @types package, please submit a pull request to <a href="https://github.com/DefinitelyTyped/DefinitelyTyped">DefinitelyTyped</a>. You can find more details in the <a href="https://definitelytyped.org/guides/contributing.html">contribution guidelines page</a>. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section>