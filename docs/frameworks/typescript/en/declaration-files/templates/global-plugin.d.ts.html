<!doctype html><html lang="en"><meta charset="utf-8"><title>Global: Plugin</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="layout"content="docs"><meta name="permalink"content="/docs/handbook/declaration-files/templates/global-plugin-d-ts.html"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="umd"class="level2"><h2><em>UMD</em></h2><p>A <em>UMD</em> module is one that can <em>either</em> be used as module (through an import), or as a global (when run in an environment without a module loader). Many popular libraries, such as <a href="http://momentjs.com/">Moment.js</a>, are written this way. For example, in Node.js or using RequireJS, you would write:<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> moment <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">"moment"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>moment<span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>whereas in a vanilla browser environment you would write:<pre class="language-js"><code class="language-js"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>moment<span class="token punctuation">.</span><span class="token method function property-access">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><section id="identifying-a-umd-library"class="level3"><h3>Identifying a UMD library</h3><p><a href="https://github.com/umdjs/umd">UMD modules</a> check for the existence of a module loader environment. This is an easy-to-spot pattern that looks something like this:<pre class="language-js"><code class="language-js"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">"function"</span> <span class="token operator">&#x26;&#x26;</span> define<span class="token punctuation">.</span><span class="token property-access">amd</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"libName"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> module <span class="token operator">===</span> <span class="token string">"object"</span> <span class="token operator">&#x26;&#x26;</span> module<span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"libName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        root<span class="token punctuation">.</span><span class="token property-access">returnExports</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token property-access">libName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code></pre><p>If you see tests for <code>typeof define</code>, <code>typeof window</code>, or <code>typeof module</code> in the code of a library, especially at the top of the file, it's almost always a UMD library.<p>Documentation for UMD libraries will also often demonstrate a "Using in Node.js" example showing <code>require</code>, and a "Using in the browser" example showing using a <code>&#x3C;script></code> tag to load the script.</section><section id="examples-of-umd-libraries"class="level3"><h3>Examples of UMD libraries</h3><p>Most popular libraries are now available as UMD packages. Examples include <a href="https://jquery.com/">jQuery</a>, <a href="http://momentjs.com/">Moment.js</a>, <a href="https://lodash.com/">lodash</a>, and many more.</section><section id="template"class="level3"><h3>Template</h3><p>There are three templates available for modules, <a href="/docs/handbook/declaration-files/templates/module-d-ts.html"><code>module.d.ts</code></a>, <a href="/docs/handbook/declaration-files/templates/module-class-d-ts.html"><code>module-class.d.ts</code></a> and <a href="/docs/handbook/declaration-files/templates/module-function-d-ts.html"><code>module-function.d.ts</code></a>.<p>Use <a href="/docs/handbook/declaration-files/templates/module-function-d-ts.html"><code>module-function.d.ts</code></a> if your module can be <em>called</em> like a function:<pre class="language-js"><code class="language-js"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Note: calling 'x' as a function</span>
<span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Be sure to read the <a href="#the-impact-of-es6-on-module-plugins">footnote "The Impact of ES6 on Module Call Signatures"</a><p>Use <a href="/docs/handbook/declaration-files/templates/module-class-d-ts.html"><code>module-class.d.ts</code></a> if your module can be <em>constructed</em> using <code>new</code>:<pre class="language-js"><code class="language-js"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"bar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Note: using 'new' operator on the imported variable</span>
<span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">x</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The same <a href="#the-impact-of-es6-on-module-plugins">footnote</a> applies to these modules.<p>If your module is not callable or constructable, use the <a href="/docs/handbook/declaration-files/templates/module-d-ts.html"><code>module.d.ts</code></a> file.</section></section><section id="module-plugin-or-umd-plugin"class="level2"><h2><em>Module Plugin</em> or <em>UMD Plugin</em></h2><p>A <em>module plugin</em> changes the shape of another module (either UMD or module). For example, in Moment.js, <code>moment-range</code> adds a new <code>range</code> method to the <code>moment</code> object.<p>For the purposes of writing a declaration file, you'll write the same code whether the module being changed is a plain module or UMD module.<section id="template-1"class="level3"><h3>Template</h3><p>Use the <a href="/docs/handbook/declaration-files/templates/module-plugin-d-ts.html"><code>module-plugin.d.ts</code></a> template.</section></section><section id="global-plugin"class="level2"><h2><em>Global Plugin</em></h2><p>A <em>global plugin</em> is global code that changes the shape of some global. As with <em>global-modifying modules</em>, these raise the possibility of runtime conflict.<p>For example, some libraries add new functions to <code>Array.prototype</code> or <code>String.prototype</code>.<section id="identifying-global-plugins"class="level3"><h3>Identifying global plugins</h3><p>Global plugins are generally easy to identify from their documentation.<p>You'll see examples that look like this:<pre class="language-js"><code class="language-js"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>
<span class="token comment">// Creates new methods on built-in types</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token method function property-access">startsWithHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// Creates new methods on built-in types</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span><span class="token method function property-access">reverseAndSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="template-2"class="level3"><h3>Template</h3><p>Use the <a href="/docs/handbook/declaration-files/templates/global-plugin-d-ts.html"><code>global-plugin.d.ts</code></a> template.</section></section><section id="global-modifying-modules"class="level2"><h2><em>Global-modifying Modules</em></h2><p>A <em>global-modifying module</em> alters existing values in the global scope when they are imported. For example, there might exist a library which adds new members to <code>String.prototype</code> when imported. This pattern is somewhat dangerous due to the possibility of runtime conflicts, but we can still write a declaration file for it.<section id="identifying-global-modifying-modules"class="level3"><h3>Identifying global-modifying modules</h3><p>Global-modifying modules are generally easy to identify from their documentation. In general, they're similar to global plugins, but need a <code>require</code> call to activate their effects.<p>You might see documentation like this:<pre class="language-js"><code class="language-js"><span class="token comment">// 'require' call that doesn't use its return value</span>
<span class="token keyword">var</span> unused <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"magic-string-time"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* or */</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"magic-string-time"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>
<span class="token comment">// Creates new methods on built-in types</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token method function property-access">startsWithHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// Creates new methods on built-in types</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span><span class="token method function property-access">reverseAndSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="template-3"class="level3"><h3>Template</h3><p>Use the <a href="./templates/global-modifying-module.d.ts.md"><code>global-modifying-module.d.ts</code></a> template.</section></section><section id="consuming-dependencies"class="level2"><h2>Consuming Dependencies</h2><p>There are several kinds of dependencies your library might have. This section shows how to import them into the declaration file.</section><section id="dependencies-on-global-libraries"class="level2"><h2>Dependencies on Global Libraries</h2><p>If your library depends on a global library, use a <code>/// &#x3C;reference types="..." /></code> directive:<pre class="language-ts"><code class="language-ts"><span class="token comment">/// &#x3C;reference types="someLib" /></span>

<span class="token keyword">function</span> <span class="token function">getThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> someLib<span class="token punctuation">.</span><span class="token property-access">thing</span><span class="token punctuation">;</span></code></pre></section><section id="dependencies-on-modules"class="level2"><h2>Dependencies on Modules</h2><p>If your library depends on a module, use an <code>import</code> statement:<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> moment</span> <span class="token keyword module">from</span> <span class="token string">"moment"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> moment<span class="token punctuation">;</span></code></pre></section><section id="dependencies-on-umd-libraries"class="level2"><h2>Dependencies on UMD libraries</h2><section id="from-a-global-library"class="level3"><h3>From a Global Library</h3><p>If your global library depends on a UMD module, use a <code>/// &#x3C;reference types</code> directive:<pre class="language-ts"><code class="language-ts"><span class="token comment">/// &#x3C;reference types="moment" /></span>

<span class="token keyword">function</span> <span class="token function">getThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> moment<span class="token punctuation">;</span></code></pre></section><section id="from-a-module-or-umd-library"class="level3"><h3>From a Module or UMD Library</h3><p>If your module or UMD library depends on a UMD library, use an <code>import</code> statement:<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> someLib</span> <span class="token keyword module">from</span> <span class="token string">"someLib"</span><span class="token punctuation">;</span></code></pre><p>Do <em>not</em> use a <code>/// &#x3C;reference</code> directive to declare a dependency to a UMD library!</section></section><section id="footnotes"class="level2"><h2>Footnotes</h2></section><section id="preventing-name-conflicts"class="level2"><h2>Preventing Name Conflicts</h2><p>Note that it's possible to define many types in the global scope when writing a global declaration file. We strongly discourage this as it leads to possible unresolvable name conflicts when many declaration files are in a project.<p>A simple rule to follow is to only declare types <em>namespaced</em> by whatever global variable the library defines. For example, if the library defines the global value 'cats', you should write<pre class="language-ts"><code class="language-ts"><span class="token keyword">declare</span> <span class="token keyword">namespace</span> cats <span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">KittySettings</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>But <em>not</em><pre class="language-ts"><code class="language-ts"><span class="token comment">// at top-level</span>
<span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">CatsKittySettings</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>This guidance also ensures that the library can be transitioned to UMD without breaking declaration file users.</section><section id="the-impact-of-es6-on-module-plugins"class="level2"><h2>The Impact of ES6 on Module Plugins</h2><p>Some plugins add or modify top-level exports on existing modules. While this is legal in CommonJS and other loaders, ES6 modules are considered immutable and this pattern will not be possible. Because TypeScript is loader-agnostic, there is no compile-time enforcement of this policy, but developers intending to transition to an ES6 module loader should be aware of this.</section><section id="the-impact-of-es6-on-module-call-signatures"class="level2"><h2>The Impact of ES6 on Module Call Signatures</h2><p>Many popular libraries, such as Express, expose themselves as a callable function when imported. For example, the typical Express usage looks like this:<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> exp <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>In ES6 module loaders, the top-level object (here imported as <code>exp</code>) can only have properties; the top-level module object is <em>never</em> callable. The most common solution here is to define a <code>default</code> export for a callable/constructable object; some module loader shims will automatically detect this situation and replace the top-level object with the <code>default</code> export.</section><section id="library-file-layout"class="level2"><h2>Library file layout</h2><p>The layout of your declaration files should mirror the layout of the library.<p>A library can consist of multiple modules, such as<pre class="language-text"><code class="language-text">myLib
  +---- index.js
  +---- foo.js
  +---- bar
         +---- index.js
         +---- baz.js</code></pre><p>These could be imported as<pre class="language-js"><code class="language-js"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"myLib"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"myLib/foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"myLib/bar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"myLib/bar/baz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Your declaration files should thus be<pre class="language-text"><code class="language-text">@types/myLib
  +---- index.d.ts
  +---- foo.d.ts
  +---- bar
         +---- index.d.ts
         +---- baz.d.ts</code></pre><pre class="language-ts"><code class="language-ts"><span class="token comment">// Type definitions for [~THE LIBRARY NAME~] [~OPTIONAL VERSION NUMBER~]</span>
<span class="token comment">// Project: [~THE PROJECT NAME~]</span>
<span class="token comment">// Definitions by: [~YOUR NAME~] &#x3C;[~A URL FOR YOU~]></span>

<span class="token comment">/*~ This template shows how to write a global plugin. */</span>

<span class="token comment">/*~ Write a declaration for the original type and add new members.
 *~ For example, this adds a 'toBinaryString' method with overloads to
 *~ the built-in number type.
 */</span>
<span class="token keyword">interface</span> <span class="token class-name"><span class="token known-class-name class-name">Number</span></span> <span class="token punctuation">{</span>
  <span class="token function">toBinaryString</span><span class="token punctuation">(</span>opts<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">MyLibrary</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">BinaryFormatOptions</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token function">toBinaryString</span><span class="token punctuation">(</span>
    callback<span class="token operator">:</span> <span class="token maybe-class-name">MyLibrary</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">BinaryFormatCallback</span></span><span class="token punctuation">,</span>
    opts<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">MyLibrary</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">BinaryFormatOptions</span></span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*~ If you need to declare several types, place them inside a namespace
 *~ to avoid adding too many things to the global namespace.
 */</span>
<span class="token keyword">declare</span> <span class="token keyword">namespace</span> <span class="token maybe-class-name">MyLibrary</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">BinaryFormatCallback</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>n<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">BinaryFormatOptions</span></span> <span class="token punctuation">{</span>
    prefix<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    padding<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section>