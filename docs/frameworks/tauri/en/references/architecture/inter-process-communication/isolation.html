<!doctypehtml><html lang="en"><meta charset="utf-8"><title>Isolation Pattern</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css"><section id="isolation-pattern"class="level1"><h1>Isolation Pattern</h1><p>The Isolation pattern is a way to intercept and modify Tauri API messages sent by the frontend before they get to Tauri Core, all with JavaScript. The secure JavaScript code that is injected by the Isolation pattern is referred to as the Isolation application.<section id="why"class="level2"><h2>Why</h2><p>The Isolation pattern's purpose is to provide a mechanism for developers to help protect their application from unwanted or malicious frontend calls to Tauri Core. The need for the Isolation pattern rose out of threats coming from untrusted content running on the frontend, a common case for applications with many dependencies. See <a href="../../security.md#threat-models">Security: Threat Models</a> for a list of many sources of threats that an application may see.<p>The largest threat model described above that the Isolation pattern was designed in mind was Development Threats. Not only do many frontend build-time tools consist of many dozen (or hundreds) of often deeply-nested dependencies, but a complex application may also have a large amount of (also often deeply-nested) dependencies that are bundled into the final output.</section><section id="when"class="level2"><h2>When</h2><p>Tauri highly recommends using the isolation pattern whenever it can be used. Because the Isolation application intercepts <em><strong>all</strong></em> messages from the frontend, it can <em>always</em> be used.<p>Tauri also strongly suggests locking down your application whenever you use external Tauri APIs. As the developer, you can utilize the secure Isolation application to try and verify IPC inputs, to make sure they are within some expected parameters. For example, you may want to check that a call to read or write a file is not trying to access a path outside your application's expected locations. Another example is making sure that a Tauri API HTTP fetch call is only setting the Origin header to what your application expects it to be.<p>That said, it intercepts <em><strong>all</strong></em> messages from the frontend, so it will even work with always-on APIs such as <a href="../../../guides/features/events.md">Events</a>. Since some events may cause your own rust code to perform actions, the same sort of validation techniques can be used with them.</section><section id="how"class="level2"><h2>How</h2><p>The Isolation pattern is all about injecting a secure application in between your frontend and Tauri Core to intercept and modify incoming IPC messages. It does this by using the sandboxing feature of <code>&#x3C;iframe></code>s to run the JavaScript securely alongside the main frontend application. Tauri enforces the Isolation pattern while loading the page, forcing all IPC calls to Tauri Core to instead be routed through the sandboxed Isolation application first. Once the message is ready to be passed to Tauri Core, it is encrypted using the browser's <a href="https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto">SubtleCrypto</a> implementation and passed back to the main frontend application. Once there, it is directly passed to Tauri Core, where it is then decrypted and read like normal.<p>To ensure that someone cannot manually read the keys for a specific version of your application and use that to modify the messages after being encrypted, new keys are generated each time your application is run.<section id="approximate-steps-of-an-ipc-message"class="level3"><h3>Approximate Steps of an IPC Message</h3><p>To make it easier to follow, here's an ordered list with the approximate steps an IPC message will go through when being sent to Tauri Core with the Isolation pattern:<ol><li>Tauri's IPC handler receives a message<li>IPC handler -> Isolation application<li><code>[sandbox]</code> Isolation application hook runs and potentially modifies the message<li><code>[sandbox]</code> Message is encrypted with AES-GCM using a runtime-generated key<li><code>[encrypted]</code> Isolation application -> IPC handler<li><code>[encrypted]</code> IPC handler -> Tauri Core</ol><p><em>Note: Arrows (->) indicate message passing.</em></section><section id="performance-implications"class="level3"><h3>Performance Implications</h3><p>Because encryption of the message does occur, there are additional overhead costs compared to the <a href="./brownfield.md">Brownfield pattern</a>, even if the secure Isolation application doesn't do anything. Aside from performance-sensitive applications (who likely have a carefully-maintained and small set of dependencies, to keep the performance adequate), most applications should not notice the runtime costs of encrypting/decrypting the IPC messages, as they are relatively small and AES-GCM is relatively fast. If you are unfamiliar with AES-GCM, all that is relevant in this context is that it's the only authenticated mode algorithm included in <a href="https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto">SubtleCrypto</a> and that you probably already use it every day under the hood with <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a>.<p>There is also a cryptographically secure key generated once each time the Tauri application is started. It is not generally noticeable if the system already has enough entropy to immediately return enough random numbers, which is extremely common for desktop environments. If running in a headless environment to perform some <a href="../../../guides/testing/webdriver/introduction.md">integration testing with WebDriver</a> then you may want to install some sort of entropy-generating service such as <code>haveged</code> if your operating system does not have one included. <sup>Linux 5.6 (March 2020) now includes entropy generation using speculative execution.</sup></section><section id="limitations"class="level3"><h3>Limitations</h3><p>There are a few limitations in the Isolation pattern that arose out of platform inconsistencies. The most significant limitation is due to external files not loading correctly inside sandboxed <code>&#x3C;iframes></code> on Windows. Because of this, we have implemented a simple script inlining step during build time that takes the content of scripts relative to the Isolation application and injects them inline. This means that typical bundling or simple including of files like <code>&#x3C;script src=index.js>&#x3C;/script></code> still works properly, but newer mechanisms such as ES Modules will <em>not</em> successfully load.</section></section><section id="recommendations"class="level2"><h2>Recommendations</h2><p>Because the point of the Isolation application is to protect against Development Threats, we highly recommend keeping your Isolation application as simple as possible. Not only should you strive to keep dependencies minimal, but you should also consider keeping required build steps minimal. This would allow you to not need to worry about supply chain attacks against your Isolation application on top of your frontend application.</section><section id="creating-the-isolation-application"class="level2"><h2>Creating the Isolation Application</h2><p>In this example, we will make a small hello-world style Isolation application and hook it up to an imaginary existing Tauri application. It will do no verification of the messages passing through it, only print the contents to the WebView console.<p>For the purposes of this example, let's imagine we are in the same directory as <code>tauri.conf.json</code>. The existing Tauri application has it's <code>distDir</code> set to <code>../dist</code>.<p><code>../dist-isolation/index.html</code>:<pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&#x3C;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>en</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>UTF-8</span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>title</span><span class="token punctuation">></span></span>Isolation Secure Script<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>title</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>index.js</span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><code>../dist-isolation/index.js</code>:<pre class="language-js"><code class="language-js"><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">__TAURI_ISOLATION_HOOK__</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// let's not verify or modify anything, just print the content from the hook</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'hook'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
  <span class="token keyword control-flow">return</span> payload
<span class="token punctuation">}</span></code></pre><p>Now, all we need to do is set up our <code>tauri.conf.json</code> <a href="#configuration">configuration</a> to use the Isolation pattern, and have just bootstrapped to the Isolation pattern from the <a href="./brownfield.md">Brownfield pattern</a>.</section><section id="configuration"class="level2"><h2>Configuration</h2><p>Let's assume that our main frontend <code>distDir</code> is set to <code>../dist</code>. We also output our Isolation application to <code>../dist-isolation</code>.<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  build<span class="token operator">:</span> <span class="token punctuation">{</span>
    distDir<span class="token operator">:</span> ../dist
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  tauri<span class="token operator">:</span> <span class="token punctuation">{</span>
    pattern<span class="token operator">:</span> <span class="token punctuation">{</span>
      use<span class="token operator">:</span> isolation<span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        dir<span class="token operator">:</span> ../dist-isolation
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="../../../index.html#toc">Go to TOC</a></span></section></section>