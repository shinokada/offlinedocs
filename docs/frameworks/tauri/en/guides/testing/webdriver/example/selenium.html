<!doctype html><html lang="en"><meta charset="utf-8"><title>Selenium</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="sidebar_position"content="2"><link rel="stylesheet"href="../../../../../../../../../Vivliostyle/read-html-download-pdf/docs/themes/packages/prism-coy-theme/theme_common.css"><p>import Tabs from '@theme/Tabs' import TabItem from '@theme/TabItem'<section class="level1"aria-labelledby="selenium"><h1 id="selenium">Selenium</h1><blockquote>Example Application This [Selenium] guide expects you to have already gone through the [example Application setup] to follow step-by-step. The general information may still be helpful otherwise.otherwise.</blockquote><p>This WebDriver testing example will use <a href="https://selenium.dev/">Selenium</a> and a popular Node.js testing suite. You are expected to already have Node.js installed, along with <code>npm</code> or <code>yarn</code> although the <a href="https://github.com/chippers/hello_tauri">finished example project</a> uses <code>yarn</code>.<section class="level2"aria-labelledby="create-a-directory-for-the-tests"><h2 id="create-a-directory-for-the-tests">Create a Directory for the Tests</h2><p>Let's create a space to write these tests in our project. We will be using a nested directory for this example project as we will later also go over other frameworks, but typically you will only need to use one. Create the directory we will use with <code>mkdir -p webdriver/selenium</code>. The rest of this guide will assume you are inside the <code>webdriver/selenium</code> directory.</section><section class="level2"aria-labelledby="initializing-a-selenium-project"><h2 id="initializing-a-selenium-project">Initializing a Selenium Project</h2><p>We will be using a pre-existing <code>package.json</code> to bootstrap this test suite because we have already chosen specific dependencies to use and want to showcase a simple working solution. The bottom of this section has a collapsed guide on how to set it up from scratch.<p><code>package.json</code>:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  name<span class="token operator">:</span> selenium<span class="token punctuation">,</span>
  version<span class="token operator">:</span> <span class="token number">1.0</span>.<span class="token number">0</span><span class="token punctuation">,</span>
  private<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  scripts<span class="token operator">:</span> <span class="token punctuation">{</span>
    test<span class="token operator">:</span> mocha
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  dependencies<span class="token operator">:</span> <span class="token punctuation">{</span>
    chai<span class="token operator">:</span> ^<span class="token number">4.3</span>.<span class="token number">4</span><span class="token punctuation">,</span>
    mocha<span class="token operator">:</span> ^<span class="token number">9.0</span>.<span class="token number">3</span><span class="token punctuation">,</span>
    selenium-webdriver<span class="token operator">:</span> ^<span class="token number">4.0</span>.<span class="token number">0</span>-beta.<span class="token number">4</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>We have a script that runs <a href="https://mochajs.org/">Mocha</a> as a test framework exposed as the <code>test</code> command. We also have various dependencies that we will be using to run the tests. <a href="https://mochajs.org/">Mocha</a> as the testing framework, <a href="https://www.chaijs.com/">Chai</a> as the assertion library, and <a href="https://www.npmjs.com/package/selenium-webdriver"><code>selenium-webdriver</code></a> which is the Node.js <a href="https://selenium.dev/">Selenium</a> package.<details><summary>Click me if you want to see how to set a project up from scratch</summary><p>If you want to install the dependencies from scratch, just run the following command.<p>&#x3C;Tabs groupId=package-manager defaultValue=yarn values={[ {label: 'npm', value: 'npm'}, {label: 'Yarn', value: 'yarn'}, ]}><tabitem value="npm"></tabitem><pre class="language-shell"><code class="language-shell"><span class="token function">npm</span> <span class="token function">install</span> mocha chai selenium-webdriver</code></pre><tabitem value="yarn"><pre class="language-shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token function">add</span> mocha chai selenium-webdriver</code></pre></tabitem><p>I suggest also adding a <code>test: mocha</code> item in the <code>package.json</code> <code>scripts</code> key so that running Mocha can be called simply with<p>&#x3C;Tabs groupId=package-manager defaultValue=yarn values={[ {label: 'npm', value: 'npm'}, {label: 'Yarn', value: 'yarn'}, ]}><tabitem value="npm"></tabitem><pre class="language-shell"><code class="language-shell"><span class="token function">npm</span> <span class="token builtin class-name">test</span></code></pre><tabitem value="yarn"><pre class="language-shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token builtin class-name">test</span></code></pre></tabitem></details></section><section class="level2"aria-labelledby="testing"><h2 id="testing">Testing</h2><p>Unlike the <a href="webdriverio#config">WebdriverIO Test Suite</a>, Selenium does not come out of the box with a Test Suite and leaves it up to the developer to build those out. We chose <a href="https://mochajs.org/">Mocha</a>, which is pretty neutral and not related to WebDrivers, so our script will need to do a bit of work to set up everything for us in the correct order. <a href="https://mochajs.org/">Mocha</a> expects a testing file at <code>test/test.js</code> by default, so let's create that file now.<p><code>test/test.js</code>:<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> expect <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chai'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> spawn<span class="token punctuation">,</span> spawnSync <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Builder</span><span class="token punctuation">,</span> <span class="token maybe-class-name">By</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Capabilities</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'selenium-webdriver'</span><span class="token punctuation">)</span>

<span class="token comment">// create the path to the expected application binary</span>
<span class="token keyword">const</span> application <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>
  __dirname<span class="token punctuation">,</span>
  <span class="token string">'..'</span><span class="token punctuation">,</span>
  <span class="token string">'..'</span><span class="token punctuation">,</span>
  <span class="token string">'..'</span><span class="token punctuation">,</span>
  <span class="token string">'target'</span><span class="token punctuation">,</span>
  <span class="token string">'release'</span><span class="token punctuation">,</span>
  <span class="token string">'hello-tauri-webdriver'</span>
<span class="token punctuation">)</span>

<span class="token comment">// keep track of the webdriver instance we create</span>
<span class="token keyword">let</span> driver

<span class="token comment">// keep track of the tauri-driver process we start</span>
<span class="token keyword">let</span> tauriDriver

<span class="token function">before</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// set timeout to 2 minutes to allow the program to build if it needs to</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">timeout</span><span class="token punctuation">(</span><span class="token number">120000</span><span class="token punctuation">)</span>

  <span class="token comment">// ensure the program has been built</span>
  <span class="token function">spawnSync</span><span class="token punctuation">(</span><span class="token string">'cargo'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'build'</span><span class="token punctuation">,</span> <span class="token string">'--release'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token comment">// start tauri-driver</span>
  tauriDriver <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span>
    path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token method function property-access">homedir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'.cargo'</span><span class="token punctuation">,</span> <span class="token string">'bin'</span><span class="token punctuation">,</span> <span class="token string">'tauri-driver'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token property-access">stdout</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token property-access">stderr</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">const</span> capabilities <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Capabilities</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  capabilities<span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token string">'tauri:options'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> application <span class="token punctuation">}</span><span class="token punctuation">)</span>
  capabilities<span class="token punctuation">.</span><span class="token method function property-access">setBrowserName</span><span class="token punctuation">(</span><span class="token string">'wry'</span><span class="token punctuation">)</span>

  <span class="token comment">// start the webdriver client</span>
  driver <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword">new</span> <span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">withCapabilities</span><span class="token punctuation">(</span>capabilities<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">usingServer</span><span class="token punctuation">(</span><span class="token string">'http://localhost:4444/'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">after</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// stop the webdriver session</span>
  <span class="token keyword control-flow">await</span> driver<span class="token punctuation">.</span><span class="token method function property-access">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// kill the tauri-driver process</span>
  tauriDriver<span class="token punctuation">.</span><span class="token method function property-access">kill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Hello Tauri'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should be cordial'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword control-flow">await</span> driver<span class="token punctuation">.</span><span class="token method function property-access">findElement</span><span class="token punctuation">(</span><span class="token maybe-class-name">By</span><span class="token punctuation">.</span><span class="token method function property-access">css</span><span class="token punctuation">(</span><span class="token string">'body > h1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[hH]ello</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should be excited'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword control-flow">await</span> driver<span class="token punctuation">.</span><span class="token method function property-access">findElement</span><span class="token punctuation">(</span><span class="token maybe-class-name">By</span><span class="token punctuation">.</span><span class="token method function property-access">css</span><span class="token punctuation">(</span><span class="token string">'body > h1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">!$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should be easy on the eyes'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// selenium returns color css values as rgb(r, g, b)</span>
    <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword control-flow">await</span> driver
      <span class="token punctuation">.</span><span class="token method function property-access">findElement</span><span class="token punctuation">(</span><span class="token maybe-class-name">By</span><span class="token punctuation">.</span><span class="token method function property-access">css</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">getCssValue</span><span class="token punctuation">(</span><span class="token string">'background-color'</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> rgb <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^rgb\((?&#x3C;r>\d+), (?&#x3C;g>\d+), (?&#x3C;b>\d+)\)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">groups</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>rgb<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token property-access">have</span><span class="token punctuation">.</span><span class="token property-access">all</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> luma <span class="token operator">=</span> <span class="token number">0.2126</span> <span class="token operator">*</span> rgb<span class="token punctuation">.</span><span class="token property-access">r</span> <span class="token operator">+</span> <span class="token number">0.7152</span> <span class="token operator">*</span> rgb<span class="token punctuation">.</span><span class="token property-access">g</span> <span class="token operator">+</span> <span class="token number">0.0722</span> <span class="token operator">*</span> rgb<span class="token punctuation">.</span><span class="token property-access">b</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>luma<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token property-access">be</span><span class="token punctuation">.</span><span class="token method function property-access">lessThan</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>If you are familiar with JS testing frameworks, <code>describe</code>, <code>it</code>, and <code>expect</code> should look familiar. We also have semi-complex <code>before()</code> and <code>after()</code> callbacks to set up and teardown mocha. Lines that are not the tests themselves have comments explaining the setup and teardown code. If you were familiar with the Spec file from the <a href="webdriverio#spec">WebdriverIO example</a>, you notice a lot more code that isn't tests, as we have to set up a few more WebDriver related items.</section><section class="level2"aria-labelledby="running-the-test-suite"><h2 id="running-the-test-suite">Running the Test Suite</h2><p>Now that we are all set up with our dependencies and our test script, let's run it!<p>&#x3C;Tabs groupId=package-manager defaultValue=yarn values={[ {label: 'npm', value: 'npm'}, {label: 'Yarn', value: 'yarn'}, ]}><tabitem value="npm"></tabitem><pre class="language-shell"><code class="language-shell"><span class="token function">npm</span> <span class="token builtin class-name">test</span></code></pre><tabitem value="yarn"><pre class="language-shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token builtin class-name">test</span></code></pre></tabitem><p>We should see output the following output:<pre class="language-text"><code class="language-text">➜  selenium git:(main) ✗ yarn test
yarn run v1.22.11
$ Mocha


  Hello Tauri
    ✔ should be cordial (120ms)
    ✔ should be excited
    ✔ should be easy on the eyes


  3 passing (588ms)

Done in 0.93s.</code></pre><p>We can see that our <code>Hello Tauri</code> test suite we created with <code>describe</code> had all 3 items we created with <code>it</code> pass their tests!<p>With <a href="https://selenium.dev/">Selenium</a> and some hooking up to a test suite, we just enabled e2e testing without modifying our Tauri application at all!<p><span style="float:footnote"><a href="../../../../index.html#toc">Go to TOC</a></span></section></section>