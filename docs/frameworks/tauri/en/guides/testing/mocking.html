<!doctype html><html lang="en"><meta charset="utf-8"><title>Mocking Tauri APIs</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="mocking-tauri-apis"><h1 id="mocking-tauri-apis">Mocking Tauri APIs</h1><p>When writing your frontend tests, having a fake Tauri environment to simulate windows or intercept IPC calls is common, so-called <em>mocking</em>. The <a href="../../api/js/mocks.md"><code>@tauri-apps/api/mocks</code></a> module provides some helpful tools to make this easier for you:</p>caution<p>Remember to clear mocks after each test run to undo mock state changes between runs! See <a href="../../api/js/mocks.md#clearmocks"><code>clearMocks()</code></a> docs for more info.<section class="level2"aria-labelledby="ipc-requests"><h2 id="ipc-requests">IPC Requests</h2><p>Most commonly, you want to intercept IPC requests; this can be helpful in a variety of situations:<ul><li>Ensure the correct backend calls are made<li>Simulate different results from backend functions</ul><p>Tauri provides the mockIPC function to intercept IPC requests. You can find more about the specific API in detail <a href="../../api/js/mocks.md#mockipc">here</a>.<blockquote>The following examples use [Vitest], but you can use any other frontend testing library such as jest.</blockquote><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> beforeAll<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> vitest<span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> randomFillSync <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> crypto<span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> mockIPC <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> @tauri<span class="token operator">-</span>apps<span class="token operator">/</span>api<span class="token operator">/</span>mocks<span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> invoke <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> @tauri<span class="token operator">-</span>apps<span class="token operator">/</span>api<span class="token operator">/</span>tauri<span class="token punctuation">;</span>

<span class="token comment">// jsdom doesn't come with a WebCrypto implementation</span>
<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">defineProperty</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">,</span> <span class="token string">'crypto'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// @ts-ignore      </span>
      <span class="token function-variable function">getRandomValues</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token function">randomFillSync</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token function">test</span><span class="token punctuation">(</span>invoke simple<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">mockIPC</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cmd<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// simulated rust command called add that just adds two numbers</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>cmd <span class="token operator">===</span> add<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token property-access">a</span> <span class="token keyword module">as</span> number<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token property-access">b</span> <span class="token keyword module">as</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Sometimes you want to track more information about an IPC call; how many times was the command invoked? Was it invoked at all?<p>You can use <a href="../../api/js/mocks.md#mockipc"><code>mockIPC()</code></a> with other spying and mocking tools to test this:<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> beforeAll<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> test<span class="token punctuation">,</span> vi <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> vitest<span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> randomFillSync <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> crypto<span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> mockIPC <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> @tauri<span class="token operator">-</span>apps<span class="token operator">/</span>api<span class="token operator">/</span>mocks<span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> invoke <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> @tauri<span class="token operator">-</span>apps<span class="token operator">/</span>api<span class="token operator">/</span>tauri<span class="token punctuation">;</span>

<span class="token comment">// jsdom doesn't come with a WebCrypto implementation</span>
<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">defineProperty</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">,</span> <span class="token string">'crypto'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// @ts-ignore      </span>
      <span class="token function-variable function">getRandomValues</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token function">randomFillSync</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token function">test</span><span class="token punctuation">(</span>invoke<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">mockIPC</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cmd<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// simulated rust command called add that just adds two numbers</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>cmd <span class="token operator">===</span> add<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token property-access">a</span> <span class="token keyword module">as</span> number<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token property-access">b</span> <span class="token keyword module">as</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// we can use the spying tools provided by vitest to track the mocked function</span>
  <span class="token keyword">const</span> spy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token method function property-access">spyOn</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">,</span> __TAURI_IPC__<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">invoke</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">resolves</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To mock IPC requests to a sidecar or shell command you need to grab the ID of the event handler when <code>spawn()</code> or <code>execute()</code> is called and use this ID to emit events the backend would send back:<pre class="language-js"><code class="language-js"><span class="token function">mockIPC</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">cmd<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">.</span><span class="token property-access">cmd</span> <span class="token operator">===</span> <span class="token string">'execute'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> eventCallbackId <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>args<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">.</span><span class="token property-access">onEventFn</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> eventEmitter <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">[</span>eventCallbackId<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 'Stdout' event can be called multiple times</span>
    <span class="token function">eventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'Stdout'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">'some data sent from the process'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 'Terminated' event must be called at the end to resolve the promise</span>
    <span class="token function">eventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'Terminated'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">signal</span><span class="token operator">:</span> <span class="token string">'kill'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section class="level2"aria-labelledby="windows"><h2 id="windows">Windows</h2><p>Sometimes you have window-specific code (a splash screen window, for example), so you need to simulate different windows. You can use the <a href="../../api/js/mocks.md#mockwindows"><code>mockWindows()</code></a> method to create fake window labels. The first string identifies the current window (i.e., the window your JavaScript believes itself in), and all other strings are treated as additional windows.<blockquote><p><a href="../../api/js/mocks.md#mockwindows"><code>mockWindows()</code></a> only fakes the existence of windows but no window properties. To simulate window properties, you need to intercept the correct calls using <a href="../../api/js/mocks.md#mockipc"><code>mockIPC()</code></a></blockquote><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> beforeAll<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vitest'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> randomFillSync <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'crypto'</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> mockWindows <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@tauri-apps/api/mocks'</span><span class="token punctuation">;</span>

<span class="token comment">// jsdom doesn't come with a WebCrypto implementation</span>
<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">defineProperty</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">,</span> <span class="token string">'crypto'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// @ts-ignore      </span>
      <span class="token function-variable function">getRandomValues</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token function">randomFillSync</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'invoke'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">mockWindows</span><span class="token punctuation">(</span><span class="token string">'main'</span><span class="token punctuation">,</span> <span class="token string">'second'</span><span class="token punctuation">,</span> <span class="token string">'third'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span> getCurrent<span class="token punctuation">,</span> getAll <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'@tauri-apps/api/window'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'label'</span><span class="token punctuation">,</span> <span class="token string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">w</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> w<span class="token punctuation">.</span><span class="token property-access">label</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">,</span> <span class="token string">'second'</span><span class="token punctuation">,</span> <span class="token string">'third'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section>