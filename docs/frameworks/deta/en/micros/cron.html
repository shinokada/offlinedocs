<!doctype html><html id="cron"lang="en"><meta charset="utf-8"><title>Cron</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="sidebar_lable"content="Run"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><p>import Tabs from '@theme/Tabs'; import TabItem from '@theme/TabItem';<section id="deta-cron"class="level3"><h3>Deta Cron</h3><blockquote>Cron is a feature of Deta Micros. For the cron to trigger, your code must be deployed on a Micro.</blockquote><p>A Deta Micro can be set to run on a schedule from the <code>deta cli</code> using the <a href="../cli/commands#deta-cron-set">deta cron set</a> command.<p>In order to set a micro to run on a schedule, the micro's code needs to define a function that will be run on the schedule with the help of our library <code>deta</code>.<p>The <code>deta</code> library is pre-installed on a micro and can just be imported directly.</section><section id="set-cron"class="level3"><h3>Set Cron</h3><p>Use <code>deta cron set</code> to schedule the micro.<p>You can set the cron in two ways:<section id="rate"class="level4"><h4>Rate</h4><p>You can define the <code>rate</code> at which a micro should run. It is comprised of a <code>value</code> and <code>unit</code>.<ul><li><code>value</code>: is a non-zero positive integer<li><code>unit</code>: unit of time, can be <code>minute, minutes, hour, hours, day, days</code>. If the <code>value</code> is <code>1</code> the unit must be <code>minute</code>, <code>hour</code> or <code>day</code>.</ul><p><strong>Examples</strong><ul><li><code>deta cron set 1 minute</code> : Run every minute<li><code>deta cron set 2 hours</code> : Run every two hours<li><code>deta cron set 5 days</code> : Run every five days</ul></section><section id="cron-expressions"class="level4"><h4>Cron expressions</h4><p>Cron expressions allow you more flexibility and precision when setting a cron job. Cron expressions have six required fields, which are separated by white space.<table><thead><tr><th>Field<th>Values<th>Wildcards<tbody><tr><td>Minutes<td>0-59<td>,-*/<tr><td>Hours<td>0-23<td>,-*/<tr><td>Day-of-month<td>1-31<td>,-*?/LW<tr><td>Month<td>1-12 or JAN-DEC<td>,-*/<tr><td>Day-of-week<td>1-7 or SUN-SAT<td>,-*?L#<tr><td>Year<td>1970-2199<td>,-*/</table><p><strong>Wildcards</strong><ul><li><p>The , (comma) wildcard includes additional values. In the Month field, JAN,FEB,MAR would include January, February, and March.<li><p>The - (dash) wildcard specifies ranges. In the Day field, 1-15 would include days 1 through 15 of the specified month.<li><p>The <em>(asterisk) wildcard includes all values in the field. In the Hours field, </em>would include every hour. You cannot use * in both the Day-of-month and Day-of-week fields. If you use it in one, you must use ? in the other.<li><p>The / (forward slash) wildcard specifies increments. In the Minutes field, you could enter 1/10 to specify every tenth minute, starting from the first minute of the hour (for example, the 11th, 21st, and 31st minute, and so on).<li><p>The ? (question mark) wildcard specifies one or another. In the Day-of-month field you could enter 7 and if you didn't care what day of the week the 7th was, you could enter ? in the Day-of-week field.<li><p>The L wildcard in the Day-of-month or Day-of-week fields specifies the last day of the month or week.<li><p>The W wildcard in the Day-of-month field specifies a weekday. In the Day-of-month field, 3W specifies the weekday closest to the third day of the month.<li><p>The # wildcard in the Day-of-week field specifies a certain instance of the specified day of the week within a month. For example, 3#2 would be the second Tuesday of the month: the 3 refers to Tuesday because it is the third day of each week, and the 2 refers to the second day of that type within the month.</ul><p><strong>Limits</strong><ul><li><p>You can't specify the Day-of-month and Day-of-week fields in the same cron expression. If you specify a value (or a *) in one of the fields, you must use a ? (question mark) in the other.<li><p>Cron expressions that lead to rates faster than 1 minute are not supported.</ul><p><strong>Examples</strong><ul><li><code>deta cron set 0 10 * * ? *</code> : Run at 10:00 am(UTC) every day<li><code>deta cron set 15 12 * * ? *</code> : Run at 12:15 pm(UTC) every day<li><code>deta cron set 0 18 ? * MON-FRI *</code> : Run at 6:00 pm(UTC) every Monday through Friday<li><code>deta cron set 0 8 1 * ? *</code> : Run at 8:00 am(UTC) every 1st day of the month<li><code>deta cron set 0/15 * * * ? *</code> : Run every 15 minutes<li><code>deta cron set 0/5 8-17 ? * MON-FRI *</code> : Run every 5 minutes Monday through Friday between 8:00 am and 5:55 pm(UTC)</ul></section></section><section id="code"class="level3"><h3>Code</h3><p>&#x3C;Tabs groupId=preferred-language defaultValue=js values={[ {label: 'JavaScript', value:'js', }, {label: 'Python', value: 'python',}, ]}<blockquote><tabitem value="js"></tabitem></blockquote><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'deta'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// define a function to run on a schedule </span>
<span class="token comment">// the function must take an event as an argument</span>
app<span class="token punctuation">.</span><span class="token property-access">lib</span><span class="token punctuation">.</span><span class="token method function property-access">cron</span><span class="token punctuation">(</span><span class="token parameter">event</span> <span class="token arrow operator">=></span> running on a schedule<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> app<span class="token punctuation">;</span></code></pre><tabitem value="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> deta <span class="token keyword">import</span> app

<span class="token comment"># define a function to run on a schedule</span>
<span class="token comment"># the function must take an event as an argument</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>cron</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">cron_job</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> running on a schedule</code></pre></tabitem><p>With this code deployed on a deta micro, the <code>deta cron set</code> commands will execute the function based on the cron rate or expression. For example<pre class="language-shell"><code class="language-shell">$ deta <span class="token function">cron</span> <span class="token builtin class-name">set</span> <span class="token number">10</span> minutes</code></pre><p>will set the function to run every 10 minutes. In order to see the execution logs, you can use the <a href="https://docs.deta.sh/docs/micros/visor">visor</a></section><section id="events"class="level3"><h3>Events</h3><p>A function that is triggered from the cron must take an <code>event</code> as the only argument. The <code>event</code> will have the following attribute.<ul><li><code>event.type</code>: <code>string</code> type of an event, will be <code>cron</code> when triggered by a cron event</ul></section><section id="remove-cron"class="level3"><h3>Remove Cron</h3><p>Use <code>deta cron remove</code> to remove a schedule from the micro.</section><section id="cron-and-http"class="level3"><h3>Cron and HTTP</h3><p>You can combine both cron and HTTP triggers in the same deta micro. For this you need to instantiate your app using the <code>deta</code> library that is pre-installed on a micro.<p>&#x3C;Tabs groupId=preferred-language defaultValue=js values={[ {label: 'JavaScript', value:'js', }, {label: 'Python', value: 'python',}, ]}<blockquote><tabitem value="js"></tabitem></blockquote><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">App</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'deta'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">'Hello Deta, I am running with HTTP'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token property-access">lib</span><span class="token punctuation">.</span><span class="token method function property-access">cron</span><span class="token punctuation">(</span><span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">'Hello Deta, I am a cron job'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> app<span class="token punctuation">;</span></code></pre><tabitem value="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> deta <span class="token keyword">import</span> App
<span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI

app <span class="token operator">=</span> App<span class="token punctuation">(</span>FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">http</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> Hello Deta<span class="token punctuation">,</span> I am running <span class="token keyword">with</span> HTTP

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>cron</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">cron_job</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> Hello Deta<span class="token punctuation">,</span> I am a cron job</code></pre></tabitem></section><section id="issues"class="level2"><h2>Issues</h2><p>If you run into any issues, consider reporting them in our <a href="https://github.com/orgs/deta/discussions">Github Discussions</a>.<p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section>