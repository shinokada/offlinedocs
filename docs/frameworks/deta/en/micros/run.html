<!doctype html><html id="run"lang="en"><meta charset="utf-8"><title>Run</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="sidebar_lable"content="Run"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><p>import Tabs from '@theme/Tabs'; import TabItem from '@theme/TabItem';<section id="run-from-the-cli"class="level3"><h3>Run from the CLI</h3><p>A Deta Micro can be run directly from the <code>deta cli</code> using the command <a href="../cli/commands#deta-run">deta run</a> with an input.<p>In order to run a micro from the cli directly, the micro's code needs to define functions that will be run from the cli with the help of our library <code>deta</code>.<p>The <code>deta</code> library is pre-installed on a micro and can just be imported directly.<p>&#x3C;Tabs groupId=preferred-language defaultValue=js values={[ {label: 'JavaScript', value:'js', }, {label: 'Python', value: 'python',}, ]}<blockquote><tabitem value="js"></tabitem></blockquote><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'deta'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// define a function to run from the cli</span>
<span class="token comment">// the function must take an event as an argument</span>
app<span class="token punctuation">.</span><span class="token property-access">lib</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token maybe-class-name">Welcome</span> to <span class="token maybe-class-name">Deta</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> app<span class="token punctuation">;</span></code></pre><tabitem value="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> deta <span class="token keyword">import</span> app

<span class="token comment"># define a function to run from the cli</span>
<span class="token comment"># the function must take an event as an argument</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">welcome</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> Welcome to Deta!</code></pre></tabitem><p>With this code deployed on a micro, you can simply run<pre class="language-shell"><code class="language-shell">$ deta run</code></pre><p>And see the following output:<pre class="language-text"><code class="language-text">Response:
    Welcome to Deta!</code></pre></section><section id="events"class="level3"><h3>Events</h3><p>A function that is triggered from the cli must take an <code>event</code> as the only argument.<p>You can provide an input from the cli to the function which will be passed on as an <code>event</code>. It has four attributes:<ul><li><code>event.json</code>: <code>object</code> provides the JSON payload<li><code>event.body</code>: <code>string</code> provides the raw JSON payload<li><code>event.type</code>: <code>string</code> type of an event, <code>run</code> when running from the cli<li><code>event.action</code>: <code>string</code> the <a href="#Actions">action</a> provided from the cli, defaults to an empty string</ul><p>&#x3C;Tabs groupId=preferred-language defaultValue=js values={[ {label: 'JavaScript', value:'js', }, {label: 'Python', value: 'python',}, ]}<blockquote><tabitem value="js"></tabitem></blockquote><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'deta'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token property-access">lib</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token comment">// access input to your function with event.json</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span><span class="token property-access">json</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> app<span class="token punctuation">;</span></code></pre><tabitem value="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> deta <span class="token keyword">import</span> app

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">welcome</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token comment"># access input to your function with event.json</span>
        message<span class="token punctuation">:</span> fhello <span class="token punctuation">{</span>event<span class="token punctuation">.</span>json<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>!
    <span class="token punctuation">}</span></code></pre></tabitem><p>With this code deployed on a micro, you can run<pre class="language-shell"><code class="language-shell">$ deta run -- --name deta</code></pre><p>And should see the following output.<pre class="language-json"><code class="language-json">Response<span class="token operator">:</span>
    <span class="token punctuation">{</span>
        message<span class="token operator">:</span> hello deta!
    <span class="token punctuation">}</span></code></pre></section><section id="input"class="level3"><h3>Input</h3><p>The input to your function on a micro can be provided through the <code>deta cli</code> and accessed in the code from the <code>event</code> object. The input is a JSON object created from the arguments provided to the cli.<p>An <em>important</em> consideration is that the values in key-value pairs in the input are always either <em>strings</em>, <em>list of strings</em> or <em>booleans</em>.<p>Boolean flags are provided with a single dash, string arguments with double dash and if multiple values are provided for the same key, a list of strings will be provided.<p>For instance:<pre class="language-shell"><code class="language-shell">$ deta run -- --name jimmy --age <span class="token number">33</span> --emails jimmy@deta.sh --emails jim@deta.sh -active</code></pre><p>will provide the micro with the following input:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    name<span class="token operator">:</span> jimmy<span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token comment">// notice '33' here is a string not an int</span>
    emails<span class="token operator">:</span> <span class="token punctuation">[</span>jimmy@deta.sh<span class="token punctuation">,</span> jim@deta.sh<span class="token punctuation">]</span><span class="token punctuation">,</span>
    active<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span></code></pre><p>You need to explicitly convert the string values to other types in your code if needed.</section><section id="actions"class="level3"><h3>Actions</h3><p>Actions help you run different functions based on an <code>action</code> that you define for the function.<p>The <code>action</code> defaults to an empty string if not provided.<p>&#x3C;Tabs groupId=preferred-language defaultValue=js values={[ {label: 'JavaScript', value:'js', }, {label: 'Python', value: 'python',}, ]}<blockquote><tabitem value="js"></tabitem></blockquote><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'deta'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token property-access">lib</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span><span class="token property-access">json</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// action 'hello'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token property-access">lib</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">good morning </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span><span class="token property-access">json</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// action 'greet'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> greet<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> app<span class="token punctuation">;</span></code></pre><tabitem value="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> deta <span class="token keyword">import</span> app

<span class="token comment"># action 'hello'</span>
<span class="token comment"># the action does not need to have the same name as the function</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>run</span><span class="token punctuation">(</span>action<span class="token operator">=</span>hello<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">welcome</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        message<span class="token punctuation">:</span> fhello <span class="token punctuation">{</span>event<span class="token punctuation">.</span>json<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>!
    <span class="token punctuation">}</span>

<span class="token comment"># action 'greet'</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>run</span><span class="token punctuation">(</span>action<span class="token operator">=</span>greet<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">greet</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        message<span class="token punctuation">:</span> fgood morning <span class="token punctuation">{</span>event<span class="token punctuation">.</span>json<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>!
    <span class="token punctuation">}</span></code></pre></tabitem><p>With this code deployed on a deta micro, if you run<pre class="language-shell"><code class="language-shell">$ deta run hello -- --name deta</code></pre><p>where you tell the cli to run action <code>hello</code> with <code>name: deta</code> as input. You should see the following output:<pre class="language-json"><code class="language-json">Response<span class="token operator">:</span>
    <span class="token punctuation">{</span>
        message<span class="token operator">:</span> hello deta! 
    <span class="token punctuation">}</span></code></pre><p>And if you do <code>deta run</code> with action <code>greet</code><pre class="language-shell"><code class="language-shell">$ deta run greet -- --name deta</code></pre><p>you should see the following output:<pre class="language-json"><code class="language-json">Response<span class="token operator">:</span>
    <span class="token punctuation">{</span>
        message<span class="token operator">:</span> good morning deta! 
    <span class="token punctuation">}</span></code></pre></section><section id="run-and-http"class="level3"><h3>Run and HTTP</h3><p>You can combine both run and HTTP triggers in the same deta micro. For this you need to instantiate your app using the <code>deta</code> library that is pre-installed on a micro.<p>&#x3C;Tabs groupId=preferred-language defaultValue=js values={[ {label: 'JavaScript', value:'js', }, {label: 'Python', value: 'python',}, ]}<blockquote><tabitem value="js"></tabitem></blockquote><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">App</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'deta'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// triggered with an HTTP request</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">'Hello deta, i am running with HTTP'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// triggered from the cli</span>
app<span class="token punctuation">.</span><span class="token property-access">lib</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">'Hello deta, i am running from the cli'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> app<span class="token punctuation">;</span>
</code></pre><tabitem value="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> deta <span class="token keyword">import</span> App
<span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI

app <span class="token operator">=</span> App<span class="token punctuation">(</span>FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># triggered with an HTTP request</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">http</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> Hello deta<span class="token punctuation">,</span> i am running <span class="token keyword">with</span> HTTP

<span class="token comment"># triggered from the cli</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> Hello deta<span class="token punctuation">,</span> i am running <span class="token keyword">from</span> the cli</code></pre></tabitem></section><section id="run-and-cron"class="level3"><h3>Run and Cron</h3><p>You can use both run and <a href="./cron">cron</a> triggers in the same deta micro. You can also stack run and cron triggers for the same function.<p>&#x3C;Tabs groupId=preferred-language defaultValue=js values={[ {label: 'JavaScript', value:'js', }, {label: 'Python', value: 'python',}, ]}<blockquote><tabitem value="js"></tabitem></blockquote><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'deta'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token string">'hello deta'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">printTime</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">it is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token property-access">lib</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span>sayHello<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// stacking run and cron</span>
app<span class="token punctuation">.</span><span class="token property-access">lib</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span>printTime<span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// action 'time'</span>
app<span class="token punctuation">.</span><span class="token property-access">lib</span><span class="token punctuation">.</span><span class="token method function property-access">cron</span><span class="token punctuation">(</span>printTime<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> app<span class="token punctuation">;</span></code></pre><tabitem value="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> deta <span class="token keyword">import</span> app
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token comment"># only run</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">say_hello</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> hello deta

<span class="token comment"># stacking run and cron</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>run</span><span class="token punctuation">(</span>action<span class="token operator">=</span><span class="token string">'time'</span><span class="token punctuation">)</span> <span class="token comment"># action 'time'</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>cron</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token keyword">def</span> <span class="token function">print_time</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> fit <span class="token keyword">is</span> <span class="token punctuation">{</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> </code></pre></tabitem></section><section id="issues"class="level2"><h2>Issues</h2><p>If you run into any issues, consider reporting them in our <a href="https://github.com/orgs/deta/discussions">Github Discussions</a>.<span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section>