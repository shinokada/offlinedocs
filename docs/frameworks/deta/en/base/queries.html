<!doctype html><html id="queries"lang="en"><meta charset="utf-8"><title>Queries</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><p>Deta Base supports queries for fetching data that match certain conditions. Queries are regular objects/dicts/maps with conventions for different operators for specifying the conditions.<section id="operators"class="level2"><h2>Operators</h2><p>Queries support the following operators:<section id="equal"class="level3"><h3>Equal</h3><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>age<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span> name<span class="token operator">:</span> Beverly<span class="token punctuation">}</span>

<span class="token comment">// hierarchical</span>
<span class="token punctuation">{</span>user.profile.age<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span> user.profile.name<span class="token operator">:</span> Beverly<span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>fav_numbers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>time<span class="token operator">:</span> <span class="token punctuation">{</span>day<span class="token operator">:</span> Tuesday<span class="token punctuation">,</span> hour<span class="token operator">:</span> <span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre></section><section id="not-equal"class="level3"><h3>Not Equal</h3><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>user.profile.age?ne<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">}</span></code></pre></section><section id="less-than"class="level3"><h3>Less Than</h3><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>user.profile.age?lt<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">}</span></code></pre></section><section id="greater-than"class="level3"><h3>Greater Than</h3><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>user.profile.age?gt<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">}</span></code></pre></section><section id="less-than-or-equal"class="level3"><h3>Less Than or Equal</h3><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>user.profile.age?lte<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">}</span></code></pre></section><section id="greater-than-or-equal"class="level3"><h3>Greater Than or Equal</h3><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>user.profile.age?gte<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">}</span></code></pre></section><section id="prefix"class="level3"><h3>Prefix</h3><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>user.id?pfx<span class="token operator">:</span> afdk<span class="token punctuation">}</span></code></pre></section><section id="range"class="level3"><h3>Range</h3><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>user.age?r<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre></section><section id="contains"class="level3"><h3>Contains</h3><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token comment">// if user email contains the substring @deta.sh</span>
  user.email?contains<span class="token operator">:</span> @deta.sh 
<span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token comment">// if berlin is in a list of places lived </span>
  user.places_lived_list?contains<span class="token operator">:</span> berlin
<span class="token punctuation">}</span></code></pre></section><section id="not-contains"class="level3"><h3>Not Contains</h3><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token comment">// if user email does not contain @deta.sh</span>
  user.email?not_contains<span class="token operator">:</span> @deta.sh <span class="token comment">// 'user.email?!contains' also valid</span>
<span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token comment">// if berlin is not in a list of places lived</span>
  user.places_lived_list?not_contains<span class="token operator">:</span> berlin <span class="token comment">// 'user.places_lived_list?!contains' also valid</span>
<span class="token punctuation">}</span></code></pre><blockquote>`?contains` and `?not_contains` only works for a list of strings if checking for membership in a list; it does not apply to list of other data types. You can store your lists always as a list of strings if you want to check for membership.</blockquote></section></section><section id="logical-operators"class="level2"><h2>Logical Operators</h2><section id="and"class="level3"><h3>AND</h3><p>The entries in a single query object are <code>AND</code> ed together. For e.g. the query:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    active<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
    age?gte<span class="token operator">:</span> <span class="token number">22</span> 
<span class="token punctuation">}</span></code></pre><p>will retrieve items where <code>active</code> is <code>true</code> <strong>and</strong> <code>age</code> is greater than or equal to <code>22</code>.<p>The query above would translate to <code>SQL</code> as:<pre class="language-SQL"><code class="language-SQL">SELECT * FROM base WHERE active=1 AND age>=22;</code></pre></section><section id="or"class="level3"><h3>OR</h3><p>Multiple query objects in a list are <code>OR</code> ed together. For eg. the queries:<pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><span class="token punctuation">{</span>age?lte<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>age?gte<span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">}</span><span class="token punctuation">]</span></code></pre><p>will retrieve items where <code>age</code> is less than equal to <code>30</code> <strong>or</strong> <code>age</code> is greater than equal to <code>40</code>.<p>The query above would translate to <code>SQL</code> as:<pre class="language-SQL"><code class="language-SQL">SELECT * FROM base WHERE age&#x3C;=30 OR age>=40;</code></pre></section></section><section id="hierarchy"class="level2"><h2>Hierarchy</h2><p>You can use the period character <code>.</code> to query for hierarchical fields within the data. For instance if you have the following item in the base:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    key<span class="token operator">:</span> user-key<span class="token punctuation">,</span>
    profile<span class="token operator">:</span> <span class="token punctuation">{</span>
        age<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span> 
        active<span class="token operator">:</span> <span class="token boolean">true</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Then you can query for the <code>active</code> and <code>age</code> within <code>profile</code> directly:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    profile.age<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
    profile.active<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span></code></pre></section><section id="querying-keys"class="level2"><h2>Querying Keys</h2><p>You need to consider the following when querying on keys:<ul><li><p>The keys must be strings hence the operation values <strong>must</strong> also be strings.<li><p>The <a href="#contains">contains</a> and <a href="#not-contains">not-contains</a> operators <strong>are not supported</strong>.<li><p>The <a href="#and"><code>AND</code></a> and <a href="#or"><code>OR</code></a> operations for different query values <strong>are not supported</strong>. For e.g. <strong>the following queries are invalid</strong>:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token comment">// different AND key queries (invalid query)</span>
    key<span class="token operator">:</span> a<span class="token punctuation">,</span>
    key?pfx<span class="token operator">:</span> b
<span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token comment">// different OR key queries (invalid query)</span>
    <span class="token punctuation">[</span><span class="token punctuation">{</span>key?pfx<span class="token operator">:</span>a<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>key?pfx<span class="token operator">:</span> b<span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></ul></section><section id="issues"class="level2"><h2>Issues</h2><p>If you run into any issues, consider reporting them in our <a href="https://github.com/orgs/deta/discussions">Github Discussions</a>.<span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section>