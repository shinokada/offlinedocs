<!doctype html><html id="node_tutorial"lang="en"><meta charset="utf-8"><title>Node.js Tutorial</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><p>import Tabs from '@theme/Tabs'; import TabItem from '@theme/TabItem';<section id="building-a-simple-crud-with-deta-base"class="level2"><h2>Building a Simple CRUD with Deta Base</h2><section id="setup"class="level3"><h3>Setup</h3><p>Two dependencies are needed for this project, <code>deta</code> and <code>express</code>:<pre class="language-shell"><code class="language-shell"><span class="token function">npm</span> <span class="token function">install</span> deta express</code></pre><p>To configure the app, import the dependencies and instantiate your database.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Deta</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'deta'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> deta <span class="token operator">=</span> <span class="token function"><span class="token maybe-class-name">Deta</span></span><span class="token punctuation">(</span><span class="token string">'myProjectKey'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// configure your Deta project</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> deta<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Base</span></span><span class="token punctuation">(</span><span class="token string">'simpleDB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// access your DB</span>


<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// instantiate express</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// for parsing application/json bodies</span></code></pre></section><section id="creating-records"class="level3"><h3>Creating Records</h3><p>For our database we are going to store records of users under a unique <code>key</code>. Users can have three properties:<pre class="language-js"><code class="language-js"><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> number<span class="token punctuation">,</span>
    <span class="token literal-property property">hometown</span><span class="token operator">:</span> string
<span class="token punctuation">}</span>
</code></pre><p>We'll expose a function that creates user records to HTTP <code>POST</code> requests on the route <code>/users</code>.<pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/users'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> hometown <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> toCreate <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> hometown<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> insertedUser <span class="token operator">=</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span>toCreate<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// put() will autogenerate a key for us</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>insertedUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><section id="request"class="level4"><h4>Request</h4><p><code>POST</code> a payload to the endpoint:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    name<span class="token operator">:</span> Beverly<span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">44</span><span class="token punctuation">,</span>
    hometown<span class="token operator">:</span> Copernicus City
<span class="token punctuation">}</span></code></pre></section><section id="response"class="level4"><h4>Response</h4><p>Our server should respond with a status of <code>201</code> and a body of:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    key<span class="token operator">:</span> dl9e6w6859a9<span class="token punctuation">,</span>
    name<span class="token operator">:</span> Beverly<span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">44</span><span class="token punctuation">,</span>
    hometown<span class="token operator">:</span> Copernicus City
<span class="token punctuation">}</span></code></pre></section></section><section id="reading-records"class="level3"><h3>Reading Records</h3><p>To read records, we can simply use <code>Base.get(key)</code>.<p>If we tie a <code>GET</code> request to the <code>/users</code> path with a path param giving a user id (i.e. <code>/users/dl9e6w6859a9</code>), we can return a record of the user over HTTP.<pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/users/:id'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">message</span><span class="token operator">:</span> user not found<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Another option would to use <code>Base.fetch(query)</code> to search for records to return, like so:<p>&#x3C;Tabs groupId=js-version defaultValue=new values={[ { label: 'version &#x3C; 1.0.0', value: 'legacy', }, { label: 'version >= 1.0.0', value: 'new', }, ] }></p><tabitem value="legacy"><pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/search-by-age/:age'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> age <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">fetch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">'age'</span><span class="token operator">:</span> age<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></tabitem><tabitem value="new"><pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/search-by-age/:age'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> age <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> items <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">fetch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">'age'</span><span class="token operator">:</span> age<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> items<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></tabitem><section id="request-1"class="level4"><h4>Request</h4><p>Let's try reading the record we just created.<p>Make a <code>GET</code> to the path <code>/users/dl9e6w6859a9</code>.</section><section id="response-1"class="level4"><h4>Response</h4><p>The server should return the same record:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    key<span class="token operator">:</span> dl9e6w6859a9<span class="token punctuation">,</span>
    name<span class="token operator">:</span> Beverly<span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">44</span><span class="token punctuation">,</span>
    hometown<span class="token operator">:</span> Copernicus City
<span class="token punctuation">}</span></code></pre></section></section><section id="updating-records"class="level3"><h3>Updating Records</h3><p>To update records under a given <code>key</code>, we can use <code>Base.put()</code>, which will replace the record under a given key.<p>We can tie a <code>PUT</code> request to the path <code>/users/{id}</code> to update a given user record over HTTP.<pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span><span class="token string">'/users/:id'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> hometown <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> toPut <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> hometown <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> newItem <span class="token operator">=</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span>toPut<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>newItem<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><section id="request-2"class="level4"><h4>Request</h4><p>We can update the record by passing a <code>PUT</code> to the path <code>/users/dl9e6w6859a9</code> with the following payload:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    name<span class="token operator">:</span> Wesley<span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
    hometown<span class="token operator">:</span> San Francisco
<span class="token punctuation">}</span></code></pre></section><section id="response-2"class="level4"><h4>Response</h4><p>Our server should respond with the new body of:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    key<span class="token operator">:</span> dl9e6w6859a9<span class="token punctuation">,</span>
    name<span class="token operator">:</span> Wesley<span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
    hometown<span class="token operator">:</span> San Francisco
<span class="token punctuation">}</span></code></pre></section></section><section id="deleting-records"class="level3"><h3>Deleting Records</h3><p>To delete records under a given <code>key</code>, we can use <code>Base.delete(key)</code>, which will remove the record under a given key.<p>We can tie a <code>DELETE</code> request to the path <code>/users/{id}</code> to delete a given user record over HTTP.<pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token string">'/users/:id'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">message</span><span class="token operator">:</span> deleted<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><section id="request-3"class="level4"><h4>Request</h4><p>We can delete the record by passing a <code>DELETE</code> to the path <code>/users/dl9e6w6859a9</code>.<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    name<span class="token operator">:</span> Wesley<span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
    hometown<span class="token operator">:</span> San Francisco
<span class="token punctuation">}</span></code></pre></section><section id="response-3"class="level4"><h4>Response</h4><p>Our server should respond with:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    message<span class="token operator">:</span> deleted
<span class="token punctuation">}</span></code></pre></section></section></section><section id="issues"class="level2"><h2>Issues</h2><p>If you run into any issues, consider reporting them in our <a href="https://github.com/orgs/deta/discussions">Github Discussions</a>. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section>