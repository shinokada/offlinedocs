<!doctype html><html id="py_tutorial"lang="en"><meta charset="utf-8"><title>Python Tutorial</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><p>import Tabs from '@theme/Tabs'; import TabItem from '@theme/TabItem';<section id="building-a-simple-crud-with-deta-base"class="level2"><h2>Building a Simple CRUD with Deta Base</h2><section id="setup"class="level3"><h3>Setup</h3><p>Two dependencies are needed for this project, <code>deta</code> and <code>flask</code>:<pre class="language-shell"><code class="language-shell">pip <span class="token function">install</span> deta flask</code></pre><p>To configure the app, import the dependencies and instantiate your database.<pre class="language-py"><code class="language-py"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> jsonify
<span class="token keyword">from</span> deta <span class="token keyword">import</span> Deta


deta <span class="token operator">=</span> Deta<span class="token punctuation">(</span><span class="token string">'myProjectKey'</span><span class="token punctuation">)</span> <span class="token comment"># configure your Deta project</span>
db <span class="token operator">=</span> deta<span class="token punctuation">.</span>Base<span class="token punctuation">(</span><span class="token string">'simpleDB'</span><span class="token punctuation">)</span>  <span class="token comment"># access your DB</span>
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span></code></pre></section><section id="creating-records"class="level3"><h3>Creating Records</h3><p>For our database we are going to store records of users under a unique <code>key</code>. Users can have three properties:<pre class="language-py"><code class="language-py"><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span>
    hometown<span class="token punctuation">:</span> <span class="token builtin">str</span>
<span class="token punctuation">}</span>
</code></pre><p>We'll expose a function that creates user records to HTTP <code>POST</code> requests on the route <code>/users</code>.<pre class="language-py"><code class="language-py"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/users'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span>POST<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">create_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> request<span class="token punctuation">.</span>json<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    age <span class="token operator">=</span> request<span class="token punctuation">.</span>json<span class="token punctuation">.</span>get<span class="token punctuation">(</span>age<span class="token punctuation">)</span>
    hometown <span class="token operator">=</span> request<span class="token punctuation">.</span>json<span class="token punctuation">.</span>get<span class="token punctuation">(</span>hometown<span class="token punctuation">)</span>
    
    user <span class="token operator">=</span> db<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> name<span class="token punctuation">,</span>
        age<span class="token punctuation">:</span> age<span class="token punctuation">,</span>
        hometown<span class="token punctuation">:</span> hometown
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">)</span></code></pre><section id="request"class="level4"><h4>Request</h4><p><code>POST</code> a payload to the endpoint:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    name<span class="token operator">:</span> Beverly<span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">44</span><span class="token punctuation">,</span>
    hometown<span class="token operator">:</span> Copernicus City
<span class="token punctuation">}</span></code></pre></section><section id="response"class="level4"><h4>Response</h4><p>Our server should respond with a status of <code>201</code> and a body of:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    key<span class="token operator">:</span> dl9e6w6859a9<span class="token punctuation">,</span>
    name<span class="token operator">:</span> Beverly<span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">44</span><span class="token punctuation">,</span>
    hometown<span class="token operator">:</span> Copernicus City
<span class="token punctuation">}</span></code></pre></section></section><section id="reading-records"class="level3"><h3>Reading Records</h3><p>To read records, we can simply use <code>db.get(key)</code>.<p>If we tie a <code>GET</code> request to the <code>/users</code> path with a param giving a user id (i.e. <code>/users/dl9e6w6859a9</code>), we can return a record of the user over HTTP.<pre class="language-py"><code class="language-py"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token operator">/</span>users<span class="token operator">/</span><span class="token operator">&#x3C;</span>key<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_user</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> db<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">return</span> user <span class="token keyword">if</span> user <span class="token keyword">else</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token punctuation">:</span> Not found<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">404</span><span class="token punctuation">)</span></code></pre><section id="request-1"class="level4"><h4>Request</h4><p>Let's try reading the record we just created.<p>Make a <code>GET</code> to the path (for example) <code>/users/dl9e6w6859a9</code>.</section><section id="response-1"class="level4"><h4>Response</h4><p>The server should return the same record:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    key<span class="token operator">:</span> dl9e6w6859a9<span class="token punctuation">,</span>
    name<span class="token operator">:</span> Beverly<span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">44</span><span class="token punctuation">,</span>
    hometown<span class="token operator">:</span> Copernicus City
<span class="token punctuation">}</span></code></pre></section></section><section id="updating-records"class="level3"><h3>Updating Records</h3><p>To update records under a given <code>key</code>, we can use <code>db.put()</code>, which will replace the record under a given key.<p>We can tie a <code>PUT</code> request to the path <code>/users/{id}</code> to update a given user record over HTTP.<pre class="language-py"><code class="language-py"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token operator">/</span>users<span class="token operator">/</span><span class="token operator">&#x3C;</span>key<span class="token operator">></span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span>PUT<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">update_user</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> db<span class="token punctuation">.</span>put<span class="token punctuation">(</span>request<span class="token punctuation">.</span>json<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token keyword">return</span> user</code></pre><section id="request-2"class="level4"><h4>Request</h4><p>We can update the record by passing a <code>PUT</code> to the path <code>/users/dl9e6w6859a9</code> with the following payload:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    name<span class="token operator">:</span> Wesley<span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
    hometown<span class="token operator">:</span> San Francisco
<span class="token punctuation">}</span></code></pre></section><section id="response-2"class="level4"><h4>Response</h4><p>Our server should respond with the new body of:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    key<span class="token operator">:</span> dl9e6w6859a9<span class="token punctuation">,</span>
    name<span class="token operator">:</span> Wesley<span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
    hometown<span class="token operator">:</span> San Francisco
<span class="token punctuation">}</span></code></pre></section></section><section id="deleting-records"class="level3"><h3>Deleting Records</h3><p>To delete records under a given <code>key</code>, we can use <code>Base.delete(key)</code>, which will remove the record under a given key.<p>We can tie a <code>DELETE</code> request to the path <code>/users/{id}</code> to delete a given user record over HTTP.<pre class="language-js"><code class="language-js">@app<span class="token punctuation">.</span><span class="token method function property-access">route</span><span class="token punctuation">(</span><span class="token operator">/</span>users<span class="token operator">/</span><span class="token operator">&#x3C;</span>key<span class="token operator">></span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token constant">DELETE</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
def <span class="token function">delete_user</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token operator">:</span>
    db<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword control-flow">return</span> <span class="token function">jsonify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">status</span><span class="token operator">:</span> ok<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span></code></pre><section id="request-3"class="level4"><h4>Request</h4><p>We can delete the record by passing a <code>DELETE</code> to the path <code>/users/dl9e6w6859a9</code>.<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    name<span class="token operator">:</span> Wesley<span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
    hometown<span class="token operator">:</span> San Francisco
<span class="token punctuation">}</span></code></pre></section><section id="response-3"class="level4"><h4>Response</h4><p>Our server should respond with:<pre class="language-json"><code class="language-json">None</code></pre></section></section></section><section id="issues"class="level2"><h2>Issues</h2><p>If you run into any issues, consider reporting them in our <a href="https://github.com/orgs/deta/discussions">Github Discussions</a>. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section>