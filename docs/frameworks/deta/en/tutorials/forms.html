<!doctype html><html id="form-endpoints-guide"lang="en"><meta charset="utf-8"><title>Form Endpoints</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="sidebar_label"content="Form Endpoints"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><p>import Tabs from '@theme/Tabs'; import TabItem from '@theme/TabItem';<p><a href="../micros/about.md">Deta Micros</a> can be used to easily deploy form endpoints and the form data can be stored easily with <a href="../base/about.md">Deta Base</a>.<p>In this guide, we are going to deploy a Deta Micro that offers a form endpoint for a simple contact form and stores the information in a Deta Base.<p>The guide assumes you have already signed up for Deta and have the <a href="../cli/install.md">Deta CLI</a> installed.<p>The contact form will store a <code>name</code>, <code>email</code> and a <code>message</code>.<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    name<span class="token operator">:</span> str<span class="token punctuation">,</span>
    email<span class="token operator">:</span> str<span class="token punctuation">,</span>
    message<span class="token operator">:</span> str
<span class="token punctuation">}</span></code></pre><p>&#x3C;Tabs groupId=preferred-language defaultValue=js values={[ {label: 'JavaScript', value: 'js', }, {label: 'Python', value: 'py', }, ] }></p><tabitem value="js"><p>We are going to deploy an <code>express</code> app for the form endpoint.<ol><li><p>Create a directory <code>express-form</code> and change the current directory to it.<pre class="language-shell"><code class="language-shell">$ <span class="token function">mkdir</span> express-form <span class="token operator">&#x26;&#x26;</span> <span class="token builtin class-name">cd</span> express-form</code></pre><li><p>Create an empty <code>index.js</code> file (we will add the code that handles the logic later).<li><p>Initialize a <code>nodejs</code> project with <code>npm init</code>.<pre class="language-shell"><code class="language-shell">$ <span class="token function">npm</span> init -y</code></pre><p>You can skip the <code>-y</code> flag, if you want to fill the details about the pacakge interactively through npm's wizard.<li><p>Install <code>express</code> locally for your project.<pre class="language-shell"><code class="language-shell">$ <span class="token function">npm</span> <span class="token function">install</span> express</code></pre><li><p>Create a new <code>nodejs</code> micro with <code>deta new</code>. This will create a new <code>nodejs</code> micro for you and automatically install <code>express</code> as a dependecy.<pre class="language-shell"><code class="language-shell">$ deta new
Successfully created a new micro
<span class="token punctuation">{</span>
    name: express-form,
    runtime: nodejs12.x,
    endpoint: https://<span class="token punctuation">{</span>micro_name<span class="token punctuation">}</span>.deta.dev,
    visor: enabled,
    http_auth: enabled
<span class="token punctuation">}</span>
Adding dependencies<span class="token punctuation">..</span>.

+ express@4.17.1
added <span class="token number">50</span> packages from <span class="token number">37</span> contributors and audited <span class="token number">50</span> packages <span class="token keyword">in</span> <span class="token number">1</span>.967s
found <span class="token number">0</span> vulnerabilities</code></pre><p>Your micro's <code>endpoint</code> will be different from the output shown above. This <code>endpoint</code> will be the form endpoint.<li><p>You can also see that the <code>http_auth</code> is <code>enabled</code> by default. We will disable the <code>http_auth</code> so that form data can be sent to the micro.<pre class="language-shell"><code class="language-shell">$ deta auth disable
Successfully disabled http auth</code></pre><p>This is only for the tutorial, we recommended that you protect your endpoint with some authentication.<li><p>Open <code>index.js</code> and add a <code>POST</code> endpoint for the form using <code>express</code>.<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// express app</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// parse application/x-www-form-urlencoded </span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token arrow operator">=></span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> body <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>

    <span class="token comment">// validate input</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>body<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">||</span> <span class="token operator">!</span>body<span class="token punctuation">.</span><span class="token property-access">email</span> <span class="token operator">||</span> <span class="token operator">!</span>body<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">'Bad request: missing some required values'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// TODO: save the data</span>
    <span class="token keyword control-flow">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><li><p>Update <code>index.js</code> to add logic to save the form data to a Deta Base.<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Deta</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'deta'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// express app</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// contact form base</span>
<span class="token keyword">const</span> formDB <span class="token operator">=</span> <span class="token function"><span class="token maybe-class-name">Deta</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Base</span></span><span class="token punctuation">(</span>contact<span class="token operator">-</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// parse application/x-www-form-urlencoded </span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token arrow operator">=></span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> body <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>

    <span class="token comment">// validate input</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>body<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">||</span> <span class="token operator">!</span>body<span class="token punctuation">.</span><span class="token property-access">email</span> <span class="token operator">||</span> <span class="token operator">!</span>body<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">'Bad request: missing some required values'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// save form data</span>
    formDB<span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> body<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">,</span>
        <span class="token literal-property property">email</span><span class="token operator">:</span> body<span class="token punctuation">.</span><span class="token property-access">email</span><span class="token punctuation">,</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> body<span class="token punctuation">.</span><span class="token property-access">message</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword control-flow">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><li><p>Deploy the changes with <code>deta deploy</code><pre class="language-shell"><code class="language-shell">$ deta deploy
Successfully deployed changes</code></pre></ol><p>Your endpoint will now accept form <code>POST</code> data and save it to a database.<p>You can use <a href="../base/base_ui">Deta Base's UI</a> to easily see what data has been stored in the database. Navigate to your <code>project</code> and click on your base name under <code>bases</code> in your browser to use the Base UI.<p>Here's an example view of the UI.</p><img src="/img/quickstart/contact_form.png"width="1000/"></tabitem><tabitem value="py"><p>We are going to deploy a <code>flask</code> app for the form endpoint.<ol><li><p>Create a directory <code>flask-form</code> and change the current directory to it.<pre class="language-shell"><code class="language-shell">$ <span class="token function">mkdir</span> flask-form <span class="token operator">&#x26;&#x26;</span> <span class="token builtin class-name">cd</span> flask-form</code></pre><li><p>Create an empty <code>main.py</code> file (we will add the code that handles the logic later).<li><p>Create a <code>requirements.txt</code> file and add <code>flask</code> as a dependency for your project.<pre class="language-text"><code class="language-text">flask</code></pre><li><p>Create a new <code>python</code> micro with <code>deta new</code>. This will create a new <code>python</code> micro for you and automatically install <code>flask</code> as a dependecy.<pre class="language-shell"><code class="language-shell">$ deta new
Successfully created a new micro
<span class="token punctuation">{</span>
    name: flask-form,
    runtime: python3.7,
    endpoint: https://<span class="token punctuation">{</span>micro_name<span class="token punctuation">}</span>.deta.dev,
    visor: enabled,
    http_auth: enabled
<span class="token punctuation">}</span>
Adding dependencies<span class="token punctuation">..</span>.
Collecting flask
<span class="token punctuation">..</span>.
Installing collected packages: Werkzeug, itsdangerous, MarkupSafe, Jinja2, click, flask</code></pre><p>Your micro's <code>endpoint</code> will be different from the output shown above. This <code>endpoint</code> will be the form endpoint.<li><p>You can also see that the <code>http_auth</code> is <code>enabled</code> by default. We will disable the <code>http_auth</code> so that form data can be sent to the micro.<pre class="language-shell"><code class="language-shell">$ deta auth disable
Successfully disabled http auth</code></pre><p>This is only for the tutorial, we recommended that you protect your endpoint with some authentication.<li><p>Open <code>main.py</code> and add a <code>POST</code> endpoint for the form using <code>flask</code>.<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request

<span class="token comment">#flask app</span>
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span>POST<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">save_form_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># TODO: save data</span>
    <span class="token keyword">return</span> ok</code></pre><li><p>Update <code>main.py</code> to add logic to save the form data to a Deta Base.<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request
<span class="token keyword">from</span> deta <span class="token keyword">import</span> Deta

<span class="token comment"># flask app</span>
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token comment"># contact form base</span>
form_db <span class="token operator">=</span> Deta<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Base<span class="token punctuation">(</span>contact<span class="token operator">-</span>form<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span>POST<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">save_form_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    form_db<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment"># flask sends a 400 automatically if there is a KeyError </span>
        name<span class="token punctuation">:</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">,</span>
        email<span class="token punctuation">:</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span>email<span class="token punctuation">]</span><span class="token punctuation">,</span>
        message<span class="token punctuation">:</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span>message<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> ok<span class="token punctuation">,</span> <span class="token number">201</span></code></pre><li><p>Deploy the changes with <code>deta deploy</code>.<pre class="language-shell"><code class="language-shell">$ deta deploy
Successfully deployed changes</code></pre></ol><p>Your endpoint will now accept form <code>POST</code> data and save it to a database.<p>You can use <a href="../base/base_ui">Deta Base's UI</a> to easily see what data has been stored in the database. Navigate to your <code>project</code> and click on your base name under <code>bases</code> in your browser to use the Base UI.<p>Here's an example view of the UI.</p><img src="/img/quickstart/contact_form.png"width="1000/"></tabitem><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span>