<!doctype html><html id="webhooks-guide"lang="en"><meta charset="utf-8"><title>Webhooks</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="sidebar_label"content="Webhooks"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><p>import Tabs from '@theme/Tabs'; import TabItem from '@theme/TabItem';<p><a href="../micros/about.md">Deta Micros</a> make it extremely easy to deploy webhook servers.<p>Each Deta Micro has a unique HTTPS endpoint which can be used as the webhook URL.<p>You can use your favorite web application framework for your webhook server.<p>The guide assumes you have already signed up for Deta and have the <a href="../cli/install.md">Deta CLI</a> installed.<p>&#x3C;Tabs groupId=preferred-language defaultValue=js values={[ {label: 'JavaScript', value: 'js', }, {label: 'Python', value: 'py', }, ] }></p><tabitem value="js"><p>We are going to use <code>express</code> with our Deta Micro and deploy a simple <code>nodejs</code> webhook server.<ol><li><p>Create a directory <code>express-webhook</code> and change the current directory to it.<pre class="language-shell"><code class="language-shell">$ <span class="token function">mkdir</span> express-webhook <span class="token operator">&#x26;&#x26;</span> <span class="token builtin class-name">cd</span> express-webhook</code></pre><li><p>Create an empty <code>index.js</code> file (we will add the code that handles the logic later).<li><p>Initialize a <code>nodejs</code> project with <code>npm init</code><pre class="language-shell"><code class="language-shell">$ <span class="token function">npm</span> init -y</code></pre><p>You can skip the <code>-y</code> flag, if you want to fill the details about the package interactively through npm's wizard.<li><p>Install <code>express</code> locally for your project.<pre class="language-shell"><code class="language-shell">$ <span class="token function">npm</span> <span class="token function">install</span> express</code></pre><li><p>Create a new <code>nodejs</code> micro with <code>deta new</code>. This will create a new <code>nodejs</code> micro for you and automatically install <code>express</code> as a dependency.<pre class="language-shell"><code class="language-shell">$ deta new
Successfully created a new micro
<span class="token punctuation">{</span>
    name: express-webhook,
    runtime: nodejs12.x,
    endpoint: https://<span class="token punctuation">{</span>micro_name<span class="token punctuation">}</span>.deta.dev,
    visor: enabled,
    http_auth: enabled
<span class="token punctuation">}</span>
Adding dependencies<span class="token punctuation">..</span>.

+ express@4.17.1
added <span class="token number">50</span> packages from <span class="token number">37</span> contributors and audited <span class="token number">50</span> packages <span class="token keyword">in</span> <span class="token number">1</span>.967s
found <span class="token number">0</span> vulnerabilities</code></pre><p>Your micro's <code>endpoint</code> will be different from the output shown above. This <code>endpoint</code> will be the webhook URL when you set up your webhooks.<li><p>You can also see that the <code>http_auth</code> is <code>enabled</code> by default. We will disable the <code>http_auth</code> so that webhook events can be sent to the micro.<pre class="language-shell"><code class="language-shell">$ deta auth disable
Successfully disabled http auth</code></pre><blockquote>Usually for security, a secret token is shared between the sender and the receiver and a hmac signature is calculated from the payload and the shared secret. The algorithm to calculate the signature varies based on the sender. You should consult the documentation of how the signature is calculated for the system you are receiving events from.</blockquote><li><p>Add a <code>POST</code> route to <code>index.js</code>. Most webhook callbacks send a <code>POST</code> request on the webhook URL with the payload containing information about the event that triggered the webhook.<p>Open <code>index.js</code> and add the handler to handle webhook events.<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// a POST route for our webhook events</span>
app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// verify signature if needed</span>
    <span class="token comment">// add your logic to handle the request</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// you only need to export your app for the deta micro. You don't need to start the server on a port.</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> app<span class="token punctuation">;</span></code></pre><li><p>Deploy your changes with <code>deta deploy</code>.<pre class="language-shell"><code class="language-shell">$ deta deploy
Successfully deployed changes</code></pre></ol><p>Your micro will now trigger on <code>POST</code> requests to the micro's endpoint. Use your micro's endpoint as the webhook URL when you set up your webhooks elsewhere.<p>In order to see the logs when the webhook is triggered, you can use <code>deta visor</code> to see real-time logs of your application. You can also replay your webhook events from <code>deta visor</code> to debug any issues.<p>You can open your visor page with the command <code>deta visor open</code> from the cli.</p><tabitem value="py"><p>We are going to use <code>fastapi</code> with our Deta Micro and deploy a simple <code>python</code> webhook server.<ol><li><p>Create a directory <code>fastapi-webhook</code> and change the current directory to it.<pre class="language-shell"><code class="language-shell">$ <span class="token function">mkdir</span> fastapi-webhook <span class="token operator">&#x26;&#x26;</span> <span class="token builtin class-name">cd</span> fastapi-webhook</code></pre><li><p>Create an empty <code>main.py</code> file (we will add the code that handles the logic later).<li><p>Create a <code>requirements.txt</code> file and add <code>fastapi</code> as a dependency.<pre class="language-text"><code class="language-text">fastapi</code></pre><li><p>Create a new <code>python</code> micro with <code>deta new</code>. This will create a new <code>python</code> micro for you and automatically install <code>fastapi</code> as a dependency.<pre class="language-shell"><code class="language-shell">$ deta new
Successfully created a new micro
<span class="token punctuation">{</span>
    name: fastapi-webhook,
    runtime: python3.7,
    endpoint: https://<span class="token punctuation">{</span>micro_name<span class="token punctuation">}</span>.deta.dev,
    visor: enabled,
    http_auth: enabled
<span class="token punctuation">}</span>
Adding dependencies<span class="token punctuation">..</span>.
Collecting fastapi
<span class="token punctuation">..</span>.
Successfully installed fastapi-0.61.1 pydantic-1.6.1 starlette-0.13.6</code></pre><p>Your micro's <code>endpoint</code> will be different from the output shown above. This <code>endpoint</code> will be the webhook URL when you set up your webhooks.<li><p>You can also see that the <code>http_auth</code> is <code>enabled</code> by default. We will disable the <code>http_auth</code> so that webhook events can be sent to the micro.<pre class="language-shell"><code class="language-shell">$ deta auth disable
Successfully disabled http auth</code></pre><blockquote>Usually for security, a secret token is shared between the sender and the receiver and a hmac signature is calculated from the payload and the shared secret. The algorithm to calculate the signature varies based on the sender. You should consult the documentation of how the signature is calculated for the system you are receiving events from.</blockquote><li><p>Add a <code>POST</code> route to <code>main.py</code>. Most webhook callbacks send a <code>POST</code> request on the webhook URL with the payload containing information about the event that triggered the webhook.<p>Open <code>main.py</code> and add the handler to handle webhook events.<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Request

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># a POST route for our webhook events</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">webhook_handler</span><span class="token punctuation">(</span>req<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># verify signature if needed</span>
    <span class="token comment"># add logic to handle the request</span>
    <span class="token keyword">return</span> ok</code></pre><li><p>Deploy your changes with <code>deta deploy</code>.<pre class="language-shell"><code class="language-shell">$ deta deploy
Successfully deployed changes</code></pre></ol><p>Your micro will now trigger on <code>POST</code> requests to the micro's endpoint. Use your micro's endpoint as the webhook URL when you set up your webhooks elsewhere.<p>In order to see the logs of when the webhook is triggered, you can use <code>deta visor</code> to see real-time logs of your application. You can also replay your webhook events from <code>deta visor</code> to debug any issues.<p>You can open your visor page with the command <code>deta visor open</code> from the cli.</p></tabitem><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></tabitem>