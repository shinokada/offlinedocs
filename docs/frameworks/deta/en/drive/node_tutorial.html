<!doctype html><html id="node_tutorial"lang="en"><meta charset="utf-8"><title>Node Tutorial</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><p>import Tabs from '@theme/Tabs'; import TabItem from '@theme/TabItem';<section id="building-a-simple-image-server-with-deta-drive"class="level2"><h2>Building a Simple Image Server with Deta Drive</h2><section id="setup"class="level3"><h3>Setup</h3><p>To get started, create a directory <code>image-server</code> and change the current directory into it.<pre class="language-shell"><code class="language-shell">$ <span class="token function">mkdir</span> image-server <span class="token operator">&#x26;&#x26;</span> <span class="token builtin class-name">cd</span> image-server</code></pre><p>Before we begin, let's install all the necessary dependencies for this project.<pre class="language-shell"><code class="language-shell">$ <span class="token function">npm</span> <span class="token function">install</span> deta express express-fileupload </code></pre><p>In this tutorial, we are using <code>express</code> to build our server, and <code>express-fileupload</code> allows us to access the uploaded file data.<p>To configure the app, import the dependencies and instantiate drive in <code>index.js</code><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Deta</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>deta<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>express<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>express<span class="token operator">-</span>fileupload<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> deta <span class="token operator">=</span> <span class="token function"><span class="token maybe-class-name">Deta</span></span><span class="token punctuation">(</span><span class="token maybe-class-name">Project_Key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> drive <span class="token operator">=</span> deta<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Drive</span></span><span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>We have everything we need to ðŸš€</section><section id="uploading-images"class="level3"><h3>Uploading Images</h3><p>First, we need to render a HTML snippet to display the file upload interface.<p>We'll expose a function that renders the HTML snippet on the base route <code>/</code><pre class="language-javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &#x3C;form action=/upload enctype=multipart/form-data method=post>
      &#x3C;input type=file name=file>
      &#x3C;input type=submit value=Upload>
    &#x3C;/form></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>We are simply rendering a HTML form that sends a HTTP <code>POST</code> request to the route <code>/upload</code> with file data.<p>Let's complete file upload by creating a function to handle <code>/upload</code><pre class="language-javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token operator">/</span>upload<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> name <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">files</span><span class="token punctuation">.</span><span class="token property-access">file</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> contents <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">files</span><span class="token punctuation">.</span><span class="token property-access">file</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword control-flow">await</span> drive<span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">data</span><span class="token operator">:</span> contents<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>We can access the image details from <code>req</code> and store it in Drive.</section><section id="downloading-images"class="level3"><h3>Downloading Images</h3><p>To download images, we can simply use <code>drive.get(name)</code><p>If we tie a <code>GET</code> request to the <code>/download</code> path with a param giving a name (i.e <code>/download/space.png</code>), we can return the image over HTTP.<pre class="language-javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">download</span><span class="token regex-delimiter">/</span></span><span class="token operator">:</span>name<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> name <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword control-flow">await</span> drive<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> buffer <span class="token operator">=</span> <span class="token keyword control-flow">await</span> img<span class="token punctuation">.</span><span class="token method function property-access">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token maybe-class-name">Buffer</span><span class="token punctuation">.</span><span class="token keyword module">from</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="running-the-server"class="level3"><h3>Running the server</h3><p>To run the server locally, navigate to the terminal in the project directory (<code>image-server</code>) and run the following command:<pre class="language-shell"><code class="language-shell">$ <span class="token function">node</span> index.js</code></pre><img src="/img/drive/drive-py-tut.png"alt="//"> <img src="/img/drive/drive-py-tut-1.png"alt="/download/tut.jpg/"><pre class="language-shell"><code class="language-shell"><span class="token function">curl</span> -X <span class="token string">'POST'</span> <span class="token punctuation">\</span>
  <span class="token string">'http://127.0.0.1:3000/upload'</span> <span class="token punctuation">\</span>
  -H <span class="token string">'accept: application/json'</span> <span class="token punctuation">\</span>
  -H <span class="token string">'Content-Type: multipart/form-data'</span> <span class="token punctuation">\</span>
  -F <span class="token string">'file=@space.png;type=image/png'</span>

Response 
space.png

<span class="token function">curl</span> -X <span class="token string">'GET'</span> <span class="token punctuation">\</span>
  <span class="token string">'http://127.0.0.1:3000/download/space.png'</span> <span class="token punctuation">\</span>
  -H <span class="token string">'accept: application/json'</span>

Response 
The server should respond with the image. </code></pre></section></section><section id="issues"class="level2"><h2>Issues</h2><p>If you run into any issues, consider reporting them in our <a href="https://github.com/orgs/deta/discussions">Github Discussions</a>.<span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section>