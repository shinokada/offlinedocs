<!doctype html><html lang="en"><meta charset="utf-8"><title>Migration guide</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="migration-guide"class="level3"><h3>Migration guide</h3><p>This article provides a set of guidelines for migrating from Nest version 8 to version 9. To learn more about the new features we've added in v9, check out this <a href="https://github.com/nestjs/nest/pull/9588">link</a>.<section id="redis-strategy-microservices"class="level4"><h4>Redis strategy (microservices)</h4><p><a href="/microservices/redis">Redis</a> strategy uses the <a href="https://github.com/luin/ioredis">ioredis</a> driver instead of <code>redis</code> now.<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Before</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">NestFactory</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">createMicroservice</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">MicroserviceOptions</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
  <span class="token maybe-class-name">AppModule</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    transport<span class="token operator">:</span> <span class="token maybe-class-name">Transport</span><span class="token punctuation">.</span><span class="token constant">REDIS</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      url<span class="token operator">:</span> <span class="token string">'redis://localhost:6379'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Now</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">NestFactory</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">createMicroservice</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">MicroserviceOptions</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
  <span class="token maybe-class-name">AppModule</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    transport<span class="token operator">:</span> <span class="token maybe-class-name">Transport</span><span class="token punctuation">.</span><span class="token constant">REDIS</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      host<span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
      port<span class="token operator">:</span> <span class="token number">6379</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Also, make sure to install the <code>ioredis</code> package:<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i ioredis</code></pre></section><section id="grpc-client-interceptors"class="level4"><h4>gRPC client interceptors</h4><p>In the previous version, the <code>interceptors</code> configuration property was exposed in the wrong location. In v9, make sure to pass <code>interceptors</code> as part of the <code>channelOptions</code> object, see example <a href="https://github.com/nestjs/nest/issues/9079#issuecomment-1078744758">here</a>.</section><section id="testing-module"class="level4"><h4>Testing module</h4><p>Previously, if you wanted to supply the configuration object to the <code>TestingModule#createNestApplication</code> method, and if you were using the default HTTP driver (express), you had to do this as follows:<pre class="language-typescript"><code class="language-typescript">app <span class="token operator">=</span> moduleFixture<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">createNestApplication</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">NestExpressApplication</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token keyword nil">undefined</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  rawBody<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>In v9, you can skip the first argument (<code>undefined</code>):<pre class="language-typescript"><code class="language-typescript">app <span class="token operator">=</span> moduleFixture<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">createNestApplication</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">NestExpressApplication</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  rawBody<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="kafka-messageevent-handlers"class="level4"><h4>Kafka message/event handlers</h4><p>Previously, Kafka message and event handlers were receiving payloads as wrapped Kafka messages with <code>key</code>, <code>value</code>, <code>headers</code>, and a few other properites. In v9, those payloads are automatically unwrapped and your handlers will only receive the <code>value</code> attribute's value. To retrieve the original Kafka message, you can use the <code>KafkaContext</code> object (read more <a href="/microservices/kafka#context">here</a>).<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Before</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">MessagePattern</span></span><span class="token punctuation">(</span><span class="token string">'hero.kill.dragon'</span><span class="token punctuation">)</span>
<span class="token function">killDragon</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Payload</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> message<span class="token operator">:</span> <span class="token maybe-class-name">KillDragonMessage</span><span class="token punctuation">,</span> <span class="token decorator"><span class="token at operator">@</span><span class="token function">Ctx</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> context<span class="token operator">:</span> <span class="token maybe-class-name">KafkaContext</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Dragon ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">.</span><span class="token property-access">dragonId</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Now</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">MessagePattern</span></span><span class="token punctuation">(</span><span class="token string">'hero.kill.dragon'</span><span class="token punctuation">)</span>
<span class="token function">killDragon</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Payload</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> message<span class="token operator">:</span> <span class="token maybe-class-name">KillDragonMessage</span><span class="token punctuation">,</span> <span class="token decorator"><span class="token at operator">@</span><span class="token function">Ctx</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> context<span class="token operator">:</span> <span class="token maybe-class-name">KafkaContext</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Dragon ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token punctuation">.</span><span class="token property-access">dragonId</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Original message: "context.getMessage()"</span>
<span class="token punctuation">}</span></code></pre></section><section id="kafka-retriable-errors"class="level4"><h4>Kafka retriable errors</h4><p>In v9, we introduced the <strong><a href="/microservices/kafka#retriable-exceptions">Retriable exceptions</a></strong> feature. Note: for event handlers (<strong>event-based communication</strong>) all unhandled exceptions become "retriable exceptions" by default, and so they will be auto-delivered.</section><section id="fastify"class="level4"><h4>Fastify</h4><p>Fastify has been upgraded to v4. Also, all of the core Fastify plugins that were prefixed with <code>fastify-</code> are now renamed and published under the <code>@fastify</code> scope (for example, <code>fastify-cookie</code> becomes <code>@fastify/cookie</code>, <code>fastify-helmet</code> becomes <code>@fastify/helmet</code>, etc.). Read more <a href="https://github.com/fastify/fastify/issues/3856">here</a>.</section><section id="nestjsswagger-package"class="level4"><h4><code>@nestjs/swagger</code> package</h4><p>There are a few minor breaking changes in the <code>@nestjs/swagger</code> package (<code>swagger-ui-express</code> and <code>fastify-swagger</code> packages are no longer required). See this <a href="https://github.com/nestjs/swagger/pull/1886">PR</a> for more details.</section><section id="deprecations"class="level4"><h4>Deprecations</h4><p>All deprecated methods &#x26; modules have been removed (e.g., the deprecated <code>listenAsync()</code> method).</section><section id="nodejs"class="level4"><h4>Node.js</h4><p>This release drops support for Node v10. We strongly recommend using the latest LTS version.</section><section id="cli"class="level4"><h4>CLI</h4><p>Due to stability issues, the command <code>update</code> was removed in the v9 of <code>@nestjs/cli</code>.<br>You can use dedicated tools like <a href="https://www.npmjs.com/package/npm-check-updates"><code>ncu</code></a>, <code>npm update</code>, <a href="https://classic.yarnpkg.com/en/docs/cli/upgrade-interactive"><code>yarn upgrade-interactive</code></a>, etc., if you want to upgrade your dependencies. <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>