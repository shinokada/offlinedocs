<!doctype html><html lang="en"><meta charset="utf-8"><title>Helmet</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="helmet"class="level3"><h3>Helmet</h3><p><a href="https://github.com/helmetjs/helmet">Helmet</a> can help protect your app from some well-known web vulnerabilities by setting HTTP headers appropriately. Generally, Helmet is just a collection of smaller middleware functions that set security-related HTTP headers (read <a href="https://github.com/helmetjs/helmet#how-it-works">more</a>).<blockquote><p>info <strong>Hint</strong> Note that applying <code>helmet</code> as global or registering it must come before other calls to <code>app.use()</code> or setup functions that may call <code>app.use()</code>. This is due to the way the underlying platform (i.e., Express or Fastify) works, where the order that middleware/routes are defined matters. If you use middleware like <code>helmet</code> or <code>cors</code> after you define a route, then that middleware will not apply to that route, it will only apply to routes defined after the middleware.</blockquote><section id="use-with-express-default"class="level4"><h4>Use with Express (default)</h4><p>Start by installing the required package.<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i --save helmet</code></pre><p>Once the installation is complete, apply it as a global middleware.<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports">helmet</span> <span class="token keyword module">from</span> <span class="token string">'helmet'</span><span class="token punctuation">;</span>
<span class="token comment">// somewhere in your initialization file</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">helmet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>info <strong>Hint</strong> If you are getting the <code>This expression is not callable</code> error while trying to import <code>Helmet</code>, you very likely have the <code>allowSyntheticDefaultImports</code> and <code>esModuleInterop</code> options set to <code>true</code> in your project's <code>tsconfig.json</code> file. If that's the case, change the import statement to: <code>import helmet from 'helmet'</code> instead.</blockquote></section><section id="use-with-fastify"class="level4"><h4>Use with Fastify</h4><p>If you are using the <code>FastifyAdapter</code>, install the <a href="https://github.com/fastify/fastify-helmet">@fastify/helmet</a> package:<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i --save @fastify/helmet</code></pre><p><a href="https://github.com/fastify/fastify-helmet">fastify-helmet</a> should not be used as a middleware, but as a <a href="https://www.fastify.io/docs/latest/Reference/Plugins/">Fastify plugin</a>, i.e., by using <code>app.register()</code>:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports">helmet</span> <span class="token keyword module">from</span> <span class="token string">'@fastify/helmet'</span>
<span class="token comment">// somewhere in your initialization file</span>
<span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">register</span><span class="token punctuation">(</span>helmet<span class="token punctuation">)</span></code></pre><blockquote><p>warning <strong>Warning</strong> When using <code>apollo-server-fastify</code> and <code>@fastify/helmet</code>, there may be a problem with <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">CSP</a> on the GraphQL playground, to solve this collision, configure the CSP as shown below:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">register</span><span class="token punctuation">(</span>fastifyHelmet<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  contentSecurityPolicy<span class="token operator">:</span> <span class="token punctuation">{</span>
    directives<span class="token operator">:</span> <span class="token punctuation">{</span>
      defaultSrc<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'self'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      styleSrc<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'self'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'unsafe-inline'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token string">'cdn.jsdelivr.net'</span><span class="token punctuation">,</span>
        <span class="token string">'fonts.googleapis.com'</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      fontSrc<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'self'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">'fonts.gstatic.com'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      imgSrc<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'self'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">'data:'</span><span class="token punctuation">,</span> <span class="token string">'cdn.jsdelivr.net'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      scriptSrc<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'self'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https: 'unsafe-inline'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">cdn.jsdelivr.net</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// If you are not going to use CSP at all, you can use this:</span>
<span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">register</span><span class="token punctuation">(</span>fastifyHelmet<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  contentSecurityPolicy<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></blockquote></section></section>