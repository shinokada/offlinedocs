<!doctype html><html lang="en"><meta charset="utf-8"><title>Encryption and Hashing</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="encryption-and-hashing"class="level3"><h3>Encryption and Hashing</h3><p><strong>Encryption</strong> is the process of encoding information. This process converts the original representation of the information, known as plaintext, into an alternative form known as ciphertext. Ideally, only authorized parties can decipher a ciphertext back to plaintext and access the original information. Encryption does not itself prevent interference but denies the intelligible content to a would-be interceptor. Encryption is a two-way function; what is encrypted can be decrypted with the proper key.<p><strong>Hashing</strong> is the process of converting a given key into another value. A hash function is used to generate the new value according to a mathematical algorithm. Once hashing has been done, it should be impossible to go from the output to the input.<section id="encryption"class="level4"><h4>Encryption</h4><p>Node.js provides a built-in <a href="https://nodejs.org/api/crypto.html">crypto module</a> that you can use to encrypt and decrypt strings, numbers, buffers, streams, and more. Nest itself does not provide any additional package on top of this module to avoid introducing unnecessary abstractions.<p>As an example, let's use AES (Advanced Encryption System) <code>'aes-256-ctr'</code> algorithm CTR encryption mode.<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createCipheriv<span class="token punctuation">,</span> randomBytes<span class="token punctuation">,</span> scrypt <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'crypto'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> promisify <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'util'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> iv <span class="token operator">=</span> <span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> password <span class="token operator">=</span> <span class="token string">'Password used to generate key'</span><span class="token punctuation">;</span>

<span class="token comment">// The key length is dependent on the algorithm.</span>
<span class="token comment">// In this case for aes256, it is 32 bytes.</span>
<span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword control-flow">await</span> <span class="token function">promisify</span><span class="token punctuation">(</span>scrypt<span class="token punctuation">)</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> <span class="token string">'salt'</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword module">as</span> <span class="token maybe-class-name">Buffer</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cipher <span class="token operator">=</span> <span class="token function">createCipheriv</span><span class="token punctuation">(</span><span class="token string">'aes-256-ctr'</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> iv<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> textToEncrypt <span class="token operator">=</span> <span class="token string">'Nest'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> encryptedText <span class="token operator">=</span> <span class="token maybe-class-name">Buffer</span><span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  cipher<span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span>textToEncrypt<span class="token punctuation">)</span><span class="token punctuation">,</span>
  cipher<span class="token punctuation">.</span><span class="token method function property-access">final</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Now to decrypt <code>encryptedText</code> value:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createDecipheriv <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'crypto'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> decipher <span class="token operator">=</span> <span class="token function">createDecipheriv</span><span class="token punctuation">(</span><span class="token string">'aes-256-ctr'</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> iv<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> decryptedText <span class="token operator">=</span> <span class="token maybe-class-name">Buffer</span><span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  decipher<span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span>encryptedText<span class="token punctuation">)</span><span class="token punctuation">,</span>
  decipher<span class="token punctuation">.</span><span class="token method function property-access">final</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="hashing"class="level4"><h4>Hashing</h4><p>For hashing, we recommend using either the <a href="https://www.npmjs.com/package/bcrypt">bcrypt</a> or <a href="https://www.npmjs.com/package/argon2">argon2</a> packages. Nest itself does not provide any additional wrappers on top of these modules to avoid introducing unnecessary abstractions (making the learning curve short).<p>As an example, let's use <code>bcrypt</code> to hash a random password.<p>First install required packages:<pre class="language-shell"><code class="language-shell">$ <span class="token function">npm</span> i bcrypt
$ <span class="token function">npm</span> i -D @types/bcrypt</code></pre><p>Once the installation is complete, you can use the <code>hash</code> function, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> bcrypt</span> <span class="token keyword module">from</span> <span class="token string">'bcrypt'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> saltOrRounds <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> password <span class="token operator">=</span> <span class="token string">'random_password'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> hash <span class="token operator">=</span> <span class="token keyword control-flow">await</span> bcrypt<span class="token punctuation">.</span><span class="token method function property-access">hash</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> saltOrRounds<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To generate a salt, use the <code>genSalt</code> function:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> salt <span class="token operator">=</span> <span class="token keyword control-flow">await</span> bcrypt<span class="token punctuation">.</span><span class="token method function property-access">genSalt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To compare/check a password, use the <code>compare</code> function:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> isMatch <span class="token operator">=</span> <span class="token keyword control-flow">await</span> bcrypt<span class="token punctuation">.</span><span class="token method function property-access">compare</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>You can read more about available functions <a href="https://www.npmjs.com/package/bcrypt">here</a>. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>