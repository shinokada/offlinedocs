<!doctype html><html lang="en"><meta charset="utf-8"><title>Serialization</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="serialization"class="level3"><h3>Serialization</h3><p>Serialization is a process that happens before objects are returned in a network response. This is an appropriate place to provide rules for transforming and sanitizing the data to be returned to the client. For example, sensitive data like passwords should always be excluded from the response. Or, certain properties might require additional transformation, such as sending only a subset of properties of an entity. Performing these transformations manually can be tedious and error prone, and can leave you uncertain that all cases have been covered.<section id="overview"class="level4"><h4>Overview</h4><p>Nest provides a built-in capability to help ensure that these operations can be performed in a straightforward way. The <code>ClassSerializerInterceptor</code> interceptor uses the powerful <a href="https://github.com/typestack/class-transformer">class-transformer</a> package to provide a declarative and extensible way of transforming objects. The basic operation it performs is to take the value returned by a method handler and apply the <code>instanceToPlain()</code> function from <a href="https://github.com/typestack/class-transformer">class-transformer</a>. In doing so, it can apply rules expressed by <code>class-transformer</code> decorators on an entity/DTO class, as described below.</section><section id="exclude-properties"class="level4"><h4>Exclude properties</h4><p>Let's assume that we want to automatically exclude a <code>password</code> property from a user entity. We annotate the entity as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Exclude</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'class-transformer'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">UserEntity</span></span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  firstName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  lastName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Exclude</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  password<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>partial<span class="token operator">:</span> <span class="token maybe-class-name">Partial</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">UserEntity</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> partial<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Now consider a controller with a method handler that returns an instance of this class.<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">UseInterceptors</span></span><span class="token punctuation">(</span><span class="token maybe-class-name">ClassSerializerInterceptor</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">UserEntity</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">UserEntity</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    firstName<span class="token operator">:</span> <span class="token string">'Kamil'</span><span class="token punctuation">,</span>
    lastName<span class="token operator">:</span> <span class="token string">'Mysliwiec'</span><span class="token punctuation">,</span>
    password<span class="token operator">:</span> <span class="token string">'password'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p><strong>Warning</strong> Note that we must return an instance of the class. If you return a plain JavaScript object, for example, <code>{{ '{' }} user: new UserEntity() {{ '}' }}</code>, the object won't be properly serialized.</blockquote><blockquote><p>info <strong>Hint</strong> The <code>ClassSerializerInterceptor</code> is imported from <code>@nestjs/common</code>.</blockquote><p>When this endpoint is requested, the client receives the following response:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"firstName"</span><span class="token operator">:</span> <span class="token string">"Kamil"</span><span class="token punctuation">,</span>
  <span class="token property">"lastName"</span><span class="token operator">:</span> <span class="token string">"Mysliwiec"</span>
<span class="token punctuation">}</span></code></pre><p>Note that the interceptor can be applied application-wide (as covered <a href="https://docs.nestjs.com/interceptors#binding-interceptors">here</a>). The combination of the interceptor and the entity class declaration ensures that <strong>any</strong> method that returns a <code>UserEntity</code> will be sure to remove the <code>password</code> property. This gives you a measure of centralized enforcement of this business rule.</section><section id="expose-properties"class="level4"><h4>Expose properties</h4><p>You can use the <code>@Expose()</code> decorator to provide alias names for properties, or to execute a function to calculate a property value (analogous to <strong>getter</strong> functions), as shown below.<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Expose</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">get</span> <span class="token function">fullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">firstName</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">lastName</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section><section id="transform"class="level4"><h4>Transform</h4><p>You can perform additional data transformation using the <code>@Transform()</code> decorator. For example, the following construct returns the name property of the <code>RoleEntity</code> instead of returning the whole object.<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Transform</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> value<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span>
role<span class="token operator">:</span> <span class="token maybe-class-name">RoleEntity</span><span class="token punctuation">;</span></code></pre></section><section id="pass-options"class="level4"><h4>Pass options</h4><p>You may want to modify the default behavior of the transformation functions. To override default settings, pass them in an <code>options</code> object with the <code>@SerializeOptions()</code> decorator.<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">SerializeOptions</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  excludePrefixes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'_'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">UserEntity</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">UserEntity</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> The <code>@SerializeOptions()</code> decorator is imported from <code>@nestjs/common</code>.</blockquote><p>Options passed via <code>@SerializeOptions()</code> are passed as the second argument of the underlying <code>instanceToPlain()</code> function. In this example, we are automatically excluding all properties that begin with the <code>_</code> prefix.</section><section id="example"class="level4"><h4>Example</h4><p>A working example is available <a href="https://github.com/nestjs/nest/tree/master/sample/21-serializer">here</a>.</section><section id="websockets-and-microservices"class="level4"><h4>WebSockets and Microservices</h4><p>While this chapter shows examples using HTTP style applications (e.g., Express or Fastify), the <code>ClassSerializerInterceptor</code> works the same for WebSockets and Microservices, regardless of the transport method that is used.</section><section id="learn-more"class="level4"><h4>Learn more</h4><p>Read more about available decorators and options as provided by the <code>class-transformer</code> package <a href="https://github.com/typestack/class-transformer">here</a>. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>