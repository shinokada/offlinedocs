<!doctype html><html lang="en"><meta charset="utf-8"><title>File upload</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="file-upload"class="level3"><h3>File upload</h3><p>To handle file uploading, Nest provides a built-in module based on the <a href="https://github.com/expressjs/multer">multer</a> middleware package for Express. Multer handles data posted in the <code>multipart/form-data</code> format, which is primarily used for uploading files via an HTTP <code>POST</code> request. This module is fully configurable and you can adjust its behavior to your application requirements.<blockquote><p>warning <strong>Warning</strong> Multer cannot process data which is not in the supported multipart format (<code>multipart/form-data</code>). Also, note that this package is not compatible with the <code>FastifyAdapter</code>.</blockquote><p>For better type safety, let's install Multer typings package:<pre class="language-shell"><code class="language-shell">$ <span class="token function">npm</span> i -D @types/multer</code></pre><p>With this package installed, we can now use the <code>Express.Multer.File</code> type (you can import this type as follows: <code>import {{ '{' }} Express {{ '}' }} from 'express'</code>).<section id="basic-example"class="level4"><h4>Basic example</h4><p>To upload a single file, simply tie the <code>FileInterceptor()</code> interceptor to the route handler and extract <code>file</code> from the <code>request</code> using the <code>@UploadedFile()</code> decorator.<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseInterceptors</span></span><span class="token punctuation">(</span><span class="token function"><span class="token maybe-class-name">FileInterceptor</span></span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">UploadedFile</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> file<span class="token operator">:</span> <span class="token maybe-class-name">Express</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Multer</span></span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">File</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
@@<span class="token keyword control-flow">switch</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseInterceptors</span></span><span class="token punctuation">(</span><span class="token function"><span class="token maybe-class-name">FileInterceptor</span></span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Bind</span></span><span class="token punctuation">(</span><span class="token function"><span class="token maybe-class-name">UploadedFile</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">uploadFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> The <code>FileInterceptor()</code> decorator is exported from the <code>@nestjs/platform-express</code> package. The <code>@UploadedFile()</code> decorator is exported from <code>@nestjs/common</code>.</blockquote><p>The <code>FileInterceptor()</code> decorator takes two arguments:<ul><li><code>fieldName</code>: string that supplies the name of the field from the HTML form that holds a file<li><code>options</code>: optional object of type <code>MulterOptions</code>. This is the same object used by the multer constructor (more details <a href="https://github.com/expressjs/multer#multeropts">here</a>).</ul><blockquote><p>warning <strong>Warning</strong> <code>FileInterceptor()</code> may not be compatible with third party cloud providers like Google Firebase or others.</blockquote></section><section id="file-validation"class="level4"><h4>File validation</h4><p>Often times it can be useful to validate incoming file metadata, like file size or file mime-type. For this, you can create your own <a href="https://docs.nestjs.com/pipes">Pipe</a> and bind it to the parameter annotated with the <code>UploadedFile</code> decorator. The example below demonstrates how a basic file size validator pipe could be implemented:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">PipeTransform</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Injectable</span><span class="token punctuation">,</span> <span class="token maybe-class-name">ArgumentMetadata</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">FileSizeValidationPipe</span></span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token maybe-class-name">PipeTransform</span></span> <span class="token punctuation">{</span>
  <span class="token function">transform</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> metadata<span class="token operator">:</span> <span class="token maybe-class-name">ArgumentMetadata</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// "value" is an object containing the file's attributes and metadata</span>
    <span class="token keyword">const</span> oneKb <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> value<span class="token punctuation">.</span><span class="token property-access">size</span> <span class="token operator">&#x3C;</span> oneKb<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Nest provides a built-in pipe to handle common use cases and facilitate/standardize the addition of new ones. This pipe is called <code>ParseFilePipe</code>, and you can use it as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span>
<span class="token function">uploadFileAndPassValidation</span><span class="token punctuation">(</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> body<span class="token operator">:</span> <span class="token maybe-class-name">SampleDto</span><span class="token punctuation">,</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">UploadedFile</span></span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">ParseFilePipe</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      validators<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// ... Set of file validator instances here</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  file<span class="token operator">:</span> <span class="token maybe-class-name">Express</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Multer</span></span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">File</span></span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    body<span class="token punctuation">,</span>
    file<span class="token operator">:</span> file<span class="token punctuation">.</span><span class="token property-access">buffer</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>As you can see, it's required to specify an array of file validators that will be executed by the <code>ParseFilePipe</code>. We'll discuss the interface of a validator, but it's worth mentioning this pipe also has two additional <strong>optional</strong> options:<table><tr><td><code>errorHttpStatusCode</code><td>The HTTP status code to be thrown in case <b>any</b> validator fails. Default is <code>400</code> (BAD REQUEST)<tr><td><code>exceptionFactory</code><td>A factory which receives the error message and returns an error.</table><p>Now, back to the <code>FileValidator</code> interface. To integrate validators with this pipe, you have to either use built-in implementations or provide your own custom <code>FileValidator</code>. See example below:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">FileValidator</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">TValidationOptions</span> <span class="token operator">=</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">>></span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">protected</span> <span class="token keyword">readonly</span> validationOptions<span class="token operator">:</span> <span class="token maybe-class-name">TValidationOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token doc-comment comment">/**
   * Indicates if this file should be considered valid, according to the options passed in the constructor.
   * <span class="token keyword">@param</span> <span class="token parameter">file</span> the file from the request object
   */</span>
  <span class="token keyword">abstract</span> <span class="token function">isValid</span><span class="token punctuation">(</span>file<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token builtin">boolean</span><span class="token operator">></span><span class="token punctuation">;</span>

  <span class="token doc-comment comment">/**
   * Builds an error message in case the validation fails.
   * <span class="token keyword">@param</span> <span class="token parameter">file</span> the file from the request object
   */</span>
  <span class="token keyword">abstract</span> <span class="token function">buildErrorMessage</span><span class="token punctuation">(</span>file<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> The <code>FileValidator</code> interfaces supports async validation via its <code>isValid</code> function. To leverage type security, you can also type the <code>file</code> parameter as <code>Express.Multer.File</code> in case you are using express (default) as a driver.</blockquote><p><code>FileValidator</code> is a regular class that has access to the file object and validates it according to the options provided by the client. Nest has two built-in <code>FileValidator</code> implementations you can use in your project:<ul><li><code>MaxFileSizeValidator</code> - Checks if a given file's size is less than the provided value (measured in <code>bytes</code>)<li><code>FileTypeValidator</code> - Checks if a given file's mime-type matches the given value.</ul><blockquote><p>warning <strong>Warning</strong> To verify file type, <a href="https://github.com/nestjs/nest/blob/master/packages/common/pipes/file/file-type.validator.ts">FileTypeValidator</a> class uses the type as detected by multer. By default, multer derives file type from file extension on user's device. However, it does not check actual file contents. As files can be renamed to arbitraty extensions, consider using a custom implementation (like checking the file's <a href="https://www.ibm.com/support/pages/what-magic-number">magic number</a>) if your app requires a safer solution.</blockquote><p>To understand how these can be used in conjunction with the beforementioned <code>FileParsePipe</code>, we'll use an altered snippet of the last presented example:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">UploadedFile</span></span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">ParseFilePipe</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    validators<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">MaxFileSizeValidator</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> maxSize<span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">FileTypeValidator</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> fileType<span class="token operator">:</span> <span class="token string">'jpeg'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
file<span class="token operator">:</span> <span class="token maybe-class-name">Express</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Multer</span></span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">File</span></span><span class="token punctuation">,</span></code></pre><blockquote><p>info <strong>Hint</strong> If the number of validators increase largely or their options are cluttering the file, you can define this array in a separate file and import it here as a named constant like <code>fileValidators</code>.</blockquote><p>Finally, you can use the special <code>ParseFilePipeBuilder</code> class that lets you compose &#x26; construct your validators. By using it as shown below you can avoid manual instantiation of each validator and just pass their options directly:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">UploadedFile</span></span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">ParseFilePipeBuilder</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">addFileTypeValidator</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      fileType<span class="token operator">:</span> <span class="token string">'jpeg'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">addMaxSizeValidator</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      maxSize<span class="token operator">:</span> <span class="token number">1000</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      errorHttpStatusCode<span class="token operator">:</span> <span class="token maybe-class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">UNPROCESSABLE_ENTITY</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
file<span class="token operator">:</span> <span class="token maybe-class-name">Express</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Multer</span></span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">File</span></span><span class="token punctuation">,</span></code></pre></section><section id="array-of-files"class="level4"><h4>Array of files</h4><p>To upload an array of files (identified with a single field name), use the <code>FilesInterceptor()</code> decorator (note the plural <strong>Files</strong> in the decorator name). This decorator takes three arguments:<ul><li><code>fieldName</code>: as described above<li><code>maxCount</code>: optional number defining the maximum number of files to accept<li><code>options</code>: optional <code>MulterOptions</code> object, as described above</ul><p>When using <code>FilesInterceptor()</code>, extract files from the <code>request</code> with the <code>@UploadedFiles()</code> decorator.<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseInterceptors</span></span><span class="token punctuation">(</span><span class="token function"><span class="token maybe-class-name">FilesInterceptor</span></span><span class="token punctuation">(</span><span class="token string">'files'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">UploadedFiles</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> files<span class="token operator">:</span> <span class="token known-class-name class-name">Array</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Express</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Multer</span></span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">File</span></span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
@@<span class="token keyword control-flow">switch</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseInterceptors</span></span><span class="token punctuation">(</span><span class="token function"><span class="token maybe-class-name">FilesInterceptor</span></span><span class="token punctuation">(</span><span class="token string">'files'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Bind</span></span><span class="token punctuation">(</span><span class="token function"><span class="token maybe-class-name">UploadedFiles</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">uploadFile</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> The <code>FilesInterceptor()</code> decorator is exported from the <code>@nestjs/platform-express</code> package. The <code>@UploadedFiles()</code> decorator is exported from <code>@nestjs/common</code>.</blockquote></section><section id="multiple-files"class="level4"><h4>Multiple files</h4><p>To upload multiple files (all with different field name keys), use the <code>FileFieldsInterceptor()</code> decorator. This decorator takes two arguments:<ul><li><code>uploadedFields</code>: an array of objects, where each object specifies a required <code>name</code> property with a string value specifying a field name, as described above, and an optional <code>maxCount</code> property, as described above<li><code>options</code>: optional <code>MulterOptions</code> object, as described above</ul><p>When using <code>FileFieldsInterceptor()</code>, extract files from the <code>request</code> with the <code>@UploadedFiles()</code> decorator.<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseInterceptors</span></span><span class="token punctuation">(</span><span class="token function"><span class="token maybe-class-name">FileFieldsInterceptor</span></span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'avatar'</span><span class="token punctuation">,</span> maxCount<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'background'</span><span class="token punctuation">,</span> maxCount<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">UploadedFiles</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> files<span class="token operator">:</span> <span class="token punctuation">{</span> avatar<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Express</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Multer</span></span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">File</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> background<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Express</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Multer</span></span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">File</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
@@<span class="token keyword control-flow">switch</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Bind</span></span><span class="token punctuation">(</span><span class="token function"><span class="token maybe-class-name">UploadedFiles</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseInterceptors</span></span><span class="token punctuation">(</span><span class="token function"><span class="token maybe-class-name">FileFieldsInterceptor</span></span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'avatar'</span><span class="token punctuation">,</span> maxCount<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'background'</span><span class="token punctuation">,</span> maxCount<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">uploadFile</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section><section id="any-files"class="level4"><h4>Any files</h4><p>To upload all fields with arbitrary field name keys, use the <code>AnyFilesInterceptor()</code> decorator. This decorator can accept an optional <code>options</code> object as described above.<p>When using <code>AnyFilesInterceptor()</code>, extract files from the <code>request</code> with the <code>@UploadedFiles()</code> decorator.<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseInterceptors</span></span><span class="token punctuation">(</span><span class="token function"><span class="token maybe-class-name">AnyFilesInterceptor</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">UploadedFiles</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> files<span class="token operator">:</span> <span class="token known-class-name class-name">Array</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Express</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Multer</span></span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">File</span></span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
@@<span class="token keyword control-flow">switch</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Bind</span></span><span class="token punctuation">(</span><span class="token function"><span class="token maybe-class-name">UploadedFiles</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseInterceptors</span></span><span class="token punctuation">(</span><span class="token function"><span class="token maybe-class-name">AnyFilesInterceptor</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">uploadFile</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section><section id="default-options"class="level4"><h4>Default options</h4><p>You can specify multer options in the file interceptors as described above. To set default options, you can call the static <code>register()</code> method when you import the <code>MulterModule</code>, passing in supported options. You can use all options listed <a href="https://github.com/expressjs/multer#multeropts">here</a>.<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">MulterModule</span><span class="token punctuation">.</span><span class="token method function property-access">register</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  dest<span class="token operator">:</span> <span class="token string">'./upload'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>info <strong>Hint</strong> The <code>MulterModule</code> class is exported from the <code>@nestjs/platform-express</code> package.</blockquote></section><section id="async-configuration"class="level4"><h4>Async configuration</h4><p>When you need to set <code>MulterModule</code> options asynchronously instead of statically, use the <code>registerAsync()</code> method. As with most dynamic modules, Nest provides several techniques to deal with async configuration.<p>One technique is to use a factory function:<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">MulterModule</span><span class="token punctuation">.</span><span class="token method function property-access">registerAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    dest<span class="token operator">:</span> <span class="token string">'./upload'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Like other <a href="https://docs.nestjs.com/fundamentals/custom-providers#factory-providers-usefactory">factory providers</a>, our factory function can be <code>async</code> and can inject dependencies through <code>inject</code>.<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">MulterModule</span><span class="token punctuation">.</span><span class="token method function property-access">registerAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>configService<span class="token operator">:</span> <span class="token maybe-class-name">ConfigService</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    dest<span class="token operator">:</span> configService<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'MULTER_DEST'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  inject<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">ConfigService</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Alternatively, you can configure the <code>MulterModule</code> using a class instead of a factory, as shown below:<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">MulterModule</span><span class="token punctuation">.</span><span class="token method function property-access">registerAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  useClass<span class="token operator">:</span> <span class="token maybe-class-name">MulterConfigService</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The construction above instantiates <code>MulterConfigService</code> inside <code>MulterModule</code>, using it to create the required options object. Note that in this example, the <code>MulterConfigService</code> has to implement the <code>MulterOptionsFactory</code> interface, as shown below. The <code>MulterModule</code> will call the <code>createMulterOptions()</code> method on the instantiated object of the supplied class.<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">MulterConfigService</span></span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token maybe-class-name">MulterOptionsFactory</span></span> <span class="token punctuation">{</span>
  <span class="token function">createMulterOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">MulterModuleOptions</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      dest<span class="token operator">:</span> <span class="token string">'./upload'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>If you want to reuse an existing options provider instead of creating a private copy inside the <code>MulterModule</code>, use the <code>useExisting</code> syntax.<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">MulterModule</span><span class="token punctuation">.</span><span class="token method function property-access">registerAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  useExisting<span class="token operator">:</span> <span class="token maybe-class-name">ConfigService</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="example"class="level4"><h4>Example</h4><p>A working example is available <a href="https://github.com/nestjs/nest/tree/master/sample/29-file-upload">here</a>. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>