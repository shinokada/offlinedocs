<!doctype html><html lang="en"><meta charset="utf-8"><title>Server-Sent Events</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="server-sent-events"class="level3"><h3>Server-Sent Events</h3><p>Server-Sent Events (SSE) is a server push technology enabling a client to receive automatic updates from a server via HTTP connection. Each notification is sent as a block of text terminated by a pair of newlines (learn more <a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events">here</a>).<section id="usage"class="level4"><h4>Usage</h4><p>To enable Server-Sent events on a route (route registered within a <strong>controller class</strong>), annotate the method handler with the <code>@Sse()</code> decorator.<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Sse</span></span><span class="token punctuation">(</span><span class="token string">'sse'</span><span class="token punctuation">)</span>
<span class="token function">sse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Observable</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">MessageEvent</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">pipe</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token punctuation">{</span> hello<span class="token operator">:</span> <span class="token string">'world'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> The <code>@Sse()</code> decorator and <code>MessageEvent</code> interface are imported from the <code>@nestjs/common</code>, while <code>Observable</code>, <code>interval</code>, and <code>map</code> are imported from the <code>rxjs</code> package.</blockquote><blockquote><p>warning <strong>Warning</strong> Server-Sent Events routes must return an <code>Observable</code> stream.</blockquote><p>In the example above, we defined a route named <code>sse</code> that will allow us to propagate real-time updates. These events can be listened to using the <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventSource">EventSource API</a>.<p>The <code>sse</code> method returns an <code>Observable</code> that emits multiple <code>MessageEvent</code> (in this example, it emits a new <code>MessageEvent</code> every second). The <code>MessageEvent</code> object should respect the following interface to match the specification:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">MessageEvent</span></span> <span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> object<span class="token punctuation">;</span>
  id<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  type<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  retry<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>With this in place, we can now create an instance of the <code>EventSource</code> class in our client-side application, passing the <code>/sse</code> route (which matches the endpoint we have passed into the <code>@Sse()</code> decorator above) as a constructor argument.<p><code>EventSource</code> instance opens a persistent connection to an HTTP server, which sends events in <code>text/event-stream</code> format. The connection remains open until closed by calling <code>EventSource.close()</code>.<p>Once the connection is opened, incoming messages from the server are delivered to your code in the form of events. If there is an event field in the incoming message, the triggered event is the same as the event field value. If no event field is present, then a generic <code>message</code> event is fired (<a href="https://developer.mozilla.org/en-US/docs/Web/API/EventSource">source</a>).<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> eventSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventSource</span><span class="token punctuation">(</span><span class="token string">'/sse'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
eventSource<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'New message'</span><span class="token punctuation">,</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></section><section id="example"class="level4"><h4>Example</h4><p>A working example is available <a href="https://github.com/nestjs/nest/tree/master/sample/28-sse">here</a>. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>