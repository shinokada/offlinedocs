<!doctype html><html lang="en"><meta charset="utf-8"><title>Task Scheduling</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="task-scheduling"class="level3"><h3>Task Scheduling</h3><p>Task scheduling allows you to schedule arbitrary code (methods/functions) to execute at a fixed date/time, at recurring intervals, or once after a specified interval. In the Linux world, this is often handled by packages like <a href="https://en.wikipedia.org/wiki/Cron">cron</a> at the OS level. For Node.js apps, there are several packages that emulate cron-like functionality. Nest provides the <code>@nestjs/schedule</code> package, which integrates with the popular Node.js <a href="https://github.com/kelektiv/node-cron">cron</a> package. We'll cover this package in the current chapter.<section id="installation"class="level4"><h4>Installation</h4><p>To begin using it, we first install the required dependencies.<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> --save @nestjs/schedule
$ <span class="token function">npm</span> <span class="token function">install</span> --save-dev @types/cron</code></pre><p>To activate job scheduling, import the <code>ScheduleModule</code> into the root <code>AppModule</code> and run the <code>forRoot()</code> static method as shown below:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token property-access">module</span><span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Module</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">ScheduleModule</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/schedule'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token maybe-class-name">ScheduleModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>The <code>.forRoot()</code> call initializes the scheduler and registers any declarative <a href="techniques/task-scheduling#declarative-cron-jobs">cron jobs</a>, <a href="techniques/task-scheduling#declarative-timeouts">timeouts</a> and <a href="techniques/task-scheduling#declarative-intervals">intervals</a> that exist within your app. Registration occurs when the <code>onApplicationBootstrap</code> lifecycle hook occurs, ensuring that all modules have loaded and declared any scheduled jobs.</section><section id="declarative-cron-jobs"class="level4"><h4>Declarative cron jobs</h4><p>A cron job schedules an arbitrary function (method call) to run automatically. Cron jobs can run:<ul><li>Once, at a specified date/time.<li>On a recurring basis; recurring jobs can run at a specified instant within a specified interval (for example, once per hour, once per week, once every 5 minutes)</ul><p>Declare a cron job with the <code>@Cron()</code> decorator preceding the method definition containing the code to be executed, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Injectable</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Logger</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Cron</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/schedule'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">TasksService</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Logger</span></span><span class="token punctuation">(</span><span class="token maybe-class-name">TasksService</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Cron</span></span><span class="token punctuation">(</span><span class="token string">'45 * * * * *'</span><span class="token punctuation">)</span>
  <span class="token function">handleCron</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">debug</span><span class="token punctuation">(</span><span class="token string">'Called when the current second is 45'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>In this example, the <code>handleCron()</code> method will be called each time the current second is <code>45</code>. In other words, the method will be run once per minute, at the 45 second mark.<p>The <code>@Cron()</code> decorator supports all standard <a href="http://crontab.org/">cron patterns</a>:<ul><li>Asterisk (e.g. <code>*</code>)<li>Ranges (e.g. <code>1-3,5</code>)<li>Steps (e.g. <code>*/2</code>)</ul><p>In the example above, we passed <code>45 * * * * *</code> to the decorator. The following key shows how each position in the cron pattern string is interpreted:<pre class="language-javascript"><code class="language-javascript">
* * * * * *
| | | | | |
| | | | | day of week
| | | | months
| | | day of month
| | hours
| minutes
seconds (optional)
</code></pre><p>Some sample cron patterns are:<table><tr><td><code>* * * * * *</code><td>every second<tr><td><code>45 * * * * *</code><td>every minute, on the 45th second<tr><td><code>0 10 * * * *</code><td>every hour, at the start of the 10th minute<tr><td><code>0 */30 9-17 * * *</code><td>every 30 minutes between 9am and 5pm<tr><td><code>0 30 11 * * 1-5</code><td>Monday to Friday at 11:30am</table><p>The <code>@nestjs/schedule</code> package provides a convenience enum with commonly used cron patterns. You can use this enum as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Injectable</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Logger</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Cron</span><span class="token punctuation">,</span> <span class="token maybe-class-name">CronExpression</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/schedule'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">TasksService</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Logger</span></span><span class="token punctuation">(</span><span class="token maybe-class-name">TasksService</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Cron</span></span><span class="token punctuation">(</span><span class="token maybe-class-name">CronExpression</span><span class="token punctuation">.</span><span class="token constant">EVERY_30_SECONDS</span><span class="token punctuation">)</span>
  <span class="token function">handleCron</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">debug</span><span class="token punctuation">(</span><span class="token string">'Called every 30 seconds'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>In this example, the <code>handleCron()</code> method will be called every <code>30</code> seconds.<p>Alternatively, you can supply a JavaScript <code>Date</code> object to the <code>@Cron()</code> decorator. Doing so causes the job to execute exactly once, at the specified date.<blockquote><p>info <strong>Hint</strong> Use JavaScript date arithmetic to schedule jobs relative to the current date. For example, <code>@Cron(new Date(Date.now() + 10 * 1000))</code> to schedule a job to run 10 seconds after the app starts.</blockquote><p>Also, you can supply additional options as the second parameter to the <code>@Cron()</code> decorator.<table><tr><td><code>name</code><td>Useful to access and control a cron job after it's been declared.<tr><td><code>timeZone</code><td>Specify the timezone for the execution. This will modify the actual time relative to your timezone. If the timezone is invalid, an error is thrown. You can check all timezones available at <a href="http://momentjs.com/timezone/">Moment Timezone</a> website.<tr><td><code>utcOffset</code><td>This allows you to specify the offset of your timezone rather than using the <code>timeZone</code> param.</table><pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Injectable</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Cron</span><span class="token punctuation">,</span> <span class="token maybe-class-name">CronExpression</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/schedule'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">NotificationService</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Cron</span></span><span class="token punctuation">(</span><span class="token string">'* * 0 * * *'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'notifications'</span><span class="token punctuation">,</span>
    timeZone<span class="token operator">:</span> <span class="token string">'Europe/Paris'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">triggerNotifications</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>You can access and control a cron job after it's been declared, or dynamically create a cron job (where its cron pattern is defined at runtime) with the <a href="/techniques/task-scheduling#dynamic-schedule-module-api">Dynamic API</a>. To access a declarative cron job via the API, you must associate the job with a name by passing the <code>name</code> property in an optional options object as the second argument of the decorator.</section><section id="declarative-intervals"class="level4"><h4>Declarative intervals</h4><p>To declare that a method should run at a (recurring) specified interval, prefix the method definition with the <code>@Interval()</code> decorator. Pass the interval value, as a number in milliseconds, to the decorator as shown below:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Interval</span></span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span>
<span class="token function">handleInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">debug</span><span class="token punctuation">(</span><span class="token string">'Called every 10 seconds'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> This mechanism uses the JavaScript <code>setInterval()</code> function under the hood. You can also utilize a cron job to schedule recurring jobs.</blockquote><p>If you want to control your declarative interval from outside the declaring class via the <a href="/techniques/task-scheduling#dynamic-schedule-module-api">Dynamic API</a>, associate the interval with a name using the following construction:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Interval</span></span><span class="token punctuation">(</span><span class="token string">'notifications'</span><span class="token punctuation">,</span> <span class="token number">2500</span><span class="token punctuation">)</span>
<span class="token function">handleInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>The <a href="techniques/task-scheduling#dynamic-intervals">Dynamic API</a> also enables <strong>creating</strong> dynamic intervals, where the interval's properties are defined at runtime, and <strong>listing and deleting</strong> them.<p><app-banner-enterprise></app-banner-enterprise></section><section id="declarative-timeouts"class="level4"><h4>Declarative timeouts</h4><p>To declare that a method should run (once) at a specified timeout, prefix the method definition with the <code>@Timeout()</code> decorator. Pass the relative time offset (in milliseconds), from application startup, to the decorator as shown below:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Timeout</span></span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>
<span class="token function">handleTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">debug</span><span class="token punctuation">(</span><span class="token string">'Called once after 5 seconds'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> This mechanism uses the JavaScript <code>setTimeout()</code> function under the hood.</blockquote><p>If you want to control your declarative timeout from outside the declaring class via the <a href="/techniques/task-scheduling#dynamic-schedule-module-api">Dynamic API</a>, associate the timeout with a name using the following construction:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Timeout</span></span><span class="token punctuation">(</span><span class="token string">'notifications'</span><span class="token punctuation">,</span> <span class="token number">2500</span><span class="token punctuation">)</span>
<span class="token function">handleTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>The <a href="techniques/task-scheduling#dynamic-timeouts">Dynamic API</a> also enables <strong>creating</strong> dynamic timeouts, where the timeout's properties are defined at runtime, and <strong>listing and deleting</strong> them.</section><section id="dynamic-schedule-module-api"class="level4"><h4>Dynamic schedule module API</h4><p>The <code>@nestjs/schedule</code> module provides a dynamic API that enables managing declarative <a href="techniques/task-scheduling#declarative-cron-jobs">cron jobs</a>, <a href="techniques/task-scheduling#declarative-timeouts">timeouts</a> and <a href="techniques/task-scheduling#declarative-intervals">intervals</a>. The API also enables creating and managing <strong>dynamic</strong> cron jobs, timeouts and intervals, where the properties are defined at runtime.</section><section id="dynamic-cron-jobs"class="level4"><h4>Dynamic cron jobs</h4><p>Obtain a reference to a <code>CronJob</code> instance by name from anywhere in your code using the <code>SchedulerRegistry</code> API. First, inject <code>SchedulerRegistry</code> using standard constructor injection:<pre class="language-typescript"><code class="language-typescript"><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> schedulerRegistry<span class="token operator">:</span> <span class="token maybe-class-name">SchedulerRegistry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> Import the <code>SchedulerRegistry</code> from the <code>@nestjs/schedule</code> package.</blockquote><p>Then use it in a class as follows. Assume a cron job was created with the following declaration:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Cron</span></span><span class="token punctuation">(</span><span class="token string">'* * 8 * * *'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'notifications'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">triggerNotifications</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>Access this job using the following:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> job <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">schedulerRegistry</span><span class="token punctuation">.</span><span class="token method function property-access">getCronJob</span><span class="token punctuation">(</span><span class="token string">'notifications'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

job<span class="token punctuation">.</span><span class="token method function property-access">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>job<span class="token punctuation">.</span><span class="token method function property-access">lastDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>getCronJob()</code> method returns the named cron job. The returned <code>CronJob</code> object has the following methods:<ul><li><code>stop()</code> - stops a job that is scheduled to run.<li><code>start()</code> - restarts a job that has been stopped.<li><code>setTime(time: CronTime)</code> - stops a job, sets a new time for it, and then starts it<li><code>lastDate()</code> - returns a string representation of the last date a job executed<li><code>nextDates(count: number)</code> - returns an array (size <code>count</code>) of <code>moment</code> objects representing upcoming job execution dates.</ul><blockquote><p>info <strong>Hint</strong> Use <code>toDate()</code> on <code>moment</code> objects to render them in human readable form.</blockquote><p><strong>Create</strong> a new cron job dynamically using the <code>SchedulerRegistry.addCronJob()</code> method, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token function">addCronJob</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> seconds<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> job <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">CronJob</span></span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>seconds<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> * * * * *</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">time (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>seconds<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) for job </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> to run!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">schedulerRegistry</span><span class="token punctuation">.</span><span class="token method function property-access">addCronJob</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> job<span class="token punctuation">)</span><span class="token punctuation">;</span>
  job<span class="token punctuation">.</span><span class="token method function property-access">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">warn</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">job </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> added for each minute at </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>seconds<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> seconds!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>In this code, we use the <code>CronJob</code> object from the <code>cron</code> package to create the cron job. The <code>CronJob</code> constructor takes a cron pattern (just like the <code>@Cron()</code> <a href="techniques/task-scheduling#declarative-cron-jobs">decorator</a>) as its first argument, and a callback to be executed when the cron timer fires as its second argument. The <code>SchedulerRegistry.addCronJob()</code> method takes two arguments: a name for the <code>CronJob</code>, and the <code>CronJob</code> object itself.<blockquote><p>warning <strong>Warning</strong> Remember to inject the <code>SchedulerRegistry</code> before accessing it. Import <code>CronJob</code> from the <code>cron</code> package.</blockquote><p><strong>Delete</strong> a named cron job using the <code>SchedulerRegistry.deleteCronJob()</code> method, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token function">deleteCron</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">schedulerRegistry</span><span class="token punctuation">.</span><span class="token method function property-access">deleteCronJob</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">job </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> deleted!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><strong>List</strong> all cron jobs using the <code>SchedulerRegistry.getCronJobs()</code> method as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token function">getCrons</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> jobs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">schedulerRegistry</span><span class="token punctuation">.</span><span class="token method function property-access">getCronJobs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  jobs<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> key<span class="token punctuation">,</span> map<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> next<span class="token punctuation">;</span>
    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
      next <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token method function property-access">nextDates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      next <span class="token operator">=</span> <span class="token string">'error: next fire date is in the past!'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">job: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -> next: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>next<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>The <code>getCronJobs()</code> method returns a <code>map</code>. In this code, we iterate over the map and attempt to access the <code>nextDates()</code> method of each <code>CronJob</code>. In the <code>CronJob</code> API, if a job has already fired and has no future firing dates, it throws an exception.</section><section id="dynamic-intervals"class="level4"><h4>Dynamic intervals</h4><p>Obtain a reference to an interval with the <code>SchedulerRegistry.getInterval()</code> method. As above, inject <code>SchedulerRegistry</code> using standard constructor injection:<pre class="language-typescript"><code class="language-typescript"><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> schedulerRegistry<span class="token operator">:</span> <span class="token maybe-class-name">SchedulerRegistry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>And use it as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">schedulerRegistry</span><span class="token punctuation">.</span><span class="token method function property-access">getInterval</span><span class="token punctuation">(</span><span class="token string">'notifications'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">clearInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>Create</strong> a new interval dynamically using the <code>SchedulerRegistry.addInterval()</code> method, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token function">addInterval</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> milliseconds<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Interval </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> executing at time (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>milliseconds<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> milliseconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">schedulerRegistry</span><span class="token punctuation">.</span><span class="token method function property-access">addInterval</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> interval<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>In this code, we create a standard JavaScript interval, then pass it to the <code>ScheduleRegistry.addInterval()</code> method. That method takes two arguments: a name for the interval, and the interval itself.<p><strong>Delete</strong> a named interval using the <code>SchedulerRegistry.deleteInterval()</code> method, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token function">deleteInterval</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">schedulerRegistry</span><span class="token punctuation">.</span><span class="token method function property-access">deleteInterval</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Interval </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> deleted!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><strong>List</strong> all intervals using the <code>SchedulerRegistry.getIntervals()</code> method as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token function">getIntervals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> intervals <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">schedulerRegistry</span><span class="token punctuation">.</span><span class="token method function property-access">getIntervals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  intervals<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span>key <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Interval: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section><section id="dynamic-timeouts"class="level4"><h4>Dynamic timeouts</h4><p>Obtain a reference to a timeout with the <code>SchedulerRegistry.getTimeout()</code> method. As above, inject <code>SchedulerRegistry</code> using standard constructor injection:<pre class="language-typescript"><code class="language-typescript"><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> schedulerRegistry<span class="token operator">:</span> <span class="token maybe-class-name">SchedulerRegistry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>And use it as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> timeout <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">schedulerRegistry</span><span class="token punctuation">.</span><span class="token method function property-access">getTimeout</span><span class="token punctuation">(</span><span class="token string">'notifications'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>Create</strong> a new timeout dynamically using the <code>SchedulerRegistry.addTimeout()</code> method, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token function">addTimeout</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> milliseconds<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Timeout </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> executing after (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>milliseconds<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> milliseconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">schedulerRegistry</span><span class="token punctuation">.</span><span class="token method function property-access">addTimeout</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>In this code, we create a standard JavaScript timeout, then pass it to the <code>ScheduleRegistry.addTimeout()</code> method. That method takes two arguments: a name for the timeout, and the timeout itself.<p><strong>Delete</strong> a named timeout using the <code>SchedulerRegistry.deleteTimeout()</code> method, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token function">deleteTimeout</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">schedulerRegistry</span><span class="token punctuation">.</span><span class="token method function property-access">deleteTimeout</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Timeout </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> deleted!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><strong>List</strong> all timeouts using the <code>SchedulerRegistry.getTimeouts()</code> method as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token function">getTimeouts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> timeouts <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">schedulerRegistry</span><span class="token punctuation">.</span><span class="token method function property-access">getTimeouts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  timeouts<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span>key <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Timeout: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section><section id="example"class="level4"><h4>Example</h4><p>A working example is available <a href="https://github.com/nestjs/nest/tree/master/sample/27-scheduling">here</a>. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>