<!doctype html><html lang="en"><meta charset="utf-8"><title>Versioning</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="versioning"class="level3"><h3>Versioning</h3><blockquote><p>info <strong>Hint</strong> This chapter is only relevant to HTTP-based applications.</blockquote><p>Versioning allows you to have <strong>different versions</strong> of your controllers or individual routes running within the same application. Applications change very often and it is not unusual that there are breaking changes that you need to make while still needing to support the previous version of the application.<p>There are 4 types of versioning that are supported:<table><tr><td><a href="techniques/versioning#uri-versioning-type"><code>URI Versioning</code></a><td>The version will be passed within the URI of the request (default)<tr><td><a href="techniques/versioning#header-versioning-type"><code>Header Versioning</code></a><td>A custom request header will specify the version<tr><td><a href="techniques/versioning#media-type-versioning-type"><code>Media Type Versioning</code></a><td>The <code>Accept</code> header of the request will specify the version<tr><td><a href="techniques/versioning#custom-versioning-type"><code>Custom Versioning</code></a><td>Any aspect of the request may be used to specify the version(s). A custom function is provided to extract said version(s).</table><section id="uri-versioning-type"class="level4"><h4>URI Versioning Type</h4><p>URI Versioning uses the version passed within the URI of the request, such as <code>https://example.com/v1/route</code> and <code>https://example.com/v2/route</code>.<blockquote><p>warning <strong>Notice</strong> With URI Versioning the version will be automatically added to the URI after the <a href="faq/global-prefix">global path prefix</a> (if one exists), and before any controller or route paths.</blockquote><p>To enable URI Versioning for your application, do the following:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>main<span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">NestFactory</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// or "app.enableVersioning()"</span>
app<span class="token punctuation">.</span><span class="token method function property-access">enableVersioning</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token maybe-class-name">VersioningType</span><span class="token punctuation">.</span><span class="token constant">URI</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>warning <strong>Notice</strong> The version in the URI will be automatically prefixed with <code>v</code> by default, however the prefix value can be configured by setting the <code>prefix</code> key to your desired prefix or <code>false</code> if you wish to disable it.</blockquote><blockquote><p>info <strong>Hint</strong> The <code>VersioningType</code> enum is available to use for the <code>type</code> property and is imported from the <code>@nestjs/common</code> package.</blockquote></section><section id="header-versioning-type"class="level4"><h4>Header Versioning Type</h4><p>Header Versioning uses a custom, user specified, request header to specify the version where the value of the header will be the version to use for the request.<p>Example HTTP Requests for Header Versioning:<p>To enable <strong>Header Versioning</strong> for your application, do the following:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>main<span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">NestFactory</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">enableVersioning</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token maybe-class-name">VersioningType</span><span class="token punctuation">.</span><span class="token constant">HEADER</span><span class="token punctuation">,</span>
  header<span class="token operator">:</span> <span class="token string">'Custom-Header'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>header</code> property should be the name of the header that will contain the version of the request.<blockquote><p>info <strong>Hint</strong> The <code>VersioningType</code> enum is available to use for the <code>type</code> property and is imported from the <code>@nestjs/common</code> package.</blockquote></section><section id="media-type-versioning-type"class="level4"><h4>Media Type Versioning Type</h4><p>Media Type Versioning uses the <code>Accept</code> header of the request to specify the version.<p>Within the <code>Accept</code> header, the version will be separated from the media type with a semi-colon, <code>;</code>. It should then contain a key-value pair that represents the version to use for the request, such as <code>Accept: application/json;v=2</code>. They key is treated more as a prefix when determining the version will to be configured to include the key and separator.<p>To enable <strong>Media Type Versioning</strong> for your application, do the following:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>main<span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">NestFactory</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">enableVersioning</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token maybe-class-name">VersioningType</span><span class="token punctuation">.</span><span class="token constant">MEDIA_TYPE</span><span class="token punctuation">,</span>
  key<span class="token operator">:</span> <span class="token string">'v='</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>key</code> property should be the key and separator of the key-value pair that contains the version. For the example <code>Accept: application/json;v=2</code>, the <code>key</code> property would be set to <code>v=</code>.<blockquote><p>info <strong>Hint</strong> The <code>VersioningType</code> enum is available to use for the <code>type</code> property and is imported from the <code>@nestjs/common</code> package.</blockquote></section><section id="custom-versioning-type"class="level4"><h4>Custom Versioning Type</h4><p>Custom Versioning uses any aspect of the request to specify the version (or versions). The incoming request is analyzed using an <code>extractor</code> function that returns a string or array of strings.<p>If multiple versions are provided by the requester, the extractor function can return an array of strings, sorted in order of greatest/highest version to smallest/lowest version. Versions are matched to routes in order from highest to lowest.<p>If an empty string or array is returned from the <code>extractor</code>, no routes are matched and a 404 is returned.<p>For example, if an incoming request specifies it supports versions <code>1</code>, <code>2</code>, and <code>3</code>, the <code>extractor</code> <strong>MUST</strong> return <code>[3, 2, 1]</code>. This ensures that the highest possible route version is selected first.<p>If versions <code>[3, 2, 1]</code> are extracted, but routes only exist for version <code>2</code> and <code>1</code>, the route that matches version <code>2</code> is selected (version <code>3</code> is automatically ignored).<blockquote><p>warning <strong>Notice</strong> Selecting the highest matching version based on the array returned from <code>extractor</code> > <strong>does not reliably work</strong> with the Express adapter due to design limitations. A single version (either a string or array of 1 element) works just fine in Express. Fastify correctly supports both highest matching version selection and single version selection.</blockquote><p>To enable <strong>Custom Versioning</strong> for your application, create an <code>extractor</code> function and pass it into your application like so:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>main<span class="token punctuation">)</span>
<span class="token comment">// Example extractor that pulls out a list of versions from a custom header and turns it into a sorted array.</span>
<span class="token comment">// This example uses Fastify, but Express requests can be processed in a similar way.</span>
<span class="token keyword">const</span> extractor <span class="token operator">=</span> <span class="token punctuation">(</span>request<span class="token operator">:</span> <span class="token maybe-class-name">FastifyRequest</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token arrow operator">=></span>
  <span class="token punctuation">[</span>request<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">[</span><span class="token string">'custom-versioning-field'</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string">''</span><span class="token punctuation">]</span>
     <span class="token punctuation">.</span><span class="token method function property-access">flatMap</span><span class="token punctuation">(</span>v <span class="token arrow operator">=></span> v<span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span>v <span class="token arrow operator">=></span> <span class="token operator">!</span><span class="token operator">!</span>v<span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token method function property-access">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">NestFactory</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">enableVersioning</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token maybe-class-name">VersioningType</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">,</span>
  extractor<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="usage"class="level4"><h4>Usage</h4><p>Versioning allows you to version controllers, individual routes, and also provides a way for certain resources to opt-out of versioning. The usage of versioning is the same regardless of the Versioning Type your application uses.<blockquote><p>warning <strong>Notice</strong> If versioning is enabled for the application but the controller or route does not specify the version, any requests to that controller/route will be returned a <code>404</code> response status. Similarly, if a request is received containing a version that does not have a corresponding controller or route, it will also be returned a <code>404</code> response status.</blockquote></section><section id="controller-versions"class="level4"><h4>Controller versions</h4><p>A version can be applied to a controller, setting the version for all routes within the controller.<p>To add a version to a controller do the following:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>cats<span class="token punctuation">.</span><span class="token property-access">controller</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  version<span class="token operator">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsControllerV1</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span>
  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">'This action returns all cats for version 1'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
@@<span class="token keyword control-flow">switch</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  version<span class="token operator">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsControllerV1</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span>
  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">'This action returns all cats for version 1'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></section><section id="route-versions"class="level4"><h4>Route versions</h4><p>A version can be applied to an individual route. This version will override any other version that would effect the route, such as the Controller Version.<p>To add a version to an individual route do the following:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>cats<span class="token punctuation">.</span><span class="token property-access">controller</span><span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Controller</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Get</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Version</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsController</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Version</span></span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span>
  <span class="token function">findAllV1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">'This action returns all cats for version 1'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Version</span></span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span>
  <span class="token function">findAllV2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">'This action returns all cats for version 2'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
@@<span class="token keyword control-flow">switch</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Controller</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Get</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Version</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsController</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Version</span></span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span>
  <span class="token function">findAllV1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">'This action returns all cats for version 1'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Version</span></span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span>
  <span class="token function">findAllV2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">'This action returns all cats for version 2'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></section><section id="multiple-versions"class="level4"><h4>Multiple versions</h4><p>Multiple versions can be applied to a controller or route. To use multiple versions, you would set the version to be an Array.<p>To add multiple versions do the following:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>cats<span class="token punctuation">.</span><span class="token property-access">controller</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  version<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsController</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span>
  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">'This action returns all cats for version 1 or 2'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
@@<span class="token keyword control-flow">switch</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  version<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsController</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span>
  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">'This action returns all cats for version 1 or 2'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></section><section id="version-neutral"class="level4"><h4>Version "Neutral"</h4><p>Some controllers or routes may not care about the version and would have the same functionality regardless of the version. To accommodate this, the version can be set to <code>VERSION_NEUTRAL</code> symbol.<p>An incoming request will be mapped to a <code>VERSION_NEUTRAL</code> controller or route regardless of the version sent in the request in addition to if the request does not contain a version at all.<blockquote><p>warning <strong>Notice</strong> For URI Versioning, a <code>VERSION_NEUTRAL</code> resource would not have the version present in the URI.</blockquote><p>To add a version neutral controller or route do the following:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>cats<span class="token punctuation">.</span><span class="token property-access">controller</span><span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Controller</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Get</span><span class="token punctuation">,</span> <span class="token constant">VERSION_NEUTRAL</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  version<span class="token operator">:</span> <span class="token constant">VERSION_NEUTRAL</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsController</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span>
  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">'This action returns all cats regardless of version'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
@@<span class="token keyword control-flow">switch</span>
<span class="token keyword module">import</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Controller</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Get</span><span class="token punctuation">,</span> <span class="token constant">VERSION_NEUTRAL</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  version<span class="token operator">:</span> <span class="token constant">VERSION_NEUTRAL</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsController</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span>
  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">'This action returns all cats regardless of version'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></section><section id="global-default-version"class="level4"><h4>Global default version</h4><p>If you do not want to provide a version for each controller/or individual routes, or if you want to have a specific version set as the default version for every controller/route that don't have the version specified, you could set the <code>defaultVersion</code> as follows:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>main<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token method function property-access">enableVersioning</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  defaultVersion<span class="token operator">:</span> <span class="token string">'1'</span>
  <span class="token comment">// or</span>
  defaultVersion<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">]</span>
  <span class="token comment">// or</span>
  defaultVersion<span class="token operator">:</span> <span class="token constant">VERSION_NEUTRAL</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="middleware-versioning"class="level4"><h4>Middleware versioning</h4><p><a href="https://docs.nestjs.com/middleware">Middlewares</a> can also use versioning metadata to configure the middleware for a specific route's version. To do so, provide the version number as one of the parameters for the <code>MiddlewareConsumer.forRoutes()</code> method:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token property-access">module</span><span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Module</span><span class="token punctuation">,</span> <span class="token maybe-class-name">NestModule</span><span class="token punctuation">,</span> <span class="token maybe-class-name">MiddlewareConsumer</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">LoggerMiddleware</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./common/middleware/logger.middleware'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">CatsModule</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./cats/cats.module'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">CatsController</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./cats/cats.controller'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">CatsModule</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppModule</span></span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token maybe-class-name">NestModule</span></span> <span class="token punctuation">{</span>
  <span class="token function">configure</span><span class="token punctuation">(</span>consumer<span class="token operator">:</span> <span class="token maybe-class-name">MiddlewareConsumer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    consumer
      <span class="token punctuation">.</span><span class="token method function property-access">apply</span><span class="token punctuation">(</span><span class="token maybe-class-name">LoggerMiddleware</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">forRoutes</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'cats'</span><span class="token punctuation">,</span> method<span class="token operator">:</span> <span class="token maybe-class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> version<span class="token operator">:</span> <span class="token string">'2'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>With the code above, the <code>LoggerMiddleware</code> will only be applied to the version '2' of <code>/cats</code> endpoint.<blockquote><p>info <strong>Notice</strong> Middlewares work with any versioning type described in the this section: <code>URI</code>, <code>Header</code>, <code>Media Type</code> or <code>Custom</code>.<span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></blockquote></section></section>