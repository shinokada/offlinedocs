<!doctype html><html lang="en"><meta charset="utf-8"><title>Compression</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="compression"class="level3"><h3>Compression</h3><p>Compression can greatly decrease the size of the response body, thereby increasing the speed of a web app.<p>For <strong>high-traffic</strong> websites in production, it is strongly recommended to offload compression from the application server - typically in a reverse proxy (e.g., Nginx). In that case, you should not use compression middleware.<section id="use-with-express-default"class="level4"><h4>Use with Express (default)</h4><p>Use the <a href="https://github.com/expressjs/compression">compression</a> middleware package to enable gzip compression.<p>First install the required package:<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i --save compression</code></pre><p>Once the installation is complete, apply the compression middleware as global middleware.<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> compression</span> <span class="token keyword module">from</span> <span class="token string">'compression'</span><span class="token punctuation">;</span>
<span class="token comment">// somewhere in your initialization file</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">compression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="use-with-fastify"class="level4"><h4>Use with Fastify</h4><p>If using the <code>FastifyAdapter</code>, you'll want to use <a href="https://github.com/fastify/fastify-compress">fastify-compress</a>:<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i --save @fastify/compress</code></pre><p>Once the installation is complete, apply the <code>@fastify/compress</code> middleware as global middleware.<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports">compression</span> <span class="token keyword module">from</span> <span class="token string">'@fastify/compress'</span><span class="token punctuation">;</span>
<span class="token comment">// somewhere in your initialization file</span>
<span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">register</span><span class="token punctuation">(</span>compression<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>By default, <code>@fastify/compress</code> will use Brotli compression (on Node >= 11.7.0) when browsers indicate support for the encoding. While Brotli is quite efficient in terms of compression ratio, it's also quite slow. Due to this, you may want to tell fastify-compress to only use deflate and gzip to compress responses; you'll end up with larger responses but they'll be delivered much more quickly.<p>To specify encodings, provide a second argument to <code>app.register</code>:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">register</span><span class="token punctuation">(</span>compression<span class="token punctuation">,</span> <span class="token punctuation">{</span> encodings<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'gzip'</span><span class="token punctuation">,</span> <span class="token string">'deflate'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The above tells <code>fastify-compress</code> to only use gzip and deflate encodings, preferring gzip if the client supports both. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>