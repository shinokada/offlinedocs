<!doctype html><html lang="en"><meta charset="utf-8"><title>Performance (Fastify)</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="performance-fastify"class="level3"><h3>Performance (Fastify)</h3><p>By default, Nest makes use of the <a href="https://expressjs.com/">Express</a> framework. As mentioned earlier, Nest also provides compatibility with other libraries such as, for example, <a href="https://github.com/fastify/fastify">Fastify</a>. Nest achieves this framework independence by implementing a framework adapter whose primary function is to proxy middleware and handlers to appropriate library-specific implementations.<blockquote><p>info <strong>Hint</strong> Note that in order for a framework adapter to be implemented, the target library has to provide similar request/response pipeline processing as found in Express.</blockquote><p><a href="https://github.com/fastify/fastify">Fastify</a> provides a good alternative framework for Nest because it solves design issues in a similar manner to Express. However, fastify is much <strong>faster</strong> than Express, achieving almost two times better benchmarks results. A fair question is why does Nest use Express as the default HTTP provider? The reason is that Express is widely-used, well-known, and has an enormous set of compatible middleware, which is available to Nest users out-of-the-box.<p>But since Nest provides framework-independence, you can easily migrate between them. Fastify can be a better choice when you place high value on very fast performance. To utilize Fastify, simply choose the built-in <code>FastifyAdapter</code> as shown in this chapter.<section id="installation"class="level4"><h4>Installation</h4><p>First, we need to install the required package:<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i --save @nestjs/platform-fastify</code></pre></section><section id="adapter"class="level4"><h4>Adapter</h4><p>Once the Fastify platform is installed, we can use the <code>FastifyAdapter</code>.<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>main<span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">NestFactory</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/core'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>
  <span class="token maybe-class-name">FastifyAdapter</span><span class="token punctuation">,</span>
  <span class="token maybe-class-name">NestFastifyApplication</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/platform-fastify'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">AppModule</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./app.module'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">NestFactory</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">create</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">NestFastifyApplication</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
    <span class="token maybe-class-name">AppModule</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">FastifyAdapter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>By default, Fastify listens only on the <code>localhost 127.0.0.1</code> interface (<a href="https://www.fastify.io/docs/latest/Guides/Getting-Started/#your-first-server">read more</a>). If you want to accept connections on other hosts, you should specify <code>'0.0.0.0'</code> in the <code>listen()</code> call:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">NestFactory</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">create</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">NestFastifyApplication</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
    <span class="token maybe-class-name">AppModule</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">FastifyAdapter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token string">'0.0.0.0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section><section id="platform-specific-packages"class="level4"><h4>Platform specific packages</h4><p>Keep in mind that when you use the <code>FastifyAdapter</code>, Nest uses Fastify as the <strong>HTTP provider</strong>. This means that each recipe that relies on Express may no longer work. You should, instead, use Fastify equivalent packages.</section><section id="redirect-response"class="level4"><h4>Redirect response</h4><p>Fastify handles redirect responses slightly differently than Express. To do a proper redirect with Fastify, return both the status code and the URL, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">index</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Res</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section><section id="fastify-options"class="level4"><h4>Fastify options</h4><p>You can pass options into the Fastify constructor through the <code>FastifyAdapter</code> constructor. For example:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">FastifyAdapter</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> logger<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="example"class="level4"><h4>Example</h4><p>A working example is available <a href="https://github.com/nestjs/nest/tree/master/sample/10-fastify">here</a>. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>