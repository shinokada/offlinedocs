<!doctype html><html lang="en"><meta charset="utf-8"><title>Cookies</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="cookies"class="level3"><h3>Cookies</h3><p>An <strong>HTTP cookie</strong> is a small piece of data stored by the user's browser. Cookies were designed to be a reliable mechanism for websites to remember stateful information. When the user visits the website again, the cookie is automatically sent with the request.<section id="use-with-express-default"class="level4"><h4>Use with Express (default)</h4><p>First install the <a href="https://github.com/expressjs/cookie-parser">required package</a> (and its types for TypeScript users):<pre class="language-shell"><code class="language-shell">$ <span class="token function">npm</span> i cookie-parser
$ <span class="token function">npm</span> i -D @types/cookie-parser</code></pre><p>Once the installation is complete, apply the <code>cookie-parser</code> middleware as global middleware (for example, in your <code>main.ts</code> file).<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> cookieParser</span> <span class="token keyword module">from</span> <span class="token string">'cookie-parser'</span><span class="token punctuation">;</span>
<span class="token comment">// somewhere in your initialization file</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>You can pass several options to the <code>cookieParser</code> middleware:<ul><li><code>secret</code> a string or array used for signing cookies. This is optional and if not specified, will not parse signed cookies. If a string is provided, this is used as the secret. If an array is provided, an attempt will be made to unsign the cookie with each secret in order.<li><code>options</code> an object that is passed to <code>cookie.parse</code> as the second option. See <a href="https://www.npmjs.org/package/cookie">cookie</a> for more information.</ul><p>The middleware will parse the <code>Cookie</code> header on the request and expose the cookie data as the property <code>req.cookies</code> and, if a secret was provided, as the property <code>req.signedCookies</code>. These properties are name value pairs of the cookie name to cookie value.<p>When secret is provided, this module will unsign and validate any signed cookie values and move those name value pairs from req.cookies into <code>req.signedCookies</code>. A signed cookie is a cookie that has a value prefixed with <code>s:</code>. Signed cookies that fail signature validation will have the value <code>false</code> instead of the tampered value.<p>With this in place, you can now read cookies from within the route handlers, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">findAll</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Req</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> request<span class="token operator">:</span> <span class="token maybe-class-name">Request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token property-access">cookies</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// or "request.cookies['cookieKey']"</span>
  <span class="token comment">// or console.log(request.signedCookies);</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> The <code>@Req()</code> decorator is imported from the <code>@nestjs/common</code>, while <code>Request</code> from the <code>express</code> package.</blockquote><p>To attach a cookie to an outgoing response, use the <code>Response#cookie()</code> method:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">findAll</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Res</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> passthrough<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> response<span class="token operator">:</span> <span class="token maybe-class-name">Response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  response<span class="token punctuation">.</span><span class="token method function property-access">cookie</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>warning <strong>Warning</strong> If you want to leave the response handling logic to the framework, remember to set the <code>passthrough</code> option to <code>true</code>, as shown above. Read more <a href="/controllers#appendix-library-specific-approach">here</a>.</blockquote><blockquote><p>info <strong>Hint</strong> The <code>@Res()</code> decorator is imported from the <code>@nestjs/common</code>, while <code>Response</code> from the <code>express</code> package.</blockquote></section><section id="use-with-fastify"class="level4"><h4>Use with Fastify</h4><p>First install the required package:<pre class="language-shell"><code class="language-shell">$ <span class="token function">npm</span> i @fastify/cookie</code></pre><p>Once the installation is complete, register the <code>@fastify/cookie</code> plugin:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports">fastifyCookie</span> <span class="token keyword module">from</span> <span class="token string">'@fastify/cookie'</span><span class="token punctuation">;</span>

<span class="token comment">// somewhere in your initialization file</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">NestFactory</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">create</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">NestFastifyApplication</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
  <span class="token maybe-class-name">AppModule</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">FastifyAdapter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">register</span><span class="token punctuation">(</span>fastifyCookie<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  secret<span class="token operator">:</span> <span class="token string">'my-secret'</span><span class="token punctuation">,</span> <span class="token comment">// for cookies signature</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>With this in place, you can now read cookies from within the route handlers, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">findAll</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Req</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> request<span class="token operator">:</span> <span class="token maybe-class-name">FastifyRequest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token property-access">cookies</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// or "request.cookies['cookieKey']"</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> The <code>@Req()</code> decorator is imported from the <code>@nestjs/common</code>, while <code>FastifyRequest</code> from the <code>fastify</code> package.</blockquote><p>To attach a cookie to an outgoing response, use the <code>FastifyReply#setCookie()</code> method:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">findAll</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Res</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> passthrough<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> response<span class="token operator">:</span> <span class="token maybe-class-name">FastifyReply</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  response<span class="token punctuation">.</span><span class="token method function property-access">setCookie</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><p>To read more about <code>FastifyReply#setCookie()</code> method, check out this <a href="https://github.com/fastify/fastify-cookie#sending">page</a>.<blockquote><p>warning <strong>Warning</strong> If you want to leave the response handling logic to the framework, remember to set the <code>passthrough</code> option to <code>true</code>, as shown above. Read more <a href="/controllers#appendix-library-specific-approach">here</a>.</blockquote><blockquote><p>info <strong>Hint</strong> The <code>@Res()</code> decorator is imported from the <code>@nestjs/common</code>, while <code>FastifyReply</code> from the <code>fastify</code> package.</blockquote></section><section id="creating-a-custom-decorator-cross-platform"class="level4"><h4>Creating a custom decorator (cross-platform)</h4><p>To provide a convenient, declarative way of accessing incoming cookies, we can create a <a href="/custom-decorators">custom decorator</a>.<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createParamDecorator<span class="token punctuation">,</span> <span class="token maybe-class-name">ExecutionContext</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token maybe-class-name">Cookies</span> <span class="token operator">=</span> <span class="token function">createParamDecorator</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> ctx<span class="token operator">:</span> <span class="token maybe-class-name">ExecutionContext</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> request <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token method function property-access">switchToHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> data <span class="token operator">?</span> request<span class="token punctuation">.</span><span class="token property-access">cookies</span><span class="token operator">?.</span><span class="token punctuation">[</span>data<span class="token punctuation">]</span> <span class="token operator">:</span> request<span class="token punctuation">.</span><span class="token property-access">cookies</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>@Cookies()</code> decorator will extract all cookies, or a named cookie from the <code>req.cookies</code> object and populate the decorated parameter with that value.<p>With this in place, we can now use the decorator in a route handler signature, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">findAll</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Cookies</span></span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>