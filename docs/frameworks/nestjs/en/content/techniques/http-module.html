<!doctype html><html lang="en"><meta charset="utf-8"><title>HTTP module</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="http-module"class="level3"><h3>HTTP module</h3><p><a href="https://github.com/axios/axios">Axios</a> is richly featured HTTP client package that is widely used. Nest wraps Axios and exposes it via the built-in <code>HttpModule</code>. The <code>HttpModule</code> exports the <code>HttpService</code> class, which exposes Axios-based methods to perform HTTP requests. The library also transforms the resulting HTTP responses into <code>Observables</code>.<blockquote><p>info <strong>Hint</strong> You can also use any general purpose Node.js HTTP client library directly, including <a href="https://github.com/sindresorhus/got">got</a> or <a href="https://github.com/nodejs/undici">undici</a>.</blockquote><section id="installation"class="level4"><h4>Installation</h4><p>To begin using it, we first install the required dependency.<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i --save @nestjs/axios</code></pre></section><section id="getting-started"class="level4"><h4>Getting started</h4><p>Once the installation process is complete, to use the <code>HttpService</code>, first import <code>HttpModule</code>.<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">HttpModule</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">CatsService</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>Next, inject <code>HttpService</code> using normal constructor injection.<blockquote><p>info <strong>Hint</strong> <code>HttpModule</code> and <code>HttpService</code> are imported from <code>@nestjs/axios</code> package.</blockquote><pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsService</span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> httpService<span class="token operator">:</span> <span class="token maybe-class-name">HttpService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Observable</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">AxiosResponse</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Cat</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">>></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">httpService</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000/cats'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
@@<span class="token keyword control-flow">switch</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Dependencies</span></span><span class="token punctuation">(</span><span class="token maybe-class-name">HttpService</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsService</span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>httpService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">httpService</span> <span class="token operator">=</span> httpService<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">httpService</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000/cats'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> <code>AxiosResponse</code> is an interface exported from the <code>axios</code> package (<code>$ npm i axios</code>).</blockquote><p>All <code>HttpService</code> methods return an <code>AxiosResponse</code> wrapped in an <code>Observable</code> object.</section><section id="configuration"class="level4"><h4>Configuration</h4><p><a href="https://github.com/axios/axios">Axios</a> can be configured with a variety of options to customize the behavior of the <code>HttpService</code>. Read more about them <a href="https://github.com/axios/axios#request-config">here</a>. To configure the underlying Axios instance, pass an optional options object to the <code>register()</code> method of <code>HttpModule</code> when importing it. This options object will be passed directly to the underlying Axios constructor.<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token maybe-class-name">HttpModule</span><span class="token punctuation">.</span><span class="token method function property-access">register</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      timeout<span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
      maxRedirects<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">CatsService</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></section><section id="async-configuration"class="level4"><h4>Async configuration</h4><p>When you need to pass module options asynchronously instead of statically, use the <code>registerAsync()</code> method. As with most dynamic modules, Nest provides several techniques to deal with async configuration.<p>One technique is to use a factory function:<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">HttpModule</span><span class="token punctuation">.</span><span class="token method function property-access">registerAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    timeout<span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
    maxRedirects<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Like other factory providers, our factory function can be <a href="https://docs.nestjs.com/fundamentals/custom-providers#factory-providers-usefactory">async</a> and can inject dependencies through <code>inject</code>.<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">HttpModule</span><span class="token punctuation">.</span><span class="token method function property-access">registerAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>configService<span class="token operator">:</span> <span class="token maybe-class-name">ConfigService</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    timeout<span class="token operator">:</span> configService<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'HTTP_TIMEOUT'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    maxRedirects<span class="token operator">:</span> configService<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'HTTP_MAX_REDIRECTS'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  inject<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">ConfigService</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Alternatively, you can configure the <code>HttpModule</code> using a class instead of a factory, as shown below.<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">HttpModule</span><span class="token punctuation">.</span><span class="token method function property-access">registerAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  useClass<span class="token operator">:</span> <span class="token maybe-class-name">HttpConfigService</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The construction above instantiates <code>HttpConfigService</code> inside <code>HttpModule</code>, using it to create an options object. Note that in this example, the <code>HttpConfigService</code> has to implement <code>HttpModuleOptionsFactory</code> interface as shown below. The <code>HttpModule</code> will call the <code>createHttpOptions()</code> method on the instantiated object of the supplied class.<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">HttpConfigService</span></span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token maybe-class-name">HttpModuleOptionsFactory</span></span> <span class="token punctuation">{</span>
  <span class="token function">createHttpOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">HttpModuleOptions</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      timeout<span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
      maxRedirects<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>If you want to reuse an existing options provider instead of creating a private copy inside the <code>HttpModule</code>, use the <code>useExisting</code> syntax.<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">HttpModule</span><span class="token punctuation">.</span><span class="token method function property-access">registerAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  useExisting<span class="token operator">:</span> <span class="token maybe-class-name">HttpConfigService</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="using-axios-directly"class="level4"><h4>Using Axios directly</h4><p>If you think that <code>HttpModule.register</code>'s options are not enough for you, or if you just want to access the underlying Axios instance created by <code>@nestjs/axios</code>, you can access it via <code>HttpService#axiosRef</code> as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsService</span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> httpService<span class="token operator">:</span> <span class="token maybe-class-name">HttpService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">AxiosResponse</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Cat</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">>></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">httpService</span><span class="token punctuation">.</span><span class="token property-access">axiosRef</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000/cats'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//                      ^ AxiosInstance interface</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></section><section id="full-example"class="level4"><h4>Full example</h4><p>Since the return value of the <code>HttpService</code> methods is an Observable, we can use <code>rxjs</code> - <code>firstValueFrom</code> or <code>lastValueFrom</code> to retrieve the data of the request in the form of a promise.<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> catchError<span class="token punctuation">,</span> firstValueFrom <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsService</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Logger</span></span><span class="token punctuation">(</span><span class="token maybe-class-name">CatsService</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> httpService<span class="token operator">:</span> <span class="token maybe-class-name">HttpService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Cat</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">firstValueFrom</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">httpService</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Cat</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000/cats'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">pipe</span><span class="token punctuation">(</span>
        <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token known-class-name class-name">AxiosError</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span><span class="token property-access">response</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword control-flow">throw</span> <span class="token string">'An error happened!'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> Visit RxJS's documentation on <a href="https://rxjs.dev/api/index/function/firstValueFrom"><code>firstValueFrom</code></a> and <a href="https://rxjs.dev/api/index/function/lastValueFrom"><code>lastValueFrom</code></a> for differences between them. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></blockquote></section></section>