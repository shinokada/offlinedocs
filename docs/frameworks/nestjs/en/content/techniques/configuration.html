<!doctype html><html lang="en"><meta charset="utf-8"><title>Configuration</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="configuration"class="level3"><h3>Configuration</h3><p>Applications often run in different <strong>environments</strong>. Depending on the environment, different configuration settings should be used. For example, usually the local environment relies on specific database credentials, valid only for the local DB instance. The production environment would use a separate set of DB credentials. Since configuration variables change, best practice is to <a href="https://12factor.net/config">store configuration variables</a> in the environment.<p>Externally defined environment variables are visible inside Node.js through the <code>process.env</code> global. We could try to solve the problem of multiple environments by setting the environment variables separately in each environment. This can quickly get unwieldy, especially in the development and testing environments where these values need to be easily mocked and/or changed.<p>In Node.js applications, it's common to use <code>.env</code> files, holding key-value pairs where each key represents a particular value, to represent each environment. Running an app in different environments is then just a matter of swapping in the correct <code>.env</code> file.<p>A good approach for using this technique in Nest is to create a <code>ConfigModule</code> that exposes a <code>ConfigService</code> which loads the appropriate <code>.env</code> file. While you may choose to write such a module yourself, for convenience Nest provides the <code>@nestjs/config</code> package out-of-the box. We'll cover this package in the current chapter.<section id="installation"class="level4"><h4>Installation</h4><p>To begin using it, we first install the required dependency.<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i --save @nestjs/config</code></pre><blockquote><p>info <strong>Hint</strong> The <code>@nestjs/config</code> package internally uses <a href="https://github.com/motdotla/dotenv">dotenv</a>.</blockquote><blockquote><p>warning <strong>Note</strong> <code>@nestjs/config</code> requires TypeScript 4.1 or later.</blockquote></section><section id="getting-started"class="level4"><h4>Getting started</h4><p>Once the installation process is complete, we can import the <code>ConfigModule</code>. Typically, we'll import it into the root <code>AppModule</code> and control its behavior using the <code>.forRoot()</code> static method. During this step, environment variable key/value pairs are parsed and resolved. Later, we'll see several options for accessing the <code>ConfigService</code> class of the <code>ConfigModule</code> in our other feature modules.<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token property-access">module</span><span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Module</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">ConfigModule</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/config'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>The above code will load and parse a <code>.env</code> file from the default location (the project root directory), merge key/value pairs from the <code>.env</code> file with environment variables assigned to <code>process.env</code>, and store the result in a private structure that you can access through the <code>ConfigService</code>. The <code>forRoot()</code> method registers the <code>ConfigService</code> provider, which provides a <code>get()</code> method for reading these parsed/merged configuration variables. Since <code>@nestjs/config</code> relies on <a href="https://github.com/motdotla/dotenv">dotenv</a>, it uses that package's rules for resolving conflicts in environment variable names. When a key exists both in the runtime environment as an environment variable (e.g., via OS shell exports like <code>export DATABASE_USER=test</code>) and in a <code>.env</code> file, the runtime environment variable takes precedence.<p>A sample <code>.env</code> file looks something like this:<pre class="language-json"><code class="language-json">DATABASE_USER=test
DATABASE_PASSWORD=test</code></pre></section><section id="custom-env-file-path"class="level4"><h4>Custom env file path</h4><p>By default, the package looks for a <code>.env</code> file in the root directory of the application. To specify another path for the <code>.env</code> file, set the <code>envFilePath</code> property of an (optional) options object you pass to <code>forRoot()</code>, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  envFilePath<span class="token operator">:</span> <span class="token string">'.development.env'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>You can also specify multiple paths for <code>.env</code> files like this:<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  envFilePath<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.env.development.local'</span><span class="token punctuation">,</span> <span class="token string">'.env.development'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>If a variable is found in multiple files, the first one takes precedence.</section><section id="disable-env-variables-loading"class="level4"><h4>Disable env variables loading</h4><p>If you don't want to load the <code>.env</code> file, but instead would like to simply access environment variables from the runtime environment (as with OS shell exports like <code>export DATABASE_USER=test</code>), set the options object's <code>ignoreEnvFile</code> property to <code>true</code>, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  ignoreEnvFile<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="use-module-globally"class="level4"><h4>Use module globally</h4><p>When you want to use <code>ConfigModule</code> in other modules, you'll need to import it (as is standard with any Nest module). Alternatively, declare it as a <a href="https://docs.nestjs.com/modules#global-modules">global module</a> by setting the options object's <code>isGlobal</code> property to <code>true</code>, as shown below. In that case, you will not need to import <code>ConfigModule</code> in other modules once it's been loaded in the root module (e.g., <code>AppModule</code>).<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  isGlobal<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="custom-configuration-files"class="level4"><h4>Custom configuration files</h4><p>For more complex projects, you may utilize custom configuration files to return nested configuration objects. This allows you to group related configuration settings by function (e.g., database-related settings), and to store related settings in individual files to help manage them independently.<p>A custom configuration file exports a factory function that returns a configuration object. The configuration object can be any arbitrarily nested plain JavaScript object. The <code>process.env</code> object will contain the fully resolved environment variable key/value pairs (with <code>.env</code> file and externally defined variables resolved and merged as described <a href="techniques/configuration#getting-started">above</a>). Since you control the returned configuration object, you can add any required logic to cast values to an appropriate type, set default values, etc. For example:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>config<span class="token operator">/</span>configuration<span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  port<span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">,</span>
  database<span class="token operator">:</span> <span class="token punctuation">{</span>
    host<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">DATABASE_HOST</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">DATABASE_PORT</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">5432</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>We load this file using the <code>load</code> property of the options object we pass to the <code>ConfigModule.forRoot()</code> method:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports">configuration</span> <span class="token keyword module">from</span> <span class="token string">'./config/configuration'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      load<span class="token operator">:</span> <span class="token punctuation">[</span>configuration<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Notice</strong> The value assigned to the <code>load</code> property is an array, allowing you to load multiple configuration files (e.g. <code>load: [databaseConfig, authConfig]</code>)</blockquote><p>With custom configuration files, we can also manage custom files such as YAML files. Here is an example of a configuration using YAML format:<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">http</span><span class="token punctuation">:</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">'localhost'</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>

<span class="token key atrule">db</span><span class="token punctuation">:</span>
  <span class="token key atrule">postgres</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">'localhost'</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5432</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token string">'yaml-db'</span>

  <span class="token key atrule">sqlite</span><span class="token punctuation">:</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token string">'sqlite.db'</span></code></pre><p>To read and parse YAML files, we can leverage the <code>js-yaml</code> package.<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i js-yaml
$ <span class="token function">npm</span> i -D @types/js-yaml</code></pre><p>Once the package is installed, we use <code>yaml#load</code> function to load YAML file we just created above.<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>config<span class="token operator">/</span>configuration<span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> readFileSync <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> yaml</span> <span class="token keyword module">from</span> <span class="token string">'js-yaml'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> join <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">YAML_CONFIG_FILENAME</span> <span class="token operator">=</span> <span class="token string">'config.yaml'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> yaml<span class="token punctuation">.</span><span class="token method function property-access">load</span><span class="token punctuation">(</span>
    <span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token constant">YAML_CONFIG_FILENAME</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token keyword module">as</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><blockquote><p>warning <strong>Note</strong> Nest CLI does not automatically move your "assets" (non-TS files) to the <code>dist</code> folder during the build process. To make sure that your YAML files are copied, you have to specify this in the <code>compilerOptions#assets</code> object in the <code>nest-cli.json</code> file. As an example, if the <code>config</code> folder is at the same level as the <code>src</code> folder, add <code>compilerOptions#assets</code> with the value <code>"assets": [{{ '{' }}"include": "../config/*.yaml", "outDir": "./dist/config"{{ '}' }}]</code>. Read more <a href="/cli/monorepo#assets">here</a>.</blockquote><p><app-banner-enterprise></app-banner-enterprise></section><section id="using-the-configservice"class="level4"><h4>Using the <code>ConfigService</code></h4><p>To access configuration values from our <code>ConfigService</code>, we first need to inject <code>ConfigService</code>. As with any provider, we need to import its containing module - the <code>ConfigModule</code> - into the module that will use it (unless you set the <code>isGlobal</code> property in the options object passed to the <code>ConfigModule.forRoot()</code> method to <code>true</code>). Import it into a feature module as shown below.<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>feature<span class="token punctuation">.</span><span class="token property-access">module</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Then we can inject it using standard constructor injection:<pre class="language-typescript"><code class="language-typescript"><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> configService<span class="token operator">:</span> <span class="token maybe-class-name">ConfigService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> The <code>ConfigService</code> is imported from the <code>@nestjs/config</code> package.</blockquote><p>And use it in our class:<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// get an environment variable</span>
<span class="token keyword">const</span> dbUser <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">configService</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'DATABASE_USER'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// get a custom configuration value</span>
<span class="token keyword">const</span> dbHost <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">configService</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'database.host'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>As shown above, use the <code>configService.get()</code> method to get a simple environment variable by passing the variable name. You can do TypeScript type hinting by passing the type, as shown above (e.g., <code>get&#x3C;string>(...)</code>). The <code>get()</code> method can also traverse a nested custom configuration object (created via a <a href="techniques/configuration#custom-configuration-files">Custom configuration file</a>), as shown in the second example above.<p>You can also get the whole nested custom configuration object using an interface as the type hint:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">DatabaseConfig</span></span> <span class="token punctuation">{</span>
  host<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  port<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> dbConfig <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">configService</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">DatabaseConfig</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'database'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// you can now use `dbConfig.port` and `dbConfig.host`</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> dbConfig<span class="token punctuation">.</span><span class="token property-access">port</span><span class="token punctuation">;</span></code></pre><p>The <code>get()</code> method also takes an optional second argument defining a default value, which will be returned when the key doesn't exist, as shown below:<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// use "localhost" when "database.host" is not defined</span>
<span class="token keyword">const</span> dbHost <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">configService</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'database.host'</span><span class="token punctuation">,</span> <span class="token string">'localhost'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>ConfigService</code> has two optional generics (type arguments). The first one is to help prevent accessing a config property that does not exist. Use it as shown below:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">EnvironmentVariables</span></span> <span class="token punctuation">{</span>
  <span class="token constant">PORT</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token constant">TIMEOUT</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// somewhere in the code</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> configService<span class="token operator">:</span> <span class="token maybe-class-name">ConfigService</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">EnvironmentVariables</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">configService</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'PORT'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> infer<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// TypeScript Error: this is invalid as the URL property is not defined in EnvironmentVariables</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">configService</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'URL'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> infer<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>With the <code>infer</code> property set to <code>true</code>, the <code>ConfigService#get</code> method will automatically infer the property type based on the interface, so for example, <code>typeof port === "number"</code> (if you're not using <code>strictNullChecks</code> flag from TypeScript) since <code>PORT</code> has a <code>number</code> type in the <code>EnvironmentVariables</code> interface.<p>Also, with the <code>infer</code> feature, you can infer the type of a nested custom configuration object's property, even when using dot notation, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> configService<span class="token operator">:</span> <span class="token maybe-class-name">ConfigService</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> database<span class="token operator">:</span> <span class="token punctuation">{</span> host<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dbHost <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">configService</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'database.host'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> infer<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>
  <span class="token comment">// typeof dbHost === "string"                                          |</span>
  <span class="token comment">//                                                                     +--> non-null assertion operator</span>
<span class="token punctuation">}</span></code></pre><p>The second generic relies on the first one, acting as a type assertion to get rid of all <code>undefined</code> types that <code>ConfigService</code>'s methods can return when <code>strictNullChecks</code> is on. For instance:<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// ...</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> configService<span class="token operator">:</span> <span class="token maybe-class-name">ConfigService</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span> <span class="token constant">PORT</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//                                                               ^^^^</span>
  <span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">configService</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'PORT'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> infer<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//    ^^^ The type of port will be 'number' thus you don't need TS type assertions anymore</span>
<span class="token punctuation">}</span></code></pre></section><section id="configuration-namespaces"class="level4"><h4>Configuration namespaces</h4><p>The <code>ConfigModule</code> allows you to define and load multiple custom configuration files, as shown in <a href="techniques/configuration#custom-configuration-files">Custom configuration files</a> above. You can manage complex configuration object hierarchies with nested configuration objects as shown in that section. Alternatively, you can return a "namespaced" configuration object with the <code>registerAs()</code> function as follows:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>config<span class="token operator">/</span>database<span class="token punctuation">.</span><span class="token property-access">config</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">registerAs</span><span class="token punctuation">(</span><span class="token string">'database'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  host<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">DATABASE_HOST</span><span class="token punctuation">,</span>
  port<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">DATABASE_PORT</span> <span class="token operator">||</span> <span class="token number">5432</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>As with custom configuration files, inside your <code>registerAs()</code> factory function, the <code>process.env</code> object will contain the fully resolved environment variable key/value pairs (with <code>.env</code> file and externally defined variables resolved and merged as described <a href="techniques/configuration#getting-started">above</a>).<blockquote><p>info <strong>Hint</strong> The <code>registerAs</code> function is exported from the <code>@nestjs/config</code> package.</blockquote><p>Load a namespaced configuration with the <code>load</code> property of the <code>forRoot()</code> method's options object, in the same way you load a custom configuration file:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports">databaseConfig</span> <span class="token keyword module">from</span> <span class="token string">'./config/database.config'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      load<span class="token operator">:</span> <span class="token punctuation">[</span>databaseConfig<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>Now, to get the <code>host</code> value from the <code>database</code> namespace, use dot notation. Use <code>'database'</code> as the prefix to the property name, corresponding to the name of the namespace (passed as the first argument to the <code>registerAs()</code> function):<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> dbHost <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">configService</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'database.host'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>A reasonable alternative is to inject the <code>database</code> namespace directly. This allows us to benefit from strong typing:<pre class="language-typescript"><code class="language-typescript"><span class="token function">constructor</span><span class="token punctuation">(</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Inject</span></span><span class="token punctuation">(</span>databaseConfig<span class="token punctuation">.</span><span class="token constant">KEY</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> dbConfig<span class="token operator">:</span> <span class="token maybe-class-name">ConfigType</span><span class="token operator">&#x3C;</span><span class="token keyword">typeof</span> databaseConfig<span class="token operator">></span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> The <code>ConfigType</code> is exported from the <code>@nestjs/config</code> package.</blockquote></section><section id="cache-environment-variables"class="level4"><h4>Cache environment variables</h4><p>As accessing <code>process.env</code> can be slow, you can set the <code>cache</code> property of the options object passed to <code>ConfigModule.forRoot()</code> to increase the performance of <code>ConfigService#get</code> method when it comes to variables stored in <code>process.env</code>.<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  cache<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="partial-registration"class="level4"><h4>Partial registration</h4><p>Thus far, we've processed configuration files in our root module (e.g., <code>AppModule</code>), with the <code>forRoot()</code> method. Perhaps you have a more complex project structure, with feature-specific configuration files located in multiple different directories. Rather than load all these files in the root module, the <code>@nestjs/config</code> package provides a feature called <strong>partial registration</strong>, which references only the configuration files associated with each feature module. Use the <code>forFeature()</code> static method within a feature module to perform this partial registration, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports">databaseConfig</span> <span class="token keyword module">from</span> <span class="token string">'./config/database.config'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">.</span><span class="token method function property-access">forFeature</span><span class="token punctuation">(</span>databaseConfig<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">DatabaseModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Warning</strong> In some circumstances, you may need to access properties loaded via partial registration using the <code>onModuleInit()</code> hook, rather than in a constructor. This is because the <code>forFeature()</code> method is run during module initialization, and the order of module initialization is indeterminate. If you access values loaded this way by another module, in a constructor, the module that the configuration depends upon may not yet have initialized. The <code>onModuleInit()</code> method runs only after all modules it depends upon have been initialized, so this technique is safe.</blockquote></section><section id="schema-validation"class="level4"><h4>Schema validation</h4><p>It is standard practice to throw an exception during application startup if required environment variables haven't been provided or if they don't meet certain validation rules. The <code>@nestjs/config</code> package enables two different ways to do this:<ul><li><a href="https://github.com/sideway/joi">Joi</a> built-in validator. With Joi, you define an object schema and validate JavaScript objects against it.<li>A custom <code>validate()</code> function which takes environment variables as an input.</ul><p>To use Joi, we must install Joi package:<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> --save joi</code></pre><blockquote><p>warning <strong>Notice</strong> The latest version of <code>joi</code> requires you to be running Node v12 or later. For older versions of node, please install <code>v16.1.8</code>. This is mainly after the release of <code>v17.0.2</code> which causes errors during build time. For more information, please refer to <a href="https://github.com/sideway/joi/issues/2262">their 17.0.0 release notes</a>.</blockquote><p>Now we can define a Joi validation schema and pass it via the <code>validationSchema</code> property of the <code>forRoot()</code> method's options object, as shown below:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token property-access">module</span><span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> <span class="token maybe-class-name">Joi</span></span> <span class="token keyword module">from</span> <span class="token string">'joi'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      validationSchema<span class="token operator">:</span> <span class="token maybe-class-name">Joi</span><span class="token punctuation">.</span><span class="token method function property-access">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token constant">NODE_ENV</span><span class="token operator">:</span> <span class="token maybe-class-name">Joi</span><span class="token punctuation">.</span><span class="token method function property-access">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token method function property-access">valid</span><span class="token punctuation">(</span><span class="token string">'development'</span><span class="token punctuation">,</span> <span class="token string">'production'</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'provision'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token keyword module">default</span><span class="token punctuation">(</span><span class="token string">'development'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token constant">PORT</span><span class="token operator">:</span> <span class="token maybe-class-name">Joi</span><span class="token punctuation">.</span><span class="token method function property-access">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword module">default</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>By default, all schema keys are considered optional. Here, we set default values for <code>NODE_ENV</code> and <code>PORT</code> which will be used if we don't provide these variables in the environment (<code>.env</code> file or process environment). Alternatively, we can use the <code>required()</code> validation method to require that a value must be defined in the environment (<code>.env</code> file or process environment). In this case, the validation step will throw an exception if we don't provide the variable in the environment. See <a href="https://joi.dev/api/?v=17.3.0#example">Joi validation methods</a> for more on how to construct validation schemas.<p>By default, unknown environment variables (environment variables whose keys are not present in the schema) are allowed and do not trigger a validation exception. By default, all validation errors are reported. You can alter these behaviors by passing an options object via the <code>validationOptions</code> key of the <code>forRoot()</code> options object. This options object can contain any of the standard validation options properties provided by <a href="https://joi.dev/api/?v=17.3.0#anyvalidatevalue-options">Joi validation options</a>. For example, to reverse the two settings above, pass options like this:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token property-access">module</span><span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> <span class="token maybe-class-name">Joi</span></span> <span class="token keyword module">from</span> <span class="token string">'joi'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      validationSchema<span class="token operator">:</span> <span class="token maybe-class-name">Joi</span><span class="token punctuation">.</span><span class="token method function property-access">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token constant">NODE_ENV</span><span class="token operator">:</span> <span class="token maybe-class-name">Joi</span><span class="token punctuation">.</span><span class="token method function property-access">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token method function property-access">valid</span><span class="token punctuation">(</span><span class="token string">'development'</span><span class="token punctuation">,</span> <span class="token string">'production'</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'provision'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token keyword module">default</span><span class="token punctuation">(</span><span class="token string">'development'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token constant">PORT</span><span class="token operator">:</span> <span class="token maybe-class-name">Joi</span><span class="token punctuation">.</span><span class="token method function property-access">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword module">default</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      validationOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
        allowUnknown<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        abortEarly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>The <code>@nestjs/config</code> package uses default settings of:<ul><li><code>allowUnknown</code>: controls whether or not to allow unknown keys in the environment variables. Default is <code>true</code><li><code>abortEarly</code>: if true, stops validation on the first error; if false, returns all errors. Defaults to <code>false</code>.</ul><p>Note that once you decide to pass a <code>validationOptions</code> object, any settings you do not explicitly pass will default to <code>Joi</code> standard defaults (not the <code>@nestjs/config</code> defaults). For example, if you leave <code>allowUnknowns</code> unspecified in your custom <code>validationOptions</code> object, it will have the <code>Joi</code> default value of <code>false</code>. Hence, it is probably safest to specify <strong>both</strong> of these settings in your custom object.</section><section id="custom-validate-function"class="level4"><h4>Custom validate function</h4><p>Alternatively, you can specify a <strong>synchronous</strong> <code>validate</code> function that takes an object containing the environment variables (from env file and process) and returns an object containing validated environment variables so that you can convert/mutate them if needed. If the function throws an error, it will prevent the application from bootstrapping.<p>In this example, we'll proceed with the <code>class-transformer</code> and <code>class-validator</code> packages. First, we have to define:<ul><li>a class with validation constraints,<li>a validate function that makes use of the <code>plainToInstance</code> and <code>validateSync</code> functions.</ul><pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>env<span class="token punctuation">.</span><span class="token property-access">validation</span><span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> plainToInstance <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'class-transformer'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">IsEnum</span><span class="token punctuation">,</span> <span class="token maybe-class-name">IsNumber</span><span class="token punctuation">,</span> validateSync <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'class-validator'</span><span class="token punctuation">;</span>

<span class="token keyword">enum</span> <span class="token maybe-class-name">Environment</span> <span class="token punctuation">{</span>
  <span class="token maybe-class-name">Development</span> <span class="token operator">=</span> <span class="token string">"development"</span><span class="token punctuation">,</span>
  <span class="token maybe-class-name">Production</span> <span class="token operator">=</span> <span class="token string">"production"</span><span class="token punctuation">,</span>
  <span class="token maybe-class-name">Test</span> <span class="token operator">=</span> <span class="token string">"test"</span><span class="token punctuation">,</span>
  <span class="token maybe-class-name">Provision</span> <span class="token operator">=</span> <span class="token string">"provision"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">EnvironmentVariables</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsEnum</span></span><span class="token punctuation">(</span><span class="token maybe-class-name">Environment</span><span class="token punctuation">)</span>
  <span class="token constant">NODE_ENV</span><span class="token operator">:</span> <span class="token maybe-class-name">Environment</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsNumber</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token constant">PORT</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">validate</span><span class="token punctuation">(</span>config<span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">unknown</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> validatedConfig <span class="token operator">=</span> <span class="token function">plainToInstance</span><span class="token punctuation">(</span>
    <span class="token maybe-class-name">EnvironmentVariables</span><span class="token punctuation">,</span>
    config<span class="token punctuation">,</span>
    <span class="token punctuation">{</span> enableImplicitConversion<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> errors <span class="token operator">=</span> <span class="token function">validateSync</span><span class="token punctuation">(</span>validatedConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span> skipMissingProperties<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> validatedConfig<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>With this in place, use the <code>validate</code> function as a configuration option of the <code>ConfigModule</code>, as follows:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token property-access">module</span><span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> validate <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./env.validation'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      validate<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p><app-banner-shop></app-banner-shop></section><section id="custom-getter-functions"class="level4"><h4>Custom getter functions</h4><p><code>ConfigService</code> defines a generic <code>get()</code> method to retrieve a configuration value by key. We may also add <code>getter</code> functions to enable a little more natural coding style:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">ApiConfigService</span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> configService<span class="token operator">:</span> <span class="token maybe-class-name">ConfigService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">isAuthEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">configService</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'AUTH_ENABLED'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'true'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
@@<span class="token keyword control-flow">switch</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Dependencies</span></span><span class="token punctuation">(</span><span class="token maybe-class-name">ConfigService</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">ApiConfigService</span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>configService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">configService</span> <span class="token operator">=</span> configService<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">isAuthEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">configService</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'AUTH_ENABLED'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'true'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Now we can use the getter function as follows:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token property-access">service</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppService</span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>apiConfigService<span class="token operator">:</span> <span class="token maybe-class-name">ApiConfigService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>apiConfigService<span class="token punctuation">.</span><span class="token property-access">isAuthEnabled</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Authentication is enabled</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
@@<span class="token keyword control-flow">switch</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Dependencies</span></span><span class="token punctuation">(</span><span class="token maybe-class-name">ApiConfigService</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppService</span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>apiConfigService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>apiConfigService<span class="token punctuation">.</span><span class="token property-access">isAuthEnabled</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Authentication is enabled</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></section><section id="environment-variables-loaded-hook"class="level4"><h4>Environment variables loaded hook</h4><p>If a module configuration depends on the environment variables, and these variables are loaded from the <code>.env</code> file, you can use the <code>ConfigModule.envVariablesLoaded</code> hook to ensure that the file was loaded before interacting with the <code>process.env</code> object, see the following example:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getStorageModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">.</span><span class="token property-access">envVariablesLoaded</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">STORAGE</span> <span class="token operator">===</span> <span class="token string">'S3'</span> <span class="token operator">?</span> <span class="token maybe-class-name">S3StorageModule</span> <span class="token operator">:</span> <span class="token maybe-class-name">DefaultStorageModule</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>This construction guarantees that after the <code>ConfigModule.envVariablesLoaded</code> Promise resolves, all configuration variables are loaded up.</section><section id="expandable-variables"class="level4"><h4>Expandable variables</h4><p>The <code>@nestjs/config</code> package supports environment variable expansion. With this technique, you can create nested environment variables, where one variable is referred to within the definition of another. For example:<pre class="language-json"><code class="language-json">APP_URL=mywebsite.com
SUPPORT_EMAIL=support@$<span class="token punctuation">{</span>APP_URL<span class="token punctuation">}</span></code></pre><p>With this construction, the variable <code>SUPPORT_EMAIL</code> resolves to <code>'support@mywebsite.com'</code>. Note the use of the <code>${{ '{' }}...{{ '}' }}</code> syntax to trigger resolving the value of the variable <code>APP_URL</code> inside the definition of <code>SUPPORT_EMAIL</code>.<blockquote><p>info <strong>Hint</strong> For this feature, <code>@nestjs/config</code> package internally uses <a href="https://github.com/motdotla/dotenv-expand">dotenv-expand</a>.</blockquote><p>Enable environment variable expansion using the <code>expandVariables</code> property in the options object passed to the <code>forRoot()</code> method of the <code>ConfigModule</code>, as shown below:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token property-access">module</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      expandVariables<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></section><section id="using-in-the-maints"class="level4"><h4>Using in the <code>main.ts</code></h4><p>While our config is a stored in a service, it can still be used in the <code>main.ts</code> file. This way, you can use it to store variables such as the application port or the CORS host.<p>To access it, you must use the <code>app.get()</code> method, followed by the service reference:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> configService <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token maybe-class-name">ConfigService</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>You can then use it as usual, by calling the <code>get</code> method with the configuration key:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> port <span class="token operator">=</span> configService<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'PORT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>