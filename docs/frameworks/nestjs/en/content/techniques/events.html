<!doctype html><html lang="en"><meta charset="utf-8"><title>Events</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="events"class="level3"><h3>Events</h3><p><a href="https://www.npmjs.com/package/@nestjs/event-emitter">Event Emitter</a> package (<code>@nestjs/event-emitter</code>) provides a simple observer implementation, allowing you to subscribe and listen for various events that occur in your application. Events serve as a great way to decouple various aspects of your application, since a single event can have multiple listeners that do not depend on each other.<p><code>EventEmitterModule</code> internally uses the <a href="https://github.com/EventEmitter2/EventEmitter2">eventemitter2</a> package.<section id="getting-started"class="level4"><h4>Getting started</h4><p>First install the required package:<pre class="language-shell"><code class="language-shell">$ <span class="token function">npm</span> i --save @nestjs/event-emitter</code></pre><p>Once the installation is complete, import the <code>EventEmitterModule</code> into the root <code>AppModule</code> and run the <code>forRoot()</code> static method as shown below:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token property-access">module</span><span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Module</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">EventEmitterModule</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/event-emitter'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token maybe-class-name">EventEmitterModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>The <code>.forRoot()</code> call initializes the event emitter and registers any declarative event listeners that exist within your app. Registration occurs when the <code>onApplicationBootstrap</code> lifecycle hook occurs, ensuring that all modules have loaded and declared any scheduled jobs.<p>To configure the underlying <code>EventEmitter</code> instance, pass the configuration object to the <code>.forRoot()</code> method, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">EventEmitterModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// set this to `true` to use wildcards</span>
  wildcard<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// the delimiter used to segment namespaces</span>
  delimiter<span class="token operator">:</span> <span class="token string">'.'</span><span class="token punctuation">,</span>
  <span class="token comment">// set this to `true` if you want to emit the newListener event</span>
  newListener<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// set this to `true` if you want to emit the removeListener event</span>
  removeListener<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// the maximum amount of listeners that can be assigned to an event</span>
  maxListeners<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token comment">// show event name in memory leak message when more than maximum amount of listeners is assigned</span>
  verboseMemoryLeak<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// disable throwing uncaughtException if an error event is emitted and it has no listeners</span>
  ignoreErrors<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="dispatching-events"class="level4"><h4>Dispatching Events</h4><p>To dispatch (i.e., fire) an event, first inject <code>EventEmitter2</code> using standard constructor injection:<pre class="language-typescript"><code class="language-typescript"><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> eventEmitter<span class="token operator">:</span> <span class="token maybe-class-name">EventEmitter2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> Import the <code>EventEmitter2</code> from the <code>@nestjs/event-emitter</code> package.</blockquote><p>Then use it in a class as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">eventEmitter</span><span class="token punctuation">.</span><span class="token method function property-access">emit</span><span class="token punctuation">(</span>
  <span class="token string">'order.created'</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">OrderCreatedEvent</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    orderId<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    payload<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="listening-to-events"class="level4"><h4>Listening to Events</h4><p>To declare an event listener, decorate a method with the <code>@OnEvent()</code> decorator preceding the method definition containing the code to be executed, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">OnEvent</span></span><span class="token punctuation">(</span><span class="token string">'order.created'</span><span class="token punctuation">)</span>
<span class="token function">handleOrderCreatedEvent</span><span class="token punctuation">(</span>payload<span class="token operator">:</span> <span class="token maybe-class-name">OrderCreatedEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// handle and process "OrderCreatedEvent" event</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>warning <strong>Warning</strong> Event subscribers cannot be request-scoped.</blockquote><p>The first argument can be a <code>string</code> or <code>symbol</code> for a simple event emitter and a <code>string | symbol | Array&#x3C;string | symbol></code> in a case of a wildcard emitter. The second argument (optional) is a listener options object (<a href="https://github.com/EventEmitter2/EventEmitter2#emitteronevent-listener-options-objectboolean">read more</a>).<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">OnEvent</span></span><span class="token punctuation">(</span><span class="token string">'order.created'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> async<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">handleOrderCreatedEvent</span><span class="token punctuation">(</span>payload<span class="token operator">:</span> <span class="token maybe-class-name">OrderCreatedEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// handle and process "OrderCreatedEvent" event</span>
<span class="token punctuation">}</span></code></pre><p>To use namespaces/wildcards, pass the <code>wildcard</code> option into the <code>EventEmitterModule#forRoot()</code> method. When namespaces/wildcards are enabled, events can either be strings (<code>foo.bar</code>) separated by a delimiter or arrays (<code>['foo', 'bar']</code>). The delimiter is also configurable as a configuration property (<code>delimiter</code>). With namespaces feature enabled, you can subscribe to events using a wildcard:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">OnEvent</span></span><span class="token punctuation">(</span><span class="token string">'order.*'</span><span class="token punctuation">)</span>
<span class="token function">handleOrderEvents</span><span class="token punctuation">(</span>payload<span class="token operator">:</span> <span class="token maybe-class-name">OrderCreatedEvent</span> <span class="token operator">|</span> <span class="token maybe-class-name">OrderRemovedEvent</span> <span class="token operator">|</span> <span class="token maybe-class-name">OrderUpdatedEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// handle and process an event</span>
<span class="token punctuation">}</span></code></pre><p>Note that such a wildcard only applies to one block. The argument <code>order.*</code> will match, for example, the events <code>order.created</code> and <code>order.shipped</code> but not <code>order.delayed.out_of_stock</code>. In order to listen to such events, use the <code>multilevel wildcard</code> pattern (i.e, <code>**</code>), described in the <code>EventEmitter2</code> <a href="https://github.com/EventEmitter2/EventEmitter2#multi-level-wildcards">documentation</a>.<p>With this pattern, you can, for example, create an event listener that catches all events.<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">OnEvent</span></span><span class="token punctuation">(</span><span class="token string">'**'</span><span class="token punctuation">)</span>
<span class="token function">handleEverything</span><span class="token punctuation">(</span>payload<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// handle and process an event</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> <code>EventEmitter2</code> class provides several useful methods for interacting with events, like <code>waitFor</code> and <code>onAny</code>. You can read more about them <a href="https://github.com/EventEmitter2/EventEmitter2">here</a>.</blockquote></section><section id="example"class="level4"><h4>Example</h4><p>A working example is available <a href="https://github.com/nestjs/nest/tree/master/sample/30-event-emitter">here</a>. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>