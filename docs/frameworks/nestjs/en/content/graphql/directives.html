<!doctype html><html lang="en"><meta charset="utf-8"><title>Directives</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="directives"class="level3"><h3>Directives</h3><p>A directive can be attached to a field or fragment inclusion, and can affect execution of the query in any way the server desires (read more <a href="https://graphql.org/learn/queries/#directives">here</a>). The GraphQL specification provides several default directives:<ul><li><code>@include(if: Boolean)</code> - only include this field in the result if the argument is true<li><code>@skip(if: Boolean)</code> - skip this field if the argument is true<li><code>@deprecated(reason: String)</code> - marks field as deprecated with message</ul><p>A directive is an identifier preceded by a <code>@</code> character, optionally followed by a list of named arguments, which can appear after almost any element in the GraphQL query and schema languages.<section id="custom-directives"class="level4"><h4>Custom directives</h4><p>To instruct what should happen when Apollo/Mercurius encounters your directive, you can create a transformer function. This function uses the <code>mapSchema</code> function to iterate through locations in your schema (field definitions, type definitions, etc.) and perform corresponding transformations.<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> getDirective<span class="token punctuation">,</span> <span class="token maybe-class-name">MapperKind</span><span class="token punctuation">,</span> mapSchema <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@graphql-tools/utils'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defaultFieldResolver<span class="token punctuation">,</span> <span class="token maybe-class-name">GraphQLSchema</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'graphql'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">upperDirectiveTransformer</span><span class="token punctuation">(</span>
  schema<span class="token operator">:</span> <span class="token maybe-class-name">GraphQLSchema</span><span class="token punctuation">,</span>
  directiveName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token function">mapSchema</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token maybe-class-name">MapperKind</span><span class="token punctuation">.</span><span class="token constant">OBJECT_FIELD</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">(</span>fieldConfig<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> upperDirective <span class="token operator">=</span> <span class="token function">getDirective</span><span class="token punctuation">(</span>
        schema<span class="token punctuation">,</span>
        fieldConfig<span class="token punctuation">,</span>
        directiveName<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>upperDirective<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token operator">=</span> defaultFieldResolver <span class="token punctuation">}</span> <span class="token operator">=</span> fieldConfig<span class="token punctuation">;</span>

        <span class="token comment">// Replace the original resolver with a function that *first* calls</span>
        <span class="token comment">// the original resolver, then converts its result to upper case</span>
        fieldConfig<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">resolve</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>source<span class="token punctuation">,</span> args<span class="token punctuation">,</span> context<span class="token punctuation">,</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">resolve</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> args<span class="token punctuation">,</span> context<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> result <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword control-flow">return</span> result<span class="token punctuation">.</span><span class="token method function property-access">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword control-flow">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">return</span> fieldConfig<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Now, apply the <code>upperDirectiveTransformer</code> transformation function in the <code>GraphQLModule#forRoot</code> method using the <code>transformSchema</code> function:<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function-variable function">transformSchema</span><span class="token operator">:</span> <span class="token punctuation">(</span>schema<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">upperDirectiveTransformer</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> <span class="token string">'upper'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Once registered, the <code>@upper</code> directive can be used in our schema. However, the way you apply the directive will vary depending on the approach you use (code first or schema first).</section><section id="code-first"class="level4"><h4>Code first</h4><p>In the code first approach, use the <code>@Directive()</code> decorator to apply the directive.<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Directive</span></span><span class="token punctuation">(</span><span class="token string">'@upper'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Field</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></code></pre><blockquote><p>info <strong>Hint</strong> The <code>@Directive()</code> decorator is exported from the <code>@nestjs/graphql</code> package.</blockquote><p>Directives can be applied on fields, field resolvers, input and object types, as well as queries, mutations, and subscriptions. Here's an example of the directive applied on the query handler level:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Directive</span></span><span class="token punctuation">(</span><span class="token string">'@deprecated(reason: "This query will be removed in the next version")'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Query</span></span><span class="token punctuation">(</span>returns <span class="token arrow operator">=></span> <span class="token maybe-class-name">Author</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'author'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">getAuthor</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Args</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token function-variable function">type</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token maybe-class-name">Int</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">authorsService</span><span class="token punctuation">.</span><span class="token method function property-access">findOneById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>warn <strong>Warning</strong> Directives applied through the <code>@Directive()</code> decorator will not be reflected in the generated schema definition file.</blockquote><p>Lastly, make sure to declare directives in the <code>GraphQLModule</code>, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...,</span>
  <span class="token function-variable function">transformSchema</span><span class="token operator">:</span> schema <span class="token arrow operator">=></span> <span class="token function">upperDirectiveTransformer</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> <span class="token string">'upper'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  buildSchemaOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    directives<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">GraphQLDirective</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">'upper'</span><span class="token punctuation">,</span>
        locations<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">DirectiveLocation</span><span class="token punctuation">.</span><span class="token constant">FIELD_DEFINITION</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><blockquote><p>info <strong>Hint</strong> Both <code>GraphQLDirective</code> and <code>DirectiveLocation</code> are exported from the <code>graphql</code> package.</blockquote></section><section id="schema-first"class="level4"><h4>Schema first</h4><p>In the schema first approach, apply directives directly in SDL.<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">directive</span> <span class="token directive function">@upper</span> <span class="token keyword">on</span> <span class="token constant">FIELD_DEFINITION</span>

<span class="token keyword">type</span> <span class="token class-name">Post</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">Int</span><span class="token operator">!</span>
  <span class="token attr-name">title</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span> <span class="token directive function">@upper</span>
  <span class="token attr-name">votes</span><span class="token punctuation">:</span> <span class="token scalar">Int</span>
<span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>