<!doctype html><html lang="en"><meta charset="utf-8"><title>CLI Plugin</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="cli-plugin"class="level3"><h3>CLI Plugin</h3><blockquote><p>warning <strong>Warning</strong> This chapter applies only to the code first approach.</blockquote><p>TypeScript's metadata reflection system has several limitations which make it impossible to, for instance, determine what properties a class consists of or recognize whether a given property is optional or required. However, some of these constraints can be addressed at compilation time. Nest provides a plugin that enhances the TypeScript compilation process to reduce the amount of boilerplate code required.<blockquote><p>info <strong>Hint</strong> This plugin is <strong>opt-in</strong>. If you prefer, you can declare all decorators manually, or only specific decorators where you need them.</blockquote><section id="overview"class="level4"><h4>Overview</h4><p>The GraphQL plugin will automatically:<ul><li>annotate all input object, object type and args classes properties with <code>@Field</code> unless <code>@HideField</code> is used<li>set the <code>nullable</code> property depending on the question mark (e.g. <code>name?: string</code> will set <code>nullable: true</code>)<li>set the <code>type</code> property depending on the type (supports arrays as well)<li>generate descriptions for properties based on comments (if <code>introspectComments</code> set to <code>true</code>)</ul><p>Please, note that your filenames <strong>must have</strong> one of the following suffixes in order to be analyzed by the plugin: <code>['.input.ts', '.args.ts', '.entity.ts', '.model.ts']</code> (e.g., <code>author.entity.ts</code>). If you are using a different suffix, you can adjust the plugin's behavior by specifying the <code>typeFileNameSuffix</code> option (see below).<p>With what we've learned so far, you have to duplicate a lot of code to let the package know how your type should be declared in GraphQL. For example, you could define a simple <code>Author</code> class as follows:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>authors<span class="token operator">/</span>models<span class="token operator">/</span>author<span class="token punctuation">.</span><span class="token property-access">model</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">ObjectType</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">Author</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Field</span></span><span class="token punctuation">(</span>type <span class="token arrow operator">=></span> <span class="token constant">ID</span><span class="token punctuation">)</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Field</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> nullable<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  firstName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Field</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> nullable<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  lastName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Field</span></span><span class="token punctuation">(</span>type <span class="token arrow operator">=></span> <span class="token punctuation">[</span><span class="token maybe-class-name">Post</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  posts<span class="token operator">:</span> <span class="token maybe-class-name">Post</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>While not a significant issue with medium-sized projects, it becomes verbose &#x26; hard to maintain once you have a large set of classes.<p>By enabling the GraphQL plugin, the above class definition can be declared simply:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>authors<span class="token operator">/</span>models<span class="token operator">/</span>author<span class="token punctuation">.</span><span class="token property-access">model</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">ObjectType</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">Author</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Field</span></span><span class="token punctuation">(</span>type <span class="token arrow operator">=></span> <span class="token constant">ID</span><span class="token punctuation">)</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  firstName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  lastName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  posts<span class="token operator">:</span> <span class="token maybe-class-name">Post</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>The plugin adds appropriate decorators on-the-fly based on the <strong>Abstract Syntax Tree</strong>. Thus, you won't have to struggle with <code>@Field</code> decorators scattered throughout the code.<blockquote><p>info <strong>Hint</strong> The plugin will automatically generate any missing GraphQL properties, but if you need to override them, simply set them explicitly via <code>@Field()</code>.</blockquote></section><section id="comments-introspection"class="level4"><h4>Comments introspection</h4><p>With the comments introspection feature enabled, CLI plugin will generate descriptions for fields based on comments.<p>For example, given an example <code>roles</code> property:<pre class="language-typescript"><code class="language-typescript"><span class="token doc-comment comment">/**
 * A list of user's roles
 */</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Field</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">[</span><span class="token known-class-name class-name">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  description<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">A list of user's roles</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
roles<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><p>You must duplicate description values. With <code>introspectComments</code> enabled, the CLI plugin can extract these comments and automatically provide descriptions for properties. Now, the above field can be declared simply as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token doc-comment comment">/**
 * A list of user's roles
 */</span>
roles<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></section><section id="using-the-cli-plugin"class="level4"><h4>Using the CLI plugin</h4><p>To enable the plugin, open <code>nest-cli.json</code> (if you use <a href="/cli/overview">Nest CLI</a>) and add the following <code>plugins</code> configuration:<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
  <span class="token string-property property">"collection"</span><span class="token operator">:</span> <span class="token string">"@nestjs/schematics"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"sourceRoot"</span><span class="token operator">:</span> <span class="token string">"src"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@nestjs/graphql"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>You can use the <code>options</code> property to customize the behavior of the plugin.<pre class="language-javascript"><code class="language-javascript"><span class="token string-property property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"@nestjs/graphql"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"options"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">"typeFileNameSuffix"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">".input.ts"</span><span class="token punctuation">,</span> <span class="token string">".args.ts"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string-property property">"introspectComments"</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre><p>The <code>options</code> property has to fulfill the following interface:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">PluginOptions</span></span> <span class="token punctuation">{</span>
  typeFileNameSuffix<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  introspectComments<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><table><tr><th>Option<th>Default<th>Description<tr><td><code>typeFileNameSuffix</code><td><code>['.input.ts', '.args.ts', '.entity.ts', '.model.ts']</code><td>GraphQL types files suffix<tr><td><code>introspectComments</code><td><code>false</code><td>If set to true, plugin will generate descriptions for properties based on comments</table><p>If you don't use the CLI but instead have a custom <code>webpack</code> configuration, you can use this plugin in combination with <code>ts-loader</code>:<pre class="language-javascript"><code class="language-javascript"><span class="token function-variable function">getCustomTransformers</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">program</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">before</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@nestjs/graphql/plugin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">before</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> program<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre></section><section id="integration-with-ts-jest-e2e-tests"class="level4"><h4>Integration with <code>ts-jest</code> (e2e tests)</h4><p>When running e2e tests with this plugin enabled, you may run into issues with compiling schema. For example, one of the most common errors is:<pre class="language-json"><code class="language-json">Object type &#x3C;name> must define one or more fields.</code></pre><p>This happens because <code>jest</code> configuration does not import <code>@nestjs/graphql/plugin</code> plugin anywhere.<p>To fix this, create the following file in your e2e tests directory:<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> transformer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@nestjs/graphql/plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">=</span> <span class="token string">'nestjs-graphql-transformer'</span><span class="token punctuation">;</span>
<span class="token comment">// you should change the version number anytime you change the configuration below - otherwise, jest will not detect changes</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token punctuation">.</span><span class="token property-access">version</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">factory</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">cs</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> transformer<span class="token punctuation">.</span><span class="token method function property-access">before</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// @nestjs/graphql/plugin options (can be empty)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    cs<span class="token punctuation">.</span><span class="token property-access">program</span><span class="token punctuation">,</span> <span class="token comment">// "cs.tsCompiler.program" for older versions of Jest (&#x3C;= v27)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>With this in place, import AST transformer within your <code>jest</code> configuration file. By default (in the starter application), e2e tests configuration file is located under the <code>test</code> folder and is named <code>jest-e2e.json</code>.<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  ... <span class="token comment">// other configuration</span>
  <span class="token property">"globals"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"ts-jest"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"astTransformers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"before"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"&#x3C;path to the file created above>"</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>If you use <code>jest@^29</code>, then use the snippet below, as the previous approach got deprecated.<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  ... <span class="token comment">// other configuration</span>
  <span class="token property">"transform"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"^.+\\.(t|j)s$"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"ts-jest"</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"astTransformers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"before"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"&#x3C;path to the file created above>"</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>