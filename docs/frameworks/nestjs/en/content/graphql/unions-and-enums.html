<!doctype html><html lang="en"><meta charset="utf-8"><title>Unions</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="unions"class="level3"><h3>Unions</h3><p>Union types are very similar to interfaces, but they don't get to specify any common fields between the types (read more <a href="https://graphql.org/learn/schema/#union-types">here</a>). Unions are useful for returning disjoint data types from a single field.<section id="code-first"class="level4"><h4>Code first</h4><p>To define a GraphQL union type, we must define classes that this union will be composed of. Following the <a href="https://www.apollographql.com/docs/apollo-server/schema/unions-interfaces/#union-type">example</a> from the Apollo documentation, we'll create two classes. First, <code>Book</code>:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Field</span><span class="token punctuation">,</span> <span class="token maybe-class-name">ObjectType</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/graphql'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">ObjectType</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">Book</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Field</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>And then <code>Author</code>:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Field</span><span class="token punctuation">,</span> <span class="token maybe-class-name">ObjectType</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/graphql'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">ObjectType</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">Author</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Field</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>With this in place, register the <code>ResultUnion</code> union using the <code>createUnionType</code> function exported from the <code>@nestjs/graphql</code> package:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token maybe-class-name">ResultUnion</span> <span class="token operator">=</span> <span class="token function">createUnionType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'ResultUnion'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">types</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">[</span><span class="token maybe-class-name">Author</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Book</span><span class="token punctuation">]</span> <span class="token keyword module">as</span> <span class="token keyword">const</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>warning <strong>Warning</strong> The array returned by the <code>types</code> property of the <code>createUnionType</code> function should be given a const assertion. If the const assertion is not given, a wrong declaration file will be generated at compile time, and an error will occur when using it from another project.</blockquote><p>Now, we can reference the <code>ResultUnion</code> in our query:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Query</span></span><span class="token punctuation">(</span>returns <span class="token arrow operator">=></span> <span class="token punctuation">[</span><span class="token maybe-class-name">ResultUnion</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Array</span><span class="token operator">&#x3C;</span><span class="token keyword">typeof</span> <span class="token maybe-class-name">ResultUnion</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Author</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">Book</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>This will result in generating the following part of the GraphQL schema in SDL:<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">type</span> <span class="token class-name">Author</span> <span class="token punctuation">{</span>
  <span class="token attr-name">name</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Book</span> <span class="token punctuation">{</span>
  <span class="token attr-name">title</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span>
<span class="token punctuation">}</span>

<span class="token keyword">union</span> <span class="token class-name">ResultUnion</span> <span class="token operator">=</span> <span class="token property">Author</span> <span class="token operator">|</span> <span class="token property">Book</span>

<span class="token keyword">type</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span>
  <span class="token attr-name">search</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">ResultUnion</span><span class="token operator">!</span><span class="token punctuation">]</span><span class="token operator">!</span>
<span class="token punctuation">}</span></code></pre><p>The default <code>resolveType()</code> function generated by the library will extract the type based on the value returned from the resolver method. That means returning class instances instead of literal JavaScript object is obligatory.<p>To provide a customized <code>resolveType()</code> function, pass the <code>resolveType</code> property to the options object passed into the <code>createUnionType()</code> function, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token maybe-class-name">ResultUnion</span> <span class="token operator">=</span> <span class="token function">createUnionType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'ResultUnion'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">types</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">[</span><span class="token maybe-class-name">Author</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Book</span><span class="token punctuation">]</span> <span class="token keyword module">as</span> <span class="token keyword">const</span><span class="token punctuation">,</span>
  <span class="token function">resolveType</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token maybe-class-name">Author</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token maybe-class-name">Book</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="schema-first"class="level4"><h4>Schema first</h4><p>To define a union in the schema first approach, simply create a GraphQL union with SDL.<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">type</span> <span class="token class-name">Author</span> <span class="token punctuation">{</span>
  <span class="token attr-name">name</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Book</span> <span class="token punctuation">{</span>
  <span class="token attr-name">title</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span>
<span class="token punctuation">}</span>

<span class="token keyword">union</span> <span class="token class-name">ResultUnion</span> <span class="token operator">=</span> <span class="token property">Author</span> <span class="token operator">|</span> <span class="token property">Book</span></code></pre><p>Then, you can use the typings generation feature (as shown in the <a href="/graphql/quick-start">quick start</a> chapter) to generate corresponding TypeScript definitions:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">Author</span></span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">Book</span></span> <span class="token punctuation">{</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">ResultUnion</span></span> <span class="token operator">=</span> <span class="token maybe-class-name">Author</span> <span class="token operator">|</span> <span class="token maybe-class-name">Book</span><span class="token punctuation">;</span></code></pre><p>Unions require an extra <code>__resolveType</code> field in the resolver map to determine which type the union should resolve to. Also, note that the <code>ResultUnionResolver</code> class has to be registered as a provider in any module. Let's create a <code>ResultUnionResolver</code> class and define the <code>__resolveType</code> method.<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Resolver</span></span><span class="token punctuation">(</span><span class="token string">'ResultUnion'</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">ResultUnionResolver</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ResolveField</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">__resolveType</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token string">'Author'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token string">'Book'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> All decorators are exported from the <code>@nestjs/graphql</code> package.</blockquote></section></section><section id="enums"class="level3"><h3>Enums</h3><p>Enumeration types are a special kind of scalar that is restricted to a particular set of allowed values (read more <a href="https://graphql.org/learn/schema/#enumeration-types">here</a>). This allows you to:<ul><li>validate that any arguments of this type are one of the allowed values<li>communicate through the type system that a field will always be one of a finite set of values</ul><section id="code-first-1"class="level4"><h4>Code first</h4><p>When using the code first approach, you define a GraphQL enum type by simply creating a TypeScript enum.<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">enum</span> <span class="token maybe-class-name">AllowedColor</span> <span class="token punctuation">{</span>
  <span class="token constant">RED</span><span class="token punctuation">,</span>
  <span class="token constant">GREEN</span><span class="token punctuation">,</span>
  <span class="token constant">BLUE</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre><p>With this in place, register the <code>AllowedColor</code> enum using the <code>registerEnumType</code> function exported from the <code>@nestjs/graphql</code> package:<pre class="language-typescript"><code class="language-typescript"><span class="token function">registerEnumType</span><span class="token punctuation">(</span><span class="token maybe-class-name">AllowedColor</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'AllowedColor'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Now you can reference the <code>AllowedColor</code> in our types:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Field</span></span><span class="token punctuation">(</span>type <span class="token arrow operator">=></span> <span class="token maybe-class-name">AllowedColor</span><span class="token punctuation">)</span>
favoriteColor<span class="token operator">:</span> <span class="token maybe-class-name">AllowedColor</span><span class="token punctuation">;</span></code></pre><p>This will result in generating the following part of the GraphQL schema in SDL:<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">enum</span> <span class="token class-name">AllowedColor</span> <span class="token punctuation">{</span>
  <span class="token constant">RED</span>
  <span class="token constant">GREEN</span>
  <span class="token constant">BLUE</span>
<span class="token punctuation">}</span></code></pre><p>To provide a description for the enum, pass the <code>description</code> property into the <code>registerEnumType()</code> function.<pre class="language-typescript"><code class="language-typescript"><span class="token function">registerEnumType</span><span class="token punctuation">(</span><span class="token maybe-class-name">AllowedColor</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'AllowedColor'</span><span class="token punctuation">,</span>
  description<span class="token operator">:</span> <span class="token string">'The supported colors.'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To provide a description for the enum values, or to mark a value as deprecated, pass the <code>valuesMap</code> property, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token function">registerEnumType</span><span class="token punctuation">(</span><span class="token maybe-class-name">AllowedColor</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'AllowedColor'</span><span class="token punctuation">,</span>
  description<span class="token operator">:</span> <span class="token string">'The supported colors.'</span><span class="token punctuation">,</span>
  valuesMap<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token constant">RED</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      description<span class="token operator">:</span> <span class="token string">'The default color.'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token constant">BLUE</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      deprecationReason<span class="token operator">:</span> <span class="token string">'Too blue.'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>This will generate the following GraphQL schema in SDL:<pre class="language-graphql"><code class="language-graphql"><span class="token description string">"""<span class="token language-markdown">
The supported colors.
</span>"""</span>
<span class="token keyword">enum</span> <span class="token class-name">AllowedColor</span> <span class="token punctuation">{</span>
  <span class="token description string">"""<span class="token language-markdown">
  The default color.
  </span>"""</span>
  <span class="token constant">RED</span>
  <span class="token constant">GREEN</span>
  <span class="token constant">BLUE</span> <span class="token directive function">@deprecated</span><span class="token punctuation">(</span><span class="token attr-name">reason</span><span class="token punctuation">:</span> <span class="token string">"Too blue."</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></section><section id="schema-first-1"class="level4"><h4>Schema first</h4><p>To define an enumerator in the schema first approach, simply create a GraphQL enum with SDL.<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">enum</span> <span class="token class-name">AllowedColor</span> <span class="token punctuation">{</span>
  <span class="token constant">RED</span>
  <span class="token constant">GREEN</span>
  <span class="token constant">BLUE</span>
<span class="token punctuation">}</span></code></pre><p>Then you can use the typings generation feature (as shown in the <a href="/graphql/quick-start">quick start</a> chapter) to generate corresponding TypeScript definitions:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">enum</span> <span class="token maybe-class-name">AllowedColor</span> <span class="token punctuation">{</span>
  <span class="token constant">RED</span>
  <span class="token constant">GREEN</span>
  <span class="token constant">BLUE</span>
<span class="token punctuation">}</span></code></pre><p>Sometimes a backend forces a different value for an enum internally than in the public API. In this example the API contains <code>RED</code>, however in resolvers we may use <code>#f00</code> instead (read more <a href="https://www.apollographql.com/docs/apollo-server/schema/scalars-enums/#internal-values">here</a>). To accomplish this, declare a resolver object for the <code>AllowedColor</code> enum:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">const</span> allowedColorResolver<span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token keyword">keyof</span> <span class="token keyword">typeof</span> <span class="token maybe-class-name">AllowedColor</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">RED</span><span class="token operator">:</span> <span class="token string">'#f00'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><blockquote><p>info <strong>Hint</strong> All decorators are exported from the <code>@nestjs/graphql</code> package.</blockquote><p>Then use this resolver object together with the <code>resolvers</code> property of the <code>GraphQLModule#forRoot()</code> method, as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  resolvers<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token maybe-class-name">AllowedColor</span><span class="token operator">:</span> allowedColorResolver<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>