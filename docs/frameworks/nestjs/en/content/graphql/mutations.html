<!doctype html><html lang="en"><meta charset="utf-8"><title>Mutations</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="mutations"class="level3"><h3>Mutations</h3><p>Most discussions of GraphQL focus on data fetching, but any complete data platform needs a way to modify server-side data as well. In REST, any request could end up causing side-effects on the server, but best practice suggests we should not modify data in GET requests. GraphQL is similar - technically any query could be implemented to cause a data write. However, like REST, it's recommended to observe the convention that any operations that cause writes should be sent explicitly via a mutation (read more <a href="https://graphql.org/learn/queries/#mutations">here</a>).<p>The official <a href="https://www.apollographql.com/docs/graphql-tools/generate-schema.html">Apollo</a> documentation uses an <code>upvotePost()</code> mutation example. This mutation implements a method to increase a post's <code>votes</code> property value. To create an equivalent mutation in Nest, we'll make use of the <code>@Mutation()</code> decorator.<section id="code-first"class="level4"><h4>Code first</h4><p>Let's add another method to the <code>AuthorResolver</code> used in the previous section (see <a href="/graphql/resolvers">resolvers</a>).<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Mutation</span></span><span class="token punctuation">(</span>returns <span class="token arrow operator">=></span> <span class="token maybe-class-name">Post</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">upvotePost</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Args</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'postId'</span><span class="token punctuation">,</span> <span class="token function-variable function">type</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token maybe-class-name">Int</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> postId<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">postsService</span><span class="token punctuation">.</span><span class="token method function property-access">upvoteById</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> postId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> All decorators (e.g., <code>@Resolver</code>, <code>@ResolveField</code>, <code>@Args</code>, etc.) are exported from the <code>@nestjs/graphql</code> package.</blockquote><p>This will result in generating the following part of the GraphQL schema in SDL:<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">type</span> <span class="token class-name">Mutation</span> <span class="token punctuation">{</span>
  <span class="token attr-name">upvotePost</span><span class="token punctuation">(</span><span class="token attr-name">postId</span><span class="token punctuation">:</span> <span class="token scalar">Int</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">Post</span>
<span class="token punctuation">}</span></code></pre><p>The <code>upvotePost()</code> method takes <code>postId</code> (<code>Int</code>) as an argument and returns an updated <code>Post</code> entity. For the reasons explained in the <a href="/graphql/resolvers">resolvers</a> section, we have to explicitly set the expected type.<p>If the mutation needs to take an object as an argument, we can create an <strong>input type</strong>. The input type is a special kind of object type that can be passed in as an argument (read more <a href="https://graphql.org/learn/schema/#input-types">here</a>). To declare an input type, use the <code>@InputType()</code> decorator.<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">InputType</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Field</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/graphql'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">InputType</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">UpvotePostInput</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Field</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  postId<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> The <code>@InputType()</code> decorator takes an options object as an argument, so you can, for example, specify the input type's description. Note that, due to TypeScript's metadata reflection system limitations, you must either use the <code>@Field</code> decorator to manually indicate a type, or use a <a href="/graphql/cli-plugin">CLI plugin</a>.</blockquote><p>We can then use this type in the resolver class:<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Mutation</span></span><span class="token punctuation">(</span>returns <span class="token arrow operator">=></span> <span class="token maybe-class-name">Post</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">upvotePost</span><span class="token punctuation">(</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Args</span></span><span class="token punctuation">(</span><span class="token string">'upvotePostData'</span><span class="token punctuation">)</span> upvotePostData<span class="token operator">:</span> <span class="token maybe-class-name">UpvotePostInput</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></section><section id="schema-first"class="level4"><h4>Schema first</h4><p>Let's extend our <code>AuthorResolver</code> used in the previous section (see <a href="/graphql/resolvers">resolvers</a>).<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Mutation</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">upvotePost</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Args</span></span><span class="token punctuation">(</span><span class="token string">'postId'</span><span class="token punctuation">)</span> postId<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">postsService</span><span class="token punctuation">.</span><span class="token method function property-access">upvoteById</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> postId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Note that we assumed above that the business logic has been moved to the <code>PostsService</code> (querying the post and incrementing its <code>votes</code> property). The logic inside the <code>PostsService</code> class can be as simple or sophisticated as needed. The main point of this example is to show how resolvers can interact with other providers.<p>The last step is to add our mutation to the existing types definition.<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">type</span> <span class="token class-name">Author</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">Int</span><span class="token operator">!</span>
  <span class="token attr-name">firstName</span><span class="token punctuation">:</span> <span class="token scalar">String</span>
  <span class="token attr-name">lastName</span><span class="token punctuation">:</span> <span class="token scalar">String</span>
  <span class="token attr-name">posts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Post</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Post</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">Int</span><span class="token operator">!</span>
  <span class="token attr-name">title</span><span class="token punctuation">:</span> <span class="token scalar">String</span>
  <span class="token attr-name">votes</span><span class="token punctuation">:</span> <span class="token scalar">Int</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span>
  <span class="token attr-name">author</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">Int</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">Author</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Mutation</span> <span class="token punctuation">{</span>
  <span class="token attr-name">upvotePost</span><span class="token punctuation">(</span><span class="token attr-name">postId</span><span class="token punctuation">:</span> <span class="token scalar">Int</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">Post</span>
<span class="token punctuation">}</span></code></pre><p>The <code>upvotePost(postId: Int!): Post</code> mutation is now available to be called as part of our application's GraphQL API. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>