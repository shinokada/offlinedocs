<!doctype html><html lang="en"><meta charset="utf-8"><title>Plugins</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="plugins"class="level3"><h3>Plugins</h3><blockquote><p>warning <strong>Warning</strong> This chapter applies only to the <code>@nestjs/apollo</code> driver.</blockquote><p>Plugins enable you to extend Apollo Server's core functionality by performing custom operations in response to certain events. Currently, these events correspond to individual phases of the GraphQL request lifecycle, and to the startup of Apollo Server itself (read more <a href="https://www.apollographql.com/docs/apollo-server/integrations/plugins/">here</a>). For example, a basic logging plugin might log the GraphQL query string associated with each request that's sent to Apollo Server.<section id="custom-plugins"class="level4"><h4>Custom plugins</h4><p>To create a plugin, declare a class annotated with the <code>@Plugin</code> decorator exported from the <code>@nestjs/apollo</code> package. Also, for better code autocompletion, implement the <code>ApolloServerPlugin</code> interface from the <code>apollo-server-plugin-base</code> package.<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Plugin</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/apollo'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>
  <span class="token maybe-class-name">ApolloServerPlugin</span><span class="token punctuation">,</span>
  <span class="token maybe-class-name">GraphQLRequestListener</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'apollo-server-plugin-base'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Plugin</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">LoggingPlugin</span></span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token maybe-class-name">ApolloServerPlugin</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">requestDidStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">GraphQLRequestListener</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Request started'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">async</span> <span class="token function">willSendResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Will send response'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>With this in place, we can register the <code>LoggingPlugin</code> as a provider.<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">LoggingPlugin</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CommonModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>Nest will automatically instantiate a plugin and apply it to the Apollo Server.</section><section id="using-external-plugins"class="level4"><h4>Using external plugins</h4><p>There are several plugins provided out-of-the-box. To use an existing plugin, simply import it and add it to the <code>plugins</code> array:<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function"><span class="token maybe-class-name">ApolloServerOperationRegistry</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">/* options */</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><blockquote><p>info <strong>Hint</strong> The <code>ApolloServerOperationRegistry</code> plugin is exported from the <code>apollo-server-plugin-operation-registry</code> package. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></blockquote></section></section>