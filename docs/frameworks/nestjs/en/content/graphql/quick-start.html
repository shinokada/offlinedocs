<!doctype html><html lang="en"><meta charset="utf-8"><title>Harnessing the power of TypeScript &#x26; GraphQL</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="harnessing-the-power-of-typescript--graphql"class="level2"><h2>Harnessing the power of TypeScript &#x26; GraphQL</h2><p><a href="https://graphql.org/">GraphQL</a> is a powerful query language for APIs and a runtime for fulfilling those queries with your existing data. It's an elegant approach that solves many problems typically found with REST APIs. For background, we suggest reading this <a href="https://dev-blog.apollodata.com/graphql-vs-rest-5d425123e34b">comparison</a> between GraphQL and REST. GraphQL combined with <a href="https://www.typescriptlang.org/">TypeScript</a> helps you develop better type safety with your GraphQL queries, giving you end-to-end typing.<p>In this chapter, we assume a basic understanding of GraphQL, and focus on how to work with the built-in <code>@nestjs/graphql</code> module. The <code>GraphQLModule</code> can be configured to use <a href="https://www.apollographql.com/">Apollo</a> server (with the <code>@nestjs/apollo</code> driver) and <a href="https://github.com/mercurius-js/mercurius">Mercurius</a> (with the <code>@nestjs/mercurius</code>). We provide official integrations for these proven GraphQL packages to provide a simple way to use GraphQL with Nest. You can also build your own dedicated driver (read more on that <a href="/graphql/other-features#creating-a-custom-driver">here</a>).<section id="installation"class="level4"><h4>Installation</h4><p>Start by installing the required packages:<pre class="language-bash"><code class="language-bash"><span class="token comment"># For Express and Apollo (default)</span>
$ <span class="token function">npm</span> i @nestjs/graphql @nestjs/apollo graphql apollo-server-express

<span class="token comment"># For Fastify and Apollo</span>
<span class="token comment"># npm i @nestjs/graphql @nestjs/apollo graphql apollo-server-fastify</span>

<span class="token comment"># For Fastify and Mercurius</span>
<span class="token comment"># npm i @nestjs/graphql @nestjs/mercurius graphql mercurius fastify</span></code></pre><blockquote><p>warning <strong>Warning</strong> <code>@nestjs/graphql@>=9</code> and <code>@nestjs/apollo^10</code> packages are compatible with <strong>Apollo v3</strong> (check out Apollo Server 3 <a href="https://www.apollographql.com/docs/apollo-server/migration/">migration guide</a> for more details), while <code>@nestjs/graphql@^8</code> only supports <strong>Apollo v2</strong> (e.g., <code>apollo-server-express@2.x.x</code> package).</blockquote></section><section id="overview"class="level4"><h4>Overview</h4><p>Nest offers two ways of building GraphQL applications, the <strong>code first</strong> and the <strong>schema first</strong> methods. You should choose the one that works best for you. Most of the chapters in this GraphQL section are divided into two main parts: one you should follow if you adopt <strong>code first</strong>, and the other to be used if you adopt <strong>schema first</strong>.<p>In the <strong>code first</strong> approach, you use decorators and TypeScript classes to generate the corresponding GraphQL schema. This approach is useful if you prefer to work exclusively with TypeScript and avoid context switching between language syntaxes.<p>In the <strong>schema first</strong> approach, the source of truth is GraphQL SDL (Schema Definition Language) files. SDL is a language-agnostic way to share schema files between different platforms. Nest automatically generates your TypeScript definitions (using either classes or interfaces) based on the GraphQL schemas to reduce the need to write redundant boilerplate code.<p><app-banner-courses-graphql-cf></app-banner-courses-graphql-cf></section><section id="getting-started-with-graphql--typescript"class="level4"><h4>Getting started with GraphQL &#x26; TypeScript</h4><blockquote><p>info <strong>Hint</strong> In the following chapters, we'll be integrating the <code>@nestjs/apollo</code> package. If you want to use <code>mercurius</code> package instead, navigate to <a href="/graphql/quick-start#mercurius-integration">this section</a>.</blockquote><p>Once the packages are installed, we can import the <code>GraphQLModule</code> and configure it with the <code>forRoot()</code> static method.<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Module</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">GraphQLModule</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/graphql'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">ApolloDriver</span><span class="token punctuation">,</span> <span class="token maybe-class-name">ApolloDriverConfig</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/apollo'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">forRoot</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ApolloDriverConfig</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      driver<span class="token operator">:</span> <span class="token maybe-class-name">ApolloDriver</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> For <code>mercurius</code> integration, you should be using the <code>MercuriusDriver</code> and <code>MercuriusDriverConfig</code> instead. Both are exported from the <code>@nestjs/mercurius</code> package.</blockquote><p>The <code>forRoot()</code> method takes an options object as an argument. These options are passed through to the underlying driver instance (read more about available settings here: <a href="https://www.apollographql.com/docs/apollo-server/v2/api/apollo-server.html#constructor-options-lt-ApolloServer-gt">Apollo</a> and <a href="https://github.com/mercurius-js/mercurius/blob/master/docs/api/options.md#plugin-options">Mercurius</a>). For example, if you want to disable the <code>playground</code> and turn off <code>debug</code> mode (for Apollo), pass the following options:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Module</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">GraphQLModule</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/graphql'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">ApolloDriver</span><span class="token punctuation">,</span> <span class="token maybe-class-name">ApolloDriverConfig</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/apollo'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">forRoot</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ApolloDriverConfig</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      driver<span class="token operator">:</span> <span class="token maybe-class-name">ApolloDriver</span><span class="token punctuation">,</span>
      debug<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      playground<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>In this case, these options will be forwarded to the <code>ApolloServer</code> constructor.</section><section id="graphql-playground"class="level4"><h4>GraphQL playground</h4><p>The playground is a graphical, interactive, in-browser GraphQL IDE, available by default on the same URL as the GraphQL server itself. To access the playground, you need a basic GraphQL server configured and running. To see it now, you can install and build the <a href="https://github.com/nestjs/nest/tree/master/sample/23-graphql-code-first">working example here</a>. Alternatively, if you're following along with these code samples, once you've completed the steps in the <a href="/graphql/resolvers-map">Resolvers chapter</a>, you can access the playground.<p>With that in place, and with your application running in the background, you can then open your web browser and navigate to <code>http://localhost:3000/graphql</code> (host and port may vary depending on your configuration). You will then see the GraphQL playground, as shown below.<figure><img src="/Users/shinichiokada/Bash_Projects/markdown-docs-as-pdf/.vivliostyle/nestjs/en/src/assets/playground.png"alt=""></figure><blockquote><p>warning <strong>Note</strong> <code>@nestjs/mercurius</code> integration does not ship with the built-in GraphQL Playground integration. Instead, you can use <a href="https://github.com/graphql/graphiql">GraphiQL</a> (set <code>graphiql: true</code>).</blockquote></section><section id="multiple-endpoints"class="level4"><h4>Multiple endpoints</h4><p>Another useful feature of the <code>@nestjs/graphql</code> module is the ability to serve multiple endpoints at once. This lets you decide which modules should be included in which endpoint. By default, <code>GraphQL</code> searches for resolvers throughout the whole app. To limit this scan to only a subset of modules, use the <code>include</code> property.<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token method function property-access">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">CatsModule</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><blockquote><p>warning <strong>Warning</strong> If you use the <code>apollo-server-fastify</code> package with multiple GraphQL endpoints in a single application, make sure to enable the <code>disableHealthCheck</code> setting in the <code>GraphQLModule</code> configuration.</blockquote></section><section id="code-first"class="level4"><h4>Code first</h4><p>In the <strong>code first</strong> approach, you use decorators and TypeScript classes to generate the corresponding GraphQL schema.<p>To use the code first approach, start by adding the <code>autoSchemaFile</code> property to the options object:<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">forRoot</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ApolloDriverConfig</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  driver<span class="token operator">:</span> <span class="token maybe-class-name">ApolloDriver</span><span class="token punctuation">,</span>
  autoSchemaFile<span class="token operator">:</span> <span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token method function property-access">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'src/schema.gql'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><p>The <code>autoSchemaFile</code> property value is the path where your automatically generated schema will be created. Alternatively, the schema can be generated on-the-fly in memory. To enable this, set the <code>autoSchemaFile</code> property to <code>true</code>:<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">forRoot</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ApolloDriverConfig</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  driver<span class="token operator">:</span> <span class="token maybe-class-name">ApolloDriver</span><span class="token punctuation">,</span>
  autoSchemaFile<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><p>By default, the types in the generated schema will be in the order they are defined in the included modules. To sort the schema lexicographically, set the <code>sortSchema</code> property to <code>true</code>:<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">forRoot</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ApolloDriverConfig</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  driver<span class="token operator">:</span> <span class="token maybe-class-name">ApolloDriver</span><span class="token punctuation">,</span>
  autoSchemaFile<span class="token operator">:</span> <span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token method function property-access">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'src/schema.gql'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  sortSchema<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre></section><section id="example"class="level4"><h4>Example</h4><p>A fully working code first sample is available <a href="https://github.com/nestjs/nest/tree/master/sample/23-graphql-code-first">here</a>.</section><section id="schema-first"class="level4"><h4>Schema first</h4><p>To use the schema first approach, start by adding a <code>typePaths</code> property to the options object. The <code>typePaths</code> property indicates where the <code>GraphQLModule</code> should look for GraphQL SDL schema definition files you'll be writing. These files will be combined in memory; this allows you to split your schemas into several files and locate them near their resolvers.<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">forRoot</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ApolloDriverConfig</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  driver<span class="token operator">:</span> <span class="token maybe-class-name">ApolloDriver</span><span class="token punctuation">,</span>
  typePaths<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./**/*.graphql'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><p>You will typically also need to have TypeScript definitions (classes and interfaces) that correspond to the GraphQL SDL types. Creating the corresponding TypeScript definitions by hand is redundant and tedious. It leaves us without a single source of truth -- each change made within SDL forces us to adjust TypeScript definitions as well. To address this, the <code>@nestjs/graphql</code> package can <strong>automatically generate</strong> TypeScript definitions from the abstract syntax tree (<a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">AST</a>). To enable this feature, add the <code>definitions</code> options property when configuring the <code>GraphQLModule</code>.<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">forRoot</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ApolloDriverConfig</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  driver<span class="token operator">:</span> <span class="token maybe-class-name">ApolloDriver</span><span class="token punctuation">,</span>
  typePaths<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./**/*.graphql'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  definitions<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token method function property-access">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'src/graphql.ts'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><p>The path property of the <code>definitions</code> object indicates where to save generated TypeScript output. By default, all generated TypeScript types are created as interfaces. To generate classes instead, specify the <code>outputAs</code> property with a value of <code>'class'</code>.<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">forRoot</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ApolloDriverConfig</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  driver<span class="token operator">:</span> <span class="token maybe-class-name">ApolloDriver</span><span class="token punctuation">,</span>
  typePaths<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./**/*.graphql'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  definitions<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token method function property-access">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'src/graphql.ts'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    outputAs<span class="token operator">:</span> <span class="token string">'class'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><p>The above approach dynamically generates TypeScript definitions each time the application starts. Alternatively, it may be preferable to build a simple script to generate these on demand. For example, assume we create the following script as <code>generate-typings.ts</code>:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">GraphQLDefinitionsFactory</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/graphql'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> join <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> definitionsFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">GraphQLDefinitionsFactory</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
definitionsFactory<span class="token punctuation">.</span><span class="token method function property-access">generate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  typePaths<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./src/**/*.graphql'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  path<span class="token operator">:</span> <span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token method function property-access">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'src/graphql.ts'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  outputAs<span class="token operator">:</span> <span class="token string">'class'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Now you can run this script on demand:<pre class="language-bash"><code class="language-bash">$ ts-node generate-typings</code></pre><blockquote><p>info <strong>Hint</strong> You can compile the script beforehand (e.g., with <code>tsc</code>) and use <code>node</code> to execute it.</blockquote><p>To enable watch mode for the script (to automatically generate typings whenever any <code>.graphql</code> file changes), pass the <code>watch</code> option to the <code>generate()</code> method.<pre class="language-typescript"><code class="language-typescript">definitionsFactory<span class="token punctuation">.</span><span class="token method function property-access">generate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  typePaths<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./src/**/*.graphql'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  path<span class="token operator">:</span> <span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token method function property-access">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'src/graphql.ts'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  outputAs<span class="token operator">:</span> <span class="token string">'class'</span><span class="token punctuation">,</span>
  watch<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To automatically generate the additional <code>__typename</code> field for every object type, enable the <code>emitTypenameField</code> option.<pre class="language-typescript"><code class="language-typescript">definitionsFactory<span class="token punctuation">.</span><span class="token method function property-access">generate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...,</span>
  emitTypenameField<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To generate resolvers (queries, mutations, subscriptions) as plain fields without arguments, enable the <code>skipResolverArgs</code> option.<pre class="language-typescript"><code class="language-typescript">definitionsFactory<span class="token punctuation">.</span><span class="token method function property-access">generate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...,</span>
  skipResolverArgs<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="apollo-sandbox"class="level4"><h4>Apollo Sandbox</h4><p>To use <a href="https://www.apollographql.com/blog/announcement/platform/apollo-sandbox-an-open-graphql-ide-for-local-development/">Apollo Sandbox</a> instead of the <code>graphql-playground</code> as a GraphQL IDE for local development, use the following configuration:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">ApolloDriver</span><span class="token punctuation">,</span> <span class="token maybe-class-name">ApolloDriverConfig</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/apollo'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Module</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">GraphQLModule</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/graphql'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">ApolloServerPluginLandingPageLocalDefault</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'apollo-server-core'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">forRoot</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ApolloDriverConfig</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      driver<span class="token operator">:</span> <span class="token maybe-class-name">ApolloDriver</span><span class="token punctuation">,</span>
      playground<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function"><span class="token maybe-class-name">ApolloServerPluginLandingPageLocalDefault</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></section><section id="example-1"class="level4"><h4>Example</h4><p>A fully working schema first sample is available <a href="https://github.com/nestjs/nest/tree/master/sample/12-graphql-schema-first">here</a>.</section><section id="accessing-generated-schema"class="level4"><h4>Accessing generated schema</h4><p>In some circumstances (for example end-to-end tests), you may want to get a reference to the generated schema object. In end-to-end tests, you can then run queries using the <code>graphql</code> object without using any HTTP listeners.<p>You can access the generated schema (in either the code first or schema first approach), using the <code>GraphQLSchemaHost</code> class:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token punctuation">{</span> schema <span class="token punctuation">}</span> <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token maybe-class-name">GraphQLSchemaHost</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>info <strong>Hint</strong> You must call the <code>GraphQLSchemaHost#schema</code> getter after the application has been initialized (after the <code>onModuleInit</code> hook has been triggered by either the <code>app.listen()</code> or <code>app.init()</code> method).</blockquote></section><section id="async-configuration"class="level4"><h4>Async configuration</h4><p>When you need to pass module options asynchronously instead of statically, use the <code>forRootAsync()</code> method. As with most dynamic modules, Nest provides several techniques to deal with async configuration.<p>One technique is to use a factory function:<pre class="language-typescript"><code class="language-typescript"> <span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">forRootAsync</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ApolloDriverConfig</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  driver<span class="token operator">:</span> <span class="token maybe-class-name">ApolloDriver</span><span class="token punctuation">,</span>
  <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    typePaths<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./**/*.graphql'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><p>Like other factory providers, our factory function can be <a href="https://docs.nestjs.com/fundamentals/custom-providers#factory-providers-usefactory">async</a> and can inject dependencies through <code>inject</code>.<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">forRootAsync</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ApolloDriverConfig</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  driver<span class="token operator">:</span> <span class="token maybe-class-name">ApolloDriver</span><span class="token punctuation">,</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>configService<span class="token operator">:</span> <span class="token maybe-class-name">ConfigService</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    typePaths<span class="token operator">:</span> configService<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'GRAPHQL_TYPE_PATHS'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  inject<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">ConfigService</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><p>Alternatively, you can configure the <code>GraphQLModule</code> using a class instead of a factory, as shown below:<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">forRootAsync</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ApolloDriverConfig</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  driver<span class="token operator">:</span> <span class="token maybe-class-name">ApolloDriver</span><span class="token punctuation">,</span>
  useClass<span class="token operator">:</span> <span class="token maybe-class-name">GqlConfigService</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><p>The construction above instantiates <code>GqlConfigService</code> inside <code>GraphQLModule</code>, using it to create options object. Note that in this example, the <code>GqlConfigService</code> has to implement the <code>GqlOptionsFactory</code> interface, as shown below. The <code>GraphQLModule</code> will call the <code>createGqlOptions()</code> method on the instantiated object of the supplied class.<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">GqlConfigService</span></span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token maybe-class-name">GqlOptionsFactory</span></span> <span class="token punctuation">{</span>
  <span class="token function">createGqlOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">ApolloDriverConfig</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      typePaths<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./**/*.graphql'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>If you want to reuse an existing options provider instead of creating a private copy inside the <code>GraphQLModule</code>, use the <code>useExisting</code> syntax.<pre class="language-typescript"><code class="language-typescript"><span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">forRootAsync</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ApolloDriverConfig</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">ConfigModule</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  useExisting<span class="token operator">:</span> <span class="token maybe-class-name">ConfigService</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre></section><section id="mercurius-integration"class="level4"><h4>Mercurius integration</h4><p>Instead of using Apollo, Fastify users (read more <a href="/techniques/performance">here</a>) can alternatively use the <code>@nestjs/mercurius</code> driver.<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Module</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">GraphQLModule</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/graphql'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">MercuriusDriver</span><span class="token punctuation">,</span> <span class="token maybe-class-name">MercuriusDriverConfig</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/mercurius'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token maybe-class-name">GraphQLModule</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">forRoot</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">MercuriusDriverConfig</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      driver<span class="token operator">:</span> <span class="token maybe-class-name">MercuriusDriver</span><span class="token punctuation">,</span>
      graphiql<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> Once the application is running, open your browser and navigate to <code>http://localhost:3000/graphiql</code>. You should see the <a href="https://github.com/graphql/graphiql">GraphQL IDE</a>.</blockquote><p>The <code>forRoot()</code> method takes an options object as an argument. These options are passed through to the underlying driver instance. Read more about available settings <a href="https://github.com/mercurius-js/mercurius/blob/master/docs/api/options.md#plugin-options">here</a>. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>