<!doctype html><html lang="en"><meta charset="utf-8"><title>Nest Commander</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="nest-commander"class="level3"><h3>Nest Commander</h3><p>Expanding on the <a href="/standalone-applications">standalone application</a> docs there's also the <a href="https://jmcdo29.github.io/nest-commander">nest-commander</a> package for writing command line applications in a structure similar to your typical Nest application.<blockquote><p>info <strong>info</strong> <code>nest-commander</code> is a third party package and is not managed by the entirety of the NestJS core team. Please, report any issues found with the library in the <a href="https://github.com/jmcdo29/nest-commander/issues/new/choose">appropriate repository</a></blockquote><section id="installation"class="level4"><h4>Installation</h4><p>Just like any other package, you've got to install it before you can use it.<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i nest-commander</code></pre></section><section id="a-command-file"class="level4"><h4>A Command file</h4><p><code>nest-commander</code> makes it easy to write new command-line applications with <a href="https://www.typescriptlang.org/docs/handbook/decorators.html">decorators</a> via the <code>@Command()</code> decorator for classes and the <code>@Option()</code> decorator for methods of that class. Every command file should implement the <code>CommandRunner</code> abstract class and should be decorated with a <code>@Command()</code> decorator.<p>Every command is seen as an <code>@Injectable()</code> by Nest, so your normal Dependency Injection still works as you would expect it to. The only thing to take note of is the abstract class <code>CommandRunner</code>, which should be implemented by each command. The <code>CommandRunner</code> abstract class ensures that all commands have a <code>run</code> method that returns a <code>Promise&#x3C;void></code> and takes in the parameters <code>string[], Record&#x3C;string, any></code>. The <code>run</code> command is where you can kick all of your logic off from, it will take in whatever parameters did not match option flags and pass them in as an array, just in case you are really meaning to work with multiple parameters. As for the options, the <code>Record&#x3C;string, any></code>, the names of these properties match the <code>name</code> property given to the <code>@Option()</code> decorators, while their value matches the return of the option handler. If you'd like better type safety, you are welcome to create an interface for your options as well.</section><section id="running-the-command"class="level4"><h4>Running the Command</h4><p>Similar to how in a NestJS application we can use the <code>NestFactory</code> to create a server for us, and run it using <code>listen</code>, the <code>nest-commander</code> package exposes a simple to use API to run your server. Import the <code>CommandFactory</code> and use the <code>static</code> method <code>run</code> and pass in the root module of your application. This would probably look like below<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">CommandFactory</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'nest-commander'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">AppModule</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./app.module'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">CommandFactory</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>By default, Nest's logger is disabled when using the <code>CommandFactory</code>. It's possible to provide it though, as the second argument to the <code>run</code> function. You can either provide a custom NestJS logger, or an array of log levels you want to keep - it might be useful to at least provide <code>['error']</code> here, if you only want to print out Nest's error logs.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">CommandFactory</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'nest-commander'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">AppModule</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./app.module'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">LogService</span> <span class="token punctuation">}</span> <span class="token string">'./log.service'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">CommandFactory</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">LogService</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// or, if you only want to print Nest's warnings and errors</span>
  <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">CommandFactory</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'warn'</span><span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>And that's it. Under the hood, <code>CommandFactory</code> will worry about calling <code>NestFactory</code> for you and calling <code>app.close()</code> when necessary, so you shouldn't need to worry about memory leaks there. If you need to add in some error handling, there's always <code>try/catch</code> wrapping the <code>run</code> command, or you can chain on some <code>.catch()</code> method to the <code>bootstrap()</code> call.</section><section id="testing"class="level4"><h4>Testing</h4><p>So what's the use of writing a super awesome command line script if you can't test it super easily, right? Fortunately, <code>nest-commander</code> has some utilities you can make use of that fits in perfectly with the NestJS ecosystem, it'll feel right at home to any Nestlings out there. Instead of using the <code>CommandFactory</code> for building the command in test mode, you can use <code>CommandTestFactory</code> and pass in your metadata, very similarly to how <code>Test.createTestingModule</code> from <code>@nestjs/testing</code> works. In fact, it uses this package under the hood. You're also still able to chain on the <code>overrideProvider</code> methods before calling <code>compile()</code> so you can swap out DI pieces right in the test.</section><section id="putting-it-all-together"class="level4"><h4>Putting it all together</h4><p>The following class would equate to having a CLI command that can take in the subcommand <code>basic</code> or be called directly, with <code>-n</code>, <code>-s</code>, and <code>-b</code> (along with their long flags) all being supported and with custom parsers for each option. The <code>--help</code> flag is also supported, as is customary with commander.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Command</span><span class="token punctuation">,</span> <span class="token maybe-class-name">CommandRunner</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Option</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'nest-commander'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">LogService</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./log.service'</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">BasicCommandOptions</span></span> <span class="token punctuation">{</span>
  <span class="token builtin">string</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token builtin">boolean</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token builtin">number</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Command</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'basic'</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">'A parameter parse'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">BasicCommand</span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token maybe-class-name">CommandRunner</span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> logService<span class="token operator">:</span> <span class="token maybe-class-name">LogService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">run</span><span class="token punctuation">(</span>
    passedParam<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    options<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">BasicCommandOptions</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>options<span class="token operator">?.</span><span class="token builtin">boolean</span> <span class="token operator">!==</span> <span class="token keyword nil">undefined</span> <span class="token operator">&#x26;&#x26;</span> options<span class="token operator">?.</span><span class="token builtin">boolean</span> <span class="token operator">!==</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">runWithBoolean</span><span class="token punctuation">(</span>passedParam<span class="token punctuation">,</span> options<span class="token punctuation">.</span><span class="token property-access">boolean</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>options<span class="token operator">?.</span><span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">runWithNumber</span><span class="token punctuation">(</span>passedParam<span class="token punctuation">,</span> options<span class="token punctuation">.</span><span class="token property-access">number</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>options<span class="token operator">?.</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">runWithString</span><span class="token punctuation">(</span>passedParam<span class="token punctuation">,</span> options<span class="token punctuation">.</span><span class="token property-access">string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">runWithNone</span><span class="token punctuation">(</span>passedParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Option</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    flags<span class="token operator">:</span> <span class="token string">'-n, --number [number]'</span><span class="token punctuation">,</span>
    description<span class="token operator">:</span> <span class="token string">'A basic number parser'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">parseNumber</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token known-class-name class-name">Number</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Option</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    flags<span class="token operator">:</span> <span class="token string">'-s, --string [string]'</span><span class="token punctuation">,</span>
    description<span class="token operator">:</span> <span class="token string">'A string return'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">parseString</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> val<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Option</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    flags<span class="token operator">:</span> <span class="token string">'-b, --boolean [boolean]'</span><span class="token punctuation">,</span>
    description<span class="token operator">:</span> <span class="token string">'A boolean parser'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">parseBoolean</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">runWithString</span><span class="token punctuation">(</span>param<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> option<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logService</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> param<span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">:</span> option <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">runWithNumber</span><span class="token punctuation">(</span>param<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> option<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logService</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> param<span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token operator">:</span> option <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">runWithBoolean</span><span class="token punctuation">(</span>param<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> option<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logService</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> param<span class="token punctuation">,</span> <span class="token builtin">boolean</span><span class="token operator">:</span> option <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">runWithNone</span><span class="token punctuation">(</span>param<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">logService</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> param <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Make sure the command class is added to a module<pre class="language-ts"><code class="language-ts"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">LogService</span><span class="token punctuation">,</span> <span class="token maybe-class-name">BasicCommand</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>And now to be able to run the CLI in your main.ts you can do the following<pre class="language-ts"><code class="language-ts"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">CommandFactory</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>And just like that, you've got a command line application.</section><section id="more-information"class="level4"><h4>More Information</h4><p>Visit the <a href="https://jmcdo29.github.io/nest-commander">nest-commander docs site</a> for more information, examples, and API documentation. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>