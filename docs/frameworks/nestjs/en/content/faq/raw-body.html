<!doctype html><html lang="en"><meta charset="utf-8"><title>Raw body</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="raw-body"class="level3"><h3>Raw body</h3><p>One of the most common use-case for having access to the raw request body is performing webhook signature verifications. Usually to perform webhook signature validations the unserialized request body is required to calculate an HMAC hash.<blockquote><p>warning <strong>Warning</strong> This feature can be used only if the built-in global body parser middleware is enabled, ie., you must not pass <code>bodyParser: false</code> when creating the app.</blockquote><section id="use-with-express"class="level4"><h4>Use with Express</h4><p>First enable the option when creating your Nest Express application:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">NestFactory</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  rawBody<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To access the raw request body in a controller, a convenience interface <code>RawBodyRequest</code> is provided to expose a <code>rawBody</code> field on the request: use the interface <code>RawBodyRequest</code> type:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Controller</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Post</span><span class="token punctuation">,</span> <span class="token maybe-class-name">RawBodyRequest</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Req</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Request</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'express'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsController</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">create</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Req</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> req<span class="token operator">:</span> <span class="token maybe-class-name">RawBodyRequest</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Request</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> raw <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">rawBody</span><span class="token punctuation">;</span> <span class="token comment">// returns a `Buffer`.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></section><section id="use-with-fastify"class="level4"><h4>Use with Fastify</h4><p>First enable the option when creating your Nest Fastify application:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">NestFactory</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">create</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">NestFastifyApplication</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
  <span class="token maybe-class-name">AppModule</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">FastifyAdapter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    rawBody<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To access the raw request body in a controller, a convenience interface <code>RawBodyRequest</code> is provided to expose a <code>rawBody</code> field on the request: use the interface <code>RawBodyRequest</code> type:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Controller</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Post</span><span class="token punctuation">,</span> <span class="token maybe-class-name">RawBodyRequest</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Req</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">FastifyRequest</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'fastify'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsController</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">create</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Req</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> req<span class="token operator">:</span> <span class="token maybe-class-name">RawBodyRequest</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">FastifyRequest</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> raw <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">rawBody</span><span class="token punctuation">;</span> <span class="token comment">// returns a `Buffer`.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>