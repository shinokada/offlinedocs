<!doctype html><html lang="en"><meta charset="utf-8"><title>Common errors</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="common-errors"class="level3"><h3>Common errors</h3><p>During your development with NestJS, you may encounter various errors as you learn the framework.<section id="cannot-resolve-dependency-error"class="level4"><h4>"Cannot resolve dependency" error</h4><p>Probably the most common error message is about Nest not being able to resolve dependencies of a provider. The error message usually looks something like this:<pre class="language-bash"><code class="language-bash">Nest can't resolve dependencies of the <span class="token operator">&#x3C;</span>provider<span class="token operator">></span> <span class="token punctuation">(</span>?<span class="token punctuation">)</span>. Please <span class="token function">make</span> sure that the argument <span class="token operator">&#x3C;</span>unknown_token<span class="token operator">></span> at index <span class="token punctuation">[</span><span class="token operator">&#x3C;</span>index<span class="token operator">></span><span class="token punctuation">]</span> is available <span class="token keyword">in</span> the <span class="token operator">&#x3C;</span>module<span class="token operator">></span> context.

Potential solutions:
- If <span class="token operator">&#x3C;</span>unknown_token<span class="token operator">></span> is a provider, is it part of the current <span class="token operator">&#x3C;</span>module<span class="token operator">></span>?
- If <span class="token operator">&#x3C;</span>unknown_token<span class="token operator">></span> is exported from a separate @Module, is that module imported within <span class="token operator">&#x3C;</span>module<span class="token operator">></span>?
  @Module<span class="token punctuation">(</span><span class="token punctuation">{</span>
    imports: <span class="token punctuation">[</span> /* the Module containing <span class="token operator">&#x3C;</span>unknown_token<span class="token operator">></span> */ <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>The most common culprit of the error, is not having the <code>&#x3C;provider></code> in the module's <code>providers</code> array. Please make sure that the provider is indeed in the <code>providers</code> array and following <a href="/fundamentals/custom-providers#di-fundamentals">standard NestJS provider practices</a>.<p>There are a few gotchas, that are common. One is putting a provider in an <code>imports</code> array. If this is the case, the error will have the provider's name where <code>&#x3C;module></code> should be.<p>If you run across this error while developing, take a look at the module mentioned in the error message and look at its <code>providers</code>. For each provider in the <code>providers</code> array, make sure the module has access to all of the dependencies. Often times, <code>providers</code> are duplicated in a "Feature Module" and a "Root Module" which means Nest will try to instantiate the provider twice. More than likely, the module containing the <code>&#x3C;provider></code> being duplicated should be added in the "Root Module"'s <code>imports</code> array instead.<p>If the <code>&#x3C;unknown_token></code> above is the string <code>dependency</code>, you might have a circular file import. This is different from the <a href="/faq/common-errors#circular-dependency-error">circular dependency</a> below because instead of having providers depend on each other in their constructors, it just means that two files end up importing each other. A common case would be a module file declaring a token and importing a provider, and the provider import the token constant from the module file. If you are using barrel files, ensure that your barrel imports do not end up creating these circular imports as well.<p>If the <code>&#x3C;unknown_token></code> above is the string <code>Object</code>, it means that you're injecting using an type/interface without a proper provider's token. To fix that, make sure you're importing the class reference or use a custom token with <code>@Inject()</code> decorator. Read the <a href="/fundamentals/custom-providers">custom providers page</a>.<p>Also, make sure you didn't end up injecting the provider on itself because self-injections are not allowed in NestJS. When this happens, <code>&#x3C;unknown_token></code> will likely be equal to <code>&#x3C;provider></code>.<p>If you are in a <strong>monorepo setup</strong>, you may face the same error as above but for core provider called <code>ModuleRef</code> as a <code>&#x3C;unknown_token></code>:<pre class="language-bash"><code class="language-bash">Nest can't resolve dependencies of the <span class="token operator">&#x3C;</span>provider<span class="token operator">></span> <span class="token punctuation">(</span>?<span class="token punctuation">)</span>.
Please <span class="token function">make</span> sure that the argument ModuleRef at index <span class="token punctuation">[</span><span class="token operator">&#x3C;</span>index<span class="token operator">></span><span class="token punctuation">]</span> is available <span class="token keyword">in</span> the <span class="token operator">&#x3C;</span>module<span class="token operator">></span> context.
<span class="token punctuation">..</span>.</code></pre><p>This likely happens when your project end up loading two Node modules of the package <code>@nestjs/core</code>, like this:<pre class="language-text"><code class="language-text">.
├── package.json
├── apps
│   └── api
│       └── node_modules
│           └── @nestjs/bull
│               └── node_modules
│                   └── @nestjs/core
└── node_modules
    ├── (other packages)
    └── @nestjs/core</code></pre><p>Solutions:<ul><li>For <strong>Yarn</strong> Workspaces, use the <a href="https://classic.yarnpkg.com/blog/2018/02/15/nohoist">nohoist feature</a> to prevent hoisting the package <code>@nestjs/core</code>.</ul></section><section id="circular-dependency-error"class="level4"><h4>"Circular dependency" error</h4><p>Occasionally you'll find it difficult to avoid <a href="https://docs.nestjs.com/fundamentals/circular-dependency">circular dependencies</a> in your application. You'll need to take some steps to help Nest resolve these. Errors that arise from circular dependencies look like this:<pre class="language-bash"><code class="language-bash">Nest cannot create the <span class="token operator">&#x3C;</span>module<span class="token operator">></span> instance.
The module at index <span class="token punctuation">[</span><span class="token operator">&#x3C;</span>index<span class="token operator">></span><span class="token punctuation">]</span> of the <span class="token operator">&#x3C;</span>module<span class="token operator">></span> <span class="token string">"imports"</span> array is undefined.

Potential causes:
- A circular dependency between modules. Use forwardRef<span class="token punctuation">(</span><span class="token punctuation">)</span> to avoid it. Read more: https://docs.nestjs.com/fundamentals/circular-dependency
- The module at index <span class="token punctuation">[</span><span class="token operator">&#x3C;</span>index<span class="token operator">></span><span class="token punctuation">]</span> is of <span class="token builtin class-name">type</span> <span class="token string">"undefined"</span><span class="token builtin class-name">.</span> Check your <span class="token function">import</span> statements and the <span class="token builtin class-name">type</span> of the module.

Scope <span class="token punctuation">[</span><span class="token operator">&#x3C;</span>module_import_chain<span class="token operator">></span><span class="token punctuation">]</span>
<span class="token comment"># example chain AppModule -> FooModule</span></code></pre><p>Circular dependencies can arise from both providers depending on each other, or typescript files depending on each other for constants, such as exporting constants from a module file and importing them in a service file. In the latter case, it is advised to create a separate file for your constants. In the former case, please follow the guide on circular dependencies and make sure that both the modules <strong>and</strong> the providers are marked with <code>forwardRef</code>.</section><section id="debugging-dependency-errors"class="level4"><h4>Debugging dependency errors</h4><p>Along with just manually verifying your dependencies are correct, as of Nest 8.1.0 you can set the <code>NEST_DEBUG</code> environment variable to a string that resolves as truthy, and get extra logging information while Nest is resolving all of the dependencies for the application.<figure><img src="/Users/shinichiokada/Bash_Projects/markdown-docs-as-pdf/.vivliostyle/nestjs/en/src/assets/injector_logs.png"></figure><p>In the above image, the string in yellow is the host class of the dependency being injected, the string in blue is the name of the injected dependency, or its injection token, and the string in purple is the module in which the dependency is being searched for. Using this, you can usually trace back the dependency resolution for what's happening and why you're getting dependency injection problems. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>