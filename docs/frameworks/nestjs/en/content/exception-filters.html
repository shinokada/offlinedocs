<!doctype html><html lang="en"><meta charset="utf-8"><title>Exception filters</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="exception-filters"class="level3"><h3>Exception filters</h3><p>Nest comes with a built-in <strong>exceptions layer</strong> which is responsible for processing all unhandled exceptions across an application. When an exception is not handled by your application code, it is caught by this layer, which then automatically sends an appropriate user-friendly response.<figure><img src="/Users/shinichiokada/Bash_Projects/markdown-docs-as-pdf/.vivliostyle/nestjs/en/src/assets/Filter_1.png"></figure><p>Out of the box, this action is performed by a built-in <strong>global exception filter</strong>, which handles exceptions of type <code>HttpException</code> (and subclasses of it). When an exception is <strong>unrecognized</strong> (is neither <code>HttpException</code> nor a class that inherits from <code>HttpException</code>), the built-in exception filter generates the following default JSON response:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"statusCode"</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"Internal server error"</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> The global exception filter partially supports the <code>http-errors</code> library. Basically, any thrown exception containing the <code>statusCode</code> and <code>message</code> property will be properly populated and send back as a response (instead of the default <code>InternalServerErrorException</code> for unrecognized exceptions).</blockquote><section id="throwing-standard-exceptions"class="level4"><h4>Throwing standard exceptions</h4><p>Nest provides a built-in <code>HttpException</code> class, exposed from the <code>@nestjs/common</code> package. For typical HTTP REST/GraphQL API based applications, it's best practice to send standard HTTP response objects when certain error conditions occur.<p>For example, in the <code>CatsController</code>, we have a <code>findAll()</code> method (a <code>GET</code> route handler). Let's assume that this route handler throws an exception for some reason. To demonstrate this, we'll hard-code it as follows:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>cats<span class="token punctuation">.</span><span class="token property-access">controller</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">HttpException</span></span><span class="token punctuation">(</span><span class="token string">'Forbidden'</span><span class="token punctuation">,</span> <span class="token maybe-class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">FORBIDDEN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> We used the <code>HttpStatus</code> here. This is a helper enum imported from the <code>@nestjs/common</code> package.</blockquote><p>When the client calls this endpoint, the response looks like this:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"statusCode"</span><span class="token operator">:</span> <span class="token number">403</span><span class="token punctuation">,</span>
  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"Forbidden"</span>
<span class="token punctuation">}</span></code></pre><p>The <code>HttpException</code> constructor takes two required arguments which determine the response:<ul><li>The <code>response</code> argument defines the JSON response body. It can be a <code>string</code> or an <code>object</code> as described below.<li>The <code>status</code> argument defines the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">HTTP status code</a>.</ul><p>By default, the JSON response body contains two properties:<ul><li><code>statusCode</code>: defaults to the HTTP status code provided in the <code>status</code> argument<li><code>message</code>: a short description of the HTTP error based on the <code>status</code></ul><p>To override just the message portion of the JSON response body, supply a string in the <code>response</code> argument. To override the entire JSON response body, pass an object in the <code>response</code> argument. Nest will serialize the object and return it as the JSON response body.<p>The second constructor argument - <code>status</code> - should be a valid HTTP status code. Best practice is to use the <code>HttpStatus</code> enum imported from <code>@nestjs/common</code>.<p>There is a <strong>third</strong> constructor argument (optional) - <code>options</code> - that can be used to provide an error <a href="https://nodejs.org/en/blog/release/v16.9.0/#error-cause">cause</a>. This <code>cause</code> object is not serialized into the response object, but it can be useful for logging purposes, providing valuable information about the inner error that caused the <code>HttpException</code> to be thrown.<p>Here's an example overriding the entire response body and providing an error cause:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>cats<span class="token punctuation">.</span><span class="token property-access">controller</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">service</span><span class="token punctuation">.</span><span class="token method function property-access">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">HttpException</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      status<span class="token operator">:</span> <span class="token maybe-class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">FORBIDDEN</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token string">'This is a custom message'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token maybe-class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">FORBIDDEN</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      cause<span class="token operator">:</span> error
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Using the above, this is how the response would look:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"status"</span><span class="token operator">:</span> <span class="token number">403</span><span class="token punctuation">,</span>
  <span class="token property">"error"</span><span class="token operator">:</span> <span class="token string">"This is a custom message"</span>
<span class="token punctuation">}</span></code></pre></section><section id="custom-exceptions"class="level4"><h4>Custom exceptions</h4><p>In many cases, you will not need to write custom exceptions, and can use the built-in Nest HTTP exception, as described in the next section. If you do need to create customized exceptions, it's good practice to create your own <strong>exceptions hierarchy</strong>, where your custom exceptions inherit from the base <code>HttpException</code> class. With this approach, Nest will recognize your exceptions, and automatically take care of the error responses. Let's implement such a custom exception:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>forbidden<span class="token punctuation">.</span><span class="token property-access">exception</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">ForbiddenException</span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token maybe-class-name">HttpException</span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">'Forbidden'</span><span class="token punctuation">,</span> <span class="token maybe-class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">FORBIDDEN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Since <code>ForbiddenException</code> extends the base <code>HttpException</code>, it will work seamlessly with the built-in exception handler, and therefore we can use it inside the <code>findAll()</code> method.<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>cats<span class="token punctuation">.</span><span class="token property-access">controller</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">ForbiddenException</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section><section id="built-in-http-exceptions"class="level4"><h4>Built-in HTTP exceptions</h4><p>Nest provides a set of standard exceptions that inherit from the base <code>HttpException</code>. These are exposed from the <code>@nestjs/common</code> package, and represent many of the most common HTTP exceptions:<ul><li><code>BadRequestException</code><li><code>UnauthorizedException</code><li><code>NotFoundException</code><li><code>ForbiddenException</code><li><code>NotAcceptableException</code><li><code>RequestTimeoutException</code><li><code>ConflictException</code><li><code>GoneException</code><li><code>HttpVersionNotSupportedException</code><li><code>PayloadTooLargeException</code><li><code>UnsupportedMediaTypeException</code><li><code>UnprocessableEntityException</code><li><code>InternalServerErrorException</code><li><code>NotImplementedException</code><li><code>ImATeapotException</code><li><code>MethodNotAllowedException</code><li><code>BadGatewayException</code><li><code>ServiceUnavailableException</code><li><code>GatewayTimeoutException</code><li><code>PreconditionFailedException</code></ul><p>All the built-in exceptions can also provide both an error <code>cause</code> and an error description using the <code>options</code> parameter:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">BadRequestException</span></span><span class="token punctuation">(</span><span class="token string">'Something bad happened'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> cause<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Error</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">'Some error description'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Using the above, this is how the response would look:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"Something bad happened"</span><span class="token punctuation">,</span>
  <span class="token property">"error"</span><span class="token operator">:</span> <span class="token string">"Some error description"</span><span class="token punctuation">,</span>
  <span class="token property">"statusCode"</span><span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></section><section id="exception-filters-1"class="level4"><h4>Exception filters</h4><p>While the base (built-in) exception filter can automatically handle many cases for you, you may want <strong>full control</strong> over the exceptions layer. For example, you may want to add logging or use a different JSON schema based on some dynamic factors. <strong>Exception filters</strong> are designed for exactly this purpose. They let you control the exact flow of control and the content of the response sent back to the client.<p>Let's create an exception filter that is responsible for catching exceptions which are an instance of the <code>HttpException</code> class, and implementing custom response logic for them. To do this, we'll need to access the underlying platform <code>Request</code> and <code>Response</code> objects. We'll access the <code>Request</code> object so we can pull out the original <code>url</code> and include that in the logging information. We'll use the <code>Response</code> object to take direct control of the response that is sent, using the <code>response.json()</code> method.<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>http<span class="token operator">-</span>exception<span class="token punctuation">.</span><span class="token property-access">filter</span><span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">ExceptionFilter</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Catch</span><span class="token punctuation">,</span> <span class="token maybe-class-name">ArgumentsHost</span><span class="token punctuation">,</span> <span class="token maybe-class-name">HttpException</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Request</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Response</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'express'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Catch</span></span><span class="token punctuation">(</span><span class="token maybe-class-name">HttpException</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">HttpExceptionFilter</span></span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token maybe-class-name">ExceptionFilter</span></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>exception<span class="token operator">:</span> <span class="token maybe-class-name">HttpException</span><span class="token punctuation">,</span> host<span class="token operator">:</span> <span class="token maybe-class-name">ArgumentsHost</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ctx <span class="token operator">=</span> host<span class="token punctuation">.</span><span class="token method function property-access">switchToHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">getResponse</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Response</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> request <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">getRequest</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Request</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> status <span class="token operator">=</span> exception<span class="token punctuation">.</span><span class="token method function property-access">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    response
      <span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        statusCode<span class="token operator">:</span> status<span class="token punctuation">,</span>
        timestamp<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Date</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> request<span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
@@<span class="token keyword control-flow">switch</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Catch</span><span class="token punctuation">,</span> <span class="token maybe-class-name">HttpException</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Catch</span></span><span class="token punctuation">(</span><span class="token maybe-class-name">HttpException</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">HttpExceptionFilter</span></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>exception<span class="token punctuation">,</span> host<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ctx <span class="token operator">=</span> host<span class="token punctuation">.</span><span class="token method function property-access">switchToHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token method function property-access">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> request <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token method function property-access">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> status <span class="token operator">=</span> exception<span class="token punctuation">.</span><span class="token method function property-access">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    response
      <span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        statusCode<span class="token operator">:</span> status<span class="token punctuation">,</span>
        timestamp<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Date</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> request<span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> All exception filters should implement the generic <code>ExceptionFilter&#x3C;T></code> interface. This requires you to provide the <code>catch(exception: T, host: ArgumentsHost)</code> method with its indicated signature. <code>T</code> indicates the type of the exception.</blockquote><p>The <code>@Catch(HttpException)</code> decorator binds the required metadata to the exception filter, telling Nest that this particular filter is looking for exceptions of type <code>HttpException</code> and nothing else. The <code>@Catch()</code> decorator may take a single parameter, or a comma-separated list. This lets you set up the filter for several types of exceptions at once.</section><section id="arguments-host"class="level4"><h4>Arguments host</h4><p>Let's look at the parameters of the <code>catch()</code> method. The <code>exception</code> parameter is the exception object currently being processed. The <code>host</code> parameter is an <code>ArgumentsHost</code> object. <code>ArgumentsHost</code> is a powerful utility object that we'll examine further in the <a href="/fundamentals/execution-context">execution context chapter</a>*. In this code sample, we use it to obtain a reference to the <code>Request</code> and <code>Response</code> objects that are being passed to the original request handler (in the controller where the exception originates). In this code sample, we've used some helper methods on <code>ArgumentsHost</code> to get the desired <code>Request</code> and <code>Response</code> objects. Learn more about <code>ArgumentsHost</code> <a href="/fundamentals/execution-context">here</a>.<p>*The reason for this level of abstraction is that <code>ArgumentsHost</code> functions in all contexts (e.g., the HTTP server context we're working with now, but also Microservices and WebSockets). In the execution context chapter we'll see how we can access the appropriate <a href="https://docs.nestjs.com/fundamentals/execution-context#host-methods">underlying arguments</a> for <strong>any</strong> execution context with the power of <code>ArgumentsHost</code> and its helper functions. This will allow us to write generic exception filters that operate across all contexts.<p><app-banner-courses></app-banner-courses></section><section id="binding-filters"class="level4"><h4>Binding filters</h4><p>Let's tie our new <code>HttpExceptionFilter</code> to the <code>CatsController</code>'s <code>create()</code> method.<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>cats<span class="token punctuation">.</span><span class="token property-access">controller</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseFilters</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">HttpExceptionFilter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> createCatDto<span class="token operator">:</span> <span class="token maybe-class-name">CreateCatDto</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">ForbiddenException</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
@@<span class="token keyword control-flow">switch</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseFilters</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">HttpExceptionFilter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Bind</span></span><span class="token punctuation">(</span><span class="token function"><span class="token maybe-class-name">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span>createCatDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">ForbiddenException</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> The <code>@UseFilters()</code> decorator is imported from the <code>@nestjs/common</code> package.</blockquote><p>We have used the <code>@UseFilters()</code> decorator here. Similar to the <code>@Catch()</code> decorator, it can take a single filter instance, or a comma-separated list of filter instances. Here, we created the instance of <code>HttpExceptionFilter</code> in place. Alternatively, you may pass the class (instead of an instance), leaving responsibility for instantiation to the framework, and enabling <strong>dependency injection</strong>.<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>cats<span class="token punctuation">.</span><span class="token property-access">controller</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseFilters</span></span><span class="token punctuation">(</span><span class="token maybe-class-name">HttpExceptionFilter</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> createCatDto<span class="token operator">:</span> <span class="token maybe-class-name">CreateCatDto</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">ForbiddenException</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
@@<span class="token keyword control-flow">switch</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseFilters</span></span><span class="token punctuation">(</span><span class="token maybe-class-name">HttpExceptionFilter</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Bind</span></span><span class="token punctuation">(</span><span class="token function"><span class="token maybe-class-name">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span>createCatDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">ForbiddenException</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> Prefer applying filters by using classes instead of instances when possible. It reduces <strong>memory usage</strong> since Nest can easily reuse instances of the same class across your entire module.</blockquote><p>In the example above, the <code>HttpExceptionFilter</code> is applied only to the single <code>create()</code> route handler, making it method-scoped. Exception filters can be scoped at different levels: method-scoped, controller-scoped, or global-scoped. For example, to set up a filter as controller-scoped, you would do the following:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>cats<span class="token punctuation">.</span><span class="token property-access">controller</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseFilters</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">HttpExceptionFilter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CatsController</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>This construction sets up the <code>HttpExceptionFilter</code> for every route handler defined inside the <code>CatsController</code>.<p>To create a global-scoped filter, you would do the following:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>main<span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">NestFactory</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token method function property-access">useGlobalFilters</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">HttpExceptionFilter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>warning <strong>Warning</strong> The <code>useGlobalFilters()</code> method does not set up filters for gateways or hybrid applications.</blockquote><p>Global-scoped filters are used across the whole application, for every controller and every route handler. In terms of dependency injection, global filters registered from outside of any module (with <code>useGlobalFilters()</code> as in the example above) cannot inject dependencies since this is done outside the context of any module. In order to solve this issue, you can register a global-scoped filter <strong>directly from any module</strong> using the following construction:<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token property-access">module</span><span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Module</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token punctuation">{</span> <span class="token constant">APP_FILTER</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/core'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      provide<span class="token operator">:</span> <span class="token constant">APP_FILTER</span><span class="token punctuation">,</span>
      useClass<span class="token operator">:</span> <span class="token maybe-class-name">HttpExceptionFilter</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppModule</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Hint</strong> When using this approach to perform dependency injection for the filter, note that regardless of the module where this construction is employed, the filter is, in fact, global. Where should this be done? Choose the module where the filter (<code>HttpExceptionFilter</code> in the example above) is defined. Also, <code>useClass</code> is not the only way of dealing with custom provider registration. Learn more <a href="/fundamentals/custom-providers">here</a>.</blockquote><p>You can add as many filters with this technique as needed; simply add each to the providers array.</section><section id="catch-everything"class="level4"><h4>Catch everything</h4><p>In order to catch <strong>every</strong> unhandled exception (regardless of the exception type), leave the <code>@Catch()</code> decorator's parameter list empty, e.g., <code>@Catch()</code>.<p>In the example below we have a code that is platform-agnostic because it uses the <a href="./faq/http-adapter">HTTP adapter</a> to deliver the response, and doesn't use any of the platform-specific objects (<code>Request</code> and <code>Response</code>) directly:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>
  <span class="token maybe-class-name">ExceptionFilter</span><span class="token punctuation">,</span>
  <span class="token maybe-class-name">Catch</span><span class="token punctuation">,</span>
  <span class="token maybe-class-name">ArgumentsHost</span><span class="token punctuation">,</span>
  <span class="token maybe-class-name">HttpException</span><span class="token punctuation">,</span>
  <span class="token maybe-class-name">HttpStatus</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">HttpAdapterHost</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/core'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Catch</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AllExceptionsFilter</span></span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token maybe-class-name">ExceptionFilter</span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> httpAdapterHost<span class="token operator">:</span> <span class="token maybe-class-name">HttpAdapterHost</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>exception<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span> host<span class="token operator">:</span> <span class="token maybe-class-name">ArgumentsHost</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// In certain situations `httpAdapter` might not be available in the</span>
    <span class="token comment">// constructor method, thus we should resolve it here.</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> httpAdapter <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">httpAdapterHost</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> ctx <span class="token operator">=</span> host<span class="token punctuation">.</span><span class="token method function property-access">switchToHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> httpStatus <span class="token operator">=</span>
      exception <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token maybe-class-name">HttpException</span></span>
        <span class="token operator">?</span> exception<span class="token punctuation">.</span><span class="token method function property-access">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token maybe-class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> responseBody <span class="token operator">=</span> <span class="token punctuation">{</span>
      statusCode<span class="token operator">:</span> httpStatus<span class="token punctuation">,</span>
      timestamp<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token known-class-name class-name">Date</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> httpAdapter<span class="token punctuation">.</span><span class="token method function property-access">getRequestUrl</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token method function property-access">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    httpAdapter<span class="token punctuation">.</span><span class="token method function property-access">reply</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token method function property-access">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> responseBody<span class="token punctuation">,</span> httpStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></section><section id="inheritance"class="level4"><h4>Inheritance</h4><p>Typically, you'll create fully customized exception filters crafted to fulfill your application requirements. However, there might be use-cases when you would like to simply extend the built-in default <strong>global exception filter</strong>, and override the behavior based on certain factors.<p>In order to delegate exception processing to the base filter, you need to extend <code>BaseExceptionFilter</code> and call the inherited <code>catch()</code> method.<pre class="language-typescript"><code class="language-typescript">@<span class="token decorator"><span class="token at operator">@</span><span class="token function">filename</span></span><span class="token punctuation">(</span>all<span class="token operator">-</span>exceptions<span class="token punctuation">.</span><span class="token property-access">filter</span><span class="token punctuation">)</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Catch</span><span class="token punctuation">,</span> <span class="token maybe-class-name">ArgumentsHost</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">BaseExceptionFilter</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/core'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Catch</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AllExceptionsFilter</span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token maybe-class-name">BaseExceptionFilter</span></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>exception<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span> host<span class="token operator">:</span> <span class="token maybe-class-name">ArgumentsHost</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>exception<span class="token punctuation">,</span> host<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
@@<span class="token keyword control-flow">switch</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Catch</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">BaseExceptionFilter</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/core'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Catch</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AllExceptionsFilter</span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token maybe-class-name">BaseExceptionFilter</span></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>exception<span class="token punctuation">,</span> host<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>exception<span class="token punctuation">,</span> host<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>warning <strong>Warning</strong> Method-scoped and Controller-scoped filters that extend the <code>BaseExceptionFilter</code> should not be instantiated with <code>new</code>. Instead, let the framework instantiate them automatically.</blockquote><p>The above implementation is just a shell demonstrating the approach. Your implementation of the extended exception filter would include your tailored <strong>business</strong> logic (e.g., handling various conditions).<p>Global filters <strong>can</strong> extend the base filter. This can be done in either of two ways.<p>The first method is to inject the <code>HttpAdapter</code> reference when instantiating the custom global filter:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">NestFactory</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span> httpAdapter <span class="token punctuation">}</span> <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token maybe-class-name">HttpAdapterHost</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token method function property-access">useGlobalFilters</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">AllExceptionsFilter</span></span><span class="token punctuation">(</span>httpAdapter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The second method is to use the <code>APP_FILTER</code> token <a href="exception-filters#binding-filters">as shown here</a>. <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>