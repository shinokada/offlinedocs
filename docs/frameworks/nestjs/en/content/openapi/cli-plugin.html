<!doctype html><html lang="en"><meta charset="utf-8"><title>CLI Plugin</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="cli-plugin"class="level3"><h3>CLI Plugin</h3><p>TypeScript's metadata reflection system has several limitations which make it impossible to, for instance, determine what properties a class consists of or recognize whether a given property is optional or required. However, some of these constraints can be addressed at compilation time. Nest provides a plugin that enhances the TypeScript compilation process to reduce the amount of boilerplate code required.<blockquote><p>info <strong>Hint</strong> This plugin is <strong>opt-in</strong>. If you prefer, you can declare all decorators manually, or only specific decorators where you need them.</blockquote><section id="overview"class="level4"><h4>Overview</h4><p>The Swagger plugin will automatically:<ul><li>annotate all DTO properties with <code>@ApiProperty</code> unless <code>@ApiHideProperty</code> is used<li>set the <code>required</code> property depending on the question mark (e.g. <code>name?: string</code> will set <code>required: false</code>)<li>set the <code>type</code> or <code>enum</code> property depending on the type (supports arrays as well)<li>set the <code>default</code> property based on the assigned default value<li>set several validation rules based on <code>class-validator</code> decorators (if <code>classValidatorShim</code> set to <code>true</code>)<li>add a response decorator to every endpoint with a proper status and <code>type</code> (response model)<li>generate descriptions for properties and endpoints based on comments (if <code>introspectComments</code> set to <code>true</code>)<li>generate example values for properties based on comments (if <code>introspectComments</code> set to <code>true</code>)</ul><p>Please, note that your filenames <strong>must have</strong> one of the following suffixes: <code>['.dto.ts', '.entity.ts']</code> (e.g., <code>create-user.dto.ts</code>) in order to be analysed by the plugin.<p>If you are using a different suffix, you can adjust the plugin's behavior by specifying the <code>dtoFileNameSuffix</code> option (see below).<p>Previously, if you wanted to provide an interactive experience with the Swagger UI, you had to duplicate a lot of code to let the package know how your models/components should be declared in the specification. For example, you could define a simple <code>CreateUserDto</code> class as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CreateUserDto</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiProperty</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiProperty</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  password<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiProperty</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">enum</span><span class="token operator">:</span> <span class="token maybe-class-name">RoleEnum</span><span class="token punctuation">,</span> <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> isArray<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  roles<span class="token operator">:</span> <span class="token maybe-class-name">RoleEnum</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiProperty</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> required<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  isEnabled<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>While not a significant issue with medium-sized projects, it becomes verbose &#x26; hard to maintain once you have a large set of classes.<p>By <a href="/openapi/cli-plugin#using-the-cli-plugin">enabling the Swagger plugin</a>, the above class definition can be declared simply:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">CreateUserDto</span></span> <span class="token punctuation">{</span>
  email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  password<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  roles<span class="token operator">:</span> <span class="token maybe-class-name">RoleEnum</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  isEnabled<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>The plugin adds appropriate decorators on the fly based on the <strong>Abstract Syntax Tree</strong>. Thus you won't have to struggle with <code>@ApiProperty</code> decorators scattered throughout the code.<blockquote><p>info <strong>Hint</strong> The plugin will automatically generate any missing swagger properties, but if you need to override them, you simply set them explicitly via <code>@ApiProperty()</code>.</blockquote></section><section id="comments-introspection"class="level4"><h4>Comments introspection</h4><p>With the comments introspection feature enabled, CLI plugin will generate descriptions and example values for properties based on comments.<p>For example, given an example <code>roles</code> property:<pre class="language-typescript"><code class="language-typescript"><span class="token doc-comment comment">/**
 * A list of user's roles
 * <span class="token keyword">@example</span> ['admin']
 */</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiProperty</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  description<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">A list of user's roles</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  example<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
roles<span class="token operator">:</span> <span class="token maybe-class-name">RoleEnum</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><p>You must duplicate both description and example values. With <code>introspectComments</code> enabled, the CLI plugin can extract these comments and automatically provide descriptions (and examples, if defined) for properties. Now, the above property can be declared simply as follows:<pre class="language-typescript"><code class="language-typescript"><span class="token doc-comment comment">/**
 * A list of user's roles
 * <span class="token keyword">@example</span> ['admin']
 */</span>
roles<span class="token operator">:</span> <span class="token maybe-class-name">RoleEnum</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><p>There are <code>dtoKeyOfComment</code> and <code>controllerKeyOfComment</code> plugin options that you can use to customize how the plugin will set the value for <code>ApiProperty</code> and <code>ApiOperation</code> decorators respectively. Take a look at the following example:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">SomeController</span></span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * Create some resource
   */</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>By default, these options are set to <code>"description"</code>. This means the plugin will assign <code>"Create some resource"</code> to <code>description</code> key on the <code>ApiOperation</code> operator. Like so:<pre class="language-ts"><code class="language-ts"><span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiOperation</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> description<span class="token operator">:</span> <span class="token string">"Create some resource"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><blockquote><p>info <strong>Hint</strong> For models, the same logic applies but to <code>ApiProperty</code> decorator instead.</blockquote></section><section id="using-the-cli-plugin"class="level4"><h4>Using the CLI plugin</h4><p>To enable the plugin, open <code>nest-cli.json</code> (if you use <a href="/cli/overview">Nest CLI</a>) and add the following <code>plugins</code> configuration:<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
  <span class="token string-property property">"collection"</span><span class="token operator">:</span> <span class="token string">"@nestjs/schematics"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"sourceRoot"</span><span class="token operator">:</span> <span class="token string">"src"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@nestjs/swagger"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>You can use the <code>options</code> property to customize the behavior of the plugin.<pre class="language-javascript"><code class="language-javascript"><span class="token string-property property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"@nestjs/swagger"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"options"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">"classValidatorShim"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token string-property property">"introspectComments"</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre><p>The <code>options</code> property has to fulfill the following interface:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">PluginOptions</span></span> <span class="token punctuation">{</span>
  dtoFileNameSuffix<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  controllerFileNameSuffix<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  classValidatorShim<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  dtoKeyOfComment<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  controllerKeyOfComment<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  introspectComments<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><table><tr><th>Option<th>Default<th>Description<tr><td><code>dtoFileNameSuffix</code><td><code>['.dto.ts', '.entity.ts']</code><td>DTO (Data Transfer Object) files suffix<tr><td><code>controllerFileNameSuffix</code><td><code>.controller.ts</code><td>Controller files suffix<tr><td><code>classValidatorShim</code><td><code>true</code><td>If set to true, the module will reuse <code>class-validator</code> validation decorators (e.g. <code>@Max(10)</code> will add <code>max: 10</code> to schema definition)<tr><td><code>dtoKeyOfComment</code><td><code>'description'</code><td>The property key to set the comment text to on <code>ApiProperty</code>.<tr><td><code>controllerKeyOfComment</code><td><code>'description'</code><td>The property key to set the comment text to on <code>ApiOperation</code>.<tr><td><code>introspectComments</code><td><code>false</code><td>If set to true, plugin will generate descriptions and example values for properties based on comments</table><p>If you don't use the CLI but instead have a custom <code>webpack</code> configuration, you can use this plugin in combination with <code>ts-loader</code>:<pre class="language-javascript"><code class="language-javascript"><span class="token function-variable function">getCustomTransformers</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">program</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">before</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@nestjs/swagger/plugin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">before</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> program<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre></section><section id="integration-with-ts-jest-e2e-tests"class="level4"><h4>Integration with <code>ts-jest</code> (e2e tests)</h4><p>To run e2e tests, <code>ts-jest</code> compiles your source code files on the fly, in memory. This means, it doesn't use Nest CLI compiler and does not apply any plugins or perform AST transformations.<p>To enable the plugin, create the following file in your e2e tests directory:<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> transformer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@nestjs/swagger/plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">=</span> <span class="token string">'nestjs-swagger-transformer'</span><span class="token punctuation">;</span>
<span class="token comment">// you should change the version number anytime you change the configuration below - otherwise, jest will not detect changes</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token punctuation">.</span><span class="token property-access">version</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">factory</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">cs</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> transformer<span class="token punctuation">.</span><span class="token method function property-access">before</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// @nestjs/swagger/plugin options (can be empty)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    cs<span class="token punctuation">.</span><span class="token property-access">program</span><span class="token punctuation">,</span> <span class="token comment">// "cs.tsCompiler.program" for older versions of Jest (&#x3C;= v27)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>With this in place, import AST transformer within your <code>jest</code> configuration file. By default (in the starter application), e2e tests configuration file is located under the <code>test</code> folder and is named <code>jest-e2e.json</code>.<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  ... <span class="token comment">// other configuration</span>
  <span class="token property">"globals"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"ts-jest"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"astTransformers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"before"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"&#x3C;path to the file created above>"</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>If you use <code>jest@^29</code>, then use the snippet below, as the previous approach got deprecated.<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  ... <span class="token comment">// other configuration</span>
  <span class="token property">"transform"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"^.+\\.(t|j)s$"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"ts-jest"</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"astTransformers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"before"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"&#x3C;path to the file created above>"</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></section><section id="troubleshooting-jest-e2e-tests"class="level4"><h4>Troubleshooting <code>jest</code> (e2e tests)</h4><p>In case <code>jest</code> does not seem to pick up your configuration changes, it's possible that Jest has already <strong>cached</strong> the build result. To apply the new configuration, you need to clear Jest's cache directory.<p>To clear the cache directory, run the following command in your NestJS project folder:<pre class="language-bash"><code class="language-bash">$ npx jest --clearCache</code></pre><p>In case the automatic cache clearance fails, you can still manually remove the cache folder with the following commands:<pre class="language-bash"><code class="language-bash"><span class="token comment"># Find jest cache directory (usually /tmp/jest_rs)</span>
<span class="token comment"># by running the following command in your NestJS project root</span>
$ npx jest --showConfig <span class="token operator">|</span> <span class="token function">grep</span> cache
<span class="token comment"># ex result:</span>
<span class="token comment">#   "cache": true,</span>
<span class="token comment">#   "cacheDirectory": "/tmp/jest_rs"</span>

<span class="token comment"># Remove or empty the Jest cache directory</span>
$ <span class="token function">rm</span> -rf  <span class="token operator">&#x3C;</span>cacheDirectory value<span class="token operator">></span>
<span class="token comment"># ex:</span>
<span class="token comment"># rm -rf /tmp/jest_rs</span></code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>