<!doctype html><html lang="en"><meta charset="utf-8"><title>Workspaces</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="workspaces"class="level3"><h3>Workspaces</h3><p>Nest has two modes for organizing code:<ul><li><strong>standard mode</strong>: useful for building individual project-focused applications that have their own dependencies and settings, and don't need to optimize for sharing modules, or optimizing complex builds. This is the default mode.<li><strong>monorepo mode</strong>: this mode treats code artifacts as part of a lightweight <strong>monorepo</strong>, and may be more appropriate for teams of developers and/or multi-project environments. It automates parts of the build process to make it easy to create and compose modular components, promotes code re-use, makes integration testing easier, makes it easy to share project-wide artifacts like <code>eslint</code> rules and other configuration policies, and is easier to use than alternatives like github submodules. Monorepo mode employs the concept of a <strong>workspace</strong>, represented in the <code>nest-cli.json</code> file, to coordinate the relationship between the components of the monorepo.</ul><p>It's important to note that virtually all of Nest's features are independent of your code organization mode. The <strong>only</strong> affect of this choice is how your projects are composed and how build artifacts are generated. All other functionality, from the CLI to core modules to add-on modules work the same in either mode.<p>Also, you can easily switch from <strong>standard mode</strong> to <strong>monorepo mode</strong> at any time, so you can delay this decision until the benefits of one or the other approach become more clear.<section id="standard-mode"class="level4"><h4>Standard mode</h4><p>When you run <code>nest new</code>, a new <strong>project</strong> is created for you using a built-in schematic. Nest does the following:<ol><li>Create a new folder, corresponding to the <code>name</code> argument you provide to <code>nest new</code><li>Populate that folder with default files corresponding to a minimal base-level Nest application. You can examine these files at the <a href="https://github.com/nestjs/typescript-starter">typescript-starter</a> repository.<li>Provide additional files such as <code>nest-cli.json</code>, <code>package.json</code> and <code>tsconfig.json</code> that configure and enable various tools for compiling, testing and serving your application.</ol><p>From there, you can modify the starter files, add new components, add dependencies (e.g., <code>npm install</code>), and otherwise develop your application as covered in the rest of this documentation.</section><section id="monorepo-mode"class="level4"><h4>Monorepo mode</h4><p>To enable monorepo mode, you start with a <em>standard mode</em> structure, and add <strong>projects</strong>. A project can be a full <strong>application</strong> (which you add to the workspace with the command <code>nest generate app</code>) or a <strong>library</strong> (which you add to the workspace with the command <code>nest generate library</code>). We'll discuss the details of these specific types of project components below. The key point to note now is that it is the <strong>act of adding a project</strong> to an existing standard mode structure that <strong>converts it</strong> to monorepo mode. Let's look at an example.<p>If we run:<pre class="language-bash"><code class="language-bash">nest new my-project</code></pre><p>We've constructed a <em>standard mode</em> structure, with a folder structure that looks like this:<div class="file-tree"><div class="item">node_modules</div><div class="item">src</div><div class="children"><div class="item">app.controller.ts</div><div class="item">app.module.ts</div><div class="item">app.service.ts</div><div class="item">main.ts</div></div><div class="item">nest-cli.json</div><div class="item">package.json</div><div class="item">tsconfig.json</div><div class="item">.eslintrc.js</div></div><p>We can convert this to a monorepo mode structure as follows:<pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> my-project
nest generate app my-app</code></pre><p>At this point, <code>nest</code> converts the existing structure to a <strong>monorepo mode</strong> structure. This results in a few important changes. The folder structure now looks like this:<div class="file-tree"><div class="item">apps</div><div class="children"><div class="item">my-app</div><div class="children"><div class="item">src</div><div class="children"><div class="item">app.controller.ts</div><div class="item">app.module.ts</div><div class="item">app.service.ts</div><div class="item">main.ts</div></div><div class="item">tsconfig.app.json</div></div><div class="item">my-project</div><div class="children"><div class="item">src</div><div class="children"><div class="item">app.controller.ts</div><div class="item">app.module.ts</div><div class="item">app.service.ts</div><div class="item">main.ts</div></div><div class="item">tsconfig.app.json</div></div></div><div class="item">nest-cli.json</div><div class="item">package.json</div><div class="item">tsconfig.json</div><div class="item">.eslintrc.js</div></div><p>The <code>generate app</code> schematic has reorganized the code - moving each <strong>application</strong> project under the <code>apps</code> folder, and adding a project-specific <code>tsconfig.app.json</code> file in each project's root folder. Our original <code>my-project</code> app has become the <strong>default project</strong> for the monorepo, and is now a peer with the just-added <code>my-app</code>, located under the <code>apps</code> folder. We'll cover default projects below.<blockquote><p>error <strong>Warning</strong> The conversion of a standard mode structure to monorepo only works for projects that have followed the canonical Nest project structure. Specifically, during conversion, the schematic attempts to relocate the <code>src</code> and <code>test</code> folders in a project folder beneath the <code>apps</code> folder in the root. If a project does not use this structure, the conversion will fail or produce unreliable results.</blockquote></section><section id="workspace-projects"class="level4"><h4>Workspace projects</h4><p>A monorepo uses the concept of a workspace to manage its member entities. Workspaces are composed of <strong>projects</strong>. A project may be either:<ul><li>an <strong>application</strong>: a full Nest application including a <code>main.ts</code> file to bootstrap the application. Aside from compile and build considerations, an application-type project within a workspace is functionally identical to an application within a <em>standard mode</em> structure.<li>a <strong>library</strong>: a library is a way of packaging a general purpose set of features (modules, providers, controllers, etc.) that can be used within other projects. A library cannot run on its own, and has no <code>main.ts</code> file. Read more about libraries <a href="/cli/libraries">here</a>.</ul><p>All workspaces have a <strong>default project</strong> (which should be an application-type project). This is defined by the top-level <code>"root"</code> property in the <code>nest-cli.json</code> file, which points at the root of the default project (see <a href="/cli/monorepo#cli-properties">CLI properties</a> below for more details). Usually, this is the <strong>standard mode</strong> application you started with, and later converted to a monorepo using <code>nest generate app</code>. When you follow these steps, this property is populated automatically.<p>Default projects are used by <code>nest</code> commands like <code>nest build</code> and <code>nest start</code> when a project name is not supplied.<p>For example, in the above monorepo structure, running<pre class="language-bash"><code class="language-bash">$ nest start</code></pre><p>will start up the <code>my-project</code> app. To start <code>my-app</code>, we'd use:<pre class="language-bash"><code class="language-bash">$ nest start my-app</code></pre></section><section id="applications"class="level4"><h4>Applications</h4><p>Application-type projects, or what we might informally refer to as just "applications", are complete Nest applications that you can run and deploy. You generate an application-type project with <code>nest generate app</code>.<p>This command automatically generates a project skeleton, including the standard <code>src</code> and <code>test</code> folders from the <a href="https://github.com/nestjs/typescript-starter">typescript starter</a>. Unlike standard mode, an application project in a monorepo does not have any of the package dependency (<code>package.json</code>) or other project configuration artifacts like <code>.prettierrc</code> and <code>.eslintrc.js</code>. Instead, the monorepo-wide dependencies and config files are used.<p>However, the schematic does generate a project-specific <code>tsconfig.app.json</code> file in the root folder of the project. This config file automatically sets appropriate build options, including setting the compilation output folder properly. The file extends the top-level (monorepo) <code>tsconfig.json</code> file, so you can manage global settings monorepo-wide, but override them if needed at the project level.</section><section id="libraries"class="level4"><h4>Libraries</h4><p>As mentioned, library-type projects, or simply "libraries", are packages of Nest components that need to be composed into applications in order to run. You generate a library-type project with <code>nest generate library</code>. Deciding what belongs in a library is an architectural design decision. We discuss libraries in depth in the <a href="/cli/libraries">libraries</a> chapter.</section><section id="cli-properties"class="level4"><h4>CLI properties</h4><p>Nest keeps the metadata needed to organize, build and deploy both standard and monorepo structured projects in the <code>nest-cli.json</code> file. Nest automatically adds to and updates this file as you add projects, so you usually do not have to think about it or edit its contents. However, there are some settings you may want to change manually, so it's helpful to have an overview understanding of the file.<p>After running the steps above to create a monorepo, our <code>nest-cli.json</code> file looks like this:<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
  <span class="token string-property property">"collection"</span><span class="token operator">:</span> <span class="token string">"@nestjs/schematics"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"sourceRoot"</span><span class="token operator">:</span> <span class="token string">"apps/my-project/src"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"monorepo"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string-property property">"root"</span><span class="token operator">:</span> <span class="token string">"apps/my-project"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">"webpack"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"tsConfigPath"</span><span class="token operator">:</span> <span class="token string">"apps/my-project/tsconfig.app.json"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"projects"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">"my-project"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"application"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"root"</span><span class="token operator">:</span> <span class="token string">"apps/my-project"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"entryFile"</span><span class="token operator">:</span> <span class="token string">"main"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"sourceRoot"</span><span class="token operator">:</span> <span class="token string">"apps/my-project/src"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">"tsConfigPath"</span><span class="token operator">:</span> <span class="token string">"apps/my-project/tsconfig.app.json"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"my-app"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"application"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"root"</span><span class="token operator">:</span> <span class="token string">"apps/my-app"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"entryFile"</span><span class="token operator">:</span> <span class="token string">"main"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"sourceRoot"</span><span class="token operator">:</span> <span class="token string">"apps/my-app/src"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">"tsConfigPath"</span><span class="token operator">:</span> <span class="token string">"apps/my-app/tsconfig.app.json"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>The file is divided into sections:<ul><li>a global section with top-level properties controlling standard and monorepo-wide settings<li>a top level property (<code>"projects"</code>) with metadata about each project. This section is present only for monorepo-mode structures.</ul><p>The top-level properties are as follows:<ul><li><code>"collection"</code>: points at the collection of schematics used to generate components; you generally should not change this value<li><code>"sourceRoot"</code>: points at the root of the source code for the single project in standard mode structures, or the <em>default project</em> in monorepo mode structures<li><code>"compilerOptions"</code>: a map with keys specifying compiler options and values specifying the option setting; see details below<li><code>"generateOptions"</code>: a map with keys specifying global generate options and values specifying the option setting; see details below<li><code>"monorepo"</code>: (monorepo only) for a monorepo mode structure, this value is always <code>true</code><li><code>"root"</code>: (monorepo only) points at the project root of the <em>default project</em></ul></section><section id="global-compiler-options"class="level4"><h4>Global compiler options</h4><p>These properties specify the compiler to use as well as various options that affect <strong>any</strong> compilation step, whether as part of <code>nest build</code> or <code>nest start</code>, and regardless of the compiler, whether <code>tsc</code> or webpack.<table><thead><tr><th>Property Name<th>Property Value Type<th>Description<tbody><tr><td><code>webpack</code><td>boolean<td>If <code>true</code>, use <a href="https://webpack.js.org/">webpack compiler</a>. If <code>false</code> or not present, use <code>tsc</code>. In monorepo mode, the default is <code>true</code> (use webpack), in standard mode, the default is <code>false</code> (use <code>tsc</code>). See below for details.<tr><td><code>tsConfigPath</code><td>string<td>(<strong>monorepo only</strong>) Points at the file containing the <code>tsconfig.json</code> settings that will be used when <code>nest build</code> or <code>nest start</code> is called without a <code>project</code> option (e.g., when the default project is built or started).<tr><td><code>webpackConfigPath</code><td>string<td>Points at a webpack options file. If not specified, Nest looks for the file <code>webpack.config.js</code>. See below for more details.<tr><td><code>deleteOutDir</code><td>boolean<td>If <code>true</code>, whenever the compiler is invoked, it will first remove the compilation output directory (as configured in <code>tsconfig.json</code>, where the default is <code>./dist</code>).<tr><td><code>assets</code><td>array<td>Enables automatically distributing non-TypeScript assets whenever a compilation step begins (asset distribution does <strong>not</strong> happen on incremental compiles in <code>--watch</code> mode). See below for details.<tr><td><code>watchAssets</code><td>boolean<td>If <code>true</code>, run in watch-mode, watching <strong>all</strong> non-TypeScript assets. (For more fine-grained control of the assets to watch, see <a href="cli/monorepo#assets">Assets</a> section below).</table></section><section id="global-generate-options"class="level4"><h4>Global generate options</h4><p>These properties specify the default generate options to be used by the <code>nest generate</code> command.<table><thead><tr><th>Property Name<th>Property Value Type<th>Description<tbody><tr><td><code>spec</code><td>boolean <em>or</em> object<td>If the value is boolean, a value of <code>true</code> enables <code>spec</code> generation by default and a value of <code>false</code> disables it. A flag passed on the CLI command line overrides this setting, as does a project-specific <code>generateOptions</code> setting (more below). If the value is an object, each key represents a schematic name, and the boolean value determines whether the default spec generation is enabled / disabled for that specific schematic.<tr><td><code>flat</code><td>boolean<td>If true, all generate commands will generate a flat structure</table><p>The following example uses a boolean value to specify that spec file generation should be disabled by default for all projects:<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
  <span class="token string-property property">"generateOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">"spec"</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token spread operator">...</span>
<span class="token punctuation">}</span></code></pre><p>The following example uses a boolean value to specify flat file generation should be the default for all projects:<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
  <span class="token string-property property">"generateOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">"flat"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token spread operator">...</span>
<span class="token punctuation">}</span></code></pre><p>In the following example, <code>spec</code> file generation is disabled only for <code>service</code> schematics (e.g., <code>nest generate service...</code>):<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
  <span class="token string-property property">"generateOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">"spec"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">"service"</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token spread operator">...</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>warning <strong>Warning</strong> When specifying the <code>spec</code> as an object, the key for the generation schematic does not currently support automatic alias handling. This means that specifying a key as for example <code>service: false</code> and trying to generate a service via the alias <code>s</code>, the spec would still be generated. To make sure both the normal schematic name and the alias work as intended, specify both the normal command name as well as the alias, as seen below.<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
  <span class="token string-property property">"generateOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">"spec"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">"service"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token string-property property">"s"</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token spread operator">...</span>
<span class="token punctuation">}</span></code></pre></blockquote></section><section id="project-specific-generate-options"class="level4"><h4>Project-specific generate options</h4><p>In addition to providing global generate options, you may also specify project-specific generate options. The project specific generate options follow the exact same format as the global generate options, but are specified directly on each project.<p>Project-specific generate options override global generate options.<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
  <span class="token string-property property">"projects"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">"cats-project"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">"generateOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">"spec"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">"service"</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token spread operator">...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token spread operator">...</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>warning <strong>Warning</strong> The order of precedence for generate options is as follows. Options specified on the CLI command line take precedence over project-specific options. Project-specific options override global options.</blockquote></section><section id="specified-compiler"class="level4"><h4>Specified compiler</h4><p>The reason for the different default compilers is that for larger projects (e.g., more typical in a monorepo) webpack can have significant advantages in build times and in producing a single file bundling all project components together. If you wish to generate individual files, set <code>"webpack"</code> to <code>false</code>, which will cause the build process to use <code>tsc</code>.</section><section id="webpack-options"class="level4"><h4>Webpack options</h4><p>The webpack options file can contain standard <a href="https://webpack.js.org/configuration/">webpack configuration options</a>. For example, to tell webpack to bundle <code>node_modules</code> (which are excluded by default), add the following to <code>webpack.config.js</code>:<pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>Since the webpack config file is a JavaScript file, you can even expose a function that takes default options and returns a modified object:<pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token spread operator">...</span>options<span class="token punctuation">,</span>
    <span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></section><section id="assets"class="level4"><h4>Assets</h4><p>TypeScript compilation automatically distributes compiler output (<code>.js</code> and <code>.d.ts</code> files) to the specified output directory. It can also be convenient to distribute non-TypeScript files, such as <code>.graphql</code> files, <code>images</code>, <code>.html</code> files and other assets. This allows you to treat <code>nest build</code> (and any initial compilation step) as a lightweight <strong>development build</strong> step, where you may be editing non-TypeScript files and iteratively compiling and testing. The assets should be located in the <code>src</code> folder otherwise they will not be copied.<p>The value of the <code>assets</code> key should be an array of elements specifying the files to be distributed. The elements can be simple strings with <code>glob</code>-like file specs, for example:<pre class="language-typescript"><code class="language-typescript"><span class="token string-property property">"assets"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"**/*.graphql"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string-property property">"watchAssets"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></code></pre><p>For finer control, the elements can be objects with the following keys:<ul><li><code>"include"</code>: <code>glob</code>-like file specifications for the assets to be distributed<li><code>"exclude"</code>: <code>glob</code>-like file specifications for assets to be <strong>excluded</strong> from the <code>include</code> list<li><code>"outDir"</code>: a string specifying the path (relative to the root folder) where the assets should be distributed. Defaults to the same output directory configured for compiler output.<li><code>"watchAssets"</code>: boolean; if <code>true</code>, run in watch mode watching specified assets</ul><p>For example:<pre class="language-typescript"><code class="language-typescript"><span class="token string-property property">"assets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token string-property property">"include"</span><span class="token operator">:</span> <span class="token string">"**/*.graphql"</span><span class="token punctuation">,</span> <span class="token string-property property">"exclude"</span><span class="token operator">:</span> <span class="token string">"**/omitted.graphql"</span><span class="token punctuation">,</span> <span class="token string-property property">"watchAssets"</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span></code></pre><blockquote><p>warning <strong>Warning</strong> Setting <code>watchAssets</code> in a top-level <code>compilerOptions</code> property overrides any <code>watchAssets</code> settings within the <code>assets</code> property.</blockquote></section><section id="project-properties"class="level4"><h4>Project properties</h4><p>This element exists only for monorepo-mode structures. You generally should not edit these properties, as they are used by Nest to locate projects and their configuration options within the monorepo. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>