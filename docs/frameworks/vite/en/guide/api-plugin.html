<!doctype html><html lang="en"><meta charset="utf-8"><title>Plugin API</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="plugin-api"class="level1"><h1>Plugin API</h1><p>Vite plugins extends Rollup's well-designed plugin interface with a few extra Vite-specific options. As a result, you can write a Vite plugin once and have it work for both dev and build.<p><strong>It is recommended to go through <a href="https://rollupjs.org/plugin-development/">Rollup's plugin documentation</a> first before reading the sections below.</strong><section id="authoring-a-plugin"class="level2"><h2>Authoring a Plugin</h2><p>Vite strives to offer established patterns out of the box, so before creating a new plugin make sure that you check the <a href="https://vitejs.dev/guide/features">Features guide</a> to see if your need is covered. Also review available community plugins, both in the form of a <a href="https://github.com/rollup/awesome">compatible Rollup plugin</a> and <a href="https://github.com/vitejs/awesome-vite#plugins">Vite Specific plugins</a><p>When creating a plugin, you can inline it in your <code>vite.config.js</code>. There is no need to create a new package for it. Once you see that a plugin was useful in your projects, consider sharing it to help others <a href="https://chat.vitejs.dev">in the ecosystem</a>.</p>tip When learning, debugging, or authoring plugins, we suggest including [vite-plugin-inspect](https://github.com/antfu/vite-plugin-inspect) in your project. It allows you to inspect the intermediate state of Vite plugins. After installing, you can visit `localhost:5173/__inspect/` to inspect the modules and transformation stack of your project. Check out install instructions in the [vite-plugin-inspect docs](https://github.com/antfu/vite-plugin-inspect). ![vite-plugin-inspect](/images/vite-plugin-inspect.png)</section><section id="conventions"class="level2"><h2>Conventions</h2><p>If the plugin doesn't use Vite specific hooks and can be implemented as a <a href="#rollup-plugin-compatibility">Compatible Rollup Plugin</a>, then it is recommended to use the <a href="https://rollupjs.org/plugin-development/#conventions">Rollup Plugin naming conventions</a>.<ul><li>Rollup Plugins should have a clear name with <code>rollup-plugin-</code> prefix.<li>Include <code>rollup-plugin</code> and <code>vite-plugin</code> keywords in package.json.</ul><p>This exposes the plugin to be also used in pure Rollup or WMR based projects<p>For Vite only plugins<ul><li>Vite Plugins should have a clear name with <code>vite-plugin-</code> prefix.<li>Include <code>vite-plugin</code> keyword in package.json.<li>Include a section in the plugin docs detailing why it is a Vite only plugin (for example, it uses Vite specific plugin hooks).</ul><p>If your plugin is only going to work for a particular framework, its name should be included as part of the prefix<ul><li><code>vite-plugin-vue-</code> prefix for Vue Plugins<li><code>vite-plugin-react-</code> prefix for React Plugins<li><code>vite-plugin-svelte-</code> prefix for Svelte Plugins</ul><p>See also <a href="#virtual-modules-convention">Virtual Modules Convention</a>.</section><section id="plugins-config"class="level2"><h2>Plugins config</h2><p>Users will add plugins to the project <code>devDependencies</code> and configure them using the <code>plugins</code> array option.<pre class="language-js"><code class="language-js"><span class="token comment">// vite.config.js</span>
<span class="token keyword module">import</span> <span class="token imports">vitePlugin</span> <span class="token keyword module">from</span> <span class="token string">'vite-plugin-feature'</span>
<span class="token keyword module">import</span> <span class="token imports">rollupPlugin</span> <span class="token keyword module">from</span> <span class="token string">'rollup-plugin-feature'</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">vitePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rollupPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Falsy plugins will be ignored, which can be used to easily activate or deactivate plugins.<p><code>plugins</code> also accepts presets including several plugins as a single element. This is useful for complex features (like framework integration) that are implemented using several plugins. The array will be flattened internally.<pre class="language-js"><code class="language-js"><span class="token comment">// framework-plugin</span>
<span class="token keyword module">import</span> <span class="token imports">frameworkRefresh</span> <span class="token keyword module">from</span> <span class="token string">'vite-plugin-framework-refresh'</span>
<span class="token keyword module">import</span> <span class="token imports">frameworkDevtools</span> <span class="token keyword module">from</span> <span class="token string">'vite-plugin-framework-devtools'</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function">framework</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span><span class="token function">frameworkRefresh</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">frameworkDevTools</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// vite.config.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vite'</span>
<span class="token keyword module">import</span> <span class="token imports">framework</span> <span class="token keyword module">from</span> <span class="token string">'vite-plugin-framework'</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">framework</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="simple-examples"class="level2"><h2>Simple Examples</h2><blockquote>It is common convention to author a Vite/Rollup plugin as a factory function that returns the actual plugin object. The function can accept options which allows users to customize the behavior of the plugin.</blockquote><section id="transforming-custom-file-types"class="level3"><h3>Transforming Custom File Types</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fileRegex <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(my-file-ext)$</span><span class="token regex-delimiter">/</span></span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function">myPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'transform-file'</span><span class="token punctuation">,</span>

    <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">src<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>fileRegex<span class="token punctuation">.</span><span class="token method function property-access">test</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token function">compileFileToJS</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token literal-property property">map</span><span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> <span class="token comment">// provide source map if available</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></section><section id="importing-a-virtual-file"class="level3"><h3>Importing a Virtual File</h3><p>See the example in the <a href="#virtual-modules-convention">next section</a>.</section></section><section id="virtual-modules-convention"class="level2"><h2>Virtual Modules Convention</h2><p>Virtual modules are a useful scheme that allows you to pass build time information to the source files using normal ESM import syntax.<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function">myPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> virtualModuleId <span class="token operator">=</span> <span class="token string">'virtual:my-module'</span>
  <span class="token keyword">const</span> resolvedVirtualModuleId <span class="token operator">=</span> <span class="token string">'\0'</span> <span class="token operator">+</span> virtualModuleId

  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'my-plugin'</span><span class="token punctuation">,</span> <span class="token comment">// required, will show up in warnings and errors</span>
    <span class="token function">resolveId</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>id <span class="token operator">===</span> virtualModuleId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> resolvedVirtualModuleId
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>id <span class="token operator">===</span> resolvedVirtualModuleId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export const msg = "from virtual module"</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Which allows importing the module in JavaScript:<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> msg <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'virtual:my-module'</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span></code></pre><p>Virtual modules in Vite (and Rollup) are prefixed with <code>virtual:</code> for the user-facing path by convention. If possible the plugin name should be used as a namespace to avoid collisions with other plugins in the ecosystem. For example, a <code>vite-plugin-posts</code> could ask users to import a <code>virtual:posts</code> or <code>virtual:posts/helpers</code> virtual modules to get build time information. Internally, plugins that use virtual modules should prefix the module ID with <code>\0</code> while resolving the id, a convention from the rollup ecosystem. This prevents other plugins from trying to process the id (like node resolution), and core features like sourcemaps can use this info to differentiate between virtual modules and regular files. <code>\0</code> is not a permitted char in import URLs so we have to replace them during import analysis. A <code>\0{id}</code> virtual id ends up encoded as <code>/@id/__x00__{id}</code> during dev in the browser. The id will be decoded back before entering the plugins pipeline, so this is not seen by plugins hooks code.<p>Note that modules directly derived from a real file, as in the case of a script module in a Single File Component (like a .vue or .svelte SFC) don't need to follow this convention. SFCs generally generate a set of submodules when processed but the code in these can be mapped back to the filesystem. Using <code>\0</code> for these submodules would prevent sourcemaps from working correctly.</section><section id="universal-hooks"class="level2"><h2>Universal Hooks</h2><p>During dev, the Vite dev server creates a plugin container that invokes <a href="https://rollupjs.org/plugin-development/#build-hooks">Rollup Build Hooks</a> the same way Rollup does it.<p>The following hooks are called once on server start:<ul><li><a href="https://rollupjs.org/plugin-development/#options"><code>options</code></a><li><a href="https://rollupjs.org/plugin-development/#buildstart"><code>buildStart</code></a></ul><p>The following hooks are called on each incoming module request:<ul><li><a href="https://rollupjs.org/plugin-development/#resolveid"><code>resolveId</code></a><li><a href="https://rollupjs.org/plugin-development/#load"><code>load</code></a><li><a href="https://rollupjs.org/plugin-development/#transform"><code>transform</code></a></ul><p>They also have an extended <code>options</code> parameter with additional Vite-specific properties. You can read more in the <a href="/guide/ssr#ssr-specific-plugin-logic">SSR documentation</a>.<p>The following hooks are called when the server is closed:<ul><li><a href="https://rollupjs.org/plugin-development/#buildend"><code>buildEnd</code></a><li><a href="https://rollupjs.org/plugin-development/#closebundle"><code>closeBundle</code></a></ul><p>Note that the <a href="https://rollupjs.org/plugin-development/#moduleparsed"><code>moduleParsed</code></a> hook is <strong>not</strong> called during dev, because Vite avoids full AST parses for better performance.<p><a href="https://rollupjs.org/plugin-development/#output-generation-hooks">Output Generation Hooks</a> (except <code>closeBundle</code>) are <strong>not</strong> called during dev. You can think of Vite's dev server as only calling <code>rollup.rollup()</code> without calling <code>bundle.generate()</code>.</section><section id="vite-specific-hooks"class="level2"><h2>Vite Specific Hooks</h2><p>Vite plugins can also provide hooks that serve Vite-specific purposes. These hooks are ignored by Rollup.<section id="config"class="level3"><h3><code>config</code></h3><ul><li><p><strong>Type:</strong> <code>(config: UserConfig, env: { mode: string, command: string }) => UserConfig | null | void</code><li><p><strong>Kind:</strong> <code>async</code>, <code>sequential</code><p>Modify Vite config before it's resolved. The hook receives the raw user config (CLI options merged with config file) and the current config env which exposes the <code>mode</code> and <code>command</code> being used. It can return a partial config object that will be deeply merged into existing config, or directly mutate the config (if the default merging cannot achieve the desired result).<p><strong>Example:</strong><pre class="language-js"><code class="language-js"><span class="token comment">// return partial config (recommended)</span>
<span class="token keyword">const</span> <span class="token function-variable function">partialConfigPlugin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'return-partial'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">config</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">'bar'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// mutate the config directly (use only when merging doesn't work)</span>
<span class="token keyword">const</span> <span class="token function-variable function">mutateConfigPlugin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'mutate-config'</span><span class="token punctuation">,</span>
  <span class="token function">config</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> <span class="token punctuation">{</span> command <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">'build'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      config<span class="token punctuation">.</span><span class="token property-access">root</span> <span class="token operator">=</span> <span class="token string">'foo'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>warning Note<p>User plugins are resolved before running this hook so injecting other plugins inside the <code>config</code> hook will have no effect.</ul></section><section id="configresolved"class="level3"><h3><code>configResolved</code></h3><ul><li><p><strong>Type:</strong> <code>(config: ResolvedConfig) => void | Promise&#x3C;void></code><li><p><strong>Kind:</strong> <code>async</code>, <code>parallel</code><p>Called after the Vite config is resolved. Use this hook to read and store the final resolved config. It is also useful when the plugin needs to do something different based on the command being run.<p><strong>Example:</strong><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">examplePlugin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> config

  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'read-config'</span><span class="token punctuation">,</span>

    <span class="token function">configResolved</span><span class="token punctuation">(</span><span class="token parameter">resolvedConfig</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// store the resolved config</span>
      config <span class="token operator">=</span> resolvedConfig
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// use stored config in other hooks</span>
    <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token property-access">command</span> <span class="token operator">===</span> <span class="token string">'serve'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// dev: plugin invoked by dev server</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// build: plugin invoked by Rollup</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Note that the <code>command</code> value is <code>serve</code> in dev (in the cli <code>vite</code>, <code>vite dev</code>, and <code>vite serve</code> are aliases).</ul></section><section id="configureserver"class="level3"><h3><code>configureServer</code></h3><ul><li><p><strong>Type:</strong> <code>(server: ViteDevServer) => (() => void) | void | Promise&#x3C;(() => void) | void></code><li><p><strong>Kind:</strong> <code>async</code>, <code>sequential</code><li><p><strong>See also:</strong> <a href="./api-javascript.html#vitedevserver">ViteDevServer</a><p>Hook for configuring the dev server. The most common use case is adding custom middlewares to the internal <a href="https://github.com/senchalabs/connect">connect</a> app:<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">myPlugin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'configure-server'</span><span class="token punctuation">,</span>
  <span class="token function">configureServer</span><span class="token punctuation">(</span><span class="token parameter">server</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    server<span class="token punctuation">.</span><span class="token property-access">middlewares</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// custom handle request...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><strong>Injecting Post Middleware</strong><p>The <code>configureServer</code> hook is called before internal middlewares are installed, so the custom middlewares will run before internal middlewares by default. If you want to inject a middleware <strong>after</strong> internal middlewares, you can return a function from <code>configureServer</code>, which will be called after internal middlewares are installed:<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">myPlugin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'configure-server'</span><span class="token punctuation">,</span>
  <span class="token function">configureServer</span><span class="token punctuation">(</span><span class="token parameter">server</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// return a post hook that is called after internal middlewares are</span>
    <span class="token comment">// installed</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      server<span class="token punctuation">.</span><span class="token property-access">middlewares</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token comment">// custom handle request...</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><strong>Storing Server Access</strong><p>In some cases, other plugin hooks may need access to the dev server instance (e.g. accessing the web socket server, the file system watcher, or the module graph). This hook can also be used to store the server instance for access in other hooks:<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">myPlugin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> server
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'configure-server'</span><span class="token punctuation">,</span>
    <span class="token function">configureServer</span><span class="token punctuation">(</span><span class="token parameter">_server</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      server <span class="token operator">=</span> _server
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// use server...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Note <code>configureServer</code> is not called when running the production build so your other hooks need to guard against its absence.</ul></section><section id="configurepreviewserver"class="level3"><h3><code>configurePreviewServer</code></h3><ul><li><p><strong>Type:</strong> <code>(server: PreviewServerForHook) => (() => void) | void | Promise&#x3C;(() => void) | void></code><li><p><strong>Kind:</strong> <code>async</code>, <code>sequential</code><li><p><strong>See also:</strong> <a href="./api-javascript.html#previewserverforhook">PreviewServerForHook</a><p>Same as <a href="/guide/api-plugin.html#configureserver"><code>configureServer</code></a> but for the preview server. Similarly to <code>configureServer</code>, the <code>configurePreviewServer</code> hook is called before other middlewares are installed. If you want to inject a middleware <strong>after</strong> other middlewares, you can return a function from <code>configurePreviewServer</code>, which will be called after internal middlewares are installed:<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">myPlugin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'configure-preview-server'</span><span class="token punctuation">,</span>
  <span class="token function">configurePreviewServer</span><span class="token punctuation">(</span><span class="token parameter">server</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// return a post hook that is called after other middlewares are</span>
    <span class="token comment">// installed</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      server<span class="token punctuation">.</span><span class="token property-access">middlewares</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token comment">// custom handle request...</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></ul></section><section id="transformindexhtml"class="level3"><h3><code>transformIndexHtml</code></h3><ul><li><p><strong>Type:</strong> <code>IndexHtmlTransformHook | { order?: 'pre' | 'post', handler: IndexHtmlTransformHook }</code><li><p><strong>Kind:</strong> <code>async</code>, <code>sequential</code><p>Dedicated hook for transforming HTML entry point files such as <code>index.html</code>. The hook receives the current HTML string and a transform context. The context exposes the <a href="./api-javascript.html#vitedevserver"><code>ViteDevServer</code></a> instance during dev, and exposes the Rollup output bundle during build.<p>The hook can be async and can return one of the following:<ul><li>Transformed HTML string<li>An array of tag descriptor objects (<code>{ tag, attrs, children }</code>) to inject to the existing HTML. Each tag can also specify where it should be injected to (default is prepending to <code>&#x3C;head></code>)<li>An object containing both as <code>{ html, tags }</code></ul><p><strong>Basic Example:</strong><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">htmlPlugin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'html-transform'</span><span class="token punctuation">,</span>
    <span class="token function">transformIndexHtml</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> html<span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span>
        <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&#x3C;title>(.*?)&#x3C;\/title></span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&#x3C;title>Title replaced!&#x3C;/title></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p><strong>Full Hook Signature:</strong><pre class="language-ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">IndexHtmlTransformHook</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  html<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  ctx<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token builtin">string</span>
    filename<span class="token operator">:</span> <span class="token builtin">string</span>
    server<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">ViteDevServer</span>
    bundle<span class="token operator">?</span><span class="token operator">:</span> <span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'rollup'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">OutputBundle</span></span>
    chunk<span class="token operator">?</span><span class="token operator">:</span> <span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'rollup'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">OutputChunk</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token arrow operator">=></span>
  <span class="token operator">|</span> <span class="token maybe-class-name">IndexHtmlTransformResult</span>
  <span class="token operator">|</span> <span class="token keyword">void</span>
  <span class="token operator">|</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">IndexHtmlTransformResult</span> <span class="token operator">|</span> <span class="token keyword">void</span><span class="token operator">></span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">IndexHtmlTransformResult</span></span> <span class="token operator">=</span>
  <span class="token operator">|</span> <span class="token builtin">string</span>
  <span class="token operator">|</span> <span class="token maybe-class-name">HtmlTagDescriptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token operator">|</span> <span class="token punctuation">{</span>
      html<span class="token operator">:</span> <span class="token builtin">string</span>
      tags<span class="token operator">:</span> <span class="token maybe-class-name">HtmlTagDescriptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">HtmlTagDescriptor</span></span> <span class="token punctuation">{</span>
  tag<span class="token operator">:</span> <span class="token builtin">string</span>
  attrs<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">boolean</span><span class="token operator">></span>
  children<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token maybe-class-name">HtmlTagDescriptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token doc-comment comment">/**
   * default: 'head-prepend'
   */</span>
  injectTo<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">'head'</span> <span class="token operator">|</span> <span class="token string">'body'</span> <span class="token operator">|</span> <span class="token string">'head-prepend'</span> <span class="token operator">|</span> <span class="token string">'body-prepend'</span>
<span class="token punctuation">}</span></code></pre></ul></section><section id="handlehotupdate"class="level3"><h3><code>handleHotUpdate</code></h3><ul><li><p><strong>Type:</strong> <code>(ctx: HmrContext) => Array&#x3C;ModuleNode> | void | Promise&#x3C;Array&#x3C;ModuleNode> | void></code><p>Perform custom HMR update handling. The hook receives a context object with the following signature:<pre class="language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">HmrContext</span></span> <span class="token punctuation">{</span>
  file<span class="token operator">:</span> <span class="token builtin">string</span>
  timestamp<span class="token operator">:</span> <span class="token builtin">number</span>
  modules<span class="token operator">:</span> <span class="token known-class-name class-name">Array</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ModuleNode</span><span class="token operator">></span>
  <span class="token function-variable function">read</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token operator">></span>
  server<span class="token operator">:</span> <span class="token maybe-class-name">ViteDevServer</span>
<span class="token punctuation">}</span></code></pre><ul><li><p><code>modules</code> is an array of modules that are affected by the changed file. It's an array because a single file may map to multiple served modules (e.g. Vue SFCs).<li><p><code>read</code> is an async read function that returns the content of the file. This is provided because on some systems, the file change callback may fire too fast before the editor finishes updating the file and direct <code>fs.readFile</code> will return empty content. The read function passed in normalizes this behavior.</ul><p>The hook can choose to:<ul><li><p>Filter and narrow down the affected module list so that the HMR is more accurate.<li><p>Return an empty array and perform complete custom HMR handling by sending custom events to the client:<pre class="language-js"><code class="language-js"><span class="token function">handleHotUpdate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> server <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  server<span class="token punctuation">.</span><span class="token property-access">ws</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'custom'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'special-update'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre><p>Client code should register corresponding handler using the <a href="./api-hmr">HMR API</a> (this could be injected by the same plugin's <code>transform</code> hook):<pre class="language-js"><code class="language-js"><span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'special-update'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// perform custom update</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></ul></ul></section></section><section id="plugin-ordering"class="level2"><h2>Plugin Ordering</h2><p>A Vite plugin can additionally specify an <code>enforce</code> property (similar to webpack loaders) to adjust its application order. The value of <code>enforce</code> can be either <code>"pre"</code> or <code>"post"</code>. The resolved plugins will be in the following order:<ul><li>Alias<li>User plugins with <code>enforce: 'pre'</code><li>Vite core plugins<li>User plugins without enforce value<li>Vite build plugins<li>User plugins with <code>enforce: 'post'</code><li>Vite post build plugins (minify, manifest, reporting)</ul></section><section id="conditional-application"class="level2"><h2>Conditional Application</h2><p>By default plugins are invoked for both serve and build. In cases where a plugin needs to be conditionally applied only during serve or build, use the <code>apply</code> property to only invoke them during <code>'build'</code> or <code>'serve'</code>:<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">myPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'build-only'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">apply</span><span class="token operator">:</span> <span class="token string">'build'</span><span class="token punctuation">,</span> <span class="token comment">// or 'serve'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>A function can also be used for more precise control:<pre class="language-js"><code class="language-js"><span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> <span class="token punctuation">{</span> command <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// apply only on build but not for SSR</span>
  <span class="token keyword control-flow">return</span> command <span class="token operator">===</span> <span class="token string">'build'</span> <span class="token operator">&#x26;&#x26;</span> <span class="token operator">!</span>config<span class="token punctuation">.</span><span class="token property-access">build</span><span class="token punctuation">.</span><span class="token property-access">ssr</span>
<span class="token punctuation">}</span></code></pre></section><section id="rollup-plugin-compatibility"class="level2"><h2>Rollup Plugin Compatibility</h2><p>A fair number of Rollup plugins will work directly as a Vite plugin (e.g. <code>@rollup/plugin-alias</code> or <code>@rollup/plugin-json</code>), but not all of them, since some plugin hooks do not make sense in an unbundled dev server context.<p>In general, as long as a Rollup plugin fits the following criteria then it should just work as a Vite plugin:<ul><li>It doesn't use the <a href="https://rollupjs.org/plugin-development/#moduleparsed"><code>moduleParsed</code></a> hook.<li>It doesn't have strong coupling between bundle-phase hooks and output-phase hooks.</ul><p>If a Rollup plugin only makes sense for the build phase, then it can be specified under <code>build.rollupOptions.plugins</code> instead. It will work the same as a Vite plugin with <code>enforce: 'post'</code> and <code>apply: 'build'</code>.<p>You can also augment an existing Rollup plugin with Vite-only properties:<pre class="language-js"><code class="language-js"><span class="token comment">// vite.config.js</span>
<span class="token keyword module">import</span> <span class="token imports">example</span> <span class="token keyword module">from</span> <span class="token string">'rollup-plugin-example'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vite'</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token spread operator">...</span><span class="token method function property-access">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">apply</span><span class="token operator">:</span> <span class="token string">'build'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Check out <a href="https://vite-rollup-plugins.patak.dev">Vite Rollup Plugins</a> for a list of compatible official Rollup plugins with usage instructions.</section><section id="path-normalization"class="level2"><h2>Path Normalization</h2><p>Vite normalizes paths while resolving ids to use POSIX separators ( / ) while preserving the volume in Windows. On the other hand, Rollup keeps resolved paths untouched by default, so resolved ids have win32 separators ( \ ) in Windows. However, Rollup plugins use a <a href="https://github.com/rollup/plugins/tree/master/packages/pluginutils#normalizepath"><code>normalizePath</code> utility function</a> from <code>@rollup/pluginutils</code> internally, which converts separators to POSIX before performing comparisons. This means that when these plugins are used in Vite, the <code>include</code> and <code>exclude</code> config pattern and other similar paths against resolved ids comparisons work correctly.<p>So, for Vite plugins, when comparing paths against resolved ids it is important to first normalize the paths to use POSIX separators. An equivalent <code>normalizePath</code> utility function is exported from the <code>vite</code> module.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> normalizePath <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vite'</span>

<span class="token function">normalizePath</span><span class="token punctuation">(</span><span class="token string">'foo\\bar'</span><span class="token punctuation">)</span> <span class="token comment">// 'foo/bar'</span>
<span class="token function">normalizePath</span><span class="token punctuation">(</span><span class="token string">'foo/bar'</span><span class="token punctuation">)</span> <span class="token comment">// 'foo/bar'</span></code></pre></section><section id="filtering-includeexclude-pattern"class="level2"><h2>Filtering, include/exclude pattern</h2><p>Vite exposes <a href="https://github.com/rollup/plugins/tree/master/packages/pluginutils#createfilter"><code>@rollup/pluginutils</code>'s <code>createFilter</code></a> function to encourage Vite specific plugins and integrations to use the standard include/exclude filtering pattern, which is also used in Vite core itself.</section><section id="client-server-communication"class="level2"><h2>Client-server Communication</h2><p>Since Vite 2.9, we provide some utilities for plugins to help handle the communication with clients.<section id="server-to-client"class="level3"><h3>Server to Client</h3><p>On the plugin side, we could use <code>server.ws.send</code> to broadcast events to all the clients:<pre class="language-js"><code class="language-js"><span class="token comment">// vite.config.js</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      <span class="token function">configureServer</span><span class="token punctuation">(</span><span class="token parameter">server</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Example: wait for a client to connect before sending a message</span>
        server<span class="token punctuation">.</span><span class="token property-access">ws</span><span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          server<span class="token punctuation">.</span><span class="token property-access">ws</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">'my:greetings'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'hello'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>tip NOTE We recommend **always prefixing** your event names to avoid collisions with other plugins.<p>On the client side, use <a href="/guide/api-hmr.html#hot-on-event-cb"><code>hot.on</code></a> to listen to the events:<pre class="language-ts"><code class="language-ts"><span class="token comment">// client side</span>
<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'my:greetings'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token property-access">msg</span><span class="token punctuation">)</span> <span class="token comment">// hello</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></section><section id="client-to-server"class="level3"><h3>Client to Server</h3><p>To send events from the client to the server, we can use <a href="/guide/api-hmr.html#hot-send-event-payload"><code>hot.send</code></a>:<pre class="language-ts"><code class="language-ts"><span class="token comment">// client side</span>
<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">'my:from-client'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> msg<span class="token operator">:</span> <span class="token string">'Hey!'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><p>Then use <code>server.ws.on</code> and listen to the events on the server side:<pre class="language-js"><code class="language-js"><span class="token comment">// vite.config.js</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      <span class="token function">configureServer</span><span class="token punctuation">(</span><span class="token parameter">server</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        server<span class="token punctuation">.</span><span class="token property-access">ws</span><span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'my:from-client'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> client</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Message from client:'</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token property-access">msg</span><span class="token punctuation">)</span> <span class="token comment">// Hey!</span>
          <span class="token comment">// reply only to the client (if needed)</span>
          client<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">'my:ack'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'Hi! I got your message!'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="typescript-for-custom-events"class="level3"><h3>TypeScript for Custom Events</h3><p>It is possible to type custom events by extending the <code>CustomEventMap</code> interface:<pre class="language-ts"><code class="language-ts"><span class="token comment">// events.d.ts</span>
<span class="token keyword module">import</span> <span class="token string">'vite/types/customEvent'</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'vite/types/customEvent'</span> <span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">CustomEventMap</span></span> <span class="token punctuation">{</span>
    <span class="token string-property property">'custom:foo'</span><span class="token operator">:</span> <span class="token punctuation">{</span> msg<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span>
    <span class="token comment">// 'event-key': payload</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section></section>