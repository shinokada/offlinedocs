<!doctypehtml><html lang="en"><meta charset="utf-8"><title>Building for Production</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css"><section id="building-for-production"class="level1"><h1>Building for Production</h1><p>When it is time to deploy your app for production, simply run the <code>vite build</code> command. By default, it uses <code>&#x3C;root>/index.html</code> as the build entry point, and produces an application bundle that is suitable to be served over a static hosting service. Check out the <a href="./static-deploy">Deploying a Static Site</a> for guides about popular services.<section id="browser-compatibility"class="level2"><h2>Browser Compatibility</h2><p>The production bundle assumes support for modern JavaScript. By default, Vite targets browsers which support the <a href="https://caniuse.com/es6-module">native ES Modules</a>, <a href="https://caniuse.com/es6-module-dynamic-import">native ESM dynamic import</a>, and <a href="https://caniuse.com/mdn-javascript_operators_import_meta"><code>import.meta</code></a>:<ul><li>Chrome >=87<li>Firefox >=78<li>Safari >=13<li>Edge >=88</ul><p>You can specify custom targets via the <a href="/config/build-options.md#build-target"><code>build.target</code> config option</a>, where the lowest target is <code>es2015</code>.<p>Note that by default, Vite only handles syntax transforms and <strong>does not cover polyfills by default</strong>. You can check out <a href="https://polyfill.io/v3/">Polyfill.io</a> which is a service that automatically generates polyfill bundles based on the user's browser UserAgent string.<p>Legacy browsers can be supported via <a href="https://github.com/vitejs/vite/tree/main/packages/plugin-legacy">@vitejs/plugin-legacy</a>, which will automatically generate legacy chunks and corresponding ES language feature polyfills. The legacy chunks are conditionally loaded only in browsers that do not have native ESM support.</section><section id="public-base-path"class="level2"><h2>Public Base Path</h2><ul><li>Related: <a href="./assets">Asset Handling</a></ul><p>If you are deploying your project under a nested public path, simply specify the <a href="/config/shared-options.md#base"><code>base</code> config option</a> and all asset paths will be rewritten accordingly. This option can also be specified as a command line flag, e.g. <code>vite build --base=/my/public/path/</code>.<p>JS-imported asset URLs, CSS <code>url()</code> references, and asset references in your <code>.html</code> files are all automatically adjusted to respect this option during build.<p>The exception is when you need to dynamically concatenate URLs on the fly. In this case, you can use the globally injected <code>import.meta.env.BASE_URL</code> variable which will be the public base path. Note this variable is statically replaced during build so it must appear exactly as-is (i.e. <code>import.meta.env['BASE_URL']</code> won't work).<p>For advanced base path control, check out <a href="#advanced-base-options">Advanced Base Options</a>.</section><section id="customizing-the-build"class="level2"><h2>Customizing the Build</h2><p>The build can be customized via various <a href="/config/build-options.md">build config options</a>. Specifically, you can directly adjust the underlying <a href="https://rollupjs.org/guide/en/#big-list-of-options">Rollup options</a> via <code>build.rollupOptions</code>:<pre class="language-js"><code class="language-js"><span class="token comment">// vite.config.js</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// https://rollupjs.org/guide/en/#big-list-of-options</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>For example, you can specify multiple Rollup outputs with plugins that are only applied during build.</section><section id="chunking-strategy"class="level2"><h2>Chunking Strategy</h2><p>You can configure how chunks are split using <code>build.rollupOptions.output.manualChunks</code> (see <a href="https://rollupjs.org/guide/en/#outputmanualchunks">Rollup docs</a>). Until Vite 2.8, the default chunking strategy divided the chunks into <code>index</code> and <code>vendor</code>. It is a good strategy for some SPAs, but it is hard to provide a general solution for every Vite target use case. From Vite 2.9, <code>manualChunks</code> is no longer modified by default. You can continue to use the Split Vendor Chunk strategy by adding the <code>splitVendorChunkPlugin</code> in your config file:<pre class="language-js"><code class="language-js"><span class="token comment">// vite.config.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> splitVendorChunkPlugin <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vite'</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">splitVendorChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>This strategy is also provided as a <code>splitVendorChunk({ cache: SplitVendorChunkCache })</code> factory, in case composition with custom logic is needed. <code>cache.reset()</code> needs to be called at <code>buildStart</code> for build watch mode to work correctly in this case.</section><section id="rebuild-on-files-changes"class="level2"><h2>Rebuild on files changes</h2><p>You can enable rollup watcher with <code>vite build --watch</code>. Or, you can directly adjust the underlying <a href="https://rollupjs.org/guide/en/#watch-options"><code>WatcherOptions</code></a> via <code>build.watch</code>:<pre class="language-js"><code class="language-js"><span class="token comment">// vite.config.js</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// https://rollupjs.org/guide/en/#watch-options</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>With the <code>--watch</code> flag enabled, changes to the <code>vite.config.js</code>, as well as any files to be bundled, will trigger a rebuild.</section><section id="multi-page-app"class="level2"><h2>Multi-Page App</h2><p>Suppose you have the following source code structure:<pre class="language-text"><code class="language-text">├── package.json
├── vite.config.js
├── index.html
├── main.js
└── nested
    ├── index.html
    └── nested.js</code></pre><p>During dev, simply navigate or link to <code>/nested/</code> - it works as expected, just like for a normal static file server.<p>During build, all you need to do is to specify multiple <code>.html</code> files as entry points:<pre class="language-js"><code class="language-js"><span class="token comment">// vite.config.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> resolve <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'path'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vite'</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">nested</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'nested/index.html'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>If you specify a different root, remember that <code>__dirname</code> will still be the folder of your vite.config.js file when resolving the input paths. Therefore, you will need to add your <code>root</code> entry to the arguments for <code>resolve</code>.</section><section id="library-mode"class="level2"><h2>Library Mode</h2><p>When you are developing a browser-oriented library, you are likely spending most of the time on a test/demo page that imports your actual library. With Vite, you can use your <code>index.html</code> for that purpose to get the smooth development experience.<p>When it is time to bundle your library for distribution, use the <a href="/config/build-options.md#build-lib"><code>build.lib</code> config option</a>. Make sure to also externalize any dependencies that you do not want to bundle into your library, e.g. <code>vue</code> or <code>react</code>:<pre class="language-js"><code class="language-js"><span class="token comment">// vite.config.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> resolve <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'path'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vite'</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">lib</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// Could also be a dictionary or array of multiple entry points</span>
      <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'lib/main.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'MyLib'</span><span class="token punctuation">,</span>
      <span class="token comment">// the proper extensions will be added</span>
      <span class="token literal-property property">fileName</span><span class="token operator">:</span> <span class="token string">'my-lib'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// make sure to externalize deps that shouldn't be bundled</span>
      <span class="token comment">// into your library</span>
      <span class="token literal-property property">external</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'vue'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// Provide global variables to use in the UMD build</span>
        <span class="token comment">// for externalized deps</span>
        <span class="token literal-property property">globals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">vue</span><span class="token operator">:</span> <span class="token string">'Vue'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>The entry file would contain exports that can be imported by users of your package:<pre class="language-js"><code class="language-js"><span class="token comment">// lib/main.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Foo</span></span> <span class="token keyword module">from</span> <span class="token string">'./Foo.vue'</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Bar</span></span> <span class="token keyword module">from</span> <span class="token string">'./Bar.vue'</span>
<span class="token keyword module">export</span> <span class="token exports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Foo</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Bar</span> <span class="token punctuation">}</span></span></code></pre><p>Running <code>vite build</code> with this config uses a Rollup preset that is oriented towards shipping libraries and produces two bundle formats: <code>es</code> and <code>umd</code> (configurable via <code>build.lib</code>):<pre class="language-text"><code class="language-text">$ vite build
building for production...
dist/my-lib.js      0.08 KiB / gzip: 0.07 KiB
dist/my-lib.umd.cjs 0.30 KiB / gzip: 0.16 KiB</code></pre><p>Recommended <code>package.json</code> for your lib:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"my-lib"</span><span class="token punctuation">,</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
  <span class="token property">"files"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"dist"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"./dist/my-lib.umd.cjs"</span><span class="token punctuation">,</span>
  <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"./dist/my-lib.js"</span><span class="token punctuation">,</span>
  <span class="token property">"exports"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"."</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"import"</span><span class="token operator">:</span> <span class="token string">"./dist/my-lib.js"</span><span class="token punctuation">,</span>
      <span class="token property">"require"</span><span class="token operator">:</span> <span class="token string">"./dist/my-lib.umd.cjs"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Or, if exposing multiple entry points:<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"my-lib"</span><span class="token punctuation">,</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
  <span class="token property">"files"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"dist"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"./dist/my-lib.cjs"</span><span class="token punctuation">,</span>
  <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"./dist/my-lib.mjs"</span><span class="token punctuation">,</span>
  <span class="token property">"exports"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"."</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"import"</span><span class="token operator">:</span> <span class="token string">"./dist/my-lib.mjs"</span><span class="token punctuation">,</span>
      <span class="token property">"require"</span><span class="token operator">:</span> <span class="token string">"./dist/my-lib.cjs"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"./secondary"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"import"</span><span class="token operator">:</span> <span class="token string">"./dist/secondary.mjs"</span><span class="token punctuation">,</span>
      <span class="token property">"require"</span><span class="token operator">:</span> <span class="token string">"./dist/secondary.cjs"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>tip Note<p>If the <code>package.json</code> does not contain <code>"type": "module"</code>, Vite will generate different file extensions for Node.js compatibility. <code>.js</code> will become <code>.mjs</code> and <code>.cjs</code> will become <code>.js</code>.</p>tip Environment Variables In library mode, all `import.meta.env.*` usage are statically replaced when building for production. However, `process.env.*` usage are not, so that consumers of your library can dynamically change it. If this is undesirable, you can use `define: { 'process.env.`<wbr>`NODE_ENV': '"production"' }` for example to statically replace them.</section><section id="advanced-base-options"class="level2"><h2>Advanced Base Options</h2>warning This feature is experimental, the API may change in a future minor without following semver. Please always pin Vite's version to a minor when using it.<p>For advanced use cases, the deployed assets and public files may be in different paths, for example to use different cache strategies. A user may choose to deploy in three different paths:<ul><li>The generated entry HTML files (which may be processed during SSR)<li>The generated hashed assets (JS, CSS, and other file types like images)<li>The copied <a href="assets.md#the-public-directory">public files</a></ul><p>A single static <a href="#public-base-path">base</a> isn't enough in these scenarios. Vite provides experimental support for advanced base options during build, using <code>experimental.renderBuiltUrl</code>.<pre class="language-ts"><code class="language-ts">experimental<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function">renderBuiltUrl</span><span class="token punctuation">(</span>filename<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> hostType <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> hostType<span class="token operator">:</span> <span class="token string">'js'</span> <span class="token operator">|</span> <span class="token string">'css'</span> <span class="token operator">|</span> <span class="token string">'html'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>hostType <span class="token operator">===</span> <span class="token string">'js'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> runtime<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">window.__toCdnUrl(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> relative<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>If the hashed assets and public files aren't deployed together, options for each group can be defined independently using asset <code>type</code> included in the second <code>context</code> param given to the function.<pre class="language-ts"><code class="language-ts">experimental<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function">renderBuiltUrl</span><span class="token punctuation">(</span>filename<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> hostId<span class="token punctuation">,</span> hostType<span class="token punctuation">,</span> type <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> hostId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> hostType<span class="token operator">:</span> <span class="token string">'js'</span> <span class="token operator">|</span> <span class="token string">'css'</span> <span class="token operator">|</span> <span class="token string">'html'</span><span class="token punctuation">,</span> type<span class="token operator">:</span> <span class="token string">'public'</span> <span class="token operator">|</span> <span class="token string">'asset'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'public'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token string">'https://www.domain.com/'</span> <span class="token operator">+</span> filename
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token method function property-access">extname</span><span class="token punctuation">(</span>hostId<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'.js'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> runtime<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">window.__assetsPath(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token string">'https://cdn.domain.com/assets/'</span> <span class="token operator">+</span> filename
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>