<!doctype html><html lang="en"><meta charset="utf-8"><title>Migration from v3</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="migration-from-v3"class="level1"><h1>Migration from v3</h1><section id="rollup-3"class="level2"><h2>Rollup 3</h2><p>Vite is now using <a href="https://github.com/vitejs/vite/issues/9870">Rollup 3</a>, which allowed us to simplify Vite's internal asset handling and has many improvements. See the <a href="https://github.com/rollup/rollup/releases/tag/v3.0.0">Rollup 3 release notes here</a>.<p>Rollup 3 is mostly compatible with Rollup 2. If you are using custom <a href="../config/build-options.md#rollup-options"><code>rollupOptions</code></a> in your project and encounter issues, refer to the <a href="https://rollupjs.org/guide/en/#migration">Rollup migration guide</a> to upgrade your config.</section><section id="modern-browser-baseline-change"class="level2"><h2>Modern Browser Baseline change</h2><p>The modern browser build now targets <code>safari14</code> by default for wider ES2020 compatibility (bumped from <code>safari13</code>). This means that modern builds can now use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt"><code>BigInt</code></a> and that the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing">nullish coalescing operator</a> isn't transpiled anymore. If you need to support older browsers, you can add <a href="https://github.com/vitejs/vite/tree/main/packages/plugin-legacy"><code>@vitejs/plugin-legacy</code></a> as usual.</section><section id="general-changes"class="level2"><h2>General Changes</h2><section id="encoding"class="level3"><h3>Encoding</h3><p>The build default charset is now utf8 (see <a href="https://github.com/vitejs/vite/issues/10753">#10753</a> for details).</section><section id="importing-css-as-a-string"class="level3"><h3>Importing CSS as a String</h3><p>In Vite 3, importing the default export of a <code>.css</code> file could introduce a double loading of CSS.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports">cssString</span> <span class="token keyword module">from</span> <span class="token string">'./global.css'</span></code></pre><p>This double loading could occur since a <code>.css</code> file will be emitted and it's likely that the CSS string will also be used by the application code â€” for example, injected by the framework runtime. From Vite 4, the <code>.css</code> default export <a href="https://github.com/vitejs/vite/issues/11094">has been deprecated</a>. The <code>?inline</code> query suffix modifier needs to be used in this case, as that doesn't emit the imported <code>.css</code> styles.<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports">stuff</span> <span class="token keyword module">from</span> <span class="token string">'./global.css?inline'</span></code></pre></section><section id="production-builds-by-default"class="level3"><h3>Production Builds by Default</h3><p><code>vite build</code> will now always build for production regardless of the <code>--mode</code> passed. Previously, changing <code>mode</code> to other than <code>production</code> would result in a development build. If you wish to still build for development, you can set <code>NODE_ENV=development</code> in the <code>.env.{mode}</code> file.<p>In part of this change, <code>vite dev</code> and <code>vite build</code> will not override <code>process.env.</code><wbr><code>NODE_ENV</code> anymore if it is already defined. So if you've set <code>process.env.</code><wbr><code>NODE_ENV = 'development'</code> before building, it will also build for development. This gives more control when running multiple builds or dev servers in parallel.<p>See the updated <a href="https://vitejs.dev/guide/env-and-mode.html#modes"><code>mode</code> documentation</a> for more details.</section><section id="environment-variables"class="level3"><h3>Environment Variables</h3><p>Vite now uses <code>dotenv</code> 16 and <code>dotenv-expand</code> 9 (previously <code>dotenv</code> 14 and <code>dotenv-expand</code> 5). If you have a value including <code>#</code> or <code>`</code>, you will need to wrap them with quotes.<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">VITE_APP=ab#cd`ef
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">VITE_APP="ab#cd`ef"</span></span></code></pre><p>For more details, see the <a href="https://github.com/motdotla/dotenv/blob/master/CHANGELOG.md"><code>dotenv</code></a> and <a href="https://github.com/motdotla/dotenv-expand/blob/master/CHANGELOG.md"><code>dotenv-expand</code> changelog</a>.</section></section><section id="advanced"class="level2"><h2>Advanced</h2><p>There are some changes which only affect plugin/tool creators.<ul><li><a href="https://github.com/vitejs/vite/issues/11036">[#11036] feat(client)!: remove never implemented hot.decline</a><ul><li>use <code>hot.invalidate</code> instead</ul><li><a href="https://github.com/vitejs/vite/issues/9669">[#9669] feat: align object interface for <code>transformIndexHtml</code> hook</a><ul><li>use <code>order</code> instead of <code>enforce</code></ul></ul><p>Also there are other breaking changes which only affect few users.<ul><li><a href="https://github.com/vitejs/vite/pull/11101">[#11101] feat(ssr)!: remove dedupe and mode support for CJS</a><ul><li>You should migrate to the default ESM mode for SSR, CJS SSR support may be removed in the next Vite major.</ul><li><a href="https://github.com/vitejs/vite/pull/10475">[#10475] feat: handle static assets in case-sensitive manner</a><ul><li>Your project shouldn't rely on an OS ignoring file names casing.</ul><li><a href="https://github.com/vitejs/vite/pull/10996">[#10996] fix!: make <code>NODE_ENV</code> more predictable</a><ul><li>Refer to the PR for an explanation about this change.</ul><li><a href="https://github.com/vitejs/vite/pull/10903">[#10903] refactor(types)!: remove facade type files</a></ul></section><section id="migration-from-v2"class="level2"><h2>Migration from v2</h2><p>Check the <a href="https://v3.vitejs.dev/guide/migration.html">Migration from v2 Guide</a> in the Vite v3 docs first to see the needed changes to port your app to Vite v3, and then proceed with the changes on this page. <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>