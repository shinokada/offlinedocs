<!doctypehtml><html lang="en"><meta charset="utf-8"><title>Migration from v2</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="migration-from-v2"class="level1"><h1>Migration from v2</h1><section id="nodejs-support"class="level2"><h2>Node.js Support</h2><p>Vite no longer supports Node.js 12 / 13 / 15, which reached its EOL. Node.js 14.18+ / 16+ is now required.</section><section id="modern-browser-baseline-change"class="level2"><h2>Modern Browser Baseline change</h2><p>The production bundle assumes support for modern JavaScript. By default, Vite targets browsers which support the <a href="https://caniuse.com/es6-module">native ES Modules</a>, <a href="https://caniuse.com/es6-module-dynamic-import">native ESM dynamic import</a>, and <a href="https://caniuse.com/mdn-javascript_operators_import_meta"><code>import.meta</code></a>:<ul><li>Chrome >=87<li>Firefox >=78<li>Safari >=13<li>Edge >=88</ul><p>A small fraction of users will now require using <a href="https://github.com/vitejs/vite/tree/main/packages/plugin-legacy">@vitejs/plugin-legacy</a>, which will automatically generate legacy chunks and corresponding ES language feature polyfills.</section><section id="config-options-changes"class="level2"><h2>Config Options Changes</h2><p>The following options that were already deprecated in v2 have been removed:<ul><li><code>alias</code> (switch to <a href="../config/shared-options.md#resolve-alias"><code>resolve.alias</code></a>)<li><code>dedupe</code> (switch to <a href="../config/shared-options.md#resolve-dedupe"><code>resolve.dedupe</code></a>)<li><code>build.base</code> (switch to <a href="../config/shared-options.md#base"><code>base</code></a>)<li><code>build.brotliSize</code> (switch to <a href="../config/build-options.md#build-reportcompressedsize"><code>build.reportCompressedSize</code></a>)<li><code>build.cleanCssOptions</code> (Vite now uses esbuild for CSS minification)<li><code>build.polyfillDynamicImport</code> (use <a href="https://github.com/vitejs/vite/tree/main/packages/plugin-legacy"><code>@vitejs/plugin-legacy</code></a> for browsers without dynamic import support)<li><code>optimizeDeps.keepNames</code> (switch to <a href="../config/dep-optimization-options.md#optimizedeps-esbuildoptions"><code>optimizeDeps.esbuildOptions.keepNames</code></a>)</ul></section><section id="architecture-changes-and-legacy-options"class="level2"><h2>Architecture Changes and Legacy Options</h2><p>This section describes the biggest architecture changes in Vite v3. To allow projects to migrate from v2 in case of a compat issue, legacy options have been added to revert to the Vite v2 strategies.<section id="dev-server-changes"class="level3"><h3>Dev Server Changes</h3><p>Vite's default dev server port is now 5173. You can use <a href="../config/server-options.md#server-port"><code>server.port</code></a> to set it to 3000.<p>Vite's default dev server host is now <code>localhost</code>. In Vite v2, Vite was listening to <code>127.0.0.1</code> by default. Node.js under v17 normally resolves <code>localhost</code> to <code>127.0.0.1</code>, so for those versions, the host won't change. For Node.js 17+, you can use <a href="../config/server-options.md#server-host"><code>server.host</code></a> to set it to <code>127.0.0.1</code> to keep the same host as Vite v2.<p>Note that Vite v3 now prints the correct host. This means Vite may print <code>127.0.0.1</code> as the listening host when <code>localhost</code> is used. You can set <a href="https://nodejs.org/api/dns.html#dns_dns_setdefaultresultorder_order"><code>dns.setDefaultResultOrder('verbatim')</code></a> to prevent this. See <a href="../config/server-options.md#server-host"><code>server.host</code></a> for more details.</section><section id="ssr-changes"class="level3"><h3>SSR Changes</h3><p>Vite v3 uses ESM for the SSR build by default. When using ESM, the <a href="https://vitejs.dev/guide/ssr.html#ssr-externals">SSR externalization heuristics</a> are no longer needed. By default, all dependencies are externalized. You can use <a href="../config/ssr-options.md#ssr-noexternal"><code>ssr.noExternal</code></a> to control what dependencies to include in the SSR bundle.<p>If using ESM for SSR isn't possible in your project, you can set <code>legacy.buildSsrCjsExternalHeuristics</code> to generate a CJS bundle using the same externalization strategy of Vite v2.<p>Also <a href="https://rollupjs.org/guide/en/#outputinlinedynamicimports"><code>build.rollupOptions.output.inlineDynamicImports</code></a> now defaults to <code>false</code> when <code>ssr.target</code> is <code>'node'</code>. <code>inlineDynamicImports</code> changes execution order and bundling to a single file is not needed for node builds.</section></section><section id="general-changes"class="level2"><h2>General Changes</h2><ul><li>JS file extensions in SSR and lib mode now use a valid extension (<code>js</code>, <code>mjs</code>, or <code>cjs</code>) for output JS entries and chunks based on their format and the package type.<li>Terser is now an optional dependency. If you are using <code>build.minify: 'terser'</code>, you need to install it.<pre class="language-shell"><code class="language-shell"><span class="token function">npm</span> <span class="token function">add</span> -D terser</code></pre></ul><section id="importmetaglob"class="level3"><h3><code>import.meta.glob</code></h3><ul><li><p><a href="features.md#glob-import-as">Raw <code>import.meta.glob</code></a> switched from <code>{ assert: { type: 'raw' }}</code> to <code>{ as: 'raw' }</code><li><p>Keys of <code>import.meta.glob</code> are now relative to the current module.<pre class="language-diff"><code class="language-diff">// file: /foo/index.js
const modules = import.meta.glob('../foo/*.js')

// transformed:
const modules = {
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  '../foo/bar.js': () => {}
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  './bar.js': () => {}
</span></span>}</code></pre><li><p>When using an alias with <code>import.meta.glob</code>, the keys are always absolute.<li><p><code>import.meta.globEager</code> is now deprecated. Use <code>import.meta.glob('*', { eager: true })</code> instead.</ul></section><section id="webassembly-support"class="level3"><h3>WebAssembly Support</h3><p><code>import init from 'example.wasm'</code> syntax is dropped to prevent future collision with <a href="https://github.com/WebAssembly/esm-integration">"ESM integration for Wasm"</a>. You can use <code>?init</code> which is similar to the previous behavior.<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">import init from 'example.wasm'
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import init from 'example.wasm?init'
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">init().then((exports) => {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">init().then(({ exports }) => {
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> exports.test()
</span></span>})</code></pre></section><section id="automatic-https-certificate-generation"class="level3"><h3>Automatic https Certificate Generation</h3><p>A valid certificate is needed when using <code>https</code>. In Vite v2, if no certificate was configured, a self-signed certificate was automatically created and cached. Since Vite v3, we recommend manually creating your certificates. If you still want to use the automatic generation from v2, this feature can be enabled back by adding <a href="https://github.com/vitejs/vite-plugin-basic-ssl">@vitejs/plugin-basic-ssl</a> to the project plugins.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports">basicSsl</span> <span class="token keyword module">from</span> <span class="token string">'@vitejs/plugin-basic-ssl'</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">basicSsl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></section></section><section id="experimental"class="level2"><h2>Experimental</h2><section id="using-esbuild-deps-optimization-at-build-time"class="level3"><h3>Using esbuild deps optimization at build time</h3><p>In v3, Vite allows the use of esbuild to optimize dependencies during build time. If enabled, it removes one of the most significant differences between dev and prod present in v2. <a href="https://github.com/rollup/plugins/tree/master/packages/commonjs"><code>@rollup/plugin-commonjs</code></a> is no longer needed in this case since esbuild converts CJS-only dependencies to ESM.<p>If you want to try this build strategy, you can use <code>optimizeDeps.disabled: false</code> (the default in v3 is <code>disabled: 'build'</code>). <code>@rollup/plugin-commonjs</code> can be removed by passing <code>build.commonjsOptions: { include: [] }</code></section></section><section id="advanced"class="level2"><h2>Advanced</h2><p>There are some changes which only affect plugin/tool creators.<ul><li><a href="https://github.com/vitejs/vite/pull/5868">[#5868] refactor: remove deprecated api for 3.0</a><ul><li><code>printHttpServerUrls</code> is removed<li><code>server.app</code>, <code>server.transformWithEsbuild</code> are removed<li><code>import.meta.hot.acceptDeps</code> is removed</ul><li><a href="https://github.com/vitejs/vite/pull/6901">[#6901] fix: sequential injection of tags in transformIndexHtml</a><ul><li><code>transformIndexHtml</code> now gets the correct content modified by earlier plugins, so the order of the injected tags now works as expected.</ul><li><a href="https://github.com/vitejs/vite/pull/7995">[#7995] chore: do not fixStacktrace</a><ul><li><code>ssrLoadModule</code>'s <code>fixStacktrace</code> option's default is now <code>false</code></ul><li><a href="https://github.com/vitejs/vite/pull/8178">[#8178] feat!: migrate to ESM</a><ul><li><code>formatPostcssSourceMap</code> is now async<li><code>resolvePackageEntry</code>, <code>resolvePackageData</code> are no longer available from CJS build (dynamic import is needed to use in CJS)</ul><li><a href="https://github.com/vitejs/vite/pull/8626">[#8626] refactor: type client maps</a><ul><li>Type of callback of <code>import.meta.hot.accept</code> is now stricter. It is now <code>(mod: (Record&#x3C;string, any> &#x26; { [Symbol.toStringTag]: 'Module' }) | undefined) => void</code> (was <code>(mod: any) => void</code>).</ul></ul><p>Also there are other breaking changes which only affect few users.<ul><li><a href="https://github.com/vitejs/vite/pull/5018">[#5018] feat: enable <code>generatedCode: 'es2015'</code> for rollup build</a><ul><li>Transpile to ES5 is now necessary even if the user code only includes ES5.</ul><li><a href="https://github.com/vitejs/vite/pull/7877">[#7877] fix: vite client types</a><ul><li><code>/// &#x3C;reference lib="dom" /></code> is removed from <code>vite/client.d.ts</code>. <code>{ "lib": ["dom"] }</code> or <code>{ "lib": ["webworker"] }</code> is necessary in <code>tsconfig.json</code>.</ul><li><a href="https://github.com/vitejs/vite/pull/8090">[#8090] feat: preserve process env vars in lib build</a><ul><li><code>process.env.*</code> is now preserved in library mode</ul><li><a href="https://github.com/vitejs/vite/pull/8280">[#8280] feat: non-blocking esbuild optimization at build time</a><ul><li><code>server.force</code> option was removed in favor of <code>optimizeDeps.force</code> option.</ul><li><a href="https://github.com/vitejs/vite/pull/8550">[#8550] fix: dont handle sigterm in middleware mode</a><ul><li>When running in middleware mode, Vite no longer kills process on <code>SIGTERM</code>.</ul></ul></section><section id="migration-from-v1"class="level2"><h2>Migration from v1</h2><p>Check the <a href="https://v2.vitejs.dev/guide/migration.html">Migration from v1 Guide</a> in the Vite v2 docs first to see the needed changes to port your app to Vite v2, and then proceed with the changes on this page. <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>