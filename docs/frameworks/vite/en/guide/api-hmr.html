<!doctype html><html lang="en"><meta charset="utf-8"><title>HMR API</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="hmr-api"><h1 id="hmr-api">HMR API</h1><blockquote>Note<p>This is the client HMR API. For handling HMR update in plugins, see <a href="./api-plugin.html#handlehotupdate">handleHotUpdate</a>.<p>The manual HMR API is primarily intended for framework and tooling authors. As an end user, HMR is likely already handled for you in the framework specific starter templates.</blockquote><p>Vite exposes its manual HMR API via the special <code>import.meta.hot</code> object:<pre class="language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">ImportMeta</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">readonly</span> hot<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">ViteHotContext</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">ModuleNamespace</span></span> <span class="token operator">=</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">&#x26;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token known-class-name class-name">Symbol</span><span class="token punctuation">.</span><span class="token property-access">toStringTag</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'Module'</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">ViteHotContext</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">readonly</span> data<span class="token operator">:</span> <span class="token builtin">any</span>

  <span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
  <span class="token function">accept</span><span class="token punctuation">(</span><span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span>mod<span class="token operator">:</span> <span class="token maybe-class-name">ModuleNamespace</span> <span class="token operator">|</span> <span class="token keyword nil">undefined</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
  <span class="token function">accept</span><span class="token punctuation">(</span>dep<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span>mod<span class="token operator">:</span> <span class="token maybe-class-name">ModuleNamespace</span> <span class="token operator">|</span> <span class="token keyword nil">undefined</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
  <span class="token function">accept</span><span class="token punctuation">(</span>
    deps<span class="token operator">:</span> <span class="token keyword">readonly</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span>mods<span class="token operator">:</span> <span class="token known-class-name class-name">Array</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ModuleNamespace</span> <span class="token operator">|</span> <span class="token keyword nil">undefined</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>

  <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
  <span class="token function">prune</span><span class="token punctuation">(</span><span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
  <span class="token function">invalidate</span><span class="token punctuation">(</span>message<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>

  <span class="token comment">// `InferCustomEventPayload` provides types for built-in Vite events</span>
  <span class="token generic-function"><span class="token function">on</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
    event<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
    <span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span>payload<span class="token operator">:</span> <span class="token maybe-class-name">InferCustomEventPayload</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
  <span class="token generic-function"><span class="token function">off</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
    event<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
    <span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span>payload<span class="token operator">:</span> <span class="token maybe-class-name">InferCustomEventPayload</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
  <span class="token generic-function"><span class="token function">send</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>event<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">InferCustomEventPayload</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span></code></pre><section class="level2"aria-labelledby="required-conditional-guard"><h2 id="required-conditional-guard">Required Conditional Guard</h2><p>First of all, make sure to guard all HMR API usage with a conditional block so that the code can be tree-shaken in production:<pre class="language-js"><code class="language-js"><span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// HMR code</span>
<span class="token punctuation">}</span></code></pre></section><section class="level2"aria-labelledby="intellisense-for-typescript"><h2 id="intellisense-for-typescript">IntelliSense for TypeScript</h2><p>Vite provides type definitions for <code>import.meta.hot</code> in <a href="https://github.com/vitejs/vite/blob/main/packages/vite/client.d.ts"><code>vite/client.d.ts</code></a>. You can create an <code>env.d.ts</code> in the <code>src</code> directory so TypeScript picks up the type definitions:<pre class="language-ts"><code class="language-ts"><span class="token comment">/// &#x3C;reference types="vite/client" /></span></code></pre></section><section class="level2"aria-labelledby="hotacceptcb"><h2 id="hotacceptcb"><code>hot.accept(cb)</code></h2><p>For a module to self-accept, use <code>import.meta.hot.accept</code> with a callback which receives the updated module:<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">1</span>

<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">.</span><span class="token method function property-access">accept</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">newModule</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>newModule<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// newModule is undefined when SyntaxError happened</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'updated: count is now '</span><span class="token punctuation">,</span> newModule<span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><p>A module that "accepts" hot updates is considered an <strong>HMR boundary</strong>.<p>Vite's HMR does not actually swap the originally imported module: if an HMR boundary module re-exports imports from a dep, then it is responsible for updating those re-exports (and these exports must be using <code>let</code>). In addition, importers up the chain from the boundary module will not be notified of the change. This simplified HMR implementation is sufficient for most dev use cases, while allowing us to skip the expensive work of generating proxy modules.<p>Vite requires that the call to this function appears as <code>import.meta.hot.accept(</code> (whitespace-sensitive) in the source code in order for the module to accept update. This is a requirement of the static analysis that Vite does to enable HMR support for a module.</section><section class="level2"aria-labelledby="hotacceptdeps-cb"><h2 id="hotacceptdeps-cb"><code>hot.accept(deps, cb)</code></h2><p>A module can also accept updates from direct dependencies without reloading itself:<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> foo <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./foo.js'</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">.</span><span class="token method function property-access">accept</span><span class="token punctuation">(</span><span class="token string">'./foo.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newFoo</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// the callback receives the updated './foo.js' module</span>
    newFoo<span class="token operator">?.</span><span class="token method function property-access">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// Can also accept an array of dep modules:</span>
  <span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">.</span><span class="token method function property-access">accept</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token string">'./foo.js'</span><span class="token punctuation">,</span> <span class="token string">'./bar.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>newFooModule<span class="token punctuation">,</span> newBarModule<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// The callback receives an array where only the updated module is</span>
      <span class="token comment">// non null. If the update was not successful (syntax error for ex.),</span>
      <span class="token comment">// the array is empty</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></section><section class="level2"aria-labelledby="hotdisposecb"><h2 id="hotdisposecb"><code>hot.dispose(cb)</code></h2><p>A self-accepting module or a module that expects to be accepted by others can use <code>hot.dispose</code> to clean-up any persistent side effects created by its updated copy:<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">setupSideEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token function">setupSideEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">.</span><span class="token method function property-access">dispose</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// cleanup side effect</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></section><section class="level2"aria-labelledby="hotprunecb"><h2 id="hotprunecb"><code>hot.prune(cb)</code></h2><p>Register a callback that will call when the module is no longer imported on the page. Compared to <code>hot.dispose</code>, this can be used if the source code cleans up side-effects by itself on updates and you only need to clean-up when it's removed from the page. Vite currently uses this for <code>.css</code> imports.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">setupOrReuseSideEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token function">setupOrReuseSideEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">.</span><span class="token method function property-access">prune</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// cleanup side effect</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></section><section class="level2"aria-labelledby="hotdata"><h2 id="hotdata"><code>hot.data</code></h2><p>The <code>import.meta.hot.data</code> object is persisted across different instances of the same updated module. It can be used to pass on information from a previous version of the module to the next one.<p>Note that re-assignment of <code>data</code> itself is not supported. Instead, you should mutate properties of the <code>data</code> object so information added from other handlers are preserved.<pre class="language-js"><code class="language-js"><span class="token comment">// ok</span>
<span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">someValue</span> <span class="token operator">=</span> <span class="token string">'hello'</span>

<span class="token comment">// not supported</span>
<span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">.</span><span class="token property-access">data</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">someValue</span><span class="token operator">:</span> <span class="token string">'hello'</span> <span class="token punctuation">}</span></code></pre></section><section class="level2"aria-labelledby="hotdecline"><h2 id="hotdecline"><code>hot.decline()</code></h2><p>This is currently a noop and is there for backward compatibility. This could change in the future if there is a new usage for it. To indicate that the module is not hot-updatable, use <code>hot.invalidate()</code>.</section><section class="level2"aria-labelledby="hotinvalidatemessage-string"><h2 id="hotinvalidatemessage-string"><code>hot.invalidate(message?: string)</code></h2><p>A self-accepting module may realize during runtime that it can't handle a HMR update, and so the update needs to be forcefully propagated to importers. By calling <code>import.meta.hot.invalidate()</code>, the HMR server will invalidate the importers of the caller, as if the caller wasn't self-accepting. This will log a message both in the browser console and in the terminal. You can pass a message to give some context on why the invalidation happened.<p>Note that you should always call <code>import.meta.hot.accept</code> even if you plan to call <code>invalidate</code> immediately afterwards, or else the HMR client won't listen for future changes to the self-accepting module. To communicate your intent clearly, we recommend calling <code>invalidate</code> within the <code>accept</code> callback like so:<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">.</span><span class="token method function property-access">accept</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// You may use the new module instance to decide whether to invalidate.</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">cannotHandleUpdate</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword module">import</span><span class="token punctuation">.</span><span class="token property-access">meta</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token punctuation">.</span><span class="token method function property-access">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="hotonevent-cb"><h2 id="hotonevent-cb"><code>hot.on(event, cb)</code></h2><p>Listen to an HMR event.<p>The following HMR events are dispatched by Vite automatically:<ul><li><code>'vite:beforeUpdate'</code> when an update is about to be applied (e.g. a module will be replaced)<li><code>'vite:afterUpdate'</code> when an update has just been applied (e.g. a module has been replaced)<li><code>'vite:beforeFullReload'</code> when a full reload is about to occur<li><code>'vite:beforePrune'</code> when modules that are no longer needed are about to be pruned<li><code>'vite:invalidate'</code> when a module is invalidated with <code>import.meta.hot.invalidate()</code><li><code>'vite:error'</code> when an error occurs (e.g. syntax error)<li><code>'vite:ws:disconnect'</code> when the WebSocket connection is lost<li><code>'vite:ws:connect'</code> when the WebSocket connection is (re-)established</ul><p>Custom HMR events can also be sent from plugins. See <a href="./api-plugin.html#handlehotupdate">handleHotUpdate</a> for more details.</section><section class="level2"aria-labelledby="hotoffevent-cb"><h2 id="hotoffevent-cb"><code>hot.off(event, cb)</code></h2><p>Remove callback from the event listeners</section><section class="level2"aria-labelledby="hotsendevent-data"><h2 id="hotsendevent-data"><code>hot.send(event, data)</code></h2><p>Send custom events back to Vite's dev server.<p>If called before connected, the data will be buffered and sent once the connection is established.<p>See <a href="/guide/api-plugin.html#client-server-communication">Client-server Communication</a> for more details. <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>