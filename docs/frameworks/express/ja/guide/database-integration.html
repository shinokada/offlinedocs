<!doctype html><html lang="ja"><meta charset="utf-8"><title>Express でのデータベースの統合</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="layout"content="page"><meta name="menu"content="guide"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="データベースの統合"class="level1"><h1>データベースの統合</h1><p>データベースを Express アプリケーションに接続できるようにするには、単にデータベースに適切な Node.js ドライバーをアプリケーションにロードするだけですみます。本書では、データベース・システム用の最も一般的な Node.js モジュールを Express アプリケーションに追加して使用する方法について簡単に説明します。<ul><li><a href="#cassandra">Cassandra</a><li><a href="#couchbase">Couchbase</a><li><a href="#couchdb">CouchDB</a><li><a href="#leveldb">LevelDB</a><li><a href="#mysql">MySQL</a><li><a href="#mongodb">MongoDB</a><li><a href="#neo4j">Neo4j</a><li><a href="#oracle">Oracle</a><li><a href="#postgresql">PostgreSQL</a><li><a href="#redis">Redis</a><li><a href="#sql-server">SQL Server</a><li><a href="#sqlite">SQLite</a><li><a href="#elasticsearch">ElasticSearch</a></ul><div class="doc-box doc-notice"markdown="1"><p>上記は、使用可能な多数のデータベース・ドライバーの一部です。その他のオプションについては、<a href="https://www.npmjs.com/">npm</a> サイトで検索してください。</div><section id="cassandra"class="level2"><h2>Cassandra</h2><p><strong>モジュール</strong>: <a href="https://github.com/datastax/nodejs-driver">cassandra-driver</a><p><strong>インストール</strong><pre class="language-console"><code class="language-console">$ npm install cassandra-driver</code></pre><section id="例"class="level3"><h3>例</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> cassandra <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cassandra-driver'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">cassandra<span class="token punctuation">.</span>Client</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">contactPoints</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'localhost'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token method function property-access">execute</span><span class="token punctuation">(</span><span class="token string">'select key from system.local'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword control-flow">throw</span> err
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">rows</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section></section><section id="couchbase"class="level2"><h2>Couchbase</h2><p><strong>Module</strong>: <a href="https://github.com/couchbase/couchnode">couchnode</a><section id="インストール"class="level3"><h3>インストール</h3><pre class="language-console"><code class="language-console">$ npm install couchbase</code></pre></section><section id="例-1"class="level3"><h3>例</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> couchbase <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'couchbase'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> bucket <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">couchbase<span class="token punctuation">.</span>Cluster</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8091'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">openBucket</span><span class="token punctuation">(</span><span class="token string">'bucketName'</span><span class="token punctuation">)</span>

<span class="token comment">// add a document to a bucket</span>
bucket<span class="token punctuation">.</span><span class="token method function property-access">insert</span><span class="token punctuation">(</span><span class="token string">'document-key'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Matt'</span><span class="token punctuation">,</span> <span class="token literal-property property">shoeSize</span><span class="token operator">:</span> <span class="token number">13</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// get all documents with shoe size 13</span>
<span class="token keyword">const</span> n1ql <span class="token operator">=</span> <span class="token string">'SELECT d.* FROM `bucketName` d WHERE shoeSize = $1'</span>
<span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token maybe-class-name">N1qlQuery</span><span class="token punctuation">.</span><span class="token method function property-access">fromString</span><span class="token punctuation">(</span>n1ql<span class="token punctuation">)</span>
bucket<span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section></section><section id="couchdb"class="level2"><h2>CouchDB</h2><p><strong>モジュール</strong>: <a href="https://github.com/dscape/nano">nano</a><p><strong>インストール</strong><pre class="language-console"><code class="language-console">$ npm install nano</code></pre><section id="例-2"class="level3"><h3>例</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> nano <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'nano'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'http://localhost:5984'</span><span class="token punctuation">)</span>
nano<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token string">'books'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> books <span class="token operator">=</span> nano<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'books'</span><span class="token punctuation">)</span>

<span class="token comment">// Insert a book document in the books database</span>
books<span class="token punctuation">.</span><span class="token method function property-access">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'The Art of war'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> body</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Get a list of all books</span>
books<span class="token punctuation">.</span><span class="token method function property-access">list</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> body</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span><span class="token property-access">rows</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section></section><section id="leveldb"class="level2"><h2>LevelDB</h2><p><strong>モジュール</strong>: <a href="https://github.com/rvagg/node-levelup">levelup</a><section id="インストール-1"class="level3"><h3>インストール</h3><pre class="language-console"><code class="language-console">$ npm install level levelup leveldown</code></pre></section><section id="例-3"class="level3"><h3>例</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> levelup <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'levelup'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">levelup</span><span class="token punctuation">(</span><span class="token string">'./mydb'</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'LevelUP'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Ooops!'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

  db<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Ooops!'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section></section><section id="mysql"class="level2"><h2>MySQL</h2><p><strong>モジュール</strong>: <a href="https://github.com/felixge/node-mysql/">mysql</a><section id="インストール-2"class="level3"><h3>インストール</h3><pre class="language-console"><code class="language-console">$ npm install mysql</code></pre></section><section id="例-4"class="level3"><h3>例</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> connection <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token method function property-access">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token string">'dbuser'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'s3kreee7'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">database</span><span class="token operator">:</span> <span class="token string">'my_db'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

connection<span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span><span class="token string">'SELECT 1 + 1 AS solution'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> rows<span class="token punctuation">,</span> fields</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword control-flow">throw</span> err

  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'The solution is: '</span><span class="token punctuation">,</span> rows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">solution</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

connection<span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section></section><section id="mongodb"class="level2"><h2>MongoDB</h2><p><strong>モジュール</strong>: <a href="https://github.com/mongodb/node-mongodb-native">mongodb</a><p><strong>インストール</strong><pre class="language-console"><code class="language-console">$ npm install mongodb</code></pre><section id="例-v2"class="level3"><h3>例 (v2.*)</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token maybe-class-name">MongoClient</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">MongoClient</span></span>

<span class="token maybe-class-name">MongoClient</span><span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/animals'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> db</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword control-flow">throw</span> err

  db<span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'mammals'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword control-flow">throw</span> err

    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="例-v3"class="level3"><h3>例 (v3.*)</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token maybe-class-name">MongoClient</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">MongoClient</span></span>

<span class="token maybe-class-name">MongoClient</span><span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/animals'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> client</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword control-flow">throw</span> err

  <span class="token keyword">const</span> db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">'animals'</span><span class="token punctuation">)</span>

  db<span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'mammals'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword control-flow">throw</span> err

    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>MongoDB 用のオブジェクト・モデル・ドライバーが必要な場合は、<a href="https://github.com/LearnBoost/mongoose">Mongoose</a> を参照してください。</section></section><section id="neo4j"class="level2"><h2>Neo4j</h2><p><strong>モジュール</strong>: <a href="https://github.com/hacksparrow/apoc">apoc</a><section id="インストール-3"class="level3"><h3>インストール</h3><pre class="language-console"><code class="language-console">$ npm install apoc</code></pre></section><section id="例-5"class="level3"><h3>例</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> apoc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apoc'</span><span class="token punctuation">)</span>

apoc<span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span><span class="token string">'match (n) return n'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">fail</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>fail<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span></code></pre></section></section><section id="oracle"class="level2"><h2>Oracle</h2><p><strong>モジュール</strong>: <a href="https://github.com/oracle/node-oracledb">oracledb</a><section id="インストール-4"class="level3"><h3>インストール</h3><p>NOTE: <a href="https://github.com/oracle/node-oracledb#-installation">See installation prerequisites</a>.<pre class="language-console"><code class="language-console">$ npm install oracledb</code></pre></section><section id="例-6"class="level3"><h3>例</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> oracledb <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'oracledb'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token string">'&#x3C;your db user>'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'&#x3C;your db password>'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">connectString</span><span class="token operator">:</span> <span class="token string">'localhost:1521/orcl'</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getEmployee</span> <span class="token punctuation">(</span><span class="token parameter">empId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> conn

  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    conn <span class="token operator">=</span> <span class="token keyword control-flow">await</span> oracledb<span class="token punctuation">.</span><span class="token method function property-access">getConnection</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>

    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> conn<span class="token punctuation">.</span><span class="token method function property-access">execute</span><span class="token punctuation">(</span>
      <span class="token string">'select * from employees where employee_id = :id'</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span>empId<span class="token punctuation">]</span>
    <span class="token punctuation">)</span>

    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">rows</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Ouch!'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>conn<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// conn assignment worked, need to close</span>
      <span class="token keyword control-flow">await</span> conn<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">getEmployee</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span></code></pre></section></section><section id="postgresql"class="level2"><h2>PostgreSQL</h2><p><strong>モジュール</strong>: <a href="https://github.com/vitaly-t/pg-promise">pg-promise</a><section id="インストール-5"class="level3"><h3>インストール</h3><pre class="language-console"><code class="language-console">$ npm install pg-promise</code></pre></section><section id="例-7"class="level3"><h3>例</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> pgp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'pg-promise'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token comment">/* options */</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">pgp</span><span class="token punctuation">(</span><span class="token string">'postgres://username:password@host:port/database'</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token method function property-access">one</span><span class="token punctuation">(</span><span class="token string">'SELECT $1 AS value'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'DATA:'</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'ERROR:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section></section><section id="redis"class="level2"><h2>Redis</h2><p><strong>モジュール</strong>: <a href="https://github.com/mranney/node_redis">redis</a><section id="インストール-6"class="level3"><h3>インストール</h3><pre class="language-console"><code class="language-console">$ npm install redis</code></pre></section><section id="例-8"class="level3"><h3>例</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redis'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token method function property-access">createClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token string">'string key'</span><span class="token punctuation">,</span> <span class="token string">'string val'</span><span class="token punctuation">,</span> redis<span class="token punctuation">.</span><span class="token property-access">print</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span><span class="token method function property-access">hset</span><span class="token punctuation">(</span><span class="token string">'hash key'</span><span class="token punctuation">,</span> <span class="token string">'hashtest 1'</span><span class="token punctuation">,</span> <span class="token string">'some value'</span><span class="token punctuation">,</span> redis<span class="token punctuation">.</span><span class="token property-access">print</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span><span class="token method function property-access">hset</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hash key'</span><span class="token punctuation">,</span> <span class="token string">'hashtest 2'</span><span class="token punctuation">,</span> <span class="token string">'some other value'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> redis<span class="token punctuation">.</span><span class="token property-access">print</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token method function property-access">hkeys</span><span class="token punctuation">(</span><span class="token string">'hash key'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> replies</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>replies<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> replies:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

  replies<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reply<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>reply<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  client<span class="token punctuation">.</span><span class="token method function property-access">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section></section><section id="sql-server"class="level2"><h2>SQL Server</h2><p><strong>モジュール</strong>: <a href="https://github.com/tediousjs/tedious">tedious</a><section id="インストール-7"class="level3"><h3>インストール</h3><pre class="language-console"><code class="language-console">$ npm install tedious</code></pre></section><section id="例-9"class="level3"><h3>例</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token maybe-class-name">Connection</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tedious'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Connection</span></span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Request</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tedious'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Request</span></span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">userName</span><span class="token operator">:</span> <span class="token string">'your_username'</span><span class="token punctuation">,</span> <span class="token comment">// update me</span>
  <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'your_password'</span><span class="token punctuation">,</span> <span class="token comment">// update me</span>
  <span class="token literal-property property">server</span><span class="token operator">:</span> <span class="token string">'localhost'</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>

connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'connect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token function">executeStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">executeStatement</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">"select 123, 'hello world'"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> rowCount</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rowCount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> rows</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  request<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'row'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">columns</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    columns<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">column</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>column<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">===</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'NULL'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>column<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  connection<span class="token punctuation">.</span><span class="token method function property-access">execSql</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></section></section><section id="sqlite"class="level2"><h2>SQLite</h2><p><strong>モジュール</strong>: <a href="https://github.com/mapbox/node-sqlite3">sqlite3</a><section id="インストール-8"class="level3"><h3>インストール</h3><pre class="language-console"><code class="language-console">$ npm install sqlite3</code></pre></section><section id="例-10"class="level3"><h3>例</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> sqlite3 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sqlite3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">verbose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">sqlite3<span class="token punctuation">.</span>Database</span><span class="token punctuation">(</span><span class="token string">':memory:'</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token method function property-access">serialize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  db<span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token string">'CREATE TABLE lorem (info TEXT)'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> stmt <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token method function property-access">prepare</span><span class="token punctuation">(</span><span class="token string">'INSERT INTO lorem VALUES (?)'</span><span class="token punctuation">)</span>

  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&#x3C;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    stmt<span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Ipsum </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  stmt<span class="token punctuation">.</span><span class="token method function property-access">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  db<span class="token punctuation">.</span><span class="token method function property-access">each</span><span class="token punctuation">(</span><span class="token string">'SELECT rowid AS id, info FROM lorem'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> row</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>row<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>row<span class="token punctuation">.</span><span class="token property-access">info</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></section></section><section id="elasticsearch"class="level2"><h2>ElasticSearch</h2><p><strong>モジュール</strong>: <a href="https://github.com/elastic/elasticsearch-js">elasticsearch</a><section id="インストール-9"class="level3"><h3>インストール</h3><pre class="language-console"><code class="language-console">$ npm install elasticsearch</code></pre></section><section id="例-11"class="level3"><h3>例</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> elasticsearch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'elasticsearch'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> elasticsearch<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Client</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'localhost:9200'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token method function property-access">search</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">'books'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'book'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">multi_match</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token string">'express js'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> hits <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token property-access">hits</span><span class="token punctuation">.</span><span class="token property-access">hits</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">trace</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section></section>