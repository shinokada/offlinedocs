<!doctype html><html lang="ja"><meta charset="utf-8"><title>Express でのテンプレート・エンジンの使用</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="layout"content="page"><meta name="menu"content="guide"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="express-でのテンプレートエンジンの使用"class="level1"><h1>Express でのテンプレート・エンジンの使用</h1><p><em>テンプレートエンジン</em> を使用すると、アプリケーションで静的なテンプレートファイルを使用できます。実行時に、テンプレートエンジンはテンプレートファイルの変数を実際の値に置き換え、テンプレートをクライアントに送信するHTMLファイルに変換します。このアプローチにより、HTMLページの設計が容易になります。<p>Expressで動作する一般的なテンプレートエンジンには、<a href="https://pugjs.org/api/getting-started.html">Pug</a>、<a href="https://www.npmjs.com/package/mustache">Mustache</a>、<a href="https://www.npmjs.com/package/ejs">EJS</a>があります。<a href="../starter/generator.html">Expressアプリケーションジェネレータ</a>は<a href="https://www.npmjs.com/package/jade">Jade</a>をデフォルトとして使用しますが、いくつかの他のものもサポートしています。<p>Expressで使用できるテンプレートエンジンのリストについては、<a href="https://github.com/expressjs/express/wiki#template-engines">テンプレートエンジン (Express wiki)</a>を参照してください。また、<a href="https://strongloop.com/strongblog/compare-javascript-templates-jade-mustache-dust/">JavaScript テンプレートエンジンの比較: Jade, Mustache, Dust など</a>も参照してください。<div class="doc-box doc-notice"markdown="1"><p><strong>注</strong>：Jadeは<a href="https://www.npmjs.com/package/pug">Pug</a>に改名されました。あなたはアプリで引き続きJadeを使うことができ、うまく動くでしょう。しかしながら、テンプレートエンジンを最新のバージョンにアップデートしたい場合は、アプリでJadeをPugに置き換える必要があります。</div><p>テンプレートファイルをレンダリングするには、次の<a href="../4x/api.html#app.set">アプリケーション設定プロパティ</a>を設定し、ジェネレータで作成されたデフォルトアプリの<code>app.js</code>にセットします。<ul><li><code>views</code>はテンプレートファイルが置かれているディレクトリ。例：<code>app.set('views', './views')</code>。これは、デフォルトではアプリケーションのルートディレクトリ内の<code>views</code>ディレクトリになります<li><code>view engine</code>は使用するテンプレートエンジン。たとえば、Pugテンプレートエンジンを使用するには、<code>app.set('view engine', 'pug')</code>を使用します</ul><p>次に、対応するテンプレートエンジンnpmパッケージをインストールします。たとえばPugをインストールするには：<pre class="language-console"><code class="language-console">$ npm install pug --save</code></pre><div class="doc-box doc-notice"markdown="1"><p>Pug などの Express 対応テンプレート・エンジンは、<code>__express(filePath, options, callback)</code> という関数をエクスポートします。この関数は、テンプレート・コードをレンダリングするために <code>res.render()</code> 関数によって呼び出されます。 一部のテンプレート・エンジンは、この規則に従いません。<a href="https://www.npmjs.org/package/consolidate">Consolidate.js</a> ライブラリーは、すべての一般的な Node.js テンプレート・エンジンをマップすることで、この規則に従います。そのため、Express 内でシームレスに動作します。</div><p>ビュー・エンジンが設定された後は、アプリケーションでエンジンを指定したり、テンプレート・エンジンをロードしたりする必要はありません。(上記の例に対応した) 下記のように、Express がモジュールを内部的にロードします。<pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'pug'</span><span class="token punctuation">)</span></code></pre><p>以下の内容で <code>index.pug</code> という Pug テンプレート・ファイルを <code>views</code> ディレクトリーに作成します。<pre class="language-pug"><code class="language-pug"><span class="token tag">html</span>
  <span class="token tag">head</span>
    <span class="token tag">title</span><span class="token punctuation">=</span><span class="token code"> title</span>
  <span class="token tag">body</span>
    <span class="token tag">h1</span><span class="token punctuation">=</span><span class="token code"> message</span></code></pre><p>次に、<code>index.pug</code> ファイルをレンダリングするためのルートを作成します。<code>view engine</code> プロパティーが設定されていない場合は、<code>view</code> ファイルの拡張子を指定する必要があります。そうでない場合は、省略できます。<pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'Hey'</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'Hello there!'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>ホーム・ページに要求すると、<code>index.pug</code> ファイルは HTML としてレンダリングされます。<p>注：view engine のキャッシュは、テンプレートの出力内容をキャッシュしません。基本となるテンプレート自体だけです。このビューは、キャッシュがオンの場合でも、すべてのリクエストで再レンダリングされます。<p>Express でのテンプレート・エンジンの動作について詳しくは、<a href="../advanced/developing-template-engines.html">Express 用のテンプレート・エンジンの開発</a>を参照してください。 <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section>