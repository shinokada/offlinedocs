<!doctype html><html lang="fr"><meta charset="utf-8"><title>Serveurs proxy derrière Express</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="layout"content="page"><meta name="menu"content="guide"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="express-derrière-proxys"class="level1"><h1>Express derrière proxys</h1><p>Lorsque vous exécutez une application Express derrière un proxy, affectez à la variable d'application <code>trust proxy</code> l'une des valeurs indiquées dans le tableau suivant, en utilisant <a href="../4x/api.html#app.set">app.set()</a>.<div class="doc-box doc-info"markdown="1">L'exécution de l'application n'échouera pas si la variable d'application `trust proxy` n'est pas définie, mais l'adresse IP du proxy sera enregistrée de manière incorrecte en tant qu'adresse IP du client.``</div><table class="doctable"border="1"markdown="1"><thead><tr><th>Type<th>Valeur<tbody><tr><td>Booléen<td markdown="1">Si la valeur est `true`, l'adresse IP du client est interprétée comme étant l'entrée la plus à gauche dans l'en-tête `X-Forwarded-*`. Si la valeur est `false`, l'application est interprétée comme étant directement accessible sur Internet et l'adresse IP du client est dérivée de `req.connection.remoteAddress`. Il s'agit du paramètre par défaut.<tr><td>Adresses IP<td markdown="1">Adresse IP, sous-réseau ou tableau d'adresses IP et de sous-réseaux auxquels faire confiance. La liste suivante montre les noms de sous-réseau préconfigurés : * loopback - `127.0.0.1/8`, `::1/128` * linklocal - `169.254.0.0/16`, `fe80::/10` * uniquelocal - `10.0.0.0/8`, `172.16.0.0/12`, `192.168.0.0/16`, `fc00::/7`<p>Vous pouvez définir les adresses IP de l'une des manières suivantes :<pre><code class="language-js"translate="no">app.set('trust proxy', 'loopback') // specify a single subnet
app.set('trust proxy', 'loopback, 123.123.123.123') // specify a subnet and an address
app.set('trust proxy', 'loopback, linklocal, uniquelocal') // specify multiple subnets as CSV
app.set('trust proxy', ['loopback', 'linklocal', 'uniquelocal']) // specify multiple subnets as an array</code>
</pre><p>S'ils sont spécifiés, les sous-réseaux ou les adresses IP sont exclus du processus d'identification d'adresse, et l'adresse IP sans confiance la plus proche du serveur d'applications est identifiée comme étant l'adresse IP du client.<tr><td>Numérique<td markdown="1">Approuve le `n`ème tronçon à partir proxy de face comme étant le client.<tr><td>Fonction<td markdown="1">Implémentation de confiance personnalisée. N'utilisez cette option que si vous êtes sûr de vous.<pre><code class="language-js"translate="no">app.set('trust proxy', function (ip) {
  if (ip === '127.0.0.1' || ip === '123.123.123.123') return true; // trusted IPs
  else return false;
});</code>
</pre></table><p>La définition d'une valeur autre que <code>false</code> <code>trust proxy</code> entraîne trois modifications importantes :<ul><li markdown="1">La valeur de [req.hostname](../api.html#req.hostname) est dérivée de l'ensemble de valeurs indiqué dans l'en-tête `X-Forwarded-Host`, qui peut être défini par le client ou par le proxy.<li markdown="1">`X-Forwarded-Proto` peut être défini par le proxy inverse pour indiquer à l'application s'il s'agit de `https` ou de `http`, voire d'un nom non valide. Cette valeur est reflétée par [req.protocol](../api.html#req.protocol).<li markdown="1">Les valeurs [req.ip](../api.html#req.ip) et [req.ips](../api.html#req.ips) sont renseignées avec la liste des adresses provenant de `X-Forwarded-For`.</ul><p>Le paramètre <code>trust proxy</code> est implémenté à l'aide du package <a href="https://www.npmjs.com/package/proxy-addr">proxy-addr</a>. Pour plus d'informations, consultez la documentation associée. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section>