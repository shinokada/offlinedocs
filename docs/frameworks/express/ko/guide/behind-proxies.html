<!doctype html><html lang="ko"><meta charset="utf-8"><title>프록시 환경에서 Express 사용</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="layout"content="page"><meta name="menu"content="guide"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="프록시-환경에서-express-사용"class="level1"><h1>프록시 환경에서 Express 사용</h1><p>프록시 뒤에서 Express 앱을 실행할 때는, (<a href="../4x/api.html#app.set">app.set()</a>을 이용하여) 애플리케이션 변수 <code>trust proxy</code>를 다음 표에 나열된 값 중 하나로 설정하십시오.<div class="doc-box doc-info"markdown="1">애플리케이션 변수 `trust proxy`가 설정되지 않아도 앱은 실행되지만, `trust proxy`가 구성되지 않으면 프록시의 IP 주소가 클라이언트 IP 주소로 잘못 등록됩니다.</div><table class="doctable"border="1"markdown="1"><thead><tr><th>유형<th>값<tbody><tr><td>부울<td markdown="1">`true`인 경우, 클라이언트의 IP 주소는 `X-Forwarded-*` 내의 가장 왼쪽 입력 항목인 것으로 인식됩니다.<p><code>false</code>인 경우, 앱이 직접 인터넷에 연결되는 것으로 인식되며 클라이언트의 IP 주소는 <code>req.connection.remoteAddress</code>로부터 도출됩니다. 이 설정이 기본 설정입니다.<tr><td>IP 주소<td markdown="1">신뢰할 IP 주소나 서브넷, 또는 IP 주소 및 서브넷의 배열입니다. 아래의 목록에는 사전에 구성된 서브넷 이름이 표시되어 있습니다.<ul><li>loopback - <code>127.0.0.1/8</code>, <code>::1/128</code><li>linklocal - <code>169.254.0.0/16</code>, <code>fe80::/10</code><li>uniquelocal - <code>10.0.0.0/8</code>, <code>172.16.0.0/12</code>, <code>192.168.0.0/16</code>, <code>fc00::/7</code></ul><p>다음의 방법 중 하나로 IP 주소를 설정할 수 있습니다.<pre><code class="language-js"translate="no">app.set('trust proxy', 'loopback') // specify a single subnet
app.set('trust proxy', 'loopback, 123.123.123.123') // specify a subnet and an address
app.set('trust proxy', 'loopback, linklocal, uniquelocal') // specify multiple subnets as CSV
app.set('trust proxy', ['loopback', 'linklocal', 'uniquelocal']) // specify multiple subnets as an array</code>
</pre><p>IP 주소 또는 서브넷이 지정되는 경우, 해당 IP 주소 또는 서브넷은 주소 결정 프로세스에서 제외되며, 신뢰할 수 있는 것으로 지정되지 않은 IP 주소 중 애플리케이션 서버에서 가장 가까운 IP 주소가 클라이언트의 IP 주소로 결정됩니다.<tr><td>숫자<td markdown="1">가장 앞의 프록시 서버로부터 `n`번 째 홉을 클라이언트로서 신뢰합니다.<tr><td>함수<td markdown="1">사용자 정의 신뢰 구현입니다. 이 방법을 올바르게 숙지하고 있는 경우에만 이 방법을 사용하십시오.<pre><code class="language-js"translate="no">app.set('trust proxy', function (ip) {
  if (ip === '127.0.0.1' || ip === '123.123.123.123') return true; // trusted IPs
  else return false;
});</code>
</pre></table><p><code>trust proxy</code> 값을 <code>false</code> 이외의 값으로 설정하면 다음과 같은 세 가지의 중요한 변화가 발생합니다.<ul><li markdown="1">[req.hostname](../api.html#req.hostname)의 값은 `X-Forwarded-Host` 헤더에 설정된 값으로부터 도출되며, 이 값은 클라이언트 또는 프록시에 의해 설정될 수 있습니다.<li markdown="1">`https`인지, `http`인지, 또는 잘못된 이름인지의 여부를 앱에 알리기 위하여 역방향 프록시가 `X-Forwarded-Proto`를 설정할 수 있습니다. 이 값에는 [req.protocol](../api.html#req.protocol)이 반영됩니다.<li markdown="1">[req.ip](../api.html#req.ip) 값 및 [req.ips](../api.html#req.ips) 값에는 `X-Forwarded-For`의 주소 목록이 입력됩니다.</ul><p><code>trust proxy</code> 설정은 <a href="https://www.npmjs.com/package/proxy-addr">proxy-addr</a> 패키지를 이용해 구현됩니다. 자세한 정보는 해당 문서를 참조하십시오. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section>