<!doctype html><html lang="it"><meta charset="utf-8"><title>Express con i proxy</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="layout"content="page"><meta name="menu"content="guide"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="express-con-i-proxy"class="level1"><h1>Express con i proxy</h1><p>Quando si esegue un'applicazione Express con un proxy, impostare (utilizzando <a href="../4x/api.html#app.set">app.set()</a>) la variabile dell'applicazione <code>trust proxy</code> su uno dei valori elencati nella seguente tabella.<div class="doc-box doc-info"markdown="1">Anche se l'applicazione non presenterà errori nell'esecuzione se la variabile dell'applicazione `trust proxy` non è impostata, registrerà comunque in modo errato l'indirizzo IP del proxy come indirizzo IP del client a meno che non venga configurato `trust proxy`.</div><table class="doctable"border="1"markdown="1"><thead><tr><th>Tipo<th>Valore<tbody><tr><td>Booleano<td markdown="1">Se impostato su `true`, l'indirizzo IP del client viene considerato come la voce a sinistra dell'intestazione `X-Forwarded-*`.<p>Se impostato su <code>false</code>, significa che l'applicazione abbia una connessione diretta a Internet e l'indirizzo IP del client sia arrivato da <code>req.connection.remoteAddress</code>. Questa è l'impostazione predefinita.<tr><td>Indirizzi IP<td markdown="1">Un indirizzo IP, una subnet o un array di indirizzi IP e subnet a cui fornire attendibilità. Il seguente elenco mostra i nomi di subnet preconfigurate:<ul><li>loopback - <code>127.0.0.1/8</code>, <code>::1/128</code><li>linklocal - <code>169.254.0.0/16</code>, <code>fe80::/10</code><li>uniquelocal - <code>10.0.0.0/8</code>, <code>172.16.0.0/12</code>, <code>192.168.0.0/16</code>, <code>fc00::/7</code></ul><p>È possibile impostare gli indirizzi IP in uno dei seguenti modi:<pre><code class="language-js"translate="no">app.set('trust proxy', 'loopback') // specify a single subnet
app.set('trust proxy', 'loopback, 123.123.123.123') // specify a subnet and an address
app.set('trust proxy', 'loopback, linklocal, uniquelocal') // specify multiple subnets as CSV
app.set('trust proxy', ['loopback', 'linklocal', 'uniquelocal']) // specify multiple subnets as an array</code>
</pre><p>Quando specificati, gli indirizzi IP o le subnet vengono esclusi dal processo di determinazione dell'indirizzo e l'indirizzo IP non attendibile più vicino al server delle applicazioni viene considerato come indirizzo IP del client.<tr><td>Numero<td markdown="1">Considerare attendibile una parte del percorso `n`th dal server proxy principale come client.<tr><td>Funzione<td markdown="1">Implementazione attendibilità personalizzata. Questa funzione deve essere utilizzata solo da esperti.<pre><code class="language-js"translate="no">app.set('trust proxy', function (ip) {
  if (ip === '127.0.0.1' || ip === '123.123.123.123') return true; // trusted IPs
  else return false;
});</code>
</pre></table><p>Se si imposta un valore non <code>false</code> <code>trust proxy</code> si verificano tre importanti cambiamenti:<ul><li markdown="1">Il valore di [req.hostname](../api.html#req.hostname) viene rilevato dalla serie di valori nell'intestazione `X-Forwarded-Host`, la quale può essere impostata dal client o dal proxy.<li markdown="1">`X-Forwarded-Proto` può essere impostata dal proxy inverso per far capire all'applicazione se si tratta di `https` o `http` oppure di un nome non valido. Questo valore viene riportato da [req.protocol](../api.html#req.protocol).<li markdown="1">I valori [req.ip](../api.html#req.ip) e [req.ips](../api.html#req.ips) vengono popolati con l'elenco di indirizzi da `X-Forwarded-For`.</ul><p>L'impostazione <code>trust proxy</code> viene implementata utilizzando il pacchetto <a href="https://www.npmjs.com/package/proxy-addr">proxy-addr</a>. Per ulteriori informazioni, consultare la relativa documentazione. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section>