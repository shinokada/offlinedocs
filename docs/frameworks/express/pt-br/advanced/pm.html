<!doctype html><html lang="pt-br"><meta charset="utf-8"><title>Gerenciadores de processos para aplicativos do Express</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="layout"content="page"><meta name="menu"content="advanced"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="gerenciadores-de-processos-para-aplicativos-do-express"class="level1"><h1>Gerenciadores de processos para aplicativos do Express</h1><p>Ao executar aplicativos do Express para produção, é útil usar um <em>gerenciador de processos</em> para completar as seguintes tarefas:<ul><li><p>Reiniciar o aplicativo automaticamente se cair.<li><p>Ganhe insights sobre o desempenho em tempo de execução e o consumo de recursos.<li><p>Modifique configurações dinamicamente para melhorar o desempenho.<li><p>Controle a clusterização.</ul><p>Um gerenciador de processos é de certa forma parecido com um servidor de aplicativos: ele é um "contêiner" para aplicativos que facilita a implementação, fornece alta disponibilidade, e permite o gerenciamento do aplicativo em tempo real.<p>Os gerenciadores de processos mais populares para o Express e outros aplicativos Node.js são os seguintes:<ul><li><a href="#sl">StrongLoop Process Manager</a><li><a href="#pm2">PM2</a><li><a href="#forever">Forever</a></ul><p>Usar qualquer uma dessas três ferramentas pode ser muito útil, entretanto o StrongLoop Process Manager é a única ferramenta que fornece uma solução abrangente de tempo de execução e implementação que é atende ao ciclo de vida completo de aplicativos do Node.js, com ferramentas para todas as etapas antes e depois da produção, em uma interface unificada.<p>Aqui está uma breve visão de cada uma dessas ferramentas. Para obter uma comparação detalhada, consulte <a href="http://strong-pm.io/compare/">http://strong-pm.io/compare/</a>.<section id="a-idslstrongloop-process-managera"class="level2"><h2><a id="sl">StrongLoop Process Manager</a></h2><p>O StrongLoop Process Manager (StrongLoop PM) é um gerenciador de processos para aplicativos do Node.js. O StrongLoop PM possui balanceamento de carga, monitoramento, e implementação em múltiplos hosts integrada, e um console gráfico. É possível usar o StrongLoop PM para as seguintes tarefas:<ul><li>Construir, empacotar, e implementar aplicativos do Node.js para um sistema local ou remoto.<li>Visualizar perfis de CPU e captura instantânea de heap para otimizar o desempenho e diagnosticar fugas de memória.<li>Manter processos e clusters ativos para sempre.<li>Visualizar métricas de desempenho no seu aplicativo.<li>Facilmente gerenciar implementações em múltiplos hosts com a integração com o Nginx.<li>Unificar vários StrongLoop PMs para um tempo de execução de microsserviços distribuído que é gerenciado a partir de um Arc.</ul><p>É possível trabalhar com o StrongLoop PM usando uma poderosa ferramenta de interface da linha de comandos chamada <code>slc</code>, ou uma ferramenta gráfica chamada Arc. A Arc é um software livre, com suporte profissional fornecido pelo StrongLoop.<p>Para obter mais informações, consulte <a href="http://strong-pm.io/">http://strong-pm.io/</a>.<p>Documentação completa:<ul><li><a href="http://docs.strongloop.com/display/SLC">Aplicativos operacionais do Node (documentação do StrongLoop)</a><li><a href="http://docs.strongloop.com/display/SLC/Using+Process+Manager">Usando o StrongLoop Process Manager</a>.</ul><section id="instalação"class="level3"><h3>Instalação</h3><pre class="language-console"><code class="language-console">$ [sudo] npm install -g strongloop</code></pre></section><section id="uso-básico"class="level3"><h3>Uso Básico</h3><pre class="language-console"><code class="language-console">$ cd my-app
$ slc start</code></pre><p>Visualizar o status do Gerenciador de Processos e todos os aplicativos implementados:<pre class="language-console"><code class="language-console">$ slc ctl
Service ID: 1
Service Name: my-app
Environment variables:
  No environment variables defined
Instances:
    Version  Agent version  Cluster size
     4.1.13      1.5.14           4
Processes:
        ID      PID   WID  Listening Ports  Tracking objects?  CPU profiling?
    1.1.57692  57692   0
    1.1.57693  57693   1     0.0.0.0:3001
    1.1.57694  57694   2     0.0.0.0:3001
    1.1.57695  57695   3     0.0.0.0:3001
    1.1.57696  57696   4     0.0.0.0:3001</code></pre><p>Listar todos os aplicativos (serviços) sendo gerenciados:<pre class="language-console"><code class="language-console">$ slc ctl ls
Id          Name         Scale
 1          my-app       1</code></pre><p>Parar um aplicativo:<pre class="language-console"><code class="language-console">$ slc ctl stop my-app</code></pre><p>Reiniciar um aplicativo:<pre class="language-console"><code class="language-console">$ slc ctl restart my-app</code></pre><p>É possível também fazer uma "reinicialização leve," que dá aos processos de trabalho um período de tolerância para fechar conexões existentes, e em seguida reiniciar o aplicativo atual:<pre class="language-console"><code class="language-console">$ slc ctl soft-restart my-app</code></pre><p>Para remover um aplicativo do gerenciamento:<pre class="language-console"><code class="language-console">$ slc ctl remove my-app</code></pre></section></section><section id="a-idpm2pm2a"class="level2"><h2><a id="pm2">PM2</a></h2><p>O PM2 é um gerenciador de processos de produção para aplicativos do Node.js, que possui um balanceador de carga integrado. O PM2 permite manter os aplicativos ativos para sempre e recarregá-los sem tempo de inatividade, e facilitará tarefas comuns de administração de sistemas. O PM2 também permite que você gerencie o registro de logs, o monitoramento, e a clusterização do aplicativo.<p>Para obter mais informações, consulte: <a href="https://github.com/Unitech/pm2">https://github.com/Unitech/pm2</a>.<section id="instalação-1"class="level3"><h3>Instalação</h3><pre class="language-console"><code class="language-console">$ [sudo] npm install pm2 -g</code></pre></section><section id="uso-básico-1"class="level3"><h3>Uso Básico</h3><p>Ao iniciar um aplicativo usando o comando <code>pm2</code>, você deve especificar o caminho do aplicativo. No entanto, ao parar, reiniciar, ou excluir um aplicativo, é possível especificar apenas o nome ou o id do aplicativo.<pre class="language-console"><code class="language-console">$ pm2 start npm --name my-app -- start
[PM2] restartProcessId process id 0
┌──────────┬────┬──────┬───────┬────────┬─────────┬────────┬─────────────┬──────────┐
│ App name │ id │ mode │ pid   │ status │ restart │ uptime │ memory      │ watching │
├──────────┼────┼──────┼───────┼────────┼─────────┼────────┼─────────────┼──────────┤
│ my-app   │ 0  │ fork │ 64029 │ online │ 1       │ 0s     │ 17.816 MB   │ disabled │
└──────────┴────┴──────┴───────┴────────┴─────────┴────────┴─────────────┴──────────┘
 Use the `pm2 show &#x3C;id|name>` command to get more details about an app.</code></pre><p>Ao iniciar um aplicativo usando o comando <code>pm2</code>, o aplicativo será imediatamente enviado para o segundo plano. É possível controlar os aplicativos em segundo plano a partir da linha de comandos usando vários comandos <code>pm2</code>.<p>Após um aplicativo ser iniciado usando o comando <code>pm2</code>, ele é registrado na lista de processos do PM2 com um ID. É possível portanto gerenciar aplicativos com o mesmo nome a partir de diretórios diferentes no sistema, usando os seus IDs.<p>Observe que se mais de um aplicativo com o mesmo nome estiver executando, os comandos do <code>pm2</code> afetam todos eles. Portanto use os IDs ao invés dos nomes para gerenciar aplicativos individualmente.<p>Listar todos os processos em execução:<pre class="language-console"><code class="language-console">$ pm2 list</code></pre><p>Parar um aplicativo:<pre class="language-console"><code class="language-console">$ pm2 stop 0</code></pre><p>Reiniciar um aplicativo:<pre class="language-console"><code class="language-console">$ pm2 restart 0</code></pre><p>Para visualizar informações detalhadas sobre um aplicativo:<pre class="language-console"><code class="language-console">$ pm2 show 0</code></pre><p>Para remover um aplicativo do registro do PM2:<pre class="language-console"><code class="language-console">$ pm2 delete 0</code></pre></section></section><section id="a-idforeverforevera"class="level2"><h2><a id="forever">Forever</a></h2><p>Forever é uma ferramenta simples de interface da linha de comandos para assegurar que um dado script executa continuamente (para sempre). A interface simples do Forever torna-o ideal para a execução de implementações menores dos aplicativos e scripts do Node.js.<p>Para obter mais informações, consulte: <a href="https://github.com/foreverjs/forever">https://github.com/foreverjs/forever</a>.<section id="instalação-2"class="level3"><h3>Instalação</h3><pre class="language-console"><code class="language-console">$ [sudo] npm install forever -g</code></pre></section><section id="uso-básico-2"class="level3"><h3>Uso Básico</h3><p>Para iniciar um script, use o comando <code>forever start</code> e especifique o caminho do script:<pre class="language-console"><code class="language-console">$ forever start script.js</code></pre><p>Este comando irá executar o script em modo daemon (no segundo plano).<p>Para executar o script de forma que ele seja anexado ao terminal, omita <code>start</code>:<pre class="language-console"><code class="language-console">$ forever script.js</code></pre><p>É uma boa ideia registrar os logs da saída da ferramenta Forever e do script usando as opções de log <code>-l</code>, <code>-o</code>, e <code>-e</code>, como mostradas nesse exemplo:<pre class="language-console"><code class="language-console">$ forever start -l forever.log -o out.log -e err.log script.js</code></pre><p>Para visualizar a lista de scripts que foram iniciados pelo Forever:<pre class="language-console"><code class="language-console">$ forever list</code></pre><p>Para parar um script que foi iniciado pelo Forever use o comando <code>forever stop</code> e especifique o índice do processo (conforme listado pelo comando <code>forever list</code>).<pre class="language-console"><code class="language-console">$ forever stop 1</code></pre><p>Alternativamente, especifique o caminho do arquivo:<pre class="language-console"><code class="language-console">$ forever stop script.js</code></pre><p>Para parar todos os scripts que foram iniciados pelo Forever:<pre class="language-console"><code class="language-console">$ forever stopall</code></pre><p>O Forever possui muitas outras opções, e ele também fornece uma API programática.<p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section></section>