<!doctype html><html lang="pt-br"><meta charset="utf-8"><title>Contexto e Auxiliadores</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="description"content="O contexto fornece informações adicionais e muitas vezes informações opcionais sobre a requisição atual para a aplicação."><meta name="category"content="concepts"><meta name="csb_link_context"content="https://codesandbox.io/embed/github/nuxt-academy/guides-examples/tree/master/02_concepts/02_context_helpers-context?fontsize=14&#x26;hidenavigation=1&#x26;theme=dark"><meta name="csb_link_helpers"content="https://codesandbox.io/embed/github/nuxt-academy/guides-examples/tree/master/02_concepts/02_context_helpers-helpers?fontsize=14&#x26;hidenavigation=1&#x26;theme=dark"><link rel="stylesheet"type="text/css"href="../../../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="contexto-e-auxiliadores"><h1 id="contexto-e-auxiliadores">Contexto e auxiliadores</h1><p>O contexto fornece <em>informações adicionais</em> e muitas vezes informações opcionais sobre a requisição atual para a aplicação.<hr><p><img src="../docs/context.svg"><p>O objeto <code>contexto</code> está disponível em funções específicas do Nuxt como <a href="./features/data-fetching#async-data">asyncData</a>, <a href="./directory-structure/plugins">plugins</a>, <a href="./directory-structure/middleware">middleware</a> e <a href="./directory-structure/store#the-nuxtserverinit-action">nuxtServerInit</a>. Ele fornece <em>informações adicionais</em> e muitas vezes informações sobre a requisição atual para a aplicação.<p>Em primeiro lugar, o contexto é usado para fornecer acesso a outras partes da aplicação Nuxt, ex. o Vuex store ou a instância <code>connect</code>. Dessa forma, temos os objetos <code>req</code> e <code>res</code> disponíveis no contexto no lado do servidor e o <code>store</code> sempre disponível. Mas com o tempo, o contexto foi estendido com muitas outras variáveis ​​e atalhos úteis. Agora temos acesso ao HMR (Hot Module Reload/Replacement) em modo de desenvolvimento, a rota atual (<code>route</code>), parâmetros da página (<code>params</code> e <code>query</code>), também a opção de acessar variáveis ​​de ambiente por meio do contexto. Além disso funções de módulos e auxiliares podem ser expostos por meio do contexto para estarem disponíveis em ambos - no lado do cliente e do servidor.<p><strong>Todas as chaves de contexto que são disponíveis por padrão</strong><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Pode ser asyncData ou nuxtServerInit</span>
  <span class="token comment">// Sempre disponível</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">,</span>
    store<span class="token punctuation">,</span>
    route<span class="token punctuation">,</span>
    params<span class="token punctuation">,</span>
    query<span class="token punctuation">,</span>
    env<span class="token punctuation">,</span>
    isDev<span class="token punctuation">,</span>
    isHMR<span class="token punctuation">,</span>
    redirect<span class="token punctuation">,</span>
    error<span class="token punctuation">,</span>
    $config
  <span class="token punctuation">}</span> <span class="token operator">=</span> context

  <span class="token comment">// Disponível apenas no lado do servidor</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token property-access">server</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> beforeNuxtRender <span class="token punctuation">}</span> <span class="token operator">=</span> context
  <span class="token punctuation">}</span>

  <span class="token comment">// Disponível apenas no lado do cliente</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token property-access">client</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword module">from</span><span class="token punctuation">,</span> nuxtState <span class="token punctuation">}</span> <span class="token operator">=</span> context
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><section class="level4"aria-labelledby="warning"><h4 id="warning">Warning</h4><p>O <em>context</em> que nos referimos aqui não deve ser confundido com o objeto de contexto disponível em Ações Vuex ou aquele disponível na função <code>build.context</code> no seu <code>nuxt.config.js</code>. Eles não estão relacionados entre si!<p>Aprenda mais sobre as diferentes chaves de contexto no nosso <a href="./internals-glossary/context">Glossário Interno</a></section><section class="level3"aria-labelledby="usando-parâmetros-de-página-para-consulta-em-sua-api"><h3 id="usando-parâmetros-de-página-para-consulta-em-sua-api">Usando parâmetros de página para consulta em sua API</h3><p>O contexto expõe diretamente os possíveis parâmetros dinâmicos da rota através do <code>context.params</code>. No exemplo a seguir, chamamos uma API através do módulo <code>nuxt/http</code> utilizando um parâmetro de página dinâmicos como parte da URL. Os módulos, como o módulo <a href="https://http.nuxtjs.org/">nuxt/http</a>, podem expor funções próprias que estão então disponíveis através do objeto <a href="./internals-glossary/context#app">context.app</a>.<p>Além disso, nós envolvemos a chama da API em uma declaração <code>try/catch</code> para tratar possíveis erros. Com a função <code>context.error</code>, podemos mostrar diretamente a Página de Erro do Nuxt e passar no erro ocorrido.<pre class="language-js{}[pages/posts/_id.vue]"><code class="language-js{}[pages/posts/_id.vue]">export default {
  async asyncData(context) {
    const id = context.params.id
    try {
      // Usando o módulo nuxtjs/http exposto via context.app
      const post = await context.app.$http.$get(
        `https://api.nuxtjs.dev/posts/${id}`
      )
      return { post }
    } catch (e) {
      context.error(e) // Mostrando a página de erro do Nuxt
    }
  }
}</code></pre><p>Com o <a href="https://hacks.mozilla.org/2015/05/es6-in-depth-destructuring">ES6</a> você poda usar essa sintaxe para desestruturar o seu objeto do contexto. Você pode passar nos objetos aos quais deseja ter acesso e depois usá-los no código sem usar a palavra contexto.<pre class="language-js{}[pages/posts/_id.vue]"><code class="language-js{}[pages/posts/_id.vue]">export default {
  async asyncData({ params, $http, error }) {
    const id = params.id

    try {
      // Usando o modulo nuxtjs/http exposto através do context.app
      const post = await $http.$get(`https://api.nuxtjs.dev/posts/${id}`)
      return { post }
    } catch (e) {
      error(e) // Mostrando a página de erro do Nuxt
    }
  }
}</code></pre><p>Quer usar query params? Você usará <a href="./internals-glossary/context#query">context.query.id</a></section><section class="level3"aria-labelledby="redirecionando-usuários-e-acessando-o-store"><h3 id="redirecionando-usuários-e-acessando-o-store">Redirecionando usuários e acessando o store</h3><p>Também é possível acessar o <a href="./directory-structure/store">Vuex store</a> (quando você tiver configurando o diretório <code>store</code>) através do contexto. Ele fornece um objeto <code>store</code> que pode ser tratado como <code>this.$store</code> nos componentes Vue. Além disso, utilizamos o método <code>redirect</code>, um auxiliador exporto através do contexto, para redirecionar o usuário caso o estado <code>authenticated</code> seja <a href="https://developer.mozilla.org/pt-BR/docs/Glossary/Falsy">falso</a>.<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token function">middleware</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> store<span class="token punctuation">,</span> redirect <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Recuperando chaves através de desestruturação de objetos</span>
    <span class="token keyword">const</span> isAuthenticated <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">authenticated</span>

    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isAuthenticated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><section class="level4"aria-labelledby="next"><h4 id="next">Next</h4><p>Consulte o Glossário Interno para mais exemplo do <a href="./internals-glossary/context#redirect">método redirect</a></section></section><section class="level2"aria-labelledby="auxiliadores"><h2 id="auxiliadores">Auxiliadores</h2><p>Além dos atalhos no contexto, há também outros pequenos auxiliadores presentes na sua aplicação Nuxt.</section><section class="level2"aria-labelledby="nuxt-o-auxiliador-do-nuxt"><h2 id="nuxt-o-auxiliador-do-nuxt"><code>$nuxt</code>: O Auxiliador do Nuxt</h2><p>O <code>$nuxt</code> é um auxiliador projetado para melhorar a experiência do usuário para ser uma válvula de escape em algumas situações. Pode ser acessado através de <code>this.$nuxt</code> nos componente Vue e através de <code>window.$nuxt</code> no lado do cliente.<section class="level3"aria-labelledby="verificador-de-conexão"><h3 id="verificador-de-conexão">Verificador de conexão</h3><p>O auxiliador <code>$nuxt</code> oferece uma maneira rápida de descobrir se a conexão de internet do usuário está presente ou não: Expõe os valores booleanos <code>isOffline</code> e <code>isOnline</code>. Podemos utilizá-los para mostrar uma mensagem assim que o usuário estiver offline (por exemplo).<pre class="language-html{}[layouts/default.vue]"><code class="language-html{}[layouts/default.vue]">&#x3C;template>
  &#x3C;div>
    &#x3C;div v-if="$nuxt.isOffline">Você está offline&#x3C;/div>
    &#x3C;Nuxt />
  &#x3C;/div>
&#x3C;/template></code></pre></section><section class="level3"aria-labelledby="acessando-a-instância-raiz"><h3 id="acessando-a-instância-raiz">Acessando a instância raiz</h3><p>Além de fornecer características DX/UX (Developer Experience/User Experience), o auxiliador <code>$nuxt</code> também fornece um atalho para a instância raiz da sua aplicação em qualquer componente. Mas isso não é tudo - você também pode acessar o auxiliador <code>$nuxt</code> através de <code>window.$nuxt</code> que pode ser usado como uma válvula de escape para obter acesso ao métodos dos módulos como <code>$axios</code> de fora dos seus componentes Vue. Isso deve ser usado com muito cuidado e <strong>apenas como último recurso</strong>.</section><section class="level3"aria-labelledby="atualização-dos-dados-da-página"><h3 id="atualização-dos-dados-da-página">Atualização dos dados da página</h3><p>Quando você quiser atualizar a página atual para o usuário, mas você não quer recarregar totalmente a página, pois poderá fazer uma chamada ao servidor novamente ou pelo menos reiniciar toda a aplicação Nuxt. Em vez disso, muitas vezes você só deseja atualizar os dados, fornecidos por <code>asyncData</code> ou <code>fetch</code>.<p>Você pode fazer isso, usando <code>this.$nuxt.refresh()</code><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span><span class="token punctuation">></span></span>{{ content }}<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>refresh<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Atualizar<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>template</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
    <span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'Iniciado em:'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">$nuxt</span><span class="token punctuation">.</span><span class="token method function property-access">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span></code></pre><section class="level4"aria-labelledby="controlando-a-barra-de-carregamento"><h4 id="controlando-a-barra-de-carregamento">Controlando a barra de carregamento</h4><p>Com <code>$nuxt</code>, você pode controlar a barra de carregamento do Nuxt através de <code>this.$nuxt.$loading</code>.<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">$nuxt</span><span class="token punctuation">.</span><span class="token property-access">$loading</span><span class="token punctuation">.</span><span class="token method function property-access">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">$nuxt</span><span class="token punctuation">.</span><span class="token property-access">$loading</span><span class="token punctuation">.</span><span class="token method function property-access">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Leia mais em <a href="./features/loading">características de carregamento</a>.</section></section></section><section class="level2"aria-labelledby="auxiliador-onnuxtready"><h2 id="auxiliador-onnuxtready">Auxiliador onNuxtReady</h2><p>Se você quiser executar alguns script <em>após</em> sua aplicação Nuxt ser carregada e estiver pronta, você pode usar a função <code>window.onNuxtReady</code>. Ela pode ser útil quando você quiser executar uma função no lado do cliente sem aumentar o tempo de interação de seu site.<pre class="language-js"><code class="language-js"><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">onNuxtReady</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Nuxt está pronto e montado!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="auxiliadores-de-processos"><h2 id="auxiliadores-de-processos">Auxiliadores de processos</h2><p>Nuxt injeta três valores booleanos (<code>client</code>, <code>server</code>, <code>status</code>) no objeto global <code>process</code> que pode ajudar você a determinar se sua aplicação foi renderizada no servidor ou totalmente no cliente, bem como verificar a geração estática do site. Esses auxiliadores estão disponíveis em toda a sua aplicação e são frequentemente mais utilizados em código <code>asyncData</code> na área do usuário.<pre class="language-html{}[pages/about.vue]"><code class="language-html{}[pages/about.vue]">&#x3C;template>
  &#x3C;h1>Eu fui renderizado no lado do {{ renderedOn }}&#x3C;/h1>
&#x3C;/template>

&#x3C;script>
  export default {
    asyncData() {
      return { renderedOn: process.client ? 'cliente' : 'servidor' }
    }
  }
&#x3C;/script></code></pre><p>Nesse exemplo, <code>renderedOn</code> retornará <code>'servidor'</code> quando estiver sendo utilizado no lado do servidor e um usuário acessa a página diretamente. Quando o usuário navegar para um página a partir de outra parte da aplicação, por exemplo, clicando em um <code>&#x3C;NuxtLink></code>, será retornado <code>'cliente'</code>. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>