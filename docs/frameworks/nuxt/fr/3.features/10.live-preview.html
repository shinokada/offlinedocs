<!doctype html><html lang="fr"><meta charset="utf-8"><title>Mode de prévisualisation</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="description"content="Prévisualisation en temps réel pour une génération statique avec le mode de prévisualisation"><meta name="category"content="features"><link rel="stylesheet"type="text/css"href="../../../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="mode-de-prévisualisation"><h1 id="mode-de-prévisualisation">Mode de prévisualisation</h1><p>Avec Nuxt et une génération axée sur de l'intégralement statique, nous pouvons maintenant utiliser la prévisualisation en temps réel, sans configuration additionnelle. Cela nous permettra d'appeler notre API ou notre CMS afin que nous puissions voir les changements avant de déployer.<hr><section class="level4"aria-labelledby="info"><h4 id="info">Info</h4><p>Seulement disponible dans le cas d'un <a href="./features/deployment-targets#static-hosting">target:static</a><p>Le mode de prévisualisation va s'occuper de rafraîchir automatiquement la data de la page vu qu'il utilise <code>$nuxt.refresh</code> (et donc fait les appels de <code>nuxtServerInit</code>, <code>asyncData</code> et <code>fetch</code>) du côté client.<p>Pour activer la prévisualisation en temps réel, il faudra ajouter le plugin suivant:<pre class="language-js{}[plugins/preview.client.js]"><code class="language-js{}[plugins/preview.client.js]">export default function ({ query, enablePreview }) {
  if (query.preview) {
    enablePreview()
  }
}</code></pre></section><section class="level4"aria-labelledby="info-1"><h4 id="info-1">Info</h4><p><code>EnablePreview</code> est seulement disponible dans l'objet contexte des plugins. Les prévisualisations sont gérées côté client et donc, le plugin doit s'exécuter sur le client: <code>preview.client.js</code><pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">export default {
  plugins: ['~/plugins/preview.client.js']
}</code></pre><p>Une fois que l'on a ajouté le plugin, on peut maintenant générer et servir notre site.<pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> generate
<span class="token function">yarn</span> start</code></pre><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> run generate
<span class="token function">npm</span> run start</code></pre><p>Nous pouvons maintenant voir la page de prévisualisation en ajoutant une query param à la fin de la page qui nous intéresse:<pre class="language-js"><code class="language-js"><span class="token operator">?</span>preview<span class="token operator">=</span><span class="token boolean">true</span></code></pre></section><section class="level4"aria-labelledby="info-2"><h4 id="info-2">Info</h4><p><code>enablePreview</code> doit être testé localement avec <code>yarn start</code> et non <code>yarn dev</code></section><section class="level3"aria-labelledby="prévisualiser-les-pages-qui-ne-sont-pas-encore-générées"><h3 id="prévisualiser-les-pages-qui-ne-sont-pas-encore-générées">Prévisualiser les pages qui ne sont pas encore générées</h3><p>Pour les pages qui ne sont pas encore générées, la solution de rechange de la SPA va continuer de s'occuper de faire un appel à l'API avant de montrer une page 404 vu que ces pages existent sur l'API mais ne sont pas encore générées.<p>Si nous avons configuré un crochet de validation (webhook), on aura sans doute besoin de le modifier afin d'accommoder le fait qu'il ne redirige plus vers une 404 en mode de prévisualisation.<pre class="language-js"><code class="language-js"><span class="token function">validate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params<span class="token punctuation">,</span> query <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token property-access">preview</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span></code></pre></section><section class="level3"aria-labelledby="passer-la-data-à-enablepreview"><h3 id="passer-la-data-à-enablepreview">Passer la data à enablePreview</h3><p>On peut passer de la data à la fonction <code>enablePreview</code>. La data sera ainsi disponible sur le helper de contexte <code>$preview</code> et sur <code>this.$preview</code>.</section><section class="level3"aria-labelledby="et-ensuite-"><h3 id="et-ensuite-">Et ensuite ?</h3><section class="level4"aria-labelledby="next"><h4 id="next">Next</h4><p>Se référer au <a href="./directory-structure/nuxt">document sur la structure des répertoires</a>.<p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section></section>