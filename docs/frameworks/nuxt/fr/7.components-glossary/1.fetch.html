<!doctype html><html lang="fr"><meta charset="utf-8"><title>La méthode fetch</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="description"content="La méthode fetch est utilisée pour remplir le store avant de render la page, c&#x27;est similaire à &#x60;asyncData&#x60; sauf que cela ne remplit pas le &#x60;data&#x60; du composant."><meta name="navigation.title"content="La méthode fetch"><meta name="category"content="components-glossary"><link rel="stylesheet"href="../../../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="la-méthode-fetch"><h1 id="la-méthode-fetch">La méthode fetch</h1><p>La méthode fetch est utilisée pour remplir le store avant de render la page, c'est similaire à <code>asyncData</code> sauf que cela ne remplit pas le <code>data</code> du composant.<hr><section class="level2"aria-labelledby="nuxt--212"><h2 id="nuxt--212">Nuxt >= 2.12</h2><p>Avec l'arrivée de la <code>v2.12</code> de Nuxt, nous avons droit à un nouveau hook disponible dans <strong>tous les composants Vue</strong>: <code>fetch</code>.<section class="level4"aria-labelledby="info"><h4 id="info">Info</h4><p><code>fetch(context)</code> a été déprécié, à la place on peut utiliser un <a href="./components-glossary/middleware#middleware-anonyme">middleware anonyme</a> dans la page: <code>middleware(context)</code></section><section class="level3"aria-labelledby="quand-utiliser-fetch"><h3 id="quand-utiliser-fetch">Quand utiliser fetch?</h3><p>À chaque fois que l'on a besoin d'avoir de la data <strong>asynchrone</strong>. <code>fetch</code> est appelé côté serveur pour render les routes et côté client lors de la navigation.<p>Il expose <code>$fetchState</code> au niveau du composant:<ul><li><code>$fetchState.pending</code>: <code>Boolean</code>, permet d'afficher un placeholder pendant que fetch est appelé (côté client).<li><code>$fetchState.error</code>: <code>null</code> ou <code>Error</code>, vous permet d'afficher un message d'erreur<li><code>$fetchState.timestamp</code>: <code>Integer</code>, l'horodatage du dernier fetch, utile en combinaison avec <code>keep-alive</code> pour de la mise en cache.</ul><p>Si vous souhaitez appeler le hook <code>fetch</code> depuis votre template, utilisez:<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$fetch<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Rafraîchir<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span></code></pre><p>ou la méthode dans le composant:<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// méthode dans la section script</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">$fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>On peut accéder au <a href="./internals-glossary/context">context</a> de Nuxt à l'intérieur du hook <code>fetch</code> en utilisant <code>this.$nuxt.context</code>.</section><section class="level3"aria-labelledby="options"><h3 id="options">Options</h3><ul><li><code>fetchOnServer</code>: <code>Boolean</code> ou <code>Function</code> (par défaut: <code>true</code>), appelle <code>fetch()</code> lors d'un render de page côté serveur<li><code>fetchDelay</code>: <code>Integer</code> (défaut: <code>200</code>), définit un temps d'exécution minimal en millisecondes (pour éviter les flashs)</ul><section class="level4"aria-labelledby="info-1"><h4 id="info-1">Info</h4><p>Quand <code>fetchOnServer</code> est falsy (<code>false</code> ou retourne <code>false</code>), <code>fetch</code> sera appelé uniquement côté client et <code>$fetchState.pending</code> retournera <code>true</code> lors d'un render côté serveur du composant.<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">posts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">posts</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">$http</span><span class="token punctuation">.</span><span class="token method function property-access">$get</span><span class="token punctuation">(</span>
        <span class="token string">'https://jsonplaceholder.typicode.com/posts'</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">fetchOnServer</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span></code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section></section></section>