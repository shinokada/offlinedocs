<!doctype html><html lang="pt"><meta charset="utf-8"><title>Contexto e Auxiliares</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="description"content="O contexto fornece informações adicionais e frequentemente opcionais sobre a requisição atual à aplicação."><meta name="category"content="concepts"><meta name="csb_link_context"content="https://codesandbox.io/embed/github/nuxt-academy/guides-examples/tree/master/02_concepts/02_context_helpers-context?fontsize=14&#x26;hidenavigation=1&#x26;theme=dark"><meta name="csb_link_helpers"content="https://codesandbox.io/embed/github/nuxt-academy/guides-examples/tree/master/02_concepts/02_context_helpers-helpers?fontsize=14&#x26;hidenavigation=1&#x26;theme=dark"><link rel="stylesheet"type="text/css"href="../../../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="contexto-e-auxiliares"><h1 id="contexto-e-auxiliares">Contexto e Auxiliares</h1><p>O contexto fornece informações <strong>adicionais</strong> e frequentemente opcionais sobre a requisição atual à aplicação.<hr><p><img src="../docs/context.svg"><p>O objeto <code>context</code> está disponível em funções de Nuxt específicas como <a href="./features/data-fetching#async-data"><code>asyncData</code></a>, <a href="./directory-structure/plugins"><code>plugins</code></a>, <a href="./directory-structure/middleware"><code>middleware</code></a> e <a href="./directory-structure/store#a-a%C3%A7%C3%A3o-nuxtserverinit"><code>nuxtServerInit</code></a>. Este fornece à aplicação informações <em>adicionais</em> e muitas vezes opcionais sobre a requisição atual.<p>Primeiro e mais importante, o contexto é utilizado para fornecer acesso a outras partes da aplicação da Nuxt, por exemplo, o armazém de estado da Vuex ou a instância subjacente <code>connect</code>. Desta maneira, temos os objetos <code>req</code> e <code>res</code> do contexto disponível no lado do servidor e o <code>store</code> sempre disponível. Mas com o tempo, o contexto foi estendido com muitas outras variáveis e atalhos úteis. Agora temos acesso às funcionalidades da substituição de módulo instantânea em modo de <code>development</code>, a <code>route</code> atual, <code>params</code> e <code>query</code> da página, bem como a opção de acessar as variáveis de ambiente através do contexto. Além disto, as funções do módulo e os auxiliares podem ser expostos através do contexto para estarem disponíveis tanto no lado do cliente como no lado do servidor.<p><strong>Todas as chaves de contexto que estão presentes por padrão</strong><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Poderia ser `asyncData`, `nuxtServerInit`, ...</span>
  <span class="token comment">// Sempre disponíveis</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">,</span>
    store<span class="token punctuation">,</span>
    route<span class="token punctuation">,</span>
    params<span class="token punctuation">,</span>
    query<span class="token punctuation">,</span>
    env<span class="token punctuation">,</span>
    isDev<span class="token punctuation">,</span>
    isHMR<span class="token punctuation">,</span>
    redirect<span class="token punctuation">,</span>
    error<span class="token punctuation">,</span>
    $config
  <span class="token punctuation">}</span> <span class="token operator">=</span> context

  <span class="token comment">// Disponíveis apenas no lado do servidor</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token property-access">server</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> beforeNuxtRender <span class="token punctuation">}</span> <span class="token operator">=</span> context
  <span class="token punctuation">}</span>

  <span class="token comment">// Disponíveis apenas no lado do cliente</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token property-access">client</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword module">from</span><span class="token punctuation">,</span> nuxtState <span class="token punctuation">}</span> <span class="token operator">=</span> context
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><section class="level4"aria-labelledby="warning"><h4 id="warning">Warning</h4><p>O <em>contexto</em> a que nos referimos neste artigo não deve ser confundido com o objeto <code>context</code> disponível nas <a href="https://vuex.vuejs.org/guide/actions.html">Ações de Vuex</a> ou aquele disponível na função <code>build.extend</code> no nosso <code>nuxt.config.js</code>. Estes não estão relacionados entre si!<p>Saber mais sobre as diferentes chaves de contexto no nosso <a href="./internals-glossary/context">Glossário Interno</a>.</section><section class="level3"aria-labelledby="utilizar-parâmetros-de-página-para-a-nossa-consulta-de-api"><h3 id="utilizar-parâmetros-de-página-para-a-nossa-consulta-de-api">Utilizar parâmetros de página para a nossa consulta de API</h3><p>O contexto expõe diretamente os possíveis parâmetros dinâmicos da rota por meio de <code>context.params</code>. No exemplo seguinte, chamamos uma interface de programação de aplicação através do módulo <code>nuxt/http</code> utilizando um parâmetro de página dinâmico como parte do endereço de localização de recurso (URL). Os módulos, como o módulo <a href="https://http.nuxtjs.org/"><code>nuxt/http</code></a>, podem expor as suas próprias funções, que ficam então disponíveis através do objeto <a href="./internals-glossary/context#app"><code>context.app</code></a>.<p>Além disto, embrulhamos a chamada à interface de programação de aplicação numa instrução <code>try/catch</code> para lidar com potenciais erros. Com a função <code>context.error</code>, podemos mostrar diretamente a página de erro da Nuxt e passar o erro ocorrido:<pre class="language-js{}[pages/posts/_id.vue]"><code class="language-js{}[pages/posts/_id.vue]">export default {
  async asyncData(context) {
    const id = context.params.id
    try {
      // Usar o módulo `nuxtjs/http` aqui exposto por `context.app`
      const post = await context.app.$http.$get(
        `https://api.nuxtjs.dev/posts/${id}`
      )
      return { post }
    } catch (e) {
      // Mostrar a página de erro seguinte com o erro lançado
      context.error(e)
    }
  }
}</code></pre><p>Com a <a href="https://hacks.mozilla.org/2015/05/es6-in-depth-destructuring/">ECMAScript 6</a>, podemos utilizar esta sintaxe para desestruturar o nosso objeto de contexto. Podemos passar os objetos a que queremos ter acesso e depois podemos utilizá-los no código sem utilizar a palavra <code>context</code>.<pre class="language-js{}[pages/posts/_id.vue]"><code class="language-js{}[pages/posts/_id.vue]">export default {
  async asyncData({ params, $http, error }) {
    const id = params.id

    try {
      // Usar o módulo `nuxtjs/http` aqui exposto por `context.app`
      const post = await $http.$get(`https://api.nuxtjs.dev/posts/${id}`)
      return { post }
    } catch (e) {
      // Mostrar a página de erro seguinte com o erro lançado
      error(e)
    }
  }
}</code></pre><p>Em vez disto, queremos utilizar parâmetros de consulta? Podemos então utilizar <a href="./internals-glossary/context#query"><code>context.query.id</code></a>.</section><section class="level3"aria-labelledby="redirecionar-os-utilizares-e-acessar-o-armazém-de-estado"><h3 id="redirecionar-os-utilizares-e-acessar-o-armazém-de-estado">Redirecionar os utilizares e acessar o armazém de estado</h3><p>O acesso ao <a href="./directory-structure/store">armazém de estado da Vuex</a> (quando o temos configurado através do diretório <code>store</code>) também é possível através do contexto. Este fornece um objeto <code>store</code> que pode ser tratado como <code>this.$store</code> em componentes de Vue. Além disto, utilizamos o método <code>redirect</code>, um auxiliar exposto através do contexto, para redirecionar o utilizador no caso de o estado <code>authenticated</code> ser <a href="https://developer.mozilla.org/en-US/docs/Glossary/Falsy">falso</a>:<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token function">middleware</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> store<span class="token punctuation">,</span> redirect <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// recuperar chaves através de desestruturação de objetos</span>
    <span class="token keyword">const</span> isAuthenticated <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">authenticated</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isAuthenticated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><section class="level4"aria-labelledby="next"><h4 id="next">Next</h4><p>Consultar o livro Glossário Interno para mais exemplo do <a href="./internals-glossary/context#redirect">método <code>redirect</code></a>.</section></section><section class="level2"aria-labelledby="auxiliares"><h2 id="auxiliares">Auxiliares</h2><p>Para além dos atalhos no contexto, existem outros pequenos auxiliares presentes na nossa aplicação de Nuxt.</section><section class="level2"aria-labelledby="nuxt-o-auxiliar-da-nuxt"><h2 id="nuxt-o-auxiliar-da-nuxt"><code>$nuxt</code>: O auxiliar da Nuxt</h2><p>O <code>$nuxt</code> é um auxiliar concebido para melhorar a experiência do utilizador e para ser uma escotilha de fuga em algumas situações. É acessível por <code>this.$nuxt</code> em componentes de Vue e por <code>window.$nuxt</code> caso contrário no lado do cliente.<section class="level3"aria-labelledby="verificador-de-conexão"><h3 id="verificador-de-conexão">Verificador de conexão</h3><p>O auxiliar <code>$nuxt</code> fornece uma maneira rápida de descobrir se a conexão de Internet de um utilizador está presente ou não: Este expõe os valores booleanos <code>isOffline</code> e <code>isOnline</code>. Podemos utilizá-los para mostrar mensagem assim que o utilizador estiver desligado da rede (por exemplo):<pre class="language-html{}[layouts/default.vue]"><code class="language-html{}[layouts/default.vue]">&#x3C;template>
  &#x3C;div>
    &#x3C;div v-if="$nuxt.isOffline">You are offline&#x3C;/div>
    &#x3C;Nuxt />
  &#x3C;/div>
&#x3C;/template></code></pre></section><section class="level3"aria-labelledby="acessar-à-instância-de-raiz"><h3 id="acessar-à-instância-de-raiz">Acessar à instância de raiz</h3><p>Além de fornecer recursos de experiência de programação e experiência de utilização, o auxiliar <code>$nuxt</code> também fornece um atalho para a instância raiz da nossa aplicação a partir de todos os outros componentes. Mas isto não é tudo — nós também podemos acessar o auxiliar <code>$nuxt</code> através de <code>window.$nuxt</code> que pode ser usado como uma escotilha de fuga para ganhar acesso a métodos de módulos como <code>$axios</code> de fora dos nossos componentes de Vue. Isto deve ser usado sensatamente e <strong>apenas como último recurso</strong>.</section><section class="level3"aria-labelledby="atualizar-os-dados-da-página"><h3 id="atualizar-os-dados-da-página">Atualizar os dados da página</h3><p>Quando queremos atualizar a página atual para o utilizador, não queremos recarregar totalmente a página, porque podemos atingir o servidor novamente e, pelo menos, reiniciar toda a aplicação de Nuxt. Em vez disto, muitas vezes queremos apenas atualizar os dados, fornecidos por <code>asyncData</code> ou <code>fetch</code>.<p>Podemos fazer isto utilizando <code>this.$nuxt.refresh()</code>!<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span><span class="token punctuation">></span></span>{{ content }}<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>refresh<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Refresh<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>template</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
    <span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'Created at: '</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">$nuxt</span><span class="token punctuation">.</span><span class="token method function property-access">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span></code></pre><section class="level4"aria-labelledby="controlar-a-barra-de-carregamento"><h4 id="controlar-a-barra-de-carregamento">Controlar a barra de carregamento</h4><p>Com <code>$nuxt</code>, podemos também controlar a barra de carregamento da Nuxt programaticamente por <code>this.$nuxt.$loading</code>:<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">$nuxt</span><span class="token punctuation">.</span><span class="token property-access">$loading</span><span class="token punctuation">.</span><span class="token method function property-access">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">$nuxt</span><span class="token punctuation">.</span><span class="token property-access">$loading</span><span class="token punctuation">.</span><span class="token method function property-access">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Para mais informações, consultar o <a href="./features/loading">capítulo correspondente à funcionalidade de carregamento</a>.</section></section></section><section class="level2"aria-labelledby="auxiliar-onnuxtready"><h2 id="auxiliar-onnuxtready">Auxiliar <code>onNuxtReady</code></h2><p>Se quisermos executar alguns programas <em>depois que</em> a nossa aplicação de Nuxt tiver sido carregada e estiver pronta, podemos usar a função <code>window.onNuxtReady</code>. Isto pode ser útil quando queremos executar uma função no lado do cliente sem aumentar o tempo de interação do nosso sítio:<pre class="language-js"><code class="language-js"><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">onNuxtReady</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Nuxt is ready and mounted'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section class="level2"aria-labelledby="auxiliares-de-processo"><h2 id="auxiliares-de-processo">Auxiliares de Processo</h2><p>A Nuxt injeta três valores booleanos (<code>client</code>, <code>server</code>, e <code>static</code>) no objeto global <code>process</code> que nos ajudará a determinar se a nossa aplicação foi desenhada no servidor ou totalmente no cliente, assim como verificar a geração de sítios estáticos. Estes auxiliares estão disponíveis em toda a nossa aplicação e são normalmente utilizadas no código do utilizador de <code>asyncData</code>:<pre class="language-html{}[pages/about.vue]"><code class="language-html{}[pages/about.vue]">&#x3C;template>
  &#x3C;h1>I am rendered on the {{ renderedOn }} side&#x3C;/h1>
&#x3C;/template>

&#x3C;script>
  export default {
    asyncData() {
      return { renderedOn: process.client ? 'client' : 'server' }
    }
  }
&#x3C;/script></code></pre><p>No exemplo, <code>renderedOn</code> avaliará como <code>'server'</code> quando se utiliza a interpretação do lado do servidor e um utilizador acessar à página diretamente. Quando o utilizador navegar para a página a partir de outra parte da aplicação, por exemplo, clicando num <code>&#x3C;NuxtLink></code>, este avaliará como cliente. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>