<!doctype html><html lang="pt"><meta charset="utf-8"><title>A propriedade serverMiddleware</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="navigation.title"content="serverMiddleware"><meta name="description"content="Define o intermediário no lado do servidor."><meta name="menu"content="serverMiddleware"><meta name="category"content="configuration-glossary"><link rel="stylesheet"href="../../../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="a-propriedade-servermiddleware"><h1 id="a-propriedade-servermiddleware">A propriedade serverMiddleware</h1><p>Define o intermediário no lado do servidor.<hr><ul><li>Tipo: <code>Array</code><ul><li>Itens: <code>String</code> ou <code>Object</code> ou <code>Function</code></ul></ul><p>O Nuxt internamente cria um instância de <a href="https://github.com/senchalabs/connect">connect</a> que você pode adicionar ao seu próprio intermediário. Isto permite-nos registar rotas adicionais (normalmente rotas <code>/api</code>) <strong>sem precisar de um servidor externo</strong>.<p>Por <code>connect</code> mesmo ser um intermediário, o intermediário registado funcionará com ambos <code>nuxt start</code> e também quando usado como um intermediário com uso programático como o <a href="https://github.com/nuxt-community/express-template">express-template</a>. Os <a href="./directory-structure/modules">Módulos</a> do Nuxt pode também fornecer o <code>serverMiddleware</code> usando o <a href="./internals-glossary/internals-module-container#addservermiddleware-middleware">this.addServerMiddleware()</a><p>Adicionalmente a eles, nós introduzimos uma opção <code>prefix</code> a qual o valor padrão será <code>true</code>. Ela adicionará uma base de roteador para os intermediários do seu servidor.<p><strong>Exemplo:</strong><ul><li>Caminho do intermediário do servidor: <code>/server-middleware</code><li>Base de roteador: <code>/admin</code><li>Com o <code>prefix: true</code> (valor padrão): <code>/admin/server-middleware</code><li>Com o <code>prefix: false</code>: <code>/server-middleware</code></ul><section class="level2"aria-labelledby="servermiddleware-vs-middleware"><h2 id="servermiddleware-vs-middleware">serverMiddleware vs middleware!</h2><p>Não confunda ele com o <a href="./directory-structure/middleware">intermediários de rotas</a> as quais são chamadas antes de cada rota pelo Vue no lado do cliente ou na renderização no lado do servidor. O intermediário listado dentro da propriedade <code>serverMiddleware</code> executa no lado do servidor <strong>antes</strong> do <code>vue-server-renderer</code> e pode ser usado para tarefas específicas do servidor como manipulando de requisições de API ou servindo recursos.<section class="level4"aria-labelledby="warning"><h4 id="warning">Warning</h4><p>Não adicione o <code>serverMiddleware</code> ao diretório <code>middleware/</code>.<p>Os intermediários são empacotados pelo webpack dentro do seu pacote de produção e executam sobre o gatilho <code>beforeRouteEnter</code>. Se você adicionar o <code>serverMiddleware</code> ao diretório <code>middleware/</code> ele será erradamente tomado pelo Nuxt como um intermediário comum e adicionará dependências erradas ao seu pacote ou gerar erros.</section></section><section class="level2"aria-labelledby="uso"><h2 id="uso">Uso</h2><p>Se o intermediário for um sequência de caracteres o Nuxt tentará pedir e resolver ele automaticamente.<pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">import serveStatic from 'serve-static'

export default {
  serverMiddleware: [
    // Registará o pacote `redirect-ssl` de npm 
    'redirect-ssl',

    // Registará o ficheiro do diretório `server-middleware` do projeto manipular os pedidos de  `/server-middleware/*`
    { path: '/server-middleware', handler: '~/server-middleware/index.js' },

    // Podemos também criar instâncias personalizadas
    { path: '/static2', handler: serveStatic(__dirname + '/static2') }
  ]
}</code></pre><section class="level4"aria-labelledby="warning-1"><h4 id="warning-1">Warning</h4><p>Se você não quiser o intermediário para registar para todas rotas, você tem que usar a forma de objeto com um caminho específico, de outra maneira o manipulador padrão do Nuxt não funcionará!</section></section><section class="level2"aria-labelledby="intermediário-de-servidor-personalizado"><h2 id="intermediário-de-servidor-personalizado">Intermediário de Servidor Personalizado</h2><p>É também possível escrever um intermediário personalizado. Para mais informações consulte a <a href="https://github.com/senchalabs/connect#appusefn">Documentação do <code>Connect</code></a>.<p>Intermediário (<code>server-middleware/logger.js</code>):<pre class="language-js{}[server-middleware/logger.js]"><code class="language-js{}[server-middleware/logger.js]">export default function (req, res, next) {
  // O `req` é o objeto de requisição http do Node.js
  console.log(req.url)

  // O `res` é o objeto de resposta http do Node.js

  // O `next` é uma função para chamar o próximo intermediário
  // Não esqueça de chamar o `next` no final se o seu intermediário não for um ponto final!
  next()
}</code></pre><pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">serverMiddleware: ['~/server-middleware/logger']</code></pre></section><section class="level2"aria-labelledby="ponto-final-de-api-personalizada"><h2 id="ponto-final-de-api-personalizada">Ponto Final de API Personalizada</h2><p>Um intermediário de servidor pode também estender o <code>Express</code>. Isto permite a criação de pontos finais de REST.<pre class="language-js{}[server-middleware/rest.js]"><code class="language-js{}[server-middleware/rest.js]">const bodyParser = require('body-parser')
const app = require('express')()

app.use(bodyParser.json())
app.all('/getJSON', (req, res) => {
  res.json({ data: 'data' })
})

module.exports = app</code></pre><pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">serverMiddleware: [
  { path: "/server-middleware", handler: "~/server-middleware/rest.js" },
],</code></pre></section><section class="level2"aria-labelledby="a-sintaxe-de-objeto"><h2 id="a-sintaxe-de-objeto">A Sintaxe de Objeto</h2><p>Se o seu intermediário de servidor compreende em uma lista de funções mapeadas para os caminhos:<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">serverMiddleware</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/a'</span><span class="token punctuation">,</span> <span class="token literal-property property">handler</span><span class="token operator">:</span> <span class="token string">'~/server-middleware/a.js'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/b'</span><span class="token punctuation">,</span> <span class="token literal-property property">handler</span><span class="token operator">:</span> <span class="token string">'~/server-middleware/b.js'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/c'</span><span class="token punctuation">,</span> <span class="token literal-property property">handler</span><span class="token operator">:</span> <span class="token string">'~/server-middleware/c.js'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre><p>Você pode alternativamente passar um objeto para definir eles, como o seguinte:<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">serverMiddleware</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'/a'</span><span class="token operator">:</span> <span class="token string">'~/server-middleware/a.js'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'/b'</span><span class="token operator">:</span> <span class="token string">'~/server-middleware/b.js'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'/c'</span><span class="token operator">:</span> <span class="token string">'~/server-middleware/c.js'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>