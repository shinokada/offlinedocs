<!doctype html><html lang="pt"><meta charset="utf-8"><title>Função Gatilho de Obtenção de Dados</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="description"content="A função gatilho de obtenção de dados serve para buscar dados duma maneira assíncrona. É chamada no lado do servidor quando ao desenhar a rota, e no lado do cliente ao navegar."><meta name="navigation"content="[object Object]"><meta name="category"content="components-glossary"><link rel="stylesheet"type="text/css"href="../../../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="função-gatilho-de-obtenção-de-dados"><h1 id="função-gatilho-de-obtenção-de-dados">Função Gatilho de Obtenção de Dados</h1><p>A função gatilho <code>fetch</code> serve para buscar dados duma maneira assíncrona. É chamada no lado do servidor quando ao desenhar a rota, e no lado do cliente ao navegar.<hr><section class="level2"aria-labelledby="nuxt--212"><h2 id="nuxt--212">Nuxt >= 2.12</h2><p>A Nuxt <code>v2.12</code> introduz uma nova função gatilho chamada <code>fetch</code> que podemos usar <strong>em qualquer um dos nossos componentes <code>.vue</code></strong>, Usamos a <code>fetch</code> sempre que precisarmos de obter dados <strong>assíncronos</strong>. A <code>fetch</code> é chamada no lado do servidor ao desenhar a rota, e no lado do cliente ao navegar.<p>Expõe a <code>$fetchState</code> ao nível do componente:<ul><li><code>$fetchState.pending</code>: <code>Boolean</code>, permite-nos mostrar um marcador de posição quando a <code>fetch</code> for chamada <em>no lado do cliente</em>.<li><code>$fetchState.error</code>: <code>null</code> ou <code>Error</code>, permite-nos mostrar uma mensagem de erro.<li><code>$fetchState.timestamp</code>: <code>Integer</code>, é um marcador de data e hora da última busca de dados, útil para armazenamento transitório com o <code>keep-alive</code>.</ul><p>Se quisermos chamar a função gatilho <code>fetch</code> do nosso modelo de marcação de hipertexto, usamos:<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$fetch<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Refresh<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span></code></pre><p>ou método de componente:<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// dos métodos dos componentes na secção de programação.</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">$fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Podemos acessar o <a href="./internals-glossary/context">contexto</a> da Nuxt dentro da função gatilho <code>fetch</code> usando <code>this.$nuxt.context</code>.<section class="level3"aria-labelledby="opções"><h3 id="opções">Opções</h3><ul><li><code>fetchOnServer</code>: <code>Boolean</code> ou <code>Function</code> (predefinida como: <code>true</code>), chama <code>fetch</code> quando a página é desenhada pelo servidor.<li><code>fetchKey</code>: <code>String</code> ou <code>Function</code> (a predefinição é o identificador do âmbito do componente ou o nome do componente), uma chave (ou uma função produz uma chave única) que identifica o resultado da pesquisa deste componente (disponível na Nuxt 2.15+) <a href="https://github.com/nuxt/nuxt/pull/8466">Mais informações disponíveis no pedido de atualização do repositório original</a>.<li><code>fetchDelay</code>: <code>Integer</code> (predefinida como: <code>200</code>), define o tempo mínimo de execução em milissegundos (para evitar intermitências rápidas).</ul><p>Quando a <code>fetchOnServer</code> é <code>false</code> ou retorna <code>false</code>, <code>fetch</code> será chamada apenas no lado do cliente e <code>$fetchState.pending</code> retornará <code>true</code> quando o componente for desenhado no servidor:<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">posts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">posts</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">$http</span><span class="token punctuation">.</span><span class="token method function property-access">$get</span><span class="token punctuation">(</span><span class="token string">'https://api.nuxtjs.dev/posts'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">fetchOnServer</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">// vários componentes podem retornar a mesma `fetchKey` e</span>
    <span class="token comment">// a Nuxt rastreará ambos separadamente</span>
    <span class="token literal-property property">fetchKey</span><span class="token operator">:</span> <span class="token string">'site-sidebar'</span><span class="token punctuation">,</span>
    <span class="token comment">// Em alternativa, para um maior controlo,</span>
    <span class="token comment">// pode ser passada uma função com acesso à instância do componente.</span>
    <span class="token comment">// Será chamada na `created` e não deve depender de dados obtidos.</span>
    <span class="token function">fetchKey</span><span class="token punctuation">(</span><span class="token parameter">getCounter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// `getCounter` é um método que pode ser chamada para</span>
      <span class="token comment">// obter o número seguinte numa sequência</span>
      <span class="token comment">// como parte da geração duma `fetchKey` única.</span>
      <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">someOtherData</span> <span class="token operator">+</span> <span class="token function">getCounter</span><span class="token punctuation">(</span><span class="token string">'sidebar'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span></code></pre><section class="level4"aria-labelledby="next"><h4 id="next">Next</h4><p>Para mais informações sobre a Função Gatilho <code>fetch</code>, consultar o capítulo de <a href="./features/data-fetching">Obtenção de Dados</a> no livro de Funcionalidades.<p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section></section></section>