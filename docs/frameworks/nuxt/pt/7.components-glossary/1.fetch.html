<!doctype html>
<html lang="pt">
  <head>
    <meta charset="utf-8">
    <title>O Gatilho Fetch</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="O gatilho fetch serve para requisição assíncrona de dados. Ele é chamado no lado do servidor quando estiver renderizando a rota, e no lado do cliente quando estiver navegando entre as rotas.">
    <meta name="navigation" content="[object Object]">
    <meta name="category" content="components-glossary">
    <link rel="stylesheet" href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css">
  </head>
  <body>
    <section id="o-gatilho-fetch" class="level1">
      <h1>O Gatilho Fetch</h1>
      <p>O gatilho <code>fetch</code> serve para requisição assíncrona de dados. Ele é chamado no lado do servidor quando estiver renderizando a rota, e no lado do cliente quando estiver navegando entre as rotas.</p>
      <hr>
      <section id="em-versões-do-nuxt-maiores-ou-igual-212" class="level2">
        <h2>Em versões do Nuxt maiores ou igual 2.12</h2>
        <p>A versão <code>2.12</code> do Nuxt introduz um novo gatilho chamado <code>fetch</code> o qual você pode usar <strong>dentro de qualquer um de seus componentes de Vue</strong>. Use o <code>fetch</code> toda vez que você precisar receber dados <strong>assíncronos</strong>. O <code>fetch</code> é chamado no lado do servidor quando estiver renderizando a rota, e no lado do cliente quando estiver navegando entre as rotas.</p>
        <p>Ele expõe o <code>$fetchState</code> no nível de componente:</p>
        <ul>
          <li><code>$fetchState.pending</code>: <code>Boolean</code>, permite você mostrar um segurador de espaço quando o <code>fetch</code> estiver sendo chamado <em>no lado do cliente</em>.</li>
          <li><code>$fetchState.error</code>: <code>null</code> ou <code>Error</code>, permite você mostrar uma mensagem de erro</li>
          <li><code>$fetchState.timestamp</code>: <code>Integer</code>, é uma referência a data e hora da última requisição, útil para cacheamento com o <code>keep-alive</code></li>
        </ul>
        <p>Se você quiser chamar o gatilho <code>fetch</code> a partir do seu modelo, use:</p>
        <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$fetch<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Refresh<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span></code></pre>
        <p>ou método de componente:</p>
        <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// a partir de métodos de componente na secção de roteiro (script)</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">$fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
        <p>Você pode acessar o <a href="./internals-glossary/context">contexto</a> do Nuxt dentro do gatilho <code>fetch</code> usando o <code>this.$nuxt.context</code>.</p>
        <section id="opções" class="level3">
          <h3>Opções</h3>
          <ul>
            <li><code>fetchOnServer</code>: <code>Boolean</code> ou <code>Function</code> (valor padrão: <code>true</code>), chama o <code>fetch()</code> quando o servidor estiver renderizando a página</li>
            <li><code>fetchKey</code>: <code>String</code> ou <code>Function</code> (padroniza para identificador do escopo de componente ou nome de componente), uma chave (ou uma função que produz uma chave única) que identifica o resultado da requisição deste componente(disponível desde a versão 2.15 do Nuxt) <a href="https://github.com/nuxt/nuxt.js/pull/8466">Mais informações estão disponíveis na PR original</a>.</li>
            <li><code>fetchDelay</code>: <code>Integer</code> (valor padrão: <code>200</code>), define em milissegundos o tempo mínimo de execução (para evitar piscadelas)</li>
          </ul>
          <p>Quando o <code>fetchOnServer</code> for falso (<code>false</code> ou retornar <code>false</code>), o <code>fetch</code> será chamado apenas no lado do cliente e o <code>$fetchState.pending</code> retornará <code>true</code> quando o servidor estiver renderizando o componente.</p>
          <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">posts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">posts</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">$http</span><span class="token punctuation">.</span><span class="token method function property-access">$get</span><span class="token punctuation">(</span><span class="token string">'https://api.nuxtjs.dev/posts'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">fetchOnServer</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">// vários componentes podem retornar o mesmo `fetchKey` e o Nuxt rastreará ambos eles separadamente</span>
    <span class="token literal-property property">fetchKey</span><span class="token operator">:</span> <span class="token string">'site-sidebar'</span><span class="token punctuation">,</span>
    <span class="token comment">// alternativamente, para mais controle, uma função pode ser passada com o acesso à instância do componente</span>
    <span class="token comment">// Ela será chamada dentro do gatilho `created` e não deve depender de um dado requisitado</span>
    <span class="token function">fetchKey</span><span class="token punctuation">(</span><span class="token parameter">getCounter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// `getCounter` é um método que pode ser chamado para receber o próximo número dentro de uma sequência</span>
      <span class="token comment">// como parte de geração de uma `fetchKey` única.</span>
      <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">someOtherData</span> <span class="token operator">+</span> <span class="token function">getCounter</span><span class="token punctuation">(</span><span class="token string">'sidebar'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span></code></pre>
          <section id="next" class="level4">
            <h4>Next</h4>
            <p>Para mais informações sobre o Gatilho Fetch consulte o capítulo <a href="./features/data-fetching">Requisição de Dados</a> no livro Funcionalidades</p>
            <p><span style="float: footnote;"><a href="../index.html#toc">Go to TOC</a></span></p>
          </section>
        </section>
      </section>
    </section>
  </body>
</html>
