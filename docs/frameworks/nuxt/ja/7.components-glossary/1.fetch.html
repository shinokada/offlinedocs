<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>Fetch フック</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="fetch フックは、非同期にデータを取得するためのものです。ルートをレンダリングする際にはサーバーサイドで、遷移する際にはクライアントサイドで呼び出されます。">
    <meta name="navigation" content="[object Object]">
    <meta name="category" content="components-glossary">
    <link rel="stylesheet" href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css">
  </head>
  <body>
    <section id="fetch-フック" class="level1">
      <h1>Fetch フック</h1>
      <p><code>fetch</code> フックは、非同期にデータを取得するためのものです。ルートをレンダリングする際にはサーバーサイドで、遷移する際にはクライアントサイドで呼び出されます。</p>
      <hr>
      <section id="nuxt--212" class="level2">
        <h2>Nuxt >= 2.12</h2>
        <p>Nuxt <code>v2.12</code> から、<strong>すべての Vue コンポーネントに対して</strong> <code>fetch</code> という新しいフックが導入されています。<strong>非同期データ</strong>を取得する必要があるたびに <code>fetch</code> を使います。<code>fetch</code> はサーバーサイドではルートをレンダリングするときに、クライアントサイドでは遷移するときに呼び出されます。</p>
        <p>コンポーネントレベルで <code>$fetchState</code> を公開します：</p>
        <ul>
          <li><code>$fetchState.pending</code>: <code>Boolean</code>。<code>fetch</code> が <em>クライアントサイド</em> で 呼び出されているときにプレースホルダーを表示する用途などで使うことができます。</li>
          <li><code>$fetchState.error</code>: <code>null</code> または <code>Error</code>。エラーメッセージを表示する用途で使うことができます。</li>
          <li><code>$fetchState.timestamp</code>: <code>Integer</code>。最後に fetch したタイムスタンプです。<code>keep-alive</code> を用いたキャッシングに便利です。</li>
        </ul>
        <p>テンプレートから <code>fetch</code> フックを呼び出したい場合は、以下のようにします：</p>
        <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$fetch<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Refresh<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span></code></pre>
        <p>また、コンポーネントメソッドでは下記のとおりです：</p>
        <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// スクリプトセクションのコンポーネントメソッドより</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">$fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
        <p>fetch フック内では <code>this.$nuxt.context</code> を使用して、Nuxt <a href="./internals-glossary/context">context</a> にアクセスできます。</p>
        <section id="オプション" class="level3">
          <h3>オプション</h3>
          <ul>
            <li><code>fetchOnServer</code>: <code>Boolean</code> または <code>Function</code>（デフォルト: <code>true</code>）。サーバーがページをレンダリングする際に <code>fetch()</code> を呼び出します。</li>
            <li><code>fetchKey</code>: <code>String</code> または <code>Function</code>（デフォルトはコンポーネントスコープ ID またはコンポート名）でこのコンポーネントの取得結果を識別するキー（または一意のキーを生成する関数）です（Nuxt v2.15 以上で利用可能）。<a href="https://github.com/nuxt/nuxt.js/pull/8466">詳細は PR を参照してください</a>。</li>
            <li><code>fetchDelay</code>: <code>Integer</code>（デフォルト: <code>200</code>）。最小実行時間をミリ秒単位で設定します（極短期間での画面切り替えによるちらつきを防ぐため）。</li>
          </ul>
          <p><code>fetchOnServer</code> が偽の値をとり得る場合(<code>false</code> または、<code>false</code> になりえる値を返す)、<code>fetch</code> はクライアントサイドでのみ呼び出され、サーバーでコンポーネントをレンダリングする際には <code>$fetchState.pending</code> は <code>true</code> を返します。</p>
          <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">posts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">posts</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">$http</span><span class="token punctuation">.</span><span class="token method function property-access">$get</span><span class="token punctuation">(</span><span class="token string">'https://api.nuxtjs.dev/posts'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">fetchOnServer</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">// 複数のコンポーネントが同じ `fetchKey` を返却することができ、Nuxt は両方を別々に追跡します。</span>
    <span class="token literal-property property">fetchKey</span><span class="token operator">:</span> <span class="token string">'site-sidebar'</span><span class="token punctuation">,</span>
    <span class="token comment">// あるいは、より詳細に制御するためにコンポーネントインスタンスにアクセスして関数を渡すことができます。</span>
    <span class="token comment">// 関数は `created` で呼び出され、取得したデータに依存してはいけません。</span>
    <span class="token function">fetchKey</span><span class="token punctuation">(</span><span class="token parameter">getCounter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// getCounter は呼び出し可能なメソッドで、一意な fetchKey の生成結果として</span>
      <span class="token comment">// シーケンス内の次の番号を取得できます。</span>
      <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">someOtherData</span> <span class="token operator">+</span> <span class="token function">getCounter</span><span class="token punctuation">(</span><span class="token string">'sidebar'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span></code></pre>
          <section id="next" class="level4">
            <h4>Next</h4>
            <p>fetch フックチェックアウトの詳細については<a href="./features/data-fetching">データの取得</a>のドキュメントを参照してください</p>
            <p><span style="float: footnote;"><a href="../index.html#toc">Go to TOC</a></span></p>
          </section>
        </section>
      </section>
    </section>
  </body>
</html>
