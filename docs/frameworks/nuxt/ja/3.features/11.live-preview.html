<!doctype html><html lang="ja"><meta charset="utf-8"><title>プレビューモード</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="description"content="プレビューモードを使った静的ホスティング向けのライブプレビュー"><meta name="category"content="features"><link rel="stylesheet"href="../../../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="プレビューモード"><h1 id="プレビューモード">プレビューモード</h1><p>プレビューモードを使った静的ホスティング向けのライブプレビュー<hr><p>Nuxt とフルスタティックモジュールを使うことで、API や CMS を呼び出すライブプレビューをすぐに利用することができます。そして、デプロイする前に変化を確認することができます。<section class="level4"aria-labelledby="warning"><h4 id="warning">Warning</h4><p><a href="./features/deployment-targets#static-hosting"><code>target:static</code></a> を利用しているときのみ使用可能です<p>内部では <code>$nuxt.refresh</code> を使っており、クライアントサイドで nuxtServerInit や asyncData、fetch を呼び出しているため、プレビューモードでは自動的にページのデータが更新されます。<p>ライブプレビューを有効化するためには、次のプラグインを追加する必要があります：<pre class="language-js{}[plugins/preview.client.js]"><code class="language-js{}[plugins/preview.client.js]">export default function ({ query, enablePreview }) {
  if (query.preview) {
    enablePreview()
  }
}</code></pre></section><section class="level4"aria-labelledby="warning-1"><h4 id="warning-1">Warning</h4><p><code>enablePreview</code> はプラグインの context オブジェクトでのみ利用可能です。プレビューはクライアントサイドで処理されるため、プラグイン(今回の例では preview.client.js)はクライアントでのみ実行される必要があります。<pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">export default {
  plugins: ['~/plugins/preview.client.js']
}</code></pre><p>一度そのプラグインを追加すれば、すぐにサイトを生成し配信することができます。<pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> generate
<span class="token function">yarn</span> start</code></pre><pre class="language-bash"><code class="language-bash">npx nuxt generate
npx nuxt start</code></pre><p>そして以下のクエリパラメータを確認したいページの最後に追加することでプレビューを見ることができます：<pre class="language-js"><code class="language-js"><span class="token operator">?</span>preview<span class="token operator">=</span><span class="token boolean">true</span></code></pre></section><section class="level4"aria-labelledby="warning-2"><h4 id="warning-2">Warning</h4><p>enablePreview は yarn dev ではなく yarn start を用いてローカルでテストしてください。</section><section class="level3"aria-labelledby="まだ生成されていないページをプレビューする場合"><h3 id="まだ生成されていないページをプレビューする場合">まだ生成されていないページをプレビューする場合</h3><p>まだ生成されていないページは API 上に存在しますが静的なページとして生成されてはいないため、SPA フォールバックは 404 ページを表示する前に API を呼び出します。<p>もし validate フックを設定している場合、プレビューモードで 404 ページへリダイレクトしないように validate フックを修正する必要があるでしょう。<pre class="language-js"><code class="language-js"><span class="token function">validate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params<span class="token punctuation">,</span> query <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token property-access">preview</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span></code></pre></section><section class="level3"aria-labelledby="enablepreview-にデータを渡す場合"><h3 id="enablepreview-にデータを渡す場合">enablePreview にデータを渡す場合</h3><p><code>enablePreview</code> 関数にデータを渡すことができます。 そのデータは <code>$preview</code> コンテキストヘルパーと <code>this.$preview</code> で利用できます。</section><section class="level3"aria-labelledby="この次は"><h3 id="この次は">この次は？</h3><section class="level4"aria-labelledby="next"><h4 id="next">Next</h4><p><a href="./directory-structure/nuxt">ディレクトリ構造のドキュメント</a>について確認しましょう。<p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section></section>