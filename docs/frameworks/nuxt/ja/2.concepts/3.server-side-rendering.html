<!doctype html><html lang="ja"><meta charset="utf-8"><title>サーバーサイドレンダリング</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="description"content="サーバーサイドレンダリング（SSR）はウェブページのレンダリングをブラウザの代わりにサーバー上で行う、画面の表示において有用なアプリケーションの機能です。"><meta name="category"content="concepts"><link rel="stylesheet"href="../../../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="サーバーサイドレンダリング"><h1 id="サーバーサイドレンダリング">サーバーサイドレンダリング</h1><p>サーバーサイドレンダリング（SSR）はウェブページのレンダリングをブラウザの代わりにサーバー上で行う、画面の表示において有用なアプリケーションの機能です。サーバーサイドは完全にレンダリングされたページをクライアントに送信します。クライアントの JavaScript バンドルが引継ぎ Vue.js のアプリが<a href="https://ssr.vuejs.org/guide/hydration.html">ハイドレーション</a>できるようにします。<hr><section class="level2"aria-labelledby="nodejs-サーバー環境が必須"><h2 id="nodejs-サーバー環境が必須">Node.js サーバー環境が必須</h2><p>ウェブページをレンダリングするためには JavaScript の環境が必要です。<p>Vue.js のアプリケーションを実行するには Node.js サーバーの環境構築が必要です。</section><section class="level2"aria-labelledby="サーバーの拡張と制御"><h2 id="サーバーの拡張と制御">サーバーの拡張と制御</h2><p>serverMiddleware でサーバーを拡張しルートを middleware で制御することができます。<pre class="language-js{}[server-middleware/logger.js]"><code class="language-js{}[server-middleware/logger.js]">
export default function (req, res, next) {
  console.log(req.url)
  next()
}</code></pre><pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">export default {
  serverMiddleware: ['~/server-middleware/logger']

}</code></pre></section><section class="level2"aria-labelledby="サーバー環境とブラウザ環境"><h2 id="サーバー環境とブラウザ環境">サーバー環境とブラウザ環境</h2><p>Node.js の環境を利用するため <code>req</code> や <code>res</code> といった Node.js のオブジェクトにアクセス可能です。また <code>window</code> や <code>document</code> といったブラウザ環境に帰属するオブジェクトにはアクセスできません。ただし <code>beforeMount</code> や <code>mounted</code> などのフックを使うと <code>window</code> や <code>document</code> を使うことができます。<pre class="language-js"><code class="language-js"><span class="token function">beforeMount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">alert</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">alert</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section><section class="level2"aria-labelledby="nuxt-でのサーバーサイドレンダリングのステップ"><h2 id="nuxt-でのサーバーサイドレンダリングのステップ">Nuxt でのサーバーサイドレンダリングのステップ</h2><section class="level3"aria-labelledby="ステップ-1-ブラウザからサーバーへ"><h3 id="ステップ-1-ブラウザからサーバーへ">ステップ 1: ブラウザからサーバーへ</h3><p>ブラウザが最初のリクエストを送ると Node.js の内部サーバーへ到達します。Nuxt は HTML を生成し <code>asyncData</code>、 <code>nuxtServerInit</code>、 <code>fetch</code> といった関数を実行した結果と共にブラウザへ送り返します。フック関数も同様に実行されます。</section><section class="level3"aria-labelledby="ステップ-2-サーバーからブラウザへ"><h3 id="ステップ-2-サーバーからブラウザへ">ステップ 2: サーバーからブラウザへ</h3><p>サーバーによって生成された HTML と共にレンダリングされたページをブラウザが受け取ります。その内容が表示され Vue.js のハイドレーションが作用し始めます。この工程の後、ページがインタラクティブになります。</section><section class="level3"aria-labelledby="ステップ-3-ブラウザからブラウザへ"><h3 id="ステップ-3-ブラウザからブラウザへ">ステップ 3: ブラウザからブラウザへ</h3><p><a href="./features/nuxt-components#the-nuxtlink-component"><code>&#x3C;NuxtLink></code></a> によるページ間の遷移はクライアントサイドで行われるためブラウザをハード再読み込みをしない限りサーバーへリクエストを送りません。</section></section><section class="level2"aria-labelledby="警告"><h2 id="警告">警告</h2><section class="level3"aria-labelledby="window-または-document-undefined"><h3 id="window-または-document-undefined">window または document undefined</h3><p>これはサーバーサイドレンダリングによるものです。クライアントサイドでのみリソースをインポートするように指定する必要がある場合は <code>process.client</code> 変数を使用する必要があります。<p>たとえば <code>.vue</code> ファイルは次のようになります:<pre class="language-js"><code class="language-js"><span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token property-access">client</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'external_library'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></section><section class="level3"aria-labelledby="ios-と電話番号"><h3 id="ios-と電話番号">iOS と電話番号</h3><p>モバイル Safari の一部のバージョンでは、電話番号を自動的にリンクに変換します。これにより SSR コンテンツがウェブサイトのコンテンツと一致しなくなるため、<code>NodeMismatch</code> の警告が引き起こされます。そのためこれらの Safari バージョンでアプリが使用できなくなる可能性があります。<p>Nuxt ページに電話番号を含める場合、2 つのオプションがあります。</section></section><section class="level2"aria-labelledby="メタタグを使用して変換を停止する"><h2 id="メタタグを使用して変換を停止する">メタタグを使用して変換を停止する</h2><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>format-detection<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>telephone=no<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre></section><section class="level2"aria-labelledby="電話番号をリンクにラップする"><h2 id="電話番号をリンクにラップする">電話番号をリンクにラップする</h2><pre class="language-html"><code class="language-html"><span class="token comment">&#x3C;!-- 電話番号の例: +7 (982) 536-50-77 --></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tel: +7 (982) 536-50-77<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>+7 (982) 536-50-77<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>template</span><span class="token punctuation">></span></span></code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>