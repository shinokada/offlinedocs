<!doctype html><html lang="zh-hans"><meta charset="utf-8"><title>选择 State 结构</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="选择-state-结构"><h1 id="选择-state-结构">选择 State 结构</h1><p>translators:<ul><li>Davont</ul><intro><p>构建良好的 state 可以让组件变得易于修改和调试，而不会经常出错。以下是你在构建 state 时应该考虑的一些建议。</p></intro><youwilllearn><ul><li>使用单个 state 变量还是多个 state 变量<li>组织 state 时应避免的内容<li>如何解决 state 结构中的常见问题</ul></youwilllearn><section class="level2"aria-labelledby="构建-state-的原则-principles-for-structuring-state"><h2 id="构建-state-的原则-principles-for-structuring-state">构建 state 的原则 {/<em>principles-for-structuring-state</em>/}</h2><p>当你编写一个存有 state 的组件时，你需要选择使用多少个 state 变量以及它们都是怎样的数据格式。尽管选择次优的 state 结构下也可以编写正确的程序，但有几个原则可以指导您做出更好的决策：<ol><li><strong>合并关联的 state</strong>。如果你总是同时更新两个或更多的 state 变量，请考虑将它们合并为一个单独的 state 变量。<li><strong>避免互相矛盾的 state</strong>。当 state 结构中存在多个相互矛盾或“不一致”的 state 时，你就可能为此会留下隐患。应尽量避免这种情况。<li><strong>避免冗余的 state</strong>。如果你能在渲染期间从组件的 props 或其现有的 state 变量中计算出一些信息，则不应将这些信息放入该组件的 state 中。<li><strong>避免重复的 state</strong>。当同一数据在多个 state 变量之间或在多个嵌套对象中重复时，这会很难保持它们同步。应尽可能减少重复。<li><strong>避免深度嵌套的 state</strong>。深度分层的 state 更新起来不是很方便。如果可能的话，最好以扁平化方式构建 state。</ol><p>这些原则背后的目标是 <strong>使 state 易于更新而不引入错误</strong>。从 state 中删除冗余和重复数据有助于确保所有部分保持同步。这类似于数据库工程师想要 <a href="https://docs.microsoft.com/zh-CN/office/troubleshoot/access/database-normalization-description">“规范化”数据库结构</a>，以减少出现错误的机会。用爱因斯坦的话说，<strong>“让你的状态尽可能简单，但不要过于简单。”</strong><p>现在让我们来看看这些原则在实际中是如何应用的。</section><section class="level2"aria-labelledby="合并关联的-state-group-related-state"><h2 id="合并关联的-state-group-related-state">合并关联的 state {/<em>group-related-state</em>/}</h2><p>有时候你可能会不确定是使用单个 state 变量还是多个 state 变量。<p>你会像下面这样做吗？<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> setX<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>y<span class="token punctuation">,</span> setY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>或这样？<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>position<span class="token punctuation">,</span> setPosition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>从技术上讲，你可以使用其中任何一种方法。但是，<strong>如果某两个 state 变量总是一起变化，则将它们统一成一个 state 变量可能更好</strong>。这样你就不会忘记让它们始终保持同步，就像下面这个例子中，移动光标会同时更新红点的两个坐标：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MovingDot</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>position<span class="token punctuation">,</span> setPosition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div
      onPointerMove<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">x</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">clientX</span><span class="token punctuation">,</span>
          <span class="token literal-property property">y</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">clientY</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'relative'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'100vw'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'100vh'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">borderRadius</span><span class="token operator">:</span> <span class="token string">'50%'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>position<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>position<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">250</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>另一种你需要将数据整合到一个对象或一个数组的情况是，你不知道未来需要多少个 state 片段。例如，有一个用户可以添加自定义字段的表单时，这将会很有帮助。</p><pitfall><p>如果你的 state 变量是一个对象时，请记住，<a href="/learn/updating-objects-in-state">你不能只更新其中的一个字段</a> 而不显式复制其他字段。例如，在上面的例子中，你不能写成 <code>setPosition({ x: 100 })</code>，因为它根本就没有 <code>y</code> 属性! 相反，如果你想要仅设置 <code>x</code>，则可执行 <code>setPosition({ ...position, x: 100 })</code>，或将它们分成两个 state 变量，并执行 <code>setX(100)</code>。</p></pitfall></section><section class="level2"aria-labelledby="避免矛盾的-state-avoid-contradictions-in-state"><h2 id="避免矛盾的-state-avoid-contradictions-in-state">避免矛盾的 state {/<em>avoid-contradictions-in-state</em>/}</h2><p>下面是带有 <code>isSending</code> 和 <code>isSent</code> 两个 state 变量的酒店反馈表单：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FeedbackForm</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isSending<span class="token punctuation">,</span> setIsSending<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isSent<span class="token punctuation">,</span> setIsSent<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setIsSending</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">await</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setIsSending</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setIsSent</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isSent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Thanks</span> <span class="token keyword control-flow">for</span> feedback<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">How</span> was your stay at <span class="token maybe-class-name">The</span> <span class="token maybe-class-name">Prancing</span> <span class="token maybe-class-name">Pony</span><span class="token operator">?</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>textarea
        disabled<span class="token operator">=</span><span class="token punctuation">{</span>isSending<span class="token punctuation">}</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>br <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button
        disabled<span class="token operator">=</span><span class="token punctuation">{</span>isSending<span class="token punctuation">}</span>
        type<span class="token operator">=</span><span class="token string">"submit"</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Send</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>isSending <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Sending</span><span class="token spread operator">...</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 假装发送一条消息。</span>
<span class="token keyword">function</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>尽管这段代码是有效的，但也会让一些 state “极难处理”。例如，如果你忘记同时调用 <code>setIsSent</code> 和 <code>setIsSending</code>，则可能会出现 <code>isSending</code> 和 <code>isSent</code> 同时为 <code>true</code> 的情况。你的组件越复杂，你就越难理解发生了什么。<p><strong>因为 <code>isSending</code> 和 <code>isSent</code> 不应同时为 <code>true</code>，所以最好用一个 <code>status</code> 变量来代替它们，这个 state 变量可以采取三种有效状态其中之一</strong>：<code>'typing'</code> (初始), <code>'sending'</code>, 和 <code>'sent'</code>:</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FeedbackForm</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>status<span class="token punctuation">,</span> setStatus<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'typing'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">'sending'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">await</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">'sent'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> isSending <span class="token operator">=</span> status <span class="token operator">===</span> <span class="token string">'sending'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isSent <span class="token operator">=</span> status <span class="token operator">===</span> <span class="token string">'sent'</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isSent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Thanks</span> <span class="token keyword control-flow">for</span> feedback<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">How</span> was your stay at <span class="token maybe-class-name">The</span> <span class="token maybe-class-name">Prancing</span> <span class="token maybe-class-name">Pony</span><span class="token operator">?</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>textarea
        disabled<span class="token operator">=</span><span class="token punctuation">{</span>isSending<span class="token punctuation">}</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>br <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button
        disabled<span class="token operator">=</span><span class="token punctuation">{</span>isSending<span class="token punctuation">}</span>
        type<span class="token operator">=</span><span class="token string">"submit"</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Send</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>isSending <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Sending</span><span class="token spread operator">...</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 假装发送一条消息。</span>
<span class="token keyword">function</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>你仍然可以声明一些常量，以提高可读性：<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> isSending <span class="token operator">=</span> status <span class="token operator">===</span> <span class="token string">'sending'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isSent <span class="token operator">=</span> status <span class="token operator">===</span> <span class="token string">'sent'</span><span class="token punctuation">;</span></code></pre><p>但它们不是 state 变量，所以你不必担心它们彼此失去同步。</section><section class="level2"aria-labelledby="避免冗余的-state-avoid-redundant-state"><h2 id="避免冗余的-state-avoid-redundant-state">避免冗余的 state {/<em>avoid-redundant-state</em>/}</h2><p>如果你能在渲染期间从组件的 props 或其现有的 state 变量中计算出一些信息，则不应该把这些信息放到该组件的 state 中。<p>例如，以这个表单为例。它可以运行，但你能找到其中任何冗余的 state 吗？</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> setFirstName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>lastName<span class="token punctuation">,</span> setLastName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>fullName<span class="token punctuation">,</span> setFullName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleFirstNameChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setFirstName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setFullName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> lastName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleLastNameChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setLastName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setFullName</span><span class="token punctuation">(</span>firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Let’s</span> check you <span class="token keyword">in</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token maybe-class-name">First</span> name<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>firstName<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleFirstNameChange<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token maybe-class-name">Last</span> name<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>lastName<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleLastNameChange<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Your</span> ticket will be issued to<span class="token operator">:</span> <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>fullName<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>这个表单有三个 state 变量：<code>firstName</code>、<code>lastName</code> 和 <code>fullName</code>。然而，<code>fullName</code> 是多余的。<strong>在渲染期间，你始终可以从 <code>firstName</code> 和 <code>lastName</code> 中计算出 <code>fullName</code>，因此需要把它从 state 中删除。</strong><p>你可以这样做：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> setFirstName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>lastName<span class="token punctuation">,</span> setLastName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> fullName <span class="token operator">=</span> firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> lastName<span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleFirstNameChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setFirstName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleLastNameChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setLastName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Let’s</span> check you <span class="token keyword">in</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token maybe-class-name">First</span> name<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>firstName<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleFirstNameChange<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token maybe-class-name">Last</span> name<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>lastName<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleLastNameChange<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Your</span> ticket will be issued to<span class="token operator">:</span> <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>fullName<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>这里的 <code>fullName</code> <strong>不是</strong> 一个 state 变量。相反，它是在渲染期间中计算出的：<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fullName <span class="token operator">=</span> firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> lastName<span class="token punctuation">;</span></code></pre><p>因此，更改处理程序不需要做任何特殊操作来更新它。当你调用 <code>setFirstName</code> 或 <code>setLastName</code> 时，你会触发一次重新渲染，然后下一个 <code>fullName</code> 将从新数据中计算出来。</p><deepdive><section class="level4"aria-labelledby="不要在-state-中镜像-props-don-t-mirror-props-in-state"><h4 id="不要在-state-中镜像-props-don-t-mirror-props-in-state">不要在 state 中镜像 props {/<em>don-t-mirror-props-in-state</em>/}</h4><p>以下代码是体现 state 冗余的一个常见例子：<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Message</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> messageColor <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>messageColor<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>这里，一个 <code>color</code> state 变量被初始化为 <code>messageColor</code> 的 prop 值。这段代码的问题在于，<strong>如果父组件稍后传递不同的 <code>messageColor</code> 值（例如，将其从 <code>'blue'</code> 更改为 <code>'red'</code>），则 <code>color</code></strong> state 变量<strong>将不会更新！</strong> state 仅在第一次渲染期间初始化。<p>这就是为什么在 state 变量中，“镜像”一些 prop 属性会导致混淆的原因。相反，你要在代码中直接使用 <code>messageColor</code> 属性。如果你想给它起一个更短的名称，请使用常量：<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Message</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> messageColor <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> color <span class="token operator">=</span> messageColor<span class="token punctuation">;</span></code></pre><p>这种写法就不会与从父组件传递的属性失去同步。<p>只有当你 <strong>想要</strong> 忽略特定 props 属性的所有更新时，将 props “镜像”到 state 才有意义。按照惯例，prop 名称以 <code>initial</code> 或 <code>default</code> 开头，以阐明该 prop 的新值将被忽略：<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Message</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> initialColor <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这个 `color` state 变量用于保存 `initialColor` 的 **初始值**。</span>
  <span class="token comment">// 对于 `initialColor` 属性的进一步更改将被忽略。</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialColor<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section></deepdive></section><section class="level2"aria-labelledby="避免重复的-state-avoid-duplication-in-state"><h2 id="避免重复的-state-avoid-duplication-in-state">避免重复的 state {/<em>avoid-duplication-in-state</em>/}</h2><p>下面这个菜单列表组件可以让你在多种旅行小吃中选择一个：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialItems <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Menu</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>items<span class="token punctuation">,</span> setItems<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>selectedItem<span class="token punctuation">,</span> setSelectedItem<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>
    items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">What</span>'s your travel snack<span class="token operator">?</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
            <span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
            <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
              <span class="token function">setSelectedItem</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Choose</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">You</span> picked <span class="token punctuation">{</span>selectedItem<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>当前，它将所选元素作为对象存储在 <code>selectedItem</code> state 变量中。然而，这并不好：<strong><code>selectedItem</code> 的内容与 <code>items</code> 列表中的某个项是同一个对象。</strong> 这意味着关于该项本身的信息在两个地方产生了重复。<p>为什么这是个问题？让我们使每个项目都可以编辑：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialItems <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Menu</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>items<span class="token punctuation">,</span> setItems<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>selectedItem<span class="token punctuation">,</span> setSelectedItem<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>
    items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleItemChange</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
          <span class="token spread operator">...</span>item<span class="token punctuation">,</span>
          # e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> item<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">What</span>'s your travel snack<span class="token operator">?</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span> 
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token operator">&#x3C;</span>input
              value<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
              onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
                <span class="token function">handleItemChange</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
              <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
            <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
              <span class="token function">setSelectedItem</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Choose</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">You</span> picked <span class="token punctuation">{</span>selectedItem<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>请注意，如果你首先单击菜单上的“Choose” <strong>然后</strong> 编辑它，<strong>输入会更新，但底部的标签不会反映编辑内容。</strong> 这是因为你有重复的 state，并且你忘记更新了 <code>selectedItem</code>。<p>尽管你也可以更新 <code>selectedItem</code>，但更简单的解决方法是消除重复项。在下面这个例子中，你将 <code>selectedId</code> 保存在 state 中，而不是在 <code>selectedItem</code> 对象中（它创建了一个与 <code>items</code> 内重复的对象），<strong>然后</strong> 通过搜索 <code>items</code> 数组中具有该 ID 的项，以此获取 <code>selectedItem</code>：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialItems <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Menu</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>items<span class="token punctuation">,</span> setItems<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>selectedId<span class="token punctuation">,</span> setSelectedId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> selectedItem <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span>
    item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> selectedId
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleItemChange</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
          <span class="token spread operator">...</span>item<span class="token punctuation">,</span>
          # e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> item<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">What</span>'s your travel snack<span class="token operator">?</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token operator">&#x3C;</span>input
              value<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
              onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
                <span class="token function">handleItemChange</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
              <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
            <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
              <span class="token function">setSelectedId</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Choose</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">You</span> picked <span class="token punctuation">{</span>selectedItem<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>state 过去常常是这样复制的：<p>改了之后是这样的：<ul><li><code>selectedId = 0</code></ul><p>重复的 state 没有了，你只保留了必要的 state！<p>现在，如果你编辑 <strong>selected</strong> 元素，下面的消息将立即更新。这是因为 <code>setItems</code> 会触发重新渲染，而 <code>items.find(...)</code> 会找到带有更新文本的元素。你不需要在 state 中保存 <strong>选定的元素</strong>，因为只有 <strong>选定的 ID</strong> 是必要的。其余的可以在渲染期间计算。</section><section class="level2"aria-labelledby="避免深度嵌套的-state-avoid-deeply-nested-state"><h2 id="避免深度嵌套的-state-avoid-deeply-nested-state">避免深度嵌套的 state {/<em>avoid-deeply-nested-state</em>/}</h2><p>想象一下，一个由行星、大陆和国家组成的旅行计划。你可能会尝试使用嵌套对象和数组来构建它的 state，就像下面这个例子：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialTravelPlan <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./places.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">PlaceTree</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> place <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> childPlaces <span class="token operator">=</span> place<span class="token punctuation">.</span><span class="token property-access">childPlaces</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li<span class="token operator">></span>
      <span class="token punctuation">{</span>place<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
      <span class="token punctuation">{</span>childPlaces<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&#x26;&#x26;</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>ol<span class="token operator">></span>
          <span class="token punctuation">{</span>childPlaces<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">place</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
            <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PlaceTree</span> key<span class="token operator">=</span><span class="token punctuation">{</span>place<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span> place<span class="token operator">=</span><span class="token punctuation">{</span>place<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>ol<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TravelPlan</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>plan<span class="token punctuation">,</span> setPlan<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialTravelPlan<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> planets <span class="token operator">=</span> plan<span class="token punctuation">.</span><span class="token property-access">childPlaces</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Places</span> to visit<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ol<span class="token operator">></span>
        <span class="token punctuation">{</span>planets<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">place</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PlaceTree</span> key<span class="token operator">=</span><span class="token punctuation">{</span>place<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span> place<span class="token operator">=</span><span class="token punctuation">{</span>place<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ol<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> initialTravelPlan <span class="token operator">=</span> <span class="token punctuation">{</span>
  # <span class="token string">'(Root)'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    # <span class="token string">'Earth'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      # <span class="token string">'Africa'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        # <span class="token string">'Botswana'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Egypt'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Kenya'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Madagascar'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Morocco'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Nigeria'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'South Africa'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      # <span class="token string">'Americas'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        # <span class="token string">'Argentina'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Brazil'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Barbados'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Canada'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Jamaica'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Mexico'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Trinidad and Tobago'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Venezuela'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      # <span class="token string">'Asia'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        # <span class="token string">'China'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'India'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Singapore'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'South Korea'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Thailand'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Vietnam'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      # <span class="token string">'Europe'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        # <span class="token string">'Croatia'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'France'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Germany'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Italy'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Portugal'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Spain'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Turkey'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      # <span class="token string">'Oceania'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        # <span class="token string">'Australia'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Bora Bora (French Polynesia)'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Easter Island (Chile)'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Fiji'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Hawaii (the USA)'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'New Zealand'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Vanuatu'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    # <span class="token string">'Moon'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      # <span class="token string">'Rheita'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      # <span class="token string">'Piccolomini'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      # <span class="token string">'Tycho'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    # <span class="token string">'Mars'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      # <span class="token string">'Corn Town'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      # <span class="token string">'Green Hill'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>      
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></sandpack><p>现在，假设你想添加一个按钮来删除一个你已经去过的地方。你会怎么做呢？<a href="/learn/updating-objects-in-state#updating-a-nested-object">更新嵌套的 state</a> 需要从更改部分一直向上复制对象。删除一个深度嵌套的地点将涉及复制其整个父级地点链。这样的代码可能非常冗长。<p><strong>如果 state 嵌套太深，难以轻松更新，可以考虑将其“扁平化”。</strong> 这里有一个方法可以重构上面这个数据。不同于树状结构，每个节点的 <code>place</code> 都是一个包含 <strong>其子节点</strong> 的数组，你可以让每个节点的 <code>place</code> 作为数组保存 <strong>其子节点的 ID</strong>。然后存储一个节点 ID 与相应节点的映射关系。<p>这个数据重组可能会让你想起看到一个数据库表：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialTravelPlan <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./places.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">PlaceTree</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> id<span class="token punctuation">,</span> placesById <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> place <span class="token operator">=</span> placesById<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> childIds <span class="token operator">=</span> place<span class="token punctuation">.</span><span class="token property-access">childIds</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li<span class="token operator">></span>
      <span class="token punctuation">{</span>place<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
      <span class="token punctuation">{</span>childIds<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&#x26;&#x26;</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>ol<span class="token operator">></span>
          <span class="token punctuation">{</span>childIds<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">childId</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
            <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PlaceTree</span>
              key<span class="token operator">=</span><span class="token punctuation">{</span>childId<span class="token punctuation">}</span>
              id<span class="token operator">=</span><span class="token punctuation">{</span>childId<span class="token punctuation">}</span>
              placesById<span class="token operator">=</span><span class="token punctuation">{</span>placesById<span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>ol<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TravelPlan</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>plan<span class="token punctuation">,</span> setPlan<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialTravelPlan<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> root <span class="token operator">=</span> plan<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> planetIds <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token property-access">childIds</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Places</span> to visit<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ol<span class="token operator">></span>
        <span class="token punctuation">{</span>planetIds<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PlaceTree</span>
            key<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>
            id<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>
            placesById<span class="token operator">=</span><span class="token punctuation">{</span>plan<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ol<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> initialTravelPlan <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'(Root)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Earth'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Africa'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span> <span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Botswana'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Egypt'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Kenya'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Madagascar'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Morocco'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">8</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Nigeria'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">9</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'South Africa'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">10</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Americas'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Argentina'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">12</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Brazil'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">13</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Barbados'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token number">14</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Canada'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">15</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Jamaica'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">16</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Mexico'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">17</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Trinidad and Tobago'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">18</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Venezuela'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">19</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Asia'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">20</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'China'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">21</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'India'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Singapore'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">23</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'South Korea'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">24</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Thailand'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">25</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Vietnam'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">26</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Europe'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">27</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Croatia'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">28</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'France'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">29</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Germany'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">30</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Italy'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">31</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Portugal'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">32</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Spain'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Turkey'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">34</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Oceania'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">35</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Australia'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">36</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Bora Bora (French Polynesia)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">37</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Easter Island (Chile)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">38</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Fiji'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">39</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Hawaii (the USA)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">40</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'New Zealand'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">41</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Vanuatu'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">42</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Moon'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">43</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Rheita'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">44</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Piccolomini'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">45</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Tycho'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">46</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Mars'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">47</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Corn Town'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">48</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Green Hill'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></sandpack><p><strong>现在 state 已经“扁平化”（也称为“规范化”），更新嵌套项会变得更加容易。</strong><p>现在要删除一个地点，您只需要更新两个 state 级别：<ul><li>其 <strong>父级</strong> 地点的更新版本应该从其 <code>childIds</code> 数组中排除已删除的 ID。<li>其根级“表”对象的更新版本应包括父级地点的更新版本。</ul><p>下面是展示如何处理它的一个示例：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialTravelPlan <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./places.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TravelPlan</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>plan<span class="token punctuation">,</span> setPlan<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialTravelPlan<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleComplete</span><span class="token punctuation">(</span><span class="token parameter">parentId<span class="token punctuation">,</span> childId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> parent <span class="token operator">=</span> plan<span class="token punctuation">[</span>parentId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建一个其父级地点的新版本</span>
    <span class="token comment">// 但不包括子级 ID。</span>
    <span class="token keyword">const</span> nextParent <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token spread operator">...</span>parent<span class="token punctuation">,</span>
      <span class="token literal-property property">childIds</span><span class="token operator">:</span> parent<span class="token punctuation">.</span><span class="token property-access">childIds</span>
        <span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token arrow operator">=></span> id <span class="token operator">!==</span> childId<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 更新根 state 对象...</span>
    <span class="token function">setPlan</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token spread operator">...</span>plan<span class="token punctuation">,</span>
      <span class="token comment">// ...以便它拥有更新的父级。</span>
      <span class="token punctuation">[</span>parentId<span class="token punctuation">]</span><span class="token operator">:</span> nextParent
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> root <span class="token operator">=</span> plan<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> planetIds <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token property-access">childIds</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Places</span> to visit<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ol<span class="token operator">></span>
        <span class="token punctuation">{</span>planetIds<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PlaceTree</span>
            key<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>
            id<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>
            parentId<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span>
            placesById<span class="token operator">=</span><span class="token punctuation">{</span>plan<span class="token punctuation">}</span>
            onComplete<span class="token operator">=</span><span class="token punctuation">{</span>handleComplete<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ol<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">PlaceTree</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> id<span class="token punctuation">,</span> parentId<span class="token punctuation">,</span> placesById<span class="token punctuation">,</span> onComplete <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> place <span class="token operator">=</span> placesById<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> childIds <span class="token operator">=</span> place<span class="token punctuation">.</span><span class="token property-access">childIds</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li<span class="token operator">></span>
      <span class="token punctuation">{</span>place<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onComplete</span><span class="token punctuation">(</span>parentId<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Complete</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>childIds<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&#x26;&#x26;</span>
        <span class="token operator">&#x3C;</span>ol<span class="token operator">></span>
          <span class="token punctuation">{</span>childIds<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">childId</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
            <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PlaceTree</span>
              key<span class="token operator">=</span><span class="token punctuation">{</span>childId<span class="token punctuation">}</span>
              id<span class="token operator">=</span><span class="token punctuation">{</span>childId<span class="token punctuation">}</span>
              parentId<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>
              placesById<span class="token operator">=</span><span class="token punctuation">{</span>placesById<span class="token punctuation">}</span>
              onComplete<span class="token operator">=</span><span class="token punctuation">{</span>onComplete<span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>ol<span class="token operator">></span>
      <span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> initialTravelPlan <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'(Root)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Earth'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Africa'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span> <span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Botswana'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Egypt'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Kenya'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Madagascar'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Morocco'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">8</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Nigeria'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">9</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'South Africa'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">10</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Americas'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Argentina'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">12</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Brazil'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">13</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Barbados'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token number">14</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Canada'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">15</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Jamaica'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">16</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Mexico'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">17</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Trinidad and Tobago'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">18</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Venezuela'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">19</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Asia'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">20</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'China'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">21</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'India'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Singapore'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">23</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'South Korea'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">24</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Thailand'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">25</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Vietnam'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">26</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Europe'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">27</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Croatia'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">28</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'France'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">29</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Germany'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">30</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Italy'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">31</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Portugal'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">32</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Spain'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Turkey'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">34</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Oceania'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">35</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Australia'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">36</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Bora Bora (French Polynesia)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">37</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Easter Island (Chile)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">38</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Fiji'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">39</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Hawaii (the USA)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">40</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'New Zealand'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">41</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Vanuatu'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">42</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Moon'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">43</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Rheita'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">44</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Piccolomini'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">45</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Tycho'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">46</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Mars'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">47</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Corn Town'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">48</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Green Hill'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>你确实可以随心所欲地嵌套 state，但是将其“扁平化”可以解决许多问题。这使得 state 更容易更新，并且有助于确保在嵌套对象的不同部分中没有重复。</p><deepdive><section class="level4"aria-labelledby="改善内存使用-improving-memory-usage"><h4 id="改善内存使用-improving-memory-usage">改善内存使用 {/<em>improving-memory-usage</em>/}</h4><p>理想情况下，您还应该从“表”对象中删除已删除的项目（以及它们的子项！）以改善内存使用。还可以 <a href="/learn/updating-objects-in-state#write-concise-update-logic-with-immer">使用 Immer</a> 使更新逻辑更加简洁。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useImmer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'use-immer'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialTravelPlan <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./places.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TravelPlan</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>plan<span class="token punctuation">,</span> updatePlan<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useImmer</span><span class="token punctuation">(</span>initialTravelPlan<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleComplete</span><span class="token punctuation">(</span><span class="token parameter">parentId<span class="token punctuation">,</span> childId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">updatePlan</span><span class="token punctuation">(</span><span class="token parameter">draft</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// 从父级地点的子 ID 中移除。</span>
      <span class="token keyword">const</span> parent <span class="token operator">=</span> draft<span class="token punctuation">[</span>parentId<span class="token punctuation">]</span><span class="token punctuation">;</span>
      parent<span class="token punctuation">.</span><span class="token property-access">childIds</span> <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token property-access">childIds</span>
        <span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token arrow operator">=></span> id <span class="token operator">!==</span> childId<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 删除这个地点和它的所有子目录。</span>
      <span class="token function">deleteAllChildren</span><span class="token punctuation">(</span>childId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">function</span> <span class="token function">deleteAllChildren</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> place <span class="token operator">=</span> draft<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
        place<span class="token punctuation">.</span><span class="token property-access">childIds</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span>deleteAllChildren<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">delete</span> draft<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> root <span class="token operator">=</span> plan<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> planetIds <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token property-access">childIds</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Places</span> to visit<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ol<span class="token operator">></span>
        <span class="token punctuation">{</span>planetIds<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PlaceTree</span>
            key<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>
            id<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>
            parentId<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span>
            placesById<span class="token operator">=</span><span class="token punctuation">{</span>plan<span class="token punctuation">}</span>
            onComplete<span class="token operator">=</span><span class="token punctuation">{</span>handleComplete<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ol<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">PlaceTree</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> id<span class="token punctuation">,</span> parentId<span class="token punctuation">,</span> placesById<span class="token punctuation">,</span> onComplete <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> place <span class="token operator">=</span> placesById<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> childIds <span class="token operator">=</span> place<span class="token punctuation">.</span><span class="token property-access">childIds</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li<span class="token operator">></span>
      <span class="token punctuation">{</span>place<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onComplete</span><span class="token punctuation">(</span>parentId<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Complete</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>childIds<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&#x26;&#x26;</span>
        <span class="token operator">&#x3C;</span>ol<span class="token operator">></span>
          <span class="token punctuation">{</span>childIds<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">childId</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
            <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PlaceTree</span>
              key<span class="token operator">=</span><span class="token punctuation">{</span>childId<span class="token punctuation">}</span>
              id<span class="token operator">=</span><span class="token punctuation">{</span>childId<span class="token punctuation">}</span>
              parentId<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>
              placesById<span class="token operator">=</span><span class="token punctuation">{</span>placesById<span class="token punctuation">}</span>
              onComplete<span class="token operator">=</span><span class="token punctuation">{</span>onComplete<span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>ol<span class="token operator">></span>
      <span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> initialTravelPlan <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'(Root)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Earth'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Africa'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span> <span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Botswana'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Egypt'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Kenya'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Madagascar'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Morocco'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">8</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Nigeria'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">9</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'South Africa'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">10</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Americas'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Argentina'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">12</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Brazil'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">13</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Barbados'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token number">14</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Canada'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">15</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Jamaica'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">16</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Mexico'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">17</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Trinidad and Tobago'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">18</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Venezuela'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">19</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Asia'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">20</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'China'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">21</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'India'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Singapore'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">23</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'South Korea'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">24</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Thailand'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">25</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Vietnam'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">26</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Europe'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">27</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Croatia'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">28</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'France'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">29</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Germany'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">30</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Italy'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">31</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Portugal'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">32</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Spain'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Turkey'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">34</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Oceania'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">35</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Australia'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">36</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Bora Bora (French Polynesia)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">37</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Easter Island (Chile)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">38</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Fiji'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">39</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Hawaii (the USA)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">40</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'New Zealand'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">41</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Vanuatu'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">42</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Moon'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">43</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Rheita'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">44</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Piccolomini'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">45</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Tycho'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">46</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Mars'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">47</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Corn Town'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">48</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Green Hill'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"immer"</span><span class="token operator">:</span> <span class="token string">"1.7.3"</span><span class="token punctuation">,</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"use-immer"</span><span class="token operator">:</span> <span class="token string">"0.5.1"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></sandpack></section></deepdive><p>有时候，你也可以通过将一些嵌套 state 移动到子组件中来减少 state 的嵌套。这对于不需要保存的短暂 UI 状态非常有效，比如一个选项是否被悬停。</p><recap><ul><li>如果两个 state 变量总是一起更新，请考虑将它们合并为一个。<li>仔细选择你的 state 变量，以避免创建“极难处理”的 state。<li>用一种减少出错更新的机会的方式来构建你的 state。<li>避免冗余和重复的 state，这样您就不需要保持同步。<li>除非您特别想防止更新，否则不要将 props <strong>放入</strong> state 中。<li>对于选择类型的 UI 模式，请在 state 中保存 ID 或索引而不是对象本身。<li>如果深度嵌套 state 更新很复杂，请尝试将其展开扁平化。</ul></recap><challenges><section class="level4"aria-labelledby="修复一个未更新的组件-fix-a-component-thats-not-updating"><h4 id="修复一个未更新的组件-fix-a-component-thats-not-updating">修复一个未更新的组件 {/<em>fix-a-component-thats-not-updating</em>/}</h4><p>这个 <code>Clock</code> 组件接收两个属性：<code>color</code> 和 <code>time</code>。当您在选择框中选择不同的颜色时，<code>Clock</code> 组件将从其父组件接收到一个不同的 <code>color</code> 属性。然而，由于某种原因，显示的颜色没有更新。为什么？请修复这个问题。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Clock</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token property-access">color</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>h1 style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> color <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>props<span class="token punctuation">.</span><span class="token property-access">time</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Clock</span></span> <span class="token keyword module">from</span> <span class="token string">'./Clock.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">useTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>time<span class="token punctuation">,</span> setTime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> time<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token function">useTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'lightcoral'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Pick</span> a color<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select value<span class="token operator">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setColor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"lightcoral"</span><span class="token operator">></span>lightcoral<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"midnightblue"</span><span class="token operator">></span>midnightblue<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"rebeccapurple"</span><span class="token operator">></span>rebeccapurple<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Clock</span> color<span class="token operator">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span> time<span class="token operator">=</span><span class="token punctuation">{</span>time<span class="token punctuation">.</span><span class="token method function property-access">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution><p>这个问题点在于此组件的 <code>color</code> state 是使用 <code>color</code> prop 的初始值进行初始化的。但是当 <code>color</code> prop 值发生更改时，这不会影响 state 变量！因此它们会失去同步。为了解决这个问题，完全删除 state 变量，并直接使用 <code>color</code> prop 即可。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Clock</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>h1 style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> props<span class="token punctuation">.</span><span class="token property-access">color</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>props<span class="token punctuation">.</span><span class="token property-access">time</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Clock</span></span> <span class="token keyword module">from</span> <span class="token string">'./Clock.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">useTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>time<span class="token punctuation">,</span> setTime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> time<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token function">useTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'lightcoral'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Pick</span> a color<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select value<span class="token operator">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setColor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"lightcoral"</span><span class="token operator">></span>lightcoral<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"midnightblue"</span><span class="token operator">></span>midnightblue<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"rebeccapurple"</span><span class="token operator">></span>rebeccapurple<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Clock</span> color<span class="token operator">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span> time<span class="token operator">=</span><span class="token punctuation">{</span>time<span class="token punctuation">.</span><span class="token method function property-access">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>或者，使用解构语法：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Clock</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> color<span class="token punctuation">,</span> time <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>h1 style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> color <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>time<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Clock</span></span> <span class="token keyword module">from</span> <span class="token string">'./Clock.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">useTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>time<span class="token punctuation">,</span> setTime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> time<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token function">useTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'lightcoral'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Pick</span> a color<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select value<span class="token operator">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setColor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"lightcoral"</span><span class="token operator">></span>lightcoral<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"midnightblue"</span><span class="token operator">></span>midnightblue<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"rebeccapurple"</span><span class="token operator">></span>rebeccapurple<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Clock</span> color<span class="token operator">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span> time<span class="token operator">=</span><span class="token punctuation">{</span>time<span class="token punctuation">.</span><span class="token method function property-access">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack></solution></section><section class="level4"aria-labelledby="修复一个损坏的打包清单-fix-a-broken-packing-list"><h4 id="修复一个损坏的打包清单-fix-a-broken-packing-list">修复一个损坏的打包清单 {/<em>fix-a-broken-packing-list</em>/}</h4><p>这个打包清单有一个页脚，显示了打包的物品数量和总共的物品数量。一开始看起来似乎很好用，但是它也存在漏洞。例如，如果你将一个物品标记为已打包然后删除它，计数器就不会正确更新。请修复计数器以使其始终正确。</p><hint><p>在这个例子中，是否有 state 是多余的？</p></hint><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">AddItem</span></span> <span class="token keyword module">from</span> <span class="token string">'./AddItem.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">PackingList</span></span> <span class="token keyword module">from</span> <span class="token string">'./PackingList.js'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> nextId <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> initialItems <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TravelPlan</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>items<span class="token punctuation">,</span> setItems<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>total<span class="token punctuation">,</span> setTotal<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>packed<span class="token punctuation">,</span> setPacked<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleAddItem</span><span class="token punctuation">(</span><span class="token parameter">title</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTotal</span><span class="token punctuation">(</span>total <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token spread operator">...</span>items<span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        # title<span class="token punctuation">,</span>
        <span class="token literal-property property">packed</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleChangeItem</span><span class="token punctuation">(</span><span class="token parameter">nextItem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>nextItem<span class="token punctuation">.</span><span class="token property-access">packed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setPacked</span><span class="token punctuation">(</span>packed <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token function">setPacked</span><span class="token punctuation">(</span>packed <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> nextItem<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> nextItem<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> item<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleDeleteItem</span><span class="token punctuation">(</span><span class="token parameter">itemId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTotal</span><span class="token punctuation">(</span>total <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span>
      items<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">!==</span> itemId<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>  
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddItem</span>
        onAddItem<span class="token operator">=</span><span class="token punctuation">{</span>handleAddItem<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PackingList</span>
        items<span class="token operator">=</span><span class="token punctuation">{</span>items<span class="token punctuation">}</span>
        onChangeItem<span class="token operator">=</span><span class="token punctuation">{</span>handleChangeItem<span class="token punctuation">}</span>
        onDeleteItem<span class="token operator">=</span><span class="token punctuation">{</span>handleDeleteItem<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>packed<span class="token punctuation">}</span> out <span class="token keyword">of</span> <span class="token punctuation">{</span>total<span class="token punctuation">}</span> packed<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AddItem</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onAddItem <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>title<span class="token punctuation">,</span> setTitle<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        placeholder<span class="token operator">=</span><span class="token string">"Add item"</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>title<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setTitle</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">onAddItem</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Add</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">PackingList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  items<span class="token punctuation">,</span>
  onChangeItem<span class="token punctuation">,</span>
  onDeleteItem
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
      <span class="token punctuation">{</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
            <span class="token operator">&#x3C;</span>input
              type<span class="token operator">=</span><span class="token string">"checkbox"</span>
              checked<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">packed</span><span class="token punctuation">}</span>
              onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
                <span class="token function">onChangeItem</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                  <span class="token spread operator">...</span>item<span class="token punctuation">,</span>
                  <span class="token literal-property property">packed</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
            <span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">onDeleteItem</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token maybe-class-name">Delete</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">ul<span class="token punctuation">,</span> li</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p>虽然你可以仔细更改每个事件处理程序来正确更新 <code>total</code> 和 <code>packed</code> 计数器，但根本问题在于这些 state 变量一直存在。它们是冗余的，因为你始终可以从 <code>item</code> 数组本身计算出物品（已打包或总共）的数量。因此需要删除冗余 state 以修复错误：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">AddItem</span></span> <span class="token keyword module">from</span> <span class="token string">'./AddItem.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">PackingList</span></span> <span class="token keyword module">from</span> <span class="token string">'./PackingList.js'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> nextId <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> initialItems <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TravelPlan</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>items<span class="token punctuation">,</span> setItems<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialItems<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> total <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> packed <span class="token operator">=</span> items
    <span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> item<span class="token punctuation">.</span><span class="token property-access">packed</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleAddItem</span><span class="token punctuation">(</span><span class="token parameter">title</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token spread operator">...</span>items<span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        # title<span class="token punctuation">,</span>
        <span class="token literal-property property">packed</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleChangeItem</span><span class="token punctuation">(</span><span class="token parameter">nextItem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> nextItem<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> nextItem<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> item<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleDeleteItem</span><span class="token punctuation">(</span><span class="token parameter">itemId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span>
      items<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">!==</span> itemId<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>  
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddItem</span>
        onAddItem<span class="token operator">=</span><span class="token punctuation">{</span>handleAddItem<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PackingList</span>
        items<span class="token operator">=</span><span class="token punctuation">{</span>items<span class="token punctuation">}</span>
        onChangeItem<span class="token operator">=</span><span class="token punctuation">{</span>handleChangeItem<span class="token punctuation">}</span>
        onDeleteItem<span class="token operator">=</span><span class="token punctuation">{</span>handleDeleteItem<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>packed<span class="token punctuation">}</span> out <span class="token keyword">of</span> <span class="token punctuation">{</span>total<span class="token punctuation">}</span> packed<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AddItem</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onAddItem <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>title<span class="token punctuation">,</span> setTitle<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        placeholder<span class="token operator">=</span><span class="token string">"Add item"</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>title<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setTitle</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">onAddItem</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Add</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">PackingList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  items<span class="token punctuation">,</span>
  onChangeItem<span class="token punctuation">,</span>
  onDeleteItem
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
      <span class="token punctuation">{</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
            <span class="token operator">&#x3C;</span>input
              type<span class="token operator">=</span><span class="token string">"checkbox"</span>
              checked<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">packed</span><span class="token punctuation">}</span>
              onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
                <span class="token function">onChangeItem</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                  <span class="token spread operator">...</span>item<span class="token punctuation">,</span>
                  <span class="token literal-property property">packed</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
            <span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">onDeleteItem</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token maybe-class-name">Delete</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">ul<span class="token punctuation">,</span> li</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>请注意，事件处理程序在这次更改后只关心调用 <code>setItems</code>。现在，项目计数是从 <code>items</code> 中在下一次渲染期间计算的，因此它们始终是最新的。</p></solution></section><section class="level4"aria-labelledby="修复消失的选项-fix-the-disappearing-selection"><h4 id="修复消失的选项-fix-the-disappearing-selection">修复消失的选项 {/<em>fix-the-disappearing-selection</em>/}</h4><p>有一个 <code>letters</code> 列表在 state 中。当你悬停或聚焦到特定的信件时，它会被突出显示。当前突出显示的信件存储在 <code>highlightedLetter</code> state 变量中。您可以“Star”和“Unstar”单个信件，这将更新 state 中的 <code>letters</code> 数组。<p>虽然这段代码可以运行，但是有一个小的 UI 问题。当你点击“Star”或“Unstar”时，高亮会短暂消失。不过只要你移动鼠标指针或者用键盘切换到另一个信件，它就会重新出现。为什么会这样？请修复它，使得在按钮点击后高亮不会消失。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialLetters <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./data.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Letter</span></span> <span class="token keyword module">from</span> <span class="token string">'./Letter.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MailClient</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>letters<span class="token punctuation">,</span> setLetters<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialLetters<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>highlightedLetter<span class="token punctuation">,</span> setHighlightedLetter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleHover</span><span class="token punctuation">(</span><span class="token parameter">letter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setHighlightedLetter</span><span class="token punctuation">(</span>letter<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleStar</span><span class="token punctuation">(</span><span class="token parameter">starred</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setLetters</span><span class="token punctuation">(</span>letters<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">letter</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> starred<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
          <span class="token spread operator">...</span>letter<span class="token punctuation">,</span>
          <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token operator">!</span>letter<span class="token punctuation">.</span><span class="token property-access">isStarred</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> letter<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Inbox</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>letters<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">letter</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Letter</span>
            key<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span>
            letter<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">}</span>
            isHighlighted<span class="token operator">=</span><span class="token punctuation">{</span>
              letter <span class="token operator">===</span> highlightedLetter
            <span class="token punctuation">}</span>
            onHover<span class="token operator">=</span><span class="token punctuation">{</span>handleHover<span class="token punctuation">}</span>
            onToggleStar<span class="token operator">=</span><span class="token punctuation">{</span>handleStar<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Letter</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  letter<span class="token punctuation">,</span>
  isHighlighted<span class="token punctuation">,</span>
  onHover<span class="token punctuation">,</span>
  onToggleStar<span class="token punctuation">,</span>
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li
      className<span class="token operator">=</span><span class="token punctuation">{</span>
        isHighlighted <span class="token operator">?</span> <span class="token string">'highlighted'</span> <span class="token operator">:</span> <span class="token string">''</span>
      <span class="token punctuation">}</span>
      onFocus<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onHover</span><span class="token punctuation">(</span>letter<span class="token punctuation">)</span><span class="token punctuation">;</span>        
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
      onPointerMove<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onHover</span><span class="token punctuation">(</span>letter<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onToggleStar</span><span class="token punctuation">(</span>letter<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">isStarred</span> <span class="token operator">?</span> <span class="token string">'Unstar'</span> <span class="token operator">:</span> <span class="token string">'Star'</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">subject</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> initialLetters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Ready for adventure?'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Time to check in!'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Festival Begins in Just SEVEN Days!'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.highlighted</span></span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#d2eaff</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p>这个问题点在于你将信件对象存储在 <code>highlightedLetter</code> 中。但是，你也将相同的信息存储在 <code>letters</code> 数组中。因此，你的 state 存在重复！当你在按钮点击后更新 <code>letters</code> 数组时，会创建一个新的信件对象，它与 <code>highlightedLetter</code> 不同。这就是 <code>highlightedLetter === letter</code> 执行变为 <code>false</code>，并且高亮消失的原因。当指针移动时下一次调用 <code>setHighlightedLetter</code> 时它会重新出现。<p>为了解决这个问题，请从 state 中删除重复项。不要在两个地方存储 <strong>信件对象本身</strong>，而是存储 <code>highlightedId</code>。然后，您可以使用 <code>letter.id === highlightedId</code> 检查每个带有 <code>isHighlighted</code> 属性的信件，即使 <code>letter</code> 对象在上次渲染后发生了变化，这也是可行的。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialLetters <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./data.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Letter</span></span> <span class="token keyword module">from</span> <span class="token string">'./Letter.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MailClient</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>letters<span class="token punctuation">,</span> setLetters<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialLetters<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>highlightedId<span class="token punctuation">,</span> setHighlightedId <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleHover</span><span class="token punctuation">(</span><span class="token parameter">letterId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setHighlightedId</span><span class="token punctuation">(</span>letterId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleStar</span><span class="token punctuation">(</span><span class="token parameter">starredId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setLetters</span><span class="token punctuation">(</span>letters<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">letter</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> starredId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
          <span class="token spread operator">...</span>letter<span class="token punctuation">,</span>
          <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token operator">!</span>letter<span class="token punctuation">.</span><span class="token property-access">isStarred</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> letter<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Inbox</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>letters<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">letter</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Letter</span>
            key<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span>
            letter<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">}</span>
            isHighlighted<span class="token operator">=</span><span class="token punctuation">{</span>
              letter<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> highlightedId
            <span class="token punctuation">}</span>
            onHover<span class="token operator">=</span><span class="token punctuation">{</span>handleHover<span class="token punctuation">}</span>
            onToggleStar<span class="token operator">=</span><span class="token punctuation">{</span>handleStar<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Letter</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  letter<span class="token punctuation">,</span>
  isHighlighted<span class="token punctuation">,</span>
  onHover<span class="token punctuation">,</span>
  onToggleStar<span class="token punctuation">,</span>
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li
      className<span class="token operator">=</span><span class="token punctuation">{</span>
        isHighlighted <span class="token operator">?</span> <span class="token string">'highlighted'</span> <span class="token operator">:</span> <span class="token string">''</span>
      <span class="token punctuation">}</span>
      onFocus<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onHover</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
      onPointerMove<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onHover</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onToggleStar</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">isStarred</span> <span class="token operator">?</span> <span class="token string">'Unstar'</span> <span class="token operator">:</span> <span class="token string">'Star'</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">subject</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> initialLetters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Ready for adventure?'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Time to check in!'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Festival Begins in Just SEVEN Days!'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.highlighted</span></span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#d2eaff</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack></solution></section><section class="level4"aria-labelledby="实现多选功能-implement-multiple-selection"><h4 id="实现多选功能-implement-multiple-selection">实现多选功能 {/<em>implement-multiple-selection</em>/}</h4><p>在这个例子中，每个 <code>Letter</code> 都有一个 <code>isSelected</code> prop 和一个 <code>onToggle</code> 处理程序来标记它为选定 state。这样做是有效的，但是 state 被存储为 <code>selectedId</code>（也可以是 <code>null</code> 或 <code>ID</code>），因此任何时候只能选择一个 letter。<p>你需要将 state 结构更改为支持多选功能。（在编写代码之前，请考虑如何构建它。）每个复选框应该独立于其他复选框。单击已选择的项目应取消选择。最后，页脚应显示所选项目的正确数量。</p><hint><p>你可以在 state 中保存一个选定 ID 的数组或 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a>，而不是单个选定的 ID。</p></hint><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> letters <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./data.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Letter</span></span> <span class="token keyword module">from</span> <span class="token string">'./Letter.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MailClient</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>selectedId<span class="token punctuation">,</span> setSelectedId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// TODO: 支持多选</span>
  <span class="token keyword">const</span> selectedCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleToggle</span><span class="token punctuation">(</span><span class="token parameter">toggledId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO: 支持多选</span>
    <span class="token function">setSelectedId</span><span class="token punctuation">(</span>toggledId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Inbox</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>letters<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">letter</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Letter</span>
            key<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span>
            letter<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">}</span>
            isSelected<span class="token operator">=</span><span class="token punctuation">{</span>
              <span class="token comment">// TODO: 支持多选</span>
              letter<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> selectedId
            <span class="token punctuation">}</span>
            onToggle<span class="token operator">=</span><span class="token punctuation">{</span>handleToggle<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>b<span class="token operator">></span>
            <span class="token maybe-class-name">You</span> selected <span class="token punctuation">{</span>selectedCount<span class="token punctuation">}</span> letters
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Letter</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  letter<span class="token punctuation">,</span>
  onToggle<span class="token punctuation">,</span>
  isSelected<span class="token punctuation">,</span>
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li className<span class="token operator">=</span><span class="token punctuation">{</span>
      isSelected <span class="token operator">?</span> <span class="token string">'selected'</span> <span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isSelected<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
            <span class="token function">onToggle</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">subject</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> letters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Ready for adventure?'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Time to check in!'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Festival Begins in Just SEVEN Days!'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.selected</span></span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#d2eaff</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p>在 state 中保留一个 <code>selectedIds</code> <strong>数组</strong>，而不是单个的 <code>selectedId</code>。例如，如果您选择了第一个和最后一个信件，则它将包含 <code>[0, 2]</code>。当没有选定任何内容时，它将为空数组 <code>[]</code>：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> letters <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./data.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Letter</span></span> <span class="token keyword module">from</span> <span class="token string">'./Letter.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MailClient</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>selectedIds<span class="token punctuation">,</span> setSelectedIds<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> selectedCount <span class="token operator">=</span> selectedIds<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleToggle</span><span class="token punctuation">(</span><span class="token parameter">toggledId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 它以前是被选中的吗？</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>selectedIds<span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span>toggledId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Then remove this ID from the array.</span>
      <span class="token function">setSelectedIds</span><span class="token punctuation">(</span>selectedIds<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token arrow operator">=></span>
        id <span class="token operator">!==</span> toggledId
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 否则，增加 ID 到数组中。</span>
      <span class="token function">setSelectedIds</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token spread operator">...</span>selectedIds<span class="token punctuation">,</span>
        toggledId
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Inbox</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>letters<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">letter</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Letter</span>
            key<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span>
            letter<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">}</span>
            isSelected<span class="token operator">=</span><span class="token punctuation">{</span>
              selectedIds<span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            onToggle<span class="token operator">=</span><span class="token punctuation">{</span>handleToggle<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>b<span class="token operator">></span>
            <span class="token maybe-class-name">You</span> selected <span class="token punctuation">{</span>selectedCount<span class="token punctuation">}</span> letters
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Letter</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  letter<span class="token punctuation">,</span>
  onToggle<span class="token punctuation">,</span>
  isSelected<span class="token punctuation">,</span>
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li className<span class="token operator">=</span><span class="token punctuation">{</span>
      isSelected <span class="token operator">?</span> <span class="token string">'selected'</span> <span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isSelected<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
            <span class="token function">onToggle</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">subject</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> letters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Ready for adventure?'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Time to check in!'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Festival Begins in Just SEVEN Days!'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.selected</span></span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#d2eaff</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>使用数组的一个小缺点是，对于每个项目，你都需要调用 <code>selectedIds.includes(letter.id)</code> 来检查它是否被选中。如果数组非常大，则这可能会成为性能问题，因为带有 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/includes"><code>includes()</code></a> 的数组搜索需要线性时间，并且你正在为每个单独的项目执行此搜索。<p>要解决这个问题，你可以在 state 中使用一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a> 对象，它提供了快速的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Set/has"><code>has()</code></a> 操作：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> letters <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./data.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Letter</span></span> <span class="token keyword module">from</span> <span class="token string">'./Letter.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MailClient</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>selectedIds<span class="token punctuation">,</span> setSelectedIds<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> selectedCount <span class="token operator">=</span> selectedIds<span class="token punctuation">.</span><span class="token property-access">size</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleToggle</span><span class="token punctuation">(</span><span class="token parameter">toggledId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Create a copy (to avoid mutation).</span>
    <span class="token keyword">const</span> nextIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>selectedIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>nextIds<span class="token punctuation">.</span><span class="token method function property-access">has</span><span class="token punctuation">(</span>toggledId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      nextIds<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span>toggledId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      nextIds<span class="token punctuation">.</span><span class="token method function property-access">add</span><span class="token punctuation">(</span>toggledId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">setSelectedIds</span><span class="token punctuation">(</span>nextIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Inbox</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>letters<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">letter</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Letter</span>
            key<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span>
            letter<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">}</span>
            isSelected<span class="token operator">=</span><span class="token punctuation">{</span>
              selectedIds<span class="token punctuation">.</span><span class="token method function property-access">has</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            onToggle<span class="token operator">=</span><span class="token punctuation">{</span>handleToggle<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>b<span class="token operator">></span>
            <span class="token maybe-class-name">You</span> selected <span class="token punctuation">{</span>selectedCount<span class="token punctuation">}</span> letters
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Letter</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  letter<span class="token punctuation">,</span>
  onToggle<span class="token punctuation">,</span>
  isSelected<span class="token punctuation">,</span>
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li className<span class="token operator">=</span><span class="token punctuation">{</span>
      isSelected <span class="token operator">?</span> <span class="token string">'selected'</span> <span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isSelected<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
            <span class="token function">onToggle</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">subject</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> letters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Ready for adventure?'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Time to check in!'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Festival Begins in Just SEVEN Days!'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.selected</span></span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#d2eaff</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>现在每个项目都会进行 <code>selectedIds.has(letter.id)</code> 检查，这非常快。<p>请记住，你<a href="/learn/updating-objects-in-state">不应该在 state 中改变对象</a>，包括 Set 中。这就是 <code>handleToggle</code> 函数首先创建 Set 的 <strong>副本</strong>，然后更新该副本的原因。</p></solution><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></challenges></section></section>