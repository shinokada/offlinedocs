<!doctype html><html lang="zh-hans"><meta charset="utf-8"><title>在组件间共享状态</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="在组件间共享状态"><h1 id="在组件间共享状态">在组件间共享状态</h1><p>translators:<ul><li>qinhua</ul><intro><p>有时候，你希望两个组件的状态始终同步更改。要实现这一点，可以将相关 state 从这两个组件上移除，并把 state 放到它们的公共父级，再通过 props 将 state 传递给这两个组件。这被称为“状态提升”，这是编写 React 代码时常做的事。</p></intro><youwilllearn><ul><li>如何使用状态提升在组件之间共享状态<li>什么是受控组件和非受控组件</ul></youwilllearn><section class="level2"aria-labelledby="举例说明一下状态提升-lifting-state-up-by-example"><h2 id="举例说明一下状态提升-lifting-state-up-by-example">举例说明一下状态提升 {/<em>lifting-state-up-by-example</em>/}</h2><p>在这个例子中，父组件 <code>Accordion</code> 渲染了 2 个独立的 <code>Panel</code> 组件。<ul><li><code>Accordion</code><ul><li><code>Panel</code><li><code>Panel</code></ul></ul><p>每个 <code>Panel</code> 组件都有一个布尔值 <code>isActive</code>，用于控制其内容是否可见。<p>请点击 2 个面板中的显示按钮：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Panel</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> title<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isActive<span class="token punctuation">,</span> setIsActive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>section className<span class="token operator">=</span><span class="token string">"panel"</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h3<span class="token operator">></span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h3<span class="token operator">></span>
      <span class="token punctuation">{</span>isActive <span class="token operator">?</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          显示
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>section<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Accordion</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span>哈萨克斯坦，阿拉木图<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span> title<span class="token operator">=</span><span class="token string">"关于"</span><span class="token operator">></span>
        阿拉木图人口约<span class="token number">200</span>万，是哈萨克斯坦最大的城市。它在 <span class="token number">1929</span> 年到 <span class="token number">1997</span> 年间都是首都。
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span> title<span class="token operator">=</span><span class="token string">"词源"</span><span class="token operator">></span>
        这个名字来自于 <span class="token operator">&#x3C;</span>span lang<span class="token operator">=</span><span class="token string">"kk-KZ"</span><span class="token operator">></span>алма<span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span>，哈萨克语中“苹果”的意思，经常被翻译成“苹果之乡”。事实上，阿拉木图的周边地区被认为是苹果的发源地，<span class="token operator">&#x3C;</span>i lang<span class="token operator">=</span><span class="token string">"la"</span><span class="token operator">></span><span class="token maybe-class-name">Malus</span> sieversii<span class="token operator">&#x3C;</span><span class="token operator">/</span>i<span class="token operator">></span> 被认为是现今苹果的祖先。
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">h3<span class="token punctuation">,</span> p</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span> <span class="token number">0</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.panel</span></span> <span class="token punctuation">{</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token hexcode color">#aaa</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>我们发现点击其中一个面板中的按钮并不会影响另外一个，他们是独立的。</p><diagramgroup><diagram name="sharing_state_child"height="{367}"width="{477}"alt="这个图表展示了一个包含三个组件的树形结构图，其中父组件是 Accordion，子组件是 Panel。这 2 个 Panel 组件内部都有 isActive 属性，值为 false。"><p>由于一开始所有 <code>Panel</code> 内部的 <code>isActive</code> 都是 <code>false</code>，因此它们的内容都不会显示。</p></diagram><diagram name="sharing_state_child_clicked"height="{367}"width="{480}"alt="这个图表与前面的是一样的，只是这里高亮显示了第一个子 Panel 组件的 isActive 属性，表示鼠标点击后将 isActive 的值设置为了 true。而第二个 Panel 组件的 isActive 值仍然还是 false。"><p>此时，点击任意一个 <code>Panel</code> 组件中的按钮都只会更新当前 <code>Panel</code> 组件内的 <code>isActive</code> 值</p></diagram></diagramgroup><p><strong>假设现在您想改变这种行为，以便在任何时候只展开一个面板</strong>。在这种设计下，展开第 2 个面板应会折叠第 1 个面板。您该如何做到这一点呢？"<p>要协调好这两个面板，我们需要分 3 步将状态“提升”到他们的父组件中。<ol><li>从子组件中 <strong>移除</strong> state 。<li>从父组件 <strong>传递</strong> 硬编码数据。<li>为共同的父组件添加 state ，并将其与事件处理函数一起向下传递。</ol><p>这样，<code>Accordion</code> 组件就可以控制 2 个 <code>Panel</code> 组件，保证同一时间只能展开一个。<section class="level3"aria-labelledby="第-1-步-从子组件中移除状态-step-1-remove-state-from-the-child-components"><h3 id="第-1-步-从子组件中移除状态-step-1-remove-state-from-the-child-components">第 1 步: 从子组件中移除状态 {/<em>step-1-remove-state-from-the-child-components</em>/}</h3><p>你将把 <code>Panel</code> 组件对 <code>isActive</code> 的控制权交给他们的父组件。这意味着，父组件会将 <code>isActive</code> 作为 <code>prop</code> 传给子组件 <code>Panel</code>。我们先从 <code>Panel</code> 组件中 <strong>删除下面这一行</strong>：<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>isActive<span class="token punctuation">,</span> setIsActive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>然后，把 <code>isActive</code> 加入 <code>Panel</code> 组件的 <code>props</code> 中：<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Panel</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> title<span class="token punctuation">,</span> children<span class="token punctuation">,</span> isActive <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code></pre><p>现在 <code>Panel</code> 的父组件就可以通过 <a href="/learn/passing-props-to-a-component">向下传递 prop</a> 来 <strong>控制</strong> <code>isActive</code>。但相反地，<code>Panel</code> 组件对 <code>isActive</code> 的值 <strong>没有控制权</strong> —— 现在完全由父组件决定！</section><section class="level3"aria-labelledby="第-2-步-从公共父组件传递硬编码数据-step-2-pass-hardcoded-data-from-the-common-parent"><h3 id="第-2-步-从公共父组件传递硬编码数据-step-2-pass-hardcoded-data-from-the-common-parent">第 2 步: 从公共父组件传递硬编码数据 {/<em>step-2-pass-hardcoded-data-from-the-common-parent</em>/}</h3><p>为了实现状态提升，必须定位到你想协调的 <strong>两个</strong> 子组件最近的公共父组件：<ul><li><code>Accordion</code> <strong>(最近的公共父组件)</strong><ul><li><code>Panel</code><li><code>Panel</code></ul></ul><p>在这个例子中，公共父组件是 <code>Accordion</code>。因为它位于两个面板之上，可以控制它们的 props，所以它将成为当前激活面板的“控制之源”。通过 <code>Accordion</code> 组件将硬编码值 <code>isActive</code>（例如 <code>true</code> ）传递给两个面板：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Accordion</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span>哈萨克斯坦，阿拉木图<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span> title<span class="token operator">=</span><span class="token string">"关于"</span> isActive<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token operator">></span>
        阿拉木图人口约<span class="token number">200</span>万，是哈萨克斯坦最大的城市。它在 <span class="token number">1929</span> 年到 <span class="token number">1997</span> 年间都是首都。
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span> title<span class="token operator">=</span><span class="token string">"词源"</span> isActive<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token operator">></span>
        这个名字来自于 <span class="token operator">&#x3C;</span>span lang<span class="token operator">=</span><span class="token string">"kk-KZ"</span><span class="token operator">></span>алма<span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span>，哈萨克语中“苹果”的意思，经常被翻译成“苹果之乡”。事实上，阿拉木图的周边地区被认为是苹果的发源地，<span class="token operator">&#x3C;</span>i lang<span class="token operator">=</span><span class="token string">"la"</span><span class="token operator">></span><span class="token maybe-class-name">Malus</span> sieversii<span class="token operator">&#x3C;</span><span class="token operator">/</span>i<span class="token operator">></span> 被认为是现今苹果的祖先。
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Panel</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> title<span class="token punctuation">,</span> children<span class="token punctuation">,</span> isActive <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>section className<span class="token operator">=</span><span class="token string">"panel"</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h3<span class="token operator">></span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h3<span class="token operator">></span>
      <span class="token punctuation">{</span>isActive <span class="token operator">?</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          显示
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>section<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">h3<span class="token punctuation">,</span> p</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span> <span class="token number">0</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.panel</span></span> <span class="token punctuation">{</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token hexcode color">#aaa</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>你可以尝试修改 <code>Accordion</code> 组件中 <code>isActive</code> 的值，并在屏幕上查看结果。</section><section class="level3"aria-labelledby="第-3-步-为公共父组件添加状态-step-3-add-state-to-the-common-parent"><h3 id="第-3-步-为公共父组件添加状态-step-3-add-state-to-the-common-parent">第 3 步: 为公共父组件添加状态 {/<em>step-3-add-state-to-the-common-parent</em>/}</h3><p>状态提升通常会改变原状态的数据存储类型。<p>在这个例子中，一次只能激活一个面板。这意味着 <code>Accordion</code> 这个父组件需要记录 <strong>哪个</strong> 面板是被激活的面板。我们可以用数字作为当前被激活 <code>Panel</code> 的索引，而不是 <code>boolean</code> 值：<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>activeIndex<span class="token punctuation">,</span> setActiveIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>当 <code>activeIndex</code> 为 <code>0</code> 时，激活第一个面板，为 <code>1</code> 时，激活第二个面板。<p>在任意一个 <code>Panel</code> 中点击“显示”按钮都需要更改 <code>Accordion</code> 中的激活索引值。 <code>Panel</code> 中无法直接设置状态 <code>activeIndex</code> 的值，因为该状态是在 <code>Accordion</code> 组件内部定义的。 <code>Accordion</code> 组件需要 <strong>显式允许</strong> <code>Panel</code> 组件通过 <a href="/learn/responding-to-events#passing-event-handlers-as-props">将事件处理程序作为 prop 向下传递</a> 来更改其状态：<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span>
    isActive<span class="token operator">=</span><span class="token punctuation">{</span>activeIndex <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">}</span>
    onShow<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setActiveIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token operator">></span>
    <span class="token spread operator">...</span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span>
    isActive<span class="token operator">=</span><span class="token punctuation">{</span>activeIndex <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">}</span>
    onShow<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setActiveIndex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token operator">></span>
    <span class="token spread operator">...</span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span></code></pre><p>现在 <code>Panel</code> 组件中的 <code>&#x3C;button></code> 将使用 <code>onShow</code> 这个属性作为其点击事件的处理程序：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Accordion</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>activeIndex<span class="token punctuation">,</span> setActiveIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span>哈萨克斯坦，阿拉木图<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span>
        title<span class="token operator">=</span><span class="token string">"关于"</span>
        isActive<span class="token operator">=</span><span class="token punctuation">{</span>activeIndex <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">}</span>
        onShow<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setActiveIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">></span>
        阿拉木图人口约<span class="token number">200</span>万，是哈萨克斯坦最大的城市。它在 <span class="token number">1929</span> 年到 <span class="token number">1997</span> 年间都是首都。
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span>
        title<span class="token operator">=</span><span class="token string">"词源"</span>
        isActive<span class="token operator">=</span><span class="token punctuation">{</span>activeIndex <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">}</span>
        onShow<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setActiveIndex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">></span>
        这个名字来自于 <span class="token operator">&#x3C;</span>span lang<span class="token operator">=</span><span class="token string">"kk-KZ"</span><span class="token operator">></span>алма<span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span>，哈萨克语中“苹果”的意思，经常被翻译成“苹果之乡”。事实上，阿拉木图的周边地区被认为是苹果的发源地，<span class="token operator">&#x3C;</span>i lang<span class="token operator">=</span><span class="token string">"la"</span><span class="token operator">></span><span class="token maybe-class-name">Malus</span> sieversii<span class="token operator">&#x3C;</span><span class="token operator">/</span>i<span class="token operator">></span> 被认为是现今苹果的祖先。
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Panel</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  title<span class="token punctuation">,</span>
  children<span class="token punctuation">,</span>
  isActive<span class="token punctuation">,</span>
  onShow
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>section className<span class="token operator">=</span><span class="token string">"panel"</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h3<span class="token operator">></span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h3<span class="token operator">></span>
      <span class="token punctuation">{</span>isActive <span class="token operator">?</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onShow<span class="token punctuation">}</span><span class="token operator">></span>
          显示
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>section<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">h3<span class="token punctuation">,</span> p</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span> <span class="token number">0</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.panel</span></span> <span class="token punctuation">{</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token hexcode color">#aaa</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>这样，我们就完成了对状态的提升！将状态移至公共父组件中可以让你更好的管理这两个面板。使用激活索引值代替之前的 <code>是否显示</code> 标识确保了一次只能激活一个面板。而通过向下传递事件处理函数可以让子组件修改父组件的状态。</p><diagramgroup><diagram name="sharing_state_parent"height="{385}"width="{487}"alt="这个图表展示了一个包含三个组件的树形结构图，其中父组件是 Accordion，两个子组件是 Panel。Accordion 包含一个值为 0 的 activeIndex 属性，该属性会传递给第一个Panel 组件，让其内部的 isActive 值变为 true，同时会传递给第二个 Panel 组件，让其内部的 isActive 值变为 false。"><p>一开始, <code>Accordion</code> 组件中的 <code>activeIndex</code> 是 <code>0</code>，此时第一个 <code>Panel</code> 组件接受到的属性为 <code>isActive = true</code></p></diagram><diagram name="sharing_state_parent_clicked"height="{385}"width="{521}"alt="这个图表与前面的是一样的，只是突出显示了父 Accordion 组件的 activeIndex值，表示单击后该值已更改为 1。同时，强调了两个子 Panel 组件的流程，并将传递给每个子组件的 isActive 值设置为相反的值：第一个 Panel 的值为 false，第二个 Panel 的值为 true。"><p>当 <code>Accordion</code> 组件中的 <code>activeIndex</code> 变为 <code>1</code> 时，第二个 <code>Panel</code> 组件接受到的属性变为 <code>isActive = true</code>，第一个 <code>Panel</code> 组件接受到的属性变为 <code>isActive = false</code></p></diagram></diagramgroup><deepdive><section class="level4"aria-labelledby="受控组件和非受控组件-controlled-and-uncontrolled-components"><h4 id="受控组件和非受控组件-controlled-and-uncontrolled-components">受控组件和非受控组件 {/<em>controlled-and-uncontrolled-components</em>/}</h4><p>通常我们把包含“不受控制”状态的组件称为“非受控组件”。例如，最开始带有 <code>isActive</code> 状态变量的 <code>Panel</code> 组件就是不受控制的，因为其父组件无法控制面板的激活状态。<p>相反，当组件中的重要信息是由 <code>props</code> 而不是其自身状态驱动时，就可以认为该组件是“受控组件”。这就允许父组件完全指定其行为。最后带有 <code>isActive</code> 属性的 <code>Panel</code> 组件是由 <code>Accordion</code> 组件控制的。<p>非受控组件通常很简单，因为它们不需要太多配置。但是当你想把它们组合在一起使用时，就不那么灵活了。受控组件具有最大的灵活性，但它们需要父组件使用 <code>props</code> 对其进行配置。<p>在实践中，“受控”和“非受控”并不是严格的技术术语——通常每个组件都同时拥有内部状态和 <code>props</code>。然而，这对于组件该如何设计和提供什么样功能的讨论是有帮助的。<p>当编写一个组件时，你应该考虑哪些信息应该受控制（通过 <code>props</code>），哪些信息不应该受控制（通过 <code>state</code>）。当然，你可以随时改变主意并重构代码。</section></deepdive></section></section><section class="level2"aria-labelledby="每个状态都对应唯一的数据源-a-single-source-of-truth-for-each-state"><h2 id="每个状态都对应唯一的数据源-a-single-source-of-truth-for-each-state">每个状态都对应唯一的数据源 {/<em>a-single-source-of-truth-for-each-state</em>/}</h2><p>在 <code>React</code> 应用中，很多组件都有自己的状态。一些状态可能“活跃”在叶子组件（树形结构最底层的组件）附近，例如输入框。另一些状态可能在应用程序顶部“活动”。例如，客户端路由库也是通过将当前路由存储在 <code>React</code> 状态中，利用 <code>props</code> 将状态层层传递下去来实现的！<p><strong>对于每个独特的状态，都应该存在且只存在于一个指定的组件中作为 state</strong>。这一原则也被称为拥有 <a href="https://en.wikipedia.org/wiki/Single_source_of_truth">“可信单一数据源”</a>。它并不意味着所有状态都存在一个地方——对每个状态来说，都需要一个特定的组件来保存这些状态信息。你应该 <strong>将状态提升</strong> 到公共父级，或 <strong>将状态传递</strong> 到需要它的子级中，而不是在组件之间复制共享的状态。<p>你的应用会随着你的操作而变化。当你将状态上下移动时，你依然会想要确定每个状态在哪里“活跃”。这都是过程的一部分！<p>想了解在更多组件中的实践，请阅读 <a href="/learn/thinking-in-react">React 思维</a>.</p><recap><ul><li>当你想要整合两个组件时，将它们的 state 移动到共同的父组件中。<li>然后在父组件中通过 <code>props</code> 把信息传递下去。<li>最后，向下传递事件处理程序，以便子组件可以改变父组件的 state 。<li>考虑该将组件视为“受控”（由 prop 驱动）或是“不受控”（由 state 驱动）是十分有益的。</ul></recap><challenges><section class="level4"aria-labelledby="同步输入状态-synced-inputs"><h4 id="同步输入状态-synced-inputs">同步输入状态 {/<em>synced-inputs</em>/}</h4><p>现在有两个独立的输入框。为了让它们保持同步：即编辑一个输入框时，另一个输入框也会更新相同的文本，反之亦然。</p><hint><p>你需要将它们的状态移动到父组件中。</p></hint><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">SyncedInputs</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Input</span> label<span class="token operator">=</span><span class="token string">"第一个输入框"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Input</span> label<span class="token operator">=</span><span class="token string">"第二个输入框"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Input</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> label <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
      <span class="token punctuation">{</span>label<span class="token punctuation">}</span>
      <span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>input
        value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p>将 <code>text</code> 状态变量与 <code>handleChange</code> 处理程序一起移动到父组件中。然后将它们作为 <code>props</code> 传递给两个 <code>Input</code> 组件。这样它们就能保持同步了。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">SyncedInputs</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Input</span>
        label<span class="token operator">=</span><span class="token string">"第一个输入框"</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Input</span>
        label<span class="token operator">=</span><span class="token string">"第二个输入框"</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Input</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> label<span class="token punctuation">,</span> value<span class="token punctuation">,</span> onChange <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
      <span class="token punctuation">{</span>label<span class="token punctuation">}</span>
      <span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>input
        value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack></solution></section><section class="level4"aria-labelledby="列表过滤-filtering-a-list"><h4 id="列表过滤-filtering-a-list">列表过滤 {/<em>filtering-a-list</em>/}</h4><p>在这个例子中，<code>SearchBar</code> 组件拥有一个用来控制输入框的 <code>query</code> 状态，它的父组件中展示了一个 <code>List</code> 组件，但是没有考虑搜索条件。<p>使用 <code>filterItems(foods, query)</code> 方法来通过搜索条件过滤列表项。为了测试修改是否正确，请尝试在输入框中输入 “寿司” ，“烤肉串” 或 “点心”。<p>可以看到 <code>filterItems</code> 已经自动引入了，所以不需要我们自己再引入了。</p><hint><p>你需要从 <code>SearchBar</code> 组件中移除 <code>query</code> 状态和 <code>handleChange</code> 处理程序，并把它们移到 <code>FilterableList</code> 组件中。然后将 <code>query</code> 和 <code>onChange</code> 当做 props 向下传递给 <code>SearchBar</code> 组件。</p></hint><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> foods<span class="token punctuation">,</span> filterItems <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./data.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FilterableList</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">SearchBar</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">List</span> items<span class="token operator">=</span><span class="token punctuation">{</span>foods<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">SearchBar</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setQuery</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
      搜索：<span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>input
        value<span class="token operator">=</span><span class="token punctuation">{</span>query<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">List</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> items <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>table<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>tbody<span class="token operator">></span>
        <span class="token punctuation">{</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">food</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>tr key<span class="token operator">=</span><span class="token punctuation">{</span>food<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token operator">&#x3C;</span>td<span class="token operator">></span><span class="token punctuation">{</span>food<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>td<span class="token operator">></span>
            <span class="token operator">&#x3C;</span>td<span class="token operator">></span><span class="token punctuation">{</span>food<span class="token punctuation">.</span><span class="token property-access">description</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>td<span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>tr<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>tbody<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>table<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">filterItems</span><span class="token punctuation">(</span><span class="token parameter">items<span class="token punctuation">,</span> query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  query <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> items<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span>
    item<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">some</span><span class="token punctuation">(</span><span class="token parameter">word</span> <span class="token arrow operator">=></span>
      word<span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">startsWith</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">const</span> foods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'寿司'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'寿司是一道传统的日本菜，是用醋米饭做成的'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'木豆'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'制作木豆最常见的方法是在汤中加入洋葱、西红柿和各种香料'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'饺子'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'饺子是用未发酵的面团包裹咸的或甜的馅料，然后在沸水中煮制而成的'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'烤肉串'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'烤肉串是一种很受欢迎的食物，是用肉串和肉块做成。'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'点心'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'点心是广东人的传统喜好，是在餐馆吃早餐和午餐时喜欢吃的一系列小菜'</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></sandpack><solution><p>将 <code>query</code> 状态提升到 <code>FilterableList</code> 组件中。调用 <code>filterItems(foods, query)</code> 方法获取过滤后的列表并将其传递给 <code>List</code> 组件。现在修改查询条件就会反映在列表中：</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> foods<span class="token punctuation">,</span> filterItems <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./data.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FilterableList</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token function">filterItems</span><span class="token punctuation">(</span>foods<span class="token punctuation">,</span> query<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setQuery</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">SearchBar</span>
        query<span class="token operator">=</span><span class="token punctuation">{</span>query<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">List</span> items<span class="token operator">=</span><span class="token punctuation">{</span>results<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">SearchBar</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> query<span class="token punctuation">,</span> onChange <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
      搜索：<span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>input
        value<span class="token operator">=</span><span class="token punctuation">{</span>query<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">List</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> items <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>table<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>tbody<span class="token operator">></span> 
        <span class="token punctuation">{</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">food</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>tr key<span class="token operator">=</span><span class="token punctuation">{</span>food<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token operator">&#x3C;</span>td<span class="token operator">></span><span class="token punctuation">{</span>food<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>td<span class="token operator">></span>
            <span class="token operator">&#x3C;</span>td<span class="token operator">></span><span class="token punctuation">{</span>food<span class="token punctuation">.</span><span class="token property-access">description</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>td<span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>tr<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>tbody<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>table<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">filterItems</span><span class="token punctuation">(</span><span class="token parameter">items<span class="token punctuation">,</span> query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  query <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> items<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span>
    item<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">some</span><span class="token punctuation">(</span><span class="token parameter">word</span> <span class="token arrow operator">=></span>
      word<span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">startsWith</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">const</span> foods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'寿司'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'寿司是一道传统的日本菜，是用醋米饭做成的'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'木豆'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'制作木豆最常见的方法是在汤中加入洋葱、西红柿和各种香料'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'饺子'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'饺子是用未发酵的面团包裹咸的或甜的馅料，然后在沸水中煮制而成的'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'烤肉串'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'烤肉串是一种很受欢迎的食物，是用肉串和肉块做成。'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'点心'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'点心是广东人的传统喜好，是在餐馆吃早餐和午餐时喜欢吃的一系列小菜'</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></sandpack></solution><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></challenges></section></section>