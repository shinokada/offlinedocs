<!doctype html><html lang="zh-hans"><meta charset="utf-8"><title>贡献流程</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="贡献流程"class="level1"><h1>贡献流程</h1><p>React 是 Facebook 首批开源项目中的一员，开发状态保持活跃，并在 <a href="https://www.facebook.com">facebook.com</a> 上为我们提供了源代码。现在，我们正不断解决若干个问题以使参与贡献 React 尽可能容易和公开透明，虽然目前还差得很远。我们希望本篇文章能够解释清楚贡献的流程，回答你可能会有的一些问题。<section id="行为规范-code-of-conduct"class="level3"><h3><a href="https://github.com/facebook/react/blob/main/CODE_OF_CONDUCT.md">行为规范</a> {#code-of-conduct}</h3><p>Facebook 将<a href="https://www.contributor-covenant.org/zh-cn/version/1/4/code-of-conduct">参与者公约</a>作为行为规范，我们希望参与项目的各位严格遵守。请阅读<a href="https://github.com/facebook/react/blob/main/CODE_OF_CONDUCT.md">全文</a>去了解什么行为允许，什么行为不允许。</section><section id="open-development"class="level3"><h3>人人皆可开发</h3><p>React 的一切工作在 <a href="https://github.com/facebook/react">GitHub</a> 上完成，核心团队及其以外的贡献者发送 pull requests，其代码评审流程皆为一致。</section><section id="semantic-versioning"class="level3"><h3>语义化版本</h3><p>React 遵循<a href="https://semver.org/lang/zh-CN/">语义化版本</a>。我们对重要的漏洞修复发布修订号；对新特性或不重要的变更发布次版本号；对重大且不兼容的变更发布主版本号。我们在开发重大且不兼容的变更时，还会在次版本号用 deprecation warnings 让用户得知将来的变更并提前迁移代码。请查看<a href="./faq-versioning.html">版本号规则</a>来了解更多我们在稳定性和渐进迁移方面要做哪些事情。<p>每一个重要变更参见 <a href="https://github.com/facebook/react/blob/main/CHANGELOG.md">changelog file</a>。</section><section id="branch-organization"class="level3"><h3>分支管理</h3><p>请直接提交你的变更至 <a href="https://github.com/facebook/react/tree/main"><code>main branch</code></a>。对于开发或即将推出的版本，我们不会另建分支。我们尽力保持 <code>main</code> 不出问题，并通过所有测试。<p>合并进入 <code>main</code> 的代码必须与最新稳定版本兼容，可以有额外特性，但不能有重大变更。我们应从 <code>main</code> 随时能发布新的次版本号。</section><section id="feature-flags"class="level3"><h3>特性切换（Feature Flags）</h3><p>我们为了使 <code>main</code> 能够发布，要求重大且不兼容的变更和实验性的特性必须用特性切换。<p><a href="https://github.com/facebook/react/blob/main/packages/shared/ReactFeatureFlags.js"><code>packages/shared/ReactFeatureFlags.js</code></a> 中定义了特性切换。React 的一些版本可能启用了不同的特性切换；比如，React Native 可能与 React DOM 有不同的配置。这些特性切换见于 <a href="https://github.com/facebook/react/tree/main/packages/shared/forks"><code>packages/shared/forks</code></a>。特性切换使用了静态类型检查器 Flow，因此你可以运行 <code>yarn flow</code> 来确认所有必要文件已更新。<p>React 的构建系统（Build System）会先删去禁用的特性分支，之后再发布。每次 commit 都会运行持续集成（Continuous Integration）来检查包（Bundle）大小的变化。包大小的变化可以用来表明某特性正确合并。</section><section id="bugs"class="level3"><h3>漏洞</h3><section id="where-to-find-known-issues"class="level4"><h4>何处查找已知 issue</h4><p>我们用 <a href="https://github.com/facebook/react/issues">GitHub Issues</a> 来公开漏洞。我们密切关注该版块，内部解决 bug 时也会想办法说明清楚。在你提交 issue 前，请确定没有重复 issue 出现。</section><section id="reporting-new-issues"class="level4"><h4>报告新的 issue</h4><p>修复 bug 的最佳方法是给出缩略版的测试用例。这个 <a href="https://jsfiddle.net/Luktwrdm/">JSFiddle 模板</a>是个不错的起点。</section><section id="security-bugs"class="level4"><h4>安全漏洞</h4><p>为了发现安全漏洞，Facebook 实行了漏洞<a href="https://www.facebook.com/whitehat/">举报奖励制度</a>（Bounty Program）。为此，请不要将这类漏洞提交到 public issues，而要遵循举报奖励制度页面所描述的流程。</section></section><section id="how-to-get-in-touch"class="level3"><h3>如何联系我们</h3><ul><li>因特网中继聊天（IRC）： <a href="https://webchat.freenode.net/?channels=reactjs">#reactjs on freenode</a><li><a href="/community/support.html#popular-discussion-forums">论坛</a></ul><p>你如果需要有关 React 的帮助，还可以前往 Discord 聊天平台，这里建有 React 用户们的<a href="https://www.reactiflux.com/">活跃社区</a>。</section><section id="proposing-a-change"class="level3"><h3>提出变更</h3><p>如果你想改变公开的 API，或者对实现有不小的变更，我们建议你<a href="https://github.com/facebook/react/issues/new">发起 issue</a>，这会让我们先对你的提议达成一致，然后你再着手工作。<p>如果只是修复漏洞，你当然可以立即提交 pull request，不过我们还是建议先去提出 issue 来说明你修复了什么，这就对一种情况来说就很方便：我们没有接受特定 bug 的修复但想跟进该 issue 的情况。</section><section id="your-first-pull-request"class="level3"><h3>首个 Pull Request</h3><p>在写第一个 Pull Request？你可以从这一系列视频中学习怎么做：<p><strong><a href="https://egghead.io/courses/how-to-contribute-to-an-open-source-project-on-github">How to Contribute to an Open Source Project on GitHub</a></strong><p>为了使你能够快速上手和熟悉贡献流程，我们这里有个列表 <strong><a href="https://github.com/facebook/react/issues?q=is:open+is:issue+label:%22good+first+issue%22">good first issues</a></strong>，里面有相对没那么笼统的漏洞，从这开始是个不错的选择。<p>如果你想解决一个 issue，请确定检查了该 issue 下的评论以防有人正在处理它。如果目前没人在处理该 issue，那么请留下评论去表明你想处理该 issue 以便其他人不会意外重复你的工作。<p>如果有人留言表明要处理该 issue 但是超过两周没有跟进，你可以接手工作，不过也应该留言说明。</section><section id="sending-a-pull-request"class="level3"><h3>提交 Pull Request</h3><p>核心团队时刻关注 pull requests，我们会先评审你的 pull request，之后可能会合并，可能会要求再次更改，也可能会关闭该 pull request 并对此作出解释。对于 API 上的变更，我们可能得确认在 Facebook.com 上的内部 API 使用方法，因此该变更可能会推迟。我们会尽力全程更新和反馈。<p><strong>提交 pull request 前</strong>，请确保完成以下步骤：<ol><li>Fork <a href="https://github.com/facebook/react">此仓库</a>，从 <code>main</code> 创建分支。<li>在仓库根目录下执行 <code>yarn</code>。<li>如果你修复了 bug 或者添加了代码，而这些内容需要测试，请添加测试！<li>确保通过测试套件（<code>yarn test</code>）。提示：开发环境下，<code>yarn test --watch TestName</code> 很有用。<li>生产环境下，执行 <code>yarn test --prod</code> 来进行测试。<li>如果需要调试，请执行 <code>yarn test --debug --watch TestName</code>，打开 <code>chrome://inspect</code>， 之后再打开“审查”。<li>使用 <a href="https://github.com/prettier/prettier">prettier</a>（<code>yarn prettier</code>）来格式化代码。<li>确保 lint 校验代码（<code>yarn lint</code>）。提示：执行 <code>yarn linc</code> 去只检查更改过的文件。<li>运行 <a href="https://flowtype.org/">Flow</a> 来类型检查（<code>yarn flow</code>）。<li>请签订贡献者许可证协议（Contributor License Agreement）。</ol></section><section id="contributor-license-agreement-cla"class="level3"><h3>贡献者许可证协议</h3><p>为了让你的 pull request 得到接受，你得提交贡献者许可证协议。你只需提交该协议一次，所以如果你曾经对另一个 Facebook 开源项目提交过，那么你已经准备好了。如果你是第一次提交 pull request，请让我们得知你已提交协议，这样我们能多方核对你的 GitHub 用户名。<p><strong><a href="https://code.facebook.com/cla">请在这里签订贡献者许可证协议</a></strong></section><section id="contribution-prerequisites"class="level3"><h3>必要条件</h3><ul><li>你需要安装 <a href="https://nodejs.org">Node</a> 的 LTS 版本和 <a href="https://yarnpkg.com/en/">Yarn</a> v1.2.0+。<li>已安装 <a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html">JDK</a>。<li>你已安装 <code>gcc</code>（或者你在有必要安装编译器的情况下也不觉得麻烦），因为一些依赖可能得经过编译，而在 OS X，Xcode 命令行工具会帮你处理；在 Ubuntu，<code>apt-get install build-essential</code> 会安装所需的 package（其它 Linux 发行版的类似命令也有效）；在 Windows 上得做些额外步骤，请参考 <a href="https://github.com/nodejs/node-gyp#installation"><code>node-gyp</code> 安装步骤</a>。<li>熟悉 Git。</ul></section><section id="development-workflow"class="level3"><h3>开发工作流程</h3><p>克隆 React 项目后，执行 <code>yarn</code> 来获取依赖。 之后，你可以执行以下命令：<ul><li><code>yarn lint</code> 检查代码风格。<li><code>yarn linc</code> 和 <code>yarn lint</code> 差不多，但是运行地更快，因为只检查了分支中的不同文件。<li><code>yarn test</code> 运行完整的测试套装。<li><code>yarn test --watch</code> 运行交互式的测试监听器。<li><code>yarn test --prod</code> 在生产环境下运行测试。<li><code>yarn test &#x3C;pattern></code> 匹配文件名，运行响应测试。<li><code>yarn debug-test</code> 和 <code>yarn test</code> 差不多，不过多了个调试器，你可以打开 <code>chrome://inspect</code> 并审查。<li><code>yarn flow</code> 运行 <a href="https://flowtype.org/">Flow</a> 进行类型检查。<li><code>yarn build</code> 新建涉及所有包的 <code>build</code> 文件夹。<li><code>yarn build react/index,react-dom/index --type=UMD</code> 生成只有 React 和 ReactDOM 的 UMD 版本。</ul><p>我们建议运行 <code>yarn test</code>（或上述命令）以确保你的代码没有引入回归，不管怎样，这有助于尝试你的 React 构建版本。<p>首先，运行 <code>yarn build</code>，这会于 <code>build</code> 文件夹中生成预先构建的 bundle，还会于 <code>build/packages</code> 中生成 npm 包。<p>想测试你做出的更改的话，最简单的方法就是运行 <code>yarn build react/index,react-dom/index --type=UMD</code>，之后再打开 <code>fixtures/packaging/babel-standalone/dev.html</code>，该文件已使用 <code>build</code> 文件夹内的 <code>react.development.js</code> 来搞定你的更改。<p>如果你想测试你对已有 React 项目做出的更改，你可以复制 <code>build/node_modules/react/umd/react.development.js</code> 和 <code>build/node_modules/react-dom/umd/react-dom.development.js</code> 或其它构建版本，放入你的应用中并使用这些构建版本而非稳定版。<p>如果你的项目用 npm，你可以从依赖中删去 <code>react</code> 和 <code>react-dom</code>，使用 <code>yarn link</code> 将其指向本地文件夹的 <code>build</code> 目录。请注意，**当请在构建时，传递 <code>--type=NODE</code>，而不是 <code>--type=UMD</code>。同时，你还需要构建 <code>scheduler</code> 的 package：<pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/path_to_your_react_clone/
<span class="token function">yarn</span> build react/index,react/jsx,react-dom/index,scheduler --type<span class="token operator">=</span>NODE

<span class="token builtin class-name">cd</span> build/node_modules/react
<span class="token function">yarn</span> <span class="token function">link</span>
<span class="token builtin class-name">cd</span> build/node_modules/react-dom
<span class="token function">yarn</span> <span class="token function">link</span>

<span class="token builtin class-name">cd</span> ~/path/to/your/project
<span class="token function">yarn</span> <span class="token function">link</span> react react-dom</code></pre><p>每当你在项目文件夹下运行 <code>yarn build</code>，更新版本会出现在 <code>node_modules</code> 文件夹，之后可以重新构建项目来测试更改。<p>如果依然缺少某些 package（例如，可能在项目中使用到 <code>react-dom/server</code>），则应始终执行 <code>yarn build</code> 进行完整构建。请注意，不带选项运行 <code>yarn build</code> 会耗费很长时间。<p>我们仍要求：<code>pull request</code> 得包括新功能对应的单元测试。这样，我们能确保以后你的代码不出问题。</section><section id="style-guide"class="level3"><h3>风格指南</h3><p>我们使用自动化代码格式化软件 <a href="https://prettier.io/">Prettier</a>。 对代码做出更改后，运行 <code>yarn prettier</code>。<p>之后，linter 会捕获代码中可能出现的多数问题。 你可以运行 <code>yarn linc</code> 来检查代码风格状态。<p>不过，linter 也有不能搞定的一些风格。如果有些东西不确定，请查看 <a href="https://github.com/airbnb/javascript">Airbnb's Style Guide</a> 来指导自己。</section><section id="request-for-comments-rfc"class="level3"><h3>请求意见稿（RFC）</h3><p>许多更改（包括修复 bug 和完善文档）会经过通常所用的 GitHub pull request 工作流程来评审。<p>不过有些更改较大，对此，我们要求这些更改得经过一番设计流程， 并在核心团队中达成共识。<p>请求意见稿让新特性的合并入库经过一致且受控的流程。你可以前往 <a href="https://github.com/reactjs/rfcs">rfcs repository</a> 去贡献。</section><section id="license"class="level3"><h3>License</h3><p>你贡献 React 的同时也就同意了你的贡献部分使用了 MIT 协议。</section><section id="what-next"class="level3"><h3>接下来做什么？</h3><p>请阅读<a href="./codebase-overview.html">下一部分</a>来学习代码库是如何组织的. <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>