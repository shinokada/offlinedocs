<!doctype html><html lang="zh-hans"><meta charset="utf-8"><title>"&#x3C;textarea>"</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="textarea"><h1 id="textarea">"<textarea>"</textarea><intro><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea">浏览器内置的 <code>&#x3C;textarea></code> 组件</a> 允许你渲染一个多行文本输入框。<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span>textarea <span class="token operator">/</span><span class="token operator">></span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="参考-reference"><h2 id="参考-reference">参考 {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="textarea-textarea"><h3 id="textarea-textarea"><code>&#x3C;textarea></code> {/<em>textarea</em>/}</h3><p>使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea">浏览器内置的 <code>&#x3C;textarea></code> 组件</a> 渲染一个多行文本输入框。<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span>textarea name<span class="token operator">=</span><span class="token string">"postContent"</span> <span class="token operator">/</span><span class="token operator">></span></code></pre><p><a href="#usage">参见下面更多示例</a>。<section class="level4"aria-labelledby="属性-props"><h4 id="属性-props">属性 {/<em>props</em>/}</h4><p><code>&#x3C;textarea></code> 支持所有 <a href="/reference/react-dom/components/common#props">常见的元素属性</a>。<p>你可以通过传递 <code>value</code> 属性 <a href="#controlling-a-text-area-with-a-state-variable">以控制文本框</a>。<ul><li><code>value</code>：一个字符串，用于控制文本框内的文本。</ul><p>当你传递 <code>value</code> 时，你必须同时传递一个 <code>onChange</code> 处理函数，用于更新传递的值。<p>如果 <code>&#x3C;textarea></code> 是非受控组件，那么你应该传递 <code>defaultValue</code> 参数：<ul><li><code>defaultValue</code>：一个字符串，表示文本框的 <a href="#providing-an-initial-value-for-a-text-area">初始值</a>。</ul><p>以下 <code>&#x3C;textarea></code> 属性均可用于受控与非受控组件：<ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea#autocomplete"><code>autoComplete</code></a>：可以为 <code>'on'</code> 或 <code>'off'</code>，表示自动完成的行为。<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea#autofocus"><code>autoFocus</code></a>：布尔值。如果为 <code>true</code>，React 将在挂载时聚焦该元素。<li><code>children</code>：<code>&#x3C;textarea></code> 不接受子元素，如果要设置初始值，请使用 <code>defaultValue</code>。<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea#cols"><code>cols</code></a>：数字，表示默认宽度，以平均字符宽度计算。默认为 <code>20</code>。<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea#disabled"><code>disabled</code></a>：布尔值。如果为 <code>true</code>，则输入框将不可交互且显示为禁用状态（dimmed）。<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea#form"><code>form</code></a>：字符串，表示此文本框所属的 <code>&#x3C;form></code> 的 <code>id</code>。如果未指定，则为最近的父表单。<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea#maxlength"><code>maxLength</code></a>：数字，表示文本的最大长度。<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea#minlength"><code>minLength</code></a>：数字，表示文本的最小长度。<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/input#name"><code>name</code></a>：字符串，表示在表单提交时与此输入框关联的名称。<li><code>onChange</code>：一个 <a href="/reference/react-dom/components/common#event-handler"><code>Event</code> 处理函数</a>。对于 <a href="#controlling-a-text-area-with-a-state-variable">受控文本框</a>，在用户更改输入值时立即触发（例如，对于每个按键）。此行为类似于浏览器 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement/input_event"><code>input</code> 事件</a>。<li><code>onChangeCapture</code>：与 <code>onChange</code> 类似，但是是在 <a href="/learn/responding-to-events#capture-phase-events">捕获阶段</a> 触发。<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement/input_event"><code>onInput</code></a>：一个 <a href="/reference/react-dom/components/common#event-handler"><code>Event</code> 处理函数</a>。在用户更改值时立即触发。由于历史原因，在 React 习惯于使用工作方式类似的 <code>onChange</code>。<li><code>onInputCapture</code>：与 <code>onInput</code> 类似，但是是在 <a href="/learn/responding-to-events#capture-phase-events">捕获阶段</a> 触发。<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLInputElement/invalid_event"><code>onInvalid</code></a>：一个 <a href="/reference/react-dom/components/common#event-handler"><code>Event</code> 处理函数</a>。如果输入的内容在表单提交时未通过验证，则会触发此事件。与内置的 <code>invalid</code> 事件不同，React 的 <code>onInvalid</code> 事件可以进行冒泡。<li><code>onInvalidCapture</code>：与 <code>onInvalid</code> 类似，但是是在 <a href="/learn/responding-to-events#capture-phase-events">捕获阶段</a> 触发。<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLTextAreaElement/select_event"><code>onSelect</code></a>：一个 <a href="/reference/react-dom/components/common#event-handler"><code>Event</code> 处理函数</a>。当 <code>&#x3C;textarea></code> 的选择内容发生变化后触发。React 扩展了 <code>onSelect</code> 事件，还会在空选择和编辑（可能会影响选择）时触发。<li><code>onSelectCapture</code>: 与 <code>onSelect</code> 类似，但是是在 <a href="/learn/responding-to-events#capture-phase-events">捕获阶段</a> 触发。<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea#placeholder"><code>placeholder</code></a>：字符串，表示当文本框的值为空时，以淡色显示的占位符。<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea#readonly"><code>readOnly</code></a>：布尔值，如果为 <code>true</code>，文本框将无法被用户编辑。<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea#required"><code>required</code></a>：布尔值，如果为 <code>true</code>，则必须提供值才能在表单中提交。<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea#rows"><code>rows</code></a>：数字，表示默认高度，以平均字符高度计算。默认为 <code>2</code>。<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea#wrap"><code>wrap</code></a>：可以是 <code>'hard'</code>、<code>'soft'</code> 或 <code>'off'</code> 中的一个值，表示提交表单时文本应如何换行。</ul></section><section class="level4"aria-labelledby="注意-caveats"><h4 id="注意-caveats">注意 {/<em>caveats</em>/}</h4><ul><li>不允许传递像 <code>&#x3C;textarea>something&#x3C;/textarea></code> 这样的子元素，你应该 <a href="#providing-an-initial-value-for-a-text-area">使用 <code>defaultValue</code> 提供初始值</a>。<li>如果一个文本框接收字符串类型的 <code>value</code> 属性，那么它将被视为 <a href="#controlling-a-text-area-with-a-state-variable">受控组件</a>。<li>一个文本框不能同时既是受控组件又是非受控组件。<li>一个文本框在其生命周期内无法在受控和非受控之间切换。<li>每个受控文本框都需要一个 <code>onChange</code> 事件处理程序，以同步更新其后面的新值。</ul></section></section></section><section class="level2"aria-labelledby="用法-usage"><h2 id="用法-usage">用法 {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="展示一个文本框-displaying-a-text-area"><h3 id="展示一个文本框-displaying-a-text-area">展示一个文本框 {/<em>displaying-a-text-area</em>/}</h3><p>使用 <code>&#x3C;textarea></code> 渲染文本框。你可以使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea#rows"><code>rows</code></a> 和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea#cols"><code>cols</code></a> 属性指定其默认大小，但默认情况下用户可以调整大小。如果要禁用调整大小功能，可以在 CSS 中指定 <code>resize: none</code>。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">NewPost</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
      写下你的贴子：
      <span class="token operator">&#x3C;</span>textarea name<span class="token operator">=</span><span class="token string">"postContent"</span> rows<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span> cols<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">40</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">textarea</span> <span class="token punctuation">{</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">label<span class="token punctuation">,</span> textarea</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack></section><section class="level3"aria-labelledby="为文本框提供-label-属性-providing-a-label-for-a-text-area"><h3 id="为文本框提供-label-属性-providing-a-label-for-a-text-area">为文本框提供 label 属性 {/<em>providing-a-label-for-a-text-area</em>/}</h3><p>一般而言，应该将每个 <code>&#x3C;textarea></code> 都放置在 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/label"><code>&#x3C;label></code></a> 内，表示此标签与该选择框相关联。当用户单击标签时，浏览器将自动聚焦选择框。这对于可访问性也非常重要：当用户聚焦选择框时，屏幕阅读器将宣布标签标题。<p>如果无法将 <code>&#x3C;textarea></code> 放置在 <code>&#x3C;label></code> 内，请通过将相同的 ID 传递给 <code>&#x3C;textareaid></code> 与 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLLabelElement/htmlFor"><code>&#x3C;label htmlFor></code></a> 来将它们关联起来。为了避免组件在多个实例之间产生冲突，使用 <a href="/reference/react/useId"><code>useId</code></a> 生成这样的 ID。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useId <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> postTextAreaId <span class="token operator">=</span> <span class="token function">useId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label htmlFor<span class="token operator">=</span><span class="token punctuation">{</span>postTextAreaId<span class="token punctuation">}</span><span class="token operator">></span>
        写下你的贴子：
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>textarea
        id<span class="token operator">=</span><span class="token punctuation">{</span>postTextAreaId<span class="token punctuation">}</span>
        name<span class="token operator">=</span><span class="token string">"postContent"</span>
        rows<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span>
        cols<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">40</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack></section><section class="level3"aria-labelledby="提供初始值-providing-an-initial-value-for-a-text-area"><h3 id="提供初始值-providing-an-initial-value-for-a-text-area">提供初始值 {/<em>providing-an-initial-value-for-a-text-area</em>/}</h3><p>使用 <code>defaultValue</code> 属性传递字符串，指定文本框初始值。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">EditPost</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
      编辑你的贴子：
      <span class="token operator">&#x3C;</span>textarea
        name<span class="token operator">=</span><span class="token string">"postContent"</span>
        defaultValue<span class="token operator">=</span><span class="token string">"I really enjoyed biking yesterday!"</span>
        rows<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span>
        cols<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">40</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">textarea</span> <span class="token punctuation">{</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">label<span class="token punctuation">,</span> textarea</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><pitfall><p>与 HTML 不同，像这样传递初始值 <code>&#x3C;textarea>Some content&#x3C;/textarea></code> 将不受支持。</p></pitfall></section><section class="level3"aria-labelledby="提交表单时读取文本框的值-reading-the-text-area-value-when-submitting-a-form"><h3 id="提交表单时读取文本框的值-reading-the-text-area-value-when-submitting-a-form">提交表单时读取文本框的值 {/<em>reading-the-text-area-value-when-submitting-a-form</em>/}</h3><p>在文本框周围添加一个包含 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/button"><code>&#x3C;button type="submit"></code></a> 按钮的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/form"><code>&#x3C;form></code></a> 组件。这将调用 <code>&#x3C;form onSubmit></code> 事件处理程序。默认情况下，浏览器将向当前 URL 发送表单数据并刷新页面。你可以通过调用 <code>e.preventDefault()</code> 取消此默认行为，并使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FormData"><code>new FormData(e.target)</code></a> 读取表单数据。<sandpack></sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">EditPost</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 阻止浏览器重新加载页面</span>
    e<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 读取表单数据</span>
    <span class="token keyword">const</span> form <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 你可以直接将 formData 作为 fetch 请求的 body：</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/some-api'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">method</span><span class="token operator">:</span> form<span class="token punctuation">.</span><span class="token property-access">method</span><span class="token punctuation">,</span> <span class="token literal-property property">body</span><span class="token operator">:</span> formData <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 也可以使用普通的对象：</span>
    <span class="token keyword">const</span> formJson <span class="token operator">=</span> <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">fromEntries</span><span class="token punctuation">(</span>formData<span class="token punctuation">.</span><span class="token method function property-access">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>formJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form method<span class="token operator">=</span><span class="token string">"post"</span> onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        贴子标题：<span class="token operator">&#x3C;</span>input name<span class="token operator">=</span><span class="token string">"postTitle"</span> defaultValue<span class="token operator">=</span><span class="token string">"骑车"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        编辑你的贴子：
        <span class="token operator">&#x3C;</span>textarea
          name<span class="token operator">=</span><span class="token string">"postContent"</span>
          defaultValue<span class="token operator">=</span><span class="token string">"我昨天骑车很高兴！"</span>
          rows<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span>
          cols<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">40</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button type<span class="token operator">=</span><span class="token string">"reset"</span><span class="token operator">></span>重新编辑<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span>保存贴子<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre><note><p>给 <code>&#x3C;textarea></code> 添加 <code>name</code> 属性，例如 <code>&#x3C;textarea name="postContent" /></code>。指定的 <code>name</code> 将作为表单数据中的一个键，例如 <code>{ postContent: "Your post" }</code>。</p></note><pitfall><p>默认情况下，<code>&#x3C;form></code> 内的任何 <code>&#x3C;button></code> 都可以提交表单。这可能会让人感到惊讶！如果你有自定义 <code>Button</code> 组件，请考虑使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/input/button"><code>&#x3C;button type="button"></code></a> 而不是 <code>&#x3C;button></code>。如果你想要明确指定提交表单的按钮，请使用 <code>&#x3C;button type="submit"></code>。</p></pitfall></section><section class="level3"aria-labelledby="使用-state-控制文本框-controlling-a-text-area-with-a-state-variable"><h3 id="使用-state-控制文本框-controlling-a-text-area-with-a-state-variable">使用 state 控制文本框 {/<em>controlling-a-text-area-with-a-state-variable</em>/}</h3><p>像 <code>&#x3C;textarea /></code> 这样的选择框是非受控的。即使你 <a href="#providing-an-initial-value-for-a-text-area">传递了初始值</a>，比如 <code>&#x3C;textarea defaultValue="Initial text" /></code>，你的 JSX 也只是指定了初始值，而非当前时刻的值。<p><strong>如果要渲染一个受控选择框，请传递 <code>value</code> 属性</strong>。React 将强制传递 <code>value</code> 属性给文本框。通常，你可以通过声明一个 <a href="/reference/react/useState">state</a> 来控制文本框：<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">NewPost</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>postContent<span class="token punctuation">,</span> setPostContent<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 声明一个 state 变量...</span>
  <span class="token comment">// ...</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>textarea
      value<span class="token operator">=</span><span class="token punctuation">{</span>postContent<span class="token punctuation">}</span> <span class="token comment">// ...强制文本框的值与 state 相匹配...</span>
      onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setPostContent</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token comment">// ...并在每次改变（change）时更新 state！</span>
    <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>这将帮助你在每次按键时都触发重新渲染。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">MarkdownPreview</span></span> <span class="token keyword module">from</span> <span class="token string">'./MarkdownPreview.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MarkdownEditor</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>postContent<span class="token punctuation">,</span> setPostContent<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'_Hello,_ **Markdown**!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
      	输入一些 markdown 语言：
        <span class="token operator">&#x3C;</span>textarea
          value<span class="token operator">=</span><span class="token punctuation">{</span>postContent<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setPostContent</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MarkdownPreview</span> markdown<span class="token operator">=</span><span class="token punctuation">{</span>postContent<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Remarkable</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'remarkable'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> md <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Remarkable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MarkdownPreview</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> markdown <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> renderedHTML <span class="token operator">=</span> md<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span>markdown<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>div dangerouslySetInnerHTML<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">__html</span><span class="token operator">:</span> renderedHTML<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"remarkable"</span><span class="token operator">:</span> <span class="token string">"2.0.1"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">textarea</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><pitfall><p><strong>如果传递了 <code>value</code> 但没有传递 <code>onChange</code>，那么将无法在文本框输入任何内容</strong>。当你通过传递 <code>value</code> 来控制文本框时，你需要保证文本框始终具有你传递的值。因此，如果你将一个 state 作为 <code>value</code> 传递，但在 <code>onChange</code> 事件处理程序中忘记同步更新该状态变量，React 将在每次插入字符后将选择框恢复到你指定的 <code>value</code>。</p></pitfall></section></section><section class="level2"aria-labelledby="故障排除-troubleshooting"><h2 id="故障排除-troubleshooting">故障排除 {/<em>troubleshooting</em>/}</h2><section class="level3"aria-labelledby="输入时文本框没有更新-my-text-area-doesnt-update-when-i-type-into-it"><h3 id="输入时文本框没有更新-my-text-area-doesnt-update-when-i-type-into-it">输入时文本框没有更新 {/<em>my-text-area-doesnt-update-when-i-type-into-it</em>/}</h3><p>如果传递了 <code>value</code> 但没有传递 <code>onChange</code>，你将在控制台中看到一个错误：<pre class="language-js"><code class="language-js"><span class="token comment">// 🔴 Bug: controlled text area with no onChange handler</span>
<span class="token operator">&#x3C;</span>textarea value<span class="token operator">=</span><span class="token punctuation">{</span>something<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span></code></pre><consoleblock level="error"><p>如果在没有提供 <code>onChange</code> 处理程序的情况下向表单字段提供了 <code>value</code> 属性，这将导致文本框只读。如果文本框的内容是可变的，请使用 <code>defaultValue</code>；否则，请指定 <code>onChange</code> 或 <code>readOnly</code>。</p></consoleblock><p>正如错误消息所提示的那样，如果你只想 <a href="#providing-an-initial-value-for-a-text-area">指定初始值</a>，请改为使用 <code>defaultValue</code>：<pre class="language-js"><code class="language-js"><span class="token comment">// ✅ Good: uncontrolled text area with an initial value</span>
<span class="token operator">&#x3C;</span>textarea defaultValue<span class="token operator">=</span><span class="token punctuation">{</span>something<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span></code></pre><p>如果你想 <a href="#controlling-a-text-area-with-a-state-variable">使用 state 控制文本框</a>，请指定 <code>onChange</code> 处理程序：<pre class="language-js"><code class="language-js"><span class="token comment">// ✅ Good: controlled text area with onChange</span>
<span class="token operator">&#x3C;</span>textarea value<span class="token operator">=</span><span class="token punctuation">{</span>something<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setSomething</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span></code></pre><p>如果文本框的内容是只读的，请指定 <code>readOnly</code> 属性：<pre class="language-js"><code class="language-js"><span class="token comment">// ✅ Good: readonly controlled text area without on change</span>
<span class="token operator">&#x3C;</span>textarea value<span class="token operator">=</span><span class="token punctuation">{</span>something<span class="token punctuation">}</span> readOnly<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span></code></pre></section><section class="level3"aria-labelledby="当我输入时文本框光标会跳到开头-my-text-area-caret-jumps-to-the-beginning-on-every-keystroke"><h3 id="当我输入时文本框光标会跳到开头-my-text-area-caret-jumps-to-the-beginning-on-every-keystroke">当我输入时，文本框光标会跳到开头 {/<em>my-text-area-caret-jumps-to-the-beginning-on-every-keystroke</em>/}</h3><p>如果你想要 <a href="#controlling-a-text-area-with-a-state-variable">控制文本框</a>，你应该在 <code>onChange</code> 期间将对应的 state 变量更新为来自 DOM 的文本框的值。<p>你不应该将它更新为 <code>e.target.value</code> 以外的值：<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 🔴 Bug: updating an input to something other than e.target.value</span>
  <span class="token function">setFirstName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">.</span><span class="token method function property-access">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>你也不应该异步更新：<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 🔴 Bug: updating an input asynchronously</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setFirstName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>将 state 同步更新 <code>e.target.value</code> 以解决此问题：<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ✅ Updating a controlled input to e.target.value synchronously</span>
  <span class="token function">setFirstName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>如果这不能解决问题，有可能是因为每次输入时文本框都从 DOM 中删除并重新添加。同样，如果在每次重新渲染时不小心 <a href="/learn/preserving-and-resetting-state">重置了 state</a>，就会发生这种情况。例如，如果文本框或其祖先组件总是接收不同的 <code>key</code>，或者嵌套使用组件（这在 React 中是不允许的，并且会导致“内部”组件在每次渲染时重新挂载），就会发生这种情况。</section><section class="level3"aria-labelledby="收到错误a-component-is-changing-an-uncontrolled-input-to-be-controlled-im-getting-an-error-a-component-is-changing-an-uncontrolled-input-to-be-controlled"><h3 id="收到错误a-component-is-changing-an-uncontrolled-input-to-be-controlled-im-getting-an-error-a-component-is-changing-an-uncontrolled-input-to-be-controlled">收到错误：“A component is changing an uncontrolled input to be controlled” {/<em>im-getting-an-error-a-component-is-changing-an-uncontrolled-input-to-be-controlled</em>/}</h3><p>提供的 <code>value</code> 属性必须在整个生命周期中都为字符串。<p>你不能一会传递 <code>value={undefined}</code> 一会传递 <code>value="some string"</code>，这会导致 React 不清楚你是想指定受控组件还是非受控组件。受控组件的 <code>value</code> 属性应该始终接收字符串，而不是 <code>null</code> 或 <code>undefined</code>。<p>如果 <code>value</code> 来自 API 或 state，它可能会被初始化为 <code>null</code> 或 <code>undefined</code>。在这种情况下，要么最初将其设置为空字符串（<code>''</code>），要么传递 <code>value={someValue ?? ''}</code> 以确保 <code>value</code> 是一个字符串。 <span style="float:footnote"><a href="../../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></h1></section>