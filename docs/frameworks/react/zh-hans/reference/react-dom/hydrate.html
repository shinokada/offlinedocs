<!doctype html><html lang="zh-hans"><meta charset="utf-8"><title>hydrate</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="hydrate"><h1 id="hydrate">hydrate</h1><deprecated><p>此 API 将在未来的 React 主要版本中被移除。<p>从 React 18 开始，<code>hydrate</code> 被 <a href="/reference/react-dom/client/hydrateRoot"><code>hydrateRoot</code></a> 替代。在 React 18 或更高版本中使用 <code>hydrate</code> 将会警告你的应用程序行为会和 React 17 一样。如果你想了解更多，请看 <a href="/blog/2022/03/08/react-18-upgrade-guide#updates-to-client-rendering-apis">这里</a>。</p></deprecated><intro><p><code>hydrate</code> 允许你在 React 17 及以下版本中将使用 <a href="/reference/react-dom/server"><code>react-dom/server</code></a> 生成的 HTML 内容作为浏览器 DOM 节点，并在其中显示 React 组件。<pre class="language-js"><code class="language-js"><span class="token function">hydrate</span><span class="token punctuation">(</span>reactNode<span class="token punctuation">,</span> domNode<span class="token punctuation">,</span> callback<span class="token operator">?</span><span class="token punctuation">)</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="参考-reference"><h2 id="参考-reference">参考 {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="hydratereactnode-domnode-callback-hydrate"><h3 id="hydratereactnode-domnode-callback-hydrate"><code>hydrate(reactNode, domNode, callback?)</code> {/<em>hydrate</em>/}</h3><p>在 React 17 及以下版本中调用 <code>hydrate</code>，可以将 React “附加”到在服务器环境中已经由 React 渲染的现有 HTML 上。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrate <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token function">hydrate</span><span class="token punctuation">(</span>reactNode<span class="token punctuation">,</span> domNode<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>React 将会附加到 <code>domNode</code> 内部现有的 HTML，并接管有关的 DOM 的管理。使用 React 完全构建的应用通常只会有一个 <code>hydrate</code> 调用，并用于根组件。<p><a href="#usage">参见下面更多示例</a>。<section class="level4"aria-labelledby="参数-parameters"><h4 id="参数-parameters">参数 {/<em>parameters</em>/}</h4><ul><li><p><code>reactNode</code>：此参数用于渲染现有的 HTML。这通常是像 <code>&#x3C;App /></code> 这样的 JSX 片段，并且在 React 17 中使用如 <code>renderToString(&#x3C;App />)</code> 的 <code>ReactDOM Server</code> 方法进行渲染。<li><p><code>domNode</code>：在服务器中被渲染为根节点的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element">DOM 元素</a>。<li><p><strong>可选属性</strong> <code>callback</code>：一个函数。如果传递了该参数，React 将会在组件 hydrate 后调用它。</ul></section><section class="level4"aria-labelledby="返回值-returns"><h4 id="返回值-returns">返回值 {/<em>returns</em>/}</h4><p><code>hydrate</code> 返回 <code>null</code>。</section><section class="level4"aria-labelledby="注意-caveats"><h4 id="注意-caveats">注意 {/<em>caveats</em>/}</h4><ul><li><code>hydrate</code> 要求渲染的内容与服务器渲染的内容完全相同。尽管 React 可以修复文本内容的差异，但你应该首先将不匹配视为错误并进行修复。<li>在开发模式下，React 会在 hydration 期间警告不匹配的错误。如果存在不匹配情况，无法保证属性的差异会被修补。在大多数应用程序中不匹配是很少见的，所以验证所有标记的代价将会很高。因此考虑到性能原因，这是很重要的。<li>你的应用程序中可能只有一个 <code>hydrate</code> 调用。如果你使用了框架，它可能会为你执行此调用。<li>如果你的应用程序是客户端渲染的，并且没有已经渲染的 HTML，则不支持使用 <code>hydrate()</code>。请改用 <a href="/reference/react-dom/render">render()</a>（适用于 React 17 及以下版本）或 <a href="/reference/react-dom/client/createRoot">createRoot()</a>（适用于 React 18 及以上版本）。</ul></section></section></section><section class="level2"aria-labelledby="用法-usage"><h2 id="用法-usage">用法 {/<em>usage</em>/}</h2><p>调用 <code>hydrate</code> 将<codestep step="{1}">React 组件</codestep>附加（attach）到服务器渲染的<codestep step="{2}">浏览器 DOM 节点</codestep>。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrate <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token function">hydrate</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>不支持使用 <code>hydrate()</code> 渲染仅用于客户端的应用程序（没有服务器渲染的 HTML）。请改用 <a href="/reference/react-dom/render"><code>render()</code></a>（适用于 React 17 及以下版本）或 <a href="/reference/react-dom/client/createRoot"><code>createRoot()</code></a>（适用于 React 18 及以上版本）。<section class="level3"aria-labelledby="hydrate-服务器渲染的-html-hydrating-server-rendered-html"><h3 id="hydrate-服务器渲染的-html-hydrating-server-rendered-html">hydrate 服务器渲染的 HTML {/<em>hydrating-server-rendered-html</em>/}</h3><p>在 React 中，hydrate 是指将 React “附加（attach）”到在服务器环境中已由 React 渲染的现有 HTML 上。在 hydrate 期间，React 将尝试将事件监听器附加（attach）到现有标记，并在客户端上接管渲染应用程序。<p>在完全使用 React 构建的应用程序中，<strong>通常只会在第一次启动整个应用程序时，hydrate “根”节点</strong>。</p><sandpack><pre class="language-html"><code class="language-html"><span class="token comment">&#x3C;!--
  `&#x3C;div id="root">...&#x3C;/div>` 中的 HTML 内容是
  由 `react-dom/server` 从 `App` 生成的。
--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span>你好，世界！<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token string">'./styles.css'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrate <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">App</span></span> <span class="token keyword module">from</span> <span class="token string">'./App.js'</span><span class="token punctuation">;</span>

<span class="token function">hydrate</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>你好，世界！<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>通常情况下，你不需要再次调用 <code>hydrate</code>，也不需要在更多地方调用它。从此时开始，React 将会管理你的应用程序的 DOM。为了更新 UI，你的组件将会 <a href="/reference/react/useState">使用 state</a>。<p>有关 hydrate 的更多信息，请参阅 <a href="/reference/react-dom/client/hydrateRoot"><code>hydrateRoot</code></a>。</section><section class="level3"aria-labelledby="抑制不可避免的-hydrate-不匹配错误-suppressing-unavoidable-hydration-mismatch-errors"><h3 id="抑制不可避免的-hydrate-不匹配错误-suppressing-unavoidable-hydration-mismatch-errors">抑制不可避免的 hydrate 不匹配错误 {/<em>suppressing-unavoidable-hydration-mismatch-errors</em>/}</h3><p>如果服务器和客户端之间某个元素的属性或文本内容无法避免不同（比如一个时间戳），你可以禁止 hydrate 警告。<p>使用 <code>suppressHydrationWarning={true}</code> 禁止 hydrate 警告：</p><sandpack><pre class="language-html"><code class="language-html"><span class="token comment">&#x3C;!--
  `&#x3C;div id="root">...&#x3C;/div>` 中的 HTML 内容是
  由 `react-dom/server` 从 `App` 生成的。
--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span>当前时间：01/01/2020<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token string">'./styles.css'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrate <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">App</span></span> <span class="token keyword module">from</span> <span class="token string">'./App.js'</span><span class="token punctuation">;</span>

<span class="token function">hydrate</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>h1 suppressHydrationWarning<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token operator">></span>
      当前时间：<span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toLocaleDateString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>这只在同级深度上有效，而且是一种应急方法，因此不要过度使用它。除非它是文本内容，否则 React 仍然不会尝试修补它，因此直至未来的更新它都可能会保持不一致。</section><section class="level3"aria-labelledby="处理不同的客户端和服务器内容-handling-different-client-and-server-content"><h3 id="处理不同的客户端和服务器内容-handling-different-client-and-server-content">处理不同的客户端和服务器内容 {/<em>handling-different-client-and-server-content</em>/}</h3><p>如果需要在服务器和客户端上故意渲染不同的内容，可以进行双重渲染。在客户端上渲染不同内容的组件可以读取像 <code>isClient</code> 这样的 <a href="/reference/react/useState">state 变量</a>，你可以在 <a href="/reference/react/useEffect">effect</a> 中将其设置为 <code>true</code>：</p><sandpack><pre class="language-html"><code class="language-html"><span class="token comment">&#x3C;!--
  `&#x3C;div id="root">...&#x3C;/div>` 中的 HTML 内容是
  由 `react-dom/server` 从 `App` 生成的。
--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span>在服务器<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token string">'./styles.css'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrate <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">App</span></span> <span class="token keyword module">from</span> <span class="token string">'./App.js'</span><span class="token punctuation">;</span>

<span class="token function">hydrate</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isClient<span class="token punctuation">,</span> setIsClient<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setIsClient</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>
      <span class="token punctuation">{</span>isClient <span class="token operator">?</span> <span class="token string">'在客户端'</span> <span class="token operator">:</span> <span class="token string">'在服务器'</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>这样，初始渲染过程将呈现与服务器相同的内容，并且避免不匹配的情况，但会在 hydrate 后立即同步并进行额外的渲染。</p><pitfall><p>这种方法会使 hydrate 变慢，因为你的组件必须渲染两次，因此要注意在网络不好情况下的用户体验。JavaScript 代码的加载可能比初始 HTML 渲染要晚许多，因此在 hydrate 后立即渲染不同的 UI 可能会让用户感到不适。</p></pitfall><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>