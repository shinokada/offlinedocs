<!doctype html><html lang="zh-hans"><meta charset="utf-8"><title>"内置 React Hook"</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="内置-react-hook"><h1 id="内置-react-hook">"内置 React Hook"</h1><intro><p><strong>Hook</strong> 让你可以在组件中使用不同的 React 功能。你可以使用内置的 Hook 或者把它们组合起来建立你自己的。本页列出了 React 中所有的内置 Hook。</p></intro><section class="level2"aria-labelledby="状态-hook-state-hooks"><h2 id="状态-hook-state-hooks">状态 Hook {/<em>state-hooks</em>/}</h2><p><strong>state</strong> 让一个组件 <a href="/learn/state-a-components-memory">“记住”用户输入的信息</a>，比如，一个表单组件可以使用 state 来存储输入值，而一个图片库组件可以使用 state 来存储选定的图片索引。<p>要给一个组件添加状态，可以使用下面的 Hook：<ul><li><a href="/reference/react/useState"><code>useState</code></a> 声明了一个你可以直接更新的 state 变量。<li><a href="/reference/react/useReducer"><code>useReducer</code></a> 声明了一个带有更新逻辑的 state 变量在一个 <a href="/learn/extracting-state-logic-into-a-reducer">reducer 函数</a> 中。</ul><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ImageGallery</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>index<span class="token punctuation">,</span> setIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre></section><section class="level2"aria-labelledby="context-hook-context-hooks"><h2 id="context-hook-context-hooks">Context Hook {/<em>context-hooks</em>/}</h2><p><em>context</em> 让一个组件 <a href="/learn/passing-props-to-a-component">从远处的父组件接收信息，而不需要将其作为 props 传递</a>。比如，app 的顶层组件可以将当前的 UI 主题传递给下面的所有组件，无论它们层级多深。<ul><li><a href="/reference/react/useContext"><code>useContext</code></a> 读取并订阅一个 context。</ul><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Button</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre></section><section class="level2"aria-labelledby="ref-hook-ref-hooks"><h2 id="ref-hook-ref-hooks">Ref Hook {/<em>ref-hooks</em>/}</h2><p><em>ref</em> 让一个组件 <a href="/learn/referencing-values-with-refs">持有一些不用于渲染的信息</a>，如 DOM 节点或一个 timeout ID。与 state 不同的是，更新 ref 并不会重新渲染你的组件。ref 是 React 范式的一个“规避机制”。当你需要与非 React 系统一起工作时，它们很有用，比如内置的浏览器 API。<ul><li><a href="/reference/react/useRef"><code>useRef</code></a> 声明一个 ref。你可以在其中保存任何值，但最常见的是它用来保存一个 DOM 节点。<li><a href="/reference/react/useImperativeHandle"><code>useImperativeHandle</code></a> 可以让你自定义组件所暴露的 ref。一般很少使用。</ul><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre></section><section class="level2"aria-labelledby="effect-hook-effect-hooks"><h2 id="effect-hook-effect-hooks">Effect Hook {/<em>effect-hooks</em>/}</h2><p><em>Effect</em> 让一个组件 <a href="/learn/synchronizing-with-effects">连接到外部系统并与之同步</a>。这包括处理网络、浏览器、DOM、动画、使用不同 UI 库编写的 widgets 以及其他非 React 代码。<ul><li><a href="/reference/react/useEffect"><code>useEffect</code></a> 将一个组件连接到外部系统。</ul><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p>Effect 是 React 范式的“规避机制”。不要用 Effect 来协调你的应用程序的数据流。如果你不与外部系统交互，<a href="/learn/you-might-not-need-an-effect">你可能不需要 Effect</a>。<p><code>useEffect</code> 有两个很少使用的变换形式，它们在时机上有一些差异：<ul><li><a href="/reference/react/useLayoutEffect"><code>useLayoutEffect</code></a> 在浏览器重新绘制屏幕前执行。在这里，你可以测量布局。<li><a href="/reference/react/useInsertionEffect"><code>useInsertionEffect</code></a> 在 React 对 DOM 进行更改之前触发。在这里，库可以插入动态的 CSS。</ul></section><section class="level2"aria-labelledby="性能-hook-performance-hooks"><h2 id="性能-hook-performance-hooks">性能 Hook {/<em>performance-hooks</em>/}</h2><p>优化重新渲染性能的一个常见方法就是跳过不必要的工作。比如，你可以告诉 React 重用一个缓存的计算结果，或者如果数据在上一次渲染后没有变化，就跳过这次重新渲染。<p>你可以使用这些 Hook 跳过计算和不必要的重新渲染：<ul><li><a href="/reference/react/useMemo"><code>useMemo</code></a> 让你缓存一个代价非常高的计算结果。<li><a href="/reference/react/useCallback"><code>useCallback</code></a> 让你在将一个函数定义传递给一个优化的组件之前缓存它。</ul><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> todos<span class="token punctuation">,</span> tab<span class="token punctuation">,</span> theme <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> visibleTodos <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">filterTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> tab<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> tab<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>有时，你不能跳过重新渲染，因为屏幕确实需要更新。在这种情况下，你可以通过将必须同步的阻塞更新（比如使用输入法输入内容）与不需要阻塞用户界面的非阻塞更新（比如更新图表）分开以提高性能。<p>要确定渲染的优先级，可以使用以下 Hook：<ul><li><a href="/reference/react/useTransition"><code>useTransition</code></a> 让你把一个状态转换标记为非阻塞，并允许其他更新中断它。<li><a href="/reference/react/useDeferredValue"><code>useDeferredValue</code></a> 让你推迟更新用户界面的一个非关键部分，让其他部分更新。</ul></section><section class="level2"aria-labelledby="其他-hook-other-hooks"><h2 id="其他-hook-other-hooks">其他 Hook {/<em>other-hooks</em>/}</h2><p>这些 Hook 主要对库的作者有用，在应用代码中并不常用。<ul><li><a href="/reference/react/useDebugValue"><code>useDebugValue</code></a> 允许你在 React 开发者工具中为自定义 Hook 添加一个标签。<li><a href="/reference/react/useId"><code>useId</code></a> 允许组件绑定一个唯一 ID。通常与可访问性 API 一起使用。<li><a href="/reference/react/useSyncExternalStore"><code>useSyncExternalStore</code></a> 允许一个组件订阅一个外部 store。</ul></section><section class="level2"aria-labelledby="自定义-hook-your-own-hooks"><h2 id="自定义-hook-your-own-hooks">自定义 Hook {/<em>your-own-hooks</em>/}</h2><p>你也可以在 JavaScript 函数中 <a href="/learn/reusing-logic-with-custom-hooks#extracting-your-own-custom-hook-from-a-component">定义你自己的 Hook</a>。 <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section>