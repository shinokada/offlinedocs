<!doctype html><html lang="zh-hans"><meta charset="utf-8"><title>useActionState</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="useactionstate"><h1 id="useactionstate">useActionState</h1><p>canary: true</p><canary><p><code>useActionState</code> Hook 当前仅在 React Canary 与 experimental 渠道中可用。请点此了解更多关于 <a href="/community/versioning-policy#all-release-channels">React 发布渠道</a> 的信息。此外，需要一款完全支持 <a href="/reference/react/use-client">React 服务器组件</a> 特性的框架才可以使用 <code>useActionState</code> 的所有特性。</p></canary><note><p>In earlier React Canary versions, this API was part of React DOM and called <code>useFormState</code>.</p></note><intro><p><code>useActionState</code> 是一个可以根据某个表单动作的结果更新 state 的 Hook。<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> formAction<span class="token punctuation">,</span> isPending<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> initialState<span class="token punctuation">,</span> permalink<span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="参考-reference"><h2 id="参考-reference">参考 {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="useactionstateaction-initialstate-permalink-useactionstate"><h3 id="useactionstateaction-initialstate-permalink-useactionstate"><code>useActionState(action, initialState, permalink?)</code> {/<em>useactionstate</em>/}</h3><p>{/<em> TODO T164397693: link to actions documentation once it exists </em>/}<p>在组件的顶层调用 <code>useActionState</code> 即可创建一个随 <a href="/reference/react-dom/components/form">表单动作被调用</a> 而更新的 state。在调用 <code>useActionState</code> 时在参数中传入现有的表单动作函数以及一个初始状态，无论 Action 是否在 pending 中，它都会返回一个新的 action 函数和一个 form state 以供在 form 中使用。这个新的 form state 也会作为参数传入提供的表单动作函数。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useActionState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token parameter">previousState<span class="token punctuation">,</span> formData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> previousState <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">StatefulForm</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> formAction<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>increment<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form<span class="token operator">></span>
      <span class="token punctuation">{</span>state<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>button formAction<span class="token operator">=</span><span class="token punctuation">{</span>formAction<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><p>form state 是一个只在表单被提交触发 action 后才会被更新的值。如果该表单没有被提交，该值会保持传入的初始值不变。<p>如果配合 Server Action 一起使用，<code>useActionState</code> 允许与表单交互的服务器的返回值在激活完成前显示。<p><a href="#usage">请参阅下方更多示例</a>。<section class="level4"aria-labelledby="参数-parameters"><h4 id="参数-parameters">参数 {/<em>parameters</em>/}</h4><ul><li><code>fn</code>：当按钮被按下或者表单被提交时触发的函数。当函数被调用时，该函数会接收到表单的上一个 state（初始值为传入的 <code>initialState</code> 参数，否则为上一次执行完该函数的结果）作为函数的第一个参数，余下参数为普通表单动作接到的参数。<li><code>initialState</code>：state 的初始值。任何可序列化的值都可接收。当 action 被调用一次后该参数会被忽略。<li><strong>可选</strong> <code>permalink</code>: A string containing the unique page URL that this form modifies. For use on pages with dynamic content (eg: feeds) in conjunction with progressive enhancement: if <code>fn</code> is a <a href="/reference/react/use-server">server action</a> and the form is submitted before the JavaScript bundle loads, the browser will navigate to the specified permalink URL, rather than the current page's URL. Ensure that the same form component is rendered on the destination page (including the same action <code>fn</code> and <code>permalink</code>) so that React knows how to pass the state through. Once the form has been hydrated, this parameter has no effect. {/<em> TODO T164397693: link to serializable values docs once it exists </em>/}</ul></section><section class="level4"aria-labelledby="返回值-returns"><h4 id="返回值-returns">返回值 {/<em>returns</em>/}</h4><p><code>useActionState</code> 返回一个包含以下值的数组：<ol><li>当前的 state。第一次渲染期间，该值为传入的 <code>initialState</code> 参数值。在 action 被调用后该值会变为 action 的返回值。<li>一个新的 action 函数用于在你的 <code>form</code> 组件的 <code>action</code> 参数或表单中任意一个 <code>button</code> 组件的 <code>formAction</code> 参数中传递。<li>一个 <code>isPending</code> 标识，用于表明是否有正在 pending 的 Transition。</ol></section><section class="level4"aria-labelledby="注意-caveats"><h4 id="注意-caveats">注意 {/<em>caveats</em>/}</h4><ul><li>在支持 React 服务器组件的框架中使用该功能时，<code>useActionState</code> 允许表单在服务器渲染阶段时获得部分交互性。当不使用服务器组件时，它的特性与本地 state 相同。<li>与直接通过表单动作调用的函数不同，传入 <code>useActionState</code> 的函数被调用时，会多传入一个代表 state 的上一个值或初始值的参数作为该函数的第一个参数。</ul></section></section></section><section class="level2"aria-labelledby="用法-usage"><h2 id="用法-usage">用法 {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="使用某个表单动作返回的信息-using-information-returned-by-a-form-action"><h3 id="使用某个表单动作返回的信息-using-information-returned-by-a-form-action">使用某个表单动作返回的信息 {/<em>using-information-returned-by-a-form-action</em>/}</h3><p>在组件的顶层调用 <code>useActionState</code> 以获取上一次表单被提交时触发的 action 的返回值。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useActionState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> action <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./actions.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> formAction<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>formAction<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span><span class="token comment">/* ... */</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><code>useActionState</code> 返回一个包含以下值的数组：<ol><li>该表单的<codestep step="{1}">当前 state</codestep>，初始值为提供的<codestep step="{4}">初始 state</codestep>，当表单被提交后则改为传入的<codestep step="{3}">action</codestep>的返回值。<li>传入 <code>&#x3C;form></code> 标签的 <code>action</code> 属性的<codestep step="{2}">新 action</codestep>。<li>一个<codestep step="{1}">pending state</codestep>，可以在处理 action 的过程中使用它。</ol><p>表单被提交后，传入的<codestep step="{3}">action</codestep>函数会被执行。返回值将会作为该表单的新的<codestep step="{1}">当前 state</codestep>。<p>传入的<codestep step="{3}">action</codestep>接受到的第一个参数将会变为该表单的<codestep step="{1}">当前 state</codestep>。当表单第一次被提交时将会传入提供的<codestep step="{4}">初始 state</codestep>，之后都将传入上一次调用<codestep step="{3}">action</codestep>函数的返回值。余下参数与未使用 <code>useActionState</code> 前接受的参数别无二致<sup><a href="#note1">[1]</a></sup>。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token parameter">currentState<span class="token punctuation">,</span> formData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword control-flow">return</span> <span class="token string">'next state'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><recipes titletext="提交表单后展示信息"titleid="display-information-after-submitting-a-form"><section class="level4"aria-labelledby="展示表单错误-display-form-errors"><h4 id="展示表单错误-display-form-errors">展示表单错误 {/<em>display-form-errors</em>/}</h4><p>将 action 包裹进 <code>useActionState</code> 即可展示诸如错误信息或 Server Action 返回的 toast 等信息。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useActionState<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> addToCart <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"./actions.js"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AddToCartForm</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>itemID<span class="token punctuation">,</span> itemTitle<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> formAction<span class="token punctuation">,</span> isPending<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>addToCart<span class="token punctuation">,</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>formAction<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token punctuation">{</span>itemTitle<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"hidden"</span> name<span class="token operator">=</span><span class="token string">"itemID"</span> value<span class="token operator">=</span><span class="token punctuation">{</span>itemID<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span>加入购物车<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>isPending <span class="token operator">?</span> <span class="token string">"加载中……"</span> <span class="token operator">:</span> message<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddToCartForm</span> itemID<span class="token operator">=</span><span class="token string">"1"</span> itemTitle<span class="token operator">=</span><span class="token string">"JavaScript：权威指南"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddToCartForm</span> itemID<span class="token operator">=</span><span class="token string">"2"</span> itemTitle<span class="token operator">=</span><span class="token string">"JavaScript：优点荟萃"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token string">"use server"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> queryData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> itemID <span class="token operator">=</span> queryData<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'itemID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>itemID <span class="token operator">===</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">"已加入购物车"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 认为添加延迟以使等待更明显。</span>
    <span class="token keyword control-flow">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token string">"无法加入购物车：商品已售罄"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">form</span> <span class="token punctuation">{</span>
  <span class="token property">border</span><span class="token punctuation">:</span> solid <span class="token number">1</span><span class="token unit">px</span> <span class="token color">black</span><span class="token punctuation">;</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">24</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token unit">px</span>
<span class="token punctuation">}</span>

<span class="token selector">form button</span> <span class="token punctuation">{</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"canary"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"canary"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"^5.0.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"/index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section><section class="level4"aria-labelledby="提交表单后展示结构性数据-display-structured-information-after-submitting-a-form"><h4 id="提交表单后展示结构性数据-display-structured-information-after-submitting-a-form">提交表单后展示结构性数据 {/<em>display-structured-information-after-submitting-a-form</em>/}</h4><p>Server Actions 的返回值可以为任意可序列化的值。例如，可以返回一个实例，该实例携带一个 boolean 类型的属性表示操作是否成功，同时附带错误信息或更新消息。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useActionState<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> addToCart <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"./actions.js"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AddToCartForm</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>itemID<span class="token punctuation">,</span> itemTitle<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>formState<span class="token punctuation">,</span> formAction<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>addToCart<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>formAction<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token punctuation">{</span>itemTitle<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"hidden"</span> name<span class="token operator">=</span><span class="token string">"itemID"</span> value<span class="token operator">=</span><span class="token punctuation">{</span>itemID<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span>加入购物车<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>formState<span class="token operator">?.</span>success <span class="token operator">&#x26;&#x26;</span>
        <span class="token operator">&#x3C;</span>div className<span class="token operator">=</span><span class="token string">"toast"</span><span class="token operator">></span>
          成功加入购物车！当前购物车中共有 <span class="token punctuation">{</span>formState<span class="token punctuation">.</span><span class="token property-access">cartSize</span><span class="token punctuation">}</span> 件商品。
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">}</span>
      <span class="token punctuation">{</span>formState<span class="token operator">?.</span>success <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token operator">&#x26;&#x26;</span>
        <span class="token operator">&#x3C;</span>div className<span class="token operator">=</span><span class="token string">"error"</span><span class="token operator">></span>
          加入购物车失败：<span class="token punctuation">{</span>formState<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddToCartForm</span> itemID<span class="token operator">=</span><span class="token string">"1"</span> itemTitle<span class="token operator">=</span><span class="token string">"JavaScript：权威指南"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddToCartForm</span> itemID<span class="token operator">=</span><span class="token string">"2"</span> itemTitle<span class="token operator">=</span><span class="token string">"JavaScript：优点荟萃"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token string">"use server"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> queryData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> itemID <span class="token operator">=</span> queryData<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'itemID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>itemID <span class="token operator">===</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cartSize</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"商品已售罄"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">form</span> <span class="token punctuation">{</span>
  <span class="token property">border</span><span class="token punctuation">:</span> solid <span class="token number">1</span><span class="token unit">px</span> <span class="token color">black</span><span class="token punctuation">;</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">24</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token unit">px</span>
<span class="token punctuation">}</span>

<span class="token selector">form button</span> <span class="token punctuation">{</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"canary"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"canary"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"^5.0.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"/index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section></recipes></section></section><section class="level2"aria-labelledby="疑难解答-troubleshooting"><h2 id="疑难解答-troubleshooting">疑难解答 {/<em>troubleshooting</em>/}</h2><section class="level3"aria-labelledby="我的-action-无法再获取提交的-form-data-了-my-action-can-no-longer-read-the-submitted-form-data"><h3 id="我的-action-无法再获取提交的-form-data-了-my-action-can-no-longer-read-the-submitted-form-data">我的 action 无法再获取提交的 form data 了 {/<em>my-action-can-no-longer-read-the-submitted-form-data</em>/}</h3><p>当使用 <code>useActionState</code> 包裹 action 时，第一个参数变为了 form 的当前 state，提交的表单数据被顺移到了第二个参数中，与直接使用表单动作是不同的。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token parameter">currentState<span class="token punctuation">,</span> formData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><strong>译注：</strong><p><a name="note1"></a>[1] 这里的意思是原来的第一个参数被顺移为第二个参数，第二个参数被顺移为第三个参数，以此类推 <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>