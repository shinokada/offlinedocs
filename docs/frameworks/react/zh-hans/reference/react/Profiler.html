<!doctype html><html lang="zh-hans"><meta charset="utf-8"><title>&#x3C;Profiler></title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="profiler"><h1 id="profiler"><profiler></profiler></h1><intro><p><code>&#x3C;Profiler></code> 允许你编程式测量 React 树的渲染性能。<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profiler</span> id<span class="token operator">=</span><span class="token string">"App"</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Profiler</span><span class="token operator">></span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="参考-reference"><h2 id="参考-reference">参考 {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="profiler-profiler"><h3 id="profiler-profiler"><code>&#x3C;Profiler></code> {/<em>profiler</em>/}</h3><p>使用 <code>&#x3C;Profiler></code> 包裹组件树，以测量其渲染性能。<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profiler</span> id<span class="token operator">=</span><span class="token string">"App"</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Profiler</span><span class="token operator">></span></code></pre><section class="level4"aria-labelledby="参数-props"><h4 id="参数-props">参数 {/<em>props</em>/}</h4><ul><li><code>id</code>：字符串，用于标识正在测量的 UI 部分。<li><code>onRender</code>：<a href="#onrender-callback"><code>onRender</code> 回调函数</a>，当包裹的组件树更新时，React 都会调用它。它接收有关渲染内容和所花费时间的信息。</ul></section><section class="level4"aria-labelledby="注意-caveats"><h4 id="注意-caveats">注意 {/<em>caveats</em>/}</h4><ul><li>进行性能分析会增加一些额外的开销，因此 <strong>在默认情况下，它在生产环境中是被禁用的</strong>。如果要启用生产环境下的性能分析，你需要启用一个 <a href="https://fb.me/react-profiling">特殊的带有性能分析功能的生产构建</a>。</ul></section></section><section class="level3"aria-labelledby="onrender-回调函数-onrender-callback"><h3 id="onrender-回调函数-onrender-callback"><code>onRender</code> 回调函数 {/<em>onrender-callback</em>/}</h3><p>当调用 <code>onRender</code> 回调函数时，React 会告诉你相关信息。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">onRender</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> phase<span class="token punctuation">,</span> actualDuration<span class="token punctuation">,</span> baseDuration<span class="token punctuation">,</span> startTime<span class="token punctuation">,</span> commitTime</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 对渲染时间进行汇总或记录...</span>
<span class="token punctuation">}</span></code></pre><section class="level4"aria-labelledby="参数-onrender-parameters"><h4 id="参数-onrender-parameters">参数 {/<em>onrender-parameters</em>/}</h4><ul><li><code>id</code>：字符串，为 <code>&#x3C;Profiler></code> 树的 <code>id</code> 属性，用于标识刚刚提交的部分。如果使用多个 profiler，可以通过此属性识别提交的是树中的哪一部分。<li><code>phase</code>：为 <code>"mount"</code>、<code>"update"</code> 或 <code>"nested-update"</code> 中之一。这可以让你知道组件树是首次挂载还是由于 props、state 或 hook 的更改而重新渲染。<li><code>actualDuration</code>：在此次更新中，渲染 <code>&#x3C;Profiler></code> 组件树的毫秒数。这可以显示子树在使用记忆化（例如 <a href="/reference/react/memo"><code>memo</code></a> 和 <a href="/reference/react/useMemo"><code>useMemo</code></a>）后的效果如何。理想情况下，此值在挂载后应显著减少，因为许多后代组件只会在特定的 props 变化时重新渲染。<li><code>baseDuration</code>：估算在没有任何优化的情况下重新渲染整棵 <code>&#x3C;Profiler></code> 子树所需的毫秒数。它通过累加树中每个组件的最近一次渲染持续时间来计算。此值估计了渲染的最差情况成本（例如初始挂载或没有使用记忆化的树）。将其与 <code>actualDuration</code> 进行比较，以确定记忆化是否起作用。<li><code>startTime</code>：当 React 开始渲染此次更新时的时间戳。<li><code>commitTime</code>：当 React 提交此次更新时的时间戳。此值在提交的所有 profiler 中共享，如果需要，可以对它们进行分组。</ul></section></section></section><section class="level2"aria-labelledby="用法-usage"><h2 id="用法-usage">用法 {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="编程式测量渲染性能-measuring-rendering-performance-programmatically"><h3 id="编程式测量渲染性能-measuring-rendering-performance-programmatically">编程式测量渲染性能 {/<em>measuring-rendering-performance-programmatically</em>/}</h3><p>使用 <code>&#x3C;Profiler></code> 组件包裹 React 树以测量其渲染性能。<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profiler</span> id<span class="token operator">=</span><span class="token string">"Sidebar"</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Sidebar</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Profiler</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PageContent</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">App</span><span class="token operator">></span></code></pre><p>这需要两个属性：<code>id</code>（字符串）和 <code>onRender</code> 回调函数（函数），每当 React 树中的任何组件“提交”更新时都将调用该函数。</p><pitfall><p>进行性能分析会增加一些额外的开销，因此 <strong>在默认情况下，它在生产环境中是被禁用的</strong>。如果要启用生产环境下的性能分析，你需要启用 <a href="https://fb.me/react-profiling">特殊的带有性能分析功能的生产构建</a>。</p></pitfall><note><p><code>&#x3C;Profiler></code> 允许你编程式收集性能测量数据。如果你正在寻找一个交互式的性能分析工具，可以尝试使用 <a href="/learn/react-developer-tools">React 开发者工具</a> 中的 Profiler 标签页。它提供了类似浏览器扩展程序的功能。</p></note></section><section class="level3"aria-labelledby="测量应用的不同部分-measuring-different-parts-of-the-application"><h3 id="测量应用的不同部分-measuring-different-parts-of-the-application">测量应用的不同部分 {/<em>measuring-different-parts-of-the-application</em>/}</h3><p>你可以使用多个 <code>&#x3C;Profiler></code> 组件来测量应用的不同部分：<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profiler</span> id<span class="token operator">=</span><span class="token string">"Sidebar"</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Sidebar</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Profiler</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profiler</span> id<span class="token operator">=</span><span class="token string">"Content"</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Content</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Profiler</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">App</span><span class="token operator">></span></code></pre><p>还可以嵌套 <code>&#x3C;Profiler></code> 组件：<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profiler</span> id<span class="token operator">=</span><span class="token string">"Sidebar"</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Sidebar</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Profiler</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profiler</span> id<span class="token operator">=</span><span class="token string">"Content"</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Content</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profiler</span> id<span class="token operator">=</span><span class="token string">"Editor"</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Editor</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Profiler</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Preview</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Content</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Profiler</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">App</span><span class="token operator">></span></code></pre><p>虽然 <code>&#x3C;Profiler></code> 是一个轻量级组件，但它应该仅在必要时使用。每次使用都会给应用增加一些额外的 CPU 和内存开销。<p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>