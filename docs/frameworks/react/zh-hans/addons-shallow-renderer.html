<!doctype html>
<html lang="zh-hans">
  <head>
    <meta charset="utf-8">
    <title>浅层渲染</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css">
  </head>
  <body>
    <section id="浅层渲染" class="level1">
      <h1>浅层渲染</h1>
      <p><strong>如何引入</strong></p>
      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ShallowRenderer</span></span> <span class="token keyword module">from</span> <span class="token string">'react-test-renderer/shallow'</span><span class="token punctuation">;</span> <span class="token comment">// ES6</span>
<span class="token keyword">var</span> <span class="token maybe-class-name">ShallowRenderer</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react-test-renderer/shallow'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ES5 with npm</span></code></pre>
      <section id="overview" class="level2">
        <h2>概览</h2>
        <p>当为 React 编写单元测试时，浅层渲染十分有用。浅层渲染可以只渲染组件的“第一层”，并且对组件的 render 方法的返回值进行断言，不必担心子组件的行为，子组件并没有实例化或被渲染。并且浅层渲染不依赖 DOM。</p>
        <p>例如，如果你有如下的组件：</p>
        <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>span className<span class="token operator">=</span><span class="token string">"heading"</span><span class="token operator">></span><span class="token maybe-class-name">Title</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Subcomponent</span> foo<span class="token operator">=</span><span class="token string">"bar"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
        <p>你可以使用断言：</p>
        <pre class="language-javascript"><code class="language-javascript"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ShallowRenderer</span></span> <span class="token keyword module">from</span> <span class="token string">'react-test-renderer/shallow'</span><span class="token punctuation">;</span>

<span class="token comment">// 测试代码:</span>
<span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShallowRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
renderer<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">MyComponent</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> renderer<span class="token punctuation">.</span><span class="token method function property-access">getRenderOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token operator">&#x3C;</span>span className<span class="token operator">=</span><span class="token string">"heading"</span><span class="token operator">></span><span class="token maybe-class-name">Title</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">,</span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Subcomponent</span> foo<span class="token operator">=</span><span class="token string">"bar"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
        <p>浅层测试（Shallow testing）目前有些局限性，即不支持 refs。</p>
        <blockquote>
          <p>注意：</p>
          <p>建议你查阅 Enzyme 的<a href="https://airbnb.io/enzyme/docs/api/shallow.html">浅层渲染的 API</a>。它在相同的功能基础上提供了更棒更高级的 API。</p>
        </blockquote>
      </section>
      <section id="reference" class="level2">
        <h2>参考</h2>
        <section id="shallowrendererrender-shallowrendererrender" class="level3">
          <h3><code>shallowRenderer.render()</code> {#shallowrendererrender}</h3>
          <p>你可以把 shallowRenderer 看作用来渲染测试中组件的“容器”，且可以从容器中取到该组件的输出内容。</p>
          <p><code>shallowRenderer.render()</code> 和 <a href="./react-dom-client.html#createroot"><code>ReactDOM.render()</code></a> 很像，但是它不依赖 DOM 且只渲染一层。这意味着你可以对组件和其子组件的实现进行隔离测试。</p>
        </section>
        <section id="shallowrenderergetrenderoutput-shallowrenderergetrenderoutput" class="level3">
          <h3><code>shallowRenderer.getRenderOutput()</code> {#shallowrenderergetrenderoutput}</h3>
          <p>在 <code>shallowRenderer.render()</code> 被调用后，你可以使用 <code>shallowRenderer.getRenderOutput()</code> 来获取浅层渲染的输出内容。</p>
          <p>
            然后，你就可以开始对输出内容进行断言操作。
            <span style="float: footnote;"><a href="./index.html#toc">Go to TOC</a></span>
          </p>
        </section>
      </section>
    </section>
  </body>
</html>
