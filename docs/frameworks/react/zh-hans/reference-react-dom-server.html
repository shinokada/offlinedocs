<!doctype html><html lang="zh-hans"><meta charset="utf-8"><title>ReactDOMServer</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="reactdomserver"class="level1"><h1>ReactDOMServer</h1><p><code>ReactDOMServer</code> 对象允许你将组件渲染成静态标记。通常，它被使用在 Node 服务端上：<pre class="language-js"><code class="language-js"><span class="token comment">// ES modules</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> <span class="token maybe-class-name">ReactDOMServer</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/server'</span><span class="token punctuation">;</span>
<span class="token comment">// CommonJS</span>
<span class="token keyword">var</span> <span class="token maybe-class-name">ReactDOMServer</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react-dom/server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><section id="overview"class="level2"><h2>概览</h2><p>These methods are only available in the <strong>environments with <a href="https://nodejs.org/api/stream.html">Node.js Streams</a>:</strong><ul><li><a href="#rendertopipeablestream"><code>renderToPipeableStream()</code></a><li><a href="#rendertonodestream"><code>renderToNodeStream()</code></a> (Deprecated)<li><a href="#rendertostaticnodestream"><code>renderToStaticNodeStream()</code></a></ul><p>这些方法只在支持 <strong><a href="https://developer.mozilla.org/en-US/docs/Web/API/Streams_API">Web Streams</a> 的环境中可用</strong>（这包含浏览器，Deno 和一些现代边缘 runtime）：<ul><li><a href="#rendertoreadablestream"><code>renderToReadableStream()</code></a></ul><p>以下方法可以在不支持 Steam 的环境中使用：<ul><li><a href="#rendertostring"><code>renderToString()</code></a><li><a href="#rendertostaticmarkup"><code>renderToStaticMarkup()</code></a></ul></section><section id="reference"class="level2"><h2>参考</h2><section id="rendertopipeablestream-rendertopipeablestream"class="level3"><h3><code>renderToPipeableStream()</code> {#rendertopipeablestream}</h3><blockquote><p>Try the new React documentation for <a href="https://beta.reactjs.org/reference/react-dom/server/renderToPipeableStream"><code>renderToPipeableStream</code></a>.<p>The new docs will soon replace this site, which will be archived. <a href="https://github.com/reactjs/reactjs.org/issues/3308">Provide feedback.</a></blockquote><pre class="language-javascript"><code class="language-javascript"><span class="token maybe-class-name">ReactDOMServer</span><span class="token punctuation">.</span><span class="token method function property-access">renderToPipeableStream</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> options<span class="token punctuation">)</span></code></pre><p>将一个 React 元素渲染为初始 HTML。返回一个带有 <code>pipe(res)</code> 方法的流，用于管道输出。<code>abort()</code> 用于中止请求。完美支持了 suspense 和 HTML 流，"延迟" 的内容块会通过内联的 <code>&#x3C;script></code> 标签嵌入。<a href="https://github.com/reactwg/react-18/discussions/37">了解更多</a><p>如果你在一个已经被服务端渲染标记的节点上调用 <a href="./react-dom-client.html#hydrateroot"><code>ReactDOM.hydrateRoot()</code></a>，React 会保留它，只附加事件处理程序，让你有一个非常高性能的首次加载体验。<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> didError <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> stream <span class="token operator">=</span> <span class="token function">renderToPipeableStream</span><span class="token punctuation">(</span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token function">onShellReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// The content above all Suspense boundaries is ready.</span>
      <span class="token comment">// If something errored before we started streaming, we set the error code appropriately.</span>
      res<span class="token punctuation">.</span><span class="token property-access">statusCode</span> <span class="token operator">=</span> didError <span class="token operator">?</span> <span class="token number">500</span> <span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      stream<span class="token punctuation">.</span><span class="token method function property-access">pipe</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onShellError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Something errored before we could complete the shell so we emit an alternative shell.</span>
      res<span class="token punctuation">.</span><span class="token property-access">statusCode</span> <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>
        <span class="token string">'&#x3C;!doctype html>&#x3C;p>Loading...&#x3C;/p>&#x3C;script src="clientrender.js">&#x3C;/script>'</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onAllReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// If you don't want streaming, use this instead of onShellReady.</span>
      <span class="token comment">// This will fire after the entire page content is ready.</span>
      <span class="token comment">// You can use this for crawlers or static generation.</span>

      <span class="token comment">// res.statusCode = didError ? 500 : 200;</span>
      <span class="token comment">// res.setHeader('Content-type', 'text/html');</span>
      <span class="token comment">// stream.pipe(res);</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      didError <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>具体参见 <a href="https://github.com/facebook/react/blob/14c2be8dac2d5482fda8a0906a31d239df8551fc/packages/react-dom/src/server/ReactDOMFizzServerNode.js#L36-L46">完整的选项列表</a>.<blockquote><p>注意：<p>这是一个针对 Node.js 的 API。只在支持 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Streams_API">Web Streams</a> 的环境下可用，如 Deno 以及现代边缘 runtimes，应使用 <a href="#rendertoreadablestream"><code>renderToReadableStream</code></a> 代替。</blockquote><hr></section><section id="rendertoreadablestream-rendertoreadablestream"class="level3"><h3><code>renderToReadableStream()</code> {#rendertoreadablestream}</h3><blockquote><p>Try the new React documentation for <a href="https://beta.reactjs.org/reference/react-dom/server/renderToReadableStream"><code>renderToReadableStream</code></a>.<p>The new docs will soon replace this site, which will be archived. <a href="https://github.com/reactjs/reactjs.org/issues/3308">Provide feedback.</a></blockquote><pre class="language-javascript"><code class="language-javascript"><span class="token maybe-class-name">ReactDOMServer</span><span class="token punctuation">.</span><span class="token method function property-access">renderToReadableStream</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>将一个 React 元素通过流的形式注入初始的 HTML 中。返回值为 Promise, resolve 一个 <a href="https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream">可读 Stream</a>。完美支持了 suspense 和 HTML 流。<a href="https://github.com/reactwg/react-18/discussions/127">了解更多</a><p>如果你在一个已经被服务端渲染标记的节点上调用 <a href="./react-dom-client.html#hydrateroot"><code>ReactDOM.hydrateRoot()</code></a>，React 会保留它，只为其附加事件处理程序。让你拥有一个非常良好的首次加载体验。<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> didError <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> stream <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">renderToReadableStream</span><span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>html<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>body<span class="token operator">></span><span class="token maybe-class-name">Success</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>body<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>html<span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span><span class="token property-access">signal</span><span class="token punctuation">,</span>
      <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        didError <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// This is to wait for all Suspense boundaries to be ready. You can uncomment</span>
  <span class="token comment">// this line if you want to buffer the entire HTML instead of streaming it.</span>
  <span class="token comment">// You can use this for crawlers or static generation:</span>

  <span class="token comment">// await stream.allReady;</span>

  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">status</span><span class="token operator">:</span> didError <span class="token operator">?</span> <span class="token number">500</span> <span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/html'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>
    <span class="token string">'&#x3C;!doctype html>&#x3C;p>Loading...&#x3C;/p>&#x3C;script src="clientrender.js">&#x3C;/script>'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
      <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/html'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>具体参见 <a href="https://github.com/facebook/react/blob/14c2be8dac2d5482fda8a0906a31d239df8551fc/packages/react-dom/src/server/ReactDOMFizzServerBrowser.js#L27-L35">完整的选项列表</a>。<blockquote><p>注意：<p>该 API 依赖 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Streams_API">Web Streams</a>。对于，请使用 <a href="#rendertopipeablestream"><code>renderToPipeableStream</code></a> 代替。</blockquote><hr></section><section id="rendertonodestream"class="level3"><h3><code>renderToNodeStream()</code> (Deprecated)</h3><blockquote><p>Try the new React documentation for <a href="https://beta.reactjs.org/reference/react-dom/server/renderToNodeStream"><code>renderToNodeStream</code></a>.<p>The new docs will soon replace this site, which will be archived. <a href="https://github.com/reactjs/reactjs.org/issues/3308">Provide feedback.</a></blockquote><pre class="language-javascript"><code class="language-javascript"><span class="token maybe-class-name">ReactDOMServer</span><span class="token punctuation">.</span><span class="token method function property-access">renderToNodeStream</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span></code></pre><p>将一个 React 元素渲染成其初始 HTML。返回一个可输出 HTML 字符串的 <a href="https://nodejs.org/api/stream.html#stream_readable_streams">Node.js 可读流</a>。通过可读流输出的 HTML 完全等同于 <a href="#rendertostring"><code>ReactDOMServer.renderToString</code></a> 返回的 HTML。你可以使用本方法在服务器上生成 HTML，并在初始请求时将标记下发，以加快页面加载速度，并允许搜索引擎抓取你的页面以达到 SEO 优化的目的。<p>如果你在已有服务端渲染标记的节点上调用 <a href="./react-dom-client.html#hydrateroot"><code>ReactDOM.hydrateRoot()</code></a> 方法，React 将会保留该节点且只进行事件处理绑定，从而让你有一个非常高性能的首次加载体验。<blockquote><p>注意:<p>这个 API 仅允许在服务端使用。不允许在浏览器使用。<p>通过本方法返回的流会返回一个由 utf-8 编码的字节流。如果你需要另一种编码的流，请查看像 <a href="https://www.npmjs.com/package/iconv-lite">iconv-lite</a> 这样的项目，它为转换文本提供了转换流。</blockquote><hr></section><section id="rendertostaticnodestream-rendertostaticnodestream"class="level3"><h3><code>renderToStaticNodeStream()</code> {#rendertostaticnodestream}</h3><blockquote><p>Try the new React documentation for <a href="https://beta.reactjs.org/reference/react-dom/server/renderToStaticNodeStream"><code>renderToStaticNodeStream</code></a>.<p>The new docs will soon replace this site, which will be archived. <a href="https://github.com/reactjs/reactjs.org/issues/3308">Provide feedback.</a></blockquote><pre class="language-javascript"><code class="language-javascript"><span class="token maybe-class-name">ReactDOMServer</span><span class="token punctuation">.</span><span class="token method function property-access">renderToStaticNodeStream</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span></code></pre><p>此方法与 <a href="#rendertonodestream"><code>renderToNodeStream</code></a> 相似，但此方法不会在 React 内部创建的额外 DOM 属性，例如 <code>data-reactroot</code>。如果你希望把 React 当作静态页面生成器来使用，此方法会非常有用，因为去除额外的属性可以节省一些字节。<p>通过可读流输出的 HTML，完全等同于 <a href="#rendertostaticmarkup"><code>ReactDOMServer.renderToStaticMarkup</code></a> 返回的 HTML。<p>如果你计划在前端使用 React 以使得标记可交互，请不要使用此方法。你可以在服务端上使用 <a href="#rendertonodestream"><code>renderToNodeStream</code></a> 或在前端上使用 <a href="./react-dom-client.html#hydrateroot"><code>ReactDOM.hydrateRoot()</code></a> 来代替此方法。<blockquote><p>注意:<p>此 API 仅限于服务端使用，在浏览器中是不可用的。<p>通过本方法返回的流会返回一个由 utf-8 编码的字节流。如果你需要另一种编码的流，请查看像 <a href="https://www.npmjs.com/package/iconv-lite">iconv-lite</a> 这样的项目，它为转换文本提供了转换流。</blockquote><hr></section><section id="rendertostring-rendertostring"class="level3"><h3><code>renderToString()</code> {#rendertostring}</h3><blockquote><p>Try the new React documentation for <a href="https://beta.reactjs.org/reference/react-dom/server/renderToString"><code>renderToString</code></a>.<p>The new docs will soon replace this site, which will be archived. <a href="https://github.com/reactjs/reactjs.org/issues/3308">Provide feedback.</a></blockquote><pre class="language-javascript"><code class="language-javascript"><span class="token maybe-class-name">ReactDOMServer</span><span class="token punctuation">.</span><span class="token method function property-access">renderToString</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span></code></pre><p>将一个 React 元素渲染成其初始的 HTML。React 将返回一个 HTML 字符串。你可以使用这种方法在服务器上生产 HTML，并在初始请求中发送标记。以加快页面加载速度，并允许搜索引擎以 SEO 为目的抓取你的页面。<p>如果你在一个已被服务端渲染标记的节点上调用 <a href="./react-dom-client.html#hydrateroot"><code>ReactDOM.hydrateRoot()</code></a>，React 会保留它，只附加事件处理程序，让你有一个非常良好的首次加载体验。<blockquote><p>注意：<p>此 API 对 Suspense 支持有限，并且不支持流。<p>在服务端，建议使用 <a href="#rendertopipeablestream"><code>renderToPipeableStream</code></a> (Node.js) 或者 <a href="#rendertoreadablestream"><code>renderToReadableStream</code></a> (for Web Streams) 代替。</blockquote><hr></section><section id="rendertostaticmarkup-rendertostaticmarkup"class="level3"><h3><code>renderToStaticMarkup()</code> {#rendertostaticmarkup}</h3><blockquote><p>Try the new React documentation for <a href="https://beta.reactjs.org/reference/react-dom/server/renderToStaticMarkup"><code>renderToStaticMarkup</code></a>.<p>The new docs will soon replace this site, which will be archived. <a href="https://github.com/reactjs/reactjs.org/issues/3308">Provide feedback.</a></blockquote><pre class="language-javascript"><code class="language-javascript"><span class="token maybe-class-name">ReactDOMServer</span><span class="token punctuation">.</span><span class="token method function property-access">renderToStaticMarkup</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span></code></pre><p>与 <a href="#rendertostring"><code>renderToString</code></a> 相似，只是该方法不会创建 React 内部使用的额外 DOM 属性，如 <code>data-reactroot</code>。如果你只想把 React 作为简单的静态页面生成器使用，此方法会非常实用。因为剥离多余的属性可以节省一些字节占用。<p>如果你打算在客户端使用 React 进行交互标记，那请不要使用这个方法。作为替代，你可以在服务器使用 <a href="#rendertostring"><code>renderToString</code></a>，同时在客户端使用 <a href="./react-dom-client.html#hydrateroot"><code>ReactDOM.hydrateRoot()</code></a>。 <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section></section>