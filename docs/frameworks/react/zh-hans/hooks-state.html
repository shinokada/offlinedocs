<!doctypehtml><html lang="zh-hans"><meta charset="utf-8"><title>使用 State Hook</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css"><section id="使用-state-hook"class="level1"><h1>使用 State Hook</h1><p><em>Hook</em> 是 React 16.8 的新增特性。它可以让你在不编写 class 的情况下使用 state 以及其他的 React 特性。<p><a href="./hooks-intro.html">Hook 简介章节</a>中使用下面的例子介绍了 Hook：<pre class="language-js{4-5}"><code class="language-js{4-5}">import React, { useState } from 'react';

function Example() {
  // 声明一个叫 "count" 的 state 变量
  const [count, setCount] = useState(0);

  return (
    &#x3C;div>
      &#x3C;p>You clicked {count} times&#x3C;/p>
      &#x3C;button onClick={() => setCount(count + 1)}>
        Click me
      &#x3C;/button>
    &#x3C;/div>
  );
}</code></pre><p>我们将通过将这段代码与一个等价的 class 示例进行比较来开始学习 Hook。<section id="equivalent-class-example"class="level2"><h2>等价的 class 示例</h2><p>如果你之前在 React 中使用过 class，这段代码看起来应该很熟悉：<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">You</span> clicked <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">}</span> times<span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Click</span> me
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>state 初始值为 <code>{ count: 0 }</code> ，当用户点击按钮后，我们通过调用 <code>this.setState()</code> 来增加 <code>state.count</code>。整个章节中都将使用该 class 的代码片段做示例。<blockquote><p>注意<p>你可能想知道为什么我们在这里使用一个计数器例子而不是一个更实际的示例。因为我们还只是初步接触 Hook ，这可以帮助我们将注意力集中到 API 本身。</blockquote></section><section id="hooks-and-function-components"class="level2"><h2>Hook 和函数组件</h2><p>复习一下， React 的函数组件是这样的：<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function"><span class="token maybe-class-name">Example</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 你可以在这使用 Hook</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>div <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>或是这样：<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Example</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 你可以在这使用 Hook</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>div <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>你之前可能把它们叫做“无状态组件”。但现在我们为它们引入了使用 React state 的能力，所以我们更喜欢叫它"函数组件"。<p>Hook 在 class 内部是<strong>不</strong>起作用的。但你可以使用它们来取代 class 。</section><section id="whats-a-hook"class="level2"><h2>Hook 是什么？</h2><p>在新示例中，首先引入 React 中 <code>useState</code> 的 Hook<pre class="language-js{1}"><code class="language-js{1}">import React, { useState } from 'react';

function Example() {
  // ...
}</code></pre><p><strong>Hook 是什么？</strong> Hook 是一个特殊的函数，它可以让你“钩入” React 的特性。例如，<code>useState</code> 是允许你在 React 函数组件中添加 state 的 Hook。稍后我们将学习其他 Hook。<p><strong>什么时候我会用 Hook？</strong> 如果你在编写函数组件并意识到需要向其添加一些 state，以前的做法是必须将其转化为 class。现在你可以在现有的函数组件中使用 Hook。<blockquote><p>注意：<p>在组件中有些特殊的规则，规定什么地方能使用 Hook，什么地方不能使用。我们将在 <a href="./hooks-rules.html">Hook 规则</a>中学习它们。</blockquote></section><section id="declaring-a-state-variable"class="level2"><h2>声明 State 变量</h2><p>在 class 中，我们通过在构造函数中设置 <code>this.state</code> 为 <code>{ count: 0 }</code> 来初始化 <code>count</code> state 为 <code>0</code>：<pre class="language-js{4-6}"><code class="language-js{4-6}">class Example extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      count: 0
    };
  }</code></pre><p>在函数组件中，我们没有 <code>this</code>，所以我们不能分配或读取 <code>this.state</code>。我们直接在组件中调用 <code>useState</code> Hook：<pre class="language-js{4,5}"><code class="language-js{4,5}">import React, { useState } from 'react';

function Example() {
  // 声明一个叫 “count” 的 state 变量
  const [count, setCount] = useState(0);</code></pre><p><strong><code>调用 useState</code> 方法的时候做了什么?</strong> 它定义一个 “state 变量”。我们的变量叫 <code>count</code>， 但是我们可以叫他任何名字，比如 <code>banana</code>。这是一种在函数调用时保存变量的方式 —— <code>useState</code> 是一种新方法，它与 class 里面的 <code>this.state</code> 提供的功能完全相同。一般来说，在函数退出后变量就会"消失"，而 state 中的变量会被 React 保留。<p><strong><code>useState</code> 需要哪些参数？</strong> <code>useState()</code> 方法里面唯一的参数就是初始 state。不同于 class 的是，我们可以按照需要使用数字或字符串对其进行赋值，而不一定是对象。在示例中，只需使用数字来记录用户点击次数，所以我们传了 <code>0</code> 作为变量的初始 state。（如果我们想要在 state 中存储两个不同的变量，只需调用 <code>useState()</code> 两次即可。）<p><strong><code>useState</code> 方法的返回值是什么？</strong> 返回值为：当前 state 以及更新 state 的函数。这就是我们写 <code>const [count, setCount] = useState()</code> 的原因。这与 class 里面 <code>this.state.count</code> 和 <code>this.setState</code> 类似，唯一区别就是你需要成对的获取它们。如果你不熟悉我们使用的语法，我们会在<a href="./hooks-state.html#tip-what-do-square-brackets-mean">本章节的底部</a>介绍它。<p>既然我们知道了 <code>useState</code> 的作用，我们的示例应该更容易理解了：<pre class="language-js{4,5}"><code class="language-js{4,5}">import React, { useState } from 'react';

function Example() {
  // 声明一个叫 "count" 的 state 变量
  const [count, setCount] = useState(0);</code></pre><p>我们声明了一个叫 <code>count</code> 的 state 变量，然后把它设为 <code>0</code>。React 会在重复渲染时记住它当前的值，并且提供最新的值给我们的函数。我们可以通过调用 <code>setCount</code> 来更新当前的 <code>count</code>。<blockquote><p>注意<p>你可能想知道：为什么叫 <code>useState</code> 而不叫 <code>createState</code>?<p>"Create" 可能不是很准确，因为 state 只在组件首次渲染的时候被创建。在下一次重新渲染时，<code>useState</code> 返回给我们当前的 state。否则它就不是 “state”了！这也是 Hook 的名字<em>总是</em>以 <code>use</code> 开头的一个原因。我们将在后面的 <a href="./hooks-rules.html">Hook 规则</a>中了解原因。</blockquote></section><section id="reading-state"class="level2"><h2>读取 State</h2><p>当我们想在 class 中显示当前的 count，我们读取 <code>this.state.count</code>：<pre class="language-js"><code class="language-js">  <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">You</span> clicked <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">}</span> times<span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span></code></pre><p>在函数中，我们可以直接用 <code>count</code>:<pre class="language-js"><code class="language-js">  <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">You</span> clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times<span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span></code></pre></section><section id="updating-state"class="level2"><h2>更新 State</h2><p>在 class 中，我们需要调用 <code>this.setState()</code> 来更新 <code>count</code> 值：<pre class="language-js{1}"><code class="language-js{1}">  &#x3C;button onClick={() => this.setState({ count: this.state.count + 1 })}>
    Click me
  &#x3C;/button></code></pre><p>在函数中，我们已经有了 <code>setCount</code> 和 <code>count</code> 变量，所以我们不需要 <code>this</code>:<pre class="language-js{1}"><code class="language-js{1}">  &#x3C;button onClick={() => setCount(count + 1)}>
    Click me
  &#x3C;/button></code></pre></section><section id="recap"class="level2"><h2>总结</h2><p>现在让我们来<strong>仔细回顾一下学到的知识</strong>，看下我们是否真正理解了。<pre class="language-js{1,4,9}"><code class="language-js{1,4,9}"> 1:  import React, { useState } from 'react';
 2:
 3:  function Example() {
 4:    const [count, setCount] = useState(0);
 5:
 6:    return (
 7:      &#x3C;div>
 8:        &#x3C;p>You clicked {count} times&#x3C;/p>
 9:        &#x3C;button onClick={() => setCount(count + 1)}>
10:         Click me
11:        &#x3C;/button>
12:      &#x3C;/div>
13:    );
14:  }</code></pre><ul><li><strong>第一行:</strong> 引入 React 中的 <code>useState</code> Hook。它让我们在函数组件中存储内部 state。<li><strong>第四行:</strong> 在 <code>Example</code> 组件内部，我们通过调用 <code>useState</code> Hook 声明了一个新的 state 变量。它返回一对值给到我们命名的变量上。我们把变量命名为 <code>count</code>，因为它存储的是点击次数。我们通过传 <code>0</code> 作为 <code>useState</code> 唯一的参数来将其初始化为 <code>0</code>。第二个返回的值本身就是一个函数。它让我们可以更新 <code>count</code> 的值，所以我们叫它 <code>setCount</code>。<li><strong>第九行:</strong> 当用户点击按钮后，我们传递一个新的值给 <code>setCount</code>。React 会重新渲染 <code>Example</code> 组件，并把最新的 <code>count</code> 传给它。</ul><p>乍一看这似乎有点太多了。不要急于求成！如果你有不理解的地方，请再次查看以上代码并从头到尾阅读。我们保证一旦你试着"忘记" class 里面 state 是如何工作的，并用新的眼光看这段代码，就容易理解了。<section id="tip-what-do-square-brackets-mean"class="level3"><h3>提示：方括号有什么用？</h3><p>你可能注意到我们用方括号定义了一个 state 变量<pre class="language-js"><code class="language-js">  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>等号左边名字并不是 React API 的部分，你可以自己取名字：<pre class="language-js"><code class="language-js">  <span class="token keyword">const</span> <span class="token punctuation">[</span>fruit<span class="token punctuation">,</span> setFruit<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'banana'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>这种 JavaScript 语法叫<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Array_destructuring">数组解构</a>。它意味着我们同时创建了 <code>fruit</code> 和 <code>setFruit</code> 两个变量，<code>fruit</code> 的值为 <code>useState</code> 返回的第一个值，<code>setFruit</code> 是返回的第二个值。它等价于下面的代码：<pre class="language-js"><code class="language-js">  <span class="token keyword">var</span> fruitStateVariable <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'banana'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回一个有两个元素的数组</span>
  <span class="token keyword">var</span> fruit <span class="token operator">=</span> fruitStateVariable<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 数组里的第一个值</span>
  <span class="token keyword">var</span> setFruit <span class="token operator">=</span> fruitStateVariable<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 数组里的第二个值</span></code></pre><p>当我们使用 <code>useState</code> 定义 state 变量时候，它返回一个有两个值的数组。第一个值是当前的 state，第二个值是更新 state 的函数。使用 <code>[0]</code> 和 <code>[1]</code> 来访问有点令人困惑，因为它们有特定的含义。这就是我们使用数组解构的原因。<blockquote><p>注意<p>你可能会好奇 React 怎么知道 <code>useState</code> 对应的是哪个组件，因为我们并没有传递 <code>this</code> 给 React。我们将在 FAQ 部分回答<a href="./hooks-faq.html#how-does-react-associate-hook-calls-with-components">这个问题</a>以及许多其他问题。</blockquote></section><section id="tip-using-multiple-state-variables"class="level3"><h3>提示：使用多个 state 变量</h3><p>将 state 变量声明为一对 <code>[something, setSomething]</code> 也很方便，因为如果我们想使用多个 state 变量，它允许我们给不同的 state 变量取不同的名称：<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ExampleWithManyStates</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 声明多个 state 变量</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>age<span class="token punctuation">,</span> setAge<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>fruit<span class="token punctuation">,</span> setFruit<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'banana'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> setTodos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'学习 Hook'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在以上组件中，我们有局部变量 <code>age</code>，<code>fruit</code> 和 <code>todos</code>，并且我们可以单独更新它们：<pre class="language-js"><code class="language-js">  <span class="token keyword">function</span> <span class="token function">handleOrangeClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 和 this.setState({ fruit: 'orange' }) 类似</span>
    <span class="token function">setFruit</span><span class="token punctuation">(</span><span class="token string">'orange'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre><p>你<strong>不必</strong>使用多个 state 变量。State 变量可以很好地存储对象和数组，因此，你仍然可以将相关数据分为一组。然而，不像 class 中的 <code>this.setState</code>，更新 state 变量总是<em>替换</em>它而不是合并它。<p>我们<a href="./hooks-faq.html#should-i-use-one-or-many-state-variables">在 FAQ 中</a>提供了更多关于分离独立 state 变量的建议。</section></section><section id="next-steps"class="level2"><h2>下一步</h2><p>从上述内容中，我们了解了 React 提供的 <code>useState</code> Hook，有时候我们也叫它 “State Hook”。它让我们在 React 函数组件上添加内部 state —— 这是我们首次尝试。<p>我们还学到了一些知识比如什么是 Hook。Hook 是能让你在函数组件中“钩入” React 特性的函数。它们名字通常都以 <code>use</code> 开始，还有更多 Hook 等着我们去探索。<p><strong>现在我们将<a href="./hooks-effect.html">学习另一个 Hook: <code>useEffect</code></a>。</strong> 它能在函数组件中执行副作用，并且它与 class 中的生命周期函数极为类似。 <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>