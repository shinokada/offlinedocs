<!doctypehtml><html lang="de"><meta charset="utf-8"><title>Performance-Optimierung</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css"><section id="performance-optimierung"class="level1"><h1>Performance-Optimierung</h1><p>Intern verwendet React mehrere clevere Techniken, um die Anzahl kostspieliger DOM-Vorgänge zu minimieren, die nötig sind, um die Benutzeroberfläche zu aktualisieren. Für viele Anwendungen führt React zu einer schnellen Benutzeroberfläche, ohne dass die Performance mit viel Aufwand optimiert werden muss. Trotzdem gibt es mehrere Möglichkeiten, wie du deine React-Anwendung noch schneller machen kannst.<section id="use-the-production-build"class="level2"><h2>Benutze den Produktions-Build</h2><p>Falls du Benchmarking betreibst oder Performance-Probleme in deinen React-Apps feststellst, stelle sicher, dass du sie mit dem minifizierten Produktions-Build testest.<p>Standardmäßig enthält React viele hilfreiche Warnungen. Diese Warnungen sind während des Entwickelns sehr nützlich. Allerdings machen sie React größer und langsamer, weshalb du beim Deployen darauf achten solltest, die Produktions-Version zu verwenden.<p>Falls du nicht sicher bist, ob dein Build-Prozess korrekt eingerichtet ist, kannst du ihn überprüfen, indem du die <a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi">React Developer Tools für Chrome</a> installierst. Wenn du eine Seite mit React im Produktions-Modus besuchst, hat das Icon einen dunklen Hintergrund:</p><img src="./docs/devtools-prod.png"style="max-width:100%"alt="React DevTools auf einer Webseite mit React im Produktions-Modus"><p>Wenn du eine Seite mit React im Entwickler-Modus besuchst, hat das Icon einen roten Hintergrund:</p><img src="./docs/devtools-dev.png"style="max-width:100%"alt="React DevTools auf einer Webseite mit React im Entwickler-Modus"><p>Der Entwickler-Modus sollte benutzt werden, während du an der App arbeitest, und der Produktions-Modus, wenn du die Webseite deployst.<p>Weiter unten findest du eine Anleitung, wie du die Produktions-Version deiner App erstellst.<section id="create-react-app"class="level3"><h3>Create React App</h3><p>Falls dein Projekt mit <a href="https://github.com/facebookincubator/create-react-app">Create React App</a> erstellt wurde, führe Folgendes aus:<pre class="language-text"><code class="language-text">npm run build</code></pre><p>Damit wird im <code>build/</code>-Ordner deines Projekts ein Produktions-Build deiner App erstellt.<p>Denke daran, dass das nur erforderlich ist, bevor du deine App deployst. Zum normalen Entwickeln benutze <code>npm start</code>.</section><section id="single-file-builds"class="level3"><h3>Einzeldatei-Builds</h3><p>Wir bieten produktionsfertige Versionen von React und React DOM als Einzeldateien an:<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://unpkg.com/react@18/umd/react.production.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://unpkg.com/react-dom@18/umd/react-dom.production.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>Denke daran, dass nur React-Dateien, die mit <code>.production.min.js</code> enden, für die Produktionsumgebung geeignet sind.</section><section id="brunch"class="level3"><h3>Brunch</h3><p>Um den effizientesten Brunch-Produktions-Build zu bekommen, installiere das <a href="https://github.com/brunch/terser-brunch"><code>terser-brunch</code></a>-Plugin:<pre class="language-bash"><code class="language-bash"><span class="token comment"># Falls du npm verwendest</span>
<span class="token function">npm</span> <span class="token function">install</span> --save-dev terser-brunch

<span class="token comment"># Falls du Yarn verwendest</span>
<span class="token function">yarn</span> <span class="token function">add</span> --dev terser-brunch</code></pre><p>Um dann einen Produktions-Build zu erstellen, füge zum <code>build</code>-Befehl das <code>-p</code>-Flag hinzu:<pre class="language-text"><code class="language-text">brunch build -p</code></pre><p>Denke daran, dass du das nur für die Produktionsumgebung machen musst. Du solltest das <code>-p</code>-Flag oder dieses Plugin nicht während der Entwicklung verwenden, da sie nützliche React-Warnungen verbergen und die Builds viel langsamer machen.</section><section id="browserify"class="level3"><h3>Browserify</h3><p>Um den effizientesten Browserify-Produktions-Build zu bekommen, installiere ein paar Plugins:<pre class="language-text"><code class="language-text"># Falls du npm verwendest
npm install --save-dev envify terser uglifyify 

# Falls du Yarn verwendest
yarn add --dev envify terser uglifyify </code></pre><p>Um einen Produktions-Build zu erstellen, stelle sicher, dass du diese Transformer hinzufügst <strong>(die Reihenfolge ist wichtig)</strong>:<ul><li>Der <a href="https://github.com/hughsk/envify"><code>envify</code></a>-Transformer stellt sicher, dass die richtige Build-Umgebung gesetzt wird. Benutze ihn global (<code>-g</code>).<li>Der <a href="https://github.com/hughsk/uglifyify"><code>uglifyify</code></a>-Transformer entfernt Entwickler-Importe. Benutze auch ihn global (<code>-g</code>).<li>Schließlich wird das so entstandene Bundle an <a href="https://github.com/terser-js/terser"><code>terser</code></a> geleitet, wo es "gemangled" wird (<a href="https://github.com/hughsk/uglifyify#motivationusage">lies warum</a>).</ul><p>Zum Beispiel:<pre class="language-text"><code class="language-text">browserify ./index.js \
  -g [ envify --NODE_ENV production ] \
  -g uglifyify \
  | terser --compress --mangle > ./bundle.js</code></pre><p>Denke daran, dass du das nur für die Produktionsumgebung machen musst. Du solltest diese Plugins nicht während der Entwicklung verwenden, da sie nützliche React-Warnungen verbergen und die Builds viel langsamer machen.</section><section id="rollup"class="level3"><h3>Rollup</h3><p>Um den effizientesten Rollup-Produktions-Build zu bekommen, installiere ein paar Plugins:<pre class="language-bash"><code class="language-bash"><span class="token comment"># Falls du npm benutzt</span>
<span class="token function">npm</span> <span class="token function">install</span> --save-dev rollup-plugin-commonjs rollup-plugin-replace rollup-plugin-terser

<span class="token comment"># Falls du Yarn benutzt</span>
<span class="token function">yarn</span> <span class="token function">add</span> --dev rollup-plugin-commonjs rollup-plugin-replace rollup-plugin-terser</code></pre><p>Um einen Produktions-Build zu kreieren, stelle sicher, dass du diese Plugins hinzufügst <strong>(die Reihenfolge ist wichtig)</strong>:<ul><li>Das <a href="https://github.com/rollup/rollup-plugin-replace"><code>replace</code></a>-Plugin stellt sicher, dass die richtige Build-Umgebung gesetzt wird.<li>Das <a href="https://github.com/rollup/rollup-plugin-commonjs"><code>commonjs</code></a>-Plugin bietet CommonJS-Unterstützung in Rollup.<li>Das [<code>terser</code>](<a href="https://github.com/TrySound/rollup-plugin-terser-Plugin">https://github.com/TrySound/rollup-plugin-terser-Plugin</a> komprimiert und "mangled" das finale Bundle.</ul><pre class="language-js"><code class="language-js"><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token comment">// ...</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rollup-plugin-replace'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string-property property">'process.env.NODE_ENV'</span><span class="token operator">:</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token string">'production'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rollup-plugin-commonjs'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rollup-plugin-terser'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">]</span></code></pre><p>Siehe dir ein komplettes Setup-Beispiel <a href="https://gist.github.com/Rich-Harris/cb14f4bc0670c47d00d191565be36bf0">in diesem Gist</a> an.<p>Denke daran, dass du das nur für die Produktionsumgebung machen musst. Du solltest das <code>terser</code>-Plugin oder das <code>replace</code>-Plugin mit <code>'production'</code> nicht während der Entwicklung verwenden, da sie nützliche React-Warnungen verbergen und die Builds viel langsamer machen.</section><section id="webpack"class="level3"><h3>webpack</h3><blockquote><p><strong>Hinweis:</strong><p>Falls du Create React App verwendest, folge bitte den <a href="#create-react-app">Anweisungen weiter oben</a>.<br>Dieser Abschnitt ist nur relevant, wenn du webpack direkt konfigurierst.</blockquote><p>Webpack v4+ minified deinen Code standardmäßig im <code>production</code>-Modus.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token maybe-class-name">TerserPlugin</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">minimizer</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">/* additional options here */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>Mehr Informationen darüber findest du in der <a href="https://webpack.js.org/guides/production/">webpack-Dokumentation</a>.<p>Denke daran, dass du das nur für die Produktionsumgebung machen musst. Du solltest <code>TerserPlugin</code> nicht während der Entwicklung verwenden, da es nützliche React-Warnungen verbergen wird und die Builds viel langsamer macht.</section></section><section id="profiling-components-with-the-devtools-profiler"class="level2"><h2>Komponenten-Profiling mit dem DevTools-Profiler</h2><p><code>react-dom</code> 16.5+ und <code>react-native</code> 0.57+ bieten erweiterte Profiling-Funktionen im DEV-Modus mit dem React DevTools-Profiler. Eine Übersicht über den Profiler gibt es im Blog-Post <a href="/blog/2018/09/10/introducing-the-react-profiler.html">"Vorstellung des React Profilers"</a>. Es gibt auch eine Video-Anleitung zum Profiler <a href="https://www.youtube.com/watch?v=nySib7ipZdk">auf YouTube</a>.<p>Falls du die React DevTools noch nicht installiert hast, kannst du sie hier finden:<ul><li><a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=en">Chrome Browser-Erweiterung</a><li><a href="https://addons.mozilla.org/en-GB/firefox/addon/react-devtools/">Firefox Browser-Erweiterung</a><li><a href="https://www.npmjs.com/package/react-devtools">Eigenständiges Node-Package</a></ul><blockquote><p>Hinweis<p>Ein Produktions-Profiling-Bundle von <code>react-dom</code> ist auch als <code>react-dom/profiling</code> verfügbar. Lese mehr über die Verwendung dieses Bundles auf <a href="https://fb.me/react-profiling">fb.me/react-profiling</a>.</blockquote><blockquote><p>Note<p>Before React 17, we use the standard <a href="https://developer.mozilla.org/en-US/docs/Web/API/User_Timing_API">User Timing API</a> to profile components with the chrome performance tab. For a more detailed walkthrough, check out <a href="https://calibreapp.com/blog/react-performance-profiling-optimization">this article by Ben Schwarz</a>.</blockquote></section><section id="virtualize-long-lists"class="level2"><h2>Virtualisieren von langen Listen</h2><p>Falls deine Anwendung lange Datenlisten (mit Hunderten oder Tausenden von Zeilen) rendert, empfehlen die Verwendung einer Technik, die als "Windowing" bekannt ist. Diese Technik rendert zu jedem Zeitpunkt nur eine kleine Teilmenge deiner Zeilen. Dadurch kannst du sowohl die Zeit, die benötigt wird, um die Komponenten erneut zu rendern, als auch die Anzahl der erstellten DOM-Knoten drastisch reduzieren.<p><a href="https://react-window.now.sh/">react-window</a> und <a href="https://bvaughn.github.io/react-virtualized/">react-virtualized</a> sind beliebte Windowing-Bibliotheken. Sie bieten eine Anzahl an wiederverwendbaren Komonenten, um Listen, Grids und Datentabellen anzuzeigen. Falls du etwas möchtest, das spezifischer auf deine Anwendung zugeschnitten ist, kannst du auch deine eigene Windowing-Komponente erstellen, wie <a href="https://medium.com/@paularmstrong/twitter-lite-and-high-performance-react-progressive-web-apps-at-scale-d28a00e780a3">Twitter es getan hat</a>.</section><section id="avoid-reconciliation"class="level2"><h2>Abgleiche vermeiden</h2><p>React baut und pflegt eine interne Repräsentation der gerenderten Benutzeroberfläche. Sie beinhaltet die React-Elemente, die deine Komponenten zurückgeben. Diese Repräsentation erlaubt es React, zu vermeiden, neue DOM-Knoten zu erstellen oder auf bereits existierende zuzugreifen, wenn dies nicht nötig ist, da dies langsamer sein kann als Operationen an JavaScript-Objekten. Man spricht manchmal vom "virtuellen DOM", aber in React Native funktioniert es auf die gleiche Weise.<p>Wenn Props oder State einer Komponente sich verändern, entscheidet React, ob ein tatsächliches DOM-Update nötig ist, indem es das neu ausgegebene Element mit dem zuvor gerenderten abgleicht. Wenn sie unterschiedlich sind, aktualisiert React das DOM.<p>Obwohl React nur DOM-Knoten aktualisiert, die sich verändert haben, braucht das erneute Rendern etwas Zeit. In vielen Fällen ist das kein Problem, doch wenn die Verlangsamung sich bemerkbar macht, kannst du den Prozess beschleunigen, indem du die Lifecycle-Funktion <code>shouldComponentUpdate</code>, die vor jedem erneuten Rendern ausgelöst wird, überschreibst. Die Standard-Implementierung dieser Funktion gibt <code>true</code> zurück und lässt React somit das Update durchführen:<pre class="language-javascript"><code class="language-javascript"><span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Wenn du weißt, dass deine Komponente in manchen Fällen kein Update benötigt, kannst du stattdessen <code>false</code> von <code>shouldComponentUpdate</code> zurückgeben lassen, um den kompletten Rendering-Prozess zu überspringen, einschließlich des Aufrufs der <code>render()</code>-Funktion auf diese und die darunterliegenden Komponenten.<p>In den meisten Fällen kannst du <a href="./react-api.html#reactpurecomponent"><code>React.PureComponent</code></a> verwenden, statt <code>shouldComponentUpdate()</code> von Hand zu schreiben. Es ist äquivalent zur Implementierung von <code>shouldComponentUpdate()</code> mit einem flachen Vergleich von alten und neuen Props und State.</section><section id="shouldcomponentupdate-in-action"class="level2"><h2>shouldComponentUpdate in Aktion</h2><p>Hier ist ein Teilbaum von Komponenten. Für jede Komponente gibt <code>SCU</code> an, was <code>shouldComponentUpdate</code> zurückgegeben hat, und <code>vDOMEq</code> gibt an, ob die gerenderten React-Elemente übereinstimmen. Die Farbe des Kreises zeigt schließlich, ob eine Komponente abgeglichen werden musste oder nicht.<figure><img src="./docs/should-component-update.png"style="max-width:100%"></figure><p>Da <code>shouldComponentUpdate</code> für den von C2 ausgehenden Teilbaum <code>false</code> zurückgegeben hat, hat React nicht versucht, C2 zu rendern, und musste somit für C4 und C5 nicht einmal <code>shouldComponentUpdate</code> aufrufen.<p>Für C1 und C3 hat <code>shouldComponentUpdate</code> <code>true</code> zurückgegeben, wodurch React zu den Blättern weiterwandern musste, um diese zu überprüfen. Für C6 hat <code>shouldComponentUpdate</code> <code>true</code> zurückgegeben, und da die gerenderten Elemente nicht übereinstimmten, musste React das DOM updaten.<p>Der letze interessante Fall ist C8. React musste diese Komponente rendern, aber da die zurückgegebenen React-Elemente keinen Unterschied zu den zuvor gerenderten hatte, musste es das DOM nicht updaten.<p>Beachte, dass React nur für C6 das DOM verändern musste, was unvermeidlich war. C8 war nach dem Vergleich der gerenderten React-Elemente abgehakt, und für C7 sowie den Teilbaum von C2 musste nicht einmal ein Vergleich stattfinden, da der Prozess hier schon nach <code>shouldComponentUpdate</code> abgehakt war und somit <code>render</code> nicht aufgerufen werden musste.</section><section id="examples"class="level2"><h2>Beispiele</h2><p>Wenn deine Komponente sich ausschließlich dann verändert, wenn die <code>props.color</code>- oder die <code>state.count</code>-Variable sich verändert, sollte <code>shouldComponentUpdate</code> dies überprüfen:<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">CounterButton</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">color</span> <span class="token operator">!==</span> nextProps<span class="token punctuation">.</span><span class="token property-access">color</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">!==</span> nextState<span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>button
        color<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">color</span><span class="token punctuation">}</span>
        onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token literal-property property">Count</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>In diesem Code überprüft <code>shouldComponentUpdate</code> lediglich, ob es eine Veränderung in <code>props.color</code> oder <code>state.count</code> gegeben hat. Wenn diese Werte sich nicht verändern, wird die Komponente nicht aktualisiert. Für den Fall, dass deine Komponente komplexer wird, könntest du ein ähnliches Muster verwenden, indem du einen "flachen Vergleich" zwischen allen Feldern von <code>props</code> und <code>state</code> machst, um festzustellen, ob die Komponente aktualisiert werden soll. Dieses Muster ist häufig genug, dass React einen Helfer zur Verfügung stellt, um diese Logik zu verwenden - durch Vererbung von <code>React.PureComponent</code>. Dieser Code ist ein einfacherer Weg, dasselbe zu erreichen:<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">CounterButton</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>button
        color<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">color</span><span class="token punctuation">}</span>
        onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token literal-property property">Count</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>In den meisten Fällen kannst du <code>React.PureComponent</code> verwenden, statt dein eigenes <code>shouldComponentUpdate</code> zu schreiben. Es führt nur einen flachen Vergleich durch, also kannst du <code>React.PureComponent</code> nicht benutzen, wenn Props oder State sich auf eine Weise verändert haben, die ein flacher Vergleich übersehen würde.<p>Das kann bei komplexen Datenstrukturen ein Problem sein. Lass uns z. B. sagen, du möchtest eine <code>ListOfWords</code>-Komponente, die eine komma-separierte Wörterliste rendert, mit einer Eltern-<code>WorldAdder</code>-Komponente, die dich einen Button klicken lässt, um ein Wort zur Liste zu addieren. Dieser Code funktioniert <strong>nicht</strong> korrekt:<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">ListOfWords</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">words</span><span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">WordAdder</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">words</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'marklar'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleClick</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">handleClick</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Dieser Abschnitt hat einen schlechten Stil und ruft einen Bug hervor</span>
    <span class="token keyword">const</span> words <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">words</span><span class="token punctuation">;</span>
    words<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token string">'marklar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">words</span><span class="token operator">:</span> words<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleClick</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ListOfWords</span> words<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">words</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Das Problem ist, dass <code>PureComponent</code> einen einfachen Vergleich zwischen den alten und neuen Werten von <code>this.props.words</code> durchführt. Da dieser Code das <code>words</code>-Array in der <code>handleClick</code>-Methode von <code>WordAdder</code> mutiert, wird ein Vergleich der alten und neuen Werte von <code>this.props.words</code> diese als gleich befinden, obwohl die tatsächlichen Wörter im Array sich verändert haben. Die <code>ListOfWords</code>-Komponente wird daher nicht upgedatet, obwohl sie neue Wörter enthält und gerendert werden sollte.</section><section id="the-power-of-not-mutating-data"class="level2"><h2>Die Macht, Daten nicht zu mutieren</h2><p>Der einfachste Weg, dieses Problem zu umgehen, besteht darin, die Veränderung von Werten zu vermeiden, die du als Props oder State verwendest. Zum Beispiel könnte die <code>handleClick</code>-Methode von oben unter Verwendung von <code>concat</code> wie folgt umgeschrieben werden:<pre class="language-javascript"><code class="language-javascript"><span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">words</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">words</span><span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'marklar'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>ES6 unterstützt die <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_operator">Spread-Syntax</a> für Arrays, was das erleichtern kann. Solltest du Create React App verwenden, ist diese Syntax standardmäßig verfügbar.<pre class="language-js"><code class="language-js"><span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">words</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token spread operator">...</span>state<span class="token punctuation">.</span><span class="token property-access">words</span><span class="token punctuation">,</span> <span class="token string">'marklar'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>Du kannst auch Code, der Objekte verändert, in ähnlicher Weise umschreiben. Lass uns z. B. sagen, wir haben ein Objekt namens <code>colormap</code> und möchten eine Funktion schreiben, die <code>colormap.blue</code> in <code>blue</code> umändert. Wir könnten schreiben:<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">updateColorMap</span><span class="token punctuation">(</span><span class="token parameter">colormap</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  colormap<span class="token punctuation">.</span><span class="token property-access">right</span> <span class="token operator">=</span> <span class="token string">'blue'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Um dies zu schreiben, ohne das Original-Objekt zu verändern, können wir die <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">Object.assign</a>-Methode verwenden:<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">updateColorMap</span><span class="token punctuation">(</span><span class="token parameter">colormap</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> colormap<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token string">'blue'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><code>updateColorMap</code> gibt nun ein neues Objekt zurück, statt das alte zu ändern. <code>Object.assign</code> ist ES6 und benötigt ein Polyfill.<p><a href="https://github.com/sebmarkbage/ecmascript-rest-spread">Object Spread-Syntax</a>, macht es einfacher, Objekte auch ohne Veränderung zu aktualisieren.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">updateColorMap</span><span class="token punctuation">(</span><span class="token parameter">colormap</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span><span class="token spread operator">...</span>colormap<span class="token punctuation">,</span> <span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token string">'blue'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Dieses Funktion wurde JavaScript in ES2018 hinzugefügt.<p>Solltest du Create React App verwenden, sind sowohl <code>Object.assign</code> als auch die Object Spread-Syntax standardmäßig verfügbar.<p>Wenn du mit tief verschachtelten Objekten zu tun hast, kann sich das Aktualisieren des unveränderbaren Objektes, verworren anfühlen. Wenn du auf dieses Problem stößt, schaue dir <a href="https://github.com/mweststrate/immer">Immer</a> oder <a href="https://github.com/kolodny/immutability-helper">immutability-helper</a> an. Mit diesen Bibliotheken kannst du gut lesbaren Code schreiben, ohne die Vorteile der Unveränderlichkeit (engl. immutability) zu verlieren. <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>