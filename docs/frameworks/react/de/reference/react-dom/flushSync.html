<!doctype html><html lang="de"><meta charset="utf-8"><title>flushSync</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="flushsync"><h1 id="flushsync">flushSync</h1><pitfall><p>Using <code>flushSync</code> is uncommon and can hurt the performance of your app.</p></pitfall><intro><p><code>flushSync</code> lets you force React to flush any updates inside the provided callback synchronously. This ensures that the DOM is updated immediately.<pre class="language-js"><code class="language-js"><span class="token function">flushSync</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="reference-reference"><h2 id="reference-reference">Reference {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="flushsynccallback-flushsync"><h3 id="flushsynccallback-flushsync"><code>flushSync(callback)</code> {/<em>flushsync</em>/}</h3><p>Call <code>flushSync</code> to force React to flush any pending work and update the DOM synchronously.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> flushSync <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token function">flushSync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">setSomething</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Most of the time, <code>flushSync</code> can be avoided. Use <code>flushSync</code> as last resort.<p><a href="#usage">See more examples below.</a><section class="level4"aria-labelledby="parameters-parameters"><h4 id="parameters-parameters">Parameters {/<em>parameters</em>/}</h4><ul><li><code>callback</code>: A function. React will immediately call this callback and flush any updates it contains synchronously. It may also flush any pending updates, or Effects, or updates inside of Effects. If an update suspends as a result of this <code>flushSync</code> call, the fallbacks may be re-shown.</ul></section><section class="level4"aria-labelledby="returns-returns"><h4 id="returns-returns">Returns {/<em>returns</em>/}</h4><p><code>flushSync</code> returns <code>undefined</code>.</section><section class="level4"aria-labelledby="caveats-caveats"><h4 id="caveats-caveats">Caveats {/<em>caveats</em>/}</h4><ul><li><code>flushSync</code> can significantly hurt performance. Use sparingly.<li><code>flushSync</code> may force pending Suspense boundaries to show their <code>fallback</code> state.<li><code>flushSync</code> may run pending effects and synchronously apply any updates they contain before returning.<li><code>flushSync</code> may flush updates outside the callback when necessary to flush the updates inside the callback. For example, if there are pending updates from a click, React may flush those before flushing the updates inside the callback.</ul></section></section></section><section class="level2"aria-labelledby="usage-usage"><h2 id="usage-usage">Usage {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="flushing-updates-for-third-party-integrations-flushing-updates-for-third-party-integrations"><h3 id="flushing-updates-for-third-party-integrations-flushing-updates-for-third-party-integrations">Flushing updates for third-party integrations {/<em>flushing-updates-for-third-party-integrations</em>/}</h3><p>When integrating with third-party code such as browser APIs or UI libraries, it may be necessary to force React to flush updates. Use <code>flushSync</code> to force React to flush any<codestep step="{1}">state updates</codestep>inside the callback synchronously:<pre class="language-js"><code class="language-js"><span class="token function">flushSync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">setSomething</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// By this line, the DOM is updated.</span></code></pre><p>This ensures that, by the time the next line of code runs, React has already updated the DOM.<p><strong>Using <code>flushSync</code> is uncommon, and using it often can significantly hurt the performance of your app.</strong> If your app only uses React APIs, and does not integrate with third-party libraries, <code>flushSync</code> should be unnecessary.<p>However, it can be helpful for integrating with third-party code like browser APIs.<p>Some browser APIs expect results inside of callbacks to be written to the DOM synchronously, by the end of the callback, so the browser can do something with the rendered DOM. In most cases, React handles this for you automatically. But in some cases it may be necessary to force a synchronous update.<p>For example, the browser <code>onbeforeprint</code> API allows you to change the page immediately before the print dialog opens. This is useful for applying custom print styles that allow the document to display better for printing. In the example below, you use <code>flushSync</code> inside of the <code>onbeforeprint</code> callback to immediately "flush" the React state to the DOM. Then, by the time the print dialog opens, <code>isPrinting</code> displays "yes":</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> flushSync <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">PrintApp</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isPrinting<span class="token punctuation">,</span> setIsPrinting<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">handleBeforePrint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">flushSync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setIsPrinting</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">handleAfterPrint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setIsPrinting</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeprint'</span><span class="token punctuation">,</span> handleBeforePrint<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'afterprint'</span><span class="token punctuation">,</span> handleAfterPrint<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeprint'</span><span class="token punctuation">,</span> handleBeforePrint<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'afterprint'</span><span class="token punctuation">,</span> handleAfterPrint<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>isPrinting<span class="token operator">:</span> <span class="token punctuation">{</span>isPrinting <span class="token operator">?</span> <span class="token string">'yes'</span> <span class="token operator">:</span> <span class="token string">'no'</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Print</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>Without <code>flushSync</code>, the print dialog will display <code>isPrinting</code> as "no". This is because React batches the updates asynchronously and the print dialog is displayed before the state is updated.</p><pitfall><p><code>flushSync</code> can significantly hurt performance, and may unexpectedly force pending Suspense boundaries to show their fallback state.<p>Most of the time, <code>flushSync</code> can be avoided, so use <code>flushSync</code> as a last resort.</p></pitfall><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>