<!doctype html><html lang="de"><meta charset="utf-8"><title>useLayoutEffect</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="uselayouteffect"><h1 id="uselayouteffect">useLayoutEffect</h1><pitfall><p><code>useLayoutEffect</code> can hurt performance. Prefer <a href="/reference/react/useEffect"><code>useEffect</code></a> when possible.</p></pitfall><intro><p><code>useLayoutEffect</code> is a version of <a href="/reference/react/useEffect"><code>useEffect</code></a> that fires before the browser repaints the screen.<pre class="language-js"><code class="language-js"><span class="token function">useLayoutEffect</span><span class="token punctuation">(</span>setup<span class="token punctuation">,</span> dependencies<span class="token operator">?</span><span class="token punctuation">)</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="reference-reference"><h2 id="reference-reference">Reference {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="uselayouteffectsetup-dependencies-useinsertioneffect"><h3 id="uselayouteffectsetup-dependencies-useinsertioneffect"><code>useLayoutEffect(setup, dependencies?)</code> {/<em>useinsertioneffect</em>/}</h3><p>Call <code>useLayoutEffect</code> to perform the layout measurements before the browser repaints the screen:<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useLayoutEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Tooltip</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tooltipHeight<span class="token punctuation">,</span> setTooltipHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTooltipHeight</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p><a href="#usage">See more examples below.</a><section class="level4"aria-labelledby="parameters-parameters"><h4 id="parameters-parameters">Parameters {/<em>parameters</em>/}</h4><ul><li><p><code>setup</code>: The function with your Effect's logic. Your setup function may also optionally return a <em>cleanup</em> function. Before your component is added to the DOM, React will run your setup function. After every re-render with changed dependencies, React will first run the cleanup function (if you provided it) with the old values, and then run your setup function with the new values. Before your component is removed from the DOM, React will run your cleanup function.<li><p><strong>optional</strong> <code>dependencies</code>: The list of all reactive values referenced inside of the <code>setup</code> code. Reactive values include props, state, and all the variables and functions declared directly inside your component body. If your linter is <a href="/learn/editor-setup#linting">configured for React</a>, it will verify that every reactive value is correctly specified as a dependency. The list of dependencies must have a constant number of items and be written inline like <code>[dep1, dep2, dep3]</code>. React will compare each dependency with its previous value using the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is"><code>Object.is</code></a> comparison. If you omit this argument, your Effect will re-run after every re-render of the component.</ul></section><section class="level4"aria-labelledby="returns-returns"><h4 id="returns-returns">Returns {/<em>returns</em>/}</h4><p><code>useLayoutEffect</code> returns <code>undefined</code>.</section><section class="level4"aria-labelledby="caveats-caveats"><h4 id="caveats-caveats">Caveats {/<em>caveats</em>/}</h4><ul><li><p><code>useLayoutEffect</code> is a Hook, so you can only call it <strong>at the top level of your component</strong> or your own Hooks. You can't call it inside loops or conditions. If you need that, extract a component and move the Effect there.<li><p>When Strict Mode is on, React will <strong>run one extra development-only setup+cleanup cycle</strong> before the first real setup. This is a stress-test that ensures that your cleanup logic "mirrors" your setup logic and that it stops or undoes whatever the setup is doing. If this causes a problem, <a href="/learn/synchronizing-with-effects#how-to-handle-the-effect-firing-twice-in-development">implement the cleanup function.</a><li><p>If some of your dependencies are objects or functions defined inside the component, there is a risk that they will <strong>cause the Effect to re-run more often than needed.</strong> To fix this, remove unnecessary <a href="/reference/react/useEffect#removing-unnecessary-object-dependencies">object</a> and <a href="/reference/react/useEffect#removing-unnecessary-function-dependencies">function</a> dependencies. You can also <a href="/reference/react/useEffect#updating-state-based-on-previous-state-from-an-effect">extract state updates</a> and <a href="/reference/react/useEffect#reading-the-latest-props-and-state-from-an-effect">non-reactive logic</a> outside of your Effect.<li><p>Effects <strong>only run on the client.</strong> They don't run during server rendering.<li><p>The code inside <code>useLayoutEffect</code> and all state updates scheduled from it <strong>block the browser from repainting the screen.</strong> When used excessively, this makes your app slow. When possible, prefer <a href="/reference/react/useEffect"><code>useEffect</code>.</a></ul></section></section></section><section class="level2"aria-labelledby="usage-usage"><h2 id="usage-usage">Usage {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="measuring-layout-before-the-browser-repaints-the-screen-measuring-layout-before-the-browser-repaints-the-screen"><h3 id="measuring-layout-before-the-browser-repaints-the-screen-measuring-layout-before-the-browser-repaints-the-screen">Measuring layout before the browser repaints the screen {/<em>measuring-layout-before-the-browser-repaints-the-screen</em>/}</h3><p>Most components don't need to know their position and size on the screen to decide what to render. They only return some JSX. Then the browser calculates their <em>layout</em> (position and size) and repaints the screen.<p>Sometimes, that's not enough. Imagine a tooltip that appears next to some element on hover. If there's enough space, the tooltip should appear above the element, but if it doesn't fit, it should appear below. In order to render the tooltip at the right final position, you need to know its height (i.e. whether it fits at the top).<p>To do this, you need to render in two passes:<ol><li>Render the tooltip anywhere (even with a wrong position).<li>Measure its height and decide where to place the tooltip.<li>Render the tooltip <em>again</em> in the correct place.</ol><p><strong>All of this needs to happen before the browser repaints the screen.</strong> You don't want the user to see the tooltip moving. Call <code>useLayoutEffect</code> to perform the layout measurements before the browser repaints the screen:<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Tooltip</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tooltipHeight<span class="token punctuation">,</span> setTooltipHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// You don't know real height yet</span>

  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTooltipHeight</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Re-render now that you know the real height</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...use tooltipHeight in the rendering logic below...</span>
<span class="token punctuation">}</span></code></pre><p>Here's how this works step by step:<ol><li><code>Tooltip</code> renders with the initial <code>tooltipHeight = 0</code> (so the tooltip may be wrongly positioned).<li>React places it in the DOM and runs the code in <code>useLayoutEffect</code>.<li>Your <code>useLayoutEffect</code> <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect">measures the height</a> of the tooltip content and triggers an immediate re-render.<li><code>Tooltip</code> renders again with the real <code>tooltipHeight</code> (so the tooltip is correctly positioned).<li>React updates it in the DOM, and the browser finally displays the tooltip.</ol><p>Hover over the buttons below and see how the tooltip adjusts its position depending on whether it fits:</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ButtonWithTooltip</span></span> <span class="token keyword module">from</span> <span class="token string">'./ButtonWithTooltip.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
            <span class="token maybe-class-name">This</span> tooltip does not fit above the button<span class="token punctuation">.</span>
            <span class="token operator">&#x3C;</span>br <span class="token operator">/</span><span class="token operator">></span>
            <span class="token maybe-class-name">This</span> is why it's displayed below instead<span class="token operator">!</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Hover</span> over <span class="token function">me</span> <span class="token punctuation">(</span>tooltip above<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">This</span> tooltip fits above the button<span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Hover</span> over <span class="token function">me</span> <span class="token punctuation">(</span>tooltip below<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">This</span> tooltip fits above the button<span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Hover</span> over <span class="token function">me</span> <span class="token punctuation">(</span>tooltip below<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Tooltip</span></span> <span class="token keyword module">from</span> <span class="token string">'./Tooltip.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ButtonWithTooltip</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> tooltipContent<span class="token punctuation">,</span> <span class="token spread operator">...</span>rest <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>targetRect<span class="token punctuation">,</span> setTargetRect<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> buttonRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button
        <span class="token punctuation">{</span><span class="token spread operator">...</span>rest<span class="token punctuation">}</span>
        ref<span class="token operator">=</span><span class="token punctuation">{</span>buttonRef<span class="token punctuation">}</span>
        onPointerEnter<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> rect <span class="token operator">=</span> buttonRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setTargetRect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">left</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">left</span><span class="token punctuation">,</span>
            <span class="token literal-property property">top</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">top</span><span class="token punctuation">,</span>
            <span class="token literal-property property">right</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">right</span><span class="token punctuation">,</span>
            <span class="token literal-property property">bottom</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">bottom</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        onPointerLeave<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setTargetRect</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>targetRect <span class="token operator">!==</span> <span class="token keyword null nil">null</span> <span class="token operator">&#x26;&#x26;</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Tooltip</span> targetRect<span class="token operator">=</span><span class="token punctuation">{</span>targetRect<span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token punctuation">{</span>tooltipContent<span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Tooltip</span><span class="token operator">></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useLayoutEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createPortal <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">TooltipContainer</span></span> <span class="token keyword module">from</span> <span class="token string">'./TooltipContainer.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Tooltip</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> targetRect <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tooltipHeight<span class="token punctuation">,</span> setTooltipHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTooltipHeight</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Measured tooltip height: '</span> <span class="token operator">+</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> tooltipX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> tooltipY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>targetRect <span class="token operator">!==</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tooltipX <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">left</span><span class="token punctuation">;</span>
    tooltipY <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">top</span> <span class="token operator">-</span> tooltipHeight<span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>tooltipY <span class="token operator">&#x3C;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// It doesn't fit above, so place below.</span>
      tooltipY <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">bottom</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token function">createPortal</span><span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">TooltipContainer</span> x<span class="token operator">=</span><span class="token punctuation">{</span>tooltipX<span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span>tooltipY<span class="token punctuation">}</span> contentRef<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">TooltipContainer</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TooltipContainer</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> contentRef <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">pointerEvents</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate3d(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, 0)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>contentRef<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">"tooltip"</span><span class="token operator">></span>
        <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.tooltip</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">white</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>Notice that even though the <code>Tooltip</code> component has to render in two passes (first, with <code>tooltipHeight</code> initialized to <code>0</code> and then with the real measured height), you only see the final result. This is why you need <code>useLayoutEffect</code> instead of <a href="/reference/react/useEffect"><code>useEffect</code></a> for this example. Let's look at the difference in detail below.</p><recipes titletext="useLayoutEffect vs useEffect"titleid="examples"><section class="level4"aria-labelledby="uselayouteffect-blocks-the-browser-from-repainting-uselayouteffect-blocks-the-browser-from-repainting"><h4 id="uselayouteffect-blocks-the-browser-from-repainting-uselayouteffect-blocks-the-browser-from-repainting"><code>useLayoutEffect</code> blocks the browser from repainting {/<em>uselayouteffect-blocks-the-browser-from-repainting</em>/}</h4><p>React guarantees that the code inside <code>useLayoutEffect</code> and any state updates scheduled inside it will be processed <strong>before the browser repaints the screen.</strong> This lets you render the tooltip, measure it, and re-render the tooltip again without the user noticing the first extra render. In other words, <code>useLayoutEffect</code> blocks the browser from painting.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ButtonWithTooltip</span></span> <span class="token keyword module">from</span> <span class="token string">'./ButtonWithTooltip.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
            <span class="token maybe-class-name">This</span> tooltip does not fit above the button<span class="token punctuation">.</span>
            <span class="token operator">&#x3C;</span>br <span class="token operator">/</span><span class="token operator">></span>
            <span class="token maybe-class-name">This</span> is why it's displayed below instead<span class="token operator">!</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Hover</span> over <span class="token function">me</span> <span class="token punctuation">(</span>tooltip above<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">This</span> tooltip fits above the button<span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Hover</span> over <span class="token function">me</span> <span class="token punctuation">(</span>tooltip below<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">This</span> tooltip fits above the button<span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Hover</span> over <span class="token function">me</span> <span class="token punctuation">(</span>tooltip below<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Tooltip</span></span> <span class="token keyword module">from</span> <span class="token string">'./Tooltip.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ButtonWithTooltip</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> tooltipContent<span class="token punctuation">,</span> <span class="token spread operator">...</span>rest <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>targetRect<span class="token punctuation">,</span> setTargetRect<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> buttonRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button
        <span class="token punctuation">{</span><span class="token spread operator">...</span>rest<span class="token punctuation">}</span>
        ref<span class="token operator">=</span><span class="token punctuation">{</span>buttonRef<span class="token punctuation">}</span>
        onPointerEnter<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> rect <span class="token operator">=</span> buttonRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setTargetRect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">left</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">left</span><span class="token punctuation">,</span>
            <span class="token literal-property property">top</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">top</span><span class="token punctuation">,</span>
            <span class="token literal-property property">right</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">right</span><span class="token punctuation">,</span>
            <span class="token literal-property property">bottom</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">bottom</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        onPointerLeave<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setTargetRect</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>targetRect <span class="token operator">!==</span> <span class="token keyword null nil">null</span> <span class="token operator">&#x26;&#x26;</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Tooltip</span> targetRect<span class="token operator">=</span><span class="token punctuation">{</span>targetRect<span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token punctuation">{</span>tooltipContent<span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Tooltip</span><span class="token operator">></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useLayoutEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createPortal <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">TooltipContainer</span></span> <span class="token keyword module">from</span> <span class="token string">'./TooltipContainer.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Tooltip</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> targetRect <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tooltipHeight<span class="token punctuation">,</span> setTooltipHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTooltipHeight</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> tooltipX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> tooltipY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>targetRect <span class="token operator">!==</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tooltipX <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">left</span><span class="token punctuation">;</span>
    tooltipY <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">top</span> <span class="token operator">-</span> tooltipHeight<span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>tooltipY <span class="token operator">&#x3C;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// It doesn't fit above, so place below.</span>
      tooltipY <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">bottom</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token function">createPortal</span><span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">TooltipContainer</span> x<span class="token operator">=</span><span class="token punctuation">{</span>tooltipX<span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span>tooltipY<span class="token punctuation">}</span> contentRef<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">TooltipContainer</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TooltipContainer</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> contentRef <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">pointerEvents</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate3d(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, 0)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>contentRef<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">"tooltip"</span><span class="token operator">></span>
        <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.tooltip</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">white</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section><section class="level4"aria-labelledby="useeffect-does-not-block-the-browser-useeffect-does-not-block-the-browser"><h4 id="useeffect-does-not-block-the-browser-useeffect-does-not-block-the-browser"><code>useEffect</code> does not block the browser {/<em>useeffect-does-not-block-the-browser</em>/}</h4><p>Here is the same example, but with <a href="/reference/react/useEffect"><code>useEffect</code></a> instead of <code>useLayoutEffect</code>. If you're on a slower device, you might notice that sometimes the tooltip "flickers" and you briefly see its initial position before the corrected position.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ButtonWithTooltip</span></span> <span class="token keyword module">from</span> <span class="token string">'./ButtonWithTooltip.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
            <span class="token maybe-class-name">This</span> tooltip does not fit above the button<span class="token punctuation">.</span>
            <span class="token operator">&#x3C;</span>br <span class="token operator">/</span><span class="token operator">></span>
            <span class="token maybe-class-name">This</span> is why it's displayed below instead<span class="token operator">!</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Hover</span> over <span class="token function">me</span> <span class="token punctuation">(</span>tooltip above<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">This</span> tooltip fits above the button<span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Hover</span> over <span class="token function">me</span> <span class="token punctuation">(</span>tooltip below<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">This</span> tooltip fits above the button<span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Hover</span> over <span class="token function">me</span> <span class="token punctuation">(</span>tooltip below<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Tooltip</span></span> <span class="token keyword module">from</span> <span class="token string">'./Tooltip.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ButtonWithTooltip</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> tooltipContent<span class="token punctuation">,</span> <span class="token spread operator">...</span>rest <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>targetRect<span class="token punctuation">,</span> setTargetRect<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> buttonRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button
        <span class="token punctuation">{</span><span class="token spread operator">...</span>rest<span class="token punctuation">}</span>
        ref<span class="token operator">=</span><span class="token punctuation">{</span>buttonRef<span class="token punctuation">}</span>
        onPointerEnter<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> rect <span class="token operator">=</span> buttonRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setTargetRect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">left</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">left</span><span class="token punctuation">,</span>
            <span class="token literal-property property">top</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">top</span><span class="token punctuation">,</span>
            <span class="token literal-property property">right</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">right</span><span class="token punctuation">,</span>
            <span class="token literal-property property">bottom</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">bottom</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        onPointerLeave<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setTargetRect</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>targetRect <span class="token operator">!==</span> <span class="token keyword null nil">null</span> <span class="token operator">&#x26;&#x26;</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Tooltip</span> targetRect<span class="token operator">=</span><span class="token punctuation">{</span>targetRect<span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token punctuation">{</span>tooltipContent<span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Tooltip</span><span class="token operator">></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createPortal <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">TooltipContainer</span></span> <span class="token keyword module">from</span> <span class="token string">'./TooltipContainer.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Tooltip</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> targetRect <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tooltipHeight<span class="token punctuation">,</span> setTooltipHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTooltipHeight</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> tooltipX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> tooltipY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>targetRect <span class="token operator">!==</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tooltipX <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">left</span><span class="token punctuation">;</span>
    tooltipY <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">top</span> <span class="token operator">-</span> tooltipHeight<span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>tooltipY <span class="token operator">&#x3C;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// It doesn't fit above, so place below.</span>
      tooltipY <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">bottom</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token function">createPortal</span><span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">TooltipContainer</span> x<span class="token operator">=</span><span class="token punctuation">{</span>tooltipX<span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span>tooltipY<span class="token punctuation">}</span> contentRef<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">TooltipContainer</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TooltipContainer</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> contentRef <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">pointerEvents</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate3d(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, 0)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>contentRef<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">"tooltip"</span><span class="token operator">></span>
        <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.tooltip</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">white</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>To make the bug easier to reproduce, this version adds an artificial delay during rendering. React will let the browser paint the screen before it processes the state update inside <code>useEffect</code>. As a result, the tooltip flickers:</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ButtonWithTooltip</span></span> <span class="token keyword module">from</span> <span class="token string">'./ButtonWithTooltip.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
            <span class="token maybe-class-name">This</span> tooltip does not fit above the button<span class="token punctuation">.</span>
            <span class="token operator">&#x3C;</span>br <span class="token operator">/</span><span class="token operator">></span>
            <span class="token maybe-class-name">This</span> is why it's displayed below instead<span class="token operator">!</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Hover</span> over <span class="token function">me</span> <span class="token punctuation">(</span>tooltip above<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">This</span> tooltip fits above the button<span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Hover</span> over <span class="token function">me</span> <span class="token punctuation">(</span>tooltip below<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">This</span> tooltip fits above the button<span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Hover</span> over <span class="token function">me</span> <span class="token punctuation">(</span>tooltip below<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Tooltip</span></span> <span class="token keyword module">from</span> <span class="token string">'./Tooltip.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ButtonWithTooltip</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> tooltipContent<span class="token punctuation">,</span> <span class="token spread operator">...</span>rest <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>targetRect<span class="token punctuation">,</span> setTargetRect<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> buttonRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button
        <span class="token punctuation">{</span><span class="token spread operator">...</span>rest<span class="token punctuation">}</span>
        ref<span class="token operator">=</span><span class="token punctuation">{</span>buttonRef<span class="token punctuation">}</span>
        onPointerEnter<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> rect <span class="token operator">=</span> buttonRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setTargetRect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">left</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">left</span><span class="token punctuation">,</span>
            <span class="token literal-property property">top</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">top</span><span class="token punctuation">,</span>
            <span class="token literal-property property">right</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">right</span><span class="token punctuation">,</span>
            <span class="token literal-property property">bottom</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">bottom</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        onPointerLeave<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setTargetRect</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>targetRect <span class="token operator">!==</span> <span class="token keyword null nil">null</span> <span class="token operator">&#x26;&#x26;</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Tooltip</span> targetRect<span class="token operator">=</span><span class="token punctuation">{</span>targetRect<span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token punctuation">{</span>tooltipContent<span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Tooltip</span><span class="token operator">></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createPortal <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">TooltipContainer</span></span> <span class="token keyword module">from</span> <span class="token string">'./TooltipContainer.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Tooltip</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> targetRect <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tooltipHeight<span class="token punctuation">,</span> setTooltipHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// This artificially slows down rendering</span>
  <span class="token keyword">let</span> now <span class="token operator">=</span> <span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">while</span> <span class="token punctuation">(</span><span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> now <span class="token operator">&#x3C;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do nothing for a bit...</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTooltipHeight</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> tooltipX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> tooltipY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>targetRect <span class="token operator">!==</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tooltipX <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">left</span><span class="token punctuation">;</span>
    tooltipY <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">top</span> <span class="token operator">-</span> tooltipHeight<span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>tooltipY <span class="token operator">&#x3C;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// It doesn't fit above, so place below.</span>
      tooltipY <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">bottom</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token function">createPortal</span><span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">TooltipContainer</span> x<span class="token operator">=</span><span class="token punctuation">{</span>tooltipX<span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span>tooltipY<span class="token punctuation">}</span> contentRef<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">TooltipContainer</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TooltipContainer</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> contentRef <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">pointerEvents</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate3d(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, 0)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>contentRef<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">"tooltip"</span><span class="token operator">></span>
        <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.tooltip</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">white</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>Edit this example to <code>useLayoutEffect</code> and observe that it blocks the paint even if rendering is slowed down.</p><solution><note><p>Rendering in two passes and blocking the browser hurts performance. Try to avoid this when you can.</p></note></solution></section></recipes></section></section><section class="level2"aria-labelledby="troubleshooting-troubleshooting"><h2 id="troubleshooting-troubleshooting">Troubleshooting {/<em>troubleshooting</em>/}</h2><section class="level3"aria-labelledby="im-getting-an-error-uselayouteffect-does-nothing-on-the-server-im-getting-an-error-uselayouteffect-does-nothing-on-the-server"><h3 id="im-getting-an-error-uselayouteffect-does-nothing-on-the-server-im-getting-an-error-uselayouteffect-does-nothing-on-the-server">I'm getting an error: "<code>useLayoutEffect</code> does nothing on the server" {/<em>im-getting-an-error-uselayouteffect-does-nothing-on-the-server</em>/}</h3><p>The purpose of <code>useLayoutEffect</code> is to let your component <a href="#measuring-layout-before-the-browser-repaints-the-screen">use layout information for rendering:</a><ol><li>Render the initial content.<li>Measure the layout <em>before the browser repaints the screen.</em><li>Render the final content using the layout information you've read.</ol><p>When you or your framework uses <a href="/reference/react-dom/server">server rendering</a>, your React app renders to HTML on the server for the initial render. This lets you show the initial HTML before the JavaScript code loads.<p>The problem is that on the server, there is no layout information.<p>In the <a href="#measuring-layout-before-the-browser-repaints-the-screen">earlier example</a>, the <code>useLayoutEffect</code> call in the <code>Tooltip</code> component lets it position itself correctly (either above or below content) depending on the content height. If you tried to render <code>Tooltip</code> as a part of the initial server HTML, this would be impossible to determine. On the server, there is no layout yet! So, even if you rendered it on the server, its position would "jump" on the client after the JavaScript loads and runs.<p>Usually, components that rely on layout information don't need to render on the server anyway. For example, it probably doesn't make sense to show a <code>Tooltip</code> during the initial render. It is triggered by a client interaction.<p>However, if you're running into this problem, you have a few different options:<ul><li><p>Replace <code>useLayoutEffect</code> with <a href="/reference/react/useEffect"><code>useEffect</code>.</a> This tells React that it's okay to display the initial render result without blocking the paint (because the original HTML will become visible before your Effect runs).<li><p>Alternatively, <a href="/reference/react/Suspense#providing-a-fallback-for-server-errors-and-client-only-content">mark your component as client-only.</a> This tells React to replace its content up to the closest <a href="/reference/react/Suspense"><code>&#x3C;Suspense></code></a> boundary with a loading fallback (for example, a spinner or a glimmer) during server rendering.<li><p>Alternatively, you can render a component with <code>useLayoutEffect</code> only after hydration. Keep a boolean <code>isMounted</code> state that's initialized to <code>false</code>, and set it to <code>true</code> inside a <code>useEffect</code> call. Your rendering logic can then be like <code>return isMounted ? &#x3C;RealContent /> : &#x3C;FallbackContent /></code>. On the server and during the hydration, the user will see <code>FallbackContent</code> which should not call <code>useLayoutEffect</code>. Then React will replace it with <code>RealContent</code> which runs on the client only and can include <code>useLayoutEffect</code> calls.<li><p>If you synchronize your component with an external data store and rely on <code>useLayoutEffect</code> for different reasons than measuring layout, consider <a href="/reference/react/useSyncExternalStore"><code>useSyncExternalStore</code></a> instead which <a href="/reference/react/useSyncExternalStore#adding-support-for-server-rendering">supports server rendering.</a> <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></ul></section></section></inlinetoc></section>