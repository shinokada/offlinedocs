<!doctype html><html lang="de"><meta charset="utf-8"><title>Components and Hooks must be pure</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="components-and-hooks-must-be-pure"><h1 id="components-and-hooks-must-be-pure">Components and Hooks must be pure</h1><intro>Pure functions only perform a calculation and nothing more. It makes your code easier to understand, debug, and allows React to automatically optimize your components and Hooks correctly.</intro><note>This reference page covers advanced topics and requires familiarity with the concepts covered in the [Keeping Components Pure](/learn/keeping-components-pure) page.</note><inlinetoc><section class="level3"aria-labelledby="why-does-purity-matter-why-does-purity-matter"><h3 id="why-does-purity-matter-why-does-purity-matter">Why does purity matter? {/<em>why-does-purity-matter</em>/}</h3><p>One of the key concepts that makes React, <em>React</em> is <em>purity</em>. A pure component or hook is one that is:<ul><li><strong>Idempotent</strong> – You <a href="/learn/keeping-components-pure#purity-components-as-formulas">always get the same result every time</a> you run it with the same inputs – props, state, context for component inputs; and arguments for hook inputs.<li><strong>Has no side effects in render</strong> – Code with side effects should run <a href="#how-does-react-run-your-code"><strong>separately from rendering</strong></a>. For example as an <a href="/learn/responding-to-events">event handler</a> – where the user interacts with the UI and causes it to update; or as an <a href="/reference/react/useEffect">Effect</a> – which runs after render.<li><strong>Does not mutate non-local values</strong>: Components and Hooks should <a href="#mutation">never modify values that aren't created locally</a> in render.</ul><p>When render is kept pure, React can understand how to prioritize which updates are most important for the user to see first. This is made possible because of render purity: since components don't have side effects <a href="#how-does-react-run-your-code">in render</a>, React can pause rendering components that aren't as important to update, and only come back to them later when it's needed.<p>Concretely, this means that rendering logic can be run multiple times in a way that allows React to give your user a pleasant user experience. However, if your component has an untracked side effect – like modifying the value of a global variable <a href="#how-does-react-run-your-code">during render</a> – when React runs your rendering code again, your side effects will be triggered in a way that won't match what you want. This often leads to unexpected bugs that can degrade how your users experience your app. You can see an <a href="/learn/keeping-components-pure#side-effects-unintended-consequences">example of this in the Keeping Components Pure page</a>.<section class="level4"aria-labelledby="how-does-react-run-your-code-how-does-react-run-your-code"><h4 id="how-does-react-run-your-code-how-does-react-run-your-code">How does React run your code? {/<em>how-does-react-run-your-code</em>/}</h4><p>React is declarative: you tell React <em>what</em> to render, and React will figure out <em>how</em> best to display it to your user. To do this, React has a few phases where it runs your code. You don't need to know about all of these phases to use React well. But at a high level, you should know about what code runs in <em>render</em>, and what runs outside of it.<p><em>Rendering</em> refers to calculating what the next version of your UI should look like. After rendering, <a href="/reference/react/useEffect">Effects</a> are <em>flushed</em> (meaning they are run until there are no more left) and may update the calculation if the Effects have impacts on layout. React takes this new calculation and compares it to the calculation used to create the previous version of your UI, then <em>commits</em> just the minimum changes needed to the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model">DOM</a> (what your user actually sees) to catch it up to the latest version.</p><deepdive></deepdive></section><section class="level4"aria-labelledby="how-to-tell-if-code-runs-in-render-how-to-tell-if-code-runs-in-render"><h4 id="how-to-tell-if-code-runs-in-render-how-to-tell-if-code-runs-in-render">How to tell if code runs in render {/<em>how-to-tell-if-code-runs-in-render</em>/}</h4><p>One quick heuristic to tell if code runs during render is to examine where it is: if it's written at the top level like in the example below, there's a good chance it runs during render.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Dropdown</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> selectedItems <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// created during render</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Event handlers and Effects don't run in render:<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Dropdown</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> selectedItems <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onSelect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// this code is in an event handler, so it's only run when the user triggers this</span>
    selectedItems<span class="token punctuation">.</span><span class="token method function property-access">add</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Dropdown</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> selectedItems <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// this code is inside of an Effect, so it only runs after rendering</span>
    <span class="token function">logForAnalytics</span><span class="token punctuation">(</span>selectedItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>selectedItems<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section></section><section class="level2"aria-labelledby="components-and-hooks-must-be-idempotent-components-and-hooks-must-be-idempotent"><h2 id="components-and-hooks-must-be-idempotent-components-and-hooks-must-be-idempotent">Components and Hooks must be idempotent {/<em>components-and-hooks-must-be-idempotent</em>/}</h2><p>Components must always return the same output with respect to their inputs – props, state, and context. This is known as <em>idempotency</em>. <a href="https://en.wikipedia.org/wiki/Idempotence">Idempotency</a> is a term popularized in functional programming. It refers to the idea that you <a href="learn/keeping-components-pure">always get the same result every time</a> you run that piece of code with the same inputs.<p>This means that <em>all</em> code that runs <a href="#how-does-react-run-your-code">during render</a> must also be idempotent in order for this rule to hold. For example, this line of code is not idempotent (and therefore, neither is the component):<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Clock</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🔴 Bad: always returns a different result!</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>span<span class="token operator">></span><span class="token punctuation">{</span>time<span class="token punctuation">.</span><span class="token method function property-access">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span>
<span class="token punctuation">}</span></code></pre><p><code>new Date()</code> is not idempotent as it always returns the current date and changes its result every time it's called. When you render the above component, the time displayed on the screen will stay stuck on the time that the component was rendered. Similarly, functions like <code>Math.random()</code> also aren't idempotent, because they return different results every time they're called, even when the inputs are the same.<p>This doesn't mean you shouldn't use non-idempotent functions like <code>new Date()</code> <em>at all</em> – you should just avoid using them <a href="#how-does-react-run-your-code">during render</a>. In this case, we can <em>synchronize</em> the latest date to this component using an <a href="/reference/react/useEffect">Effect</a>:</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">useTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. Keep track of the current date's state. `useState` receives an initializer function as its</span>
  <span class="token comment">//    initial state. It only runs once when the hook is called, so only the current date at the</span>
  <span class="token comment">//    time the hook is called is set first.</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>time<span class="token punctuation">,</span> setTime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 2. Update the current date every second using `setInterval`.</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ Good: non-idempotent code no longer runs in render</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. Return a cleanup function so we don't leak the `setInterval` timer.</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> time<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Clock</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token function">useTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>span<span class="token operator">></span><span class="token punctuation">{</span>time<span class="token punctuation">.</span><span class="token method function property-access">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>By wrapping the non-idempotent <code>new Date()</code> call in an Effect, it moves that calculation <a href="#how-does-react-run-your-code">outside of rendering</a>.<p>If you don't need to synchronize some external state with React, you can also consider using an <a href="/learn/responding-to-events">event handler</a> if it only needs to be updated in response to a user interaction.</section><section class="level2"aria-labelledby="side-effects-must-run-outside-of-render-side-effects-must-run-outside-of-render"><h2 id="side-effects-must-run-outside-of-render-side-effects-must-run-outside-of-render">Side effects must run outside of render {/<em>side-effects-must-run-outside-of-render</em>/}</h2><p><a href="/learn/keeping-components-pure#side-effects-unintended-consequences">Side effects</a> should not run <a href="#how-does-react-run-your-code">in render</a>, as React can render components multiple times to create the best possible user experience.</p><note>Side effects are a broader term than Effects. Effects specifically refer to code that's wrapped in `useEffect`, while a side effect is a general term for code that has any observable effect other than its primary result of returning a value to the caller.<p>Side effects are typically written inside of <a href="/learn/responding-to-events">event handlers</a> or Effects. But never during render.<p>While render must be kept pure, side effects are necessary at some point in order for your app to do anything interesting, like showing something on the screen! The key point of this rule is that side effects should not run <a href="#how-does-react-run-your-code">in render</a>, as React can render components multiple times. In most cases, you'll use <a href="learn/responding-to-events">event handlers</a> to handle side effects. Using an event handler explicitly tells React that this code doesn't need to run during render, keeping render pure. If you've exhausted all options – and only as a last resort – you can also handle side effects using <code>useEffect</code>.<section class="level3"aria-labelledby="when-is-it-okay-to-have-mutation-mutation"><h3 id="when-is-it-okay-to-have-mutation-mutation">When is it okay to have mutation? {/<em>mutation</em>/}</h3><section class="level4"aria-labelledby="local-mutation-local-mutation"><h4 id="local-mutation-local-mutation">Local mutation {/<em>local-mutation</em>/}</h4><p>One common example of a side effect is mutation, which in JavaScript refers to changing the value of a non-<a href="https://developer.mozilla.org/en-US/docs/Glossary/Primitive">primitive</a> value. In general, while mutation is not idiomatic in React, <em>local</em> mutation is absolutely fine:<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FriendList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> friends <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// ✅ Good: locally created</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&#x3C;</span> friends<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> friend <span class="token operator">=</span> friends<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    items<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Friend</span> key<span class="token operator">=</span><span class="token punctuation">{</span>friend<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span> friend<span class="token operator">=</span><span class="token punctuation">{</span>friend<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ Good: local mutation is okay</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>section<span class="token operator">></span><span class="token punctuation">{</span>items<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>section<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>There is no need to contort your code to avoid local mutation. <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map"><code>Array.map</code></a> could also be used here for brevity, but there is nothing wrong with creating a local array and then pushing items into it <a href="#how-does-react-run-your-code">during render</a>.<p>Even though it looks like we are mutating <code>items</code>, the key point to note is that this code only does so <em>locally</em> – the mutation isn't "remembered" when the component is rendered again. In other words, <code>items</code> only stays around as long as the component does. Because <code>items</code> is always <em>recreated</em> every time <code>&#x3C;FriendList /></code> is rendered, the component will always return the same result.<p>On the other hand, if <code>items</code> was created outside of the component, it holds on to its previous values and remembers changes:<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 🔴 Bad: created outside of the component</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FriendList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> friends <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&#x3C;</span> friends<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> friend <span class="token operator">=</span> friends<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    items<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Friend</span> key<span class="token operator">=</span><span class="token punctuation">{</span>friend<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span> friend<span class="token operator">=</span><span class="token punctuation">{</span>friend<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🔴 Bad: mutates a value created outside of render</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>section<span class="token operator">></span><span class="token punctuation">{</span>items<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>section<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>When <code>&#x3C;FriendList /></code> runs again, we will continue appending <code>friends</code> to <code>items</code> every time that component is run, leading to multiple duplicated results. This version of <code>&#x3C;FriendList /></code> has observable side effects <a href="#how-does-react-run-your-code">during render</a> and <strong>breaks the rule</strong>.</section><section class="level4"aria-labelledby="lazy-initialization-lazy-initialization"><h4 id="lazy-initialization-lazy-initialization">Lazy initialization {/<em>lazy-initialization</em>/}</h4><p>Lazy initialization is also fine despite not being fully "pure":<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ExpenseForm</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token maybe-class-name">SuperCalculator</span><span class="token punctuation">.</span><span class="token method function property-access">initializeIfNotReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ Good: if it doesn't affect other components</span>
  <span class="token comment">// Continue rendering...</span>
<span class="token punctuation">}</span></code></pre></section><section class="level4"aria-labelledby="changing-the-dom-changing-the-dom"><h4 id="changing-the-dom-changing-the-dom">Changing the DOM {/<em>changing-the-dom</em>/}</h4><p>Side effects that are directly visible to the user are not allowed in the render logic of React components. In other words, merely calling a component function shouldn’t by itself produce a change on the screen.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ProductDetailPage</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> product <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">window</span><span class="token punctuation">.</span><span class="token property-access">title</span> <span class="token operator">=</span> product<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">;</span> <span class="token comment">// 🔴 Bad: Changes the DOM</span>
<span class="token punctuation">}</span></code></pre><p>One way to achieve the desired result of updating <code>window.title</code> outside of render is to <a href="/learn/synchronizing-with-effects">synchronize the component with <code>window</code></a>.<p>As long as calling a component multiple times is safe and doesn’t affect the rendering of other components, React doesn’t care if it’s 100% pure in the strict functional programming sense of the word. It is more important that <a href="/reference/rules/components-and-hooks-must-be-pure">components must be idempotent</a>.</section></section></note></section><section class="level2"aria-labelledby="props-and-state-are-immutable-props-and-state-are-immutable"><h2 id="props-and-state-are-immutable-props-and-state-are-immutable">Props and state are immutable {/<em>props-and-state-are-immutable</em>/}</h2><p>A component's props and state are immutable <a href="learn/state-as-a-snapshot">snapshots</a>. Never mutate them directly. Instead, pass new props down, and use the setter function from <code>useState</code>.<p>You can think of the props and state values as snapshots that are updated after rendering. For this reason, you don't modify the props or state variables directly: instead you pass new props, or use the setter function provided to you to tell React that state needs to update the next time the component is rendered.<section class="level3"aria-labelledby="dont-mutate-props-props"><h3 id="dont-mutate-props-props">Don't mutate Props {/<em>props</em>/}</h3><p>Props are immutable because if you mutate them, the application will produce inconsistent output, which can be hard to debug since it may or may not work depending on the circumstance.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Post</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> item <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  item<span class="token punctuation">.</span><span class="token property-access">url</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Url</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">,</span> base<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🔴 Bad: never mutate props directly</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Link</span> url<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Link</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Post</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> item <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Url</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">,</span> base<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ Good: make a copy instead</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Link</span> url<span class="token operator">=</span><span class="token punctuation">{</span>url<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Link</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section><section class="level3"aria-labelledby="dont-mutate-state-state"><h3 id="dont-mutate-state-state">Don't mutate State {/<em>state</em>/}</h3><p><code>useState</code> returns the state variable and a setter to update that state.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>stateVariable<span class="token punctuation">,</span> setter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Rather than updating the state variable in-place, we need to update it using the setter function that is returned by <code>useState</code>. Changing values on the state variable doesn't cause the component to update, leaving your users with an outdated UI. Using the setter function informs React that the state has changed, and that we need to queue a re-render to update the UI.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Counter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 🔴 Bad: never mutate state directly</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token maybe-class-name">You</span> pressed me <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Counter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ Good: use the setter function returned by useState</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token maybe-class-name">You</span> pressed me <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section></section><section class="level2"aria-labelledby="return-values-and-arguments-to-hooks-are-immutable-return-values-and-arguments-to-hooks-are-immutable"><h2 id="return-values-and-arguments-to-hooks-are-immutable-return-values-and-arguments-to-hooks-are-immutable">Return values and arguments to Hooks are immutable {/<em>return-values-and-arguments-to-hooks-are-immutable</em>/}</h2><p>Once values are passed to a hook, you should not modify them. Like props in JSX, values become immutable when passed to a hook.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">useIconStyle</span><span class="token punctuation">(</span><span class="token parameter">icon</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>icon<span class="token punctuation">.</span><span class="token property-access">enabled</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    icon<span class="token punctuation">.</span><span class="token property-access">className</span> <span class="token operator">=</span> <span class="token function">computeStyle</span><span class="token punctuation">(</span>icon<span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🔴 Bad: never mutate hook arguments directly</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> icon<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">useIconStyle</span><span class="token punctuation">(</span><span class="token parameter">icon</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> newIcon <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span>icon <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// ✅ Good: make a copy instead</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>icon<span class="token punctuation">.</span><span class="token property-access">enabled</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    newIcon<span class="token punctuation">.</span><span class="token property-access">className</span> <span class="token operator">=</span> <span class="token function">computeStyle</span><span class="token punctuation">(</span>icon<span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> newIcon<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>One important principle in React is <em>local reasoning</em>: the ability to understand what a component or hook does by looking at its code in isolation. Hooks should be treated like "black boxes" when they are called. For example, a custom hook might have used its arguments as dependencies to memoize values inside it:<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">useIconStyle</span><span class="token punctuation">(</span><span class="token parameter">icon</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newIcon <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span>icon <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>icon<span class="token punctuation">.</span><span class="token property-access">enabled</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      newIcon<span class="token punctuation">.</span><span class="token property-access">className</span> <span class="token operator">=</span> <span class="token function">computeStyle</span><span class="token punctuation">(</span>icon<span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> newIcon<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>icon<span class="token punctuation">,</span> theme<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>If you were to mutate the Hooks arguments, the custom hook's memoization will become incorrect, so it's important to avoid doing that.<pre class="language-js"><code class="language-js">style <span class="token operator">=</span> <span class="token function">useIconStyle</span><span class="token punctuation">(</span>icon<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// `style` is memoized based on `icon`</span>
icon<span class="token punctuation">.</span><span class="token property-access">enabled</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>               <span class="token comment">// Bad: 🔴 never mutate hook arguments directly</span>
style <span class="token operator">=</span> <span class="token function">useIconStyle</span><span class="token punctuation">(</span>icon<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// previously memoized result is returned</span></code></pre><pre class="language-js"><code class="language-js">style <span class="token operator">=</span> <span class="token function">useIconStyle</span><span class="token punctuation">(</span>icon<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// `style` is memoized based on `icon`</span>
icon <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span>icon<span class="token punctuation">,</span> <span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Good: ✅ make a copy instead</span>
style <span class="token operator">=</span> <span class="token function">useIconStyle</span><span class="token punctuation">(</span>icon<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// new value of `style` is calculated</span></code></pre><p>Similarly, it's important to not modify the return values of Hooks, as they may have been memoized.</section><section class="level2"aria-labelledby="values-are-immutable-after-being-passed-to-jsx-values-are-immutable-after-being-passed-to-jsx"><h2 id="values-are-immutable-after-being-passed-to-jsx-values-are-immutable-after-being-passed-to-jsx">Values are immutable after being passed to JSX {/<em>values-are-immutable-after-being-passed-to-jsx</em>/}</h2><p>Don't mutate values after they've been used in JSX. Move the mutation before the JSX is created.<p>When you use JSX in an expression, React may eagerly evaluate the JSX before the component finishes rendering. This means that mutating values after they've been passed to JSX can lead to outdated UIs, as React won't know to update the component's output.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Page</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> colour <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> styles <span class="token operator">=</span> <span class="token punctuation">{</span> colour<span class="token punctuation">,</span> <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token string">"large"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> header <span class="token operator">=</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Header</span> styles<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  styles<span class="token punctuation">.</span><span class="token property-access">size</span> <span class="token operator">=</span> <span class="token string">"small"</span><span class="token punctuation">;</span> <span class="token comment">// 🔴 Bad: styles was already used in the JSX above</span>
  <span class="token keyword">const</span> footer <span class="token operator">=</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Footer</span> styles<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token punctuation">{</span>header<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Content</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>footer<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Page</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> colour <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> headerStyles <span class="token operator">=</span> <span class="token punctuation">{</span> colour<span class="token punctuation">,</span> <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token string">"large"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> header <span class="token operator">=</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Header</span> styles<span class="token operator">=</span><span class="token punctuation">{</span>headerStyles<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> footerStyles <span class="token operator">=</span> <span class="token punctuation">{</span> colour<span class="token punctuation">,</span> <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token string">"small"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// ✅ Good: we created a new value</span>
  <span class="token keyword">const</span> footer <span class="token operator">=</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Footer</span> styles<span class="token operator">=</span><span class="token punctuation">{</span>footerStyles<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token punctuation">{</span>header<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Content</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>footer<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></inlinetoc></section>