<!doctype html><html lang="fr"><meta charset="utf-8"><title>Les règles des Hooks</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="les-règles-des-hooks"class="level1"><h1>Les règles des Hooks</h1><p>Les <em>Hooks</em> sont arrivés avec React 16.8. Ils vous permettent de bénéficier d’un état local et d'autres fonctionnalités de React sans avoir à écrire une classe.<p>Les Hooks sont des fonctions JavaScript, mais vous devez suivre deux règles lorsque vous les utilisez. Nous mettons à votre disposition un <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">plugin de <em>linter</em></a> pour vérifier ces règles automatiquement :<section id="only-call-hooks-at-the-top-level"class="level3"><h3>Appelez les Hooks uniquement au niveau racine</h3><p><strong>N'appelez pas de Hooks à l'intérieur de boucles, de code conditionnel ou de fonctions imbriquées.</strong> Au lieu de ça, utilisez seulement les Hooks au niveau racine de votre fonction React. En suivant cette règle, vous garantissez que les Hooks sont appelés dans le même ordre à chaque affichage du composant. C'est ce qui permet à React de garantir le bon état des Hooks entre plusieurs appels à <code>useState</code> et <code>useEffect</code>. (Si vous êtes curieux·se, nous expliquerons ça en détail <a href="#explanation">plus bas</a>.)</section><section id="only-call-hooks-from-react-functions"class="level3"><h3>Appelez les Hooks uniquement depuis des fonctions React</h3><p><strong>N'appelez pas les Hooks depuis des fonctions JavaScript classiques.</strong> Vous pouvez en revanche :<ul><li>✅ Appeler les Hooks depuis des fonctions composants React.<li>✅ Appeler les Hooks depuis des Hooks personnalisés (nous aborderons le sujet <a href="./hooks-custom.html">dans la prochaine page</a>).</ul><p>En suivant cette règle, vous garantissez que toute la logique d’état d’un composant est clairement identifiable dans son code source.</section><section id="eslint-plugin"class="level2"><h2>Plugin ESLint</h2><p>Nous avons publié un plugin ESLint appelé <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks"><code>eslint-plugin-react-hooks</code></a> qui assure le respect de ces deux règles. Vous pouvez ajouter ce plugin à votre projet si vous souhaitez l'utiliser :<p>Ce plugin est inclus par défaut dans Create React App<a href="./create-a-new-react-app.html#create-react-app">Create React App</a>.<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> eslint-plugin-react-hooks --save-dev</code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// Votre configuration ESLint</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
    <span class="token string">"react-hooks"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">"rules"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token string-property property">"react-hooks/rules-of-hooks"</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token comment">// Vérifie les règles des Hooks</span>
    <span class="token string-property property">"react-hooks/exhaustive-deps"</span><span class="token operator">:</span> <span class="token string">"warn"</span>  <span class="token comment">// Vérifie les tableaux de dépendances</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p><strong>Vous pouvez maintenant passer directement à la prochaine page, qui explique comment écrire <a href="./hooks-custom.html">vos propres Hooks</a>.</strong> Dans cette page, nous allons maintenant expliquer le raisonnement qui se cache derrière ces règles.</section><section id="explanation"class="level2"><h2>Explications</h2><p>Comme nous l'avons <a href="./hooks-state.html#tip-using-multiple-state-variables">appris plus tôt</a>, nous pouvons utiliser plusieurs Hooks <em>State</em> ou <em>Effect</em> au sein d'un même composant :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. Utilise la variable d'état name</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 2. Utilise un effet pour persister le formulaire</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">persistForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">'formData'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 3. Utilise la variable d'état surname</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>surname<span class="token punctuation">,</span> setSurname<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 4. Utilise un effet pour mettre à jour le titre</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">updateTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">title</span> <span class="token operator">=</span> name <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> surname<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Alors, comment React sait-il quel état correspond à quel appel à <code>useState</code> ? Réponse : <strong>React se repose sur l'ordre dans lequel les Hooks sont appelés</strong>. Notre exemple fonctionne car l'ordre d'appel des Hooks est le même à chaque affichage :<pre class="language-js"><code class="language-js"><span class="token comment">// ---------</span>
<span class="token comment">// Premier affichage</span>
<span class="token comment">// ---------</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span>           <span class="token comment">// 1. Initialise la variable d'état name avec 'Mary'</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>persistForm<span class="token punctuation">)</span>     <span class="token comment">// 2. Ajoute un effet pour persister le formulaire</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span>        <span class="token comment">// 3. Initialise la variable d'état surname avec 'Poppins'</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>updateTitle<span class="token punctuation">)</span>     <span class="token comment">// 4. Ajoute un effet pour mettre à jour le titre</span>

<span class="token comment">// ----------</span>
<span class="token comment">// Deuxième affichage</span>
<span class="token comment">// ----------</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span>           <span class="token comment">// 1. Lit la variable d'état name (l'argument est ignoré)</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>persistForm<span class="token punctuation">)</span>     <span class="token comment">// 2. Remplace l'effet pour persister le formulaire</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span>        <span class="token comment">// 3. Lit la variable d'état surname (l'argument est ignoré)</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>updateTitle<span class="token punctuation">)</span>     <span class="token comment">// 4. Remplace l'effet pour mettre à jour le titre</span>

<span class="token comment">// ...</span></code></pre><p>Tant que l'ordre d'appel aux Hooks est le même d’un affichage à l’autre, React peut associer un état local à chacun d'entre eux. Mais que se passerait-il si nous appelions un Hook (par exemple, l'effet <code>persistForm</code>) de façon conditionnelle ?<pre class="language-js"><code class="language-js">  <span class="token comment">// 🔴 Nous enfreignons la première règle en utilisant un Hook de façon conditionnelle</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>name <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">persistForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">'formData'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre><p>La condition <code>name !== ''</code> est vraie au premier affichage, donc nous exécutons ce Hook. Cependant, lors du prochain affichage l'utilisateur risque de vider le formulaire, ce qui invalidera la condition. À présent que nous sautons ce Hook lors de l’affichage, l'ordre d'appel aux Hooks devient différent :<pre class="language-js"><code class="language-js"><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span>           <span class="token comment">// 1. Lit la variable d'état name (l'argument est ignoré)</span>
<span class="token comment">// useEffect(persistForm)  // 🔴 Ce Hook n'a pas été appelé !</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span>        <span class="token comment">// 🔴 2. (mais était 3). Échoue à lire la variable d'état surname</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>updateTitle<span class="token punctuation">)</span>     <span class="token comment">// 🔴 3. (mais était 4). Échoue à remplacer de l'effet</span></code></pre><p>React ne saurait pas quoi renvoyer lors du second appel au Hook <code>useState</code>. React s'attendait à ce que le deuxième appel à un Hook dans ce composant corresponde à l'effet <code>persistForm</code>, comme lors de l’affichage précédent, mais ce n'est plus le cas. A partir de là, chaque appel à un Hook ultérieur à celui que nous avons sauté sera aussi décalé de un, provoquant des bugs.<p><strong>C'est pourquoi les Hooks doivent être appelés au niveau racine de vos composants.</strong> Si vous voulez exécuter un effet de manière conditionnelle, vous pouvez mettre cette condition <em>à l'intérieur</em> de votre Hook :<pre class="language-js"><code class="language-js">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">persistForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 👍 Nous n’enfreignons plus la première règle</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>name <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">'formData'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>Remarquez que vous n’avez pas à vous inquiéter de ça si vous utilisez <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">le plugin de <em>linter</em> fourni</a>.</strong> Mais maintenant, vous savez <em>pourquoi</em> les Hooks fonctionnent de cette manière et quels problèmes ces règles évitent.</section><section id="next-steps"class="level2"><h2>Prochaines étapes</h2><p>Enfin, nous sommes prêts pour apprendre à <a href="./hooks-custom.html">écrire nos propres Hooks</a> ! Les Hooks personnalisés vous permettent de combiner les Hooks fournis par React pour créer vos propres abstractions et réutiliser une logique d’état commune dans différents composants. <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>