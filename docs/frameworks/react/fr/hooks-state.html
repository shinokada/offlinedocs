<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <title>Utiliser le Hook d’état</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css">
  </head>
  <body>
    <section id="utiliser-le-hook-détat" class="level1">
      <h1>Utiliser le Hook d’état</h1>
      <p>Les <em>Hooks</em> sont une nouveauté de React 16.8. Ils permettent de bénéficier d’un état local et d'autres fonctionnalités de React sans avoir à écrire de classes.</p>
      <p>La <a href="./hooks-intro.html">page d’introduction</a> présentait les Hooks avec cet exemple :</p>
      <pre class="language-js{4-5}"><code class="language-js{4-5}">import React, { useState } from 'react';

function Example() {
  // Déclare une nouvelle variable d'état, que l'on va appeler « count »
  const [count, setCount] = useState(0);

  return (
    &#x3C;div>
      &#x3C;p>Vous avez cliqué {count} fois&#x3C;/p>
      &#x3C;button onClick={() => setCount(count + 1)}>
        Cliquez ici
      &#x3C;/button>
    &#x3C;/div>
  );
}</code></pre>
      <p>Pour commencer à comprendre comment fonctionnent les Hooks, comparons ce code avec un exemple équivalent à base de classe.</p>
      <section id="equivalent-class-example" class="level2">
        <h2>Exemple équivalent avec une classe</h2>
        <p>Si vous avez déjà utilisé les classes en React, ce code devrait vous parler :</p>
        <pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Vous</span> avez cliqué <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">}</span> fois<span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Cliquez</span> ici
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
        <p>L'état démarre à <code>{ count: 0 }</code>, et nous incrémentons <code>state.count</code> en appelant <code>this.setState()</code> lorsque l'utilisateur clique sur le bouton. Nous utiliserons des extraits de cette classe dans tout le reste de cette page.</p>
        <blockquote>
          <p>Remarque</p>
          <p>Vous vous demandez peut-être pourquoi nous utilisons un compteur plutôt qu'un exemple plus réaliste. Ça nous permet tout simplement de nous concentrer sur l'API pendant que nous faisons nos premiers pas avec les Hooks.</p>
        </blockquote>
      </section>
      <section id="hooks-and-function-components" class="level2">
        <h2>Hooks et fonctions composants</h2>
        <p>Pour rappel, les fonctions composants en React ressemblent à ceci :</p>
        <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function"><span class="token maybe-class-name">Example</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Vous pouvez utiliser des Hooks ici !</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>div <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
        <p>ou à ça :</p>
        <pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Example</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Vous pouvez utiliser des Hooks ici !</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>div <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
        <p>Vous les connaissiez peut-être sous le nom de « composants sans état » <em>(Stateless (Functional) Components ou SFC, NdT)</em>. Comme nous avons maintenant la possibilité d'utiliser l'état local React dans ces composants, nous préférerons le terme « fonctions composants ».</p>
        <p>Les Hooks <strong>ne fonctionnent pas</strong> dans les classes. Mais vous pouvez les utiliser pour éviter d'écrire des classes.</p>
      </section>
      <section id="whats-a-hook" class="level2">
        <h2>Un Hook, qu'est-ce que c'est ?</h2>
        <p>Pour notre nouvel exemple, commençons par importer le Hook <code>useState</code> de React :</p>
        <pre class="language-js{1}"><code class="language-js{1}">import React, { useState } from 'react';

function Example() {
  // ...
}</code></pre>
        <p><strong>Qu'est-ce qu'un Hook ?</strong> Un Hook est une fonction qui permet de « se brancher » sur des fonctionnalités React. Par exemple, <code>useState</code> est un Hook qui permet d'ajouter l'état local React à des fonctions composants. Nous en apprendrons plus sur les Hooks par la suite.</p>
        <p><strong>Quand utiliser un Hook ?</strong> Auparavant, si vous écriviez une fonction composant et que vous réalisiez que vous aviez besoin d'un état local à l'intérieur, vous deviez la convertir en classe. Désormais vous pouvez utiliser un Hook à l'intérieur de votre fonction composant. Et c'est justement ce que nous allons faire !</p>
        <blockquote>
          <p>Remarque</p>
          <p>Des règles spécifiques existent pour savoir quand utiliser ou ne pas utiliser les Hooks dans un composant. Nous les découvrirons dans les <a href="./hooks-rules.html">Règles des Hooks</a>.</p>
        </blockquote>
      </section>
      <section id="declaring-a-state-variable" class="level2">
        <h2>Déclarer une variable d'état</h2>
        <p>Dans une classe, on initialise l’état local <code>count</code> à <code>0</code> en définissant <code>this.state</code> à <code>{ count: 0 }</code> dans le constructeur :</p>
        <pre class="language-js{4-6}"><code class="language-js{4-6}">class Example extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      count: 0
    };
  }</code></pre>
        <p>Dans une fonction composant, nous ne pouvons pas écrire ou lire <code>this.state</code> puisqu'il n'y a pas de <code>this</code>. Au lieu de ça, nous appelons directement le Hook <code>useState</code> dans notre composant :</p>
        <pre class="language-js{4,5}"><code class="language-js{4,5}">import React, { useState } from 'react';

function Example() {
  // Déclare une nouvelle variable d'état, que nous appellerons « count »
  const [count, setCount] = useState(0);</code></pre>
        <p><strong>Appeler <code>useState</code>, qu'est-ce que ça fait ?</strong> Ça déclare une « variable d'état ». Notre variable est appelée <code>count</code> mais nous aurions pu l'appeler n'importe comment, par exemple <code>banane</code>. C'est un moyen de « préserver » des valeurs entre différents appels de fonctions. <code>useState</code> est une nouvelle façon d'utiliser exactement les mêmes possibilités qu'offre <code>this.state</code> dans une classe. Normalement, les variables « disparaissent » quand la fonction s'achève mais les variables d'état sont préservées par React.</p>
        <p><strong>Qu'est-ce qu'on passe à <code>useState</code> comme argument ?</strong> Le seul argument à passer au Hook <code>useState()</code> est l'état initial. Contrairement à ce qui se passe dans les classes, l'état local n'est pas obligatoirement un objet. Il peut s’agir d’un nombre ou d’une chaîne de caractères si ça nous suffit. Dans notre exemple, nous voulons simplement le nombre de fois qu'un utilisateur a cliqué sur le bouton, nous passerons donc <code>0</code> comme état initial pour notre variable. (Si nous voulions stocker deux valeurs différentes dans l'état, nous appellerions <code>useState()</code> deux fois.)</p>
        <p><strong>Que renvoie <code>useState</code> ?</strong> Elle renvoie une paire de valeurs : l'état actuel et une fonction pour le modifier. C'est pourquoi nous écrivons <code>const [count, setCount] = useState()</code>. C'est semblable à <code>this.state.count</code> et <code>this.setState</code> dans une classe, mais ici nous les récupérons en même temps. Si vous n'êtes pas à l’aise avec la syntaxe que nous avons employée, nous y reviendrons <a href="./hooks-state.html#tip-what-do-square-brackets-mean">en bas de cette page</a>.</p>
        <p>Maintenant que nous savons ce que fait le Hook <code>useState</code>, notre exemple devrait commencer à être plus clair :</p>
        <pre class="language-js{4,5}"><code class="language-js{4,5}">import React, { useState } from 'react';

function Example() {
  // Déclare une nouvelle variable d'état, que nous appellerons « count »
  const [count, setCount] = useState(0);</code></pre>
        <p>Nous déclarons une variable d‘état appelée <code>count</code>, et l'initialisons à <code>0</code>. React se rappellera sa valeur entre deux affichages et fournira la plus récente à notre fonction. Si nous voulons modifier la valeur de <code>count</code>, nous pouvons appeler <code>setCount</code>.</p>
        <blockquote>
          <p>Remarque</p>
          <p>Vous vous demandez peut-être pourquoi <code>useState</code> n'est pas plutôt appelée <code>createState</code> ?</p>
          <p>En fait, <em>“create”</em> ne serait pas tout à fait correct puisque l'état n’est créé qu’au premier affichage de notre composant. Les fois suivantes, <code>useState</code> nous renvoie l'état actuel. Autrement, ce ne serait pas un état du tout ! Il y a aussi une raison pour laquelle les noms des Hooks commencent <em>toujours</em> par <code>use</code>. Nous découvrirons laquelle plus tard dans les <a href="./hooks-rules.html">Règles des Hooks</a>.</p>
        </blockquote>
      </section>
      <section id="reading-state" class="level2">
        <h2>Lire l'état</h2>
        <p>Quand nous voulons afficher la valeur actuelle de <code>count</code> dans une classe, nous récupérons la valeur de <code>this.state.count</code> :</p>
        <pre class="language-js"><code class="language-js">  <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Vous</span> avez cliqué <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">}</span> fois<span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span></code></pre>
        <p>Dans une fonction, nous pouvons directement utiliser <code>count</code> :</p>
        <pre class="language-js"><code class="language-js">  <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Vous</span> avez cliqué <span class="token punctuation">{</span>count<span class="token punctuation">}</span> fois<span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span></code></pre>
      </section>
      <section id="updating-state" class="level2">
        <h2>Mettre à jour l'état</h2>
        <p>Dans une classe, nous devons appeler <code>this.setState()</code> pour mettre à jour l'état <code>count</code> :</p>
        <pre class="language-js{1}"><code class="language-js{1}">  &#x3C;button onClick={() => this.setState({ count: this.state.count + 1 })}>
    Cliquez ici
  &#x3C;/button></code></pre>
        <p>Dans une fonction, nous récupérons directement <code>setCount</code> et <code>count</code> comme variables, nous n'avons donc pas besoin de <code>this</code> :</p>
        <pre class="language-js{1}"><code class="language-js{1}">  &#x3C;button onClick={() => setCount(count + 1)}>
    Cliquez ici
  &#x3C;/button></code></pre>
      </section>
      <section id="recap" class="level2">
        <h2>En résumé</h2>
        <p>Il est maintenant temps de <strong>récapituler ce que nous avons appris ligne par ligne</strong> et vérifier que nous avons bien compris.</p><!--
          I'm not proud of this line markup. Please somebody fix this.
          But if GitHub got away with it for years we can cheat.
        -->
        <pre class="language-js{1,4,9}"><code class="language-js{1,4,9}"> 1:  import React, { useState } from 'react';
 2:
 3:  function Example() {
 4:    const [count, setCount] = useState(0);
 5:
 6:    return (
 7:      &#x3C;div>
 8:        &#x3C;p>Vous avez cliqué {count} fois&#x3C;/p>
 9:        &#x3C;button onClick={() => setCount(count + 1)}>
10:         Cliquez ici
11:        &#x3C;/button>
12:      &#x3C;/div>
13:    );
14:  }</code></pre>
        <ul>
          <li><strong>Ligne 1 :</strong> nous importons le Hook <code>useState</code> depuis React. Il nous permet d'utiliser un état local dans une fonction composant.</li>
          <li><strong>Ligne 4 :</strong> dans le composant <code>Example</code>, nous déclarons une nouvelle variable d'état en appelant le Hook <code>useState</code>. Il renvoie une paire de valeurs que nous pouvons nommer à notre guise. Ici, nous appelons notre variable <code>count</code> puisqu'elle contient le nombre de clics sur le bouton. Nous l'initialisons à zéro en passant <code>0</code> comme seul argument à <code>useState</code>. Le second élément renvoyé est une fonction. Elle nous permet de modifier la variable <code>count</code>, nous l'appellerons donc <code>setCount</code>.</li>
          <li><strong>Ligne 9 :</strong> quand l'utilisateur clique, nous appelons <code>setCount</code> avec une nouvelle valeur. React rafraîchira le composant <code>Example</code> et lui passera la nouvelle valeur de <code>count</code>.</li>
        </ul>
        <p>Ça fait peut-être beaucoup à digérer d'un coup. Ne vous pressez pas ! Si vous vous sentez un peu perdu·e, jetez un nouveau coup d'œil au code ci-dessus et essayez de le relire du début à la fin. Promis, une fois que vous essaierez « d'oublier » la manière dont fonctionne l'état local dans les classes, et que vous regarderez ce code avec un regard neuf, ça sera plus clair.</p>
        <section id="tip-what-do-square-brackets-mean" class="level3">
          <h3>Astuce : que signifient les crochets ?</h3>
          <p>Vous avez peut-être remarqué les crochets que nous utilisons lorsque nous déclarons une variable d'état :</p>
          <pre class="language-js"><code class="language-js">  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
          <p>Les noms utilisés dans la partie gauche ne font pas partie de l'API React. Vous pouvez nommer vos variables d'état comme ça vous chante :</p>
          <pre class="language-js"><code class="language-js">  <span class="token keyword">const</span> <span class="token punctuation">[</span>fruit<span class="token punctuation">,</span> setFruit<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'banane'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
          <p>Cette syntaxe Javascript est appelée <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Op%C3%A9rateurs/Affecter_par_d%C3%A9composition#D%C3%A9composition_d&#x27;un_tableau">« déstructuration positionnelle »</a>. Ça signifie que nous créons deux nouvelles variables <code>fruit</code> et <code>setFruit</code>, avec <code>fruit</code> qui reçoit la première valeur renvoyée par <code>useState</code>, et <code>setFruit</code> qui reçoit la deuxième. C'est équivalent au code ci-dessous :</p>
          <pre class="language-js"><code class="language-js">  <span class="token keyword">var</span> fruitStateVariable <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'banana'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Renvoie une paire</span>
  <span class="token keyword">var</span> fruit <span class="token operator">=</span> fruitStateVariable<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Premier élément dans une paire</span>
  <span class="token keyword">var</span> setFruit <span class="token operator">=</span> fruitStateVariable<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Deuxième élément dans une paire</span></code></pre>
          <p>Quand nous déclarons une variable d'état avec <code>useState</code>, ça renvoie une paire (un tableau avec deux éléments). Le premier élément est la valeur actuelle, et le deuxième est une fonction qui permet de la modifier. Utiliser <code>[0]</code> et <code>[1]</code> pour y accéder est un peu déconcertant puisqu'ils ont un sens spécifique. C'est pourquoi nous préférons plutôt utiliser la déstructuration positionnelle.</p>
          <blockquote>
            <p>Remarque</p>
            <p>Vous vous demandez peut-être comment React sait à quel composant <code>useState</code> fait référence étant donné que nous ne lui passons plus rien de similaire à <code>this</code>. Nous répondrons à <a href="./hooks-faq.html#how-does-react-associate-hook-calls-with-components">cette question</a> ainsi qu'à plein d'autres dans la section FAQ.</p>
          </blockquote>
        </section>
        <section id="tip-using-multiple-state-variables" class="level3">
          <h3>Astuce : utiliser plusieurs variables d'état</h3>
          <p>Déclarer des variables d'état comme une paire de <code>[quelquechose, setQuelquechose]</code> est également pratique parce que ça nous permet de donner des noms <em>différents</em> à des variables d'état différentes si nous voulons en utiliser plus d'une :</p>
          <pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ExampleWithManyStates</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Déclarer plusieurs variables d'état !</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>age<span class="token punctuation">,</span> setAge<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>fruit<span class="token punctuation">,</span> setFruit<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'banane'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> setTodos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'Apprendre les Hooks'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
          <p>Dans le composant ci-dessus, nous avons <code>age</code>, <code>fruit</code>, et <code>todos</code> comme variables locales, et nous pouvons les modifier indépendamment les unes des autres :</p>
          <pre class="language-js"><code class="language-js">  <span class="token keyword">function</span> <span class="token function">handleOrangeClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Similaire à this.setState({ fruit: 'orange' })</span>
    <span class="token function">setFruit</span><span class="token punctuation">(</span><span class="token string">'orange'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre>
          <p>Utiliser plusieurs variables d'état <strong>n'est pas obligatoire</strong>. Les variables d'état peuvent tout à fait contenir des objets et des tableaux, vous pouvez donc toujours regrouper des données ensemble. Cependant, lorsque l'on modifie une variable d'état sa valeur est <em>remplacée</em> et non fusionnée, contrairement à <code>this.setState</code> dans les classes.</p>
          <p>Découvrez les raisons de préférer séparer vos variables d'état <a href="./hooks-faq.html#should-i-use-one-or-many-state-variables">dans la FAQ</a>.</p>
        </section>
      </section>
      <section id="next-steps" class="level2">
        <h2>Prochaines étapes</h2>
        <p>Dans cette section, vous avez appris à utiliser un des Hooks fournis par React, appelé <code>useState</code>. Nous y ferons parfois référence sous le terme « Hook d'état ». Il nous permet d'ajouter un état local à des fonctions composants React—ce qui est une première !</p>
        <p>Nous en avons également appris un peu plus sur la nature des Hooks. Les Hooks sont des fonctions qui nous permettent de « nous brancher » sur des fonctionnalités React depuis des fonctions composants. Leur noms commencent toujours par <code>use</code>, et il y a encore beaucoup de Hooks que nous n'avons pas encore vus !</p>
        <p>
          <strong>Continuons maintenant en <a href="./hooks-effect.html">découvrant le prochain Hook : <code>useEffect</code>.</a></strong> Il vous permet de déclencher des effets de bord dans les composants, ce qui est similaire aux méthodes de cycle de vie dans les classes.
          <span style="float: footnote;"><a href="./index.html#toc">Go to TOC</a></span>
        </p>
      </section>
    </section>
  </body>
</html>
