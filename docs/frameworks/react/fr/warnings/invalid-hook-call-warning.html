<!doctype html><html lang="fr"><meta charset="utf-8"><title>Les RÃ¨gles des Hooks</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="les-rÃ¨gles-des-hooks"><h1 id="les-rÃ¨gles-des-hooks">Les RÃ¨gles des Hooks</h1><p>Vous Ãªtes probablement ici parce que vous avez reÃ§u ce message d'erreurÂ :</p><consoleblock level="error"><p>Hooks can only be called inside the body of a function component.</p></consoleblock><p><em>(Â«Â Les Hooks ne peuvent Ãªtre appelÃ©s que depuis le corps immÃ©diat d'une fonction composantÂ Â», NdT)</em><p>Il y a trois raisons habituelles derriÃ¨re cette erreurÂ :<ol><li>Vous avez peut-Ãªtre <strong>enfreint les RÃ¨gles des Hooks</strong>.<li>Vous avez peut-Ãªtre des <strong>versions disparates</strong> de React et React DOM.<li>Vous avez peut-Ãªtre <strong>plus d'un exemplaire de React</strong> dans la mÃªme appli.</ol><p>Passons-les en revue.<section class="level2"aria-labelledby="enfreindre-les-rÃ¨gles-des-hooks-breaking-rules-of-hooks"><h2 id="enfreindre-les-rÃ¨gles-des-hooks-breaking-rules-of-hooks">Enfreindre les RÃ¨gles des Hooks {/<em>breaking-rules-of-hooks</em>/}</h2><p>Les fonctions dont les noms commencent par <code>use</code> sont appelÃ©es <a href="/reference/react"><em>Hooks</em></a> en React.<p><strong>N'appelez pas des Hooks au sein de boucles, de conditions ou de fonctions imbriquÃ©es.</strong> Utilisez toujours les Hooks au niveau racine de vos fonctions React, avant tout <code>return</code> anticipÃ©. Vous ne pouvez appelez des Hooks que pendant que React fait le rendu d'une fonction composantÂ :<ul><li>âœ… Appelez-les au niveau racine du corps d'une <a href="/learn/your-first-component">fonction composant</a>.<li>âœ… Appelez-les au niveau racine du corps d'un <a href="/learn/reusing-logic-with-custom-hooks">Hook personnalisÃ©</a>.</ul><pre class="language-js{2-3,8-9}"><code class="language-js{2-3,8-9}">function Counter() {
  // âœ… CorrectÂ : niveau racine dâ€™une fonction composant
  const [count, setCount] = useState(0);
  // ...
}

function useWindowWidth() {
  // âœ… CorrectÂ : niveau racine dâ€™un Hook personnalisÃ©
  const [width, setWidth] = useState(window.innerWidth);
  // ...
}</code></pre><p>Vous <strong>ne pouvez pas</strong> appeler des Hooks (des fonctions dÃ©marrant par <code>use</code>) dans quelque autre cas que ce soit, par exempleÂ :<ul><li>ğŸ”´ N'appelez pas de Hooks dans des conditions ou boucles.<li>ğŸ”´ N'appelez pas de Hooks aprÃ¨s une instruction <code>return</code> conditionnelle.<li>ğŸ”´ N'appelez pas de Hooks dans des gestionnaires d'Ã©vÃ©nements.<li>ğŸ”´ N'appelez pas de Hooks dans des composants Ã  base de classes.<li>ğŸ”´ N'appelez pas de Hooks dans des fonctions passÃ©es Ã  <code>useMemo</code>, <code>useReducer</code> ou <code>useEffect</code>.</ul><p>Si vous enfreignez ces rÃ¨gles, vous verrez sans doute cette erreur.<pre class="language-js{3-4,11-12,20-21}"><code class="language-js{3-4,11-12,20-21}">function Bad({ cond }) {
  if (cond) {
    // ğŸ”´ ErronÃ©Â : dans une condition (sortez-en lâ€™appelÂ !)
    const theme = useContext(ThemeContext);
  }
  // ...
}

function Bad() {
  for (let i = 0; i &#x3C; 10; i++) {
    // ğŸ”´ ErronÃ©Â : dans une boucle (sortez-en lâ€™appelÂ !)
    const theme = useContext(ThemeContext);
  }
  // ...
}

function Bad({ cond }) {
  if (cond) {
    return;
  }
  // ğŸ”´ ErronÃ©Â : aprÃ¨s un `return` conditionnel (dÃ©placez lâ€™appel avantÂ !)
  const theme = useContext(ThemeContext);
  // ...
}

function Bad() {
  function handleClick() {
    // ğŸ”´ ErronÃ©Â : dans un gestionnaire dâ€™Ã©vÃ©nement (sortez-en lâ€™appelÂ !)
    const theme = useContext(ThemeContext);
  }
  // ...
}

function Bad() {
  const style = useMemo(() => {
    // ğŸ”´ ErronÃ©Â : dans `useMemo` (sortez-en lâ€™appelÂ !)
    const theme = useContext(ThemeContext);
    return createStyle(theme);
  });
  // ...
}

class Bad extends React.Component {
  render() {
    // ğŸ”´ ErronÃ©Â : dans un composant Ã  base de classe (utilisez une fonction composantÂ !)
    useEffect(() => {})
    // ...
  }
}</code></pre><p>Vous pouvez utiliser le <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">plugin <code>eslint-plugin-react-hooks</code></a> pour dÃ©tecter ces erreurs.</p><note><p><a href="/learn/reusing-logic-with-custom-hooks">Les Hooks personnalisÃ©s</a> <em>peuvent</em> appeler d'autres Hooks (c'est leur raison d'Ãªtre). Ã‡a fonctionne parce que les Hooks personnalisÃ©s sont eux-mÃªmes supposÃ©s n'Ãªtre appelÃ©s que pendant le rendu d'une fonction composant.</p></note></section><section class="level2"aria-labelledby="versions-disparates-de-react-et-react-dom-mismatching-versions-of-react-and-react-dom"><h2 id="versions-disparates-de-react-et-react-dom-mismatching-versions-of-react-and-react-dom">Versions disparates de React et React DOM {/<em>mismatching-versions-of-react-and-react-dom</em>/}</h2><p>Vous utilisez peut-Ãªtre une version de <code>react-dom</code> (&#x3C; 16.8.0) ou de <code>react-native</code> (&#x3C; 0.59) qui ne prend pas encore en charge les Hooks. Vous pouvez exÃ©cuter <code>npm ls react-dom</code> ou <code>npm ls react-native</code> dans le dossier de votre application pour vÃ©rifier la version que vous utilisez. Si vous en trouvez plus d'une, Ã§a peut aussi crÃ©er des problÃ¨mes (on en reparle juste en-dessous).</section><section class="level2"aria-labelledby="multiples-copies-de-react-duplicate-react"><h2 id="multiples-copies-de-react-duplicate-react">Multiples copies de React {/<em>duplicate-react</em>/}</h2><p>Pour que les Hooks fonctionnent, l'import de <code>react</code> dans votre code applicatif doit amener au mÃªme module que l'import de <code>react</code> depuis le module <code>react-dom</code>.<p>Si ces imports de <code>react</code> amÃ¨nent Ã  des objets d'export distincts, vous verrez cet avertissement. Ã‡a peut arriver quand vous <strong>vous retrouvez par inadvertance avec deux copies</strong> du module <code>react</code>.<p>Si vous utilisez Node pour gÃ©rer vos modules, vous pouvez lancer la vÃ©rification suivante depuis le dossier de votre projetÂ :</p><terminalblock><p>npm ls react</p></terminalblock><p>Si vous voyez plus d'un React, vous devrez dÃ©terminer d'oÃ¹ Ã§a vient et corriger votre arbre de dÃ©pendances. Peut-Ãªtre par exemple qu'une bibliothÃ¨que que vous utilisez spÃ©cifie Ã  tort <code>react</code> comme dÃ©pendance (plutÃ´t que comme dÃ©pendance sur module pair <em>(peer dependency, NdT)</em>). Tant que cette bibliothÃ¨que ne sera pas corrigÃ©e, un contournement possible consiste Ã  utiliser les <a href="https://yarnpkg.com/configuration/manifest#resolutions">rÃ©solutions Yarn</a>.<p>Vous pouvez aussi tenter de dÃ©boguer le problÃ¨me en ajoutant des logs Ã  des endroits stratÃ©giques et en redÃ©marrant votre serveur de dÃ©veloppementÂ :<pre class="language-js"><code class="language-js"><span class="token comment">// Ajoutez Ã§a dans node_modules/react-dom/index.js</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">React1</span></span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Ajoutez Ã§a dans votre code applicatif</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react-dom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">React2</span></span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">React1</span></span> <span class="token operator">===</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">React2</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Si Ã§a affiche <code>false</code> alors vous avez probablement deux Reacts et devez en dÃ©terminer la cause. <a href="https://github.com/facebook/react/issues/13991">Ce ticket</a> dÃ©taille quelques raisons rencontrÃ©es par la communautÃ©.<p>Ce problÃ¨me peut aussi survenir lorsque vous utilisez <code>npm link</code> ou un Ã©quivalent. Dans un tel cas, votre <em>bundler</em> pourrait Â«Â voirÂ Â» deux Reacts â€”Â un dans votre dossier applicatif et un dans votre dossier de bibliothÃ¨que. En supposant que <code>myapp</code> et <code>mylib</code> sont des dossiers de mÃªme niveau, un correctif possible consiste Ã  exÃ©cuter <code>npm link ../myapp/node_modules/react</code> depuis <code>mylib</code>. Ã‡a devrait faire en sorte que la bibliothÃ¨que utilise bien la copie de React du dossier applicatif.</p><note><p>En gÃ©nÃ©ral, React prend en charge plusieurs copies indÃ©pendantes sur une mÃªme page (si par exemple une appli et un widget tiers s'en servent tous les deux). Ã‡a ne pose problÃ¨me que si <code>require('react')</code> ou <code>import from 'react'</code> rÃ©solvent diffÃ©remment entre un composant et la copie de <code>react-dom</code> qui assure son rendu.</p></note></section><section class="level2"aria-labelledby="autres-causes-other-causes"><h2 id="autres-causes-other-causes">Autres causes {/<em>other-causes</em>/}</h2><p>Si rien de tout Ã§a n'a rÃ©solu le souci, merci d'ajouter un commentaire Ã  <a href="https://github.com/facebook/react/issues/13991">ce ticket</a>, nous essaierons de vous aider. Essayez de crÃ©er un cas minimal reproductible pour appuyer votre demande â€”Â vous pourriez d'ailleurs trouver l'origine du problÃ¨me Ã  cette occasion. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>