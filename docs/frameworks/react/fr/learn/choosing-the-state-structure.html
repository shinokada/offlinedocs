<!doctype html><html lang="fr"><meta charset="utf-8"><title>Choisir la structure de l’état</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="choisir-la-structure-de-létat"><h1 id="choisir-la-structure-de-létat">Choisir la structure de l’état</h1><intro><p>Bien structurer l’état peut faire toute la différence entre un composant agréable à modifier et déboguer, et un composant qui est une source constante de bugs. Voici des conseils que vous devriez prendre en compte pour structurer vos états.</p></intro><youwilllearn><ul><li>Quand utiliser une vs. plusieurs variables d'état<li>Les pièges à éviter en organisant l’état<li>Comment résoudre les problèmes courants de structure de l’état</ul></youwilllearn><section class="level2"aria-labelledby="principes-de-structuration-détat-principles-for-structuring-state"><h2 id="principes-de-structuration-détat-principles-for-structuring-state">Principes de structuration d’état {/<em>principles-for-structuring-state</em>/}</h2><p>Quand vous créez un composant qui contient des états, vous devez faire des choix sur le nombre de variables d’état à utiliser et la forme de leurs données. Même s'il est possible d’écrire des programmes corrects avec une structure d’état sous-optimale, il y a quelques principes qui peuvent vous guider pour faire de meilleurs choix :<ol><li><strong>Regroupez les états associés.</strong> Si vous mettez tout le temps à jour plusieurs variables d’état à la fois, essayez de les fusionner en une seule variable d’état.<li><strong>Évitez les contradictions dans l’état.</strong> Quand l’état est structuré de sorte que plusieurs parties d’état puissent être contradictoires, des erreurs peuvent survenir. Essayez d’éviter ça.<li><strong>Évitez les états redondants.</strong> Si vous pouvez calculer des informations à partir des props du composant ou de ses variables d'état existantes pendant le rendu, vous ne devriez pas mettre ces informations dans un état du composant.<li><strong>Évitez la duplication d’états.</strong> Lorsque la même donnée est dupliquée entre plusieurs variables d’état ou dans des objets imbriqués, il devient difficile de les garder synchronisées. Réduisez la duplication dans toute la mesure du possible.<li><strong>Évitez les états fortement imbriqués.</strong> Un état fortement hiérarchisé n’est pas très pratique à mettre à jour. Quand c’est possible, priorisez une structure d'état plate.</ol><p>Ces principes visent à <em>rendre l’état simple à actualiser sans créer d’erreurs</em>. Retirer les données redondantes et dupliquées de l’état aide à s’assurer que toutes ses parties restent synchronisées. C’est un peu comme un ingénieur de bases de données qui souhaite <a href="https://learn.microsoft.com/fr-fr/office/troubleshoot/access/database-normalization-description">« normaliser » la structure de la base de données</a> pour réduire les risques de bugs. Pour paraphraser Albert Einstein : <strong>« Faites que votre état soit le plus simple possible — mais pas plus simple. »</strong><p>Maintenant voyons comment ces principes s’appliquent concrètement.</section><section class="level2"aria-labelledby="regrouper-les-états-associés-group-related-state"><h2 id="regrouper-les-états-associés-group-related-state">Regrouper les états associés {/<em>group-related-state</em>/}</h2><p>Vous hésitez peut-être parfois entre utiliser une ou plusieurs variables d’état.<p>Devriez-vous faire ça ?<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> setX<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>y<span class="token punctuation">,</span> setY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Ou ça ?<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>position<span class="token punctuation">,</span> setPosition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Techniquement, les deux approches sont possibles. Mais <strong>si deux variables d’état changent toujours ensemble, ce serait une bonne idée de les réunir en une seule variable d’état</strong>. Vous n’oublierez ainsi pas ensuite de les garder synchronisées, comme dans cet exemple où les mouvements du curseur mettent à jour les deux coordonnées du point rouge.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MovingDot</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>position<span class="token punctuation">,</span> setPosition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div
      onPointerMove<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">x</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">clientX</span><span class="token punctuation">,</span>
          <span class="token literal-property property">y</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">clientY</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'relative'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'100vw'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'100vh'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">borderRadius</span><span class="token operator">:</span> <span class="token string">'50%'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>position<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>position<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">250</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>Une autre situation dans laquelle vous pouvez regrouper des données dans un objet ou une liste, c'est lorsque vous ne savez pas à l'avance de combien d'éléments d'état vous aurez besoin. Par exemple, c’est utile pour un formulaire dans lequel l’utilisateur peut ajouter des champs personnalisés.</p><pitfall><p>Si votre variable d’état est un objet, souvenez-vous que <a href="/learn/updating-objects-in-state">vous ne pouvez pas mettre à jour qu’un seul champ</a> sans explicitement copier les autres champs. Par exemple, vous ne pouvez pas faire <code>setPosition({ x: 100 })</code> dans l’exemple ci-dessus car il n’y aurait plus du tout la propriété <code>y</code> ! Au lieu de ça, si vous vouliez définir <code>x</code> tout seul, soit vous feriez <code>setPosition({ ...position, x: 100 })</code>, soit vous découperiez l'information en deux variables d’état et feriez <code>setX(100)</code>.</p></pitfall></section><section class="level2"aria-labelledby="évitez-les-contradictions-dans-létat-avoid-contradictions-in-state"><h2 id="évitez-les-contradictions-dans-létat-avoid-contradictions-in-state">Évitez les contradictions dans l’état {/<em>avoid-contradictions-in-state</em>/}</h2><p>Voici un questionnaire de satisfaction d’hôtel avec les variables d’état <code>isSending</code> et <code>isSent</code> :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FeedbackForm</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isSending<span class="token punctuation">,</span> setIsSending<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isSent<span class="token punctuation">,</span> setIsSent<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setIsSending</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">await</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setIsSending</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setIsSent</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isSent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Merci</span> pour votre retour <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Comment</span> était votre séjour au <span class="token maybe-class-name">Poney</span> <span class="token maybe-class-name">Fringant </span><span class="token operator">?</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>textarea
        disabled<span class="token operator">=</span><span class="token punctuation">{</span>isSending<span class="token punctuation">}</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>br <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button
        disabled<span class="token operator">=</span><span class="token punctuation">{</span>isSending<span class="token punctuation">}</span>
        type<span class="token operator">=</span><span class="token string">"submit"</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Envoyer</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>isSending <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Envoi</span><span class="token spread operator">...</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Prétend envoyer un message.</span>
<span class="token keyword">function</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>Même si ce code marche, il laisse la place à des états « impossibles ». Par exemple, si vous oubliez d’appeler <code>setIsSent</code> et <code>setIsSending</code> ensemble, vous pouvez finir dans une situation où les deux variables <code>isSending</code> et <code>isSent</code> sont à <code>true</code> au même moment. Plus votre composant est complexe, plus il est dur de comprendre ce qu’il s’est passé.<p><strong>Comme <code>isSending</code> et <code>isSent</code> ne doivent jamais être à <code>true</code> au même moment, il est préférable de les remplacer par une variable d’état <code>status</code> qui peut prendre l’un des <em>trois</em> états valides :</strong> <code>'typing'</code> (initial), <code>'sending'</code>, et <code>'sent'</code> :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FeedbackForm</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>status<span class="token punctuation">,</span> setStatus<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'typing'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">'sending'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">await</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">'sent'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> isSending <span class="token operator">=</span> status <span class="token operator">===</span> <span class="token string">'sending'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isSent <span class="token operator">=</span> status <span class="token operator">===</span> <span class="token string">'sent'</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isSent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Merci</span> pour votre retour <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Comment</span> était votre séjour au <span class="token maybe-class-name">Poney</span> <span class="token maybe-class-name">Fringant </span><span class="token operator">?</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>textarea
        disabled<span class="token operator">=</span><span class="token punctuation">{</span>isSending<span class="token punctuation">}</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>br <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button
        disabled<span class="token operator">=</span><span class="token punctuation">{</span>isSending<span class="token punctuation">}</span>
        type<span class="token operator">=</span><span class="token string">"submit"</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Envoyer</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>isSending <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Envoi</span><span class="token spread operator">...</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Prétend envoyer un message.</span>
<span class="token keyword">function</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>Vous pouvez toujours déclarer quelques constantes pour plus de lisibilité :<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> isSending <span class="token operator">=</span> status <span class="token operator">===</span> <span class="token string">'sending'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isSent <span class="token operator">=</span> status <span class="token operator">===</span> <span class="token string">'sent'</span><span class="token punctuation">;</span></code></pre><p>Mais ce ne sont pas des variables d’état, vous n'avez donc pas à vous soucier de leur désynchronisation.</section><section class="level2"aria-labelledby="évitez-les-états-redondants-avoid-redundant-state"><h2 id="évitez-les-états-redondants-avoid-redundant-state">Évitez les états redondants {/<em>avoid-redundant-state</em>/}</h2><p>Si vous pouvez calculer certaines informations depuis les props d’un composant ou une de ses variables d’état existantes pendant le rendu, vous ne <strong>devez pas</strong> mettre ces informations dans l’état du composant<p>Par exemple, prenez ce formulaire. Il marche, mais pouvez-vous y trouver un état redondant ?</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> setFirstName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>lastName<span class="token punctuation">,</span> setLastName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>fullName<span class="token punctuation">,</span> setFullName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleFirstNameChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setFirstName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setFullName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> lastName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleLastNameChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setLastName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setFullName</span><span class="token punctuation">(</span>firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Enregistrons</span> votre arrivée<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token literal-property property">Prénom</span> <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>firstName<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleFirstNameChange<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token literal-property property">Nom</span> <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>lastName<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleLastNameChange<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Votre</span> billet sera au nom de <span class="token operator">:</span> <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>fullName<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>Ce formulaire possède trois variables d’état : <code>firstName</code>, <code>lastName</code> et <code>fullName</code>. Cependant, <code>fullName</code> est redondant. <strong>Vous pouvez toujours calculer <code>fullName</code> depuis <code>firstName</code> et <code>lastName</code> pendant le rendu, donc retirez-le de l’état.</strong><p>Voici comment vous pouvez faire :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> setFirstName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>lastName<span class="token punctuation">,</span> setLastName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> fullName <span class="token operator">=</span> firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> lastName<span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleFirstNameChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setFirstName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleLastNameChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setLastName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Enregistrons</span> votre arrivée<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token literal-property property">Prénom</span> <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>firstName<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleFirstNameChange<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token literal-property property">Nom</span> <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>lastName<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleLastNameChange<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Votre</span> billet sera au nom de <span class="token operator">:</span> <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>fullName<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>Ici, <code>fullName</code> n’est <em>pas</em> une variable d’état. Elle est plutôt évaluée pendant le rendu :<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fullName <span class="token operator">=</span> firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> lastName<span class="token punctuation">;</span></code></pre><p>Par conséquent, les gestionnaires de changement n’auront rien à faire pour le mettre à jour. Lorsque vous appelez <code>setFirstName</code> ou <code>setLastName</code>, vous déclenchez un nouveau rendu, et le prochain <code>fullName</code> sera calculé à partir des nouvelles données.</p><deepdive><section class="level4"aria-labelledby="ne-dupliquez-pas-les-props-dans-létat-don-t-mirror-props-in-state"><h4 id="ne-dupliquez-pas-les-props-dans-létat-don-t-mirror-props-in-state">Ne dupliquez pas les props dans l’état {/<em>don-t-mirror-props-in-state</em>/}</h4><p>Un exemple commun d’état redondant recourt à ce genre de code :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Message</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> messageColor <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>messageColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Ici, la prop <code>messageColor</code> est passée comme valeur initiale de la variable d’état <code>color</code>. Le problème est que <strong>si le composant parent transmet une valeur différente dans <code>messageColor</code> plus tard (par exemple, <code>'red'</code> au lieu de <code>'blue'</code>), la variable d’état <code>color</code> ne sera pas mise à jour</strong> ! L’état est seulement initialisé lors du rendu initial.<p>C’est pourquoi la "duplication" de certaines props dans des variables d’état peut être déroutante. Utilisez de préférence directement la prop <code>messageColor</code> dans votre code. Si vous voulez lui donner un nom plus court, utilisez une constante :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Message</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> messageColor <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> color <span class="token operator">=</span> messageColor<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>De cette manière, le composant ne sera pas désynchronisé avec la prop qui lui aura été transmise par le composant parent.<p>« Dupliquer » les props dans l’état n'est pertinent que lorsque vous <em>voulez</em> ignorer toutes les mises à jour d’une certaine prop. Par convention, ajoutez <code>initial</code> ou <code>default</code> au début du nom de la prop pour préciser que ses nouvelles valeurs seront ignorées :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Message</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> initialColor <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// La variable d’état `color` contient la *première* valeur de `initialColor`.</span>
  <span class="token comment">// Les changements ultérieurs de la prop `initialColor` seront ignorés.</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section></deepdive></section><section class="level2"aria-labelledby="évitez-la-duplication-détats-avoid-duplication-in-state"><h2 id="évitez-la-duplication-détats-avoid-duplication-in-state">Évitez la duplication d’états {/<em>avoid-duplication-in-state</em>/}</h2><p>Ce composant de carte de menu vous permet de choisir un seul en-cas de voyage parmi plusieurs :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialItems <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Menu</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>items<span class="token punctuation">,</span> setItems<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>selectedItem<span class="token punctuation">,</span> setSelectedItem<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>
    items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Quel</span> est votre goûter de voyage <span class="token operator">?</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
            <span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
            <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
              <span class="token function">setSelectedItem</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Choisissez</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Vous</span> avez choisi <span class="token punctuation">{</span>selectedItem<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>À ce stade, il stocke l’élément selectionné en tant qu’objet dans la variable d’état <code>selectedItem</code>. Cependant, ce n’est pas optimal : <strong>le contenu de <code>selectedItem</code> est le même objet que l’un des éléments de la liste <code>items</code>.</strong> Ça signifie que les informations relatives à l’élément sont dupliquées à deux endroits.<p>Pourquoi est-ce un problème ? Rendons chaque objet modifiable :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialItems <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Menu</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>items<span class="token punctuation">,</span> setItems<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>selectedItem<span class="token punctuation">,</span> setSelectedItem<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>
    items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleItemChange</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
          <span class="token spread operator">...</span>item<span class="token punctuation">,</span>
          # e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> item<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Quel</span> est votre goûter de voyage <span class="token operator">?</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token operator">&#x3C;</span>input
              value<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
              onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
                <span class="token function">handleItemChange</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
              <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
            <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
              <span class="token function">setSelectedItem</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Choisissez</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Vous</span> avez choisi <span class="token punctuation">{</span>selectedItem<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>Remarquez que si vous cliquez d’abord sur « Choisissez » un élément <em>puis</em> que vous le modifiez, <strong>le champ se met à jour, mais le libellé en bas reste inchangé</strong>. C’est parce que vous avez dupliqué l’état, et que vous avez oublié de mettre à jour <code>selectedItem</code>.<p>Même si vous pourriez également mettre à jour <code>selectedItem</code>, une solution plus simple consiste à supprimer la duplication. Dans cet exemple, au lieu d’un objet <code>selectedItem</code> (ce qui crée une duplication des éléments dans <code>items</code>), vous gardez le <code>selectedId</code> dans l’état, <em>puis</em> obtenez le <code>selectedItem</code> en cherchant dans la liste <code>items</code> un élément avec cet ID :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialItems <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Menu</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>items<span class="token punctuation">,</span> setItems<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>selectedId<span class="token punctuation">,</span> setSelectedId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> selectedItem <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span>
    item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> selectedId
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleItemChange</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
          <span class="token spread operator">...</span>item<span class="token punctuation">,</span>
          # e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> item<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Quel</span> est votre goûter de voyage <span class="token operator">?</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token operator">&#x3C;</span>input
              value<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
              onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
                <span class="token function">handleItemChange</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
              <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
            <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
              <span class="token function">setSelectedId</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Choisissez</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Vous</span> avez choisi <span class="token punctuation">{</span>selectedItem<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>L’état était dupliqué de cette façon :<p>Mais après nos changements, il a la structure suivante :<ul><li><code>selectedId = 0</code></ul><p>La duplication a disparu, et vous ne conservez que l’état essentiel !<p>Maintenant si vous modifiez l’élément <em>sélectionné</em>, le message en dessous sera mis à jour immédiatement. C’est parce que <code>setItems</code> déclenche un nouveau rendu, et <code>items.find(...)</code> trouve l’élément dont le titre a été mis à jour. Il n’est pas nécessaire de conserver <em>l’objet sélectionné</em> dans l’état, car seul l’<em>ID sélectionné</em> est essentiel. Le reste peut être calculé lors du rendu.</section><section class="level2"aria-labelledby="évitez-les-états-fortement-imbriqués-avoid-deeply-nested-state"><h2 id="évitez-les-états-fortement-imbriqués-avoid-deeply-nested-state">Évitez les états fortement imbriqués {/<em>avoid-deeply-nested-state</em>/}</h2><p>Imaginez un plan de voyage composé de planètes, de continents et de pays. Vous pourriez être tenté·e de structurer son état à l’aide de listes et d’objets imbriqués, comme dans cet exemple :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialTravelPlan <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./places.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">PlaceTree</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> place <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> childPlaces <span class="token operator">=</span> place<span class="token punctuation">.</span><span class="token property-access">childPlaces</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li<span class="token operator">></span>
      <span class="token punctuation">{</span>place<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
      <span class="token punctuation">{</span>childPlaces<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&#x26;&#x26;</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>ol<span class="token operator">></span>
          <span class="token punctuation">{</span>childPlaces<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">place</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
            <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PlaceTree</span> key<span class="token operator">=</span><span class="token punctuation">{</span>place<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span> place<span class="token operator">=</span><span class="token punctuation">{</span>place<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>ol<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TravelPlan</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>plan<span class="token punctuation">,</span> setPlan<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialTravelPlan<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> planets <span class="token operator">=</span> plan<span class="token punctuation">.</span><span class="token property-access">childPlaces</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Lieux</span> à visiter<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ol<span class="token operator">></span>
        <span class="token punctuation">{</span>planets<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">place</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PlaceTree</span> key<span class="token operator">=</span><span class="token punctuation">{</span>place<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span> place<span class="token operator">=</span><span class="token punctuation">{</span>place<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ol<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> initialTravelPlan <span class="token operator">=</span> <span class="token punctuation">{</span>
  # <span class="token string">'(Root)'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    # <span class="token string">'Terre'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      # <span class="token string">'Afrique'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        # <span class="token string">'Botswana'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Egypte'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Kenya'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Madagascar'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Maroc'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Nigéria'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Afrique du Sud'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      # <span class="token string">'Amérique'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        # <span class="token string">'Argentine'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Brésil'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Barbade'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Canada'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Jamaïque'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Mexique'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # '<span class="token maybe-class-name">Trinité</span><span class="token operator">-</span>et<span class="token operator">-</span><span class="token maybe-class-name">Tobté</span><span class="token operator">-</span>et<span class="token operator">-</span>childPlaces<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Venezuela'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      # <span class="token string">'Asie'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        # <span class="token string">'Chine'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Inde'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Singapour'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Corée du Sud'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Thaïlande'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Viêt Nam'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      # <span class="token string">'Europe'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        # <span class="token string">'Croatie'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'France'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Allemagne'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Italie'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Portugal'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Espagne'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Turquie'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      # <span class="token string">'Océanie'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        # <span class="token string">'Australie'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Bora Bora (Polynésie française)'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Île de Pâques (Chili)'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Fidji'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Hawaï (États-Unis)'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Nouvelle-Zélande'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        # <span class="token string">'Vanuatu'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    # <span class="token string">'Lune'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      # <span class="token string">'Rheita'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      # <span class="token string">'Piccolomini'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      # <span class="token string">'Tycho'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    # <span class="token string">'Mars'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      # <span class="token string">'Corn Town'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      # <span class="token string">'Green Hill'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childPlaces</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></sandpack><p>Imaginons maintenant que vous souhaitiez ajouter un bouton pour supprimer un lieu que vous avez déjà visité. Comment procéder ? <a href="/learn/updating-objects-in-state#updating-a-nested-object">La mise à jour d’un état imbriqué</a> implique de faire des copies des objets en remontant depuis la partie qui a changé. Supprimer un lieu profondément imbriqué consisterait à copier tous les niveaux supérieurs. Un tel code peut être très long.<p><strong>Si l’état est trop imbriqué pour être mis à jour facilement, envisagez de « l’aplatir ».</strong> Voici une façon de restructurer ces données. Au lieu d’une structure arborescente où chaque <em>lieu</em> possède une liste de <em>ses lieux enfants</em>, chaque lieu peut posséder une liste des <em>ID de ses lieux enfants</em>. Vous pouvez alors stocker une table de correspondance entre chaque ID de lieu et le lieu correspondant.<p>Cette restructuration des données pourrait vous rappeler une table de base de données :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialTravelPlan <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./places.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">PlaceTree</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> id<span class="token punctuation">,</span> placesById <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> place <span class="token operator">=</span> placesById<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> childIds <span class="token operator">=</span> place<span class="token punctuation">.</span><span class="token property-access">childIds</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li<span class="token operator">></span>
      <span class="token punctuation">{</span>place<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
      <span class="token punctuation">{</span>childIds<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&#x26;&#x26;</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>ol<span class="token operator">></span>
          <span class="token punctuation">{</span>childIds<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">childId</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
            <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PlaceTree</span>
              key<span class="token operator">=</span><span class="token punctuation">{</span>childId<span class="token punctuation">}</span>
              id<span class="token operator">=</span><span class="token punctuation">{</span>childId<span class="token punctuation">}</span>
              placesById<span class="token operator">=</span><span class="token punctuation">{</span>placesById<span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>ol<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TravelPlan</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>plan<span class="token punctuation">,</span> setPlan<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialTravelPlan<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> root <span class="token operator">=</span> plan<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> planetIds <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token property-access">childIds</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Lieux</span> à visiter<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ol<span class="token operator">></span>
        <span class="token punctuation">{</span>planetIds<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PlaceTree</span>
            key<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>
            id<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>
            placesById<span class="token operator">=</span><span class="token punctuation">{</span>plan<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ol<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> initialTravelPlan <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'(Root)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Terre'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Afrique'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span> <span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Botswana'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Egypte'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Kenya'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Madagascar'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Maroc'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">8</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Nigéria'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">9</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Afrique du Sud'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">10</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Amerique'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Argentine'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">12</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Brésil'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">13</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Barbade'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">14</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Canada'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">15</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Jamaïque'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">16</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Mexique'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">17</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Trinité-et-Tobago'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">18</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Venezuela'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">19</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Asie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">20</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Chine'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">21</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'India'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Singapour'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">23</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Corée du Sud'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">24</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Thaïlande'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">25</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Viêt Nam'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">26</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Europe'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">27</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Croatie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">28</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'France'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">29</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Allemagne'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">30</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Italie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">31</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Portugal'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">32</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Spain'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Turquie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">34</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Océanie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">35</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Australie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">36</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Bora Bora (Polynésie française)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">37</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Île de Pâques (Chili)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">38</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Fidji'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">39</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Hawaï (USA)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">40</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Nouvelle-Zélande'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">41</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Vanuatu'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">42</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Lune'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">43</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Rheita'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">44</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Piccolomini'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">45</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Tycho'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">46</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Mars'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">47</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Corn Town'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">48</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Green Hill'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></sandpack><p><strong>Maintenant que l’état est « plat » (on pourrait aussi dire « normalisé »), mettre à jour des éléments imbriqués devient plus simple.</strong><p>Désormais, afin d’enlever un lieu, vous n'avez besoin de mettre à jour que deux niveaux d’état :<ul><li>La version à jour de son lieu <em>parent</em> devrait exclure l’ID supprimé de sa liste <code>childIds</code>.<li>La version à jour de la « table » racine d’objets doit inclure la version à jour du lieu parent.</ul><p>Voici un exemple de comment vous pourriez procéder :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialTravelPlan <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./places.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TravelPlan</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>plan<span class="token punctuation">,</span> setPlan<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialTravelPlan<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleComplete</span><span class="token punctuation">(</span><span class="token parameter">parentId<span class="token punctuation">,</span> childId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> parent <span class="token operator">=</span> plan<span class="token punctuation">[</span>parentId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// Créer une nouvelle version du lieu parent</span>
    <span class="token comment">// qui n’inclut pas l’ID de son enfant.</span>
    <span class="token keyword">const</span> nextParent <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token spread operator">...</span>parent<span class="token punctuation">,</span>
      <span class="token literal-property property">childIds</span><span class="token operator">:</span> parent<span class="token punctuation">.</span><span class="token property-access">childIds</span>
        <span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token arrow operator">=></span> id <span class="token operator">!==</span> childId<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Mettre à jour l’état de l’objet d’origine...</span>
    <span class="token function">setPlan</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token spread operator">...</span>plan<span class="token punctuation">,</span>
      <span class="token comment">// ...pour qu’il ait le parent à jour</span>
      <span class="token punctuation">[</span>parentId<span class="token punctuation">]</span><span class="token operator">:</span> nextParent
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> root <span class="token operator">=</span> plan<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> planetIds <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token property-access">childIds</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Lieux</span> à visiter<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ol<span class="token operator">></span>
        <span class="token punctuation">{</span>planetIds<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PlaceTree</span>
            key<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>
            id<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>
            parentId<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span>
            placesById<span class="token operator">=</span><span class="token punctuation">{</span>plan<span class="token punctuation">}</span>
            onComplete<span class="token operator">=</span><span class="token punctuation">{</span>handleComplete<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ol<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">PlaceTree</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> id<span class="token punctuation">,</span> parentId<span class="token punctuation">,</span> placesById<span class="token punctuation">,</span> onComplete <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> place <span class="token operator">=</span> placesById<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> childIds <span class="token operator">=</span> place<span class="token punctuation">.</span><span class="token property-access">childIds</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li<span class="token operator">></span>
      <span class="token punctuation">{</span>place<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onComplete</span><span class="token punctuation">(</span>parentId<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token constant">C</span>’est fait
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>childIds<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&#x26;&#x26;</span>
        <span class="token operator">&#x3C;</span>ol<span class="token operator">></span>
          <span class="token punctuation">{</span>childIds<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">childId</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
            <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PlaceTree</span>
              key<span class="token operator">=</span><span class="token punctuation">{</span>childId<span class="token punctuation">}</span>
              id<span class="token operator">=</span><span class="token punctuation">{</span>childId<span class="token punctuation">}</span>
              parentId<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>
              placesById<span class="token operator">=</span><span class="token punctuation">{</span>placesById<span class="token punctuation">}</span>
              onComplete<span class="token operator">=</span><span class="token punctuation">{</span>onComplete<span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>ol<span class="token operator">></span>
      <span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> initialTravelPlan <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'(Root)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Terre'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Afrique'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span> <span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Botswana'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Egypte'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Kenya'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Madagascar'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Maroc'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">8</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Nigéria'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">9</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Afrique du Sud'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">10</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Amérique'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Argentine'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">12</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Brésil'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">13</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Barbade'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">14</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Canada'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">15</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Jamaïque'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">16</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Mexique'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">17</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Trinité-et-Tobago'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">18</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Venezuela'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">19</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Asie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">20</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Chine'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">21</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'India'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Singapour'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">23</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Corée du Sud'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">24</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Thaïlande'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">25</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Viêt Nam'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">26</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Europe'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">27</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Croatie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">28</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'France'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">29</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Allemagne'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">30</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Italie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">31</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Portugal'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">32</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Spain'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Turquie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">34</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Océanie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">35</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Australie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">36</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Bora Bora (Polynésie française)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">37</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Île de Pâques (Chili)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">38</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Fidji'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">39</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Hawaï (États-Unis)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">40</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Nouvelle-Zélande'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">41</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Vanuatu'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">42</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Lune'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">43</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Rheita'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">44</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Piccolomini'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">45</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Tycho'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">46</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Mars'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">47</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Corn Town'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">48</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Green Hill'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>Vous pouvez imbriquer des états autant que vous le souhaitez, mais les rendre « plats » peut résoudre de nombreux problèmes. Ça facilite la mise à jour de l’état, et ça permet de s’assurer qu’il n’y a pas de duplication dans les différentes parties d’un objet imbriqué.</p><deepdive><section class="level4"aria-labelledby="consommer-moins-de-mémoire-improving-memory-usage"><h4 id="consommer-moins-de-mémoire-improving-memory-usage">Consommer moins de mémoire {/<em>improving-memory-usage</em>/}</h4><p>Idéalement, vous devriez également enlever les éléments supprimés (et leurs enfants !) depuis l’objet « table » pour consommer moins de mémoire. C’est ce que fait cette version. Elle utilise également <a href="/learn/updating-objects-in-state#write-concise-update-logic-with-immer">Immer</a> pour rendre la logique de mise à jour plus concise.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useImmer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'use-immer'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialTravelPlan <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./places.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TravelPlan</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>plan<span class="token punctuation">,</span> updatePlan<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useImmer</span><span class="token punctuation">(</span>initialTravelPlan<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleComplete</span><span class="token punctuation">(</span><span class="token parameter">parentId<span class="token punctuation">,</span> childId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">updatePlan</span><span class="token punctuation">(</span><span class="token parameter">draft</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// Retirer des ID de lieux enfants du parent.</span>
      <span class="token keyword">const</span> parent <span class="token operator">=</span> draft<span class="token punctuation">[</span>parentId<span class="token punctuation">]</span><span class="token punctuation">;</span>
      parent<span class="token punctuation">.</span><span class="token property-access">childIds</span> <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token property-access">childIds</span>
        <span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token arrow operator">=></span> id <span class="token operator">!==</span> childId<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Oublier cet endroit et tout ce qu'il contient.</span>
      <span class="token function">deleteAllChildren</span><span class="token punctuation">(</span>childId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">function</span> <span class="token function">deleteAllChildren</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> place <span class="token operator">=</span> draft<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
        place<span class="token punctuation">.</span><span class="token property-access">childIds</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span>deleteAllChildren<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">delete</span> draft<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> root <span class="token operator">=</span> plan<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> planetIds <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token property-access">childIds</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Lieux</span> à visiter<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ol<span class="token operator">></span>
        <span class="token punctuation">{</span>planetIds<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PlaceTree</span>
            key<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>
            id<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>
            parentId<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span>
            placesById<span class="token operator">=</span><span class="token punctuation">{</span>plan<span class="token punctuation">}</span>
            onComplete<span class="token operator">=</span><span class="token punctuation">{</span>handleComplete<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ol<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">PlaceTree</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> id<span class="token punctuation">,</span> parentId<span class="token punctuation">,</span> placesById<span class="token punctuation">,</span> onComplete <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> place <span class="token operator">=</span> placesById<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> childIds <span class="token operator">=</span> place<span class="token punctuation">.</span><span class="token property-access">childIds</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li<span class="token operator">></span>
      <span class="token punctuation">{</span>place<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onComplete</span><span class="token punctuation">(</span>parentId<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token constant">C</span>’est fait
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>childIds<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&#x26;&#x26;</span>
        <span class="token operator">&#x3C;</span>ol<span class="token operator">></span>
          <span class="token punctuation">{</span>childIds<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">childId</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
            <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PlaceTree</span>
              key<span class="token operator">=</span><span class="token punctuation">{</span>childId<span class="token punctuation">}</span>
              id<span class="token operator">=</span><span class="token punctuation">{</span>childId<span class="token punctuation">}</span>
              parentId<span class="token operator">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span>
              placesById<span class="token operator">=</span><span class="token punctuation">{</span>placesById<span class="token punctuation">}</span>
              onComplete<span class="token operator">=</span><span class="token punctuation">{</span>onComplete<span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>ol<span class="token operator">></span>
      <span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> initialTravelPlan <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'(Root)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Terre'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Afrique'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span> <span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Botswana'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Egypte'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Kenya'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Madagascar'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Maroc'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">8</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Nigéria'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">9</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Afrique du Sud'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">10</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Amérique'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Argentine'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">12</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Brésil'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">13</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Barbade'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">14</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Canada'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">15</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Jamaïque'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">16</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Mexique'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">17</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Trinité-et-Tobago'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">18</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Venezuela'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">19</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Asie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">20</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Chine'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">21</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'India'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Singapour'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">23</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Corée du Sud'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">24</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Thaïlande'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">25</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Viêt Nam'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">26</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Europe'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">27</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Croatie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">28</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'France'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">29</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Allemagne'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">30</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Italie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">31</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Portugal'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">32</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Spain'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Turquie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">34</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Océanie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">35</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Australie'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">36</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Bora Bora (Polynésie française)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">37</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Île de Pâques (Chili)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">38</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Fidji'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">39</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Hawaï (États-Unis)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">40</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Nouvelle-Zélande'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">41</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Vanuatu'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">42</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Lune'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">43</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Rheita'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">44</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Piccolomini'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">45</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Tycho'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">46</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Mars'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">47</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Corn Town'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">48</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    # <span class="token string">'Green Hill'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">childIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"immer"</span><span class="token operator">:</span> <span class="token string">"1.7.3"</span><span class="token punctuation">,</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"use-immer"</span><span class="token operator">:</span> <span class="token string">"0.5.1"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></sandpack></section></deepdive><p>Parfois, vous pouvez aussi réduire l’imbrication des états en déplaçant une partie de l’état imbriqué dans les composants enfants. C'est bien adapté aux états éphémères de l’UI qui n’ont pas besoin d’être stockés, comme le fait de savoir si un élément est survolé.</p><recap><ul><li>Si deux variables d’état sont toujours mises à jour ensemble, envisagez de les fusionner en une seule.<li>Choisissez soigneusement vos variables d’état pour éviter de créer des états « impossibles ».<li>Structurez votre état de manière à réduire les risques d’erreur lors de sa mise à jour.<li>Evitez les états dupliqués et redondants afin de ne pas avoir à les synchroniser.<li>Ne mettez pas de props <em>dans</em> un état à moins que vous ne vouliez spécifiquement empêcher les mises à jour.<li>Pour les interactions telles que la sélection d'élément, conservez l’ID ou l’index dans l’état au lieu de référencer l’objet lui-même.<li>Si la mise à jour d’un état profondément imbriqué est compliquée, essayez de l’aplatir.</ul></recap><challenges><section class="level4"aria-labelledby="réparer-un-composant-qui-ne-sactualise-pas-fix-a-component-thats-not-updating"><h4 id="réparer-un-composant-qui-ne-sactualise-pas-fix-a-component-thats-not-updating">Réparer un composant qui ne s’actualise pas {/<em>fix-a-component-thats-not-updating</em>/}</h4><p>Ce composant <code>Clock</code> reçoit deux props : <code>color</code> et <code>time</code>. Lorsque vous sélectionnez une couleur différente dans la boîte de sélection, le composant <code>Clock</code> reçoit une prop <code>color</code> différente depuis son composant parent. Cependant, la couleur affichée n’est pas mise à jour. Pourquoi ? Corrigez le problème.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Clock</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token property-access">color</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>h1 style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> color <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>props<span class="token punctuation">.</span><span class="token property-access">time</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Clock</span></span> <span class="token keyword module">from</span> <span class="token string">'./Clock.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">useTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>time<span class="token punctuation">,</span> setTime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> time<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token function">useTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'lightcoral'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Choisissez</span> une couleur <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select value<span class="token operator">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setColor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"lightcoral"</span><span class="token operator">></span>lightcoral<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"midnightblue"</span><span class="token operator">></span>midnightblue<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"rebeccapurple"</span><span class="token operator">></span>rebeccapurple<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Clock</span> color<span class="token operator">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span> time<span class="token operator">=</span><span class="token punctuation">{</span>time<span class="token punctuation">.</span><span class="token method function property-access">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution><p>Le problème, c'est que ce composant a un état <code>color</code> initialisé avec la valeur initiale de la prop <code>color</code>. Mais quand la prop change, ça n’affecte pas la variable d’état ! Donc elles se désynchronisent. Pour régler ce problème, retirez carrément la variable d’état, et utilisez directement la prop <code>color</code>.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Clock</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>h1 style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> props<span class="token punctuation">.</span><span class="token property-access">color</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>props<span class="token punctuation">.</span><span class="token property-access">time</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Clock</span></span> <span class="token keyword module">from</span> <span class="token string">'./Clock.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">useTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>time<span class="token punctuation">,</span> setTime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> time<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token function">useTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'lightcoral'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Choisissez</span> une couleur <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select value<span class="token operator">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setColor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"lightcoral"</span><span class="token operator">></span>lightcoral<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"midnightblue"</span><span class="token operator">></span>midnightblue<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"rebeccapurple"</span><span class="token operator">></span>rebeccapurple<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Clock</span> color<span class="token operator">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span> time<span class="token operator">=</span><span class="token punctuation">{</span>time<span class="token punctuation">.</span><span class="token method function property-access">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>Ou en utilisant la syntaxe de déstructuration :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Clock</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> color<span class="token punctuation">,</span> time <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>h1 style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> color <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>time<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Clock</span></span> <span class="token keyword module">from</span> <span class="token string">'./Clock.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">useTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>time<span class="token punctuation">,</span> setTime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> time<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token function">useTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'lightcoral'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Choisissez</span> une couleur <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select value<span class="token operator">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setColor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"lightcoral"</span><span class="token operator">></span>lightcoral<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"midnightblue"</span><span class="token operator">></span>midnightblue<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"rebeccapurple"</span><span class="token operator">></span>rebeccapurple<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Clock</span> color<span class="token operator">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span> time<span class="token operator">=</span><span class="token punctuation">{</span>time<span class="token punctuation">.</span><span class="token method function property-access">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack></solution></section><section class="level4"aria-labelledby="réparer-une-liste-daffaires-cassée-fix-a-broken-packing-list"><h4 id="réparer-une-liste-daffaires-cassée-fix-a-broken-packing-list">Réparer une liste d’affaires cassée {/<em>fix-a-broken-packing-list</em>/}</h4><p>Cette liste d'affaires possède un pied de page qui indique le nombre d'objets déjà dans les bagages, et le nombre total d’objets. Ça semble fonctionner au début, mais il y a des bugs. Par exemple, si vous cochez un article puis le supprimez, le compteur ne sera pas mis à jour correctement. Corrigez le compteur pour qu’il soit toujours juste.</p><hint><p>Y a-t-il un état redondant dans cet exemple ?</p></hint><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">AddItem</span></span> <span class="token keyword module">from</span> <span class="token string">'./AddItem.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">PackingList</span></span> <span class="token keyword module">from</span> <span class="token string">'./PackingList.js'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> nextId <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> initialItems <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TravelPlan</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>items<span class="token punctuation">,</span> setItems<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>total<span class="token punctuation">,</span> setTotal<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>packed<span class="token punctuation">,</span> setPacked<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleAddItem</span><span class="token punctuation">(</span><span class="token parameter">title</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTotal</span><span class="token punctuation">(</span>total <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token spread operator">...</span>items<span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        # title<span class="token punctuation">,</span>
        <span class="token literal-property property">packed</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleChangeItem</span><span class="token punctuation">(</span><span class="token parameter">nextItem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>nextItem<span class="token punctuation">.</span><span class="token property-access">packed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setPacked</span><span class="token punctuation">(</span>packed <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token function">setPacked</span><span class="token punctuation">(</span>packed <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> nextItem<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> nextItem<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> item<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleDeleteItem</span><span class="token punctuation">(</span><span class="token parameter">itemId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTotal</span><span class="token punctuation">(</span>total <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span>
      items<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">!==</span> itemId<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddItem</span>
        onAddItem<span class="token operator">=</span><span class="token punctuation">{</span>handleAddItem<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PackingList</span>
        items<span class="token operator">=</span><span class="token punctuation">{</span>items<span class="token punctuation">}</span>
        onChangeItem<span class="token operator">=</span><span class="token punctuation">{</span>handleChangeItem<span class="token punctuation">}</span>
        onDeleteItem<span class="token operator">=</span><span class="token punctuation">{</span>handleDeleteItem<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>packed<span class="token punctuation">}</span> sur <span class="token punctuation">{</span>total<span class="token punctuation">}</span> dans la valise <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AddItem</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onAddItem <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>title<span class="token punctuation">,</span> setTitle<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        placeholder<span class="token operator">=</span><span class="token string">"Ajouter un objet"</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>title<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setTitle</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">onAddItem</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Ajouter</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">PackingList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  items<span class="token punctuation">,</span>
  onChangeItem<span class="token punctuation">,</span>
  onDeleteItem
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
      <span class="token punctuation">{</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
            <span class="token operator">&#x3C;</span>input
              type<span class="token operator">=</span><span class="token string">"checkbox"</span>
              checked<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">packed</span><span class="token punctuation">}</span>
              onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
                <span class="token function">onChangeItem</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                  <span class="token spread operator">...</span>item<span class="token punctuation">,</span>
                  <span class="token literal-property property">packed</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
            <span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">onDeleteItem</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token maybe-class-name">Supprimer</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">ul<span class="token punctuation">,</span> li</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p>Bien que vous puissiez modifier soigneusement chaque gestionnaire d'événement pour mettre à jour correctement les compteurs <code>total</code> et <code>packed</code>, le problème principal est que ces variables d’état existent. Elles sont redondantes car vous pouvez toujours calculer le nombre d’éléments (emballés ou au total) depuis la liste <code>items</code> elle même. Supprimez les états redondants pour corriger le bug :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">AddItem</span></span> <span class="token keyword module">from</span> <span class="token string">'./AddItem.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">PackingList</span></span> <span class="token keyword module">from</span> <span class="token string">'./PackingList.js'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> nextId <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> initialItems <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TravelPlan</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>items<span class="token punctuation">,</span> setItems<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialItems<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> total <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> packed <span class="token operator">=</span> items
    <span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> item<span class="token punctuation">.</span><span class="token property-access">packed</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleAddItem</span><span class="token punctuation">(</span><span class="token parameter">title</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token spread operator">...</span>items<span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        # title<span class="token punctuation">,</span>
        <span class="token literal-property property">packed</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleChangeItem</span><span class="token punctuation">(</span><span class="token parameter">nextItem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> nextItem<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> nextItem<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> item<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleDeleteItem</span><span class="token punctuation">(</span><span class="token parameter">itemId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span>
      items<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">!==</span> itemId<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddItem</span>
        onAddItem<span class="token operator">=</span><span class="token punctuation">{</span>handleAddItem<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PackingList</span>
        items<span class="token operator">=</span><span class="token punctuation">{</span>items<span class="token punctuation">}</span>
        onChangeItem<span class="token operator">=</span><span class="token punctuation">{</span>handleChangeItem<span class="token punctuation">}</span>
        onDeleteItem<span class="token operator">=</span><span class="token punctuation">{</span>handleDeleteItem<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>packed<span class="token punctuation">}</span> sur <span class="token punctuation">{</span>total<span class="token punctuation">}</span> dans la valise <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AddItem</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onAddItem <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>title<span class="token punctuation">,</span> setTitle<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        placeholder<span class="token operator">=</span><span class="token string">"Ajouter un objet"</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>title<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setTitle</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">onAddItem</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Ajouter</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">PackingList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  items<span class="token punctuation">,</span>
  onChangeItem<span class="token punctuation">,</span>
  onDeleteItem
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
      <span class="token punctuation">{</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
            <span class="token operator">&#x3C;</span>input
              type<span class="token operator">=</span><span class="token string">"checkbox"</span>
              checked<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">packed</span><span class="token punctuation">}</span>
              onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
                <span class="token function">onChangeItem</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                  <span class="token spread operator">...</span>item<span class="token punctuation">,</span>
                  <span class="token literal-property property">packed</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
            <span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">onDeleteItem</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token maybe-class-name">Supprimer</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">ul<span class="token punctuation">,</span> li</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>Notez comme les gestionnaires d’événements se préoccupent désormais uniquement d'appeler <code>setItems</code>. Les compteurs d’objets seront maintenant calculés pendant le prochain rendu depuis la liste <code>items</code>, et seront donc toujours à jour.</p></solution></section><section class="level4"aria-labelledby="réparer-une-sélection-qui-disparaît-fix-the-disappearing-selection"><h4 id="réparer-une-sélection-qui-disparaît-fix-the-disappearing-selection">Réparer une sélection qui disparaît {/<em>fix-the-disappearing-selection</em>/}</h4><p>Il y a une liste de <code>letters</code> dans l’état. Lorsque vous survolez ou cliquez sur un courrier particulier, celui-ci est mis en surbrillance. Le courrier actuellement en surbrillance est stocké dans la variable d’état <code>highlightedLetter</code>. Vous pouvez marquer chaque courrier comme "épinglé" ou "normal", ce qui met à jour la liste <code>letters</code> dans l’état.<p>Ce code fonctionne, mais il y a un bug mineur d’UI. Quand vous appuyez sur « Épingler » ou « Désépingler », la surbrillance disparaît pendant un moment. Cependant, elle réapparaît dès que vous déplacez votre curseur ou passez à un autre courrier avec le clavier. Que se passe-t-il ? Corrigez le problème pour que la surbrillance ne disparaisse pas après le clic sur le bouton.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialLetters <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./data.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Letter</span></span> <span class="token keyword module">from</span> <span class="token string">'./Letter.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MailClient</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>letters<span class="token punctuation">,</span> setLetters<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialLetters<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>highlightedLetter<span class="token punctuation">,</span> setHighlightedLetter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleHover</span><span class="token punctuation">(</span><span class="token parameter">letter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setHighlightedLetter</span><span class="token punctuation">(</span>letter<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleStar</span><span class="token punctuation">(</span><span class="token parameter">starred</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setLetters</span><span class="token punctuation">(</span>letters<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">letter</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> starred<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
          <span class="token spread operator">...</span>letter<span class="token punctuation">,</span>
          <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token operator">!</span>letter<span class="token punctuation">.</span><span class="token property-access">isStarred</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> letter<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Boîte</span> de réception<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>letters<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">letter</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Letter</span>
            key<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span>
            letter<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">}</span>
            isHighlighted<span class="token operator">=</span><span class="token punctuation">{</span>
              letter <span class="token operator">===</span> highlightedLetter
            <span class="token punctuation">}</span>
            onHover<span class="token operator">=</span><span class="token punctuation">{</span>handleHover<span class="token punctuation">}</span>
            onToggleStar<span class="token operator">=</span><span class="token punctuation">{</span>handleStar<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Letter</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  letter<span class="token punctuation">,</span>
  isHighlighted<span class="token punctuation">,</span>
  onHover<span class="token punctuation">,</span>
  onToggleStar<span class="token punctuation">,</span>
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li
      className<span class="token operator">=</span><span class="token punctuation">{</span>
        isHighlighted <span class="token operator">?</span> <span class="token string">'highlighted'</span> <span class="token operator">:</span> <span class="token string">''</span>
      <span class="token punctuation">}</span>
      onFocus<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onHover</span><span class="token punctuation">(</span>letter<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
      onPointerMove<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onHover</span><span class="token punctuation">(</span>letter<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onToggleStar</span><span class="token punctuation">(</span>letter<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">isStarred</span> <span class="token operator">?</span> <span class="token string">'Désépingler'</span> <span class="token operator">:</span> <span class="token string">'Épingler'</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">subject</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> initialLetters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Prêt pour l’aventure ?'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Enregistrez-vous !'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Le festival démarre dans seulement SEPT jours !'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.highlighted</span></span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#d2eaff</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p>Le problème tient à ce que vous stockez l’objet <em>letter</em> dans <code>highlightedLetter</code>. Mais vous gardez cette même information dans la liste <code>letters</code>. Il y a donc duplication dans votre état ! Quand vous mettez à jour la liste <code>letters</code> après avoir cliqué sur le bouton, vous créez un nouvel objet courrier qui est différent de <code>highlightedLetter</code>. C’est pourquoi l’expression <code>highlightedLetter === letter</code> devient <code>false</code> et la surbrillance disparait. Elle réapparaît la prochaine fois que vous appelez <code>setHighlightedLetter</code> lorsque le pointeur se déplace.<p>Pour résoudre ce problème, supprimez la duplication de l’état. Au lieu de stocker <em>le courrier lui-même</em> à deux endroits, stockez plutôt le <code>highlightedId</code>. Ensuite vous pouvez vérifier <code>isHighlighted</code> pour chaque courrier avec <code>letter.id === highlightedId</code>, ce qui fonctionnera même si l’objet <code>letter</code> a changé depuis le dernier rendu.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialLetters <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./data.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Letter</span></span> <span class="token keyword module">from</span> <span class="token string">'./Letter.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MailClient</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>letters<span class="token punctuation">,</span> setLetters<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialLetters<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>highlightedId<span class="token punctuation">,</span> setHighlightedId <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleHover</span><span class="token punctuation">(</span><span class="token parameter">letterId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setHighlightedId</span><span class="token punctuation">(</span>letterId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleStar</span><span class="token punctuation">(</span><span class="token parameter">starredId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setLetters</span><span class="token punctuation">(</span>letters<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">letter</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> starredId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
          <span class="token spread operator">...</span>letter<span class="token punctuation">,</span>
          <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token operator">!</span>letter<span class="token punctuation">.</span><span class="token property-access">isStarred</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> letter<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Boîte</span> de réception<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>letters<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">letter</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Letter</span>
            key<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span>
            letter<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">}</span>
            isHighlighted<span class="token operator">=</span><span class="token punctuation">{</span>
              letter<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> highlightedId
            <span class="token punctuation">}</span>
            onHover<span class="token operator">=</span><span class="token punctuation">{</span>handleHover<span class="token punctuation">}</span>
            onToggleStar<span class="token operator">=</span><span class="token punctuation">{</span>handleStar<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Letter</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  letter<span class="token punctuation">,</span>
  isHighlighted<span class="token punctuation">,</span>
  onHover<span class="token punctuation">,</span>
  onToggleStar<span class="token punctuation">,</span>
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li
      className<span class="token operator">=</span><span class="token punctuation">{</span>
        isHighlighted <span class="token operator">?</span> <span class="token string">'highlighted'</span> <span class="token operator">:</span> <span class="token string">''</span>
      <span class="token punctuation">}</span>
      onFocus<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onHover</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
      onPointerMove<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onHover</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onToggleStar</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">isStarred</span> <span class="token operator">?</span> <span class="token string">'Désépingler'</span> <span class="token operator">:</span> <span class="token string">'Épingler'</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">subject</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> initialLetters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Prêt pour l’aventure ?'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Enregistrez-vous !'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Le festival démarre dans seulement SEPT jours !'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.highlighted</span></span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#d2eaff</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack></solution></section><section class="level4"aria-labelledby="implémenter-une-sélection-multiple-implement-multiple-selection"><h4 id="implémenter-une-sélection-multiple-implement-multiple-selection">Implémenter une sélection multiple {/<em>implement-multiple-selection</em>/}</h4><p>Dans cet exemple, chaque <code>Letter</code> possède une prop <code>isSelected</code> et un gestionnaire <code>onToggle</code> qui la marque comme étant sélectionnée. Ça fonctionne, mais l’état est stocké sous la forme d’un <code>selectedId</code> (soit <code>null</code> soit un ID), de sorte qu’un seul courrier peut être sélectionné à la fois.<p>Modifiez la structure de l’état pour prendre en charge la sélection multiple. (Comment le structureriez-vous ? Réfléchissez-y avant d’écrire le code.) Chaque case à cocher doit devenir indépendante des autres. Le fait de cliquer sur un courrier sélectionné devrait le décocher. Enfin, le pied de page doit afficher le nombre correct d’éléments sélectionnés.</p><hint><p>Au lieu d’un simple ID sélectionné, vous voulez plutôt enregistrer une liste ou un <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a> des ID sélectionnés dans l’état.</p></hint><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> letters <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./data.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Letter</span></span> <span class="token keyword module">from</span> <span class="token string">'./Letter.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MailClient</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>selectedId<span class="token punctuation">,</span> setSelectedId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// TODO: autoriser la sélection multiple</span>
  <span class="token keyword">const</span> selectedCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleToggle</span><span class="token punctuation">(</span><span class="token parameter">toggledId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO: autoriser la sélection multiple</span>
    <span class="token function">setSelectedId</span><span class="token punctuation">(</span>toggledId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Boîte</span> de réception<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>letters<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">letter</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Letter</span>
            key<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span>
            letter<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">}</span>
            isSelected<span class="token operator">=</span><span class="token punctuation">{</span>
              <span class="token comment">// TODO: autoriser la sélection multiple</span>
              letter<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> selectedId
            <span class="token punctuation">}</span>
            onToggle<span class="token operator">=</span><span class="token punctuation">{</span>handleToggle<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>b<span class="token operator">></span>
            <span class="token maybe-class-name">Vous</span> avez sélectionné <span class="token punctuation">{</span>selectedCount<span class="token punctuation">}</span> <span class="token function">courrier</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Letter</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  letter<span class="token punctuation">,</span>
  onToggle<span class="token punctuation">,</span>
  isSelected<span class="token punctuation">,</span>
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li className<span class="token operator">=</span><span class="token punctuation">{</span>
      isSelected <span class="token operator">?</span> <span class="token string">'selected'</span> <span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isSelected<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
            <span class="token function">onToggle</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">subject</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> letters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Prêt pour l’aventure ?'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Enregistrez-vous !'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Le festival démarre dans seulement SEPT jours !'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.selected</span></span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#d2eaff</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p>Au lieu d’un simple <code>selectedId</code>, enregistrez une <em>liste</em> <code>selectedIds</code> dans l’état. Par exemple, si vous sélectionnez le premier et le dernier courrier, elle contiendrait <code>[0, 2]</code>. Quand rien n’est sélectionné, elle contiendrait une liste vide <code>[]</code> :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> letters <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./data.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Letter</span></span> <span class="token keyword module">from</span> <span class="token string">'./Letter.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MailClient</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>selectedIds<span class="token punctuation">,</span> setSelectedIds<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> selectedCount <span class="token operator">=</span> selectedIds<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleToggle</span><span class="token punctuation">(</span><span class="token parameter">toggledId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Était-il sélectionné avant ?</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>selectedIds<span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span>toggledId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Alors retirer l’ID de la liste.</span>
      <span class="token function">setSelectedIds</span><span class="token punctuation">(</span>selectedIds<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token arrow operator">=></span>
        id <span class="token operator">!==</span> toggledId
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// Sinon, ajouter cet ID dans la liste.</span>
      <span class="token function">setSelectedIds</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token spread operator">...</span>selectedIds<span class="token punctuation">,</span>
        toggledId
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Boîte</span> de réception<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>letters<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">letter</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Letter</span>
            key<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span>
            letter<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">}</span>
            isSelected<span class="token operator">=</span><span class="token punctuation">{</span>
              selectedIds<span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            onToggle<span class="token operator">=</span><span class="token punctuation">{</span>handleToggle<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>b<span class="token operator">></span>
            <span class="token maybe-class-name">Vous</span> avez sélectionné <span class="token punctuation">{</span>selectedCount<span class="token punctuation">}</span> <span class="token function">courrier</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Letter</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  letter<span class="token punctuation">,</span>
  onToggle<span class="token punctuation">,</span>
  isSelected<span class="token punctuation">,</span>
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li className<span class="token operator">=</span><span class="token punctuation">{</span>
      isSelected <span class="token operator">?</span> <span class="token string">'selected'</span> <span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isSelected<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
            <span class="token function">onToggle</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">subject</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> letters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Prêt pour l’aventure ?'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Enregistrez-vous !'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Le festival démarre dans seulement SEPT jours !'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.selected</span></span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#d2eaff</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>Utiliser un tableau présente un léger inconvénient : pour chaque élément, vous appelez <code>selectedIds.includes(letter.id)</code> pour vérifier s'il est sélectionné. Si la liste est très grande, ça peut devenir un problème de performances car rechercher dans une liste avec <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Array/includes"><code>includes()</code></a> prend un temps linéaire, et vous effectuez cette recherche pour chaque élément.<p>Pour résoudre ce problème, vous pouvez plutôt utiliser un <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a> dans l’état, qui fournit une fonction <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Set/has"><code>has()</code></a> rapide :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> letters <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./data.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Letter</span></span> <span class="token keyword module">from</span> <span class="token string">'./Letter.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MailClient</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>selectedIds<span class="token punctuation">,</span> setSelectedIds<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> selectedCount <span class="token operator">=</span> selectedIds<span class="token punctuation">.</span><span class="token property-access">size</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleToggle</span><span class="token punctuation">(</span><span class="token parameter">toggledId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Créer une copie (pour éviter la mutation).</span>
    <span class="token keyword">const</span> nextIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>selectedIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>nextIds<span class="token punctuation">.</span><span class="token method function property-access">has</span><span class="token punctuation">(</span>toggledId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      nextIds<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span>toggledId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      nextIds<span class="token punctuation">.</span><span class="token method function property-access">add</span><span class="token punctuation">(</span>toggledId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">setSelectedIds</span><span class="token punctuation">(</span>nextIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Boîte</span> de réception<span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>letters<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">letter</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Letter</span>
            key<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span>
            letter<span class="token operator">=</span><span class="token punctuation">{</span>letter<span class="token punctuation">}</span>
            isSelected<span class="token operator">=</span><span class="token punctuation">{</span>
              selectedIds<span class="token punctuation">.</span><span class="token method function property-access">has</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            onToggle<span class="token operator">=</span><span class="token punctuation">{</span>handleToggle<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>b<span class="token operator">></span>
            <span class="token maybe-class-name">Vous</span> avez sélectionné <span class="token punctuation">{</span>selectedCount<span class="token punctuation">}</span> <span class="token function">courrier</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Letter</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  letter<span class="token punctuation">,</span>
  onToggle<span class="token punctuation">,</span>
  isSelected<span class="token punctuation">,</span>
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>li className<span class="token operator">=</span><span class="token punctuation">{</span>
      isSelected <span class="token operator">?</span> <span class="token string">'selected'</span> <span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isSelected<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
            <span class="token function">onToggle</span><span class="token punctuation">(</span>letter<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">{</span>letter<span class="token punctuation">.</span><span class="token property-access">subject</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">const</span> letters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Prêt pour l’aventure ?'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Enregistrez-vous !'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'Le festival démarre dans seulement SEPT jours !'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isStarred</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.selected</span></span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#d2eaff</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>Maintenant chaque élément effectue une vérification <code>selectedIds.has(letter.id)</code>, ce qui est très rapide.<p>Gardez en tête que vous <a href="/learn/updating-objects-in-state">ne devez pas modifier des objets dans l’état</a>, et ça inclut aussi les Sets. C’est pourquoi la fonction <code>handleToggle</code> crée d’abord une <em>copie</em> de ce Set, puis la met à jour.</p></solution><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></challenges></section></section>