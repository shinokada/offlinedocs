<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <title>La validation de types statique</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css">
  </head>
  <body>
    <section id="la-validation-de-types-statique" class="level1">
      <h1>La validation de types statique</h1>
      <p>Les systèmes de typage statique tels que <a href="https://flow.org/">Flow</a> et <a href="https://www.typescriptlang.org/">TypeScript</a> parviennent à identifier certains types de problèmes avant même d’exécuter votre code. Ils peuvent aussi améliorer le processus de travail des développeurs en y ajoutant des assistances telles que l'auto-complétion. C'est pourquoi nous recommandons l'utilisation de Flow ou TypeScript au lieu des <code>PropTypes</code> pour les grandes bases de code source.</p>
      <section id="flow" class="level2">
        <h2>Flow</h2>
        <p><a href="https://flow.org/">Flow</a> est un système de typage statique pour votre code JavaScript. Il est développé chez Facebook et souvent utilisé avec React. Il permet d'annoter les variables, fonctions et composants React avec une syntaxe spéciale de typage, et de déceler préventivement les erreurs. Vous pouvez lire <a href="https://flow.org/en/docs/getting-started/">cette introduction à Flow</a> pour en apprendre les bases.</p>
        <p>Pour utiliser Flow, vous devrez :</p>
        <ul>
          <li>Ajouter Flow comme dépendance dans votre projet.</li>
          <li>Vous assurer que la syntaxe Flow soit bien enlevée du code, une fois compilé.</li>
          <li>Ajouter les annotations de typage et lancer Flow pour les vérifier.</li>
        </ul>
        <p>Nous allons vous expliquer ces étapes en détail ci-dessous.</p>
        <section id="adding-flow-to-a-project" class="level3">
          <h3>Ajouter Flow à un projet</h3>
          <p>Premièrement, naviguez vers le dossier de votre projet dans le terminal (ou l'invite de commandes). Vous allez devoir exécuter la commande suivante :</p>
          <p>Si vous utilisez <a href="https://yarnpkg.com/">Yarn</a> :</p>
          <pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> --dev flow-bin</code></pre>
          <p>Si vous utilisez <a href="https://www.npmjs.com/">npm</a> :</p>
          <pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev flow-bin</code></pre>
          <p>Cette commande installe la dernière version de Flow dans votre projet.</p>
          <p>Maintenant, ajoutez <code>flow</code> à la section <code>"scripts"</code> de votre <code>package.json</code> afin de pouvoir l'utiliser dans votre terminal :</p>
          <pre class="language-js{4}"><code class="language-js{4}">{
  // ...
  "scripts": {
    "flow": "flow",
    // ...
  },
  // ...
}</code></pre>
          <p>Enfin, exécutez l'une des commandes suivantes :</p>
          <p>Si vous utilisez <a href="https://yarnpkg.com/">Yarn</a> :</p>
          <pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> run flow init</code></pre>
          <p>Si vous utilisez <a href="https://www.npmjs.com/">npm</a> :</p>
          <pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> run flow init</code></pre>
          <p>Cette commande va créer un fichier de configuration Flow qu'il va falloir ajouter à la gestion de versions de votre code source.</p>
        </section>
        <section id="stripping-flow-syntax-from-the-compiled-code" class="level3">
          <h3>Retirer la syntaxe Flow du code compilé</h3>
          <p>Flow est une extension du langage JavaScript avec une syntaxe spéciale pour les annotations de type. Cependant les navigateurs ne connaissent pas cette syntaxe. Nous devons donc nous assurer qu'elle ne finisse pas dans le <em>bundle</em> de JavaScript compilé qui sera à terme envoyé au navigateur.</p>
          <p>Le procédé exact pour y arriver dépend des outils que vous utilisez pour compiler votre code source JavaScript.</p>
          <section id="create-react-app" class="level4">
            <h4>Create React App</h4>
            <p>Si vous avez utilisé <a href="https://github.com/facebookincubator/create-react-app">Create React App</a> pour initialiser votre projet, félicitations ! Dans ce scénario, les annotations Flow sont déjà retirées par défaut, donc vous n'avez rien à faire de plus pour cette étape.</p>
          </section>
          <section id="babel" class="level4">
            <h4>Babel</h4>
            <blockquote>
              <p>Remarque</p>
              <p>Ces instructions <em>ne sont pas adaptées</em> aux utilisateurs de Create React App. Bien que Create React App utilise Babel en interne, il est déjà configuré pour comprendre Flow. Ne suivez cette étape que si vous n'utilisez <em>pas</em> Create React App.</p>
            </blockquote>
            <p>Si vous avez configuré Babel manuellement pour votre projet, il vous faudra ajouter un <em>preset</em> spécial pour prendre en charge Flow.</p>
            <p>Si vous utilisez <a href="https://yarnpkg.com/">Yarn</a>, exécutez :</p>
            <pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> --dev @babel/preset-flow</code></pre>
            <p>Si vous utilisez <a href="https://www.npmjs.com/">npm</a>, exécutez :</p>
            <pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev @babel/preset-flow</code></pre>
            <p>Ensuite, ajoutez le preset <code>flow</code> à votre <a href="https://babeljs.io/docs/usage/babelrc/">configuration Babel</a>. Par exemple, si vous configurez Babel avec le ficher <code>.babelrc</code>, ça pourrait ressembler à ceci :</p>
            <pre class="language-js{3}"><code class="language-js{3}">{
  "presets": [
    "@babel/preset-flow",
    "react"
  ]
}</code></pre>
            <p>De cette façon, vous pourrez utiliser la syntaxe Flow dans votre code.</p>
            <blockquote>
              <p>Remarque</p>
              <p>Il n'est pas nécessaire d'avoir le preset <code>react</code> afin d'utiliser Flow, mais ils sont souvent utilisés ensemble. Flow comprend déjà quant à lui la syntaxe JSX.</p>
            </blockquote>
          </section>
          <section id="other-build-setups" class="level4">
            <h4>Autres configurations</h4>
            <p>Si vous n'utilisez ni Create React App, ni Babel, vous pouvez utiliser <a href="https://github.com/flowtype/flow-remove-types">flow-remove-types</a> pour enlever les annotations de type.</p>
          </section>
        </section>
        <section id="running-flow" class="level3">
          <h3>Exécuter Flow</h3>
          <p>Si vous avez bien suivi les instructions ci-dessus, vous devriez être prêt·e à exécuter Flow pour la première fois.</p>
          <p>Si vous utilisez <a href="https://yarnpkg.com/">Yarn</a>, exécutez :</p>
          <pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> flow</code></pre>
          <p>Si vous utilisez <a href="https://www.npmjs.com/">npm</a>, exécutez :</p>
          <pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> run flow</code></pre>
          <p>Vous devriez voir apparaître un message similaire à celui-ci :</p>
          <pre class="language-text"><code class="language-text">No errors!
✨  Done in 0.17s.</code></pre>
        </section>
        <section id="adding-flow-type-annotations" class="level3">
          <h3>Ajouter des annotations de type Flow</h3>
          <p>Par défaut, Flow ne vérifie que les fichiers qui contiennent cette annotation :</p>
          <pre class="language-js"><code class="language-js"><span class="token comment">// @flow</span></code></pre>
          <p>Elle est habituellement placée au début du document. Essayez de l'ajouter à quelques fichiers dans votre projet, et exécutez <code>yarn flow</code> ou <code>npm run flow</code> pour voir si Flow a déjà découvert des problèmes.</p>
          <p>Il existe aussi <a href="https://flow.org/en/docs/config/options/#toc-all-boolean">une option</a> pour forcer Flow à vérifier <em>tous</em> les fichiers, même sans l'annotation. Ça peut être trop pour des projets existants, mais raisonnable pour un nouveau projet si vous souhaitez le typer avec Flow de façon intégrale.</p>
          <p>Vous êtes paré·e ! Nous vous conseillons d'aller voir les ressources suivantes pour en apprendre davantage sur Flow :</p>
          <ul>
            <li><a href="https://flow.org/en/docs/types/">Documentation Flow : les annotations de type</a></li>
            <li><a href="https://flow.org/en/docs/editors/">Documentation Flow : éditeurs de code</a></li>
            <li><a href="https://flow.org/en/docs/react/">Documentation Flow : React</a></li>
            <li><a href="https://medium.com/flow-type/linting-in-flow-7709d7a7e969">Le linting avec Flow</a></li>
          </ul>
        </section>
      </section>
      <section id="typescript" class="level2">
        <h2>TypeScript</h2>
        <p><a href="https://www.typescriptlang.org/">TypeScript</a> est un langage de programmation développé par Microsoft. C'est un sur-ensemble typé de JavaScript, et il fournit son propre compilateur. Étant un langage typé, TypeScript peut trouver des erreurs et bugs lors de la compilation, bien avant que l'application ne soit déployée. Vous trouverez plus d'informations sur l'utilisation de TypeScript avec React <a href="https://github.com/Microsoft/TypeScript-React-Starter#typescript-react-starter">ici</a>.</p>
        <p>Pour utiliser TypeScript, vous devez :</p>
        <ul>
          <li>Ajouter la dépendance TypeScript dans votre projet</li>
          <li>Configurer les options du compilateur TypeScript</li>
          <li>Utiliser les extensions appropriées pour vos fichiers</li>
          <li>Ajouter les définitions de type pour les bibliothèques que vous utilisez</li>
        </ul>
        <p>Voyons ça plus en détail.</p>
        <section id="using-typescript-with-create-react-app" class="level3">
          <h3>Utiliser TypeScript avec Create React App</h3>
          <p>Create React App prend déjà en charge TypeScript.</p>
          <p>Pour créer un <strong>nouveau projet</strong> avec la prise en charge de TypeScript, exécutez :</p>
          <pre class="language-bash"><code class="language-bash">npx create-react-app my-app --template typescript</code></pre>
          <p>Vous pouvez aussi l'ajouter à <strong>un projet Create React App existant</strong>, <a href="https://facebook.github.io/create-react-app/docs/adding-typescript">comme documenté ici</a>.</p>
          <blockquote>
            <p>Remarque</p>
            <p>Si vous utilisez Create React App, vous pouvez <strong>sauter le reste de cette page</strong>. Elle décrit l'installation manuelle qui ne s'applique pas aux utilisateurs de Create React App.</p>
          </blockquote>
        </section>
        <section id="adding-typescript-to-a-project" class="level3">
          <h3>Ajouter TypeScript à un projet</h3>
          <p>On commence par exécuter une commande dans le terminal.</p>
          <p>Si vous utilisez <a href="https://yarnpkg.com/">Yarn</a> :</p>
          <pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> --dev typescript</code></pre>
          <p>Si vous utilisez <a href="https://www.npmjs.com/">npm</a> :</p>
          <pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev typescript</code></pre>
          <p>Félicitations ! Vous venez d'installer la dernière version de TypeScript dans votre projet. L'installation de TypeScript rend disponible la commande <code>tsc</code>. Avant de traiter la configuration, ajoutons <code>tsc</code> à la section <code>"scripts"</code> de notre <code>package.json</code> :</p>
          <pre class="language-js{4}"><code class="language-js{4}">{
  // ...
  "scripts": {
    "build": "tsc",
    // ...
  },
  // ...
}</code></pre>
        </section>
        <section id="configuring-the-typescript-compiler" class="level3">
          <h3>Configurer le compilateur TypeScript</h3>
          <p>Le compilateur ne nous aidera pas tant qu'on ne lui aura pas dit quoi faire. En TypeScript, ces règles sont définies dans un fichier spécial appelé <code>tsconfig.json</code>. Pour générer ce fichier :</p>
          <p>Si vous utilisez <a href="https://yarnpkg.com/">Yarn</a>, exécutez :</p>
          <pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> run tsc --init</code></pre>
          <p>Si vous utilisez <a href="https://www.npmjs.com/">npm</a>, exécutez :</p>
          <pre class="language-bash"><code class="language-bash">npx tsc --init</code></pre>
          <p>Allez voir le <code>tsconfig.json</code> qui vient d'être généré : vous voyez qu’il y a de nombreuses options qu'on peut utiliser pour configurer le compilateur. Pour une explication détaillée des options, voyez <a href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html">cette page</a>.</p>
          <p>Parmi les nombreuses options, nous allons regarder <code>rootDir</code> et <code>outDir</code>. Conformément à son rôle, le compilateur accepte des fichiers TypeScript et génère des fichiers JavaScript. Mais nous ne voudrions pas confondre les fichiers sources avec le résultat de la compilation.</p>
          <p>Nous allons régler ça en deux étapes :</p>
          <ul>
            <li>D'abord, réorganisons notre projet. Nous allons placer tout notre code source à l’intérieur du dossier <code>src</code>.</li>
          </ul>
          <pre class="language-text"><code class="language-text">├── package.json
├── src
│   └── index.ts
└── tsconfig.json</code></pre>
          <ul>
            <li>Ensuite, nous allons dire au compilateur où se trouve notre code source et où déposer le résultat.</li>
          </ul>
          <pre class="language-js{6,7}"><code class="language-js{6,7}">// tsconfig.json

{
  "compilerOptions": {
    // ...
    "rootDir": "src",
    "outDir": "build"
    // ...
  },
}</code></pre>
          <p>Génial ! Désormais, quand on exécute notre script, le compilateur va déposer le JS généré dans le dossier <code>build</code>. Le <a href="https://github.com/Microsoft/TypeScript-React-Starter/blob/master/tsconfig.json">TypeScript React Starter</a> fournit un <code>tsconfig.json</code> avec un bon ensemble de règles pour vous aider à démarrer.</p>
          <p>En règle générale, vous ne souhaitez pas enregistrer le JS généré dans votre système de gestion de versions, aussi veillez à bien ajouter le dossier de sortie dans votre <code>.gitignore</code>.</p>
        </section>
        <section id="file-extensions" class="level3">
          <h3>Extensions de fichiers</h3>
          <p>Avec React, vous écrivez probablement vos composants dans un fichier <code>.js</code>. En TypeScript, il existe deux extensions de fichier : <code>.ts</code> est l'extension par défaut, tandis que <code>.tsx</code> est une extension spéciale pour les fichiers qui contiennent du JSX.</p>
        </section>
        <section id="running-typescript" class="level3">
          <h3>Exécuter TypeScript</h3>
          <p>Si vous avez bien suivi les instructions ci-dessus, vous devriez pouvoir exécuter TypeScript pour la première fois.</p>
          <p>Si vous utilisez <a href="https://yarnpkg.com/">Yarn</a> :</p>
          <pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> build</code></pre>
          <p>Si vous utilisez <a href="https://www.npmjs.com/">npm</a> :</p>
          <pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> run build</code></pre>
          <p>Si aucun message ne s'affiche, ça veut dire que tout a bien fonctionné.</p>
        </section>
        <section id="type-definitions" class="level3">
          <h3>Définitions de types</h3>
          <p>Afin de pouvoir afficher les erreurs et conseils des autres modules, le compilateur a besoin de fichiers de déclarations. Un fichier de déclarations contient toutes les informations de typage d'une bibliothèque. Ça nous permet d'utiliser dans notre projet des bibliothèques JS telles que celles que l'on trouve sur npm.</p>
          <p>Il y a deux façons principales d'obtenir les déclarations de types d'une bibliothèque :</p>
          <p><strong>Inclue</strong> – La bibliothèque fournit déjà son fichier de déclarations. Ça nous arrange, il nous suffira d'installer la bibliothèque et nous pourrons l'utiliser sans tarder. Pour déterminer si une bibliothèque contient ses types, cherchez un fichier <code>index.d.ts</code> dans son projet. Certaines bibliothèques l'annoncent dans leur <code>package.json</code> avec le champ <code>typings</code> ou <code>types</code>.</p>
          <p><strong><a href="https://github.com/DefinitelyTyped/DefinitelyTyped">DefinitelyTyped</a></strong> – DefinitelyTyped est un énorme référentiel de déclarations pour les bibliothèques qui n’incluent pas leur fichier de déclarations. Les déclarations sont faites par tout le monde et gérées par Microsoft et des contributeurs en logiciel libre. React par exemple n'inclut pas de fichier de déclarations, mais on peut l'obtenir sur DefinitelyTyped. Pour ce faire, exécutez cette commande dans votre terminal.</p>
          <pre class="language-bash"><code class="language-bash"><span class="token comment"># yarn</span>
<span class="token function">yarn</span> <span class="token function">add</span> --dev @types/react

<span class="token comment"># npm</span>
<span class="token function">npm</span> i --save-dev @types/react</code></pre>
          <p><strong>Déclarations locales</strong> – Parfois, un module que vous souhaitez utiliser ne contient pas de déclarations et n'est pas non plus disponible sur DefinitelyTyped. Dans ce cas, on peut créer un fichier de déclarations local. Créez un fichier <code>declarations.d.ts</code> à la racine de votre dossier source. Une déclaration simple pourrait ressembler à ceci :</p>
          <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'querystring'</span> <span class="token punctuation">{</span>
  <span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">stringify</span><span class="token punctuation">(</span>val<span class="token operator">:</span> object<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">parse</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> object
<span class="token punctuation">}</span></code></pre>
          <p>Vous êtes maintenant prêt·e à écrire du code ! Nous vous conseillons de jeter un coup d’œil aux ressources suivantes pour en apprendre davantage sur TypeScript :</p>
          <ul>
            <li><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html">Documentation TypeScript : les types de base</a></li>
            <li><a href="https://www.typescriptlang.org/docs/handbook/migrating-from-javascript.html">Documentation TypeScript : migrer depuis JavaScript</a></li>
            <li><a href="https://www.typescriptlang.org/docs/handbook/react-&#x26;-webpack.html">Documentation TypeScript : React et Webpack</a></li>
          </ul>
        </section>
      </section>
      <section id="reason" class="level2">
        <h2>Reason</h2>
        <p><a href="https://reasonml.github.io/">Reason</a> n'est pas un nouveau langage, c'est une nouvelle syntaxe et une boîte à outils par-dessus le langage reconnu <a href="https://ocaml.org/">OCaml</a>. Reason donne à OCaml une syntaxe qui plaira aux développeurs JavaScript, et s’intègre bien avec les processus de développement basés sur npm et Yarn que les développeurs utilisent quotidiennement.</p>
        <p>Reason est développé chez Facebook, qui l’utilise pour certains de ses produits tels que Messenger. Il est encore relativement expérimental mais a des <a href="https://reasonml.github.io/reason-react/">intégrations React dédiées</a> maintenues par Facebook et par une <a href="https://reasonml.github.io/docs/en/community.html">communauté dynamique</a>.</p>
      </section>
      <section id="kotlin" class="level2">
        <h2>Kotlin</h2>
        <p><a href="https://kotlinlang.org/">Kotlin</a> est un langage au typage statique développé par JetBrains. Ses plateformes cibles sont entre autres la JVM, Android, LLVM et <a href="https://kotlinlang.org/docs/reference/js-overview.html">JavaScript</a>.</p>
        <p>JetBrains développe et maintient certains outils spécialement pour la communauté React : des <a href="https://github.com/JetBrains/kotlin-wrappers">intégrations React</a> ainsi que <a href="https://github.com/JetBrains/create-react-kotlin-app">Create React Kotlin App</a>. Ce dernier est conçu pour vous aider à commencer à construire des applications React avec Kotlin sans avoir à vous farcir une configuration de construction.</p>
      </section>
      <section id="other-languages" class="level2">
        <h2>Autres langages</h2>
        <p>
          Remarquez qu'il existe d'autres langages au typage statique qui compilent vers JavaScript et sont donc compatibles avec React. Par exemple, <a href="https://fable.io/">F#/Fable</a> avec <a href="https://elmish.github.io/react">elmish-react</a>. Allez voir leurs sites respectifs pour plus d'informations et n'hésitez pas à ajouter sur cette page d'autres langages au typage statique fonctionnant avec React !
          <span style="float: footnote;"><a href="./index.html#toc">Go to TOC</a></span>
        </p>
      </section>
    </section>
  </body>
</html>
