<!doctype html><html lang="fr"><meta charset="utf-8"><title>Référence de l’API du mode concurrent (expérimental)</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="référence-de-lapi-du-mode-concurrent-expérimental"class="level1"><h1>Référence de l’API du mode concurrent (expérimental)</h1><style>.scary>blockquote{background-color:rgba(237,51,21,.2);border-left-color:#ed3315}</style><div class="scary"><blockquote><p>Attention<p>Cette page décrit <strong>des fonctionnalités expérimentales qui <a href="./concurrent-mode-adoption.html">ne sont pas encore disponibles</a> dans une version stable</strong>. Ne vous basez pas sur les builds expérimentaux de React pour vos applis en production. Ces fonctionnalités sont susceptibles d’évoluer de façon significative et sans avertissement avant d’intégrer officiellement React.<p>Cette documentation est destinée aux personnes curieuses ou habituées à adopter les nouvelles technologies très tôt. <strong>Si vous débutez en React, ne vous préoccupez pas de ces fonctionnalités</strong> : vous n’avez pas besoin de les apprendre pour le moment.</blockquote></div><p>Cette page est une référence de l’API du <a href="./concurrent-mode-intro.html">mode concurrent</a> de React. Si vous cherchez plutôt un guide introductif, jetez un coup d’œil à <a href="./concurrent-mode-patterns.html">Approches pour une UI concurrente</a>.<p><strong>Remarque : ceci est un Aperçu pour la Communauté et ne constitue pas la version stable finale. Ces API changeront probablement à l’avenir. Ne les utilisez qu’à vos risques et périls !</strong><ul><li><a href="#concurrent-mode">Activer le mode concurrent</a><ul><li><a href="#createroot"><code>createRoot</code></a><li><a href="#createblockingroot"><code>createBlockingRoot</code></a></ul><li><a href="#suspense">API de Suspense</a><ul><li><a href="#suspensecomponent"><code>&#x3C;Suspense></code></a><li><a href="#suspenselist"><code>&#x3C;SuspenseList></code></a><li><a href="#usetransition"><code>useTransition</code></a><li><a href="#usedeferredvalue"><code>useDeferredValue</code></a></ul></ul><section id="concurrent-mode"class="level2"><h2>Activer le mode concurrent</h2><section id="createroot-createroot"class="level3"><h3><code>createRoot</code> {#createroot}</h3><pre class="language-js"><code class="language-js"><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">createRoot</span><span class="token punctuation">(</span>rootNode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Remplace <code>ReactDOM.render(&#x3C;App />, rootNode)</code> et active le mode concurrent.<p>Pour en savoir plus sur le mode concurrent, consultez la <a href="./concurrent-mode-intro.html">documentation du mode concurrent</a>.</section><section id="createblockingroot-createblockingroot"class="level3"><h3><code>createBlockingRoot</code> {#createblockingroot}</h3><pre class="language-js"><code class="language-js"><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">createBlockingRoot</span><span class="token punctuation">(</span>rootNode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span></code></pre><p>Remplace <code>ReactDOM.render(&#x3C;App />, rootNode)</code> at active le <a href="./concurrent-mode-adoption.html#migration-step-blocking-mode">mode bloquant</a>.<p>Choisir le mode concurrent introduit des modifications sémantiques dans le fonctionnement de React. Ça signifie que vous ne pouvez pas utiliser le mode concurrent sur seulement certains composants. Pour cette raison, certaines applis risquent de ne pas pouvoir migrer directement vers le mode concurrent.<p>Le mode bloquant fournit une petite partie des fonctionnalités du mode concurrent, et constitue une étape de migration intermédiaire pour les applis qui ne peuvent malheureusement pas migrer directement.</section></section><section id="suspense"class="level2"><h2>API de Suspense</h2><section id="suspense-suspensecomponent"class="level3"><h3><code>&#x3C;Suspense></code> {#suspensecomponent}</h3><pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Chargement</span><span class="token spread operator">...</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfilePhoto</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfileDetails</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span></code></pre><p><code>Suspense</code> permet à vos composants « d’attendre » que quelque chose ait lieu avant qu’ils procèdent à leur rendu, en affichant dans l’intervalle une interface utilisateur (UI) de repli.<p>Dans cet example, <code>ProfileDetails</code> attend qu’un appel API asynchrone charge des données. Pendant que nous attendons <code>ProfileDetails</code> et <code>ProfilePhoto</code>, nous affichons le repli <code>Chargement...</code> à leur place. Il faut bien comprendre que jusqu’à ce que tous les enfants de <code>&#x3C;Suspense></code> soient chargés, nous continuerons à afficher l’UI de repli.<p><code>Suspense</code> prend deux props :<ul><li><strong><code>fallback</code></strong> fournit un indicateur de chargement. Cette UI de repli est affichée jusqu’à ce que les enfants du composant <code>Suspense</code> aient fini leur rendu.<li><strong><code>unstable_avoidThisFallback</code></strong> prend un booléen. Elle indique à React s’il doit « sauter » la révélation de cette limite (c’est-à-dire le comportement d’attente) lors du chargement initial. Cette API sera probablement retirée dans une version à venir.</ul></section><section id="suspenselist-suspenselist"class="level3"><h3><code>&#x3C;SuspenseList></code> {#suspenselist}</h3><pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">SuspenseList</span> revealOrder<span class="token operator">=</span><span class="token string">"forwards"</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'Chargement...'</span><span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfilePicture</span> id<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'Chargement...'</span><span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfilePicture</span> id<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'Chargement...'</span><span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfilePicture</span> id<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
  <span class="token spread operator">...</span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">SuspenseList</span><span class="token operator">></span></code></pre><p><code>SuspenseList</code> aide à orchestrer la révélation progressive de composants susceptibles d’être suspendus.<p>Lorsque plusieurs composants ont besoin de charger des données, celles-ci peuvent arriver dans un ordre imprévisible. Cependant, si vous enrobez ces éléments dans un <code>SuspenseList</code>, React ne montrera un élément de la liste qu’une fois que tous les éléments qui le précèdent auront été affichés (ce comportement est d’ailleurs ajustable).<p><code>SuspenseList</code> prend deux props :<ul><li><strong><code>revealOrder</code> (<code>'forwards'</code>, <code>'backwards'</code>, <code>'together'</code>)</strong> indique dans quel ordre les enfants de la <code>SuspenseList</code> doivent être révélés.<ul><li><code>'together'</code> les révèle <em>tous</em> d’un coup une fois qu’ils sont prêts, au lieu de le faire individuellement.</ul><li><strong><code>tail</code> (<code>'collapsed'</code>, <code>'hidden'</code>)</strong> indique comment afficher les éléments non chargés dans une <code>SuspenseList</code>.<ul><li>Par défaut, <code>SuspenseList</code> affichera toutes les UI de repli dans la liste.<li><code>'collapsed'</code> affiche uniquement le repli du prochain élément dans la liste.<li><code>'hidden'</code> n’affiche aucun élément non chargé.</ul></ul><p>Remarquez que <code>SuspenseList</code> n’opère que sur les composants enfants <code>Suspense</code> et <code>SuspenseList</code> les plus proches d’elle. Elle ne recherche pas les périmètres à plus d’un niveau de profondeur. Ceci dit, il est possible d’imbriquer plusieurs composants <code>SuspenseList</code> pour construire des grilles.</section><section id="usetransition-usetransition"class="level3"><h3><code>useTransition</code> {#usetransition}</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">SUSPENSE_CONFIG</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">timeoutMs</span><span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>startTransition<span class="token punctuation">,</span> isPending<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useTransition</span><span class="token punctuation">(</span><span class="token constant">SUSPENSE_CONFIG</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>useTransition</code> permet aux composants d’éviter des états de chargement indésirables en attendant que le contenu soit chargé avant de <strong>transiter vers le prochain écran</strong>. Il permet aussi aux composants de différer des chargements de données plus lents vers des rendus ultérieurs afin que les mises à jour les plus cruciales puissent être affichées immédiatement.<p>Le hook <code>useTransition</code> renvoie deux valeurs dans un tableau.<ul><li><code>startTransition</code> est une fonction qui prend une fonction de rappel. Nous pouvons l’utiliser pour indiquer à React quel état nous souhaitons différer.<li><code>isPending</code> est un booléen, grâce auquel React nous indique si nous sommes en train d’attendre la fin de la transition.</ul><p><strong>Si une mise à jour donnée de l’état entraîne la suspension d’un composant, cette mise à jour devrait être enrobée dans une transition.</strong><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">SUSPENSE_CONFIG</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">timeoutMs</span><span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>resource<span class="token punctuation">,</span> setResource<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>startTransition<span class="token punctuation">,</span> isPending<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useTransition</span><span class="token punctuation">(</span><span class="token constant">SUSPENSE_CONFIG</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button
        disabled<span class="token operator">=</span><span class="token punctuation">{</span>isPending<span class="token punctuation">}</span>
        onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> nextUserId <span class="token operator">=</span> <span class="token function">getNextId</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token property-access">userId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setResource</span><span class="token punctuation">(</span><span class="token function">fetchProfileData</span><span class="token punctuation">(</span>nextUserId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Suivant</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>isPending <span class="token operator">?</span> <span class="token string">" Chargement..."</span> <span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Spinner</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfilePage</span> resource<span class="token operator">=</span><span class="token punctuation">{</span>resource<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Dans ce code, nous avons enrobé notre chargement de données avec <code>startTransition</code>. Ça nous permet de commencer immédiatement à charger les données du profil, tout en différant le rendu de la prochaine page de profil et de son <code>Spinner</code> associé pendant 2 secondes (le temps indiqué par <code>timeoutMs</code>).<p>Le booléen <code>isPending</code> est fourni par React pour nous indiquer que notre composant est en cours de transition, ce qui nous permet d’avertir l’utilisateur en affichant un texte de chargement au sein de la précédente page de profil.<p><strong>Pour une exploration en profondeur des transitions, vous pouvez lire les <a href="./concurrent-mode-patterns.html#transitions">Approches pour une UI concurrente</a>.</strong><section id="configuration-de-usetransition-usetransition-config"class="level4"><h4>Configuration de <code>useTransition</code> {#usetransition-config}</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">SUSPENSE_CONFIG</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">timeoutMs</span><span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><code>useTransition</code> accepte une <strong>configuration Suspense optionnelle</strong> avec un champ <code>timeoutMs</code>. Ce délai d’expiration (en millisecondes) indique à React combien de temps attendre avant d’afficher le prochain état (dans l’exemple ci avant, ce serait la prochaine page de profil).<p><strong>Remarque : nous vous conseillons de partager une unique configuration Suspense entre vos différents modules.</strong></section></section><section id="usedeferredvalue-usedeferredvalue"class="level3"><h3><code>useDeferredValue</code> {#usedeferredvalue}</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> deferredValue <span class="token operator">=</span> <span class="token function">useDeferredValue</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">timeoutMs</span><span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Renvoie une version différée de la valeur qui est susceptible d’être « en retard » pour un temps maximum de <code>timeoutMs</code>.<p>On utilise couramment ça pour préserver la réactivité de l’interface, avec des affichages immédiats suite à des saisies par l’utilisateur·rice malgré le besoin d’attendre un chargement de données.<p>La saisie de texte constitue un bon exemple :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">"bonjour"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> deferredText <span class="token operator">=</span> <span class="token function">useDeferredValue</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">timeoutMs</span><span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div className<span class="token operator">=</span><span class="token string">"App"</span><span class="token operator">></span>
      <span class="token punctuation">{</span><span class="token comment">/* Continue à passer le texte actuel au champ */</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token spread operator">...</span>
      <span class="token punctuation">{</span><span class="token comment">/* Mais la liste des résultats est autorisée à « être en retard » si nécessaire */</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MySlowList</span> text<span class="token operator">=</span><span class="token punctuation">{</span>deferredText<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span></code></pre><p>Ça nous permet de commencer à afficher le nouveau texte du <code>input</code> immédiatement, ce qui donne un sentiment de réactivité pour la page web. Dans le même temps, la mise à jour de <code>MySlowList</code> peut « retarder » à hauteur de 2 secondes en vertu du <code>timeoutMs</code>, ce qui lui permet de réaliser son rendu adapté au texte courant en arrière-plan.<p><strong>Vous trouverez une exploration en profondeur des valeurs différés dans les <a href="./concurrent-mode-patterns.html#deferring-a-value">Approches pour une UI concurrente</a>.</strong><section id="configuration-de-usedeferredvalue-usedeferredvalue-config"class="level4"><h4>Configuration de <code>useDeferredValue</code> {#usedeferredvalue-config}</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">SUSPENSE_CONFIG</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">timeoutMs</span><span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><code>useDeferredValue</code> accepte une <strong>configuration Suspense optionnelle</strong> avec un champ <code>timeoutMs</code>. Ce délai d’expiration (en millisecondes) indique à React pendant combien de temps la valeur différée est autorisée à retarder.<p>React essaiera toujours de minimiser le retard lorsque le réseau et l’appareil le permettent. <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section></section></section>