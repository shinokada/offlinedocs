<!doctypehtml><html lang="fr"><meta charset="utf-8"><title>Utilitaires de test</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css"><section id="utilitaires-de-test"class="level1"><h1>Utilitaires de test</h1><p><strong>Importation</strong><pre class="language-javascript"><code class="language-javascript"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ReactTestUtils</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/test-utils'</span><span class="token punctuation">;</span> <span class="token comment">// ES6</span>
<span class="token keyword">var</span> <span class="token maybe-class-name">ReactTestUtils</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react-dom/test-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ES5 avec npm</span></code></pre><section id="overview"class="level2"><h2>Aperçu</h2><p><code>ReactTestUtils</code> facilite le test de composants React quel que soit votre framework de test. Chez Facebook, nous utilisons <a href="https://facebook.github.io/jest/">Jest</a> pour réaliser facilement nos tests JavaScript. Pour bien démarrer avec Jest, vous pouvez lire le <a href="http://facebook.github.io/jest/docs/en/tutorial-react.html#content">Tutoriel React</a> du site web de Jest.<blockquote><p>Remarque<p>Nous vous conseillons d’utiliser <a href="https://testing-library.com/react">React Testing Library</a>. Cette bibliothèque est conçue pour encourager l'écriture de tests utilisant vos composants de façon similaire aux utilisateurs finaux.<p>Par ailleurs, Airbnb propose un utilitaire de test appelé <a href="http://airbnb.io/enzyme/">Enzyme</a>, qui permet de facilement exprimer des assertions, manipuler vos composants React et en explorer le résultat.</blockquote><ul><li><a href="#act"><code>act()</code></a><li><a href="#mockcomponent"><code>mockComponent()</code></a><li><a href="#iselement"><code>isElement()</code></a><li><a href="#iselementoftype"><code>isElementOfType()</code></a><li><a href="#isdomcomponent"><code>isDOMComponent()</code></a><li><a href="#iscompositecomponent"><code>isCompositeComponent()</code></a><li><a href="#iscompositecomponentwithtype"><code>isCompositeComponentWithType()</code></a><li><a href="#findallinrenderedtree"><code>findAllInRenderedTree()</code></a><li><a href="#scryrendereddomcomponentswithclass"><code>scryRenderedDOMComponentsWithClass()</code></a><li><a href="#findrendereddomcomponentwithclass"><code>findRenderedDOMComponentWithClass()</code></a><li><a href="#scryrendereddomcomponentswithtag"><code>scryRenderedDOMComponentsWithTag()</code></a><li><a href="#findrendereddomcomponentwithtag"><code>findRenderedDOMComponentWithTag()</code></a><li><a href="#scryrenderedcomponentswithtype"><code>scryRenderedComponentsWithType()</code></a><li><a href="#findrenderedcomponentwithtype"><code>findRenderedComponentWithType()</code></a><li><a href="#renderintodocument"><code>renderIntoDocument()</code></a><li><a href="#simulate"><code>Simulate</code></a></ul></section><section id="reference"class="level2"><h2>Référence de l'API</h2><section id="act-act"class="level3"><h3><code>act()</code> {#act}</h3><p>Afin de préparer un composant aux assertions, il suffit d’enrober le code qui se charge de son rendu et de ses mises à jour au sein d'une fonction de rappel qui sera passée à <code>act()</code>. De cette manière, votre test s’exécutera dans un environnement proche de celui de React dans le navigateur.<blockquote><p>Remarque<p>Si vous utilisez <code>react-test-renderer</code>, ce dernier propose un export de <code>act</code> qui se comporte de la même façon.</blockquote><p>Prenons l'exemple d'un composant <code>Counter</code> :<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleClick</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">handleClick</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">title</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Vous avez cliqué </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> fois</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">title</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Vous avez cliqué </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> fois</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Vous</span> avez cliqué <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">}</span> fois<span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleClick</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Cliquez</span> ici
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Voici comment nous pouvons le tester :<pre class="language-js{3,20-22,29-31}"><code class="language-js{3,20-22,29-31}">import React from 'react';
import ReactDOM from 'react-dom';
import { act } from 'react-dom/test-utils';
import Counter from './Counter';

let container;

beforeEach(() => {
  container = document.createElement('div');
  document.body.appendChild(container);
});

afterEach(() => {
  document.body.removeChild(container);
  container = null;
});

it('peut afficher et mettre à jour un compteur', () => {
  // Teste le premier affichage et l'appel à componentDidMount
  act(() => {
    ReactDOM.render(&#x3C;Counter />, container);
  });
  const button = container.querySelector('button');
  const label = container.querySelector('p');
  expect(label.textContent).toBe('Vous avez cliqué 0 fois');
  expect(document.title).toBe('Vous avez cliqué 0 fois');

  // Teste un second affichage et l'appel à componentDidUpdate
  act(() => {
    button.dispatchEvent(new MouseEvent('click', {bubbles: true}));
  });
  expect(label.textContent).toBe('Vous avez cliqué 1 fois');
  expect(document.title).toBe('Vous avez cliqué 1 fois');
});</code></pre><p>N'oubliez pas que l'émission d'événements DOM ne fonctionne que lorsque le conteneur DOM a été ajouté au <code>document</code>. Vous pouvez utiliser un utilitaire comme <a href="https://testing-library.com/react"><code>React Testing Library</code></a> afin de réduire le volume de code générique.<p>La page des <a href="./testing-recipes.html"><code>recettes</code></a> contient de plus amples détails sur le fonctionnement de <code>act()</code>, avec des exemples d’utilisation.<hr></section><section id="mockcomponent-mockcomponent"class="level3"><h3><code>mockComponent()</code> {#mockcomponent}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">mockComponent</span><span class="token punctuation">(</span>
  componentClass<span class="token punctuation">,</span>
  <span class="token punctuation">[</span>mockTagName<span class="token punctuation">]</span>
<span class="token punctuation">)</span></code></pre><p>Cette méthode prend un module de composant simulé et lui ajoute des méthodes utiles pour lui permettre d'être utilisé comme un composant React factice. Plutôt que de réaliser un rendu classique, le composant va simplement devenir une balise <code>&#x3C;div></code> (ou toute autre balise si <code>mockTagName</code> est renseigné) contenant les enfants qui lui sont fournis.<blockquote><p>Remarque<p><code>mockComponent()</code> est une API obsolète. Nous recommandons plutôt de recourir à <a href="https://facebook.github.io/jest/docs/en/tutorial-react-native.html#mock-native-modules-using-jestmock"><code>jest.mock()</code></a>.</blockquote><hr></section><section id="iselement-iselement"class="level3"><h3><code>isElement()</code> {#iselement}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">isElement</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span></code></pre><p>Renvoie <code>true</code> si <code>element</code> est un élément React.<hr></section><section id="iselementoftype-iselementoftype"class="level3"><h3><code>isElementOfType()</code> {#iselementoftype}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">isElementOfType</span><span class="token punctuation">(</span>
  element<span class="token punctuation">,</span>
  componentClass
<span class="token punctuation">)</span></code></pre><p>Renvoie <code>true</code> si <code>element</code> est un élément React dont le type est un <code>componentClass</code> React.<hr></section><section id="isdomcomponent-isdomcomponent"class="level3"><h3><code>isDOMComponent()</code> {#isdomcomponent}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">isDOMComponent</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span></code></pre><p>Renvoie <code>true</code> si <code>instance</code> est un composant DOM (tel que <code>&#x3C;div></code> ou <code>&#x3C;span></code>).<hr></section><section id="iscompositecomponent-iscompositecomponent"class="level3"><h3><code>isCompositeComponent()</code> {#iscompositecomponent}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">isCompositeComponent</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span></code></pre><p>Renvoie <code>true</code> si <code>instance</code> est un composant défini par l'utilisateur, via une classe ou une fonction.<hr></section><section id="iscompositecomponentwithtype-iscompositecomponentwithtype"class="level3"><h3><code>isCompositeComponentWithType()</code> {#iscompositecomponentwithtype}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">isCompositeComponentWithType</span><span class="token punctuation">(</span>
  instance<span class="token punctuation">,</span>
  componentClass
<span class="token punctuation">)</span></code></pre><p>Renvoie <code>true</code> si <code>instance</code> est un composant dont le type est un <code>componentClass</code> React.<hr></section><section id="findallinrenderedtree-findallinrenderedtree"class="level3"><h3><code>findAllInRenderedTree()</code> {#findallinrenderedtree}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">findAllInRenderedTree</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  test
<span class="token punctuation">)</span></code></pre><p>Parcourt tous les composants présents dans <code>tree</code> en ne retenant que les composants pour lesquels <code>test(component)</code> renvoie <code>true</code>. Ce n'est guère utile en soi, mais ça sert de base à d'autres utilitaires de test.<hr></section><section id="scryrendereddomcomponentswithclass-scryrendereddomcomponentswithclass"class="level3"><h3><code>scryRenderedDOMComponentsWithClass()</code> {#scryrendereddomcomponentswithclass}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">scryRenderedDOMComponentsWithClass</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  className
<span class="token punctuation">)</span></code></pre><p>Trouve tous les éléments DOM des composants de l'arbre de rendu qui sont des composants DOM dont la classe CSS correspond à <code>className</code>.<hr></section><section id="findrendereddomcomponentwithclass-findrendereddomcomponentwithclass"class="level3"><h3><code>findRenderedDOMComponentWithClass()</code> {#findrendereddomcomponentwithclass}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">findRenderedDOMComponentWithClass</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  className
<span class="token punctuation">)</span></code></pre><p>Fonctionne comme <a href="#scryrendereddomcomponentswithclass"><code>scryRenderedDOMComponentsWithClass()</code></a>, mais cette méthode s'attend à ne trouver qu'un seul résultat, qu'elle renverra. Si elle trouve un nombre d'éléments différent de un, elle lèvera une exception .<hr></section><section id="scryrendereddomcomponentswithtag-scryrendereddomcomponentswithtag"class="level3"><h3><code>scryRenderedDOMComponentsWithTag()</code> {#scryrendereddomcomponentswithtag}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">scryRenderedDOMComponentsWithTag</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  tagName
<span class="token punctuation">)</span></code></pre><p>Trouve tous les éléments DOM parmi les composants de l'arbre de rendu qui sont des composants DOM dont le nom de balise correspond à<code>tagName</code>.<hr></section><section id="findrendereddomcomponentwithtag-findrendereddomcomponentwithtag"class="level3"><h3><code>findRenderedDOMComponentWithTag()</code> {#findrendereddomcomponentwithtag}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">findRenderedDOMComponentWithTag</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  tagName
<span class="token punctuation">)</span></code></pre><p>Fonctionne comme <a href="#scryrendereddomcomponentswithtag"><code>scryRenderedDOMComponentsWithTag()</code></a>, mais cette méthode s'attend à ne trouver qu'un seul résultat, qu'elle renverra. Si elle trouve un nombre d'éléments différent de un, elle lèvera une exception.<hr></section><section id="scryrenderedcomponentswithtype-scryrenderedcomponentswithtype"class="level3"><h3><code>scryRenderedComponentsWithType()</code> {#scryrenderedcomponentswithtype}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">scryRenderedComponentsWithType</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  componentClass
<span class="token punctuation">)</span></code></pre><p>Trouve toutes les instances des composants dont le type est <code>componentClass</code>.<hr></section><section id="findrenderedcomponentwithtype-findrenderedcomponentwithtype"class="level3"><h3><code>findRenderedComponentWithType()</code> {#findrenderedcomponentwithtype}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">findRenderedComponentWithType</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  componentClass
<span class="token punctuation">)</span></code></pre><p>Fonctionne comme <a href="#scryrenderedcomponentswithtype"><code>scryRenderedComponentsWithType()</code></a>, mais cette méthode s'attend à ne trouver qu'un seul résultat, qu'elle renverra. Si elle trouve un nombre d'éléments différent de un, elle lèvera une exception.<hr></section><section id="renderintodocument-renderintodocument"class="level3"><h3><code>renderIntoDocument()</code> {#renderintodocument}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">renderIntoDocument</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span></code></pre><p>Réalise le rendu d'un élément React au sein d'un nœud du DOM détaché du document. <strong>Cette fonction nécessite un DOM</strong>. C'est en fait équivalent à :<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> domContainer <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> domContainer<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>Remarque<p>Vous aurez besoin d'avoir <code>window</code>, <code>window.document</code> et <code>window.document.createElement</code> disponibles globalement <strong>avant</strong> votre import de <code>React</code>. Dans le cas contraire, React pensera qu'il ne peut accéder au DOM, et des méthodes telles que <code>setState</code> ne fonctionneront pas.</blockquote><hr></section></section><section id="other-utilities"class="level2"><h2>Autre utilitaires</h2><section id="simulate-simulate"class="level3"><h3><code>Simulate</code> {#simulate}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token maybe-class-name">Simulate</span><span class="token punctuation">.</span><span class="token punctuation">{</span>eventName<span class="token punctuation">}</span><span class="token punctuation">(</span>
  element<span class="token punctuation">,</span>
  <span class="token punctuation">[</span>eventData<span class="token punctuation">]</span>
<span class="token punctuation">)</span></code></pre><p>Simule l'envoi d'un événement sur un nœud du DOM avec des données optionnelles dans <code>eventData</code>.<p><code>Simulate</code> dispose d'une méthode pour <a href="./events.html#supported-events">chaque événement que React comprend</a>.<p><strong>Cliquer sur un élément</strong><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// &#x3C;button ref={(node) => this.button = node}>...&#x3C;/button></span>
<span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">button</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">ReactTestUtils</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Simulate</span></span><span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>Changer la valeur d'un champ de saisie puis presser ENTRÉE.</strong><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// &#x3C;input ref={(node) => this.textInput = node} /></span>
<span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">textInput</span><span class="token punctuation">;</span>
node<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> <span class="token string">'girafe'</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">ReactTestUtils</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Simulate</span></span><span class="token punctuation">.</span><span class="token method function property-access">change</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">ReactTestUtils</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Simulate</span></span><span class="token punctuation">.</span><span class="token method function property-access">keyDown</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">"Enter"</span><span class="token punctuation">,</span> <span class="token literal-property property">keyCode</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token literal-property property">which</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>Remarque<p>Vous devrez fournir toute les propriétés dédiées aux événements que vous utilisez dans votre composant (par exemple keyCode, which, etc.) car React ne les créera pas pour vous.</blockquote><hr><p><span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section></section>