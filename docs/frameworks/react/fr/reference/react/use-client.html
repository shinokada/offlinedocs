<!doctype html><html lang="fr"><meta charset="utf-8"><title>"'use client'"</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="use-client"><h1 id="use-client">"'use client'"</h1><p>titleForTitleTag: "Directive 'use client'" canary: true</p><canary><p><code>'use client'</code> n'est utile que si vous <a href="/learn/start-a-new-react-project#bleeding-edge-react-frameworks">utilisez React Server Components</a> ou créez une bibliothèque compatible avec eux.</p></canary><intro><p><code>'use client'</code> vous permet d'indiquer quel code est exécuté côté client.</p></intro><inlinetoc><section class="level2"aria-labelledby="référence-reference"><h2 id="référence-reference">Référence {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="use-client-use-client"><h3 id="use-client-use-client"><code>'use client'</code> {/<em>use-client</em>/}</h3><p>Ajoutez <code>'use client';</code> tout en haut d'un fichier pour indiquer que ce fichier (ainsi que toutes ses dépendances directes et indirectes) s'exécute coté client.<pre class="language-js"><code class="language-js"><span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> formatDate <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./formatters'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Button</span></span> <span class="token keyword module">from</span> <span class="token string">'./button'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">RichTextEditor</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> timestamp<span class="token punctuation">,</span> text <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token function">formatDate</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> editButton <span class="token operator">=</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Button</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Lorsqu'un fichier marqué avec <code>'use client'</code> est importé par un Composant Serveur, <a href="/learn/start-a-new-react-project#bleeding-edge-react-frameworks">les <em>bundlers</em> compatibles</a> traiteront l'import comme un « point de césure » entre le code côté serveur et le code côté client.<p>En tant que dépendances de <code>RichTextEditor</code>, <code>formatDate</code> et <code>Button</code> seront également évaluées côté client, indépendamment de la présence d'une directive <code>'use client'</code> dans le module qui les déclare. Notez qu'un même module peut être évalué tant côté serveur lorsqu'il est importé par du code côté serveur, que côté client lorsqu'il est importé par du code côté client.<section class="level4"aria-labelledby="limitations-caveats"><h4 id="limitations-caveats">Limitations {/<em>caveats</em>/}</h4><ul><li><code>'use client'</code> doit être placé au tout début de la fonction ou du module concerné ; au-dessus notamment de tout code, y compris les imports (mais il peut y avoir des commentaires avant les directives). La directive doit utiliser des apostrophes (<code>'</code>) ou guillemets (<code>"</code>), mais pas des <em>backticks</em> (<code>`</code>).<li>Lorsqu'un fichier <code>'use client'</code> est importé depuis un autre fichier côté client, la directive n'a aucun effet.<li>Lorsqu'un module de composant contient une directive <code>'use client'</code>, toute utilisation de ce composant produit de façon garantie un Composant Client. Ceci dit, un composant peut être évalué côté client même s'il n'utilise pas de directive <code>'use client'</code>.<ul><li>L'utilisation d'un composant constitue un Composant Client si elle a lieu dans un module doté d'une directive <code>'use client'</code> ou si elle compte dans ses dépendances (directes ou indirectes) un module doté d'une directive <code>'use client'</code>. Dans tous les autres cas, on considère que le composant est côté serveur.</ul><li>Le code marqué comme exécutable côté client ne se limite pas aux composants. Tout code figurant dans l'arbre des dépendances d'un Module Client est envoyé vers le client pour y être exécuté.<li>Lorsqu'un Module Serveur importe les valeurs d'un module doté de la directive <code>'use client'</code>, les valeurs en question doivent être soit un composant React, soit une des <a href="#passing-props-from-server-to-client-components">valeurs de prop sérialisables</a> prises en charge afin de pouvoir être passées au Composant Client par du code côté serveur. Tout autre cas de figure lève une exception.</ul></section></section><section class="level3"aria-labelledby="comment-use-client-marque-du-code-comme-étant-côté-client-how-use-client-marks-client-code"><h3 id="comment-use-client-marque-du-code-comme-étant-côté-client-how-use-client-marks-client-code">Comment <code>'use client'</code> marque du code comme étant côté client {/<em>how-use-client-marks-client-code</em>/}</h3><p>Dans une appli React, les composants sont souvent répartis en plusieurs fichiers ou <a href="/learn/importing-and-exporting-components#exporting-and-importing-a-component">modules</a>.<p>Pour les applis ayant recours aux React Server Components, l'appli fait par défaut son rendu coté serveur. <code>'use client'</code> crée un « point de césure » entre les codes côté client et côté serveur au sein de <a href="/learn/understanding-your-ui-as-a-tree#the-module-dependency-tree">l'arbre de dépendances de modules</a>, produisant de fait une sous-arborescence de Modules Client.<p>Afin de mieux illustrer cet aspect, considérons l'appli suivante basée sur les React Server Components.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">FancyText</span></span> <span class="token keyword module">from</span> <span class="token string">'./FancyText'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">InspirationGenerator</span></span> <span class="token keyword module">from</span> <span class="token string">'./InspirationGenerator'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Copyright</span></span> <span class="token keyword module">from</span> <span class="token string">'./Copyright'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">FancyText</span> title text<span class="token operator">=</span><span class="token string">"Une appli pour être inspiré·e"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">InspirationGenerator</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Copyright</span> year<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">2004</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">InspirationGenerator</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FancyText</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>title<span class="token punctuation">,</span> text<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> title
    <span class="token operator">?</span> <span class="token operator">&#x3C;</span>h1 className<span class="token operator">=</span><span class="token string">'fancy title'</span><span class="token operator">></span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">:</span> <span class="token operator">&#x3C;</span>h3 className<span class="token operator">=</span><span class="token string">'fancy cursive'</span><span class="token operator">></span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h3<span class="token operator">></span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">inspirations</span> <span class="token keyword module">from</span> <span class="token string">'./inspirations'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">FancyText</span></span> <span class="token keyword module">from</span> <span class="token string">'./FancyText'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">InspirationGenerator</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>children<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>index<span class="token punctuation">,</span> setIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> quote <span class="token operator">=</span> inspirations<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">next</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> inspirations<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Voici</span> de quoi vous inspirer <span class="token operator">:</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">FancyText</span> text<span class="token operator">=</span><span class="token punctuation">{</span>quote<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>next<span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Inspire</span><span class="token operator">-</span>moi encore<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Copyright</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>year<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>p className<span class="token operator">=</span><span class="token string">'small'</span><span class="token operator">></span>©️ <span class="token punctuation">{</span>year<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">[</span>
  <span class="token string">"Ne laisse pas hier occuper trop d’aujourd’hui. — Will Rogers"</span><span class="token punctuation">,</span>
  <span class="token string">"L’ambition, c’est poser une échelle contre le ciel."</span><span class="token punctuation">,</span>
  <span class="token string">"Une joie partagée compte double."</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.fancy</span></span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'Georgia'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.title</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#007AA3</span><span class="token punctuation">;</span>
  <span class="token property">text-decoration</span><span class="token punctuation">:</span> underline<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.cursive</span></span> <span class="token punctuation">{</span>
  <span class="token property">font-style</span><span class="token punctuation">:</span> italic<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.small</span></span> <span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>Dans l'arbre de dépendances de modules pour cette appli d'exemple, la directive <code>'use client'</code> dans <code>InspirationGenerator.js</code> marque ce module et toutes ses dépendances transitives comme des Modules Client. La partie de l'arborescence qui démarre avec <code>InspirationGenerator.js</code> est désormais marquée comme des Modules Client.</p><diagram name="use_client_module_dependency"height="{250}"width="{545}"alt="Un graphe d’arborescence avec le nœud sommet représentant le module &#x27;App.js&#x27;. &#x27;App.js&#x27; a trois enfants : &#x27;Copyright.js&#x27;, &#x27;FancyText.js&#x27; et &#x27;InspirationGenerator.js&#x27;. &#x27;InspirationGenerator.js&#x27; a deux enfants : &#x27;FancyText.js&#x27; et &#x27;inspirations.js&#x27;. Les nœuds à partir de &#x27;InspirationGenerator.js&#x27; ont un arrière-plan jaune pour indiquer qu’il s’agit du sous-graphe exécuté côté client en raison de la directive &#x27;use client&#x27; dans &#x27;InspirationGenerator.js&#x27;."><p><code>'use client'</code> segmente l'arbre de dépendances de modules de l'appli utilisant les React Server Components, en marquant <code>InspirationGenerator.js</code> et toutes ses dépendances comme exécutables côté client.<p>Lors du rendu, le framework fera un rendu côté serveur du composant racine et continuera à traverser <a href="/learn/understanding-your-ui-as-a-tree#the-render-tree">l'arbre de rendu</a>, en sautant l'évaluation de tout code importé par du code côté client.<p>La partie rendue côté serveur de l'arbre de rendu est alors envoyée côté client. Le client, ainsi que le code côté client qu'il aura téléchargé, termine enfin le rendu du reste de l'arborescence.</p><diagram name="use_client_render_tree"height="{250}"width="{500}"alt="Un graphe d’arborescence où chaque nœud représente un composant et ses enfants comme composants enfants.  Le nœud sommet est étiquetté &#x27;App&#x27; et a deux composants enfants : &#x27;InspirationGenerator&#x27; et &#x27;FancyText&#x27;. &#x27;InspirationGenerator&#x27; a deux composants enfants, &#x27;FancyText&#x27; et &#x27;Copyright&#x27;. Aussi bien &#x27;InspirationGenerator&#x27; que son composant enfant &#x27;FancyText&#x27; sont marqués comme utilisant un rendu côté client."><p>L'arbre de rendu de l'appli utilisant les React Server Components. <code>InspirationGenerator</code> et son composant enfant <code>FancyText</code> sont des composants exportés par du code marqué comme côté client, et sont donc considérés comme des Composants Client.</p></diagram><p>On introduit ici les définitions suivantes :<ul><li>Les <strong>Composants Client</strong> sont les composants dans l'arbre de rendu dont le rendu est fait côté client.<li>Les <strong>Composants Serveur</strong> sont les composants dans l'arbre de rendu dont le rendu est fait côté serveur.</ul><p>En parcourant l'appli d'exemple, <code>App</code>, <code>FancyText</code> et <code>Copyright</code> sont tous rendus côté serveur et donc considérés comme des Composants Serveur. Mais puisque <code>InspirationGenerator.js</code> et ses dépendances transitives sont marquées comme du code côté client, le composant <code>InspirationGenerator</code> et son composant enfant <code>FancyText</code> sont des Composants Client.</p><deepdive><section class="level4"aria-labelledby="pourqoi-fancytext-est-il-à-la-fois-un-composant-serveur-et-un-composant-client-how-is-fancytext-both-a-server-and-a-client-component"><h4 id="pourqoi-fancytext-est-il-à-la-fois-un-composant-serveur-et-un-composant-client-how-is-fancytext-both-a-server-and-a-client-component">Pourqoi <code>FancyText</code> est-il à la fois un Composant Serveur et un Composant Client ? {/<em>how-is-fancytext-both-a-server-and-a-client-component</em>/}</h4><p>À en croire les définitions ci-dessus, le composant <code>FancyText</code> est à la fois un Composant Serveur et côté client, comment est-ce possible ?<p>Commençons par clarifier le terme « composant », qui n'est pas très précis. Voici deux façons de comprendre « composant » :<ol><li>Un « composant » peut désigner une <strong>définition de composant</strong>. La plupart du temps, il s'agira en pratique d'une fonction.</ol><pre class="language-js"><code class="language-js"><span class="token comment">// Voici une définition de composant</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Mon</span> composant<span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
<span class="token punctuation">}</span></code></pre><ol><li>Un « composant » peut également faire référence à une <strong>utilisation de la définition du composant</strong>.</ol><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">MyComponent</span></span> <span class="token keyword module">from</span> <span class="token string">'./MyComponent'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Voici une utilisation du composant</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MyComponent</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Cette distinction est généralement superflue lorsqu'on explique des concepts, mais revêt ici une importance particulière.<p>Lorsque nous parlons de Composants Serveur ou côté client, nous faisons spécifiquement référence à l'utilisation des composants.<ul><li>Si le composant est défini dans un module porteur de la directive <code>'use client'</code>, ou s'il est importé et appelé dans un Composant Client, alors l'utilisation de ce composant constitue un Composant Client.<li>Dans les autres cas, l'utilisation de ce composant constitue un Composant Serveur.</ul><diagram name="use_client_render_tree"height="{150}"width="{450}"alt="Un graphe d’arborescence où chaque nœud représente un composant et ses enfants comme composants enfants.  Le nœud sommet est étiquetté &#x27;App&#x27; et a deux composants enfants : &#x27;InspirationGenerator&#x27; et &#x27;FancyText&#x27;. &#x27;InspirationGenerator&#x27; a deux composants enfants, &#x27;FancyText&#x27; et &#x27;Copyright&#x27;. Aussi bien &#x27;InspirationGenerator&#x27; que son composant enfant &#x27;FancyText&#x27; sont marqués comme utilisant un rendu côté client."><p>Un arbre de rendu illustre les utilisations des composants.</p></diagram><p>Pour en revenir à la question de <code>FancyText</code>, nous pouvons voir que la définition du composant <em>ne comporte pas</em> de directive <code>'use client'</code> et qu'elle est utilisée deux fois.<p>L'utilisation de <code>FancyText</code> comme enfant de <code>App</code> marque cette utilisation comme un Composant Serveur. En revanche, l'import et l'appel de <code>FancyText</code> au sein de <code>InspirationGenerator</code> marque cette utilisation comme un Composant Client puisque <code>InspirationGenerator</code> est assujetti à une directive <code>'use client'</code>.<p>Ça signifie que la définition du composant <code>FancyText</code> sera évaluée côté serveur mais aussi envoyée vers le client pour faire le rendu de son utilisation en tant que Composant Client.</p><deepdive></deepdive></section><section class="level4"aria-labelledby="pourquoi-copyright-est-il-un-composant-serveur-why-is-copyright-a-server-component"><h4 id="pourquoi-copyright-est-il-un-composant-serveur-why-is-copyright-a-server-component">Pourquoi <code>Copyright</code> est-il un Composant Serveur ? {/<em>why-is-copyright-a-server-component</em>/}</h4><p>Dans la mesure où <code>Copyright</code> figure comme composant enfant dans le rendu du Composant Client <code>InspirationGenerator</code>, vous êtes peut-être surpris·e qu'il soit considéré comme un Composant Serveur.<p>Gardez à l'esprit que <code>'use client'</code> définit un « point de césure » entre les codes côté serveur et côté client dans <em>l'arbre de dépendances de modules</em>, pas dans l'arbre de rendu.</p><diagram name="use_client_module_dependency"height="{200}"width="{500}"alt="Un graphe d’arborescence avec le nœud sommet représentant le module &#x27;App.js&#x27;. &#x27;App.js&#x27; a trois enfants : &#x27;Copyright.js&#x27;, &#x27;FancyText.js&#x27; et &#x27;InspirationGenerator.js&#x27;. &#x27;InspirationGenerator.js&#x27; a deux enfants : &#x27;FancyText.js&#x27; et &#x27;inspirations.js&#x27;. Les nœuds à partir de &#x27;InspirationGenerator.js&#x27; ont un arrière-plan jaune pour indiquer qu’il s’agit du sous-graphe exécuté côté client en raison de la directive &#x27;use client&#x27; dans &#x27;InspirationGenerator.js&#x27;."><p><code>'use client'</code> définit un « point de césure » entre les codes côté serveur et côté client de l'arbre de dépendances de modules.</p></diagram><p>Dans l'arbre de dépendances de modules, nous voyons que <code>App.js</code> importe et appelle <code>Copyright</code> depuis le module <code>Copyright.js</code>. Puisque <code>Copyright.js</code> ne comporte pas de directive <code>'use client'</code>, cette utilisation du composant est rendue côté serveur. <code>App</code> est lui aussi rendu côté serveur puisqu'il s'agit du composant racine.<p>Les Composants Client peuvent faire le rendu de Composants Serveur parce que vous pouvez passer du JSX comme props. Dans notre cas, <code>InspirationGenerator</code> reçoit <code>Copyright</code> comme <a href="/learn/passing-props-to-a-component#passing-jsx-as-children">enfant</a>. Cependant, le module <code>InspirationGenerator.js</code> n'importe jamais directement le module <code>Copyright.js</code>, c'est le module <code>App.js</code> qui s'en occupe. En fait, le composant <code>Copyright</code> est entièrement exécuté avant même qu'<code>InspirationGenerator</code> ne commence son rendu.<p>Le point important à retenir, c'est que la relation de rendu parent-enfant ne garantit pas un environnement de rendu unique.</section></deepdive></diagram></section><section class="level3"aria-labelledby="quand-utiliser-use-client-when-to-use-use-client"><h3 id="quand-utiliser-use-client-when-to-use-use-client">Quand utiliser <code>'use client'</code> {/<em>when-to-use-use-client</em>/}</h3><p>Avec <code>'use client'</code>, vous pouvez déterminer quand les composants sont des Composants Client. Dans la mesure où les composants sont côté serveur par défaut, voici un survol rapide des avantages et limitations des Composants Serveur, pour vous aider à déterminer si vous avez besoin de marquer du code comme étant côté client.<p>Par souci de simplicité, nous parlons ici des Composants Serveur, mais les mêmes principes s'appliquent à tout code de votre appli qui serait exécuté côté serveur.<section class="level4"aria-labelledby="avantages-des-composants-serveur-advantages"><h4 id="avantages-des-composants-serveur-advantages">Avantages des Composants Serveur {/<em>advantages</em>/}</h4><ul><li>Les Composants Serveur aident à réduire la quantité de code envoyée et exécutée côté client. Seuls les Modules Client sont intégrés aux <em>bundles</em> et évalués côté client.<li>Les Composants Serveur tirent parti de leur exécution côté serveur : ils peuvent accéder à son système de fichiers local et bénéficient par ailleurs d'une faible latence pour leurs chargements de données et autres requêtes réseau.</ul></section><section class="level4"aria-labelledby="limitations-des-composants-serveurs-limitations"><h4 id="limitations-des-composants-serveurs-limitations">Limitations des Composants Serveurs {/<em>limitations</em>/}</h4><ul><li>Les Composants Serveur ne peuvent pas gérer d'interactions, puisque les gestionnaires d'événements ne peuvent être inscrits et déclenchés que par le client.<ul><li>Des gestionnaires d'événements tels que <code>onClick</code> ne peuvent par exemple être définis que dans des Composants Client.</ul><li>Les Composants Serveur ne peuvent pas utiliser la plupart des Hooks.<ul><li>Lorsque les Composants Serveur font leur rendu, le résultat se résume pour l'essentiel à une liste de composants dont le rendu doit être fait côté client. Les Composants Serveur ne persistent pas en mémoire une fois le rendu effectué, et ne peuvent donc pas avoir leur propre état.</ul></ul></section></section><section class="level3"aria-labelledby="types-sérialisables-renvoyés-par-les-composants-serveur-serializable-types"><h3 id="types-sérialisables-renvoyés-par-les-composants-serveur-serializable-types">Types sérialisables renvoyés par les Composants Serveur {/<em>serializable-types</em>/}</h3><p>Comme dans n'importe quelle appli React, les composants parents passent des données à leurs composants enfants. Puisqu'ils sont ici rendus dans des environnements distincts, le passage de données d'un Composant Serveur à un Composant Client nécessite une attention particulière.<p>Les valeurs de props passées à un Composant Client doivent être sérialisables.<p>Voici les types de props sérialisables :<ul><li>Types primitifs<ul><li><a href="https://developer.mozilla.org/fr/docs/Glossary/String">string</a><li><a href="https://developer.mozilla.org/fr/docs/Glossary/Number">number</a><li><a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/BigInt">bigint</a><li><a href="https://developer.mozilla.org/fr/docs/Glossary/Boolean">boolean</a><li><a href="https://developer.mozilla.org/fr/docs/Glossary/Undefined">undefined</a><li><a href="https://developer.mozilla.org/fr/docs/Glossary/Null">null</a><li><a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Symbol">symbol</a>, mais uniquement pour ceux inscrits auprès du référentiel global de symboles <em>via</em> <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Symbol/for"><code>Symbol.for</code></a></ul><li>Les itérables contenant des valeurs sérialisables<ul><li><a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/String">String</a><li><a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Array">Array</a><li><a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a><li><a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a><li><a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/TypedArray">TypedArray</a> et <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">ArrayBuffer</a></ul><li><a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Date">Date</a><li>Les <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Object">objets</a> bruts : ceux créés via des <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Operators/Object_initializer">initialiseurs d'objets</a>, dont les propriétés sont sérialisables<li>Les fonctions qui sont des <a href="/reference/react/use-server">Actions Serveur</a><li>Les éléments basés sur des Composants Client ou côté serveur (JSX)<li>Les <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Promise">promesses</a></ul><p>En particulier, les types suivants ne sont <strong>pas</strong> pris en charge :<ul><li>Les <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Function">fonctions</a> qui ne sont pas exportées par des modules marqués comme côté client, ou qui sont marquées avec <a href="/reference/react/use-server"><code>'use server'</code></a><li>Les <a href="https://developer.mozilla.org/fr/docs/Learn/JavaScript/Objects/Classes_in_JavaScript">classes</a><li>Les objets de quelque classe que ce soit (hormis les classes natives explicitement listées plus haut) ainsi que les objets ayant <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object#null-prototype_objects">un prototype nul</a><li>Les symboles non inscrits au global, ex. <code>Symbol('my new symbol')</code></ul></section></section><section class="level2"aria-labelledby="utilisation-usage"><h2 id="utilisation-usage">Utilisation {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="utiliser-de-linteractivité-et-un-état-local-building-with-interactivity-and-state"><h3 id="utiliser-de-linteractivité-et-un-état-local-building-with-interactivity-and-state">Utiliser de l'interactivité et un état local {/<em>building-with-interactivity-and-state</em>/}</h3><sandpack><pre class="language-js"><code class="language-js"><span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Counter</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>initialValue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>countValue<span class="token punctuation">,</span> setCountValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setCountValue</span><span class="token punctuation">(</span>countValue <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">decrement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setCountValue</span><span class="token punctuation">(</span>countValue <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Compteur </span><span class="token operator">:</span> <span class="token punctuation">{</span>countValue<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>decrement<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>Dans la mesure où <code>Counter</code> utilise aussi bien le Hook <code>useState</code> que des gestionnaires d'événements pour incrémenter et décrémenter la valeur, ce composant doit être un Composant Client et nécessitera donc une directive <code>'use client'</code> tout en haut de son fichier.<p>Par opposition, un composant qui fait le rendu d'une UI non interactive n'aura pas besoin d'être un Composant Client.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> readFile <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'node:fs/promises'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Counter</span></span> <span class="token keyword module">from</span> <span class="token string">'./Counter'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">CounterContainer</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> initialValue <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/path/to/counter_value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Counter</span> initialValue<span class="token operator">=</span><span class="token punctuation">{</span>initialValue<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">}</span></code></pre><p>Ici le composant parent de <code>Counter</code>, à savoir <code>CounterContainer</code>, ne requiert par exemple pas de directive <code>'use client'</code> puisqu'il n'est pas interactif et n'utilise aucun état. Qui plus est, <code>CounterContainer</code> doit être un Composant Serveur puisqu'il lit le système de fichiers local du serveur, ce qui n'est possible que dans un Composant Serveur.<p>On trouve aussi des composants qui n'utilisent aucun aspect exclusif aux côtés serveur ou client, et sont donc agnostiques quant à leur environnement de rendu. Dans notre exemple précédent, c'est notamment le cas du composant <code>FancyText</code>.<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FancyText</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>title<span class="token punctuation">,</span> text<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> title
    <span class="token operator">?</span> <span class="token operator">&#x3C;</span>h1 className<span class="token operator">=</span><span class="token string">'fancy title'</span><span class="token operator">></span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">:</span> <span class="token operator">&#x3C;</span>h3 className<span class="token operator">=</span><span class="token string">'fancy cursive'</span><span class="token operator">></span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h3<span class="token operator">></span>
<span class="token punctuation">}</span></code></pre><p>On n'a ici pas besoin d'ajouter la directive <code>'use client'</code>, de sorte que c'est le <em>résultat</em> (et non le code source) de <code>FancyText</code> qui sera envoyé au navigateur lorsqu'il est utilisé comme Composant Serveur. Comme l'appli d'exemple sur les citations inspirantes l'a montré, <code>FancyText</code> y est utilisé tant comme Composant Serveur que comme Composant Client, suivant les endroits qui l'importent et l'utilisent.<p>Mais si le HTML produit par <code>FancyText</code> s'avérait nettement plus lourd que son code source (dépendances comprises), il pourrait être utile, du point de vue des performances, de le forcer à toujours être un Composant Client. Les composants qui renvoient un énorme descriptif de chemin SVG sont un cas classique où le forçage d'un composant comme étant côté client peut s'avérer bénéfique.</section><section class="level3"aria-labelledby="utiliser-des-api-réservées-au-côté-client-using-client-apis"><h3 id="utiliser-des-api-réservées-au-côté-client-using-client-apis">Utiliser des API réservées au côté client {/<em>using-client-apis</em>/}</h3><p>Votre appli React utilise peut-être des API réservées au côté client, telles que des API web de stockage, de manipulation audio/vidéo ou d'interaction avec le matériel, <a href="https://developer.mozilla.org/fr/docs/Web/API">pour ne citer qu'elles</a>.<p>Dans le code qui suit, le composant utilise <a href="https://developer.mozilla.org/fr/docs/Glossary/DOM">l'API DOM</a> pour manipuler un élément <a href="https://developer.mozilla.org/fr/docs/Web/HTML/Element/canvas"><code>canvas</code></a>. Dans la mesure où ces API ne sont disponibles que dans le navigateur, le composant doit être marqué comme étant côté client.<pre class="language-js"><code class="language-js"><span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>useRef<span class="token punctuation">,</span> useEffect<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Circle</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> canvas <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token method function property-access">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token method function property-access">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token method function property-access">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token method function property-access">arc</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token method function property-access">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>canvas ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section><section class="level3"aria-labelledby="utiliser-des-bibliothèques-tierces-using-third-party-libraries"><h3 id="utiliser-des-bibliothèques-tierces-using-third-party-libraries">Utiliser des bibliothèques tierces {/<em>using-third-party-libraries</em>/}</h3><p>Dans une appli React, il est fréquent de tirer parti de bibliothèques tierces pour gérer des approches UI courantes ou implémenter une logique récurrente.<p>Ces bibliothèques sont susceptibles de recourir aux Hooks ou à des API réservées au côté client. Les composants tiers utilisant au moins une des API React suivantes doivent nécessairement être côté client :<ul><li><a href="/reference/react/createContext">createContext</a><li>Les Hooks fournis par <a href="/reference/react/hooks"><code>react</code></a> et <a href="/reference/react-dom/hooks"><code>react-dom</code></a>, à l'exception de <a href="/reference/react/use"><code>use</code></a> et <a href="/reference/react/useId"><code>useId</code></a><li><a href="/reference/react/forwardRef">forwardRef</a><li><a href="/reference/react/memo">memo</a><li><a href="/reference/react/startTransition">startTransition</a><li>Toute API réservée au côté client, telle que l'insertion DOM ou les vues natives de la plateforme</ul><p>Si ces bibliothèques ont été mises à jour pour être compatibles avec les React Server Components, elles inclueront alors d'emblée des marqueurs <code>'use client'</code> aux endroits pertinents, ce qui vous permettra de les utiliser directement depuis vos Composants Serveur. Mais si une bibliothèque n'a pas été mise à jour, ou si un composant a besoin de props telles qu'un gestionnaire d'événement (qui ne peut être fourni que côté client), vous aurez peut-être besoin de créer votre propre fichier de Composant Client pour faire le lien entre les Composants Client tiers et les Composants Serveur au sein desquels vous aimeriez les utiliser.<p>[TODO]: &#x3C;> (Troubleshooting - need use-cases) <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>