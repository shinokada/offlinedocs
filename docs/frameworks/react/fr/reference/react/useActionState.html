<!doctype html><html lang="fr"><meta charset="utf-8"><title>useActionState</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="useactionstate"><h1 id="useactionstate">useActionState</h1><p>canary: true</p><canary><p>Le Hook <code>useActionState</code> n'est actuellement disponible que sur les canaux de livraison Canary et Expérimental de React. Apprenez-en davantage sur <a href="/community/versioning-policy#all-release-channels">les canaux de livraison React</a>. Par ailleurs, vous aurez besoin d'utiliser un framework qui prenne en charge les <a href="/reference/rsc/use-client">Composants Serveur</a> pour tirer pleinement parti de <code>useActionState</code>.</p></canary><note><p>In earlier React Canary versions, this API was part of React DOM and called <code>useActionState</code>.</p></note><intro><p><code>useActionState</code> est un Hook qui vous permet de mettre à jour l'état sur base du résultat d'une action de formulaire.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> formAction<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> initialState<span class="token punctuation">,</span> permalink<span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="référence-reference"><h2 id="référence-reference">Référence {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="useactionstateaction-initialstate-permalink-useactionstate"><h3 id="useactionstateaction-initialstate-permalink-useactionstate"><code>useActionState(action, initialState, permalink?)</code> {/<em>useactionstate</em>/}</h3><p>{/<em> TODO T164397693: link to actions documentation once it exists </em>/}<p>Appelez <code>useActionState</code> au niveau racine de votre composant pour créer un état de composant qui sera mis à jour <a href="/reference/react-dom/components/form">lorsqu'une action de formulaire sera invoquée</a>. Vous passez à <code>useActionState</code> une fonction d'action de formulaire existante ainsi qu'un état initial, et il renvoie une nouvelle action que vous pouvez utiliser dans votre formulaire, ainsi que le dernier état en date pour ce formulaire. Cet état sera également passé à la fonction que vous avez fournie.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useActionState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token parameter">previousState<span class="token punctuation">,</span> formData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> previousState <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">StatefulForm</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> formAction<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>increment<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form<span class="token operator">></span>
      <span class="token punctuation">{</span>state<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>button formAction<span class="token operator">=</span><span class="token punctuation">{</span>formAction<span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Incrémenter</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><p>L'état de formulaire est déterminé par la valeur renvoyée par l'action lors du dernier envoi en date du formulaire. Si le formulaire n'a pas encore été envoyé, il équivaut à l'état initial que vous avez fourni.<p>Lorsque vous l'utilisez dans une Action Serveur, <code>useActionState</code> permet d'afficher la réponse du serveur pour l'envoi du formulaire avant même que l'hydratation ne soit terminée.<p><a href="#usage">Voir d'autres exemples plus bas</a>.<section class="level4"aria-labelledby="paramètres-parameters"><h4 id="paramètres-parameters">Paramètres {/<em>parameters</em>/}</h4><ul><li><code>fn</code> : la fonction à appeler lorsque le formulaire est envoyé. Lorsque la fonction est appelée, elle reçoit comme premier argument l'état précédent du formulaire (le <code>initialState</code> que vous avez fourni pour le premier appel, puis, pour les appels ultérieurs, la valeur précédemment renvoyée), suivi par les arguments normalement acceptés par une fonction d'action de formulaire.<li><code>initialState</code> : la valeur initiale que vous souhaitez pour votre état. Il peut s'agir de n'importe quelle valeur sérialisable. Cet argument est ignoré après l'appel initial de l'action.<li><code>permalink</code> <strong>optionnel</strong> : une chaîne de caractères contenant l'URL unique de la page que ce formulaire modifie. Conçu pour une utilisation sur des pages à contenu dynamique (telles que des flux) pour permettre une amélioration progressive : si <code>fn</code> est une <a href="/reference/rsc/use-server">Action Serveur</a> et que le formulaire est soumis avant que le <em>bundle</em> JavaScript n'ait fini son chargement, le navigateur ira sur l'URL de permalien fournie, plutôt que sur l'URL de la page courante. Ça permet de garantir que le même composant de formulaire sera produit sur la page destinataire (y compris les infos <code>fn</code> et <code>permalink</code>), afin que React sache comment lui passer l'état. Une fois le formulaire hydraté, ce paramètre n'a plus d'effet.</ul><p>{/<em> TODO T164397693: link to serializable values docs once it exists </em>/}</section><section class="level4"aria-labelledby="valeur-renvoyée-returns"><h4 id="valeur-renvoyée-returns">Valeur renvoyée {/<em>returns</em>/}</h4><p><code>useActionState</code> renvoie un tableau avec exactement deux valeurs :<ol><li>L'état courant. Lors du rendu initial, il s'agira du <code>initialState</code> que vous avez passé. Après que l'action aura été invoquée, il correspondra à la valeur renvoyée par l'action.<li>Une nouvelle action que vous pouvez passer comme prop <code>action</code> à votre composant <code>form</code>, ou comme prop <code>formAction</code> à tout composant <code>button</code> au sein du formulaire.</ol></section><section class="level4"aria-labelledby="limitations-caveats"><h4 id="limitations-caveats">Limitations {/<em>caveats</em>/}</h4><ul><li>Lorsque vous utilisez un framework prenant en charge les React Server Components, <code>useActionState</code> vous permet de rendre les formulaires interactifs avant même que JavaScript ne soit exécuté côté client. Si vous l'utilisez hors des Server Components, il est équivalent à un état local de composant.<li>La fonction passée à <code>useActionState</code> reçoit un premier argument supplémentaire : l'état précédent ou initial. Sa signature est donc différente de celles des fonctions d'action de formulaire utilisées directement par vos formulaires, sans recours à <code>useActionState</code>.</ul></section></section></section><section class="level2"aria-labelledby="utilisation-usage"><h2 id="utilisation-usage">Utilisation {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="utiliser-les-informations-renvoyées-par-une-action-de-formulaire-using-information-returned-by-a-form-action"><h3 id="utiliser-les-informations-renvoyées-par-une-action-de-formulaire-using-information-returned-by-a-form-action">Utiliser les informations renvoyées par une action de formulaire {/<em>using-information-returned-by-a-form-action</em>/}</h3><p>Appelez <code>useActionState</code> au niveau racine de votre composant pour accéder à la valeur renvoyée par l'action lors du dernier envoi du formulaire.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useActionState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> action <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./actions.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> formAction<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>formAction<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span><span class="token comment">/* ... */</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><code>useActionState</code> renvoie un tableau avec exactement deux valeurs :<ol><li><codestep step="{1}">L'état courant</codestep>du formulaire, qui sera au départ<codestep step="{4}">l'état initial</codestep>que vous aurez fourni, puis une fois le formulaire envoyé, vaudra la valeur de retour de<codestep step="{3}">l'action</codestep>que vous aurez passée.<li>Une<codestep step="{2}">nouvelle action</codestep>que vous pouvez passer comme prop <code>action</code> à votre <code>form</code>.</ol><p>Lorsque le formulaire sera envoyé, la fonction<codestep step="{3}">d'action</codestep>que vous aurez fournie sera appelée. Sa valeur de retour deviendra le nouvel<codestep step="{1}">état courant</codestep>du formulaire.<p><codestep step="{3}">L'action</codestep>que vous aurez fournie recevra par ailleurs un premier argument supplémentaire, à savoir<codestep step="{1}">l'état courant</codestep>du formulaire. Lors du premier envoi du formulaire, il s'agira de<codestep step="{4}">l'état initial</codestep>que vous aurez fourni, alors que pour les envois ultérieurs, ce sera la valeur renvoyée par le dernier appel en date de l'action. Le reste des arguments est identique à une utilisation de l'action sans <code>useActionState</code>.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token parameter">currentState<span class="token punctuation">,</span> formData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword control-flow">return</span> <span class="token string">'prochain état'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><recipes titletext="Afficher des informations suite à l’envoi d&#x27;un formulaire"titleid="display-information-after-submitting-a-form"><section class="level4"aria-labelledby="afficher-des-erreurs-de-formulaire-display-form-errors"><h4 id="afficher-des-erreurs-de-formulaire-display-form-errors">Afficher des erreurs de formulaire {/<em>display-form-errors</em>/}</h4><p>Pour afficher des messages tels qu'un message d'erreur ou une notification renvoyés par une Action Serveur, enrobez l'action dans un appel à <code>useActionState</code>.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useActionState<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> addToCart <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"./actions.js"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AddToCartForm</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>itemID<span class="token punctuation">,</span> itemTitle<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> formAction<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>addToCart<span class="token punctuation">,</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>formAction<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token punctuation">{</span>itemTitle<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"hidden"</span> name<span class="token operator">=</span><span class="token string">"itemID"</span> value<span class="token operator">=</span><span class="token punctuation">{</span>itemID<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span><span class="token maybe-class-name">Ajouter</span> au panier<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>message<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddToCartForm</span> itemID<span class="token operator">=</span><span class="token string">"1"</span> itemTitle<span class="token operator">=</span><span class="token string">"JavaScript: The Definitive Guide"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddToCartForm</span> itemID<span class="token operator">=</span><span class="token string">"2"</span> itemTitle<span class="token operator">=</span><span class="token string">"JavaScript: The Good Parts"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token string">"use server"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> queryData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> itemID <span class="token operator">=</span> queryData<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'itemID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>itemID <span class="token operator">===</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">"Ajouté au panier"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">"Impossible d’ajouter au panier : ce titre est épuisé."</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">form</span> <span class="token punctuation">{</span>
  <span class="token property">border</span><span class="token punctuation">:</span> solid <span class="token number">1</span><span class="token unit">px</span> <span class="token color">black</span><span class="token punctuation">;</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">24</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token unit">px</span>
<span class="token punctuation">}</span>

<span class="token selector">form button</span> <span class="token punctuation">{</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"canary"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"canary"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"^5.0.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"/index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section><section class="level4"aria-labelledby="afficher-des-données-structurées-suite-à-lenvoi-dun-formulaire-display-structured-information-after-submitting-a-form"><h4 id="afficher-des-données-structurées-suite-à-lenvoi-dun-formulaire-display-structured-information-after-submitting-a-form">Afficher des données structurées suite à l'envoi d'un formulaire {/<em>display-structured-information-after-submitting-a-form</em>/}</h4><p>La valeur renvoyée par une Action Serveur peut être n'importe quelle valeur sérialisable. Il peut par exemple s'agir d'un objet avec un booléen indiquant si l'action a réussi, un message d'erreur, ou des informations mises à jour.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useActionState<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> addToCart <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"./actions.js"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AddToCartForm</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>itemID<span class="token punctuation">,</span> itemTitle<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>formState<span class="token punctuation">,</span> formAction<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>addToCart<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>formAction<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token punctuation">{</span>itemTitle<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"hidden"</span> name<span class="token operator">=</span><span class="token string">"itemID"</span> value<span class="token operator">=</span><span class="token punctuation">{</span>itemID<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span><span class="token maybe-class-name">Ajouter</span> au panier<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>formState<span class="token operator">?.</span>success <span class="token operator">&#x26;&#x26;</span>
        <span class="token operator">&#x3C;</span>div className<span class="token operator">=</span><span class="token string">"toast"</span><span class="token operator">></span>
          <span class="token maybe-class-name">Ajouté </span><span class="token operator">!</span> <span class="token maybe-class-name">Votre</span> panier comporte désormais <span class="token punctuation">{</span>formState<span class="token punctuation">.</span><span class="token property-access">cartSize</span><span class="token punctuation">}</span> éléments<span class="token punctuation">.</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">}</span>
      <span class="token punctuation">{</span>formState<span class="token operator">?.</span>success <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token operator">&#x26;&#x26;</span>
        <span class="token operator">&#x3C;</span>div className<span class="token operator">=</span><span class="token string">"error"</span><span class="token operator">></span>
          <span class="token constant">L</span>’ajout a échoué <span class="token operator">:</span> <span class="token punctuation">{</span>formState<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddToCartForm</span> itemID<span class="token operator">=</span><span class="token string">"1"</span> itemTitle<span class="token operator">=</span><span class="token string">"JavaScript: The Definitive Guide"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddToCartForm</span> itemID<span class="token operator">=</span><span class="token string">"2"</span> itemTitle<span class="token operator">=</span><span class="token string">"JavaScript: The Good Parts"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token string">"use server"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> queryData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> itemID <span class="token operator">=</span> queryData<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'itemID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>itemID <span class="token operator">===</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cartSize</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"Ce titre est épuisé."</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">form</span> <span class="token punctuation">{</span>
  <span class="token property">border</span><span class="token punctuation">:</span> solid <span class="token number">1</span><span class="token unit">px</span> <span class="token color">black</span><span class="token punctuation">;</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">24</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token unit">px</span>
<span class="token punctuation">}</span>

<span class="token selector">form button</span> <span class="token punctuation">{</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"canary"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"canary"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"^5.0.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"/index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section></recipes></section></section><section class="level2"aria-labelledby="dépannage-troubleshooting"><h2 id="dépannage-troubleshooting">Dépannage {/<em>troubleshooting</em>/}</h2><section class="level3"aria-labelledby="mon-action-narrive-plus-à-lire-les-données-envoyées-par-le-formulaire-my-action-can-no-longer-read-the-submitted-form-data"><h3 id="mon-action-narrive-plus-à-lire-les-données-envoyées-par-le-formulaire-my-action-can-no-longer-read-the-submitted-form-data">Mon action n'arrive plus à lire les données envoyées par le formulaire {/<em>my-action-can-no-longer-read-the-submitted-form-data</em>/}</h3><p>Lorsque vous enrobez une action avec <code>useActionState</code>, elle reçoit un <em>premier argument</em> supplémentaire. Les données envoyées par le formulaire sont donc présentes comme <em>second</em> argument, plutôt qu'en première position comme en temps normal. Le premier argument ainsi injecté contient l'état actuel du formulaire.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token parameter">currentState<span class="token punctuation">,</span> formData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>