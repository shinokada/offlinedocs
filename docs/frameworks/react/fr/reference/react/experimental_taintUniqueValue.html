<!doctype html><html lang="fr"><meta charset="utf-8"><title>experimental_taintUniqueValue</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="experimental_taintuniquevalue"><h1 id="experimental_taintuniquevalue">experimental_taintUniqueValue</h1><wip><p><strong>Cette API est expérimentale : elle n’a donc pas encore été livrée dans une version stable de React.</strong><p>Vous pouvez l'essayer en mettant à jour vos modules React afin d'utiliser la version expérimentale la plus récente :<ul><li><code>react@experimental</code><li><code>react-dom@experimental</code><li><code>eslint-plugin-react-hooks@experimental</code></ul><p>Les versions expérimentales de React sont susceptibles de contenir des bugs. Veillez donc à ne pas les utiliser en production.<p>Cette API n'est disponible qu'au sein des <a href="/reference/react/use-client">React Server Components</a>.</p></wip><intro><p><code>taintUniqueValue</code> vous permet d'empêcher que certaines valeurs uniques soient passées à un Composant Client, telles que des mots de passe, clés ou jetons.<pre class="language-js"><code class="language-js"><span class="token function">taintUniqueValue</span><span class="token punctuation">(</span>errMessage<span class="token punctuation">,</span> lifetime<span class="token punctuation">,</span> value<span class="token punctuation">)</span></code></pre><p>Pour empêcher le passage d'un objet contenant des données sensibles, utilisez <a href="/reference/react/experimental_taintObjectReference"><code>taintObjectReference</code></a>.</p></intro><inlinetoc><section class="level2"aria-labelledby="référence-reference"><h2 id="référence-reference">Référence {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="taintuniquevaluemessage-lifetime-value-taintuniquevalue"><h3 id="taintuniquevaluemessage-lifetime-value-taintuniquevalue"><code>taintUniqueValue(message, lifetime, value)</code> {/<em>taintuniquevalue</em>/}</h3><p>Appelez <code>taintUniqueValue</code> avec un mot de passe, jeton, clé ou <em>hash</em> pour indiquer à React qu'il ne doit pas permettre le passage de cette valeur vers le côté client :<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_taintUniqueValue <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token function">experimental_taintUniqueValue</span><span class="token punctuation">(</span>
  <span class="token string">'Ne passez pas de clés secrètes au client.'</span><span class="token punctuation">,</span>
  process<span class="token punctuation">,</span>
  process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">SECRET_KEY</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><a href="#usage">Voir plus d'exemples ci-dessous</a>.<section class="level4"aria-labelledby="paramètres-parameters"><h4 id="paramètres-parameters">Paramètres {/<em>parameters</em>/}</h4><ul><li><p><code>message</code> : le message que vous souhaitez afficher si <code>value</code> est passée à un Composant Client. Ce message fera partie de l'erreur qui sera levée si <code>value</code> est passée à un Composant Client.<li><p><code>lifetime</code> : tout objet indiquant pour combien de temps <code>value</code> devrait être « ternie ». React bloquera le passage de <code>value</code> aux Composants Clients tant que cet objet existera. Passer <code>globalThis</code> pour cet argument bloquerait par exemple le passage de cette valeur pour toute la durée de vie de l'appli. <code>lifetime</code> est le plus souvent un objet dont l'une des propriétés contient <code>value</code>.<li><p><code>value</code> : une chaîne de caractères, un <em>bigint</em> ou un <em>TypedArray</em> (tableau typé). <code>value</code> doit être une séquence unique de caractères ou d'octets dotée d'une forte entropie, telle qu'un jeton cryptographique, une clé privée, un <em>hash</em> ou un long mot de passe. <code>value</code> ne pourra alors plus être passée à un Composant Client.</ul></section><section class="level4"aria-labelledby="valeur-renvoyée-returns"><h4 id="valeur-renvoyée-returns">Valeur renvoyée {/<em>returns</em>/}</h4><p><code>experimental_taintUniqueValue</code> renvoie <code>undefined</code>.</section><section class="level4"aria-labelledby="limitations-caveats"><h4 id="limitations-caveats">Limitations {/<em>caveats</em>/}</h4><ul><li>La dérivation de valeurs à partir des valeurs ternies peut nuire à la protection par ternissement. Les nouvelles valeurs créées par exemple en changeant la casse de valeurs ternies, en concaténant des chaînes ternies vers une chaîne de caractères plus longue, en convertissant des valeurs ternies en Base 64, en extrayant des portions de chaînes ternies, ou toute autre transformation du même genre, ne constituent plus des valeurs ternies à moins que vous n'appeliez explicitement <code>taintUniqueValue</code> sur les nouvelles valeurs ainsi produites.<li>N'utilisez pas <code>taintUniqueValue</code> pour protéger des valeurs à basse entropie, telles que des codes PIN ou des numéros de téléphones. Si une valeur de requête est contrôlée par vos attaquants, ils peuvent alors déterminer la valeur ternie en énumérant toutes les valeurs possibles du secret.</ul></section></section></section><section class="level2"aria-labelledby="utilisation-usage"><h2 id="utilisation-usage">Utilisation {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="empêcher-le-passage-dun-jeton-à-un-composant-client-prevent-a-token-from-being-passed-to-client-components"><h3 id="empêcher-le-passage-dun-jeton-à-un-composant-client-prevent-a-token-from-being-passed-to-client-components">Empêcher le passage d'un jeton à un Composant Client {/<em>prevent-a-token-from-being-passed-to-client-components</em>/}</h3><p>Pour vous assurer que des données sensibles telles que des mots de passe, jetons de sessions et autres valeurs uniques ne soient pas passées par inadvertance à des Composants Clients, la fonction <code>taintUniqueValue</code> vous offre une couche de protection. Lorsqu'une valeur est ternie, toute tentative de la passer à un Composant Client lèvera une erreur.<p>L'argument <code>lifetime</code> définit la durée du ternissement pour cette valeur. Si vous souhaitez un ternissement définitif, utilisez pour l'argument <code>lifetime</code> des objets tels que <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/globalThis"><code>globalThis</code></a> ou <code>process</code>. Ces objets ont une durée de vie qui couvre toute l'exécution de votre appli.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_taintUniqueValue <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token function">experimental_taintUniqueValue</span><span class="token punctuation">(</span>
  <span class="token string">'Ne passez pas une clé privée au client.'</span><span class="token punctuation">,</span>
  globalThis<span class="token punctuation">,</span>
  process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">SECRET_KEY</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Si la durée de vie de la valeur ternie est liée à un objet, définissez <code>lifetime</code> à l'objet qui encapsule cette valeur. Ça garantit que la valeur ternie restera protégée pendant toute la durée de vie de l'objet qui la contient.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_taintUniqueValue <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword control-flow">await</span> db<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT * FROM users WHERE id = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token function">experimental_taintUniqueValue</span><span class="token punctuation">(</span>
    <span class="token string">'Ne passez par un jeton de session utilisateur au client.'</span><span class="token punctuation">,</span>
    user<span class="token punctuation">,</span>
    user<span class="token punctuation">.</span><span class="token property-access">session</span><span class="token punctuation">.</span><span class="token property-access">token</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Dans cet exemple, l'objet <code>user</code> sert comme argument <code>lifetime</code>. Si cet objet est stocké dans un cache global ou se retrouve accessible par une autre requête, le jeton de session restera terni.</p><pitfall><p><strong>Ne comptez pas sur le ternissement pour garantir la sécurité.</strong> Ternir une valeur n'empêche pas la fuite de toute donnée dérivée imaginable. Créer par exemple une nouvelle valeur en convertissant la chaîne ternie en majuscules ne produira pas une chaîne elle aussi ternie.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_taintUniqueValue <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> password <span class="token operator">=</span> <span class="token string">'correct horse battery staple'</span><span class="token punctuation">;</span>

<span class="token function">experimental_taintUniqueValue</span><span class="token punctuation">(</span>
  <span class="token string">'Ne passez par le mot de passe au client.'</span><span class="token punctuation">,</span>
  globalThis<span class="token punctuation">,</span>
  password
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> uppercasePassword <span class="token operator">=</span> password<span class="token punctuation">.</span><span class="token method function property-access">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// `uppercasePassword` n’est pas ternie</span></code></pre><p>Dans le code ci-dessus, la constante<code>password</code> est ternie. Puis <code>password</code> sert de base à la nouvelle valeur <code>uppercasePassword</code>, créée en appelant la méthode <code>toUpperCase</code> de <code>password</code>. Cette nouvelle valeur <code>uppercasePassword</code> n'est pas ternie.<p>On obtiendrait le même résultat avec d'autres façons de dériver de nouvelles valeurs à partir de valeurs ternies, telles que la concaténation de chaîne, leur encodage en Base 64 ou l'extraction d'une portion de la chaîne.<p>Le ternissement ne vous protège que contre les bévues simples lorsqu'une valeur sensible est explicitement passée à un Composant Client. Des appels erronés de <code>taintUniqueValue</code>, comme le fait de recourir à un stockage global hors de React, sans l'objet de durée de vie associée, peuvent entraîner la perte du ternissement de la valeur. Le ternissement est une couche de protection ; une appli sécurisée aura plusieurs couches de protection complémentaires, des API soigneusement conçues et des mécanismes d'isolation en place.</p></pitfall><deepdive><section class="level4"aria-labelledby="utiliser-server-only-et-taintuniquevalue-pour-empêcher-la-fuite-de-secrets-using-server-only-and-taintuniquevalue-to-prevent-leaking-secrets"><h4 id="utiliser-server-only-et-taintuniquevalue-pour-empêcher-la-fuite-de-secrets-using-server-only-and-taintuniquevalue-to-prevent-leaking-secrets">Utiliser <code>server-only</code> et <code>taintUniqueValue</code> pour empêcher la fuite de secrets {/<em>using-server-only-and-taintuniquevalue-to-prevent-leaking-secrets</em>/}</h4><p>Si votre environnement de Composants Serveur a accès à des données sensibles telles que des clés privées ou des mots de passe, vous devez être attentif·ve à ne pas les passer à un Composant Client.<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Dashboard</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// NE FAITES PAS ÇA</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Overview</span> password<span class="token operator">=</span><span class="token punctuation">{</span>process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">API_PASSWORD</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token string">"use client"</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>useEffect<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'...'</span>

<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Overview</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> password <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">Authorization</span><span class="token operator">:</span> password <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> headers <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token spread operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>password<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token spread operator">...</span>
<span class="token punctuation">}</span></code></pre><p>Cet exemple ferait fuiter un jeton d'API secret vers le côté client. Si ce jeton d'API peut être utilisé pour accéder à des données auxquelles cet utilisateur spécifique ne devrait pas avoir accès, il constituerait une faille de sécurité.<p>[comment]: &#x3C;> (TODO: Link to <code>server-only</code> docs once they are written)<p>Dans l'idéal, ce type de secrets est isolé dans un unique fichier utilitaire qui ne doit pouvoir être importé que par des utilitaires de confiance côté serveur. Ce type de fichier peut même être étiqueté avec <a href="https://www.npmjs.com/package/server-only"><code>server-only</code></a> pour garantir qu'il ne sera pas importé côté client.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token string">"server-only"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">fetchAPI</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">Authorization</span><span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">API_PASSWORD</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> headers <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Lors d'une refonte, des erreurs peuvent survenir car l'ensemble de votre équipe ne sera peut-être pas attentive à ce point de sécurité. Pour vous éviter des erreurs en aval vous pouvez « ternir » le mot de passe effectif :<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token string">"server-only"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_taintUniqueValue <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token function">experimental_taintUniqueValue</span><span class="token punctuation">(</span>
  <span class="token string">'Ne passez pas le jeton d’API au client. '</span> <span class="token operator">+</span>
    <span class="token string">'Effectuez plutôt les chargements côté serveur.'</span>
  process<span class="token punctuation">,</span>
  process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">API_PASSWORD</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>À présent, dès que quiconque essaierait de passer ce mot de passe à un Composant Client, ou enverrait le mot de passe à un Composant Client <em>via</em> une <em>Server Action</em>, une erreur serait levée avec le message défini lors de l'appel à <code>taintUniqueValue</code>.<p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></deepdive></section></section></inlinetoc></section>