<!doctype html><html lang="fr"><meta charset="utf-8"><title>use</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="use"><h1 id="use">use</h1><p>canary: true</p><canary><p>L'API <code>use</code> n'est actuellement disponible que sur les canaux de livraison Canary et Expérimental de React. Apprenez-en davantage sur <a href="/community/versioning-policy#all-release-channels">les canaux de livraison React</a>.</p></canary><intro><p><code>use</code> est une API React qui vous permet de lire la valeur d'une ressource telle qu'une <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Promise">promesse</a> ou un <a href="/learn/passing-data-deeply-with-context">contexte</a>.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="référence-reference"><h2 id="référence-reference">Référence {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="useresource-use"><h3 id="useresource-use"><code>use(resource)</code> {/<em>use</em>/}</h3><p>Appelez <code>use</code> dans votre composant pour lire la valeur d'une ressource telle qu'une <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Promise">promesse</a> ou un <a href="/learn/passing-data-deeply-with-context">contexte</a>.<pre class="language-jsx"><code class="language-jsx"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> use <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MessageComponent</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> messagePromise <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span>messagePromise<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p>Contrairement aux Hooks React, <code>use</code> peut être appelée au sein de boucles ou d'instructions conditionnelles telles que <code>if</code>. En revanche, comme pour les Hooks React, toute fonction appelant <code>use</code> doit être un composant ou un Hook.<p>Lorsqu'elle est appelée avec une promesse, l'API <code>use</code> s'intègre avec <a href="/reference/react/Suspense"><code>Suspense</code></a> et les <a href="/reference/react/Component#catching-rendering-errors-with-an-error-boundary">périmètres d'erreurs</a>. Le composant appelant <em>suspend</em> tant que la promesse passée à <code>use</code> est en attente. Si le composant qui appelle <code>use</code> est enrobé dans un périmètre Suspense, l'UI de secours est affichée. Une fois la promesse accomplie, cette UI est remplacée par le rendu des composants en utilisant les données renvoyées par le Hook <code>use</code>. Si la promesse renvoyée par <code>use</code> est rejetée, l'UI de secours du périmètre d'erreur le plus proche est affichée.<p><a href="#usage">Voir d'autres exemples plus bas</a>.<section class="level4"aria-labelledby="paramètres-parameters"><h4 id="paramètres-parameters">Paramètres {/<em>parameters</em>/}</h4><ul><li><code>resource</code> : c'est la source de données depuis laquelle vous voulez lire une valeur. Une ressource peut être une <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Promise">promesse</a> ou un <a href="/learn/passing-data-deeply-with-context">contexte</a>.</ul></section><section class="level4"aria-labelledby="valeur-renvoyée-returns"><h4 id="valeur-renvoyée-returns">Valeur renvoyée {/<em>returns</em>/}</h4><p>L'API <code>use</code> renvoie la valeur lue depuis la ressource, telle que la valeur accomplie d'une <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Promise">promesse</a> ou la valeur actuelle d'un <a href="/learn/passing-data-deeply-with-context">contexte</a>.</section><section class="level4"aria-labelledby="limitations-caveats"><h4 id="limitations-caveats">Limitations {/<em>caveats</em>/}</h4><ul><li>L'API <code>use</code> doit être appelée à l'intérieur d'un composant ou d'un Hook.<li>Lorsque vous récupérez des données dans un <a href="/reference/rsc/use-server">Composant Serveur</a>, privilégiez <code>async</code> et <code>await</code> plutôt que <code>use</code>. <code>async</code> et <code>await</code> reprennent le rendu à partir du point où <code>await</code> avait été invoqué, alors que <code>use</code> refait un rendu du composant une fois la donnée obtenue.<li>Privilégiez la création de promesses dans les <a href="/reference/rsc/use-server">Composants Serveur</a> et leur passage aux <a href="/reference/rsc/use-client">Composants Client</a>, plutôt que de créer des promesses dans les Composants Client. Les promesses créées dans les Composants Client sont recréées à chaque rendu. Les promesses transmises d'un Composant Serveur à un Component Client ne changent pas d'un rendu à l'autre. <a href="#streaming-data-from-server-to-client">Consultez cet exemple</a>.</ul></section></section></section><section class="level2"aria-labelledby="utilisation-usage"><h2 id="utilisation-usage">Utilisation {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="lire-un-contexte-avec-use-reading-context-with-use"><h3 id="lire-un-contexte-avec-use-reading-context-with-use">Lire un contexte avec <code>use</code> {/<em>reading-context-with-use</em>/}</h3><p>Quand un <a href="/learn/passing-data-deeply-with-context">contexte</a> est passé à <code>use</code>, ce dernier fonctionne de la même façon que <a href="/reference/react/useContext"><code>useContext</code></a>. Alors que <code>useContext</code> doit être appelé à la racine de votre composant, <code>use</code> peut être appelé à l'intérieur de conditions telles que <code>if</code> ou de boucles telles que <code>for</code>. <code>use</code> est préférable à <code>useContext</code> parce qu'il est plus flexible.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> use <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Button</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p><code>use</code> renvoie la<codestep step="{2}">valeur de contexte</codestep>pour le<codestep step="{1}">contexte</codestep>que vous avez transmis. Pour déterminer la valeur du contexte, React remonte l'arbre des composants pour trouver le <strong>fournisseur de contexte parent le plus proche</strong> pour ce contexte.<p>Pour transmettre un contexte à un <code>Button</code>, enrobez ce bouton ou l'un de ses parents dans le fournisseur de contexte adéquat.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyPage</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Provider</span></span> value<span class="token operator">=</span><span class="token string">"dark"</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Form</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Provider</span></span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... rendu des boutons ici ...</span>
<span class="token punctuation">}</span></code></pre><p>Peu importe le nombre de couches de composants qu'il y a entre le fournisseur et le <code>Button</code>. Quand un <code>Button</code> appelle <code>use(ThemeContext)</code>, il recevra la valeur <code>"dark"</code>, <em>quelle que soit</em> sa position au sein du <code>Form</code>.<p>Contrairement à <a href="/reference/react/useContext"><code>useContext</code></a>,<codestep step="{2}"><code>use</code></codestep>peut être appelé dans les blocs conditionnels et les boucles, comme par exemple un<codestep step="{1}"><code>if</code></codestep>.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">HorizontalRule</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> show <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>show<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>hr className<span class="token operator">=</span><span class="token punctuation">{</span>theme<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><codestep step="{2}"><code>use</code></codestep>est appelé à l'intérieur d'une instruction<codestep step="{1}"><code>if</code></codestep>, ce qui vous permet de ne lire des valeurs de contextes que sous certaines conditions.</p><pitfall><p>Tout comme <code>useContext</code>, <code>use(context)</code> cherche toujours le fournisseur de contexte le plus proche <strong>au-dessus</strong> du composant qui l'appelle. Il remonte et <strong>ignore</strong> les fournisseurs de contexte situés dans le composant depuis lequel vous appelez <code>use(context)</code>.</p></pitfall><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createContext<span class="token punctuation">,</span> use <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">ThemeContext</span> <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyApp</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Provider</span></span> value<span class="token operator">=</span><span class="token string">"dark"</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Form</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Provider</span></span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span> title<span class="token operator">=</span><span class="token string">"Bienvenue"</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Button</span> show<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Inscription</span><span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Button</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Button</span> show<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Connexion</span><span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Button</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Panel</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> title<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> className <span class="token operator">=</span> <span class="token string">'panel-'</span> <span class="token operator">+</span> theme<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>section className<span class="token operator">=</span><span class="token punctuation">{</span>className<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>section<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Button</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> show<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>show<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> className <span class="token operator">=</span> <span class="token string">'button-'</span> <span class="token operator">+</span> theme<span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>button className<span class="token operator">=</span><span class="token punctuation">{</span>className<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.panel-light</span><span class="token punctuation">,</span>
<span class="token class">.panel-dark</span></span> <span class="token punctuation">{</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token color">black</span><span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.panel-light</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.panel-dark</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token color"><span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.button-light</span><span class="token punctuation">,</span>
<span class="token class">.button-dark</span></span> <span class="token punctuation">{</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token hexcode color">#777</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.button-dark</span></span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.button-light</span></span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"18.3.0-canary-9377e1010-20230712"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"18.3.0-canary-9377e1010-20230712"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"^5.0.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"/index.js"</span>
<span class="token punctuation">}</span></code></pre></sandpack></section><section class="level3"aria-labelledby="diffuser-en-continu-des-données-du-serveur-au-client-streaming-data-from-server-to-client"><h3 id="diffuser-en-continu-des-données-du-serveur-au-client-streaming-data-from-server-to-client">Diffuser en continu des données du serveur au client {/<em>streaming-data-from-server-to-client</em>/}</h3><p>Les données peuvent être transmises en continu du serveur au client en passant une promesse comme prop depuis un<codestep step="{1}">Composant Serveur</codestep>vers un<codestep step="{2}">Composant Client</codestep>.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> fetchMessage <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./lib.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Message</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./message.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> messagePromise <span class="token operator">=</span> <span class="token function">fetchMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">En</span> attente d’un message<span class="token spread operator">...</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Message</span> messagePromise<span class="token operator">=</span><span class="token punctuation">{</span>messagePromise<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Le<codestep step="{2}">Composant Client</codestep>prend ensuite<codestep step="{4}">la promesse qu'il a reçue comme prop</codestep>et la transmet à l'API<codestep step="{5}"><code>use</code></codestep>. Ça permet au<codestep step="{2}">Composant Client</codestep>de lire la valeur de<codestep step="{4}">la promesse</codestep>initialement créée par le Composant Serveur.<pre class="language-js"><code class="language-js"><span class="token comment">// message.js</span>
<span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> use <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Message</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> messagePromise <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> messageContent <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span>messagePromise<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Voici</span> le message <span class="token operator">:</span> <span class="token punctuation">{</span>messageContent<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Puisque<codestep step="{2}"><code>Message</code></codestep>est enrobé dans un<codestep step="{3}"><a href="/reference/react/Suspense"><code>Suspense</code></a></codestep>, l'UI de secours sera affichée en attendant l'accomplissement de la promesse. Lorsqu'elle s'accomplit, la valeur sera lue par l'API<codestep step="{5}"><code>use</code></codestep>et le composant<codestep step="{2}"><code>Message</code></codestep>remplacera l'UI de secours de Suspense.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token string">"use client"</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> use<span class="token punctuation">,</span> <span class="token maybe-class-name">Suspense</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Message</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> messagePromise <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> messageContent <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span>messagePromise<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Voici</span> le message <span class="token operator">:</span> <span class="token punctuation">{</span>messageContent<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MessageContainer</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> messagePromise <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span>p<span class="token operator">></span>⌛ <span class="token constant">T</span>éléchargement du message<span class="token spread operator">...</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Message</span> messagePromise<span class="token operator">=</span><span class="token punctuation">{</span>messagePromise<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">MessageContainer</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"./message.js"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">fetchMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">"⚛️"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>messagePromise<span class="token punctuation">,</span> setMessagePromise<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>show<span class="token punctuation">,</span> setShow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setMessagePromise</span><span class="token punctuation">(</span><span class="token function">fetchMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setShow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>show<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MessageContainer</span> messagePromise<span class="token operator">=</span><span class="token punctuation">{</span>messagePromise<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>download<span class="token punctuation">}</span><span class="token operator">></span><span class="token constant">T</span>élécharger le message<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// TODO : remplacer l’import d’une version Canary</span>
<span class="token comment">// de React par une version stable, dès qu’elle</span>
<span class="token comment">// intégrera l’API `use`</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">React</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">StrictMode</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createRoot <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/client'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token string">'./styles.css'</span><span class="token punctuation">;</span>

<span class="token comment">// TODO : mettre à jour cet exemple pour utiliser</span>
<span class="token comment">// le Composant Serveur Codesandbox de l’environnement</span>
<span class="token comment">// de démo lorsqu’il sera créé.</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">App</span></span> <span class="token keyword module">from</span> <span class="token string">'./App'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">createRoot</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">StrictMode</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">StrictMode</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"18.3.0-canary-9377e1010-20230712"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"18.3.0-canary-9377e1010-20230712"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"^5.0.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"/index.js"</span>
<span class="token punctuation">}</span></code></pre></sandpack><note><p>Lorsque vous transmettez une promesse d'un Composant Serveur à un Composant Client, sa valeur accomplie doit être sérialisable pour pouvoir être communiquée entre le serveur et le client. Les types de données comme les fonctions ne sont pas sérialisables et ne peuvent donc pas être utilisés comme valeur accomplie d'une telle promesse.</p></note><deepdive><section class="level4"aria-labelledby="dois-je-accomplir-une-promesse-dans-un-composant-serveur-ou-client-resolve-promise-in-server-or-client-component"><h4 id="dois-je-accomplir-une-promesse-dans-un-composant-serveur-ou-client-resolve-promise-in-server-or-client-component">Dois-je accomplir une promesse dans un Composant Serveur ou Client ? {/<em>resolve-promise-in-server-or-client-component</em>/}</h4><p>Une promesse peut être passée d'un Composant Serveur à un Composant Client, puis accomplie dans le Composant Client avec l'API <code>use</code>. Vous pouvez également accomplir la promesse dans un Composant Serveur avec <code>await</code>, puis transmettre les données requises au Composant Client en tant que prop.<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> messageContent <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fetchMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Message</span> messageContent<span class="token operator">=</span><span class="token punctuation">{</span>messageContent<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">}</span></code></pre><p>Toutefois, l'utilisation d'<code>await</code> dans un <a href="/reference/react/components#server-components">Composant Serveur</a> bloquera son rendu jusqu'à ce que l'instruction <code>await</code> ait terminé. Le passage d'une promesse d'un Composant Serveur à un Composant Client permet à la promesse de ne pas bloquer le rendu du Composant Serveur.</section></deepdive></section><section class="level3"aria-labelledby="traiter-les-promesses-rejetées-dealing-with-rejected-promises"><h3 id="traiter-les-promesses-rejetées-dealing-with-rejected-promises">Traiter les promesses rejetées {/<em>dealing-with-rejected-promises</em>/}</h3><p>Dans certains cas, une promesse passée à <code>use</code> peut être rejetée. Vous pouvez gérer les promesses rejetées en utilisant l'une ou l'autre de ces méthodes :<ol><li><a href="#displaying-an-error-to-users-with-error-boundary">afficher une erreur aux utilisateurs avec un périmètre d'erreur</a><li><a href="#providing-an-alternative-value-with-promise-catch">fournir une valeur alternative avec <code>Promise.catch</code></a></ol><pitfall><p><code>use</code> ne peut pas être appelé à l'intérieur d'un bloc try-catch. En remplacement de ces blocs, <a href="#displaying-an-error-to-users-with-error-boundary">enrobez votre composant dans un périmètre d'erreur</a>, ou <a href="#providing-an-alternative-value-with-promise-catch">fournissez une valeur alternative à utiliser avec la méthode <code>.catch</code> des promesses</a>.</p></pitfall><section class="level4"aria-labelledby="afficher-une-erreur-aux-utilisateurs-avec-un-périmètre-derreur-displaying-an-error-to-users-with-error-boundary"><h4 id="afficher-une-erreur-aux-utilisateurs-avec-un-périmètre-derreur-displaying-an-error-to-users-with-error-boundary">Afficher une erreur aux utilisateurs avec un périmètre d'erreur {/<em>displaying-an-error-to-users-with-error-boundary</em>/}</h4><p>Si vous souhaitez afficher une erreur à vos utilisateurs quand une promesse a été rejetée, vous pouvez utiliser un <a href="/reference/react/Component#catching-rendering-errors-with-an-error-boundary">périmètre d'erreur</a>. Pour l'utiliser, enrobez le composant d'où vous appelez l'API <code>use</code> dans le périmètre d'erreur. Si la promesse transmise à <code>use</code> est rejetée, alors l'UI de secours de ce périmètre d'erreur sera affichée.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token string">"use client"</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> use<span class="token punctuation">,</span> <span class="token maybe-class-name">Suspense</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">ErrorBoundary</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react-error-boundary"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MessageContainer</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> messagePromise <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ErrorBoundary</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span>p<span class="token operator">></span>⚠️ Ça sent le pâté…<span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span>p<span class="token operator">></span>⌛ <span class="token constant">T</span>éléchargement du message<span class="token spread operator">...</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Message</span> messagePromise<span class="token operator">=</span><span class="token punctuation">{</span>messagePromise<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ErrorBoundary</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Message</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> messagePromise <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span>messagePromise<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Voici</span> le message <span class="token operator">:</span> <span class="token punctuation">{</span>content<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">MessageContainer</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"./message.js"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">fetchMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>reject<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>messagePromise<span class="token punctuation">,</span> setMessagePromise<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>show<span class="token punctuation">,</span> setShow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setMessagePromise</span><span class="token punctuation">(</span><span class="token function">fetchMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setShow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>show<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MessageContainer</span> messagePromise<span class="token operator">=</span><span class="token punctuation">{</span>messagePromise<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>download<span class="token punctuation">}</span><span class="token operator">></span><span class="token constant">T</span>élécharger le message<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// TODO : remplacer l’import d’une version Canary</span>
<span class="token comment">// de React par une version stable, dès qu’elle</span>
<span class="token comment">// intégrera l’API `use`</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">React</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">StrictMode</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createRoot <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/client'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token string">'./styles.css'</span><span class="token punctuation">;</span>

<span class="token comment">// TODO : mettre à jour cet exemple pour utiliser</span>
<span class="token comment">// le Composant Serveur Codesandbox de l’environnement</span>
<span class="token comment">// de démo lorsqu’il sera créé.</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">App</span></span> <span class="token keyword module">from</span> <span class="token string">'./App'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">createRoot</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">StrictMode</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">StrictMode</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"18.3.0-canary-9377e1010-20230712"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"18.3.0-canary-9377e1010-20230712"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"^5.0.0"</span><span class="token punctuation">,</span>
    <span class="token property">"react-error-boundary"</span><span class="token operator">:</span> <span class="token string">"4.0.3"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"/index.js"</span>
<span class="token punctuation">}</span></code></pre></sandpack></section><section class="level4"aria-labelledby="fournir-une-valeur-alternative-avec-promisecatch-providing-an-alternative-value-with-promise-catch"><h4 id="fournir-une-valeur-alternative-avec-promisecatch-providing-an-alternative-value-with-promise-catch">Fournir une valeur alternative avec <code>Promise.catch</code> {/<em>providing-an-alternative-value-with-promise-catch</em>/}</h4><p>Si vous voulez fournir une valeur alternative quand la promesse passée à <code>use</code> est rejetée, vous pouvez utiliser la méthode<codestep step="{1}"><a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Promise/catch"><code>catch</code></a></codestep>des promesses.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Message</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./message.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> messagePromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">"Aucun nouveau message."</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">En</span> attente de message<span class="token spread operator">...</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Message</span> messagePromise<span class="token operator">=</span><span class="token punctuation">{</span>messagePromise<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Pour utiliser la méthode<codestep step="{1}"><code>catch</code></codestep>de la promesse, appelez<codestep step="{1}"><code>catch</code></codestep>sur l'objet <code>Promise</code>.<codestep step="{1}"><code>catch</code></codestep>n'accepte qu'un seul paramètre : une fonction qui prend une erreur comme argument. La<codestep step="{2}">valeur de retour</codestep>de la fonction passée à<codestep step="{1}"><code>catch</code></codestep>sera utilisée comme valeur accomplie de la promesse.</section></section></section><section class="level2"aria-labelledby="dépannage-troubleshooting"><h2 id="dépannage-troubleshooting">Dépannage {/<em>troubleshooting</em>/}</h2><section class="level3"aria-labelledby="suspense-exception-this-is-not-a-real-error-suspense-exception-error"><h3 id="suspense-exception-this-is-not-a-real-error-suspense-exception-error"><em>"Suspense Exception: This is not a real error!"</em> {/<em>suspense-exception-error</em>/}</h3><p><em>(« Exception Suspense : ce n'est pas une véritable erreur ! », NdT)</em><p>Vous appelez probablement <code>use</code> soit en-dehors d'un composant React ou d'une fonction de Hook, soit dans un bloc try-catch. Pour corriger ce dernier cas, enrobez votre composant dans un périmètre d'erreur ou appelez la fonction <code>catch</code> de la promesse pour attraper l'erreur et résoudre la promesse avec une valeur différente. <a href="#dealing-with-rejected-promises">Consultez ces exemples</a>.<p>Si vous appelez <code>use</code> en-dehors d'un composant React ou d'une fonction de Hook, déplacez l'appel à <code>use</code> dans un composant React ou une fonction de Hook.<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MessageComponent</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>messagePromise<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ❌ la fonction appelant `use` n'est ni un composant ni un Hook</span>
    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span>messagePromise<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span></code></pre><p>Appelez plutôt <code>use</code> hors de toute fermeture lexicale au sein du composant, lorsque la fonction qui appelle <code>use</code> est un composant ou un Hook.<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MessageComponent</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>messagePromise<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ✅ `use` est appelé depuis un composant</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span>messagePromise<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>