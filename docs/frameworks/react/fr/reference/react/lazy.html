<!doctype html><html lang="fr"><meta charset="utf-8"><title>lazy</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="lazy"><h1 id="lazy">lazy</h1><intro><p><code>lazy</code> vous permet de différer le chargement du code d'un composant jusqu'à son premier affichage effectif.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token maybe-class-name">SomeComponent</span> <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="référence-reference"><h2 id="référence-reference">Référence {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="lazyload-lazy"><h3 id="lazyload-lazy"><code>lazy(load)</code> {/<em>lazy</em>/}</h3><p>Appelez <code>lazy</code> en-dehors de vos composants pour déclarer un composant React chargé à la demande :<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> lazy <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">MarkdownPreview</span> <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./MarkdownPreview.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><a href="#usage">Voir d'autres exemples ci-dessous</a>.<section class="level4"aria-labelledby="paramètres-parameters"><h4 id="paramètres-parameters">Paramètres {/<em>parameters</em>/}</h4><ul><li><code>load</code> : une fonction qui renvoie une <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise">promesse</a> ou un <em>thenable</em> (un objet doté d'une méthode <code>then</code> compatible). React n'appellera pas <code>load</code> tant que vous ne tenterez pas d'afficher le composant renvoyé. Après que React a appelé <code>load</code> pour la première fois, il patientera pour que la promesse s'établisse, puis affichera la propriété <code>,.default</code> de la valeur accomplie comme composant React. Tant la promesse renvoyée que sa valeur accomplie seront mises en cache, et React ne rappellera pas <code>load</code>. Si la promesse rejette, React lèvera (<code>throw</code>) la raison du rejet (généralement une <code>Error</code>) pour que le périmètre d'erreur le plus proche la gère.</ul></section><section class="level4"aria-labelledby="valeur-renvoyée-returns"><h4 id="valeur-renvoyée-returns">Valeur renvoyée {/<em>returns</em>/}</h4><p><code>lazy</code> renvoie un composant React que vous pouvez afficher dans votre arborescence. Pendant que le code du composant chargé à la demande se charge, toute tentative de l'afficher <em>suspend</em>. Utilisez <a href="/reference/react/Suspense"><code>&#x3C;Suspense></code></a> pour afficher un indicateur de chargement pendant ce temps-là.</section></section><section class="level3"aria-labelledby="la-fonction-load-load"><h3 id="la-fonction-load-load">La fonction <code>load</code> {/<em>load</em>/}</h3><section class="level4"aria-labelledby="paramètres-load-parameters"><h4 id="paramètres-load-parameters">Paramètres {/<em>load-parameters</em>/}</h4><p><code>load</code> ne prend aucun paramètre.</section><section class="level4"aria-labelledby="valeur-renvoyée-load-returns"><h4 id="valeur-renvoyée-load-returns">Valeur renvoyée {/<em>load-returns</em>/}</h4><p>Vous aurez besoin de renvoyer une <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise">promesse</a> ou un <em>thenable</em> (un objet doté d'une méthode <code>then</code> compatible). La valeur accomplie doit finalement posséder une propriété <code>.default</code> qui se comporte comme un composant React valide, tel une qu'une fonction, un composant <a href="/reference/react/memo"><code>memo</code></a>, ou un composant <a href="/reference/react/forwardRef"><code>forwardRef</code></a>.</section></section></section><section class="level2"aria-labelledby="utilisation-usage"><h2 id="utilisation-usage">Utilisation {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="charger-des-composants-à-la-demande-avec-suspense-suspense-for-code-splitting"><h3 id="charger-des-composants-à-la-demande-avec-suspense-suspense-for-code-splitting">Charger des composants à la demande avec Suspense {/<em>suspense-for-code-splitting</em>/}</h3><p>En général, vous importez vos composants avec la déclaration statique <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/import"><code>import</code></a> :<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">MarkdownPreview</span></span> <span class="token keyword module">from</span> <span class="token string">'./MarkdownPreview.js'</span><span class="token punctuation">;</span></code></pre><p>Pour différer le chargement du code de ce composant jusqu'à ce qu'il affiche pour la première fois, remplacez cette importation avec :<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> lazy <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">MarkdownPreview</span> <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./MarkdownPreview.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Ce code s'appuie sur <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Operators/import">l'importation dynamique <code>import()</code>,</a>, ce qui peut nécessiter une prise en charge de votre <em>bundler</em> ou framework. Pour utiliser cette approche, le composant chargé à la demande que vous importez doit être exporté sous le nom <code>default</code> (ce qui est notamment le cas de l'export par défaut).<p>Maintenant que le code de votre composant se charge à la demande, vous aurez besoin de spécifier ce qui devrait être affiché pendant son chargement. Vous pouvez le faire en enrobant le composant chargé à la demande ou l'un de ses parents dans un périmètre <a href="/reference/react/Suspense"><code>&#x3C;Suspense></code></a> :<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Loading</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Aperçu</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MarkdownPreview</span> <span class="token operator">/</span><span class="token operator">></span>
 <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span></code></pre><p>Dans cet exemple, le code de <code>MarkdownPreview</code> ne sera pas chargé jusqu'à ce que vous essayiez de l'afficher. Si <code>MarkdownPreview</code> n'est pas encore chargé, <code>Loading</code> sera affiché à sa place. Essayez de cocher la case :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> <span class="token maybe-class-name">Suspense</span><span class="token punctuation">,</span> lazy <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Loading</span></span> <span class="token keyword module">from</span> <span class="token string">'./Loading.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">MarkdownPreview</span> <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">delayForDemo</span><span class="token punctuation">(</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./MarkdownPreview.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MarkdownEditor</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>showPreview<span class="token punctuation">,</span> setShowPreview<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>markdown<span class="token punctuation">,</span> setMarkdown<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Salut **tout le monde** !'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>textarea value<span class="token operator">=</span><span class="token punctuation">{</span>markdown<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setMarkdown</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"checkbox"</span> checked<span class="token operator">=</span><span class="token punctuation">{</span>showPreview<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setShowPreview</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token maybe-class-name">Afficher</span> l’aperçu
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>showPreview <span class="token operator">&#x26;&#x26;</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Loading</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Aperçu</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MarkdownPreview</span> markdown<span class="token operator">=</span><span class="token punctuation">{</span>markdown<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Ajouter un délai fixe pour voir l’état de chargement</span>
<span class="token keyword">function</span> <span class="token function">delayForDemo</span><span class="token punctuation">(</span><span class="token parameter">promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Loading</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token operator">&#x3C;</span>i<span class="token operator">></span><span class="token maybe-class-name">Chargement</span><span class="token spread operator">...</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>i<span class="token operator">></span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Remarkable</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'remarkable'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> md <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Remarkable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MarkdownPreview</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> markdown <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div
      className<span class="token operator">=</span><span class="token string">"content"</span>
      dangerouslySetInnerHTML<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">__html</span><span class="token operator">:</span> md<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span>markdown<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"immer"</span><span class="token operator">:</span> <span class="token string">"1.7.3"</span><span class="token punctuation">,</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"remarkable"</span><span class="token operator">:</span> <span class="token string">"2.0.1"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">input<span class="token punctuation">,</span> textarea</span> <span class="token punctuation">{</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">min-height</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>Cette démo se charge avec un retard artificiel. La prochaine fois que vous décochez et cochez la case, <code>Preview</code> sera mis en cache, il n'y aura donc pas d'état de chargement. Pour voir à nouveau l'état de chargement, cliquez sur « Réinitialiser » dans le bac à sable.<p><a href="/reference/react/Suspense">En savoir plus sur la gestion des états de chargement avec Suspense</a>.</section></section><section class="level2"aria-labelledby="dépannage-troubleshooting"><h2 id="dépannage-troubleshooting">Dépannage {/<em>troubleshooting</em>/}</h2><section class="level3"aria-labelledby="létat-de-mon-composant-lazy-est-réinitialisé-de-façon-inattendue-my-lazy-components-state-gets-reset-unexpectedly"><h3 id="létat-de-mon-composant-lazy-est-réinitialisé-de-façon-inattendue-my-lazy-components-state-gets-reset-unexpectedly">L'état de mon composant <code>lazy</code> est réinitialisé de façon inattendue {/<em>my-lazy-components-state-gets-reset-unexpectedly</em>/}</h3><p>Ne déclarez pas les composants <code>lazy</code> <em>à l'intérieur</em> d'autres composants :<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> lazy <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Editor</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 🔴 Erroné : ça entraînera la réinitialisation de tous les états lors des réaffichages</span>
  <span class="token keyword">const</span> <span class="token maybe-class-name">MarkdownPreview</span> <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./MarkdownPreview.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Déclarez-les toujours plutôt au début de votre module :<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> lazy <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// ✅ Correct : déclarez les composants lazy en-dehors de vos composants</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">MarkdownPreview</span> <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'./MarkdownPreview.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Editor</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>