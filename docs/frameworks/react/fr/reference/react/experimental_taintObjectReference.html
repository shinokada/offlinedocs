<!doctype html><html lang="fr"><meta charset="utf-8"><title>experimental_taintObjectReference</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="experimental_taintobjectreference"><h1 id="experimental_taintobjectreference">experimental_taintObjectReference</h1><wip><p><strong>Cette API est expérimentale : elle n’a donc pas encore été livrée dans une version stable de React.</strong><p>Vous pouvez l'essayer en mettant à jour vos modules React afin d'utiliser la version expérimentale la plus récente :<ul><li><code>react@experimental</code><li><code>react-dom@experimental</code><li><code>eslint-plugin-react-hooks@experimental</code></ul><p>Les versions expérimentales de React sont susceptibles de contenir des bugs. Veillez donc à ne pas les utiliser en production.<p>Cette API n'est disponible qu'au sein des React Server Components.</p></wip><intro><p><code>taintObjectReference</code> vous permet d'empêcher qu'une instance objet précise soit passée à un Composant Client, comme par exemple un objet <code>user</code>.<pre class="language-js"><code class="language-js"><span class="token function">experimental_taintObjectReference</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> object<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Pour empêcher le passage d'une clé, d'un hash ou d'un jeton, utilisez <a href="/reference/react/experimental_taintUniqueValue"><code>taintUniqueValue</code></a>.</p></intro><inlinetoc><section class="level2"aria-labelledby="référence-reference"><h2 id="référence-reference">Référence {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="taintobjectreferencemessage-object-taintobjectreference"><h3 id="taintobjectreferencemessage-object-taintobjectreference"><code>taintObjectReference(message, object)</code> {/<em>taintobjectreference</em>/}</h3><p>Appelez <code>taintObjectReference</code> avec un objet pour indiquer à React qu'il ne doit pas permettre le passage de cet objet tel quel vers le côté client :<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_taintObjectReference <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token function">experimental_taintObjectReference</span><span class="token punctuation">(</span>
  <span class="token string">'Ne passez pas TOUTES les variables d’environnement au client.'</span><span class="token punctuation">,</span>
  process<span class="token punctuation">.</span><span class="token property-access">env</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><a href="#usage">Voir plus d'exemples ci-dessous</a>.<section class="level4"aria-labelledby="paramètres-parameters"><h4 id="paramètres-parameters">Paramètres {/<em>parameters</em>/}</h4><ul><li><p><code>message</code> : le message que vous souhaitez afficher si l'objet est passé à un Composant Client. Ce message fera partie de l'erreur qui sera levée si l'objet est passé à un Composant Client.<li><p><code>object</code> : l'objet a « ternir ». Les fonctions et instances de classes peuvent être passées en tant qu'<code>object</code> à <code>taintObjectReference</code>. React empêche d'entrée de jeu leur passage aux Composants Clients, mais ça remplacera le message d'erreur par défaut avec ce que vous aurez passé comme <code>message</code>. Notez que lorsqu'une instance précise d'un tableau typé <em>(Typed Array, NdT)</em> est passée comme <code>object</code> à <code>taintObjectReference</code>, les copies de ce tableau typé ne seront quant à elles pas ternies.</ul></section><section class="level4"aria-labelledby="valeur-renvoyée-returns"><h4 id="valeur-renvoyée-returns">Valeur renvoyée {/<em>returns</em>/}</h4><p><code>experimental_taintObjectReference</code> renvoie <code>undefined</code>.</section><section class="level4"aria-labelledby="limitations-caveats"><h4 id="limitations-caveats">Limitations {/<em>caveats</em>/}</h4><ul><li>Recréer ou cloner un objet terni produit un nouvel objet intact, susceptible de contenir des données sensibles. Si par exemple vous avez un objet <code>user</code> terni, <code>const userInfo = {name: user.name, ssn: user.ssn}</code> ou <code>{...user}</code> produiront de nouveaux objets qui ne seront, eux, pas ternis. <code>taintObjectReference</code> ne protège que contre les bévues simples lorsque l'objet est passé tel quel à un Composant Client.</ul><pitfall><p><strong>Ne comptez pas sur le ternissement pour garantir la sécurité.</strong> Ternir un objet n'empêche pas la fuite de toute donnée dérivée imaginable. Un clone de l'objet terni créera par exemple un objet intact. L'utilisation de données d'un objet terni (ex. <code>{secret: taintedObj.secret}</code>) crée une nouvelle valeur, ou un nouvel objet, qui ne sera pas terni·e. Le ternissement est une couche de protection ; une appli sécurisée aura plusieurs couches de protection complémentaires, des API soigneusement conçues et des mécanismes d'isolation en place.</p></pitfall></section></section></section><section class="level2"aria-labelledby="utilisation-usage"><h2 id="utilisation-usage">Utilisation {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="empêcher-des-données-utilisateur-datteindre-le-client-par-inadvertance-prevent-user-data-from-unintentionally-reaching-the-client"><h3 id="empêcher-des-données-utilisateur-datteindre-le-client-par-inadvertance-prevent-user-data-from-unintentionally-reaching-the-client">Empêcher des données utilisateur d'atteindre le client par inadvertance {/<em>prevent-user-data-from-unintentionally-reaching-the-client</em>/}</h3><p>Un Composant Client ne devrait jamais accepter des objets comportant des données sensibles. Dans l'idéal, les fonctions de chargement de données ne devraient pas exposer des données auxquelles l'utilisateur actif n'a pas accès. Mais des erreurs peuvent survenir lors d'une refonte du code. Pour se protéger contre des erreurs en aval nous pouvons « ternir » l'objet utilisateur dans notre API de données.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_taintObjectReference <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword control-flow">await</span> db<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT * FROM users WHERE id = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token function">experimental_taintObjectReference</span><span class="token punctuation">(</span>
    <span class="token string">'Ne passez pas l’objet utilisateur entier au client. '</span> <span class="token operator">+</span>
      <span class="token string">'Récupérez plutôt les propriétés spécifiques à votre scénario.'</span><span class="token punctuation">,</span>
    user<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Désormais, si un code serveur quelconque essaie de passer cet objet à un Composant Client, une erreur sera levée avec le message d'erreur fourni.</p><deepdive><section class="level4"aria-labelledby="se-protéger-contre-les-fuites-lors-du-chargement-de-données-protecting-against-leaks-in-data-fetching"><h4 id="se-protéger-contre-les-fuites-lors-du-chargement-de-données-protecting-against-leaks-in-data-fetching">Se protéger contre les fuites lors du chargement de données {/<em>protecting-against-leaks-in-data-fetching</em>/}</h4><p>Si votre environnement de Composants Serveur a accès à des données sensibles, vous devez être attentif·ve à ne pas passer des objets directement :<pre class="language-js"><code class="language-js"><span class="token comment">// api.js</span>
<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword control-flow">await</span> db<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT * FROM users WHERE id = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> getUser <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'api.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">InfoCard</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'components.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Profile</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getUser</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token property-access">userId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// NE FAITES PAS ÇA</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">InfoCard</span> user<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// components.js</span>
<span class="token string">"use client"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">InfoCard</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> user <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token punctuation">{</span>user<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Dans l'idéal, <code>getUser</code> ne devait pas exposer de données auxquelles l'utilisateur courant n'a pas accès. Pour empêcher le passage en aval de l'objet <code>user</code> à un Composant Client, nous pouvons décider de « ternir » cet objet :<pre class="language-js"><code class="language-js"><span class="token comment">// api.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_taintObjectReference <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword control-flow">await</span> db<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT * FROM users WHERE id = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token function">experimental_taintObjectReference</span><span class="token punctuation">(</span>
    <span class="token string">'Ne passez pas l’objet utilisateur entier au client. '</span> <span class="token operator">+</span>
      <span class="token string">'Récupérez plutôt les propriétés spécifiques à votre scénario.'</span><span class="token punctuation">,</span>
    user<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Désormais, si un code serveur quelconque essaie de passer cet objet à un Composant Client, une erreur sera levée avec le message d'erreur fourni.</p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></deepdive></section></section></inlinetoc></section>