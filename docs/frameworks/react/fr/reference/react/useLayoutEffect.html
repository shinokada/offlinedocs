<!doctype html><html lang="fr"><meta charset="utf-8"><title>useLayoutEffect</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="uselayouteffect"><h1 id="uselayouteffect">useLayoutEffect</h1><pitfall><p><code>useLayoutEffect</code> peut nuire aux performances. Préférez autant que possible <a href="/reference/react/useEffect"><code>useEffect</code></a>.</p></pitfall><intro><p><code>useLayoutEffect</code> est une version de <a href="/reference/react/useEffect"><code>useEffect</code></a> qui est déclenchée avant que le navigateur ne rafraîchisse l'affichage.<pre class="language-js"><code class="language-js"><span class="token function">useLayoutEffect</span><span class="token punctuation">(</span>setup<span class="token punctuation">,</span> dependencies<span class="token operator">?</span><span class="token punctuation">)</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="référence-reference"><h2 id="référence-reference">Référence {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="uselayouteffectsetup-dependencies-useinsertioneffect"><h3 id="uselayouteffectsetup-dependencies-useinsertioneffect"><code>useLayoutEffect(setup, dependencies?)</code> {/<em>useinsertioneffect</em>/}</h3><p>Appelez <code>useLayoutEffect</code> pour effectuer des mesures de mise en page avant que la navigateur ne rafraîchisse l'affichage à l'écran :<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useLayoutEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Tooltip</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tooltipHeight<span class="token punctuation">,</span> setTooltipHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTooltipHeight</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p><a href="#usage">Voir d'autres exemples ci-dessous</a>.<section class="level4"aria-labelledby="paramètres-parameters"><h4 id="paramètres-parameters">Paramètres {/<em>parameters</em>/}</h4><ul><li><p><code>setup</code> : la fonction contenant la logique de votre Effet. Votre fonction de mise en place peut par ailleurs renvoyer une fonction de <em>nettoyage</em>. Quand votre composant sera ajouté au DOM, React exécutera votre fonction de mise en place. Après chaque nouveau rendu dont les dépendances ont changé, React commencera par exécuter votre fonction de nettoyage (si vous en avez fourni une) avec les anciennes valeurs, puis exécutera votre fonction de mise en place avec les nouvelles valeurs. Une fois votre composant retiré du DOM, React exécutera votre fonction de nettoyage une dernière fois.<li><p><code>dependencies</code> <strong>optionnelles</strong> : la liste des valeurs réactives référencées par le code de <code>setup</code>. Les valeurs réactives comprennent les props, les variables d'état et toutes les variables et fonctions déclarées localement dans le corps de votre composant. Si votre <em>linter</em> est <a href="/learn/editor-setup#linting">configuré pour React</a>, il vérifiera que chaque valeur réactive concernée est bien spécifiée comme dépendance. La liste des dépendances doit avoir un nombre constant d'éléments et utiliser un littéral défini à la volée, du genre <code>[dep1, dep2, dep3]</code>. React comparera chaque dépendance à sa valeur précédente au moyen de la comparaison <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Object/is"><code>Object.is</code></a>. Si vous omettez cet argument, votre Effet sera re-exécuté après chaque rendu du composant.</ul></section><section class="level4"aria-labelledby="valeur-renvoyée-returns"><h4 id="valeur-renvoyée-returns">Valeur renvoyée {/<em>returns</em>/}</h4><p><code>useLayoutEffect</code> renvoie <code>undefined</code>.</section><section class="level4"aria-labelledby="limitations-caveats"><h4 id="limitations-caveats">Limitations {/<em>caveats</em>/}</h4><ul><li><p><code>useLayoutEffect</code> est un Hook, vous pouvez donc uniquement l’appeler <strong>à la racine de votre composant</strong> ou de vos propres Hooks. Vous ne pouvez pas l’appeler à l’intérieur de boucles ou de conditions. Si nécessaire, extrayez un nouveau composant et déplacez l'Effet dans celui-ci.<li><p>Quand le Mode Strict est activé, React <strong>appellera une fois de plus votre cycle mise en place + nettoyage, uniquement en développement</strong>, avant la première mise en place réelle. C'est une mise à l'épreuve pour vérifier que votre logique de nettoyage reflète bien votre logique de mise en place, et décommissionne ou défait toute la mise en place effectuée. Si ça entraîne des problèmes, <a href="/learn/synchronizing-with-effects#how-to-handle-the-effect-firing-twice-in-development">écrivez une fonction de nettoyage</a>.<li><p>Si certaines de vos dépendances sont des objets ou fonctions définies au sein de votre composant, il existe un risque qu'elles <strong>entraînent des exécutions superflues de votre Effet</strong>. Pour corriger ça, retirez les dépendances superflues sur des <a href="#removing-unnecessary-object-dependencies">objets</a> et <a href="#removing-unnecessary-function-dependencies">fonctions</a>. Vous pouvez aussi <a href="#updating-state-based-on-previous-state-from-an-effect">extraire les mises à jour d'état</a> et la <a href="#reading-the-latest-props-and-state-from-an-effect">logique non réactive</a> hors de votre Effet.<li><p>Les Effets <strong>ne sont exécutés que côté client</strong>. Ils sont ignorés lors du rendu côté serveur.<li><p>Le code dans <code>useLayoutEffect</code> et toutes les mises à jour d'état qui y sont demandées <strong>empêchent le navigateur de rafraîchir l'affichage à l'écran</strong>. Si vous l'utilisez trop, ça ralentira votre appli. Autant que possible, préférez <a href="/reference/react/useEffect"><code>useEffect</code></a>.</ul></section></section></section><section class="level2"aria-labelledby="utilisation-usage"><h2 id="utilisation-usage">Utilisation {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="mesurer-la-mise-en-page-avant-que-le-navigateur-ne-rafraîchisse-lécran-measuring-layout-before-the-browser-repaints-the-screen"><h3 id="mesurer-la-mise-en-page-avant-que-le-navigateur-ne-rafraîchisse-lécran-measuring-layout-before-the-browser-repaints-the-screen">Mesurer la mise en page avant que le navigateur ne rafraîchisse l'écran {/<em>measuring-layout-before-the-browser-repaints-the-screen</em>/}</h3><p>La plupart des composants n'ont pas besoin de connaître leur position ou leurs dimensions à l'écran pour déterminer ce qu'ils affichent. Ils renvoient simplement du JSX, après quoi le navigateur calcule leur <em>mise en page</em> (position et taille) et rafraîchit l'écran.<p>Parfois cependant, ça ne suffit pas. Imaginez une infobulle qui doit apparaître à côté d'un élément quand on survole ce dernier. S'il y a suffisamment de place, l'infobulle devrait apparaître au-dessus de l'élément, mais si c'est trop étroit, elle devrait apparaître en dessous. Pour afficher l'infobulle dans la bonne position d'entrée de jeu, vous aurez besoin de connaître sa hauteur (afin de déterminer si elle tiendra au-dessus).<p>Pour y parvenir, vous devrez faire un rendu en deux temps :<ol><li>Faire le rendu de l'infobulle n'importe où (même dans la mauvaise position).<li>Mesurer sa hauteur et décider où la placer.<li>Faire <em>à nouveau</em> le rendu de l'infobulle au bon endroit.</ol><p><strong>Tout ça doit se passer avant que le navigateur ait rafraîchi l'affichage.</strong> Vous ne voulez surtout pas que l'utilisateur voie l'infobulle se déplacer. Appelez <code>useLayoutEffect</code> pour mesurer la mise en page avant le rafraîchissement de l'écran :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Tooltip</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tooltipHeight<span class="token punctuation">,</span> setTooltipHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Vous ne connaissez pas encore sa hauteur</span>

  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTooltipHeight</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Refaire un rendu maintenant que vous connaissez la véritable hauteur</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...utilisez tooltipHeight dans la logique de rendu qui suit...</span>
<span class="token punctuation">}</span></code></pre><p>Voici comment ça fonctionne, étape par étape :<ol><li><code>Tooltip</code> fait un premier rendu avec <code>tooltipHeight = 0</code> (du coup l'infobulle est peut-être mal positionnée).<li>React met tout ça dans le DOM et exécute le code dans <code>useLayoutEffect</code>.<li>Votre <code>useLayoutEffect</code> <a href="https://developer.mozilla.org/fr/docs/Web/API/Element/getBoundingClientRect">mesure la hauteur</a> du contenu de l'infobulle et déclenche immédiatement un nouveau rendu.<li><code>Tooltip</code> refait son rendu avec la véritable hauteur dans <code>tooltipHeight</code> (du coup l'infobulle est correctement positionnée).<li>React met à jour le DOM, et le navigateur peut enfin afficher l'infobulle.</ol><p>Survolez les boutons ci-dessous pour voir de quelle façon l'infobulle ajuste sa position en fonction de la place dont elle dispose :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ButtonWithTooltip</span></span> <span class="token keyword module">from</span> <span class="token string">'./ButtonWithTooltip.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
            <span class="token maybe-class-name">Cette</span> infobulle ne tient pas au<span class="token operator">-</span>dessus du bouton<span class="token punctuation">.</span>
            <span class="token operator">&#x3C;</span>br <span class="token operator">/</span><span class="token operator">></span>
            <span class="token constant">C</span>’est pourquoi elle s’affiche en dessous <span class="token operator">!</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Survolez</span><span class="token operator">-</span><span class="token function">moi</span> <span class="token punctuation">(</span>infobulle en dessous<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">Cette</span> infobulle tient au<span class="token operator">-</span>dessus du bouton<span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Survolez</span><span class="token operator">-</span><span class="token function">moi</span> <span class="token punctuation">(</span>infobulle au<span class="token operator">-</span>dessus<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">Cette</span> infobulle tient au<span class="token operator">-</span>dessus du bouton<span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Survolez</span><span class="token operator">-</span><span class="token function">moi</span> <span class="token punctuation">(</span>infobulle au<span class="token operator">-</span>dessus<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Tooltip</span></span> <span class="token keyword module">from</span> <span class="token string">'./Tooltip.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ButtonWithTooltip</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> tooltipContent<span class="token punctuation">,</span> <span class="token spread operator">...</span>rest <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>targetRect<span class="token punctuation">,</span> setTargetRect<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> buttonRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button
        <span class="token punctuation">{</span><span class="token spread operator">...</span>rest<span class="token punctuation">}</span>
        ref<span class="token operator">=</span><span class="token punctuation">{</span>buttonRef<span class="token punctuation">}</span>
        onPointerEnter<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> rect <span class="token operator">=</span> buttonRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setTargetRect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">left</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">left</span><span class="token punctuation">,</span>
            <span class="token literal-property property">top</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">top</span><span class="token punctuation">,</span>
            <span class="token literal-property property">right</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">right</span><span class="token punctuation">,</span>
            <span class="token literal-property property">bottom</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">bottom</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        onPointerLeave<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setTargetRect</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>targetRect <span class="token operator">!==</span> <span class="token keyword null nil">null</span> <span class="token operator">&#x26;&#x26;</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Tooltip</span> targetRect<span class="token operator">=</span><span class="token punctuation">{</span>targetRect<span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token punctuation">{</span>tooltipContent<span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Tooltip</span><span class="token operator">></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useLayoutEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createPortal <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">TooltipContainer</span></span> <span class="token keyword module">from</span> <span class="token string">'./TooltipContainer.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Tooltip</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> targetRect <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tooltipHeight<span class="token punctuation">,</span> setTooltipHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTooltipHeight</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Hauteur mesurée de l’infobulle : '</span> <span class="token operator">+</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> tooltipX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> tooltipY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>targetRect <span class="token operator">!==</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tooltipX <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">left</span><span class="token punctuation">;</span>
    tooltipY <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">top</span> <span class="token operator">-</span> tooltipHeight<span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>tooltipY <span class="token operator">&#x3C;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Ça ne tient pas au-dessus, donc on la place en dessous.</span>
      tooltipY <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">bottom</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token function">createPortal</span><span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">TooltipContainer</span> x<span class="token operator">=</span><span class="token punctuation">{</span>tooltipX<span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span>tooltipY<span class="token punctuation">}</span> contentRef<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">TooltipContainer</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TooltipContainer</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> contentRef <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">pointerEvents</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate3d(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, 0)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>contentRef<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">"tooltip"</span><span class="token operator">></span>
        <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.tooltip</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">white</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>Remarquez que même si le composant <code>Tooltip</code> a besoin de faire un rendu en deux temps (une première fois avec <code>tooltipHeight</code> initialisée à <code>0</code>, puis avec la véritable hauteur mesurée), vous ne voyez que le résultat final. C'est pourquoi vous devez utiliser <code>useLayoutEffect</code> plutôt que <a href="/reference/react/useEffect"><code>useEffect</code></a> dans cet exemple. Examinons les différences en détails ci-dessous.</p><recipes titletext="useLayoutEffect vs. useEffect"titleid="examples"><section class="level4"aria-labelledby="uselayouteffect-empêche-le-navigateur-de-rafraîchir-laffichage-uselayouteffect-blocks-the-browser-from-repainting"><h4 id="uselayouteffect-empêche-le-navigateur-de-rafraîchir-laffichage-uselayouteffect-blocks-the-browser-from-repainting"><code>useLayoutEffect</code> empêche le navigateur de rafraîchir l'affichage {/<em>uselayouteffect-blocks-the-browser-from-repainting</em>/}</h4><p>React garantit que le code au sein de <code>useLayoutEffect</code> et toutes les mises à jour d'état qui y sont demandées seront traités <strong>avant que le navigateur ne rafraîchisse l'affichage à l'écran</strong>. Ça vous permet de faire un rendu de l'infobulle, la mesurer, et refaire un rendu de l'infobulle sans que l'utilisateur puisse remarquer le premier rendu supplémentaire. En d'autres termes, <code>useLayoutEffect</code> empêche le navigateur de rafraîchir l'affichage.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ButtonWithTooltip</span></span> <span class="token keyword module">from</span> <span class="token string">'./ButtonWithTooltip.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
            <span class="token maybe-class-name">Cette</span> infobulle ne tient pas au<span class="token operator">-</span>dessus du bouton<span class="token punctuation">.</span>
            <span class="token operator">&#x3C;</span>br <span class="token operator">/</span><span class="token operator">></span>
            <span class="token constant">C</span>’est pourquoi elle s’affiche en dessous <span class="token operator">!</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Survolez</span><span class="token operator">-</span><span class="token function">moi</span> <span class="token punctuation">(</span>infobulle en dessous<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">Cette</span> infobulle tient au<span class="token operator">-</span>dessus du bouton<span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Survolez</span><span class="token operator">-</span><span class="token function">moi</span> <span class="token punctuation">(</span>infobulle au<span class="token operator">-</span>dessus<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">Cette</span> infobulle tient au<span class="token operator">-</span>dessus du bouton<span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Survolez</span><span class="token operator">-</span><span class="token function">moi</span> <span class="token punctuation">(</span>infobulle au<span class="token operator">-</span>dessus<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Tooltip</span></span> <span class="token keyword module">from</span> <span class="token string">'./Tooltip.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ButtonWithTooltip</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> tooltipContent<span class="token punctuation">,</span> <span class="token spread operator">...</span>rest <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>targetRect<span class="token punctuation">,</span> setTargetRect<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> buttonRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button
        <span class="token punctuation">{</span><span class="token spread operator">...</span>rest<span class="token punctuation">}</span>
        ref<span class="token operator">=</span><span class="token punctuation">{</span>buttonRef<span class="token punctuation">}</span>
        onPointerEnter<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> rect <span class="token operator">=</span> buttonRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setTargetRect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">left</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">left</span><span class="token punctuation">,</span>
            <span class="token literal-property property">top</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">top</span><span class="token punctuation">,</span>
            <span class="token literal-property property">right</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">right</span><span class="token punctuation">,</span>
            <span class="token literal-property property">bottom</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">bottom</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        onPointerLeave<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setTargetRect</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>targetRect <span class="token operator">!==</span> <span class="token keyword null nil">null</span> <span class="token operator">&#x26;&#x26;</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Tooltip</span> targetRect<span class="token operator">=</span><span class="token punctuation">{</span>targetRect<span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token punctuation">{</span>tooltipContent<span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Tooltip</span><span class="token operator">></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useLayoutEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createPortal <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">TooltipContainer</span></span> <span class="token keyword module">from</span> <span class="token string">'./TooltipContainer.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Tooltip</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> targetRect <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tooltipHeight<span class="token punctuation">,</span> setTooltipHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTooltipHeight</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> tooltipX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> tooltipY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>targetRect <span class="token operator">!==</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tooltipX <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">left</span><span class="token punctuation">;</span>
    tooltipY <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">top</span> <span class="token operator">-</span> tooltipHeight<span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>tooltipY <span class="token operator">&#x3C;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Elle ne tient pas au-dessus, donc on la place en dessous.</span>
      tooltipY <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">bottom</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token function">createPortal</span><span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">TooltipContainer</span> x<span class="token operator">=</span><span class="token punctuation">{</span>tooltipX<span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span>tooltipY<span class="token punctuation">}</span> contentRef<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">TooltipContainer</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TooltipContainer</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> contentRef <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">pointerEvents</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate3d(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, 0)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>contentRef<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">"tooltip"</span><span class="token operator">></span>
        <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.tooltip</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">white</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section><section class="level4"aria-labelledby="useeffect-ne-bloque-pas-le-navigateur-useeffect-does-not-block-the-browser"><h4 id="useeffect-ne-bloque-pas-le-navigateur-useeffect-does-not-block-the-browser"><code>useEffect</code> ne bloque pas le navigateur {/<em>useeffect-does-not-block-the-browser</em>/}</h4><p>Voici le même exemple, mais en utilisant <a href="/reference/react/useEffect"><code>useEffect</code></a> plutôt que <code>useLayoutEffect</code>. Si vous êtes sur un appareil un peu lent, vous remarquerez peut-être un « vacillement » occasionnel de l'infobulle, qui s'affichera d'abord brièvement à sa position initiale avant d'opter pour la position appropriée.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ButtonWithTooltip</span></span> <span class="token keyword module">from</span> <span class="token string">'./ButtonWithTooltip.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
            <span class="token maybe-class-name">Cette</span> infobulle ne tient pas au<span class="token operator">-</span>dessus du bouton<span class="token punctuation">.</span>
            <span class="token operator">&#x3C;</span>br <span class="token operator">/</span><span class="token operator">></span>
            <span class="token constant">C</span>’est pourquoi elle s’affiche en dessous <span class="token operator">!</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Survolez</span><span class="token operator">-</span><span class="token function">moi</span> <span class="token punctuation">(</span>infobulle en dessous<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">Cette</span> infobulle tient au<span class="token operator">-</span>dessus du bouton<span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Survolez</span><span class="token operator">-</span><span class="token function">moi</span> <span class="token punctuation">(</span>infobulle au<span class="token operator">-</span>dessus<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">Cette</span> infobulle tient au<span class="token operator">-</span>dessus du bouton<span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Survolez</span><span class="token operator">-</span><span class="token function">moi</span> <span class="token punctuation">(</span>infobulle au<span class="token operator">-</span>dessus<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Tooltip</span></span> <span class="token keyword module">from</span> <span class="token string">'./Tooltip.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ButtonWithTooltip</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> tooltipContent<span class="token punctuation">,</span> <span class="token spread operator">...</span>rest <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>targetRect<span class="token punctuation">,</span> setTargetRect<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> buttonRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button
        <span class="token punctuation">{</span><span class="token spread operator">...</span>rest<span class="token punctuation">}</span>
        ref<span class="token operator">=</span><span class="token punctuation">{</span>buttonRef<span class="token punctuation">}</span>
        onPointerEnter<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> rect <span class="token operator">=</span> buttonRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setTargetRect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">left</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">left</span><span class="token punctuation">,</span>
            <span class="token literal-property property">top</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">top</span><span class="token punctuation">,</span>
            <span class="token literal-property property">right</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">right</span><span class="token punctuation">,</span>
            <span class="token literal-property property">bottom</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">bottom</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        onPointerLeave<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setTargetRect</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>targetRect <span class="token operator">!==</span> <span class="token keyword null nil">null</span> <span class="token operator">&#x26;&#x26;</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Tooltip</span> targetRect<span class="token operator">=</span><span class="token punctuation">{</span>targetRect<span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token punctuation">{</span>tooltipContent<span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Tooltip</span><span class="token operator">></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createPortal <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">TooltipContainer</span></span> <span class="token keyword module">from</span> <span class="token string">'./TooltipContainer.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Tooltip</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> targetRect <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tooltipHeight<span class="token punctuation">,</span> setTooltipHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTooltipHeight</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> tooltipX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> tooltipY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>targetRect <span class="token operator">!==</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tooltipX <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">left</span><span class="token punctuation">;</span>
    tooltipY <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">top</span> <span class="token operator">-</span> tooltipHeight<span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>tooltipY <span class="token operator">&#x3C;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Elle ne tient pas au-dessus, donc on la place en dessous.</span>
      tooltipY <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">bottom</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token function">createPortal</span><span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">TooltipContainer</span> x<span class="token operator">=</span><span class="token punctuation">{</span>tooltipX<span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span>tooltipY<span class="token punctuation">}</span> contentRef<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">TooltipContainer</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TooltipContainer</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> contentRef <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">pointerEvents</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate3d(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, 0)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>contentRef<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">"tooltip"</span><span class="token operator">></span>
        <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.tooltip</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">white</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>Pour vous permettre de reproduire le bug plus facilement, la version ci-dessous introduit un retard artificiel lors du rendu. React laissera le navigateur rafraîchir l'affichage avant de traiter les mises à jour d'état demandées au sein du <code>useEffect</code>. Résultat, l'infobulle vacille :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ButtonWithTooltip</span></span> <span class="token keyword module">from</span> <span class="token string">'./ButtonWithTooltip.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
            <span class="token maybe-class-name">Cette</span> infobulle ne tient pas au<span class="token operator">-</span>dessus du bouton<span class="token punctuation">.</span>
            <span class="token operator">&#x3C;</span>br <span class="token operator">/</span><span class="token operator">></span>
            <span class="token constant">C</span>’est pourquoi elle s’affiche en dessous <span class="token operator">!</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Survolez</span><span class="token operator">-</span><span class="token function">moi</span> <span class="token punctuation">(</span>infobulle en dessous<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">Cette</span> infobulle tient au<span class="token operator">-</span>dessus du bouton<span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Survolez</span><span class="token operator">-</span><span class="token function">moi</span> <span class="token punctuation">(</span>infobulle au<span class="token operator">-</span>dessus<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ButtonWithTooltip</span>
        tooltipContent<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">Cette</span> infobulle tient au<span class="token operator">-</span>dessus du bouton<span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">Survolez</span><span class="token operator">-</span><span class="token function">moi</span> <span class="token punctuation">(</span>infobulle au<span class="token operator">-</span>dessus<span class="token punctuation">)</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ButtonWithTooltip</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Tooltip</span></span> <span class="token keyword module">from</span> <span class="token string">'./Tooltip.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ButtonWithTooltip</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> tooltipContent<span class="token punctuation">,</span> <span class="token spread operator">...</span>rest <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>targetRect<span class="token punctuation">,</span> setTargetRect<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> buttonRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button
        <span class="token punctuation">{</span><span class="token spread operator">...</span>rest<span class="token punctuation">}</span>
        ref<span class="token operator">=</span><span class="token punctuation">{</span>buttonRef<span class="token punctuation">}</span>
        onPointerEnter<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> rect <span class="token operator">=</span> buttonRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setTargetRect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">left</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">left</span><span class="token punctuation">,</span>
            <span class="token literal-property property">top</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">top</span><span class="token punctuation">,</span>
            <span class="token literal-property property">right</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">right</span><span class="token punctuation">,</span>
            <span class="token literal-property property">bottom</span><span class="token operator">:</span> rect<span class="token punctuation">.</span><span class="token property-access">bottom</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        onPointerLeave<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setTargetRect</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>targetRect <span class="token operator">!==</span> <span class="token keyword null nil">null</span> <span class="token operator">&#x26;&#x26;</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Tooltip</span> targetRect<span class="token operator">=</span><span class="token punctuation">{</span>targetRect<span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token punctuation">{</span>tooltipContent<span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Tooltip</span><span class="token operator">></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createPortal <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">TooltipContainer</span></span> <span class="token keyword module">from</span> <span class="token string">'./TooltipContainer.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Tooltip</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> targetRect <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tooltipHeight<span class="token punctuation">,</span> setTooltipHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Ce code ralentit artificiellement le rendu</span>
  <span class="token keyword">let</span> now <span class="token operator">=</span> <span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">while</span> <span class="token punctuation">(</span><span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> now <span class="token operator">&#x3C;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// On glande pendant un court moment...</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTooltipHeight</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> tooltipX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> tooltipY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>targetRect <span class="token operator">!==</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tooltipX <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">left</span><span class="token punctuation">;</span>
    tooltipY <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">top</span> <span class="token operator">-</span> tooltipHeight<span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>tooltipY <span class="token operator">&#x3C;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Elle ne tient pas au-dessus, donc on la place en dessous.</span>
      tooltipY <span class="token operator">=</span> targetRect<span class="token punctuation">.</span><span class="token property-access">bottom</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token function">createPortal</span><span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">TooltipContainer</span> x<span class="token operator">=</span><span class="token punctuation">{</span>tooltipX<span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span>tooltipY<span class="token punctuation">}</span> contentRef<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">TooltipContainer</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TooltipContainer</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> contentRef <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">pointerEvents</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate3d(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, 0)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>contentRef<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">"tooltip"</span><span class="token operator">></span>
        <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.tooltip</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">white</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>Modifiez maintenant cet exemple pour utiliser <code>useLayoutEffect</code> (pensez à ajuster l'import), et constatez qu'il empêche le rafraichissement même si le rendu est ralenti.</p><solution></solution></section></recipes><note><p>Faire un rendu en deux temps et bloquer le navigateur nuit aux performances. Essayez d'éviter ça autant que possible.</p></note></section></section><section class="level2"aria-labelledby="dépannage-troubleshooting"><h2 id="dépannage-troubleshooting">Dépannage {/<em>troubleshooting</em>/}</h2><section class="level3"aria-labelledby="jai-une-erreur-uselayouteffect-does-nothing-on-the-server-im-getting-an-error-uselayouteffect-does-nothing-on-the-server"><h3 id="jai-une-erreur-uselayouteffect-does-nothing-on-the-server-im-getting-an-error-uselayouteffect-does-nothing-on-the-server">J'ai une erreur : “<code>useLayoutEffect</code> does nothing on the server” {/<em>im-getting-an-error-uselayouteffect-does-nothing-on-the-server</em>/}</h3><p><em>(« <code>useLayoutEffect</code> ne fait rien côté serveur », NdT)</em><p>L'objectif de <code>useLayoutEffect</code> consiste à permettre à votre composant <a href="#measuring-layout-before-the-browser-repaints-the-screen">d'utiliser des infos de mise en page pour son rendu</a> :<ol><li>Faire le rendu initial<li>Mesurer la mise en page <em>avant que le navigateur ne rafraîchisse l'écran</em>.<li>Faire le rendu final en utilisant les infos de mise en page obtenues.</ol><p>Lorsque vous ou votre framework utilisez le <a href="/reference/react-dom/server">rendu côté serveur</a>, votre appli React produit du HTML côté serveur pour le rendu initial. Ça permet d'afficher ce HTML initial avant que le code JavaScript ne soit chargé.<p>Le problème est que côté serveur, il n'y a aucune information de mise en page.<p>Dans <a href="#measuring-layout-before-the-browser-repaints-the-screen">l'exemple précédent</a>, l'appel à <code>useLayoutEffect</code> dans le composant <code>Tooltip</code> lui permet de se positionner correctement (au-dessus ou en dessous du contenu), en fonction de la hauteur de son contenu. Si vous tentiez d'afficher <code>Tooltip</code> au sein du HTML initial produit par le serveur, il serait impossible d'en déterminer la hauteur. Côté serveur, il n'y a pas encore de mise en page ! Du coup, même si vous en faites le rendu côté serveur, sa position « sursautera » côté client après que le JavaScript aura été chargé et exécuté.<p>En général, les composants qui reposent sur des infos de mise en page n'ont de toutes façons pas besoin d'être rendus côté serveur. Par exemple, ça n'a probablement pas de sens d'afficher un <code>Tooltip</code> lors du rendu initial. Il est déclenché par une interaction utilisateur.<p>Quoi qu'il en soit, si vous rencontrez ce problème, vous avez quelques options :<ul><li><p>Remplacez <code>useLayoutEffect</code> par <a href="/reference/react/useEffect"><code>useEffect</code></a>. Ça dit à React qu'il peut afficher le rendu initial sans bloquer le rafraîchissement (puisque le HTML d'origine deviendra visible avant que votre Effet ne soit exécuté).<li><p>Vous pouvez aussi <a href="/reference/react/Suspense#providing-a-fallback-for-server-errors-and-client-only-content">indiquer que votre composant est réservé au côté client</a>. Ça indique à React qu'il faudra en remplacer le contenu jusqu'au périmètre <a href="/reference/react/Suspense"><code>&#x3C;Suspense></code></a> le plus proche par un contenu de secours (par exemple un <em>spinner</em> ou un squelette structurel) pendant le rendu côté serveur.<li><p>Vous pouvez encore ne faire le rendu d'un composant qui recourt à <code>useLayoutEffect</code> qu'après l'hydratation. Maintenez un état booléen <code>isMounted</code> initialisé à <code>false</code>, que vous mettrez à <code>true</code> au sein d'un appel à <code>useEffect</code>. Votre logique de rendu peut alors ressembler à <code>return isMounted ? &#x3C;RealContent /> : &#x3C;FallbackContent /></code>. Côté serveur et pendant l'hydratation, l'utilisateur verra le <code>FallbackContent</code> qui, lui, n'appellera pas <code>useLayoutEffect</code>. Puis React le remplacera par <code>RealContent</code> qui s'exécute côté client uniquement et pourra inclure des appels à <code>useLayoutEffect</code>.<li><p>Si vous synchronisez votre composant avec un stockage de données extérieur et vous appuyez sur <code>useLayoutEffect</code> pour des raisons autres que la mesure de la mise en page, envisagez d'utiliser plutôt <a href="/reference/react/useSyncExternalStore"><code>useSyncExternalStore</code></a> qui, lui, <a href="/reference/react/useSyncExternalStore#adding-support-for-server-rendering">prend en charge le rendu côté serveur</a>. <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></ul></section></section></inlinetoc></section>