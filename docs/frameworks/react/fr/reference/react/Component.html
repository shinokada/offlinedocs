<!doctype html><html lang="fr"><meta charset="utf-8"><title>Component</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="component"><h1 id="component">Component</h1><pitfall><p>Nous vous conseillons de définir vos composants au moyen de fonctions plutôt que de classes. <a href="#alternatives">Voyez comment migrer</a>.</p></pitfall><intro><p><code>Component</code> est la classe de base pour les composants React définis à l'aide de <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Classes">classes JavaScript</a>. Les composants à base de classes restent pris en charge par React, mais nous les déconseillons pour tout nouveau code.<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Salut</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span> <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="référence-reference"><h2 id="référence-reference">Référence {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="component-component"><h3 id="component-component"><code>Component</code> {/<em>component</em>/}</h3><p>Pour définir un composant React sous forme de classe, étendez la classe <code>Component</code> fournie par React et définissez sa <a href="#render">méthode <code>render</code></a> :<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Component</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Salut</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span> <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Seule la méthode <code>render</code> est requise, les autres méthodes sont optionnelles.<p><a href="#usage">Voir d'autres exemples ci-dessous</a>.</section><section class="level3"aria-labelledby="context-context"><h3 id="context-context"><code>context</code> {/<em>context</em>/}</h3><p>Le <a href="/learn/passing-data-deeply-with-context">contexte</a> d'un composant à base de classe est mis à disposition dans <code>this.context</code>. Il n'est disponible que si vous précisez <em>quel</em> contexte vous souhaitez récupérer en utilisant <a href="#static-contexttype"><code>static contextType</code></a> (approche plus récente) ou <a href="#static-contexttypes"><code>static contextTypes</code></a> (approche dépréciée).<p>Un composant à base de classe ne peut lire qu'un contexte à la fois.<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> contextType <span class="token operator">=</span> <span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">context</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> className <span class="token operator">=</span> <span class="token string">'button-'</span> <span class="token operator">+</span> theme<span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>button className<span class="token operator">=</span><span class="token punctuation">{</span>className<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><note><p>La lecture de <code>this.context</code> dans des composants à base de classes est équivalente à un appel à <a href="/reference/react/useContext"><code>useContext</code></a> dans les fonctions composants.<p><a href="#migrating-a-component-with-context-from-a-class-to-a-function">Voyez comment migrer</a>.</p></note></section><section class="level3"aria-labelledby="props-props"><h3 id="props-props"><code>props</code> {/<em>props</em>/}</h3><p>Les props passées à un composant à base de classe sont mises à disposition dans <code>this.props</code>.<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Salut</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span> <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">&#x3C;</span><span class="token maybe-class-name">Greeting</span> name<span class="token operator">=</span><span class="token string">"Clara"</span> <span class="token operator">/</span><span class="token operator">></span></code></pre><note><p>La lecture de <code>this.props</code> dans des composants à base de classes est équivalente à la <a href="/learn/passing-props-to-a-component#step-2-read-props-inside-the-child-component">déclaration des props</a> dans les fonctions composants.<p><a href="#migrating-a-simple-component-from-a-class-to-a-function">Voyez comment migrer</a>.</p></note></section><section class="level3"aria-labelledby="refs-refs"><h3 id="refs-refs"><code>refs</code> {/<em>refs</em>/}</h3><deprecated><p>Cette API sera retirée d'une future version majeure de React. <a href="/reference/react/createRef">Utilisez plutôt <code>createRef</code></a>.</p></deprecated><p>Vous permet d'accéder à des <a href="https://legacy.reactjs.org/docs/refs-and-the-dom.html#legacy-api-string-refs">refs textuelles historiques</a> pour ce composant.</section><section class="level3"aria-labelledby="state-state"><h3 id="state-state"><code>state</code> {/<em>state</em>/}</h3><p>L'état d'un composant à base de classe est mis à disposition dans <code>this.state</code>. La champ <code>state</code> doit être un objet. Ne modifiez pas l'état directement. Si vous souhaitez modifier l'état, appelez <code>setState</code> avec un objet d'état en argument.<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">handleAgeChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleAgeChange</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Prendre</span> de l’âge
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Vous</span> avez <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">}</span> ans<span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><note><p>La définition de <code>state</code> dans les composants à base de classes est équivalente à l'appel de <a href="/reference/react/useState"><code>useState</code></a> dans les fonctions composants.<p><a href="#migrating-a-component-with-state-from-a-class-to-a-function">Voyez comment migrer</a>.</p></note></section><section class="level3"aria-labelledby="constructorprops-constructor"><h3 id="constructorprops-constructor"><code>constructor(props)</code> {/<em>constructor</em>/}</h3><p>Le <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Classes/constructor">constructeur</a> est exécuté avant le <em>montage</em> (l'ajout dans le DOM) de votre composant. En général, vous n'utilisez un constructeur dans React que pour deux raisons. Il vous permet de déclarer votre état puis de <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_objects/Function/bind">lier</a> certaines de vos méthodes à votre instance :<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleClick</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">handleClick</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span></code></pre><p>Si vous utilisez une syntaxe JavaScript moderne, vous aurez rarement besoin des constructeurs. Vous pouvez plutôt réécrire le code ci-dessus en utilisant des <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Classes/Public_class_fields">initialiseurs de champs d'instance</a> qui sont pris en charge par tous les navigateurs modernes et par des outils comme <a href="https://babeljs.io/">Babel</a> :<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span></code></pre><p>Un constructeur ne devrait contenir aucun effet de bord ni aucun abonnement.<section class="level4"aria-labelledby="paramètres-constructor-parameters"><h4 id="paramètres-constructor-parameters">Paramètres {/<em>constructor-parameters</em>/}</h4><ul><li><code>props</code> : les props initiales du composant.</ul></section><section class="level4"aria-labelledby="valeur-renvoyée-constructor-returns"><h4 id="valeur-renvoyée-constructor-returns">Valeur renvoyée {/<em>constructor-returns</em>/}</h4><p><code>constructor</code> ne devrait rien renvoyer.</section><section class="level4"aria-labelledby="limitations-constructor-caveats"><h4 id="limitations-constructor-caveats">Limitations {/<em>constructor-caveats</em>/}</h4><ul><li><p>Ne lancez aucun effet de bord et ne souscrivez aucun abonnement dans le constructeur. Utilisez plutôt <a href="#componentdidmount"><code>componentDidMount</code></a> pour ça.<li><p>Dans un constructeur, vous devez impérativement appeler <code>super(props)</code> avant toute autre instruction. Si vous ne le faites pas, <code>this.props</code> sera <code>undefined</code> pendant l'exécution du constructeur, ce qui peut être déroutant et causer des bugs.<li><p>Le constructeur est le seul endroit où vous pouvez affecter une valeur directement à <a href="#state"><code>this.state</code></a>. Dans toutes les autres méthodes, vous devez plutôt utiliser <a href="#setstate"><code>this.setState()</code></a>. En revanche, n'appelez pas <code>setState</code> dans le constructeur.<li><p>Lorsque vous faites du <a href="/reference/react-dom/server">rendu côté serveur</a>, le constructeur sera exécuté côté serveur aussi, suivi de la méthode <a href="#render"><code>render</code></a>. En revanche, les méthodes de cycle de vie telles que <code>componentDidMount</code> ou <code>componentWillUnmount</code> ne seront pas exécutées côté serveur.<li><p>En <a href="/reference/react/StrictMode">mode strict</a>, React appellera votre <code>constructor</code> deux fois en développement, puis jettera une des instances obtenues. Ce comportement vous permet de repérer des effets de bord involontaires qui doivent être sortis du <code>constructor</code>.</ul><note><p>Il n'y a pas d'équivalent réel du <code>constructor</code> dans les fonctions composants. Pour déclarer un état dans une fonction composant, utilisez <a href="/reference/react/useState"><code>useState</code></a>. Pour éviter de recalculer l'état initial, <a href="/reference/react/useState#avoiding-recreating-the-initial-state">passez une fonction à <code>useState</code></a>.</p></note></section></section><section class="level3"aria-labelledby="componentdidcatcherror-info-componentdidcatch"><h3 id="componentdidcatcherror-info-componentdidcatch"><code>componentDidCatch(error, info)</code> {/<em>componentdidcatch</em>/}</h3><p>Si vous définissez <code>componentDidCatch</code>, React l'appellera lorsqu'un composant descendant lèvera une erreur lors du rendu. Ça vous permettra de signaler l'erreur à un service de supervision en production.<p>Elle est en général utilisée conjointement avec <a href="#static-getderivedstatefromerror"><code>static getDerivedStateFromError</code></a>, qui vous permet de mettre à jour l'état en réaction à une erreur afin d'afficher un message d'erreur à l'utilisateur. Un composant doté de ces méthodes est ce qu'on appelle un <em>périmètre d'erreur</em>.<p><a href="#catching-rendering-errors-with-an-error-boundary">Voir un exemple</a>.<section class="level4"aria-labelledby="paramètres-componentdidcatch-parameters"><h4 id="paramètres-componentdidcatch-parameters">Paramètres {/<em>componentdidcatch-parameters</em>/}</h4><ul><li><p><code>error</code> : l'erreur qui a été levée. En pratique il s'agira généralement d'une instance d'<a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Error"><code>Error</code></a>, mais ce n'est pas garanti parce que JavaScript autorise un <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Statements/throw"><code>throw</code></a> de n'importe quelle valeur, y compris des chaînes de caractères et même <code>null</code>.<li><p><code>info</code> : un objet contenant des informations complémentaires sur l'erreur. Son champ <code>componentStack</code> contient une pile d'appel de rendu avec le composant ayant levé l'erreur, ainsi que les noms et emplacements dans le code source de tous ses composants parents. En production, les noms des composants seront minifiés. Si vous mettez en place un signalement d'erreurs en production, vous pouvez décoder la pile d'appels de rendu grâce aux <em>sourcemaps</em>, exactement comme pour les piles d'appels d'erreurs JavaScript usuelles.</ul></section><section class="level4"aria-labelledby="valeur-renvoyée-componentdidcatch-returns"><h4 id="valeur-renvoyée-componentdidcatch-returns">Valeur renvoyée {/<em>componentdidcatch-returns</em>/}</h4><p><code>componentDidCatch</code> ne devrait rien renvoyer.</section><section class="level4"aria-labelledby="limitations-componentdidcatch-caveats"><h4 id="limitations-componentdidcatch-caveats">Limitations {/<em>componentdidcatch-caveats</em>/}</h4><ul><li><p>Par le passé, on appelait couramment <code>setState</code> dans <code>componentDidCatch</code> pour mettre à jour l'UI et afficher un message d'erreur de remplacement. C'est déprécié en faveur d'une définition de <a href="#static-getderivedstatefromerror"><code>static getDerivedStateFromError</code></a>.<li><p>Les <em>builds</em> de production et de développement diffèrent légèrement dans leur gestion de l'erreur par <code>componentDidCatch</code>. En développement, les erreurs se propageront jusqu'à <code>window</code>, ce qui signifie que <code>window.onerror</code> et <code>window.addEventListener('error', callback)</code> intercepteront les erreurs attrapées par <code>componentDidCatch</code>. En production, les erreurs ne seront pas propagées, de sorte que les gestionnaires d'erreurs placés plus haut dans l'arbre ne recevront que les erreurs qui n'auront pas été expressément interceptées par <code>componentDidCatch</code>.</ul><note><p>Il n'y a pas encore d'équivalent direct à <code>componentDidCatch</code> dans les fonctions composants. Si vous souhaitez éviter de créer des composants à base de classes, écrivez un unique composant <code>ErrorBoundary</code> comme ci-dessus et utilisez-le dans toute votre appli. Vous pouvez aussi utiliser le module <a href="https://github.com/bvaughn/react-error-boundary"><code>react-error-boundary</code></a> qui fait ça (et davantage) pour vous.</p></note></section></section><section class="level3"aria-labelledby="componentdidmount-componentdidmount"><h3 id="componentdidmount-componentdidmount"><code>componentDidMount()</code> {/<em>componentdidmount</em>/}</h3><p>Si vous définissez la méthode <code>componentDidMount</code>, React l'appellera lorsque votre composant sera ajouté au DOM (<em>monté</em>). C'est l'endroit classique pour démarrer un chargement de données, souscrire des abonnements, ou manipuler des nœuds du DOM.<p>Si vous implémentez <code>componentDidMount</code>, vous aurez généralement besoin d'implémenter d'autres méthodes de cycle de vie pour éviter les bugs. Si par exemple <code>componentDidMount</code> lit de l'état et des props, vous devrez aussi implémenter <a href="#componentdidupdate"><code>componentDidUpdate</code></a> pour en gérer les modifications, et <a href="#componentwillunmount"><code>componentWillUnmount</code></a> pour nettoyer toute mise en place effectuée par <code>componentDidMount</code>.<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">ChatRoom</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> <span class="token string">'https://localhost:1234'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setupConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">roomId</span> <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span><span class="token property-access">roomId</span> <span class="token operator">||</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">serverUrl</span> <span class="token operator">!==</span> prevState<span class="token punctuation">.</span><span class="token property-access">serverUrl</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">destroyConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setupConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">destroyConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><a href="#adding-lifecycle-methods-to-a-class-component">Voir d'autres exemples</a>.<section class="level4"aria-labelledby="paramètres-componentdidmount-parameters"><h4 id="paramètres-componentdidmount-parameters">Paramètres {/<em>componentdidmount-parameters</em>/}</h4><p><code>componentDidMount</code> ne prend aucun paramètre.</section><section class="level4"aria-labelledby="valeur-renvoyée-componentdidmount-returns"><h4 id="valeur-renvoyée-componentdidmount-returns">Valeur renvoyée {/<em>componentdidmount-returns</em>/}</h4><p><code>componentDidMount</code> ne devrait rien renvoyer.</section><section class="level4"aria-labelledby="limitations-componentdidmount-caveats"><h4 id="limitations-componentdidmount-caveats">Limitations {/<em>componentdidmount-caveats</em>/}</h4><ul><li><p>En <a href="/reference/react/StrictMode">mode strict</a>, en développement React appellera <code>componentDidMount</code>, puis appellera immédiatement <a href="#componentwillunmount"><code>componentWillUnmount</code></a> et rappellera <code>componentDidMount</code> une seconde fois. Ça vous aide à remarquer un oubli d'implémentation de <code>componentWillUnmount</code>, ou un « miroir » insuffisant dans celle-ci de la logique présente dans <code>componentDidMount</code>.<li><p>Même si vous pourriez appeler immédiatement <a href="#setstate"><code>setState</code></a> dans <code>componentDidMount</code>, il est préférable de l'éviter autant que possible. Ça déclencherait un rendu supplémentaire, qui arriverait toutefois avant que le navigateur n'ait mis à jour l'affichage. Ça garantit que même si la méthode <a href="#render"><code>render</code></a> est bien appelée deux fois dans un tel cas, l'utilisateur ne verra pas l'état intermédiaire. Utilisez cette approche avec précaution, parce qu'elle nuit aux performances. La plupart du temps, vous devriez pouvoir plutôt définir l'état initial dans le <a href="#constructor"><code>constructor</code></a>. Ça reste toutefois utile pour des cas comme les boîtes de dialogue modales et les infobulles, qui nécessitent une mesure de nœud DOM avant de pouvoir afficher quelque chose qui dépend de leur taille ou de leur position.</ul><note><p>Dans de nombreux cas, définir <code>componentDidMount</code>, <code>componentDidUpdate</code> et <code>componentWillUnmount</code> conjointement dans des composants à base de classes revient à un simple appel à <a href="/reference/react/useEffect"><code>useEffect</code></a> dans les fonctions composants. Dans les rares cas où il est important d'exécuter du code avant l'affichage par le navigateur, un meilleur équivalent serait <a href="/reference/react/useLayoutEffect"><code>useLayoutEffect</code></a>.<p><a href="#migrating-a-component-with-lifecycle-methods-from-a-class-to-a-function">Voyez comment migrer</a>.</p></note></section></section><section class="level3"aria-labelledby="componentdidupdateprevprops-prevstate-snapshot-componentdidupdate"><h3 id="componentdidupdateprevprops-prevstate-snapshot-componentdidupdate"><code>componentDidUpdate(prevProps, prevState, snapshot?)</code> {/<em>componentdidupdate</em>/}</h3><p>Si vous définissez la méthode <code>componentDidUpdate</code>, React l'appellera immédiatement après que le composant a recalculé son rendu et mis à jour ses props et son état. Cette méthode n'est pas appelée lors du rendu initial.<p>Vous pouvez l'utiliser pour manipuler le DOM après une mise à jour. C'est également un endroit courant pour des requêtes réseau, du moment que vous comparez les nouvelles props aux anciennes (une requête réseau pourrait par exemple être superflue si les props n'ont pas bougé). En général, vous l'utiliserez conjointement à <a href="#componentdidmount"><code>componentDidMount</code></a> et <a href="#componentwillunmount"><code>componentWillUnmount</code></a> :<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">ChatRoom</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> <span class="token string">'https://localhost:1234'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setupConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">roomId</span> <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span><span class="token property-access">roomId</span> <span class="token operator">||</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">serverUrl</span> <span class="token operator">!==</span> prevState<span class="token punctuation">.</span><span class="token property-access">serverUrl</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">destroyConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setupConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">destroyConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><a href="#adding-lifecycle-methods-to-a-class-component">Voir d'autres exemples</a>.<section class="level4"aria-labelledby="paramètres-componentdidupdate-parameters"><h4 id="paramètres-componentdidupdate-parameters">Paramètres {/<em>componentdidupdate-parameters</em>/}</h4><ul><li><p><code>prevProps</code> : les props de votre composant avant la mise à jour. Comparez <code>prevProps</code> à <a href="#props"><code>this.props</code></a> pour déterminer ce qui a changé.<li><p><code>prevState</code> : l'état de votre composant avant la mise à jour. Comparez <code>prevState</code> à <a href="#state"><code>this.state</code></a> pour déterminer ce qui a changé.<li><p><code>snapshot</code> : si vous avez implémenté <a href="#getsnapshotbeforeupdate"><code>getSnapshotBeforeUpdate</code></a>, <code>snapshot</code> contiendra la valeur que vous aviez renvoyée depuis cette méthode. Dans les autres cas, ça vaudra <code>undefined</code>.</ul></section><section class="level4"aria-labelledby="valeur-renvoyée-componentdidupdate-returns"><h4 id="valeur-renvoyée-componentdidupdate-returns">Valeur renvoyée {/<em>componentdidupdate-returns</em>/}</h4><p><code>componentDidUpdate</code> ne devrait rien renvoyer.</section><section class="level4"aria-labelledby="limitations-componentdidupdate-caveats"><h4 id="limitations-componentdidupdate-caveats">Limitations {/<em>componentdidupdate-caveats</em>/}</h4><ul><li><p><code>componentDidUpdate</code> ne sera pas appelée si <a href="#shouldcomponentupdate"><code>shouldComponentUpdate</code></a> est définie et renvoie <code>false</code>.<li><p>La logique dans <code>componentDidUpdate</code> devrait généralement être entourée de conditions comparant <code>this.props</code> et <code>prevProps</code>, ainsi que <code>this.state</code> et <code>prevState</code>. Faute de quoi vous risquez des boucles de rendu infinies.<li><p>Même si vous pourriez appeler immédiatement <a href="#setstate"><code>setState</code></a> dans <code>componentDidMount</code>, il est préférable de l'éviter autant que possible. Ça déclencherait un rendu supplémentaire, qui arriverait toutefois avant que le navigateur n'ait mis à jour l'affichage. Ça garantit que même si la méthode <a href="#render"><code>render</code></a> est bien appelée deux fois dans un tel cas, l'utilisateur ne verra pas l'état intermédiaire. Cette approche peut nuire aux performances, mais reste toutefois utile pour des cas comme les boîtes de dialogue modales et les infobulles, qui nécessitent une mesure de nœud DOM avant de pouvoir afficher quelque chose qui dépend de leur taille ou de leur position.</ul><note><p>Dans de nombreux cas, définir <code>componentDidMount</code>, <code>componentDidUpdate</code> et <code>componentWillUnmount</code> conjointement dans des composants à base de classes revient à un simple appel à <a href="/reference/react/useEffect"><code>useEffect</code></a> dans les fonctions composants. Dans les rares cas où il est important d'exécuter du code avant l'affichage par le navigateur, un meilleur équivalent serait <a href="/reference/react/useLayoutEffect"><code>useLayoutEffect</code></a>.<p><a href="#migrating-a-component-with-lifecycle-methods-from-a-class-to-a-function">Voyez comment migrer</a>.</p></note></section></section><section class="level3"aria-labelledby="componentwillmount-componentwillmount"><h3 id="componentwillmount-componentwillmount"><code>componentWillMount()</code> {/<em>componentwillmount</em>/}</h3><deprecated><p>Cette API a été renommée de <code>componentWillMount</code> en <a href="#unsafe_componentwillmount"><code>UNSAFE_componentWillMount</code></a>. L'ancien nom est déprécié. Dans les futures versions de React, seul le nouveau nom fonctionnera.<p>Exécutez le <a href="https://github.com/reactjs/react-codemod#rename-unsafe-lifecycles"><em>codemod</em> <code>rename-unsafe-lifecycles</code></a> pour mettre automatiquement le code de vos composants à jour.</p></deprecated></section><section class="level3"aria-labelledby="componentwillreceivepropsnextprops-componentwillreceiveprops"><h3 id="componentwillreceivepropsnextprops-componentwillreceiveprops"><code>componentWillReceiveProps(nextProps)</code> {/<em>componentwillreceiveprops</em>/}</h3><deprecated><p>Cette API a été renommée de <code>componentWillReceiveProps</code> en <a href="#unsafe_componentwillreceiveprops"><code>UNSAFE_componentWillReceiveProps</code></a>. L'ancien nom est déprécié. Dans les futures versions de React, seul le nouveau nom fonctionnera.<p>Exécutez le <a href="https://github.com/reactjs/react-codemod#rename-unsafe-lifecycles"><em>codemod</em> <code>rename-unsafe-lifecycles</code></a> pour mettre automatiquement le code de vos composants à jour.</p></deprecated></section><section class="level3"aria-labelledby="componentwillupdatenextprops-nextstate-componentwillupdate"><h3 id="componentwillupdatenextprops-nextstate-componentwillupdate"><code>componentWillUpdate(nextProps, nextState)</code> {/<em>componentwillupdate</em>/}</h3><deprecated><p>Cette API a été renommée de <code>componentWillUpdate</code> en <a href="#unsafe_componentwillupdate"><code>UNSAFE_componentWillUpdate</code></a>. L'ancien nom est déprécié. Dans les futures versions de React, seul le nouveau nom fonctionnera.<p>Exécutez le <a href="https://github.com/reactjs/react-codemod#rename-unsafe-lifecycles"><em>codemod</em> <code>rename-unsafe-lifecycles</code></a> pour mettre automatiquement le code de vos composants à jour.</p></deprecated></section><section class="level3"aria-labelledby="componentwillunmount-componentwillunmount"><h3 id="componentwillunmount-componentwillunmount"><code>componentWillUnmount()</code> {/<em>componentwillunmount</em>/}</h3><p>Si vous définissez la méthode <code>componentWillUnmount</code>, React l'appellera avant que votre composant soit retiré du DOM (<em>démonté</em>). C'est un endroit courant pour annuler les chargements de données et vous désabonner.<p>La logique dans <code>componentWillUnmount</code> devrait agir « en miroir » de celle dans <a href="#componentdidmount"><code>componentDidMount</code></a>. Si par exemple <code>componentDidMount</code> souscrit un abonnement, <code>componentWillUnmount</code> devrait faire le désabonnement associé. Si la logique de nettoyage dans votre <code>componentWillUnmount</code> lit des props ou de l'état, vous aurez généralement besoin d'implémenter également <a href="#componentdidupdate"><code>componentDidUpdate</code></a> pour nettoyer les ressources (tels que les abonnements) correspondant aux anciennes props et anciens états.<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">ChatRoom</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> <span class="token string">'https://localhost:1234'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setupConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">roomId</span> <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span><span class="token property-access">roomId</span> <span class="token operator">||</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">serverUrl</span> <span class="token operator">!==</span> prevState<span class="token punctuation">.</span><span class="token property-access">serverUrl</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">destroyConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setupConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">destroyConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><a href="#adding-lifecycle-methods-to-a-class-component">Voir d'autres exemples</a>.<section class="level4"aria-labelledby="paramètres-componentwillunmount-parameters"><h4 id="paramètres-componentwillunmount-parameters">Paramètres {/<em>componentwillunmount-parameters</em>/}</h4><p><code>componentWillUnmount</code> ne prend aucun paramètre.</section><section class="level4"aria-labelledby="valeur-renvoyée-componentwillunmount-returns"><h4 id="valeur-renvoyée-componentwillunmount-returns">Valeur renvoyée {/<em>componentwillunmount-returns</em>/}</h4><p><code>componentWillUnmount</code> ne devrait rien renvoyer.</section><section class="level4"aria-labelledby="limitations-componentwillunmount-caveats"><h4 id="limitations-componentwillunmount-caveats">Limitations {/<em>componentwillunmount-caveats</em>/}</h4><ul><li>En <a href="/reference/react/StrictMode">mode strict</a>, en développement React appellera <code>componentDidMount</code>, puis appellera immédiatement <a href="#componentwillunmount"><code>componentWillUnmount</code></a> et rappellera <code>componentDidMount</code> une seconde fois. Ça vous aide à remarquer un oubli d'implémentation de <code>componentWillUnmount</code>, ou un « miroir » insuffisant dans celle-ci de la logique présente dans <code>componentDidMount</code>.</ul><note><p>Dans de nombreux cas, définir <code>componentDidMount</code>, <code>componentDidUpdate</code> et <code>componentWillUnmount</code> conjointement dans des composants à base de classes revient à un simple appel à <a href="/reference/react/useEffect"><code>useEffect</code></a> dans les fonctions composants. Dans les rares cas où il est important d'exécuter du code avant l'affichage par le navigateur, un meilleur équivalent serait <a href="/reference/react/useLayoutEffect"><code>useLayoutEffect</code></a>.<p><a href="#migrating-a-component-with-lifecycle-methods-from-a-class-to-a-function">Voyez comment migrer</a>.</p></note></section></section><section class="level3"aria-labelledby="forceupdatecallback-forceupdate"><h3 id="forceupdatecallback-forceupdate"><code>forceUpdate(callback?)</code> {/<em>forceupdate</em>/}</h3><p>Force un composant à recalculer son rendu.<p>Vous n'en avez normalement pas besoin. Si la méthode <a href="#render"><code>render</code></a> de votre composant se contente de lire <a href="#props"><code>this.props</code></a>, <a href="#state"><code>this.state</code></a> ou <a href="#context"><code>this.context</code></a>, il refera automatiquement son rendu lorsque vous appelez <a href="#setstate"><code>setState</code></a> dans votre composant ou dans un de ses parents. En revanche, si la méthode <code>render</code> de votre composant lit directement une source de données extérieure, vous devrez demander à React de mettre à jour l'interface utilisateur lorsque cette source de données change. C'est ce à quoi sert <code>forceUpdate</code>.<p>Essayez d'éviter tout utilisation de <code>forceUpdate</code>, en ne lisant que <code>this.props</code> et <code>this.state</code> dans <code>render</code>.<section class="level4"aria-labelledby="paramètres-forceupdate-parameters"><h4 id="paramètres-forceupdate-parameters">Paramètres {/<em>forceupdate-parameters</em>/}</h4><ul><li><code>callback</code> <strong>optionnel</strong> : s'il est précisé, React appellera le <code>callback</code> que vous avez fourni une fois la mise à jour retranscrite dans le DOM.</ul></section><section class="level4"aria-labelledby="valeur-renvoyée-forceupdate-returns"><h4 id="valeur-renvoyée-forceupdate-returns">Valeur renvoyée {/<em>forceupdate-returns</em>/}</h4><p><code>forceUpdate</code> ne renvoie rien.</section><section class="level4"aria-labelledby="limitations-forceupdate-caveats"><h4 id="limitations-forceupdate-caveats">Limitations {/<em>forceupdate-caveats</em>/}</h4><ul><li>Si vous appelez <code>forceUpdate</code>, React recalculera le rendu sans appeler d'abord <a href="#shouldcomponentupdate"><code>shouldComponentUpdate</code>.</a></ul><note><p>Là où les composants à base de classes lisent une source de données extérieure pour ensuite forcer avec <code>forceUpdate</code> le recalcul de leur rendu lorsque celle-ci change, les fonctions composants utilisent plutôt <a href="/reference/react/useSyncExternalStore"><code>useSyncExternalStore</code></a>.</p></note></section></section><section class="level3"aria-labelledby="getchildcontext-getchildcontext"><h3 id="getchildcontext-getchildcontext"><code>getChildContext()</code> {/<em>getchildcontext</em>/}</h3><deprecated><p>Cette API sera retirée d'une future version majeure de React. <a href="/reference/react/createContext#provider">Utilisez plutôt <code>Context.Provider</code></a>.</p></deprecated><p>Vous permet de spécifier les valeurs fournies par le composant pour les <a href="https://legacy.reactjs.org/docs/legacy-context.html">contextes historiques</a>.</section><section class="level3"aria-labelledby="getsnapshotbeforeupdateprevprops-prevstate-getsnapshotbeforeupdate"><h3 id="getsnapshotbeforeupdateprevprops-prevstate-getsnapshotbeforeupdate"><code>getSnapshotBeforeUpdate(prevProps, prevState)</code> {/<em>getsnapshotbeforeupdate</em>/}</h3><p>Si vous implémentez <code>getSnapshotBeforeUpdate</code>, React l'appellera juste avant de mettre à jour le DOM. Ça permet à votre composant de capturer certaines informations issues du DOM (telles que la position de défilement) avant qu'elles risquent d'évoluer. Toute valeur renvoyée par cette méthode de cycle de vie sera passée en paramètre à <a href="#componentdidupdate"><code>componentDidUpdate</code></a>.<p>Vous pouvez par exemple l'utiliser dans une UI de type fil de discussion qui aurait besoin de préserver la position de défilement lors des mises à jour :<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">ScrollingList</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">listRef</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">getSnapshotBeforeUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Ajoute-t-on des nouveaux éléments à la liste ?</span>
    <span class="token comment">// Capturons alors la position de défilement pour l’ajuster</span>
    <span class="token comment">// par la suite.</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>prevProps<span class="token punctuation">.</span><span class="token property-access">list</span><span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">&#x3C;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">list</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">listRef</span><span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> list<span class="token punctuation">.</span><span class="token property-access">scrollHeight</span> <span class="token operator">-</span> list<span class="token punctuation">.</span><span class="token property-access">scrollTop</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState<span class="token punctuation">,</span> snapshot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Si nous avons une valeur capturée, c’est qu’on a ajouté</span>
    <span class="token comment">// de nouveaux éléments. On ajuste alors le défilement de façon</span>
    <span class="token comment">// à ce que les nouveaux éléments ne décalent pas les anciens</span>
    <span class="token comment">// hors de la zone visible.</span>
    <span class="token comment">// (Ici `snapshot` est la valeur renvoyée `getSnapshotBeforeUpdate`.)</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>snapshot <span class="token operator">!==</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">listRef</span><span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">;</span>
      list<span class="token punctuation">.</span><span class="token property-access">scrollTop</span> <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token property-access">scrollHeight</span> <span class="token operator">-</span> snapshot<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">listRef</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token comment">/* ...contenu... */</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Dans l'exemple ci-dessus, il est vital de lire la propriété <code>scrollHeight</code> directement dans <code>getSnapshotBeforeUpdate</code>. On ne pourrait pas la lire de façon fiable dans <a href="#render"><code>render</code></a>, <a href="#unsafe_componentwillreceiveprops"><code>UNSAFE_componentWillReceiveProps</code></a> ou <a href="#unsafe_componentwillupdate"><code>UNSAFE_componentWillUpdate</code></a> parce qu'il existe un risque de décalage temporel entre les appels de ces méthodes et la mise à jour du DOM par React.<section class="level4"aria-labelledby="paramètres-getsnapshotbeforeupdate-parameters"><h4 id="paramètres-getsnapshotbeforeupdate-parameters">Paramètres {/<em>getsnapshotbeforeupdate-parameters</em>/}</h4><ul><li><p><code>prevProps</code> : les props de votre composant avant la mise à jour. Comparez <code>prevProps</code> à <a href="#props"><code>this.props</code></a> pour déterminer ce qui a changé.<li><p><code>prevState</code> : l'état de votre composant avant la mise à jour. Comparez <code>prevState</code> à <a href="#state"><code>this.state</code></a> pour déterminer ce qui a changé.</ul></section><section class="level4"aria-labelledby="valeur-renvoyée-getsnapshotbeforeupdate-returns"><h4 id="valeur-renvoyée-getsnapshotbeforeupdate-returns">Valeur renvoyée {/<em>getsnapshotbeforeupdate-returns</em>/}</h4><p>Vous devriez renvoyer une valeur capturée de quelque type que ce soit, voire <code>null</code>. La valeur que vous renvoyez sera passée en troisième argument à <a href="#componentdidupdate"><code>componentDidUpdate</code></a>.</section><section class="level4"aria-labelledby="limitations-getsnapshotbeforeupdate-caveats"><h4 id="limitations-getsnapshotbeforeupdate-caveats">Limitations {/<em>getsnapshotbeforeupdate-caveats</em>/}</h4><ul><li><code>getSnapshotBeforeUpdate</code> ne sera pas appelée si <a href="#shouldcomponentupdate"><code>shouldComponentUpdate</code></a> est définie et renvoie <code>false</code>.</ul><note><p>Il n'y a pas encore d'équivalent direct à <code>getSnapshotBeforeUpdate</code> dans les fonctions composants. C'est un cas d'usage très rare, mais si vous en avez absolument besoin, vous devrez pour le moment écrire un composant à base de classe.</p></note></section></section><section class="level3"aria-labelledby="render-render"><h3 id="render-render"><code>render()</code> {/<em>render</em>/}</h3><p>La méthode <code>render</code> est la seule méthode obligatoire dans un composant à base de classe.<p>La méthode <code>render</code> devrait spécifier ce que vous souhaitez afficher à l'écran, par exemple :<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Component</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Salut</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span> <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>React est susceptible d'appeler <code>render</code> à tout moment, aussi vous ne devriez pas supposer son exécution à un moment particulier. En général, la méthode <code>render</code> devrait renvoyer un contenu <a href="/learn/writing-markup-with-jsx">JSX</a>, mais certains <a href="#render-returns">autres types de résultats</a> (comme les chaînes de caractères) sont autorisés. Pour calculer le JSX renvoyé, la méthode <code>render</code> peut lire <a href="#props"><code>this.props</code></a>, <a href="#state"><code>this.state</code></a> et <a href="#context"><code>this.context</code></a>.<p>Vous devriez écrire la méthode <code>render</code> sous forme de fonction pure, c'est-à-dire qu'elle devrait toujours renvoyer le même résultat si les props, l'état et le contexte n'ont pas changé. Elle ne devrait par ailleurs pas contenir d'effets de bord (tels que des souscriptions d'abonnements) ou interagir avec des API du navigateur. Les effets de bord sont censés survenir soit dans des gestionnaires d'événements, soit dans des méthodes comme<a href="#componentdidmount"><code>componentDidMount</code></a>.<section class="level4"aria-labelledby="paramètres-render-parameters"><h4 id="paramètres-render-parameters">Paramètres {/<em>render-parameters</em>/}</h4><p><code>render</code> ne prend aucun paramètre.</section><section class="level4"aria-labelledby="valeur-renvoyée-render-returns"><h4 id="valeur-renvoyée-render-returns">Valeur renvoyée {/<em>render-returns</em>/}</h4><p><code>render</code> peut renvoyer n'importe quel nœud React valide. Ça inclut les éléments React tels que <code>&#x3C;div /></code>, les chaînes de caractères, les nombres, <a href="/reference/react-dom/createPortal">les portails</a>, les nœuds vides (<code>null</code>, <code>undefined</code>, <code>true</code> et <code>false</code>) et les tableaux de nœuds React.</section><section class="level4"aria-labelledby="limitations-render-caveats"><h4 id="limitations-render-caveats">Limitations {/<em>render-caveats</em>/}</h4><ul><li><p><code>render</code> devrait être écrite comme une fonction pure des props, de l'état et du contexte. Elle ne devrait comporter aucun effet de bord.<li><p><code>render</code> ne sera pas appelée si <a href="#shouldcomponentupdate"><code>shouldComponentUpdate</code></a> est définie et renvoie <code>false</code>.</ul><ul><li>En <a href="/reference/react/StrictMode">mode strict</a>, React appellera <code>render</code> deux fois en développement et jettera un des résultats. Ça vous permet de repérer des effets de bord involontaires qui doivent être sortis de <code>render</code>.</ul><ul><li>Il n'y a pas de correspondance directe entre l'appel à <code>render</code> et les appels ultérieurs à <code>componentDidMount</code> et <code>componentDidUpdate</code>. Certains résultats d'appels à <code>render</code> sont susceptibles d'être ignorés par React lorsque ça présente un avantage.</ul></section></section><section class="level3"aria-labelledby="setstatenextstate-callback-setstate"><h3 id="setstatenextstate-callback-setstate"><code>setState(nextState, callback?)</code> {/<em>setstate</em>/}</h3><p>Appelez <code>setState</code> pour mettre à jour l'état de votre composant React.<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Form</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Clara'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">handleNameChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newName <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> newName
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleNameChange</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Salut</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p><code>setState</code> maintient une file d'attente de modifications à apporter à l'état du composant. Elle indique à React que ce composant et ses enfants doivent recalculer leur rendu avec un nouvel état. C'est le principal moyen de mettre à jour l'interface utilisateur suite à des interactions.</p><pitfall><p>Appeler <code>setState</code> <strong>ne change pas</strong> l'état actuel pour le code en cours d'exécution :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// « Clara »</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Juliette'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Toujours « Clara » !</span>
<span class="token punctuation">}</span></code></pre><p>Ça affecte uniquement ce que vaudra <code>this.state</code> à partir du <em>prochain</em> rendu.</p></pitfall><p>Vous pouvez aussi passer une fonction à <code>setState</code>. Ça vous permet de mettre à jour l'état sur base de sa valeur précédente :<pre class="language-js"><code class="language-js">  <span class="token function-variable function">handleIncreaseAge</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token parameter">prevState</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> prevState<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre><p>Vous n'êtes pas obligé·e de faire ça, mais c'est pratique lorsque vous souhaitez accumuler plusieurs mises à jour de l'état au sein d'un même événement.<section class="level4"aria-labelledby="paramètres-setstate-parameters"><h4 id="paramètres-setstate-parameters">Paramètres {/<em>setstate-parameters</em>/}</h4><ul><li><p><code>nextState</code> : soit un objet, soit une fonction.<ul><li>Si vous passez un objet comme <code>nextState</code>, il sera superficiellement fusionné dans <code>this.state</code>.<li>Si vous passez une fonction comme <code>nextState</code>, elle sera traitée comme une <em>fonction de mise à jour</em>. Elle doit être pure, doit accepter l'état en attente et les props comme arguments, et doit renvoyer un objet qui sera superficiellement fusionné dans <code>this.state</code>. React placera votre fonction de mise à jour dans une file d'attente puis refera le rendu de votre composant. Lors du prochain rendu, React calculera le prochain état en appliquant successivement toutes les fonctions de mise à jour en attente, en partant de l'état précédent.</ul><li><p><code>callback</code> <strong>optionnel</strong> : s'il est précisé, React appellera le <code>callback</code> que vous avez fourni une fois la mise à jour retranscrite dans le DOM.</ul></section><section class="level4"aria-labelledby="valeur-renvoyée-setstate-returns"><h4 id="valeur-renvoyée-setstate-returns">Valeur renvoyée {/<em>setstate-returns</em>/}</h4><p><code>setState</code> ne renvoie rien.</section><section class="level4"aria-labelledby="limitations-setstate-caveats"><h4 id="limitations-setstate-caveats">Limitations {/<em>setstate-caveats</em>/}</h4><ul><li><p>Pensez à <code>setState</code> comme à une <em>requête</em> plutôt qu'une commande de mise à jour immédiate du composant. Lorsque plusieurs composants mettent à jour leurs états en réaction à un événement, React regroupe leurs mises à jour et refait leurs rendus en une unique passe, à la fin de l'événement. Pour les rares cas où vous auriez besoin de forcer une mise à jour d'état spécifique à être appliquée de façon synchrone, vous pourriez l'enrober dans <a href="/reference/react-dom/flushSync"><code>flushSync</code></a>, mais ça gâche généralement la performance.<li><p><code>setState</code> ne met pas immédiatement à jour <code>this.state</code>. Il est donc piégeux de lire <code>this.state</code> juste après avoir appelé <code>setState</code>. Utilisez plutôt <a href="#componentdidupdate"><code>componentDidUpdate</code></a> ou l'argument <code>callback</code> de <code>setState</code>, qui vous garantissent tous les deux une exécution après que la mise à jour a été appliquée. Si vous avez besoin de mettre à jour l'état sur base de l'état précédent, vous pouvez passer une fonction pour <code>nextState</code>, comme décrit plus haut.</ul><note><p>Appeler <code>setState</code> dans les composants à base de classe est similaire à l'appel d'une <a href="/reference/react/useState#setstate">fonction <code>set</code></a> dans les fonctions composants.<p><a href="#migrating-a-component-with-state-from-a-class-to-a-function">Voyez comment migrer</a>.</p></note></section></section><section class="level3"aria-labelledby="shouldcomponentupdatenextprops-nextstate-nextcontext-shouldcomponentupdate"><h3 id="shouldcomponentupdatenextprops-nextstate-nextcontext-shouldcomponentupdate"><code>shouldComponentUpdate(nextProps, nextState, nextContext)</code> {/<em>shouldcomponentupdate</em>/}</h3><p>Si vous définissez <code>shouldComponentUpdate</code>, React l'appellera pour déterminer s'il peut éviter de calculer un nouveau rendu.<p>Si vous êtes certain·e de vouloir écrire ça vous-même, vous pouvez comparer <code>this.props</code> avec <code>nextProps</code> et <code>this.state</code> avec <code>nextState</code> et renvoyer <code>false</code> pour indiquer à React que le recalcul du rendu peut être sauté.<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">isHovered</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>
      nextProps<span class="token punctuation">.</span><span class="token property-access">position</span><span class="token punctuation">.</span><span class="token property-access">x</span> <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">position</span><span class="token punctuation">.</span><span class="token property-access">x</span> <span class="token operator">&#x26;&#x26;</span>
      nextProps<span class="token punctuation">.</span><span class="token property-access">position</span><span class="token punctuation">.</span><span class="token property-access">y</span> <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">position</span><span class="token punctuation">.</span><span class="token property-access">y</span> <span class="token operator">&#x26;&#x26;</span>
      nextProps<span class="token punctuation">.</span><span class="token property-access">size</span><span class="token punctuation">.</span><span class="token property-access">width</span> <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">size</span><span class="token punctuation">.</span><span class="token property-access">width</span> <span class="token operator">&#x26;&#x26;</span>
      nextProps<span class="token punctuation">.</span><span class="token property-access">size</span><span class="token punctuation">.</span><span class="token property-access">height</span> <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">size</span><span class="token punctuation">.</span><span class="token property-access">height</span> <span class="token operator">&#x26;&#x26;</span>
      nextState<span class="token punctuation">.</span><span class="token property-access">isHovered</span> <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">isHovered</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Rien n’a changé, un nouveau rendu est donc superflu</span>
      <span class="token keyword control-flow">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><p>React appelle <code>shouldComponentUpdate</code> avant de refaire le rendu lorsque des nouvelles props ou un nouvel état sont fournis. Ça renvoie par défaut <code>true</code>. Cette méthode n'est pas appelée pour le rendu initial, ni lorsque <a href="#forceupdate"><code>forceUpdate</code></a> est utilisée.<section class="level4"aria-labelledby="paramètres-shouldcomponentupdate-parameters"><h4 id="paramètres-shouldcomponentupdate-parameters">Paramètres {/<em>shouldcomponentupdate-parameters</em>/}</h4><ul><li><code>nextProps</code> : les prochaines props pour le rendu à venir. Comparez <code>nextProps</code> à <a href="#props"><code>this.props</code></a> pour déterminer ce qui a changé.<li><code>nextState</code> : le prochain état pour le rendu à venir. Comparez <code>nextState</code> à <a href="#state"><code>this.state</code></a> pour déterminer ce qui a changé.<li><code>nextContext</code> : le prochain contexte pour le rendu à venir. Comparez <code>nextContext</code> à <a href="#state"><code>this.context</code></a> pour déterminer ce qui a changé. N'est disponible que si vous avez spécifié <a href="#static-contexttype"><code>static contextType</code></a> (approche plus récente) ou <a href="#static-contexttypes"><code>static contextTypes</code></a> (approche dépréciée).</ul></section><section class="level4"aria-labelledby="valeur-renvoyée-shouldcomponentupdate-returns"><h4 id="valeur-renvoyée-shouldcomponentupdate-returns">Valeur renvoyée {/<em>shouldcomponentupdate-returns</em>/}</h4><p>Renvoie <code>true</code> si vous souhaitez que le composant refasse son rendu. C'est le comportement par défaut.<p>Renvoie <code>false</code> pour indiquer à React de sauter le recalcul du rendu.</section><section class="level4"aria-labelledby="limitations-shouldcomponentupdate-caveats"><h4 id="limitations-shouldcomponentupdate-caveats">Limitations {/<em>shouldcomponentupdate-caveats</em>/}</h4><ul><li><p>Cette méthode existe <em>seulement</em> comme une optimisation des performances. Si votre composant ne fonctionne pas sans elle, corrigez-le d'abord.<li><p>Envisagez de recourir à <a href="/reference/react/PureComponent"><code>PureComponent</code></a> plutôt que d'écrire <code>shouldComponentUpdate</code> à la main. <code>PureComponent</code> fait une comparaison superficielle des props et de l'état, et réduit le risque de sauter une mise à jour utile.<li><p>Nous vous déconseillons de faire des comparaisons profondes ou d'utiliser <code>JSON.stringify</code> dans <code>shouldComponentUpdate</code>. Ça rend la performance imprévisible et dépendante des structures de données de chaque prop et élément d'état. Au meilleur des cas, vous risquez d'introduire des gels de plusieurs secondes dans votre appli, au pire cas de la faire carrément planter.<li><p>Renvoyer <code>false</code> n'empêche pas vos composants enfants de refaire leurs calculs si <em>leurs</em> données changent.<li><p>Renvoyer <code>false</code> ne <em>garantit</em> pas que le composant sautera son rendu. React se servira de votre valeur renvoyée comme d'un conseil, mais reste susceptible d'opter pour un recalcul du rendu si ça lui semble par ailleurs justifié.</ul><note><p>L'optimisation des composants à base de classes avec <code>shouldComponentUpdate</code> est similaire à l'optimisation des fonctions composants avec <a href="/reference/react/memo"><code>memo</code></a>. Les fonctions composants proposent aussi des optimisations plus granulaires avec<a href="/reference/react/useMemo"><code>useMemo</code></a>.</p></note></section></section><section class="level3"aria-labelledby="unsafe_componentwillmount-unsafe_componentwillmount"><h3 id="unsafe_componentwillmount-unsafe_componentwillmount"><code>UNSAFE_componentWillMount()</code> {/<em>unsafe_componentwillmount</em>/}</h3><p>Si vous définissez <code>UNSAFE_componentWillMount</code>, React l'appellera immédiatement après le <a href="#constructor"><code>constructor</code></a>. Cette méthode n'existe plus que pour des raisons historiques et ne devrait pas être utilisée dans du nouveau code. Utilisez plutôt l'une de ces alternatives :<ul><li>Pour initialiser l'état, déclarez un champ d'instance <a href="#state"><code>state</code></a> ou affectez <code>this.state</code> dans le <a href="#constructor"><code>constructor</code></a>.<li>Si vous avez besoin d'exécuter un effet de bord ou de souscrire un abonnement, déplacez plutôt cette logique dans <a href="#componentdidmount"><code>componentDidMount</code></a>.</ul><p><a href="https://legacy.reactjs.org/blog/2018/03/27/update-on-async-rendering.html#examples">Consultez des exemples de migration des méthodes historiques de cycle de vie</a>.<section class="level4"aria-labelledby="paramètres-unsafe_componentwillmount-parameters"><h4 id="paramètres-unsafe_componentwillmount-parameters">Paramètres {/<em>unsafe_componentwillmount-parameters</em>/}</h4><p><code>UNSAFE_componentWillMount</code> ne prend aucun paramètre.</section><section class="level4"aria-labelledby="valeur-renvoyée-unsafe_componentwillmount-returns"><h4 id="valeur-renvoyée-unsafe_componentwillmount-returns">Valeur renvoyée {/<em>unsafe_componentwillmount-returns</em>/}</h4><p><code>UNSAFE_componentWillMount</code> ne devrait rien renvoyer.</section><section class="level4"aria-labelledby="limitations-unsafe_componentwillmount-caveats"><h4 id="limitations-unsafe_componentwillmount-caveats">Limitations {/<em>unsafe_componentwillmount-caveats</em>/}</h4><ul><li><p><code>UNSAFE_componentWillMount</code> ne sera pas appelée si le composant implémente <a href="#static-getderivedstatefromprops"><code>static getDerivedStateFromProps</code></a> ou <a href="#getsnapshotbeforeupdate"><code>getSnapshotBeforeUpdate</code></a>.<li><p>En dépit de son nom, <code>UNSAFE_componentWillMount</code> ne garantit pas que le composant <em>sera effectivement monté</em> si votre appli utilise des fonctionnalités modernes de React telles que <a href="/reference/react/Suspense"><code>Suspense</code></a>. Si une tentative de rendu suspend (en raison par exemple d'un code de composant enfant qui ne serait pas encore chargé), React jettera l'arborescence en cours et essaiera de reconstruire le composant de zéro lors de la prochaine tentative. C'est pourquoi cette méthode n'est « pas fiable » <em>(“unsafe”, NdT)</em>. Tout code qui se base sur le montage (comme la souscription d'un abonnement) devrait être placé dans <a href="#componentdidmount"><code>componentDidMount</code></a>.<li><p><code>UNSAFE_componentWillMount</code> est la seule méthode de cycle de vie qui est exécutée lors d'un <a href="/reference/react-dom/server">rendu côté serveur</a>. Son déclenchement est en pratique identique à celui de <a href="#constructor"><code>constructor</code></a>, vous devriez donc plutôt utiliser <code>constructor</code> pour ce type de logique.</ul><note><p>Appeler <a href="#setstate"><code>setState</code></a> dans <code>UNSAFE_componentWillMount</code> au sein d'un composant à base de classe, afin d'initialiser l'état du composant, est équivalent au passage de cet état comme état initial à <a href="/reference/react/useState"><code>useState</code></a> dans une fonction composant.</p></note></section></section><section class="level3"aria-labelledby="unsafe_componentwillreceivepropsnextprops-nextcontext-unsafe_componentwillreceiveprops"><h3 id="unsafe_componentwillreceivepropsnextprops-nextcontext-unsafe_componentwillreceiveprops"><code>UNSAFE_componentWillReceiveProps(nextProps, nextContext)</code> {/<em>unsafe_componentwillreceiveprops</em>/}</h3><p>Si vous définissez <code>UNSAFE_componentWillReceiveProps</code>, React l'appellera lorsque le composant recevra des nouvelles props. Cette méthode n'existe plus que pour des raisons historiques et ne devrait pas être utilisée dans du nouveau code. Utilisez plutôt l'une de ces alternatives :<ul><li>Si vous avez besoin <strong>d'exécuter un effet de bord</strong> (par exemple charger des données, dérouler une animation ou réinitialiser un abonnement) en réaction à des changements de props, déplacez plutôt cette logique dans <a href="#componentdidupdate"><code>componentDidUpdate</code></a>.<li>Si vous souhaitez <strong>ne recalculer certaines données que lorsque certaines props changent</strong>, utilisez plutôt un <a href="https://legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#what-about-memoization">utilitaire de mémoïsation</a>.<li>Si vous essayez de <strong>« réinitialiser » tout l'état quand une prop change</strong>, envisagez de plutôt faire un composant soit <a href="https://legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#recommendation-fully-controlled-component">pleinement contrôlé</a> soit <a href="https://legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#recommendation-fully-uncontrolled-component-with-a-key">pleinement non contrôlé mais avec une clé</a>.<li>Si vous avez besoin <strong>« d'ajuster » une partie de l'état quand une prop change</strong>, voyez si vous ne pouvez pas plutôt calculer toutes les infos nécessaires à partir des props seules lors du rendu. Si ce n'est pas possible, préférez <a href="/reference/react/Component#static-getderivedstatefromprops"><code>static getDerivedStateFromProps</code></a>.</ul><p><a href="https://legacy.reactjs.org/blog/2018/03/27/update-on-async-rendering.html#updating-state-based-on-props">Consultez des exemples de migration des méthodes historiques de cycle de vie</a>.<section class="level4"aria-labelledby="paramètres-unsafe_componentwillreceiveprops-parameters"><h4 id="paramètres-unsafe_componentwillreceiveprops-parameters">Paramètres {/<em>unsafe_componentwillreceiveprops-parameters</em>/}</h4><ul><li><code>nextProps</code> : les prochaines props que le composant va recevoir de son composant parent. Comparez <code>nextProps</code> à <a href="#props"><code>this.props</code></a> pour déterminer ce qui a changé.<li><code>nextContext</code> : le prochain contexte que le composant va recevoir de son plus proche fournisseur de contexte. Comparez <code>nextContext</code> à <a href="#state"><code>this.context</code></a> pour déterminer ce qui a changé. N'est disponible que si vous avez par ailleurs spécifié <a href="#static-contexttype"><code>static contextType</code></a> (approche plus récente) ou <a href="#static-contexttypes"><code>static contextTypes</code></a> (approche dépréciée).</ul></section><section class="level4"aria-labelledby="valeur-renvoyée-unsafe_componentwillreceiveprops-returns"><h4 id="valeur-renvoyée-unsafe_componentwillreceiveprops-returns">Valeur renvoyée {/<em>unsafe_componentwillreceiveprops-returns</em>/}</h4><p><code>UNSAFE_componentWillReceiveProps</code> ne devrait rien renvoyer.</section><section class="level4"aria-labelledby="limitations-unsafe_componentwillreceiveprops-caveats"><h4 id="limitations-unsafe_componentwillreceiveprops-caveats">Limitations {/<em>unsafe_componentwillreceiveprops-caveats</em>/}</h4><ul><li><p><code>UNSAFE_componentWillReceiveProps</code> ne sera pas appelée si le composant implémente <a href="#static-getderivedstatefromprops"><code>static getDerivedStateFromProps</code></a> ou <a href="#getsnapshotbeforeupdate"><code>getSnapshotBeforeUpdate</code></a>.<li><p>En dépit de son nom, <code>UNSAFE_componentWillReceiveProps</code> ne garantit pas que le composant <em>recevra effectivement ces props</em> si votre appli utilise des fonctionnalités modernes de React telles que <a href="/reference/react/Suspense"><code>Suspense</code></a>. Si une tentative de rendu suspend (en raison par exemple d'un code de composant enfant qui ne serait pas encore chargé), React jettera l'arborescence en cours et essaiera de reconstruire le composant de zéro lors de la prochaine tentative. D'ici là, les props pourraient avoir encore changé. C'est pourquoi cette méthode n'est « pas fiable » <em>(“unsafe”, NdT)</em>. Tout code qui ne devrait être exécuté que pour des mises à jour confirmées (comme la réinitialisation d'un abonnement) devrait être placé dans <a href="#componentdidupdate"><code>componentDidUpdate</code></a>.<li><p><code>UNSAFE_componentWillReceiveProps</code> n'implique pas que le composant recevra des props <em>différentes</em> de la fois précédente. Vous devez comparer <code>nextProps</code> avec <code>this.props</code> vous-même pour vérifier que quelque chose a changé.<li><p>React n'appelle pas <code>UNSAFE_componentWillReceiveProps</code> avec les props initiales lors du montage. Il n'appelle cette méthode que si tout ou partie des props du composant vont être mises à jour. Par exemple, un appel à <a href="#setstate"><code>setState</code></a> ne déclenche généralement pas <code>UNSAFE_componentWillReceiveProps</code> au sein du même composant.</ul><note><p>Appeler <a href="#setstate"><code>setState</code></a> dans <code>UNSAFE_componentWillReceiveProps</code> pour « ajuster » l'état au sein d'un composant à base de classe est équivalent à <a href="/reference/react/useState#storing-information-from-previous-renders">l'appel d'une fonction <code>set</code> fournie par <code>useState</code> lors du rendu</a> dans une fonction composant.</p></note></section></section><section class="level3"aria-labelledby="unsafe_componentwillupdatenextprops-nextstate-unsafe_componentwillupdate"><h3 id="unsafe_componentwillupdatenextprops-nextstate-unsafe_componentwillupdate"><code>UNSAFE_componentWillUpdate(nextProps, nextState)</code> {/<em>unsafe_componentwillupdate</em>/}</h3><p>Si vous définissez <code>UNSAFE_componentWillUpdate</code>, React l'appellera avant de refaire un rendu avec les nouvelles props et le nouvel état. Cette méthode n'existe plus que pour des raisons historiques et ne devrait pas être utilisée dans du nouveau code. Utilisez plutôt l'une de ces alternatives :<ul><li>Si vous avez besoin d'exécuter un effet de bord (par exemple charger des données, dérouler une animation ou réinitialiser un abonnement) en réaction à des changements de props ou d'état, déplacez plutôt cette logique dans <a href="#componentdidupdate"><code>componentDidUpdate</code></a>.<li>Si vous avez besoin de lire des informations depuis le DOM (par exemple la position de défilement) pour l'utiliser ensuite dans <a href="#componentdidupdate"><code>componentDidUpdate</code></a>, lisez-la plutôt dans <a href="#getsnapshotbeforeupdate"><code>getSnapshotBeforeUpdate</code></a>.</ul><p><a href="https://legacy.reactjs.org/blog/2018/03/27/update-on-async-rendering.html#examples">Consultez des exemples de migration des méthodes historiques de cycle de vie</a>.<section class="level4"aria-labelledby="paramètres-unsafe_componentwillupdate-parameters"><h4 id="paramètres-unsafe_componentwillupdate-parameters">Paramètres {/<em>unsafe_componentwillupdate-parameters</em>/}</h4><ul><li><code>nextProps</code> : les prochaines props de votre composant pour le rendu à venir. Comparez <code>nextProps</code> à <a href="#props"><code>this.props</code></a> pour déterminer ce qui a changé.<li><code>nextState</code> : le prochain état de votre composant pour le rendu à venir. Comparez <code>nextState</code> à <a href="#state"><code>this.state</code></a> pour déterminer ce qui a changé.</ul></section><section class="level4"aria-labelledby="valeur-renvoyée-unsafe_componentwillupdate-returns"><h4 id="valeur-renvoyée-unsafe_componentwillupdate-returns">Valeur renvoyée {/<em>unsafe_componentwillupdate-returns</em>/}</h4><p><code>UNSAFE_componentWillUpdate</code> ne devrait rien renvoyer.</section><section class="level4"aria-labelledby="limitations-unsafe_componentwillupdate-caveats"><h4 id="limitations-unsafe_componentwillupdate-caveats">Limitations {/<em>unsafe_componentwillupdate-caveats</em>/}</h4><ul><li><p><code>UNSAFE_componentWillUpdate</code> ne sera pas appelée si <a href="#shouldcomponentupdate"><code>shouldComponentUpdate</code></a> est définie et renvoie <code>false</code>.<li><p><code>UNSAFE_componentWillUpdate</code> ne sera pas appelée si le composant implémente <a href="#static-getderivedstatefromprops"><code>static getDerivedStateFromProps</code></a> ou <a href="#getsnapshotbeforeupdate"><code>getSnapshotBeforeUpdate</code></a>.<li><p>Il est interdit d'appeler <a href="#setstate"><code>setState</code></a> (ou toute méthode entraînant un appel à <code>setState</code>, tel que le <em>dispatch</em> d'une action Redux) au sein de <code>componentWillUpdate</code>.<li><p>En dépit de son nom, <code>UNSAFE_componentWillUpdate</code> ne garantit pas que le composant <em>sera effectivement mis à jour</em> si votre appli utilise des fonctionnalités modernes de React telles que <a href="/reference/react/Suspense"><code>Suspense</code></a>. Si une tentative de rendu suspend (en raison par exemple d'un code de composant enfant qui ne serait pas encore chargé), React jettera l'arborescence en cours et essaiera de reconstruire le composant de zéro lors de la prochaine tentative. D'ici là, les props ou l'état pourraient avoir encore changé. C'est pourquoi cette méthode n'est « pas fiable » <em>(“unsafe”, NdT)</em>. Tout code qui ne devrait être exécuté que pour des mises à jour confirmées (comme la réinitialisation d'un abonnement) devrait être placé dans <a href="#componentdidupdate"><code>componentDidUpdate</code></a>.<li><p><code>UNSAFE_componentWillUpdate</code> n'implique pas que le composant recevra des props ou un état <em>différents</em> de la fois précédente. Vous devez comparer vous-même <code>nextProps</code> avec <code>this.props</code> et <code>nextState</code> avec <code>this.state</code> pour vérifier que quelque chose a changé.<li><p>React n'appellera pas <code>UNSAFE_componentWillUpdate</code> avec les props et état initiaux lors du montage.</ul><note><p>Il n'y a pas d'équivalent direct à <code>UNSAFE_componentWillUpdate</code> dans les fonctions composants.</p></note></section></section><section class="level3"aria-labelledby="static-childcontexttypes-static-childcontexttypes"><h3 id="static-childcontexttypes-static-childcontexttypes"><code>static childContextTypes</code> {/<em>static-childcontexttypes</em>/}</h3><deprecated><p>Cette API sera retirée d'une future version majeure de React. <a href="#static-contexttype">Utilisez plutôt <code>static contextType</code></a>.</p></deprecated><p>Vous permet de spécifier quel <a href="https://legacy.reactjs.org/docs/legacy-context.html">contexte historique</a> est fourni par ce composant.</section><section class="level3"aria-labelledby="static-contexttypes-static-contexttypes"><h3 id="static-contexttypes-static-contexttypes"><code>static contextTypes</code> {/<em>static-contexttypes</em>/}</h3><deprecated><p>Cette API sera retirée d'une future version majeure de React. <a href="#static-contexttype">Utilisez plutôt <code>static contextType</code></a>.</p></deprecated><p>Vous permet de spécifier quel <a href="https://legacy.reactjs.org/docs/legacy-context.html">contexte historique</a> est consommé par ce composant.</section><section class="level3"aria-labelledby="static-contexttype-static-contexttype"><h3 id="static-contexttype-static-contexttype"><code>static contextType</code> {/<em>static-contexttype</em>/}</h3><p>Si vous souhaitez lire <a href="#context-instance-field"><code>this.context</code></a> dans votre composant à base de classe, vous devez spécifier le contexte que vous souhaitez lire. Le contexte que vous spécifiez comme <code>static contextType</code> doit être une valeur créée auparavant par<a href="/reference/react/createContext"><code>createContext</code></a>.<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> contextType <span class="token operator">=</span> <span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">context</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> className <span class="token operator">=</span> <span class="token string">'button-'</span> <span class="token operator">+</span> theme<span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>button className<span class="token operator">=</span><span class="token punctuation">{</span>className<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><note><p>La lecture de <code>this.context</code> dans les composants à base de classes est équivalente à <a href="/reference/react/useContext"><code>useContext</code></a> dans les fonctions composants.<p><a href="#migrating-a-component-with-context-from-a-class-to-a-function">Voyez comment migrer</a>.</p></note></section><section class="level3"aria-labelledby="static-defaultprops-static-defaultprops"><h3 id="static-defaultprops-static-defaultprops"><code>static defaultProps</code> {/<em>static-defaultprops</em>/}</h3><p>Vous pouvez définir <code>static defaultProps</code> pour fournir des valeurs par défaut aux props de la classe. Elles seront utilisées pour les props manquantes ou valant <code>undefined</code>, mais pas pour les props valant <code>null</code>.<p>Voici par exemple comment définir une prop <code>color</code> qui devrait valoir <code>'blue'</code> par défaut :<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'blue'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>button className<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">color</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Cliquez</span> ici<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Si la prop <code>color</code> n'est pas fournie ou est à <code>undefined</code>, elle sera mise par défaut à <code>'blue'</code> :<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token operator">></span>
  <span class="token punctuation">{</span><span class="token comment">/* this.props.color vaudra "blue" */</span><span class="token punctuation">}</span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Button</span> <span class="token operator">/</span><span class="token operator">></span>

  <span class="token punctuation">{</span><span class="token comment">/* this.props.color vaudra "blue" */</span><span class="token punctuation">}</span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Button</span> color<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword nil">undefined</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>

  <span class="token punctuation">{</span><span class="token comment">/* this.props.color vaudra null */</span><span class="token punctuation">}</span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Button</span> color<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword null nil">null</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>

  <span class="token punctuation">{</span><span class="token comment">/* this.props.color vaudra "red" */</span><span class="token punctuation">}</span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Button</span> color<span class="token operator">=</span><span class="token string">"red"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span></code></pre><note><p>La définition de <code>defaultProps</code> dans les composants à base de classes est équivalente à l'utilisation de <a href="/learn/passing-props-to-a-component#specifying-a-default-value-for-a-prop">valeurs par défaut</a> dans les fonctions composants.</p></note></section><section class="level3"aria-labelledby="static-proptypes-static-proptypes"><h3 id="static-proptypes-static-proptypes"><code>static propTypes</code> {/<em>static-proptypes</em>/}</h3><p>Vous pouvez définir <code>static propTypes</code> en utilisant le module<a href="https://www.npmjs.com/package/prop-types"><code>prop-types</code></a> pour déclarer les types des props acceptées par votre composant. Ces types seront vérifiés lors du rendu en développement uniquement.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">PropTypes</span></span> <span class="token keyword module">from</span> <span class="token string">'prop-types'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token maybe-class-name">PropTypes</span><span class="token punctuation">.</span><span class="token property-access">string</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Salut</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><note><p>Nous vous conseillons d'utiliser <a href="/learn/typescript">TypeScript</a> plutôt que de vérifier vos types de props à l'exécution.</p></note></section><section class="level3"aria-labelledby="static-getderivedstatefromerrorerror-static-getderivedstatefromerror"><h3 id="static-getderivedstatefromerrorerror-static-getderivedstatefromerror"><code>static getDerivedStateFromError(error)</code> {/<em>static-getderivedstatefromerror</em>/}</h3><p>Si vous définissez <code>static getDerivedStateFromError</code>, React l'appellera lorsqu'un composant descendant lèvera une erreur pendant le rendu. Ça vous permet d'afficher un message d'erreur plutôt que d'aboutir à une UI vide.<p>Elle est en général utilisée conjointement avec <a href="#componentdidcatch"><code>componentDidCatch</code></a>, qui vous permet par exemple d'envoyer un rapport d'erreur à un service de supervision. Un composant doté de ces méthodes est ce qu'on appelle un <em>périmètre d'erreur</em>.<p><a href="#catching-rendering-errors-with-an-error-boundary">Voir un exemple</a>.<section class="level4"aria-labelledby="paramètres-static-getderivedstatefromerror-parameters"><h4 id="paramètres-static-getderivedstatefromerror-parameters">Paramètres {/<em>static-getderivedstatefromerror-parameters</em>/}</h4><ul><li><code>error</code> : l'erreur qui a été levée. En pratique il s'agira généralement d'une instance d'<a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Error"><code>Error</code></a>, mais ce n'est pas garanti parce que JavaScript autorise un <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Statements/throw"><code>throw</code></a> de n'importe quelle valeur, y compris des chaînes de caractères et même <code>null</code>.</ul></section><section class="level4"aria-labelledby="valeur-renvoyée-static-getderivedstatefromerror-returns"><h4 id="valeur-renvoyée-static-getderivedstatefromerror-returns">Valeur renvoyée {/<em>static-getderivedstatefromerror-returns</em>/}</h4><p><code>static getDerivedStateFromError</code> devrait renvoyer un objet d'état indiquant au composant d'afficher un message d'erreur.</section><section class="level4"aria-labelledby="limitations-static-getderivedstatefromerror-caveats"><h4 id="limitations-static-getderivedstatefromerror-caveats">Limitations {/<em>static-getderivedstatefromerror-caveats</em>/}</h4><ul><li><code>static getDerivedStateFromError</code> devrait être une fonction pure. Si vous souhaiter exécuter un effet de bord (comme par exemple un signalement à un service de supervision), vous devez aussi implémenter la méthode <a href="#componentdidcatch"><code>componentDidCatch</code></a>.</ul><note><p>Il n'y a pas encore d'équivalent direct à <code>static getDerivedStateFromError</code> dans les fonctions composants. Si vous souhaitez éviter de créer des composants à base de classes, écrivez un unique composant <code>ErrorBoundary</code> comme ci-dessus et utilisez-le dans toute votre appli. Vous pouvez aussi utiliser le module <a href="https://github.com/bvaughn/react-error-boundary"><code>react-error-boundary</code></a> qui fait ça (et davantage) pour vous.</p></note></section></section><section class="level3"aria-labelledby="static-getderivedstatefrompropsprops-state-static-getderivedstatefromprops"><h3 id="static-getderivedstatefrompropsprops-state-static-getderivedstatefromprops"><code>static getDerivedStateFromProps(props, state)</code> {/<em>static-getderivedstatefromprops</em>/}</h3><p>Si vous définissez <code>static getDerivedStateFromProps</code>, React l'appellera juste avant d'appeler <a href="#render"><code>render</code></a>, tant au montage initial que lors des mises à jour ultérieures. Elle devrait renvoyer un objet de mise à jour de l'état, ou <code>null</code> pour ne faire aucune mise à jour.<p>Cette méthode existe pour <a href="https://legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#when-to-use-derived-state">les rares cas d'usage</a> où l'état dépend de changements de props au fil du temps. Par exemple, le composant <code>Form</code> ci-dessous réinitialise son état <code>email</code> lorsque la prop <code>userID</code> change :<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Form</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">defaultEmail</span><span class="token punctuation">,</span>
    <span class="token literal-property property">prevUserID</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">userID</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Dès que l’utilisateur actif change, réinitialise</span>
    <span class="token comment">// les parties de l’état liées à cet utilisateur.</span>
    <span class="token comment">// Dans cet exemple simple, il s’agit juste de l’e-mail.</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token property-access">userID</span> <span class="token operator">!==</span> state<span class="token punctuation">.</span><span class="token property-access">prevUserID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">prevUserID</span><span class="token operator">:</span> props<span class="token punctuation">.</span><span class="token property-access">userID</span><span class="token punctuation">,</span>
        <span class="token literal-property property">email</span><span class="token operator">:</span> props<span class="token punctuation">.</span><span class="token property-access">defaultEmail</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Remarquez que cette approche requiert la conservation de la valeur précédente de la prop (comme <code>userID</code>) dans l'état (comme ici <code>prevUserID</code>).</p><pitfall><p>Dériver ainsi l'état conduit à du code verbeux et rend difficile la compréhension de vos composants. <a href="https://legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html">Assurez-vous de bien connaître les alternatives plus simples</a> :<ul><li>Si vous avez besoin <strong>d'exécuter un effet de bord</strong> (par exemple charger des données ou dérouler une animation) en réaction à un changement de prop, utilisez plutôt la méthode <a href="#componentdidupdate"><code>componentDidUpdate</code></a>.<li>Si vous souhaitez <strong>ne recalculer certaines données que lorsque certaines props changent</strong>, utilisez plutôt un <a href="https://legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#what-about-memoization">utilitaire de mémoïsation</a>.<li>Si vous essayez de <strong>« réinitialiser » tout l'état quand une prop change</strong>, envisagez de plutôt faire un composant soit <a href="https://legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#recommendation-fully-controlled-component">pleinement contrôlé</a> soit <a href="https://legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#recommendation-fully-uncontrolled-component-with-a-key">pleinement non contrôlé mais avec une clé</a>.</ul></pitfall><section class="level4"aria-labelledby="paramètres-static-getderivedstatefromprops-parameters"><h4 id="paramètres-static-getderivedstatefromprops-parameters">Paramètres {/<em>static-getderivedstatefromprops-parameters</em>/}</h4><ul><li><code>props</code> : les prochaines props pour le rendu à venir.<li><code>state</code> : le prochain état pour le rendu à venir.</ul></section><section class="level4"aria-labelledby="valeur-renvoyée-static-getderivedstatefromprops-returns"><h4 id="valeur-renvoyée-static-getderivedstatefromprops-returns">Valeur renvoyée {/<em>static-getderivedstatefromprops-returns</em>/}</h4><p><code>static getDerivedStateFromProps</code> renvoie un objet utilisé pour mettre à jour l'état, ou <code>null</code> pour ne rien mettre à jour.</section><section class="level4"aria-labelledby="limitations-static-getderivedstatefromprops-caveats"><h4 id="limitations-static-getderivedstatefromprops-caveats">Limitations {/<em>static-getderivedstatefromprops-caveats</em>/}</h4><ul><li><p>Cette méthode est déclenchée à <em>chaque</em> rendu, peu en importe la raison. Ce n'est pas comme <a href="#unsafe_cmoponentwillreceiveprops"><code>UNSAFE_componentWillReceiveProps</code></a>, qui elle ne serait déclenchée que lorsque le parent entraîne un nouveau rendu, mais pas suite à un <code>setState</code> local.<li><p>Cette méthode n'a pas accès à l'instance du composant. Si vous le souhaitez, vous pouvez réutiliser du code entre <code>static getDerivedStateFromProps</code> et les autres méthodes de la classe en extrayant des fonctions pures basées sur les props et l'état du composant, que vous placeriez hors de la définition de la classe.</ul><note><p>L'implémentation de la méthode <code>static getDerivedStateFromProps</code> dans un composant à base de classe est équivalente à <a href="/reference/react/useState#storing-information-from-previous-renders">l'appel d'une fonction <code>set</code> fournie par <code>useState</code> lors du rendu</a> dans une fonction composant.</p></note></section></section></section><section class="level2"aria-labelledby="utilisation-usage"><h2 id="utilisation-usage">Utilisation {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="définir-un-composant-à-base-de-classe-defining-a-class-component"><h3 id="définir-un-composant-à-base-de-classe-defining-a-class-component">Définir un composant à base de classe {/<em>defining-a-class-component</em>/}</h3><p>Pour définir un composant React sous forme de classe, étendez la classe <code>Component</code> fournie par React et définissez sa <a href="#render">méthode <code>render</code></a> :<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Component</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Salut</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span> <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>React appellera votre méthode <a href="#render"><code>render</code></a> dès qu'il doit déterminer quoi afficher à l'écran. Vous y renverrez en général du <a href="/learn/writing-markup-with-jsx">JSX</a>. Votre méthode <code>render</code> devrait être une <a href="https://fr.wikipedia.org/wiki/Fonction_pure">fonction pure</a> : elle devrait se limiter à calculer le JSX.<p>Tout comme les <a href="/learn/your-first-component#defining-a-component">fonctions composants</a>, un composant à base de classe peut <a href="/learn/your-first-component#defining-a-component">recevoir des informations <em>via</em> ses props</a> depuis son composant parent. En revanche, la syntaxe de consultation des props est différente. Si par exemple le composant parent fait le rendu de <code>&#x3C;Greeting name="Clara" /></code>, vous pourrez lire la prop <code>name</code> depuis <a href="#props"><code>this.props</code></a>, en utilisant <code>this.props.name</code> :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Component</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Salut</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span> <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Greeting</span> name<span class="token operator">=</span><span class="token string">"Laure"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Greeting</span> name<span class="token operator">=</span><span class="token string">"Marie"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Greeting</span> name<span class="token operator">=</span><span class="token string">"Nina"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>Remarquez que les Hooks (des fonctions dont le nom commence par <code>use</code>, telles que <a href="/reference/react/useState"><code>useState</code></a>) ne sont pas pris en charge par les composants à base de classes.</p><pitfall><p>Nous vous conseillons de définir vos composants au moyen de fonctions plutôt que de classes. <a href="#migrating-a-simple-component-from-a-class-to-a-function">Voyez comment migrer</a>.</p></pitfall></section><section class="level3"aria-labelledby="ajouter-de-létat-à-un-composant-à-base-de-classe-adding-state-to-a-class-component"><h3 id="ajouter-de-létat-à-un-composant-à-base-de-classe-adding-state-to-a-class-component">Ajouter de l'état à un composant à base de classe {/<em>adding-state-to-a-class-component</em>/}</h3><p>Pour ajouter un <a href="/learn/state-a-components-memory">état</a> à une classe, affectez un objet à la propriété <a href="#state"><code>state</code></a>. Pour mettre à jour l'état, appelez <a href="#setstate"><code>this.setState</code></a>.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Component</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Clara'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">handleNameChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">handleAgeChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleNameChange</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleAgeChange</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Prendre</span> de l’âge
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Salut</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">Vous</span></span> avez <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">}</span> ans<span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><pitfall><p>Nous vous conseillons de définir vos composants au moyen de fonctions plutôt que de classes. <a href="#migrating-a-component-with-state-from-a-class-to-a-function">Voyez comment migrer</a>.</p></pitfall></section><section class="level3"aria-labelledby="ajouter-des-méthodes-de-cycle-de-vie-à-un-composant-à-base-de-classe-adding-lifecycle-methods-to-a-class-component"><h3 id="ajouter-des-méthodes-de-cycle-de-vie-à-un-composant-à-base-de-classe-adding-lifecycle-methods-to-a-class-component">Ajouter des méthodes de cycle de vie à un composant à base de classe {/<em>adding-lifecycle-methods-to-a-class-component</em>/}</h3><p>Il existe plusieurs méthodes spéciales que vous pouvez définir sur votre classe.<p>Si vous définissez la méthode <a href="#componentdidmount"><code>componentDidMount</code></a>, React l'appellera quand votre composant aura été ajouté au DOM (<em>monté</em>). React appellera <a href="#componentdidupdate"><code>componentDidUpdate</code></a> après que votre composant aura refait son rendu en raison de props ou d'un état modifiés. React appellera <a href="#componentwillunmount"><code>componentWillUnmount</code></a> juste avant que votre composant ne soit retiré du DOM (<em>démonté</em>).<p>Si vous implémentez <code>componentDidMount</code>, vous aurez généralement besoin d'implémenter ces trois méthodes de cycle de vie pour éviter les bugs. Si par exemple <code>componentDidMount</code> lit un état ou des props, vous devrez également implémenter <code>componentDidUpdate</code> pour en gérer les évolutions, ainsi que <code>componentWillUnmount</code> pour nettoyer toute mise en place effectuée dans <code>componentDidMount</code>.<p>Par exemple, ce composant <code>ChatRoom</code> conserve une connexion au salon de discussion synchronisée avec les props et l'état :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ChatRoom</span></span> <span class="token keyword module">from</span> <span class="token string">'./ChatRoom.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'general'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>show<span class="token punctuation">,</span> setShow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token maybe-class-name">Choisissez</span> votre salon de discussion <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"general"</span><span class="token operator">></span>général<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"travel"</span><span class="token operator">></span>voyage<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"music"</span><span class="token operator">></span>musique<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setShow</span><span class="token punctuation">(</span><span class="token operator">!</span>show<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token punctuation">{</span>show <span class="token operator">?</span> <span class="token string">'Fermer le salon'</span> <span class="token operator">:</span> <span class="token string">'Ouvrir le salon'</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>show <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span>
      <span class="token punctuation">{</span>show <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span> roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Component</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">class</span> <span class="token class-name">ChatRoom</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> <span class="token string">'https://localhost:1234'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setupConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">roomId</span> <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span><span class="token property-access">roomId</span> <span class="token operator">||</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">serverUrl</span> <span class="token operator">!==</span> prevState<span class="token punctuation">.</span><span class="token property-access">serverUrl</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">destroyConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setupConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">destroyConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">setupConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">connection</span> <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">serverUrl</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">roomId</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">connection</span><span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">destroyConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">connection</span><span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">connection</span> <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
          <span class="token constant">URL</span> du serveur <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
          <span class="token operator">&#x3C;</span>input
            value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">serverUrl</span><span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Bienvenue</span> dans le salon <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">roomId</span><span class="token punctuation">}</span> <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter">serverUrl<span class="token punctuation">,</span> roomId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Une véritable implémentation se connecterait en vrai au serveur</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'✅ Connexion au salon « '</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">' » sur '</span> <span class="token operator">+</span> serverUrl <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'❌ Déconnexion du salon « '</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">' » sur '</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>Remarquez qu'en développement et lorsque le <a href="/reference/react/StrictMode">mode strict</a> est actif, React appellera <code>componentDidMount</code>, puis appellera immédiatement <code>componentWillUnmount</code> et rappellera <code>componentDidMount</code> une seconde fois. Ça vous aide à remarquer un oubli d'implémentation de <code>componentWillUnmount</code>, ou un « miroir » insuffisant dans celle-ci de la logique de <code>componentDidMount</code>.</p><pitfall><p>Nous vous conseillons de définir vos composants au moyen de fonctions plutôt que de classes. <a href="#migrating-a-component-with-lifecycle-methods-from-a-class-to-a-function">Voyez comment migrer</a>.</p></pitfall></section><section class="level3"aria-labelledby="capturer-les-erreurs-de-rendu-avec-un-périmètre-derreur-catching-rendering-errors-with-an-error-boundary"><h3 id="capturer-les-erreurs-de-rendu-avec-un-périmètre-derreur-catching-rendering-errors-with-an-error-boundary">Capturer les erreurs de rendu avec un périmètre d'erreur {/<em>catching-rendering-errors-with-an-error-boundary</em>/}</h3><p>Par défaut, si votre application lève une erreur lors du rendu, React retirera son UI de l'écran. Pour éviter ça, vous pouvez enrober tout ou partie de votre UI dans un <em>périmètre d'erreur</em>. Un périmètre d'erreur est un composant spécial qui vous permet d'afficher une UI de secours plutôt que la partie plantée : un message d'erreur par exemple.<p>Pour implémenter un composant de périmètre d'erreur, vous devez fournir <a href="#static-getderivedstatefromerror"><code>static getDerivedStateFromError</code></a> qui vous permet de mettre à jour votre état en réaction à une erreur afin d'afficher un message à l'utilisateur. Vous pouvez aussi, optionnellement, implémenter <a href="#componentdidcatch"><code>componentDidCatch</code></a> pour ajouter de la logique supplémentaire, comme par exemple un signalement de l'erreur à un service de supervision.<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">ErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Met à jour l'état pour que le prochain rendu affiche une</span>
    <span class="token comment">// UI de secours.</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Exemple de "componentStack" :</span>
    <span class="token comment">//   in ComponentThatThrows (created by App)</span>
    <span class="token comment">//   in ErrorBoundary (created by App)</span>
    <span class="token comment">//   in div (created by App)</span>
    <span class="token comment">//   in App</span>
    <span class="token function">logErrorToMyService</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> info<span class="token punctuation">.</span><span class="token property-access">componentStack</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">hasError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Vous pouvez afficher n’importe quelle UI de secours</span>
      <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">fallback</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Vous pouvez alors enrober une partie de votre arbre de composants avec le périmètre :<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ErrorBoundary</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span>p<span class="token operator">></span>Ça sent le pâté…<span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profile</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ErrorBoundary</span><span class="token operator">></span></code></pre><p>Si <code>Profile</code> ou un de ses composants descendants lève une erreur, <code>ErrorBoundary</code> « attrapera » cette erreur, affichera une UI de secours avec le message d'erreur fourni, et enverra un signalement de l'erreur de production à votre service de supervision.<p>Vous n'avez pas besoin d'enrober chaque composant dans son propre périmètre d'erreur. Lorsque vous réfléchissez à la <a href="https://www.brandondail.com/posts/fault-tolerance-react">granularité de vos périmètres d'erreurs</a>, pensez aux emplacements logiques pour des messages d'erreurs. Dans une appli de messagerie par exemple, un périmètre d'erreur naturel se situerait autour de la liste des conversations. Il serait également envisageable de placer un périmètre autour de chaque message individuel. En revanche, ça ne servirait à rien d'en placer un autour de chaque avatar.</p><note><p>Il n'existe pour le moment pas de moyen d'écrire un périmètre d'erreur sous forme de fonction composant. Ceci dit, vous n'avez pas à écrire votre classe de périmètre d'erreur vous-même. Vous pouvez par exemple utiliser plutôt le module <a href="https://github.com/bvaughn/react-error-boundary"><code>react-error-boundary</code></a>.</p></note></section></section><section class="level2"aria-labelledby="alternatives-alternatives"><h2 id="alternatives-alternatives">Alternatives {/<em>alternatives</em>/}</h2><section class="level3"aria-labelledby="migrer-un-composant-simple-dune-classe-vers-une-fonction-migrating-a-simple-component-from-a-class-to-a-function"><h3 id="migrer-un-composant-simple-dune-classe-vers-une-fonction-migrating-a-simple-component-from-a-class-to-a-function">Migrer un composant simple d'une classe vers une fonction {/<em>migrating-a-simple-component-from-a-class-to-a-function</em>/}</h3><p>Généralement, vous <a href="/learn/your-first-component#defining-a-component">définirez plutôt vos composants sous forme de fonctions</a>.<p>Supposons par exemple que vous souhaitiez convertir ce composant à base de classe <code>Greeting</code> en une fonction composant :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Component</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Salut</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span> <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Greeting</span> name<span class="token operator">=</span><span class="token string">"Laure"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Greeting</span> name<span class="token operator">=</span><span class="token string">"Marie"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Greeting</span> name<span class="token operator">=</span><span class="token string">"Nina"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>Définissez pour commencer une fonction nommée <code>Greeting</code>. C'est là que vous allez déplacer le corps de votre méthode <code>render</code> :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Greeting</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... déplacez ici le code de votre méthode `render` ...</span>
<span class="token punctuation">}</span></code></pre><p>Plutôt que de lire <code>this.props.name</code>, définissez une prop <code>name</code> <a href="/learn/passing-props-to-a-component">au moyen d'une déstructuration dans la signature</a> et lisez-la directement :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Greeting</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Salut</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span> <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Voici l'exemple complet :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Greeting</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Salut</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span> <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Greeting</span> name<span class="token operator">=</span><span class="token string">"Laure"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Greeting</span> name<span class="token operator">=</span><span class="token string">"Marie"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Greeting</span> name<span class="token operator">=</span><span class="token string">"Nina"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack></section><section class="level3"aria-labelledby="migrer-un-composant-avec-état-dune-classe-vers-une-fonction-migrating-a-component-with-state-from-a-class-to-a-function"><h3 id="migrer-un-composant-avec-état-dune-classe-vers-une-fonction-migrating-a-component-with-state-from-a-class-to-a-function">Migrer un composant avec état d'une classe vers une fonction {/<em>migrating-a-component-with-state-from-a-class-to-a-function</em>/}</h3><p>Supposons que vous convertissiez ce composant à base de classe <code>Counter</code> vers une fonction :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Component</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Clara'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">handleNameChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">handleAgeChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleNameChange</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleAgeChange</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Prendre</span> de l’âge
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Salut</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">Vous</span></span> avez <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">}</span> ans<span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>Commencez par déclarer une fonction avec les <a href="/reference/react/useState#adding-state-to-a-component">variables d'état</a> nécessaires :<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Counter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Clara'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>age<span class="token punctuation">,</span> setAge<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p>Convertissez ensuite les gestionnaires d'événements :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Counter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Clara'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>age<span class="token punctuation">,</span> setAge<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleNameChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleAgeChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setAge</span><span class="token punctuation">(</span>age <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span></code></pre><p>Pour finir, remplacez toutes les références qui démarrent par <code>this</code> avec les variables et fonctions définies dans votre composant. Remplacez par exemple <code>this.state.age</code> par <code>age</code> et <code>this.handleNameChange</code> par <code>handleNameChange</code>.<p>Voici le composant pleinement converti :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Counter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Clara'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>age<span class="token punctuation">,</span> setAge<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleNameChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleAgeChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setAge</span><span class="token punctuation">(</span>age <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        value<span class="token operator">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleNameChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleAgeChange<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Prendre</span> de l’âge
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Salut</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">You</span></span> are <span class="token punctuation">{</span>age<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack></section><section class="level3"aria-labelledby="migrer-un-composant-doté-de-méthodes-de-cycle-de-vie-dune-classe-vers-une-fonction-migrating-a-component-with-lifecycle-methods-from-a-class-to-a-function"><h3 id="migrer-un-composant-doté-de-méthodes-de-cycle-de-vie-dune-classe-vers-une-fonction-migrating-a-component-with-lifecycle-methods-from-a-class-to-a-function">Migrer un composant doté de méthodes de cycle de vie d'une classe vers une fonction {/<em>migrating-a-component-with-lifecycle-methods-from-a-class-to-a-function</em>/}</h3><p>Supposons que vous convertissiez ce composant à base de classe <code>ChatRoom</code>, doté de méthodes de cycle de vie, vers une fonction :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ChatRoom</span></span> <span class="token keyword module">from</span> <span class="token string">'./ChatRoom.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'general'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>show<span class="token punctuation">,</span> setShow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token maybe-class-name">Choisissez</span> un salon de discussion <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"general"</span><span class="token operator">></span>général<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"travel"</span><span class="token operator">></span>voyage<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"music"</span><span class="token operator">></span>musique<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setShow</span><span class="token punctuation">(</span><span class="token operator">!</span>show<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token punctuation">{</span>show <span class="token operator">?</span> <span class="token string">'Ferme le salon'</span> <span class="token operator">:</span> <span class="token string">'Ouvrir le salon'</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>show <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span>
      <span class="token punctuation">{</span>show <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span> roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Component</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">class</span> <span class="token class-name">ChatRoom</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> <span class="token string">'https://localhost:1234'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setupConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">roomId</span> <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span><span class="token property-access">roomId</span> <span class="token operator">||</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">serverUrl</span> <span class="token operator">!==</span> prevState<span class="token punctuation">.</span><span class="token property-access">serverUrl</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">destroyConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setupConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">destroyConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">setupConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">connection</span> <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">serverUrl</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">roomId</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">connection</span><span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">destroyConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">connection</span><span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">connection</span> <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
          <span class="token constant">URL</span> du serveur <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
          <span class="token operator">&#x3C;</span>input
            value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">serverUrl</span><span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Bienvenue</span> dans le salon <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">roomId</span><span class="token punctuation">}</span> <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter">serverUrl<span class="token punctuation">,</span> roomId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Une véritable implémentation se connecterait en vrai au serveur</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'✅ Connexion au salon « '</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">' » sur '</span> <span class="token operator">+</span> serverUrl <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'❌ Déconnexion du salon « '</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">' » sur '</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>Commencez par vérifier que votre <a href="#componentwillunmount"><code>componentWillUnmount</code></a> fait bien l'inverse de votre <a href="#componentdidmount"><code>componentDidMount</code></a>. Dans l'exemple ci-dessus, c'est bien le cas : elle débranche la connexion établie par <code>componentDidMount</code>. Si cette logique est manquante, commencez par l'ajouter.<p>Ensuite, vérifiez que votre méthode <a href="#componentdidupdate"><code>componentDidUpdate</code></a> gère les changements des props et états que vous utilisez dans <code>componentDidMount</code>. Dans l'exemple ci-dessus, <code>componentDidMount</code> appelle <code>setupConnection</code> qui lit <code>this.state.serverUrl</code> et <code>this.props.roomId</code>. C'est pourquoi <code>componentDidUpdate</code> vérifie si <code>this.state.serverUrl</code> ou <code>this.props.roomId</code> ont changé, et réinitialise la connexion le cas échéant. Si la logique de votre <code>componentDidUpdate</code> est manquante ou ne gère pas les changements à toutes les parties pertinentes des props et de l'état, corrigez d'abord ça.<p>Dans l'exemple qui précède, la logique dans les méthodes de cycle de vie connecte le composant à un système extérieur à React (un serveur de discussion). Pour connecter un composant à un système extérieur, <a href="/reference/react/useEffect#connecting-to-an-external-system">décrivez la logique nécessaire dans un Effet unique</a> :<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>serverUrl<span class="token punctuation">,</span> setServerUrl<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'https://localhost:1234'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Cet appel à <a href="/reference/react/useEffect"><code>useEffect</code></a> est équivalent à la logique des méthodes de cycle de vie ci-avant. Si vos méthodes de cycle de vie s'occupent de plusieurs sujets distincts, <a href="/learn/removing-effect-dependencies#is-your-effect-doing-several-unrelated-things">découpez-les en Effets indépendants</a>. Voici l'exemple complet que vous pouvez manipuler :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ChatRoom</span></span> <span class="token keyword module">from</span> <span class="token string">'./ChatRoom.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'general'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>show<span class="token punctuation">,</span> setShow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token maybe-class-name">Choisissez</span> un salon de discussion <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"general"</span><span class="token operator">></span>général<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"travel"</span><span class="token operator">></span>voyage<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"music"</span><span class="token operator">></span>musique<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setShow</span><span class="token punctuation">(</span><span class="token operator">!</span>show<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token punctuation">{</span>show <span class="token operator">?</span> <span class="token string">'Ferme le salon'</span> <span class="token operator">:</span> <span class="token string">'Ouvrir le salon'</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>show <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span>
      <span class="token punctuation">{</span>show <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span> roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>serverUrl<span class="token punctuation">,</span> setServerUrl<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'https://localhost:1234'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> serverUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token constant">URL</span> du serveur <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>serverUrl<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setServerUrl</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Bienvenue</span> dans le salon <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter">serverUrl<span class="token punctuation">,</span> roomId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Une véritable implémentation se connecterait en vrai au serveur</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'✅ Connexion au salon « '</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">' » sur '</span> <span class="token operator">+</span> serverUrl <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'❌ Déconnexion du salon « '</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">' » sur '</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><note><p>Si votre composant ne se synchronise pas avec un système extérieur, alors <a href="/learn/you-might-not-need-an-effect">vous n'avez pas forcément besoin d'un Effet</a>.</p></note></section><section class="level3"aria-labelledby="migrer-un-composant-avec-un-contexte-dune-classe-vers-une-fonction-migrating-a-component-with-context-from-a-class-to-a-function"><h3 id="migrer-un-composant-avec-un-contexte-dune-classe-vers-une-fonction-migrating-a-component-with-context-from-a-class-to-a-function">Migrer un composant avec un contexte d'une classe vers une fonction {/<em>migrating-a-component-with-context-from-a-class-to-a-function</em>/}</h3><p>Dans l'exemple qui suit, les composants à base de classes <code>Panel</code> et <code>Button</code> lisent un <a href="/learn/passing-data-deeply-with-context">contexte</a> en utilisant <a href="#context"><code>this.context</code></a> :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createContext<span class="token punctuation">,</span> <span class="token maybe-class-name">Component</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">ThemeContext</span> <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Panel</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> contextType <span class="token operator">=</span> <span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">context</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> className <span class="token operator">=</span> <span class="token string">'panel-'</span> <span class="token operator">+</span> theme<span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>section className<span class="token operator">=</span><span class="token punctuation">{</span>className<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>section<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> contextType <span class="token operator">=</span> <span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">context</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> className <span class="token operator">=</span> <span class="token string">'button-'</span> <span class="token operator">+</span> theme<span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>button className<span class="token operator">=</span><span class="token punctuation">{</span>className<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span> title<span class="token operator">=</span><span class="token string">"Bienvenue"</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Button</span><span class="token operator">></span><span class="token maybe-class-name">Inscription</span><span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Button</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Button</span><span class="token operator">></span><span class="token maybe-class-name">Connexion</span><span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Button</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyApp</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Provider</span></span> value<span class="token operator">=</span><span class="token string">"dark"</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Form</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Provider</span></span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.panel-light</span><span class="token punctuation">,</span>
<span class="token class">.panel-dark</span></span> <span class="token punctuation">{</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token color">black</span><span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.panel-light</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.panel-dark</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token color"><span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.button-light</span><span class="token punctuation">,</span>
<span class="token class">.button-dark</span></span> <span class="token punctuation">{</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token hexcode color">#777</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.button-dark</span></span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.button-light</span></span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>Lorsque vous convertissez ça en fonctions composants, remplacez votre utilisation de<code>this.context</code> par des appels à <a href="/reference/react/useContext"><code>useContext</code></a> :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createContext<span class="token punctuation">,</span> useContext <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">ThemeContext</span> <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Panel</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> title<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> className <span class="token operator">=</span> <span class="token string">'panel-'</span> <span class="token operator">+</span> theme<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>section className<span class="token operator">=</span><span class="token punctuation">{</span>className<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>section<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Button</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> className <span class="token operator">=</span> <span class="token string">'button-'</span> <span class="token operator">+</span> theme<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>button className<span class="token operator">=</span><span class="token punctuation">{</span>className<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span> title<span class="token operator">=</span><span class="token string">"Bienvenue"</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Button</span><span class="token operator">></span><span class="token maybe-class-name">Inscription</span><span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Button</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Button</span><span class="token operator">></span><span class="token maybe-class-name">Connexion</span><span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Button</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyApp</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Provider</span></span> value<span class="token operator">=</span><span class="token string">"dark"</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Form</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Provider</span></span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.panel-light</span><span class="token punctuation">,</span>
<span class="token class">.panel-dark</span></span> <span class="token punctuation">{</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token color">black</span><span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.panel-light</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.panel-dark</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token color"><span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.button-light</span><span class="token punctuation">,</span>
<span class="token class">.button-dark</span></span> <span class="token punctuation">{</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token hexcode color">#777</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.button-dark</span></span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.button-light</span></span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>