<!doctypehtml><html lang="pl"><meta charset="utf-8"><title>Narzędzia do testowania</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css"><section id="narzędzia-do-testowania"class="level1"><h1>Narzędzia do testowania</h1><p><strong>Importowanie</strong><pre class="language-javascript"><code class="language-javascript"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ReactTestUtils</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/test-utils'</span><span class="token punctuation">;</span> <span class="token comment">// ES6</span>
<span class="token keyword">var</span> <span class="token maybe-class-name">ReactTestUtils</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react-dom/test-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ES5 z zainstalowanym npm</span></code></pre><section id="overview"class="level2"><h2>Ogólne informacje</h2><p><code>ReactTestUtils</code> pozwala na łatwiejsze testowanie komponentów reactowych przy pomocy dowolnego frameworka. W Facebooku korzystamy do tego celu z biblioteki <a href="https://facebook.github.io/jest/">Jest</a>, która sprawia, że pisanie testów jest mniej kłopotliwe. Do nauki podstaw Jesta polecamy <a href="https://jestjs.io/docs/tutorial-react">samouczek dla Reacta</a>, znajdujący się na oficjalnej stronie biblioteki.<blockquote><p>Uwaga:<p>Zalecamy korzystanie z biblioteki <a href="https://testing-library.com/react">React Testing Library</a>. Została ona stworzona w celu propagowania idei pisania testów, które używają komponentów podobnie jak potencjalny użytkownik aplikacji.<p>Dla Reacta w wersji 16 lub niższej polecamy bibliotekę <a href="https://airbnb.io/enzyme/">Enzyme</a>, dzięki której w łatwy sposób można pisać asercje, a także zmieniać i przechodzić drzewo zwrócone przez komponenty reactowe.</blockquote><ul><li><a href="#act"><code>act()</code></a><li><a href="#mockcomponent"><code>mockComponent()</code></a><li><a href="#iselement"><code>isElement()</code></a><li><a href="#iselementoftype"><code>isElementOfType()</code></a><li><a href="#isdomcomponent"><code>isDOMComponent()</code></a><li><a href="#iscompositecomponent"><code>isCompositeComponent()</code></a><li><a href="#iscompositecomponentwithtype"><code>isCompositeComponentWithType()</code></a><li><a href="#findallinrenderedtree"><code>findAllInRenderedTree()</code></a><li><a href="#scryrendereddomcomponentswithclass"><code>scryRenderedDOMComponentsWithClass()</code></a><li><a href="#findrendereddomcomponentwithclass"><code>findRenderedDOMComponentWithClass()</code></a><li><a href="#scryrendereddomcomponentswithtag"><code>scryRenderedDOMComponentsWithTag()</code></a><li><a href="#findrendereddomcomponentwithtag"><code>findRenderedDOMComponentWithTag()</code></a><li><a href="#scryrenderedcomponentswithtype"><code>scryRenderedComponentsWithType()</code></a><li><a href="#findrenderedcomponentwithtype"><code>findRenderedComponentWithType()</code></a><li><a href="#renderintodocument"><code>renderIntoDocument()</code></a><li><a href="#simulate"><code>Simulate</code></a></ul></section><section id="reference"class="level2"><h2>Dokumentacja</h2><section id="act-act"class="level3"><h3><code>act()</code> {#act}</h3><p>Aby przygotować dany komponent do testowania, należy renderujący i aktualizujący go kod "opakować" w wywołanie funkcji <code>act()</code>. Dzięki temu test zostanie uruchomiony w taki sposób, aby jak najwierniej odtworzyć zachowanie Reacta w przeglądarce.<blockquote><p>Uwaga<p>Biblioteka <code>react-test-renderer</code> również udostępnia funkcję <code>act</code>, która działa w podobny sposób.</blockquote><p>Dla przykładu, załóżmy, że napisaliśmy następujący komponent <code>Counter</code> (pol. <em>licznik</em>):<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleClick</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">handleClick</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">title</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Kliknięto </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> razy</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">title</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Kliknięto </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> razy</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Kliknięto</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">}</span> razy<span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleClick</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Kliknij</span> mnie
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>W taki oto sposób moglibyśmy go przetestować:<pre class="language-js{3,20-22,29-31}"><code class="language-js{3,20-22,29-31}">import React from 'react';
import ReactDOM from 'react-dom/client';
import { act } from 'react-dom/test-utils';
import Counter from './Counter';

let container;

beforeEach(() => {
  container = document.createElement('div');
  document.body.appendChild(container);
});

afterEach(() => {
  document.body.removeChild(container);
  container = null;
});

it('potrafi wyrenderować i aktualizować licznik', () => {
  // Testuje pierwsze renderowanie i metodę cyklu życia "componentDidMount"
  act(() => {
    ReactDOM.createRoot(container).render(&#x3C;Counter />);
  });
  const button = container.querySelector('button');
  const label = container.querySelector('p');
  expect(label.textContent).toBe('Kliknięto 0 razy');
  expect(document.title).toBe('Kliknięto 0 razy');

  // Testuje drugie renderowanie i metodę cyklu życia "componentDidUpdate"
  act(() => {
    button.dispatchEvent(new MouseEvent('click', {bubbles: true}));
  });
  expect(label.textContent).toBe('Kliknięto 1 razy');
  expect(document.title).toBe('Kliknięto 1 razy');
});</code></pre><p>Zwróć uwagę, że przesyłanie zdarzeń DOM działa tylko wtedy, gdy kontener jest umieszczony w <code>document</code>. Aby uniknąć powtarzania szablonowego kodu, możesz użyć biblioteki pomocniczej, jak na przykład <a href="https://testing-library.com/react">React Testing Library</a>.<p>W <a href="./testing-recipes.html"><code>przykładach</code></a> znajdziesz więcej szczegółów na temat zachowania funkcji <code>act()</code>, jak również przykłady jej użycia.<hr></section><section id="mockcomponent-mockcomponent"class="level3"><h3><code>mockComponent()</code> {#mockcomponent}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">mockComponent</span><span class="token punctuation">(</span>
  componentClass<span class="token punctuation">,</span>
  <span class="token punctuation">[</span>mockTagName<span class="token punctuation">]</span>
<span class="token punctuation">)</span></code></pre><p>Jeśli przekażesz do tej funkcji atrapę komponentu (ang. <em>mocked component</em>), zostanie ona wzbogacona o przydatne funkcje, które pozwolą na traktowanie jej jak sztucznego komponentu reactowego. Zamiast wyrenderować się zgodnie z implementacją, komponent stanie się zwykłym elementem <code>&#x3C;div></code> (lub innym, jeśli podamy wartość w parametrze <code>mockTagName</code>) renderującym przekazanych potomków.<blockquote><p>Uwaga:<p>Funkcja <code>mockComponent()</code> jest przestarzała. Zamiast niej zalecamy używanie funkcji <a href="https://jestjs.io/docs/tutorial-react-native#mock-native-modules-using-jestmock"><code>jest.mock()</code></a>.</blockquote><hr></section><section id="iselement-iselement"class="level3"><h3><code>isElement()</code> {#iselement}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">isElement</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span></code></pre><p>Zwraca <code>true</code>, jeśli argument <code>element</code> jest elementem reactowym.<hr></section><section id="iselementoftype-iselementoftype"class="level3"><h3><code>isElementOfType()</code> {#iselementoftype}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">isElementOfType</span><span class="token punctuation">(</span>
  element<span class="token punctuation">,</span>
  componentClass
<span class="token punctuation">)</span></code></pre><p>Zwraca <code>true</code>, jeśli argument <code>element</code> jest elementem reactowym o klasie podanej jako <code>componentClass</code>.<hr></section><section id="isdomcomponent-isdomcomponent"class="level3"><h3><code>isDOMComponent()</code> {#isdomcomponent}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">isDOMComponent</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span></code></pre><p>Zwraca <code>true</code>, jeśli argument <code>instance</code> jest standardowym komponentem DOM (np. <code>&#x3C;div></code> lub <code>&#x3C;span></code>).<hr></section><section id="iscompositecomponent-iscompositecomponent"class="level3"><h3><code>isCompositeComponent()</code> {#iscompositecomponent}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">isCompositeComponent</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span></code></pre><p>Zwraca <code>true</code>, jeśli argument <code>instance</code> jest komponentem użytkownika, typu klasowego lub funkcyjnego.<hr></section><section id="iscompositecomponentwithtype-iscompositecomponentwithtype"class="level3"><h3><code>isCompositeComponentWithType()</code> {#iscompositecomponentwithtype}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">isCompositeComponentWithType</span><span class="token punctuation">(</span>
  instance<span class="token punctuation">,</span>
  componentClass
<span class="token punctuation">)</span></code></pre><p>Zwraca <code>true</code>, jeśli argument <code>instance</code> jest komponentem o klasie podanej jako <code>componentClass</code>.<hr></section><section id="findallinrenderedtree-findallinrenderedtree"class="level3"><h3><code>findAllInRenderedTree()</code> {#findallinrenderedtree}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">findAllInRenderedTree</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  test
<span class="token punctuation">)</span></code></pre><p>Przeszukuje wszystkie komponenty w drzewie <code>tree</code> i zwraca te, dla których wywołanie funkcji <code>test(komponent)</code> daje <code>true</code>. Funkcja ta sama w sobie nie jest zbyt użyteczna, jednak jest podstawą dla innych narzędzi do testowania.<hr></section><section id="scryrendereddomcomponentswithclass-scryrendereddomcomponentswithclass"class="level3"><h3><code>scryRenderedDOMComponentsWithClass()</code> {#scryrendereddomcomponentswithclass}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">scryRenderedDOMComponentsWithClass</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  className
<span class="token punctuation">)</span></code></pre><p>Wyszukuje wszystkie elementy DOM w wyrenderowanym drzewie, których nazwa klasy CSS odpowiada wartości argumentu <code>className</code>.<hr></section><section id="findrendereddomcomponentwithclass-findrendereddomcomponentwithclass"class="level3"><h3><code>findRenderedDOMComponentWithClass()</code> {#findrendereddomcomponentwithclass}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">findRenderedDOMComponentWithClass</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  className
<span class="token punctuation">)</span></code></pre><p>Podobna w działaniu do <a href="#scryrendereddomcomponentswithclass"><code>scryRenderedDOMComponentsWithClass()</code></a>, lecz oczekuje dokładnie jednego wyniku. W przypadku znalezienia innej liczby elementów rzuca wyjątek.<hr></section><section id="scryrendereddomcomponentswithtag-scryrendereddomcomponentswithtag"class="level3"><h3><code>scryRenderedDOMComponentsWithTag()</code> {#scryrendereddomcomponentswithtag}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">scryRenderedDOMComponentsWithTag</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  tagName
<span class="token punctuation">)</span></code></pre><p>Wyszukuje wszystkie elementy DOM w wyrenderowanym drzewie, których nazwa znacznika pasuje do wartości argumentu <code>tagName</code>.<hr></section><section id="findrendereddomcomponentwithtag-findrendereddomcomponentwithtag"class="level3"><h3><code>findRenderedDOMComponentWithTag()</code> {#findrendereddomcomponentwithtag}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">findRenderedDOMComponentWithTag</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  tagName
<span class="token punctuation">)</span></code></pre><p>Podobna w działaniu do <a href="#scryrendereddomcomponentswithtag"><code>scryRenderedDOMComponentsWithTag()</code></a>, lecz oczekuje dokładnie jednego wyniku. W przypadku znalezienia innej liczby elementów rzuca wyjątek.<hr></section><section id="scryrenderedcomponentswithtype-scryrenderedcomponentswithtype"class="level3"><h3><code>scryRenderedComponentsWithType()</code> {#scryrenderedcomponentswithtype}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">scryRenderedComponentsWithType</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  componentClass
<span class="token punctuation">)</span></code></pre><p>Wyszukuje wszystkie instancje komponentów, których typ jest równy argumentowi <code>componentClass</code>.<hr></section><section id="findrenderedcomponentwithtype-findrenderedcomponentwithtype"class="level3"><h3><code>findRenderedComponentWithType()</code> {#findrenderedcomponentwithtype}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">findRenderedComponentWithType</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  componentClass
<span class="token punctuation">)</span></code></pre><p>Podobna w działaniu do <a href="#scryrenderedcomponentswithtype"><code>scryRenderedComponentsWithType()</code></a>, lecz oczekuje dokładnie jednego wyniku. W przypadku znalezienia innej liczby elementów rzuca wyjątek.<hr></section><section id="renderintodocument-renderintodocument"class="level3"><h3><code>renderIntoDocument()</code> {#renderintodocument}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">renderIntoDocument</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span></code></pre><p>Renderuje element reactowy do stworzonego w locie węzła drzewa DOM. <strong>Ta funkcja działa tylko na drzewie DOM w ramach dokumentu.</strong> Daje ten sam rezultat, co:<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> domContainer <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">createRoot</span><span class="token punctuation">(</span>domContainer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>Uwaga:<p><strong>Zanim</strong> zaimportujesz bibliotekę React w kodzie, w globalnym zakresie muszą być dostępne zmienne <code>window</code>, <code>window.document</code> oraz <code>window.document.createElement</code>. W przeciwnym wypadku React będzie "myślał", że nie ma dostępu do drzewa DOM, co spowoduje wyłączenie niektórych funkcji, np. <code>setState</code>.</blockquote><hr></section></section><section id="other-utilities"class="level2"><h2>Inne narzędzia</h2><section id="simulate-simulate"class="level3"><h3><code>Simulate</code> {#simulate}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token maybe-class-name">Simulate</span><span class="token punctuation">.</span><span class="token punctuation">{</span>eventName<span class="token punctuation">}</span><span class="token punctuation">(</span>
  element<span class="token punctuation">,</span>
  <span class="token punctuation">[</span>eventData<span class="token punctuation">]</span>
<span class="token punctuation">)</span></code></pre><p>Symuluje przesłanie zdarzenia do węzła DOM, opcjonalnie dodając do niego dane zawarte w argumencie <code>eventData</code>.<p>Obiekt <code>Simulate</code> posiada odpowiednie metody <a href="./events.html#supported-events">dla każdego ze zdarzeń obsługiwanego przez Reacta</a>.<p><strong>Kliknięcie w element</strong><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// &#x3C;button ref={(node) => this.button = node}>...&#x3C;/button></span>
<span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">button</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">ReactTestUtils</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Simulate</span></span><span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>Zmiana wartości pola i wciśnięcie klawisza ENTER.</strong><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// &#x3C;input ref={(node) => this.textInput = node} /></span>
<span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">textInput</span><span class="token punctuation">;</span>
node<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> <span class="token string">'żyrafa'</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">ReactTestUtils</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Simulate</span></span><span class="token punctuation">.</span><span class="token method function property-access">change</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">ReactTestUtils</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Simulate</span></span><span class="token punctuation">.</span><span class="token method function property-access">keyDown</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">"Enter"</span><span class="token punctuation">,</span> <span class="token literal-property property">keyCode</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token literal-property property">which</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>Uwaga<p>Wszelkie właściwości dla zdarzenia (np. <code>keyCode</code>, <code>which</code> itp.) należy przekazać jawnie, ponieważ React nie dodaje ich automatycznie.</blockquote><hr><p><span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section></section>