<!doctype html><html lang="ko"><meta charset="utf-8"><title>renderToPipeableStream</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="rendertopipeablestream"><h1 id="rendertopipeablestream">renderToPipeableStream</h1><intro><p><code>renderToPipeableStream</code>은 React 트리를 파이프 가능한 <a href="https://nodejs.org/api/stream.html">Node.js 스트림</a>으로 렌더링합니다.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> pipe<span class="token punctuation">,</span> abort <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderToPipeableStream</span><span class="token punctuation">(</span>reactNode<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">)</span></code></pre></intro><inlinetoc><note><p>이 API는 Node.js 전용입니다. Deno 및 최신 엣지 런타임과 같은 <a href="https://developer.mozilla.org/ko/docs/Web/API/Streams_API">Web 스트림</a>이 있는 환경에서는 대신 <a href="/reference/react-dom/server/renderToReadableStream"><code>renderToReadableStream</code></a>을 사용해야 합니다.</p></note><section class="level2"aria-labelledby="레퍼런스-reference"><h2 id="레퍼런스-reference">레퍼런스 {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="rendertopipeablestreamreactnode-options-rendertopipeablestream"><h3 id="rendertopipeablestreamreactnode-options-rendertopipeablestream"><code>renderToPipeableStream(reactNode, options?)</code> {/<em>rendertopipeablestream</em>/}</h3><p><code>renderToPipeableStream</code>을 호출하여 React 트리를 HTML로 <a href="https://nodejs.org/api/stream.html#writable-streams">Node.js 스트림</a>에 렌더링합니다.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> renderToPipeableStream <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/server'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> pipe <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderToPipeableStream</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">bootstrapScripts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/main.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">onShellReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">pipe</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>클라이언트에서 <a href="/reference/react-dom/client/hydrateRoot"><code>hydrateRoot</code></a>를 호출하여 서버에서 생성된 HTML을 상호작용할 수 있도록 만듭니다.<p><a href="#usage">아래에서 더 많은 예시를 확인하세요.</a><section class="level4"aria-labelledby="매개변수-parameters"><h4 id="매개변수-parameters">매개변수 {/<em>parameters</em>/}</h4><ul><li><p><code>reactNode</code>: HTML로 렌더링하려는 React 노드. 예를 들어, <code>&#x3C;App /></code>과 같은 JSX 엘리먼트입니다. 전체 문서를 나타낼 것으로 예상되므로 <code>App</code> 컴포넌트는 <code>&#x3C;html></code> 태그를 렌더링해야 합니다.<li><p><strong>선택 사항</strong> <code>options</code>: 스트리밍 옵션이 있는 객체입니다.<ul><li><strong>선택 사항</strong> <code>bootstrapScriptContent</code>: 지정하면 이 문자열이 인라인 <code>&#x3C;script></code> 태그에 배치됩니다.<li><strong>선택 사항</strong> <code>bootstrapScripts</code>: 페이지에 표시할 <code>&#x3C;script></code> 태그에 대한 문자열 URL 배열입니다. 이를 사용하여 <a href="/reference/react-dom/client/hydrateRoot"><code>hydrateRoot</code></a>를 호출하는 <code>&#x3C;script></code>를 포함하세요. 클라이언트에서 React를 전혀 실행하지 않으려면 생략하세요.<li><strong>선택 사항</strong> <code>bootstrapModules</code>: <code>bootstrapScripts</code>와 같지만 대신 <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Guide/Modules"><code>&#x3C;script type="module"></code></a>를 출력합니다.<li><strong>선택 사항</strong> <code>identifierPrefix</code>: React가 <a href="/reference/react/useId"><code>useId</code></a>에 의해 생성된 ID에 사용하는 문자열 접두사입니다. 같은 페이지에서 여러 루트를 사용할 때 충돌을 피하는 데 유용합니다. <a href="/reference/react-dom/client/hydrateRoot#parameters"><code>hydrateRoot</code></a>에 전달된 것과 동일한 접두사여야 합니다.<li><strong>선택 사항</strong> <code>namespaceURI</code>: 스트림의 루트 <a href="https://developer.mozilla.org/ko/docs/Web/API/Document/createElementNS#important_namespace_uris">네임스페이스 URI</a>가 포함된 문자열입니다. 기본값은 일반 HTML입니다. SVG의 경우 <code>'http://www.w3.org/2000/svg'</code>를, MathML의 경우 <code>'http://www.w3.org/1998/Math/MathML'</code>를 전달합니다.<li><strong>선택 사항</strong> <code>nonce</code>: <a href="https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Content-Security-Policy/script-src"><code>script-src</code> Content-Security-Policy</a>에 대한 스크립트를 허용하는 <a href="http://developer.mozilla.org/ko/docs/Web/HTML/Element/script#nonce"><code>nonce</code></a> 문자열입니다.<li><strong>선택 사항</strong> <code>onAllReady</code>: <a href="#specifying-what-goes-into-the-shell">셸</a>과 모든 추가 <a href="#streaming-more-content-as-it-loads">콘텐츠</a>를 포함하여 모든 렌더링이 완료되면 호출되는 콜백입니다. <a href="#waiting-for-all-content-to-load-for-crawlers-and-static-generation">크롤러 및 정적 생성에</a> <code>onShellReady</code> 대신 이 함수를 사용할 수 있습니다. 여기서 스트리밍을 시작하면 프로그레시브 로딩이 발생하지 않습니다. 스트림에는 최종 HTML이 포함됩니다.<li><strong>선택 사항</strong> <code>onError</code>: <a href="#recovering-from-errors-outside-the-shell">복구 가능</a> 또는 <a href="#recovering-from-errors-inside-the-shell">불가능</a>에 관계없이 서버 오류가 발생할 때마다 호출되는 콜백입니다. 기본적으로 <code>console.error</code>만 호출합니다. 이 함수를 재정의하여 <a href="#logging-crashes-on-the-server">크래시 리포트를 기록</a>하는 경우 <code>console.error</code>를 계속 호출해야 합니다. 셸이 출력되기 전에 <a href="#setting-the-status-code">상태 코드를 조정</a>하는 데 사용할 수도 있습니다.<li><strong>선택 사항</strong> <code>onShellReady</code>: <a href="#specifying-what-goes-into-the-shell">초기 셸</a>이 렌더링된 직후에 실행되는 콜백입니다. 여기서 <a href="#setting-the-status-code">상태 코드를 설정</a>하고 <code>pipe</code>를 호출하여 스트리밍을 시작할 수 있습니다. React는 HTML 로딩 폴백을 콘텐츠로 대체하는 인라인 <code>&#x3C;script></code> 태그와 함께 셸 뒤에 <a href="#streaming-more-content-as-it-loads">추가 콘텐츠를 스트리밍</a>합니다.<li><strong>선택 사항</strong> <code>onShellError</code>: 초기 셸을 렌더링하는 데 오류가 발생하면 호출되는 콜백입니다. 오류를 인자로 받습니다. 스트림에서 아직 바이트가 전송되지 않았고, <code>onShellReady</code>나 <code>onAllReady</code>도 호출되지 않으므로 <a href="#recovering-from-errors-inside-the-shell">폴백 HTML 셸을 출력</a> 할 수 있습니다.<li><strong>선택 사항</strong> <code>progressiveChunkSize</code>: 청크의 바이트 수입니다. <a href="https://github.com/facebook/react/blob/14c2be8dac2d5482fda8a0906a31d239df8551fc/packages/react-server/src/ReactFizzServer.js#L210-L225">기본 휴리스틱에 대해 자세히 알아보세요.</a></ul></ul></section><section class="level4"aria-labelledby="반환값-returns"><h4 id="반환값-returns">반환값 {/<em>returns</em>/}</h4><p><code>renderToPipeableStream</code>은 두 개의 메서드가 있는 객체를 반환합니다.<ul><li><code>pipe</code>는 HTML을 제공된 <a href="https://nodejs.org/api/stream.html#writable-streams">쓰기 가능한 Node.js 스트림</a>으로 출력합니다. 스트리밍을 활성화하려면 <code>onShellReady</code>에서, 크롤러와 정적 생성을 사용하려면 <code>onAllReady</code>에서 <code>pipe</code>를 호출하세요.<li><code>abort</code>를 사용하면 <a href="#aborting-server-rendering">서버 렌더링을 중단</a>하고 나머지는 클라이언트에서 렌더링할 수 있습니다.</ul></section></section></section><section class="level2"aria-labelledby="사용법-usage"><h2 id="사용법-usage">사용법 {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="react-트리를-html로-nodejs-스트림에-렌더링하기-rendering-a-react-tree-as-html-to-a-nodejs-stream"><h3 id="react-트리를-html로-nodejs-스트림에-렌더링하기-rendering-a-react-tree-as-html-to-a-nodejs-stream">React 트리를 HTML로 Node.js 스트림에 렌더링하기 {/<em>rendering-a-react-tree-as-html-to-a-nodejs-stream</em>/}</h3><p><code>renderToPipeableStream</code>을 호출하여 React 트리를 HTML로 <a href="https://nodejs.org/api/stream.html#writable-streams">Node.js 스트림</a>에 렌더링합니다.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> renderToPipeableStream <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/server'</span><span class="token punctuation">;</span>

<span class="token comment">// 경로 핸들러 문법은 백엔드 프레임워크에 따라 다릅니다.</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> pipe <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderToPipeableStream</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">bootstrapScripts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/main.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">onShellReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">pipe</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><codestep step="{1}">루트 컴포넌트</codestep>와 함께<codestep step="{2}">부트스트랩 <code>&#x3C;script></code> 경로 목록</codestep>을 제공해야 합니다. 루트 컴포넌트는 <strong>루트 <code>&#x3C;html></code> 태그를 포함한 전체 문서를 반환해야 합니다.</strong><p>예를 들어 다음과 같이 표시될 수 있습니다.<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>html<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>head<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>meta charSet<span class="token operator">=</span><span class="token string">"utf-8"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"/styles.css"</span><span class="token operator">></span><span class="token operator">&#x3C;</span><span class="token operator">/</span>link<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>title<span class="token operator">></span><span class="token maybe-class-name">My</span> app<span class="token operator">&#x3C;</span><span class="token operator">/</span>title<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>head<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>body<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Router</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>body<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>html<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>React는 <a href="https://developer.mozilla.org/ko/docs/Glossary/Doctype">doctype</a>과<codestep step="{2}">부트스트랩 <code>&#x3C;script></code> 태그</codestep>를 결과 HTML 스트림에 삽입합니다.<pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&#x3C;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>html</span><span class="token punctuation">></span></span>
  <span class="token comment">&#x3C;!-- ... 컴포넌트의 HTML ... --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/main.js<span class="token punctuation">"</span></span> <span class="token attr-name">async</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>클라이언트에서 부트스트랩 스크립트는 <a href="/reference/react-dom/client/hydrateRoot#hydrating-an-entire-document"><code>hydrateRoot</code>를 호출하여 전체 <code>document</code>를 하이드레이트해야 합니다.</a><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrateRoot <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/client'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">App</span></span> <span class="token keyword module">from</span> <span class="token string">'./App.js'</span><span class="token punctuation">;</span>

<span class="token function">hydrateRoot</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">,</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>이렇게 하면 서버에서 생성된 HTML에 이벤트 리스너가 첨부되어 상호작용이 가능해집니다.</p><deepdive><section class="level4"aria-labelledby="빌드-출력에서-css-및-js-에셋-경로-읽기-reading-css-and-js-asset-paths-from-the-build-output"><h4 id="빌드-출력에서-css-및-js-에셋-경로-읽기-reading-css-and-js-asset-paths-from-the-build-output">빌드 출력에서 CSS 및 JS 에셋 경로 읽기 {/<em>reading-css-and-js-asset-paths-from-the-build-output</em>/}</h4><p>최종 에셋 URL(예: 자바스크립트 및 CSS 파일)은 빌드 후에 해시 처리되는 경우가 많습니다. 예를 들어 <code>styles.css</code> 대신 <code>styles.123456.css</code>로 끝날 수 있습니다. 정적 에셋 파일명을 해시하면 동일한 에셋의 모든 별개의 빌드에서 다른 파일명을 가질 수 있습니다. 이는 정적 자산에 대한 장기 캐싱을 안전하게 활성화할 수 있기 때문에 유용합니다. 특정 이름을 가진 파일은 콘텐츠가 변경되지 않습니다.<p>하지만 빌드가 끝날 때까지 에셋 URL을 모르는 경우 소스 코드에 넣을 방법이 없습니다. 예를 들어, 앞서처럼 <code>"/styles.css"</code>를 JSX에 하드코딩하면 작동하지 않습니다. 소스 코드에 포함되지 않도록 하려면 루트 컴포넌트가 프로퍼티로 전달된 맵에서 실제 파일명을 읽을 수 있습니다.<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> assetMap <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>html<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>head<span class="token operator">></span>
        <span class="token spread operator">...</span>
        <span class="token operator">&#x3C;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token punctuation">{</span>assetMap<span class="token punctuation">[</span><span class="token string">'styles.css'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&#x3C;</span><span class="token operator">/</span>link<span class="token operator">></span>
        <span class="token spread operator">...</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>head<span class="token operator">></span>
      <span class="token spread operator">...</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>html<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>서버에서 <code>&#x3C;App assetMap={assetMap} /></code>를 렌더링하고 에셋 URL과 함께 <code>assetMap</code>을 전달합니다.<pre class="language-js"><code class="language-js"><span class="token comment">// 빌드 도구에서 이 JSON을 가져와야 합니다(예: 빌드 출력에서 읽어오기).</span>
<span class="token keyword">const</span> assetMap <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'styles.css'</span><span class="token operator">:</span> <span class="token string">'/styles.123456.css'</span><span class="token punctuation">,</span>
  <span class="token string-property property">'main.js'</span><span class="token operator">:</span> <span class="token string">'/main.123456.js'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> pipe <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderToPipeableStream</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> assetMap<span class="token operator">=</span><span class="token punctuation">{</span>assetMap<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">bootstrapScripts</span><span class="token operator">:</span> <span class="token punctuation">[</span>assetMap<span class="token punctuation">[</span><span class="token string">'main.js'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">onShellReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">pipe</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>이제 서버에서 <code>&#x3C;App assetMap={assetMap} /></code>를 렌더링하고 있으므로 클라이언트에서도 <code>assetMap</code>을 사용하여 렌더링해야 하이드레이션 오류를 방지할 수 있습니다. 다음과 같이 <code>assetMap</code>을 직렬화하여 클라이언트에 전달할 수 있습니다.<pre class="language-js"><code class="language-js"><span class="token comment">// 빌드 도구에서 이 JSON을 가져와야 합니다.</span>
<span class="token keyword">const</span> assetMap <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'styles.css'</span><span class="token operator">:</span> <span class="token string">'/styles.123456.css'</span><span class="token punctuation">,</span>
  <span class="token string-property property">'main.js'</span><span class="token operator">:</span> <span class="token string">'/main.123456.js'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> pipe <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderToPipeableStream</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> assetMap<span class="token operator">=</span><span class="token punctuation">{</span>assetMap<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// 조심하세요: 이 데이터는 사용자가 생성한 것이 아니므로 stringify()하는 것이 안전합니다.</span>
    <span class="token literal-property property">bootstrapScriptContent</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">window.assetMap = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>assetMap<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">bootstrapScripts</span><span class="token operator">:</span> <span class="token punctuation">[</span>assetMap<span class="token punctuation">[</span><span class="token string">'main.js'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">onShellReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">pipe</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>위 예시에서 <code>bootstrapScriptContent</code> 옵션은 클라이언트에서 전역 <code>window.assetMap</code> 변수를 설정하는 추가 인라인 <code>&#x3C;script></code> 태그를 추가합니다. 이렇게 하면 클라이언트 코드가 동일한 <code>assetMap</code>을 읽을 수 있습니다:<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrateRoot <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/client'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">App</span></span> <span class="token keyword module">from</span> <span class="token string">'./App.js'</span><span class="token punctuation">;</span>

<span class="token function">hydrateRoot</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">,</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> assetMap<span class="token operator">=</span><span class="token punctuation">{</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">assetMap</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>클라이언트와 서버 모두 동일한 <code>assetMap</code> 프로퍼티로 <code>App</code>을 렌더링하므로 하이드레이션 오류가 발생하지 않습니다.</section></deepdive></section><section class="level3"aria-labelledby="콘텐츠가-로드되는-동안-더-많은-콘텐츠-스트리밍하기-streaming-more-content-as-it-loads"><h3 id="콘텐츠가-로드되는-동안-더-많은-콘텐츠-스트리밍하기-streaming-more-content-as-it-loads">콘텐츠가 로드되는 동안 더 많은 콘텐츠 스트리밍하기 {/<em>streaming-more-content-as-it-loads</em>/}</h3><p>스트리밍을 사용하면 모든 데이터가 서버에 로드되기 전에도 사용자가 콘텐츠를 볼 수 있습니다. 예를 들어 표지와 친구 및 사진이 있는 사이드바, 글 목록이 표시되는 프로필 페이지를 생각해 보세요.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ProfilePage</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfileLayout</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfileCover</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Sidebar</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Friends</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Photos</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Sidebar</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Posts</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ProfileLayout</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><code>&#x3C;Posts /></code>에 대한 데이터를 로드하는 데 시간이 걸린다고 가정해 보겠습니다. 이상적으로는 게시물을 기다리지 않고 나머지 프로필 페이지 콘텐츠를 사용자에게 표시하고 싶을 것입니다. 이렇게 하려면, <a href="/reference/react/Suspense#displaying-a-fallback-while-content-is-loading"><code>&#x3C;Posts></code>를 <code>&#x3C;Suspense></code> 경계로 감싸면 됩니다</a>.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ProfilePage</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfileLayout</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfileCover</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Sidebar</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Friends</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Photos</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Sidebar</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">PostsGlimmer</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Posts</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ProfileLayout</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>이것은 <code>Posts</code>가 데이터를 로드하기 전에 React가 HTML 스트리밍을 시작하도록 지시합니다. React는 로딩 폴백(<code>PostsGlimmer</code>)을 위한 HTML을 먼저 전송한 다음, <code>Posts</code>가 데이터 로딩을 완료하면 나머지 HTML을 인라인 <code>&#x3C;script></code> 태그와 함께 전송하여 로딩 폴백을 해당 HTML로 대체할 것입니다. 사용자 입장에서는 페이지가 먼저 <code>PostsGlimmer</code>로 표시되고 나중에 <code>Posts</code>로 대체됩니다.<p><a href="/reference/react/Suspense#revealing-nested-content-as-it-loads"><code>&#x3C;Suspense></code> 경계를 더 중첩</a>하여 보다 세분화된 로딩 시퀀스를 만들 수 있습니다.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ProfilePage</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfileLayout</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfileCover</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">BigSpinner</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Sidebar</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Friends</span> <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Photos</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Sidebar</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">PostsGlimmer</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Posts</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ProfileLayout</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>이 예제에서 React는 페이지 스트리밍을 더 일찍 시작할 수 있습니다. <code>ProfileLayout</code>과 <code>ProfileCover</code>만 <code>&#x3C;Suspense></code> 경계로 둘러싸여 있지 않기 때문에 먼저 렌더링을 완료해야 합니다. 하지만 <code>Sidebar</code>, <code>Friends</code>, <code>Photos</code>이 일부 데이터를 로드해야 하는 경우 React는 대신 <code>BigSpinner</code> 폴백을 위한 HTML을 전송합니다. 그러면 더 많은 데이터를 사용할 수 있게 되면 모든 데이터가 표시될 때까지 더 많은 콘텐츠가 계속 표시됩니다.<p>스트리밍은 브라우저에서 React 자체가 로드되거나 앱이 상호작용 가능해질 때까지 기다릴 필요가 없습니다. 서버의 HTML 콘텐츠는 <code>&#x3C;script></code> 태그가 로드되기 전에 점진적으로 표시됩니다.<p><a href="https://github.com/reactwg/react-18/discussions/37">스트리밍 HTML의 작동 방식에 대해 자세히 알아보세요.</a></p><note><p><strong>Suspense 가 활성화된 데이터 소스만 Suspense 컴포넌트를 활성화합니다.</strong> 여기에는 다음이 포함됩니다.<ul><li><a href="https://relay.dev/docs/guided-tour/rendering/loading-states/">Relay</a>와 <a href="https://nextjs.org/docs/getting-started/react-essentials">Next.js</a> 같이 Suspense가 가능한 프레임워크를 사용한 데이터 가져오기<li><a href="/reference/react/lazy"><code>lazy</code></a>를 활용한 지연 로딩 컴포넌트<li><a href="/reference/react/use"><code>use</code></a>를 사용해서 Promise 값 읽기</ul><p>Suspense 는 이펙트 또는 이벤트 핸들러 내부에서 데이터를 가져올 때를 감지하지 <strong>않습니다.</strong><p>위의 <code>Posts</code> 컴포넌트에서 데이터를 로드하는 정확한 방법은 프레임워크에 따라 다릅니다. Suspense 지원 프레임워크를 사용하는 경우 해당 데이터 가져오기 문서에서 자세한 내용을 확인할 수 있습니다.<p>독자적인 프레임워크를 사용하지 않는 Suspense 가능한 데이터 가져오기는 아직 지원되지 않습니다. Suspense 가능한 데이터 소스를 구현하기 위한 요구 사항은 불안정하고 문서화되지 않았습니다. 데이터 소스를 Suspense 와 통합하기 위한 공식 API는 향후 React 버전에서 출시될 예정입니다.</p></note></section><section class="level3"aria-labelledby="셸에-들어갈-내용-지정하기-specifying-what-goes-into-the-shell"><h3 id="셸에-들어갈-내용-지정하기-specifying-what-goes-into-the-shell">셸에 들어갈 내용 지정하기 {/<em>specifying-what-goes-into-the-shell</em>/}</h3><p>앱의 <code>&#x3C;Suspense></code> 경계 밖에 있는 부분을 <em>셸</em>이라고 합니다.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ProfilePage</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfileLayout</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfileCover</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">BigSpinner</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Sidebar</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Friends</span> <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Photos</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Sidebar</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">PostsGlimmer</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Posts</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ProfileLayout</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>사용자가 볼 수 있는 가장 빠른 로딩 상태를 결정합니다.<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfileLayout</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfileCover</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">BigSpinner</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ProfileLayout</span><span class="token operator">></span></code></pre><p>전체 앱을 루트의 <code>&#x3C;Suspense></code> 경계로 감싸면 셸에는 해당 스피너만 포함됩니다. 하지만 화면에 큰 스피너가 표시되면 조금 더 기다렸다가 실제 레이아웃을 보는 것보다 느리고 성가시게 느껴질 수 있으므로 사용자 경험이 좋지 않습니다. 그렇기 때문에 일반적으로 셸이 전체 페이지 레이아웃의 스켈레톤처럼 <em>최소한의 완전함</em>을 느낄 수 있도록 <code>&#x3C;Suspense></code> 경계를 배치하는 것이 좋습니다.<p>전체 셸이 렌더링되면 <code>onShellReady</code> 콜백이 실행됩니다. 보통 이때 스트리밍이 시작됩니다.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> pipe <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderToPipeableStream</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">bootstrapScripts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/main.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">onShellReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">pipe</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>onShellReady</code>가 실행될 때 중첩된 <code>&#x3C;Suspense></code> 경계에 있는 컴포넌트는 여전히 데이터를 로드하고 있을 수 있습니다.</section><section class="level3"aria-labelledby="서버에서-크래시-로깅하기-logging-crashes-on-the-server"><h3 id="서버에서-크래시-로깅하기-logging-crashes-on-the-server">서버에서 크래시 로깅하기 {/<em>logging-crashes-on-the-server</em>/}</h3><p>기본적으로 서버의 모든 오류는 콘솔에 기록됩니다. 이 동작을 재정의하여 크래시 보고서를 기록할 수 있습니다.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> pipe <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderToPipeableStream</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">bootstrapScripts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/main.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">onShellReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">pipe</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">logServerCrashReport</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>사용자 정의 <code>onError</code> 구현을 제공하는 경우 위와 같이 콘솔에 오류를 기록하는 것도 잊지 마세요.</section><section class="level3"aria-labelledby="셸-내부의-오류로부터-복구하기-recovering-from-errors-inside-the-shell"><h3 id="셸-내부의-오류로부터-복구하기-recovering-from-errors-inside-the-shell">셸 내부의 오류로부터 복구하기 {/<em>recovering-from-errors-inside-the-shell</em>/}</h3><p>이 예제에서는 셸에 <code>ProfileLayout</code>, <code>ProfileCover</code>, <code>PostsGlimmer</code>가 포함되어 있습니다.<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ProfilePage</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfileLayout</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfileCover</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">PostsGlimmer</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Posts</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ProfileLayout</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>이러한 컴포넌트를 렌더링하는 동안 오류가 발생하면 React는 클라이언트에 보낼 의미 있는 HTML을 갖지 못합니다. 마지막 수단으로 서버 렌더링에 의존하지 않는 폴백 HTML을 보내려면 <code>onShellError</code>를 재정의하세요.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> pipe <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderToPipeableStream</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">bootstrapScripts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/main.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">onShellReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">pipe</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onShellError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token property-access">statusCode</span> <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">'&#x3C;h1>Something went wrong&#x3C;/h1>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">logServerCrashReport</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>셸을 생성하는 동안 오류가 발생하면 <code>onError</code>와 <code>onShellError</code>가 모두 실행됩니다. 오류 보고에는 <code>onError</code>를 사용하고, 대체 HTML 문서를 보내려면 <code>onShellError</code>를 사용합니다. 폴백 HTML이 오류 페이지일 필요는 없습니다. 대신 클라이언트에서만 앱을 렌더링하는 대체 셸을 포함할 수 있습니다.</section><section class="level3"aria-labelledby="셸-외부의-오류로부터-복구하기-recovering-from-errors-outside-the-shell"><h3 id="셸-외부의-오류로부터-복구하기-recovering-from-errors-outside-the-shell">셸 외부의 오류로부터 복구하기 {/<em>recovering-from-errors-outside-the-shell</em>/}</h3><p>이 예제에서는 <code>&#x3C;Posts /></code> 컴포넌트가 <code>&#x3C;Suspense></code>로 래핑되어 있으므로 셸의 일부가 <em>아닙니다.</em><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ProfilePage</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfileLayout</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ProfileCover</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">PostsGlimmer</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Posts</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ProfileLayout</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><code>Posts</code> 컴포넌트 또는 그 내부 어딘가에서 오류가 발생하면 React는 <a href="/reference/react/Suspense#providing-a-fallback-for-server-errors-and-client-only-content">이를 복구하려고 시도합니다.</a><ol><li>가장 가까운 <code>&#x3C;Suspense></code> 경계(<code>PostsGlimmer</code>)에 대한 로딩 폴백을 HTML로 방출합니다.<li>더 이상 서버에서 <code>Posts</code> 콘텐츠를 렌더링하는 것을 "포기"합니다.<li>자바스크립트 코드가 클라이언트에서 로드되면 React는 클라이언트에서 <code>Posts</code> 렌더링을 <em>재시도</em>합니다.</ol><p>클라이언트에서 <code>Posts</code> 렌더링을 <em>다시 시도해도</em> 실패하면 React는 클라이언트에서 에러를 던집니다. 렌더링 중에 발생하는 모든 에러와 마찬가지로, <a href="/reference/react/Component#static-getderivedstatefromerror">가장 가까운 부모 에러 경계</a>에 따라 사용자에게 에러를 표시하는 방법이 결정됩니다. 실제로는 오류를 복구할 수 없다는 것이 확실해질 때까지 사용자에게 로딩 표시기가 표시된다는 의미입니다.<p>클라이언트에서 <code>Posts</code> 렌더링을 다시 시도하여 성공하면 서버의 로딩 폴백이 클라이언트 렌더링 출력으로 대체됩니다. 사용자는 서버 오류가 발생했다는 사실을 알 수 없습니다. 그러나 서버 <code>onError</code> 콜백 및 클라이언트 <a href="/reference/react-dom/client/hydrateRoot#hydrateroot"><code>onRecoverableError</code></a> 콜백이 실행되어 오류에 대한 알림을 받을 수 있습니다.</section><section class="level3"aria-labelledby="상태-코드-설정하기-setting-the-status-code"><h3 id="상태-코드-설정하기-setting-the-status-code">상태 코드 설정하기 {/<em>setting-the-status-code</em>/}</h3><p>스트리밍에는 장단점이 있습니다. 사용자가 콘텐츠를 더 빨리 볼 수 있도록 가능한 한 빨리 페이지 스트리밍을 시작하고 싶을 수 있습니다. 그러나 스트리밍을 시작하면 더 이상 응답 상태 코드를 설정할 수 없습니다.<p>앱을 셸(특히 <code>&#x3C;Suspense></code> 경계 바깥)과 나머지 콘텐츠로 <a href="#specifying-what-goes-into-the-shell">나누면</a> 이 문제의 일부를 이미 해결한 것입니다. 셸에 오류가 발생하면 오류 상태 코드를 설정할 수 있는 <code>onShellError</code> 콜백을 받게 됩니다. 그렇지 않으면 앱이 클라이언트에서 복구될 수 있으므로 "OK"를 보낼 수 있습니다.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> pipe <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderToPipeableStream</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">bootstrapScripts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/main.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">onShellReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token property-access">statusCode</span> <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">pipe</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onShellError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token property-access">statusCode</span> <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">'&#x3C;h1>Something went wrong&#x3C;/h1>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">logServerCrashReport</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>셸 <em>외부</em>(즉, <code>&#x3C;Suspense></code> 경계 안쪽)에 있는 컴포넌트가 에러를 던져도 React는 렌더링을 멈추지 않습니다. 즉, <code>onError</code> 콜백이 실행되지만 <code>onShellError</code> 대신 <code>onShellReady</code>가 반환됩니다. 이는 <a href="#recovering-from-errors-outside-the-shell">위에서 설명한 것처럼</a> React가 클라이언트에서 해당 오류를 복구하려고 시도하기 때문입니다.<p>그러나 원하는 경우 오류가 발생했다는 사실을 사용하여 상태 코드를 설정할 수 있습니다.<pre class="language-js"><code class="language-js"><span class="token keyword">let</span> didError <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> pipe <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderToPipeableStream</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">bootstrapScripts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/main.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">onShellReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token property-access">statusCode</span> <span class="token operator">=</span> didError <span class="token operator">?</span> <span class="token number">500</span> <span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">pipe</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onShellError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token property-access">statusCode</span> <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">'&#x3C;h1>Something went wrong&#x3C;/h1>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    didError <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">logServerCrashReport</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>이는 초기 셸 콘텐츠를 생성하는 동안 발생한 셸 외부의 오류만 포착하므로 완전한 것은 아닙니다. 일부 콘텐츠에서 오류가 발생했는지 여부를 파악하는 것이 중요한 경우 해당 콘텐츠를 셸로 이동하면 됩니다.</section><section class="level3"aria-labelledby="다양한-오류를-서로-다른-방식으로-처리하기-handling-different-errors-in-different-ways"><h3 id="다양한-오류를-서로-다른-방식으로-처리하기-handling-different-errors-in-different-ways">다양한 오류를 서로 다른 방식으로 처리하기 {/<em>handling-different-errors-in-different-ways</em>/}</h3><p><a href="https://ko.javascript.info/custom-errors">자신만의 <code>Error</code> 서브 클래스를 생성</a>하고 <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Operators/instanceof"><code>instanceof</code></a> 연산자를 사용해 어떤 에러가 발생하는지 확인할 수 있습니다. 예를 들어 사용자 정의 <code>NotFoundError</code>를 정의하고 컴포넌트에서 이를 던질 수 있습니다. 그러면 오류 유형에 따라 <code>onError</code>, <code>onShellReady</code>, <code>onShellError</code> 콜백이 다른 작업을 수행할 수 있습니다.<pre class="language-js"><code class="language-js"><span class="token keyword">let</span> didError <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> caughtError <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>didError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>caughtError <span class="token keyword">instanceof</span> <span class="token class-name">NotFoundError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token number">404</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token number">500</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token number">200</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> pipe <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderToPipeableStream</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">bootstrapScripts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/main.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">onShellReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token property-access">statusCode</span> <span class="token operator">=</span> <span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">pipe</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onShellError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   response<span class="token punctuation">.</span><span class="token property-access">statusCode</span> <span class="token operator">=</span> <span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   response<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">'&#x3C;h1>Something went wrong&#x3C;/h1>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    didError <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    caughtError <span class="token operator">=</span> error<span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">logServerCrashReport</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>셸을 내보내고 스트리밍을 시작하면 상태 코드를 변경할 수 없다는 점에 유의하세요.</section><section class="level3"aria-labelledby="크롤러-및-정적-생성을-위해-모든-콘텐츠가-로드될-때까지-기다리기-waiting-for-all-content-to-load-for-crawlers-and-static-generation"><h3 id="크롤러-및-정적-생성을-위해-모든-콘텐츠가-로드될-때까지-기다리기-waiting-for-all-content-to-load-for-crawlers-and-static-generation">크롤러 및 정적 생성을 위해 모든 콘텐츠가 로드될 때까지 기다리기 {/<em>waiting-for-all-content-to-load-for-crawlers-and-static-generation</em>/}</h3><p>스트리밍은 콘텐츠가 제공될 때 바로 볼 수 있기 때문에 더 나은 사용자 경험을 제공합니다.<p>그러나 크롤러가 페이지를 방문하거나 빌드 시점에 페이지를 생성하는 경우 모든 콘텐츠를 점진적으로 표시하는 대신 모든 콘텐츠를 먼저 로드한 다음 최종 HTML 출력을 생성하는 것이 좋을 수 있습니다.<p><code>onAllReady</code> 콜백을 사용하여 모든 콘텐츠가 로드될 때까지 기다릴 수 있습니다.<pre class="language-js"><code class="language-js"><span class="token keyword">let</span> didError <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> isCrawler <span class="token operator">=</span> <span class="token comment">// ... 봇 탐지 전략에 따라 달라집니다 ...</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> pipe <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderToPipeableStream</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">bootstrapScripts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/main.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">onShellReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isCrawler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token property-access">statusCode</span> <span class="token operator">=</span> didError <span class="token operator">?</span> <span class="token number">500</span> <span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">pipe</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onShellError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    response<span class="token punctuation">.</span><span class="token property-access">statusCode</span> <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">'&#x3C;h1>Something went wrong&#x3C;/h1>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onAllReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isCrawler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token property-access">statusCode</span> <span class="token operator">=</span> didError <span class="token operator">?</span> <span class="token number">500</span> <span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">pipe</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>      
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    didError <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">logServerCrashReport</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>일반 방문자는 점진적으로 로드되는 콘텐츠 스트림을 받게 됩니다. 크롤러는 모든 데이터가 로드된 후 최종 HTML 출력을 받게 됩니다. 그러나 이는 크롤러가 <em>모든</em> 데이터를 기다려야 한다는 것을 의미하며, 그중 일부는 로드 속도가 느리거나 오류가 발생할 수 있습니다. 앱에 따라 크롤러에도 셸을 보내도록 선택할 수 있습니다.</section><section class="level3"aria-labelledby="서버-렌더링-중단하기-aborting-server-rendering"><h3 id="서버-렌더링-중단하기-aborting-server-rendering">서버 렌더링 중단하기 {/<em>aborting-server-rendering</em>/}</h3><p>시간 초과 후 서버 렌더링을 강제로 '포기'할 수 있습니다.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> pipe<span class="token punctuation">,</span> abort <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderToPipeableStream</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>React는 나머지 로딩 폴백을 HTML로 플러시하고 나머지는 클라이언트에서 렌더링을 시도합니다.<span style="float:footnote"><a href="../../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>