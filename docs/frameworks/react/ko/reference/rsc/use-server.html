<!doctype html><html lang="ko"><meta charset="utf-8"><title>"'use server'"</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="use-server"><h1 id="use-server">"'use server'"</h1><p>titleForTitleTag: "'use server' 지시어" canary: true</p><canary><p><code>'use server'</code>는 <a href="/learn/start-a-new-react-project#bleeding-edge-react-frameworks">React 서버 컴포넌트를 사용</a>하거나 그와 호환되는 라이브러리를 만들 때만 필요합니다.</p></canary><intro><p><code>'use server'</code>는 클라이언트 측 코드에서 호출할 수 있는 서버 측 함수를 표시합니다.</p></intro><inlinetoc><section class="level2"aria-labelledby="레퍼런스-reference"><h2 id="레퍼런스-reference">레퍼런스 {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="use-server-use-server"><h3 id="use-server-use-server"><code>'use server'</code> {/<em>use-server</em>/}</h3><p>함수가 클라이언트에서 실행될 수 있음을 표시하기 위해, 비동기 함수의 맨 위에 <code>'use server';</code>를 추가하세요. 우리는 이를 <em>Server Actions</em> 이라고 부릅니다.<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">'use server'</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Server Action을 클라이언트에서 호출하면, 직렬화된 인자의 사본을 포함하는 서버로의 네트워크 요청이 생성됩니다. Server Action이 값을 반환하면, 그 값은 직렬화되고 클라이언트에 반환됩니다.<p>함수 각각에 <code>'use server'</code>를 표기하는 대신, 파일의 맨 위에 지시어를 추가하여 파일의 모든 export를, 클라이언트를 포함한 모든 곳에서 사용할 수 있는 Server Action으로 표기할 수 있습니다.<section class="level4"aria-labelledby="주의사항-caveats"><h4 id="주의사항-caveats">주의사항 {/<em>caveats</em>/}</h4><ul><li><code>'use server'</code>는 함수 또는 모듈의 맨 처음에 있어야 합니다. import를 포함한 다른 코드보다 위에 있어야 합니다.(지시어 위의 주석은 괜찮습니다). 백틱이 아닌 단일 또는 이중 따옴표로 작성해야 합니다.<li><code>'use server'</code>는 서버 측 파일에서만 사용할 수 있습니다. 결과적인 Server Action은 props를 통해 클라이언트 컴포넌트로 전달할 수 있습니다. 제공되는 <a href="#serializable-parameters-and-return-values">직렬화 타입</a>을 참고하세요.<li>Server Action을 <a href="/reference/rsc/use-client">클라이언트 코드</a>에서 import 하기 위해, 지시어는 모듈 수준에서 사용되어야 합니다.<li>기본 네트워크 호출이 항상 비동기이므로 <code>'use server'</code>는 비동기 함수에서만 사용할 수 있습니다.<li>항상 Server Action의 인자를 신뢰할 수 없는 입력으로 취급하고 모든 변경을 검토하세요. <a href="#security">보안 고려사항</a>을 확인하세요.<li>Server Action은 <a href="/reference/react/useTransition">transition</a> 안에서 호출되어야합니다. <a href="/reference/react-dom/components/form#props"><code>&#x3C;form action></code></a> 또는 <a href="/reference/react-dom/components/input#props"><code>formAction</code></a>로 전달된 Server Action은 자동으로 transition 내에서 호출됩니다.<li>Server Action은 서버 측 상태를 업데이트하는 mutation을 위해 설계되었으며 데이터 fetching에는 권장되지 않습니다. 따라서 서버 액션을 구현하는 프레임워크는 일반적으로 한 번에 하나의 액션을 처리하며 반환 값을 캐시할 방법이 없습니다.</ul></section></section><section class="level3"aria-labelledby="보안-고려사항-security"><h3 id="보안-고려사항-security">보안 고려사항 {/<em>security</em>/}</h3><p>Server Action에 대한 인수는 완전히 클라이언트에서 제어됩니다. 보안을 위해 항상 신뢰할 수 없는 입력으로 취급하여, 인자를 적절하게 검증하고 이스케이프 하는지 확인하세요.<p>Server Action에서 로그인한 사용자가 해당 작업을 수행할 수 있는지 확인하세요.</p><wip><p>Server Action에서 중요한 데이터를 전송하지 않도록 하기 위해, 고유한 값과 객체가 클라이언트 코드로 전달되는 것을 방지하기 위한 실험적인 테인트 API가 있습니다.<p><a href="/reference/react/experimental_taintUniqueValue">experimental_taintUniqueValue</a>와 <a href="/reference/react/experimental_taintObjectReference">experimental_taintObjectReference</a>를 참고하세요.</p></wip></section><section class="level3"aria-labelledby="직렬화-가능-인수와-반환값-serializable-parameters-and-return-values"><h3 id="직렬화-가능-인수와-반환값-serializable-parameters-and-return-values">직렬화 가능 인수와 반환값 {/<em>serializable-parameters-and-return-values</em>/}</h3><p>클라이언트 코드가 네트워크를 통해 서버 작업을 호출할 때 전달된 인수는 모두 직렬화되어야 합니다.<p>다음은 지원되는 Server Action 인자의 타입입니다.<ul><li>Primitives<ul><li><a href="https://developer.mozilla.org/ko/docs/Glossary/String">string</a><li><a href="https://developer.mozilla.org/ko/docs/Glossary/Number">number</a><li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/BigInt">bigint</a><li><a href="https://developer.mozilla.org/ko/docs/Glossary/Boolean">boolean</a><li><a href="https://developer.mozilla.org/ko/docs/Glossary/Undefined">undefined</a><li><a href="https://developer.mozilla.org/ko/docs/Glossary/Null">null</a><li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Symbol">symbol</a>, <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Symbol/for"><code>Symbol.for</code></a>를 통해 전역 Symbol로 등록된 Symbol 한정</ul><li>직렬화 가능한 값을 포함한 Iterables<ul><li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/String">String</a><li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Array">Array</a><li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a><li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a><li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/TypedArray">TypedArray</a>와 <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">ArrayBuffer</a></ul><li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Date">Date</a><li><a href="https://developer.mozilla.org/ko/docs/Web/API/FormData">FormData</a> 인스턴스<li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Operators/Object_initializer">object initializers</a>로 직렬화 가능한 속성과 함께 생성된 일반 <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Object">objects</a><li>Server Action인 함수<li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promises</a></ul><p>특히 다음은 지원되지 않습니다.<ul><li>React 엘리먼트 또는 <a href="/learn/writing-markup-with-jsx">JSX</a><li>컴포넌트 함수 또는 Server Action이 아닌 다른 함수를 포함하는 함수<li><a href="https://developer.mozilla.org/ko/docs/Learn/JavaScript/Objects/Classes_in_JavaScript">클래스</a><li>클래스의 인스턴스인 객체(언급된 내장 객체 제외)또는 <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Object#null-prototype_objects">null 프로토타입</a>이 있는 개체<li>전역에 등록되지 않은 Symbol, 예. <code>Symbol('my new symbol')</code></ul><p>지원되는 직렬화 가능한 반환 값은 경계 클라이언트 컴포넌트의 <a href="/reference/react/use-client#passing-props-from-server-to-client-components">직렬화 가능한 props</a>와 동일합니다.</section><section class="level3"aria-labelledby="server-action-형식-server-actions-in-forms"><h3 id="server-action-형식-server-actions-in-forms">Server Action 형식 {/<em>server-actions-in-forms</em>/}</h3><p>Server Action의 가장 일반적인 사용 사례는, 데이터를 변경하는 서버 함수를 호출하는 것입니다. 브라우저에서 <a href="https://developer.mozilla.org/ko/docs/Web/HTML/Element/form">HTML 폼 엘리먼트</a>는 사용자가 mutation을 제출하는 전통적인 접근 방식입니다. React 서버 컴포넌트로, React는 <a href="/reference/react-dom/components/form">forms</a>에서 Server Action에 대한 최상의 지원을 제공합니다.<p>사용자가 사용자 이름을 요청할 수 있는 양식이 있습니다.<pre class="language-js"><code class="language-js"><span class="token comment">// App.js</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">requestUsername</span><span class="token punctuation">(</span><span class="token parameter">formData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">'use server'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> username <span class="token operator">=</span> formData<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>requestUsername<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"username"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span><span class="token maybe-class-name">Request</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>예시에서 <code>requestUsername</code>는 <code>&#x3C;form></code>을 통한 Server Action입니다. 사용자가 이 양식을 제출하면 서버 함수인 <code>requestUsername</code>에 네트워크 요청이 있습니다. 폼에서 Server Action을 호출할 때 React는 폼의<codestep step="{1}"><a href="https://developer.mozilla.org/ko/docs/Web/API/FormData">FormData</a></codestep>를 Server Action의 첫 번째 인자로 제공합니다.<p>Server Action을 폼 <code>action</code>에 전달하여, React는 폼을 <a href="https://developer.mozilla.org/ko/docs/Glossary/Progressive_Enhancement">점진적 향상</a>할 수 있습니다. 이것은 자바스크립트 번들이 로드되기 전에 양식을 제출할 수 있다는 것을 의미합니다.<section class="level4"aria-labelledby="폼에서-반환-값-처리-handling-return-values"><h4 id="폼에서-반환-값-처리-handling-return-values">폼에서 반환 값 처리 {/<em>handling-return-values</em>/}</h4><p>점진적 향상을 지원하며 Server Action의 결과를 기반으로 UI를 업데이트하려면, <a href="/reference/react/useActionState"><code>useActionState</code></a>를 사용하세요.<pre class="language-js"><code class="language-js"><span class="token comment">// requestUsername.js</span>
<span class="token string">'use server'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">requestUsername</span><span class="token punctuation">(</span><span class="token parameter">formData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> username <span class="token operator">=</span> formData<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">canRequest</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword control-flow">return</span> <span class="token string">'successful'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token string">'failed'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// UsernameForm.js</span>
<span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useActionState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">requestUsername</span> <span class="token keyword module">from</span> <span class="token string">'./requestUsername'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">UsernameForm</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> action<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>requestUsername<span class="token punctuation">,</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> <span class="token string">'n/a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>action<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"username"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span><span class="token maybe-class-name">Request</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Last</span> submission request returned<span class="token operator">:</span> <span class="token punctuation">{</span>state<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>대부분의 Hook과 마찬가지로 <code>useActionState</code>는<codestep step="{1}"><a href="/reference/rsc/use-client">client code</a></codestep>에서만 호출할 수 있습니다.</section></section><section class="level3"aria-labelledby="외부에서-server-action-호출하기-calling-a-server-action-outside-of-form"><h3 id="외부에서-server-action-호출하기-calling-a-server-action-outside-of-form"><code>&#x3C;form></code>외부에서 Server Action 호출하기 {/<em>calling-a-server-action-outside-of-form</em>/}</h3><p>Server Action은 노출된 서버 엔드포인트이며 클라이언트 코드 어디에서나 호출할 수 있습니다.<p><a href="/reference/react-dom/components/form">form</a> 외부에서 Server Action을 사용할 때, <a href="/reference/react/useTransition">Transition</a>에서 서버 액션을 호출하면 로딩 인디케이터를 표시하고, <a href="/reference/react/useOptimistic">낙관적 상태 업데이트</a>를 표시하며 예기치 않은 오류를 처리할 수 있습니다. 폼은 transition의 Server Action을 자동으로 래핑합니다.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports">incrementLike</span> <span class="token keyword module">from</span> <span class="token string">'./actions'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useTransition <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">LikeButton</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isPending<span class="token punctuation">,</span> startTransition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useTransition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>likeCount<span class="token punctuation">,</span> setLikeCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> currentCount <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">incrementLike</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setLikeCount</span><span class="token punctuation">(</span>currentCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Total</span> <span class="token maybe-class-name">Likes</span><span class="token operator">:</span> <span class="token punctuation">{</span>likeCount<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span> disabled<span class="token operator">=</span><span class="token punctuation">{</span>isPending<span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Like</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// actions.js</span>
<span class="token string">'use server'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> likeCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">incrementLike</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  likeCount<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> likeCount<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Server Action 반환 값을 읽으려면 반환된 promise를 <code>await</code> 해야합니다. <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>