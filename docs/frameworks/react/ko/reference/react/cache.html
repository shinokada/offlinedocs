<!doctype html><html lang="ko"><meta charset="utf-8"><title>cache</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="cache"><h1 id="cache">cache</h1><p>canary: true</p><canary>* `cache`는 오직 [React 서버 컴포넌트](/blog/2023/03/22/react-labs-what-we-have-been-working-on-march-2023#react-server-components)와 함께 사용됩니다. React 서버 컴포넌트를 지원하는 [프레임워크](/learn/start-a-new-react-project#bleeding-edge-react-frameworks)를 확인해 보세요.<ul><li><code>cache</code>는 <a href="/community/versioning-policy#canary-channel">Canary</a>와 <a href="/community/versioning-policy#experimental-channel">실험</a> 채널에서만 사용할 수 있습니다. 프로덕션 환경에서 <code>cache</code>를 사용하기 전에 이 한계점에 대해 인지하고 있어야 합니다. React의 릴리즈 채널에 대한 자세한 내용은 <a href="/community/versioning-policy#all-release-channels">여기</a>를 참조하세요.</ul><intro><p><code>cache</code>는 가져온 데이터나 연산의 결과를 캐싱하게 해줍니다.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> cachedFn <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="레퍼런스-reference"><h2 id="레퍼런스-reference">레퍼런스 {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="cachefn-cache"><h3 id="cachefn-cache"><code>cache(fn)</code> {/<em>cache</em>/}</h3><p>컴포넌트 외부에서 <code>cache</code>를 호출해 캐싱 기능을 가진 함수의 한 버전을 만들 수 있습니다.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">calculateMetrics</span> <span class="token keyword module">from</span> <span class="token string">'lib/metrics'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getMetrics <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>calculateMetrics<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Chart</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>data<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">getMetrics</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><code>getMetrics</code>가 처음 <code>data</code>를 호출할 때, <code>getMetrics</code>는 <code>calculateMetrics(data)</code>를 호출하고 캐시에 결과를 저장합니다. <code>getMetrics</code>가 같은 <code>data</code>와 함께 다시 호출되면, <code>calculateMetrics(data)</code>를 다시 호출하는 대신에 캐싱 된 결과를 반환합니다.<p><a href="#usage">아래에 있는 예시를 참고하세요.</a><section class="level4"aria-labelledby="매개변수-parameters"><h4 id="매개변수-parameters">매개변수 {/<em>parameters</em>/}</h4><ul><li><code>fn</code>: 결과를 저장하고 싶은 함수. <code>fn</code>는 어떤 인자값도 받을 수 있고 어떤 결과도 반환할 수 있습니다.</ul></section><section class="level4"aria-labelledby="반환값-returns"><h4 id="반환값-returns">반환값 {/<em>returns</em>/}</h4><p><code>cache</code>는 같은 타입 시그니처를 가진 <code>fn</code>의 캐싱 된 버전을 반환합니다. 이 과정에서 <code>fn</code>를 호출하지 않습니다.<p>주어진 인자값과 함께 <code>cachedFn</code>를 호출할 때, 캐시에 캐싱 된 데이터가 있는지 먼저 확인합니다. 만약 캐싱 된 데이터가 있다면, 그 결과를 반환합니다. 만약 없다면, 매개변수와 함께 <code>fn</code>을 호출하고 결과를 캐시에 저장하고 값을 반환합니다. <code>fn</code>가 유일하게 호출되는 경우는 캐싱 된 데이터가 없는 경우입니다.</p><note><p>입력을 기반으로 반환 값 캐싱을 최적화하는 것을 <a href="https://ko.wikipedia.org/wiki/%EB%A9%94%EB%AA%A8%EC%9D%B4%EC%A0%9C%EC%9D%B4%EC%85%98"><em>메모이제이션</em></a>라고 합니다. <code>cache</code>에서 반환되는 함수를 메모화된 함수라고 합니다.</p></note></section><section class="level4"aria-labelledby="주의-caveats"><h4 id="주의-caveats">주의 {/<em>caveats</em>/}</h4><ul><li>React는 서버 요청마다 모든 메모화된 함수들을 위해 캐시를 무효화합니다.<li><code>cache</code>를 호출할 때마다 새 함수가 생성됩니다. 즉, 동일한 함수로 <code>cache</code>를 여러 번 호출하면 동일한 캐시를 공유하지 않는 다른 메모화된 함수가 반환됩니다.<li><code>cachedFn</code> 또한 캐시 에러를 잡아냅니다. <code>fn</code>가 특정 인수에 대해 에러를 던지면 캐싱 되고, 동일한 인수로 <code>cachedFn</code>를 호출하면 동일한 에러가 다시 발생합니다.<li><code>cache</code>는 <a href="/blog/2023/03/22/react-labs-what-we-have-been-working-on-march-2023#react-server-components">서버 컴포넌트</a>에서만 사용가능합니다.</ul></section></section></section><section class="level2"aria-labelledby="사용법-usage"><h2 id="사용법-usage">사용법 {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="고비용-연산-캐싱하기-cache-expensive-computation"><h3 id="고비용-연산-캐싱하기-cache-expensive-computation">고비용 연산 캐싱하기 {/<em>cache-expensive-computation</em>/}</h3><p>반복 작업을 피하기 위해 <code>cache</code>를 사용하세요.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">calculateUserMetrics</span> <span class="token keyword module">from</span> <span class="token string">'lib/user'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getUserMetrics <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>calculateUserMetrics<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Profile</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>user<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> metrics <span class="token operator">=</span> <span class="token function">getUserMetrics</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TeamReport</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>users<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> user <span class="token keyword">in</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> metrics <span class="token operator">=</span> <span class="token function">getUserMetrics</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>같은 <code>user</code> 객체가 <code>Profile</code>과 <code>TeamReport</code>에서 렌더될 때, 두 컴포넌트는 일을 공유하고, <code>user</code>를 위한 <code>calculateUserMetrics</code>를 한 번만 호출합니다.<p><code>Profile</code>이 먼저 렌더된다고 가정해 봅시다. <code>Profile</code>은<codestep step="{1}"><code>getUserMetrics</code></codestep>를 호출하고, 캐싱 된 결과가 있는지 확인합니다. <code>user</code>와 함께 <code>getUserMetrics</code>를 처음 호출하기 때문에, 현재 저장된 캐시는 없습니다. <code>getUserMetrics</code>는 <code>user</code>와 함께 <code>calculateUserMetrics</code>를 호출하고 캐시에 결괏값을 저장합니다.<p><code>TeamReport</code>가 <code>users</code> 목록과 함께 렌더될 때 같은 <code>user</code> 객체를 사용하게 되고, 이는<codestep step="{2}"><code>getUserMetrics</code></codestep>를 호출해 캐시에서 결괏값을 읽어옵니다.</p><pitfall><section class="level5"aria-labelledby="다른-메모화된-함수를-호출하면-다른-캐시에서-읽습니다-pitfall-different-memoized-functions"><h5 id="다른-메모화된-함수를-호출하면-다른-캐시에서-읽습니다-pitfall-different-memoized-functions">다른 메모화된 함수를 호출하면 다른 캐시에서 읽습니다. {/<em>pitfall-different-memoized-functions</em>/}</h5><p>같은 캐시에 접근하기 위해선, 컴포넌트는 반드시 같은 메모화된 함수를 호출해야 합니다.<pre class="language-js"><code class="language-js"><span class="token comment">// Temperature.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>calculateWeekReport<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./report'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Temperature</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>cityData<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 🚩 Wrong: 컴포넌트에서 `cache`를 호출하면 각 렌더링에 대해 `getWeekReport`가 생성됩니다.</span>
  <span class="token keyword">const</span> getWeekReport <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>calculateWeekReport<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">getWeekReport</span><span class="token punctuation">(</span>cityData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// Precipitation.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>calculateWeekReport<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./report'</span><span class="token punctuation">;</span>

<span class="token comment">// 🚩 Wrong: `getWeekReport`는 `Precipitation` 컴포넌트에서만 적용할 수 있습니다.</span>
<span class="token keyword">const</span> getWeekReport <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>calculateWeekReport<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Precipitation</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>cityData<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">getWeekReport</span><span class="token punctuation">(</span>cityData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>위의 예시에서,<codestep step="{2}"><code>Precipitation</code></codestep>와<codestep step="{1}"><code>Temperature</code></codestep>는 각각 <code>cache</code>를 호출하여 자체 캐시 조회를 통해 새로운 메모화된 함수를 만들어 냅니다. 두 컴포넌트가 같은 <code>cityData</code>를 렌더링한다면, <code>calculateWeekReport</code>를 호출하는 반복 작업을 하게 됩니다.<p>게다가, <code>Temperature</code>는 컴포넌트가 렌더될 때마다 어떤 캐시 공유도 허용하지 않는<codestep step="{1}">새로운 메모화된 함수</codestep>를 생성하게 됩니다.<p>캐시 사용을 늘리고 일을 줄이기 위해서 두 컴포넌트는 같은 캐시에 접근하는 같은 메모화된 함수를 호출해야 합니다. 대신, 컴포넌트끼리 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import"><code>import</code> 할 수 있는</a> 전용 모듈에 메모화된 함수를 정의하세요.<pre class="language-js"><code class="language-js"><span class="token comment">// getWeekReport.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>calculateWeekReport<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./report'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">cache</span><span class="token punctuation">(</span>calculateWeekReport<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// Temperature.js</span>
<span class="token keyword module">import</span> <span class="token imports">getWeekReport</span> <span class="token keyword module">from</span> <span class="token string">'./getWeekReport'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Temperature</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>cityData<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">getWeekReport</span><span class="token punctuation">(</span>cityData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// Precipitation.js</span>
<span class="token keyword module">import</span> <span class="token imports">getWeekReport</span> <span class="token keyword module">from</span> <span class="token string">'./getWeekReport'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Precipitation</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>cityData<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">getWeekReport</span><span class="token punctuation">(</span>cityData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>여기 두 컴포넌트가 같은 캐시를 읽고 쓰기 위해 <code>./getWeekReport.js</code>로 부터 export해 온<codestep step="{3}">같은 메모화된 함수</codestep>를 호출했습니다.</section></pitfall></section><section class="level3"aria-labelledby="데이터의-스냅샷-공유하기-take-and-share-snapshot-of-data"><h3 id="데이터의-스냅샷-공유하기-take-and-share-snapshot-of-data">데이터의 스냅샷 공유하기 {/<em>take-and-share-snapshot-of-data</em>/}</h3><p>컴포넌트끼리 데이터의 스냅샷을 공유하기 위해선 <code>fetch</code>와 같이 데이터를 받아오는 함수와 함께 <code>cache</code>를 사용해야 합니다. 여러 컴포넌트가 같은 데이터를 받아올 때, 요청이 한 번만 발생하고 받아온 데이터는 캐싱 되며 컴포넌트끼리 공유됩니다. 모든 컴포넌트는 서버 렌더링 전반에 걸쳐 동일한 데이터 스냅샷을 참조합니다.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>fetchTemperature<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./api.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getTemperature <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">city</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> <span class="token function">fetchTemperature</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AnimatedWeatherCard</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>city<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> temperature <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getTemperature</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MinimalWeatherCard</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>city<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> temperature <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getTemperature</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><code>AnimatedWeatherCard</code>와 <code>MinimalWeatherCard</code>가 같은<codestep step="{1}">도시</codestep>를 렌더링할 때,<codestep step="{2}">메모화된 함수</codestep>로 부터 같은 데이터의 스냅샷을 받게 됩니다.<p><code>AnimatedWeatherCard</code>와 <code>MinimalWeatherCard</code>가 다른<codestep step="{1}">도시</codestep>를<codestep step="{2}"><code>getTemperature</code></codestep>의 인자로 받게 된다면, <code>fetchTemperature</code>는 두 번 호출되고 호출마다 다른 데이터를 받게 됩니다.<p><codestep step="{1}">도시</codestep>가 캐시 키처럼 동작하게 됩니다.</p><note><p><codestep step="{3}">비동기 렌더링</codestep>은 <a href="/blog/2023/03/22/react-labs-what-we-have-been-working-on-march-2023#react-server-components">서버 컴포넌트</a>에서만 지원됩니다.<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AnimatedWeatherCard</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>city<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> temperature <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getTemperature</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>클라이언트 컴포넌트에서 비동기 데이터를 사용하는 컴포넌트를 렌더링하고 싶다면 <a href="/reference/react/use"><code>use</code></a> 문서를 참고하세요.</p></note></section><section class="level3"aria-labelledby="사전에-데이터-받아두기-preload-data"><h3 id="사전에-데이터-받아두기-preload-data">사전에 데이터 받아두기 {/<em>preload-data</em>/}</h3><p>장시간 실행되는 데이터 가져오기를 캐싱하면, 컴포넌트를 렌더링하기 전에 비동기 작업을 시작할 수 있습니다.<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> getUser <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Profile</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>id<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>section</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>img</span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span><span class="token property-access">profilePic</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h2</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>user<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>section</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Page</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>id<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ✅ Good: 사용자 데이터 가져오기를 시작합니다.</span>
  <span class="token function">getUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ... 몇몇의 계산 작업들</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">Profile</span></span> <span class="token attr-name">id</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><code>Page</code>를 렌더링할 때, 컴포넌트는<codestep step="{1}"><code>getUser</code></codestep>를 호출하지만, 반환된 데이터를 사용하지 않는다는 점에 유의하세요. 이 초기<codestep step="{1}"><code>getUser</code></codestep>호출은 페이지가 다른 계산 작업을 수행하고 자식을 렌더링하는 동안 발생하는, 비동기 데이터베이스 쿼리를 시작합니다.<p><code>Profile</code>을 렌더링할 때,<codestep step="{2}"><code>getUser</code></codestep>를 다시 호출합니다. 초기<codestep step="{1}"><code>getUser</code></codestep>호출이 이미 사용자 데이터에 반환되고 캐싱 되었다면, <code>Profile</code>이<codestep step="{2}">해당 데이터를 요청하고 기다릴 때</codestep>, 다른 원격 프로시저 호출 없이 쉽게 캐시에서 읽어올 수 있습니다.<codestep step="{1}">초기 데이터 요청</codestep>이 완료되지 않은 경우, 이 패턴으로 데이터를 미리 로드하면 데이터를 받아올 때 생기는 지연이 줄어듭니다.</p><deepdive><section class="level4"aria-labelledby="비동기-작업-캐싱하기-caching-asynchronous-work"><h4 id="비동기-작업-캐싱하기-caching-asynchronous-work">비동기 작업 캐싱하기 {/<em>caching-asynchronous-work</em>/}</h4><p><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/async_function">비동기 함수</a>의 결과를 보면, <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>를 받습니다. 이 Promise는 작업에 대한 상태(<em>보류 중</em>, <em>완료됨</em>, <em>실패함</em>)와 최종적으로 확정된 결과를 가지고 있습니다.<p>이 예시에서, 비동기 함수<codestep step="{1}"><code>fetchData</code></codestep>는 <code>fetch</code>를 기다리는 Promise를 반환합니다.<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> getData <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>fetchData<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ... some computational work  </span>
  <span class="token keyword control-flow">await</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><codestep step="{2}"><code>getData</code></codestep>를 처음 호출할 때,<codestep step="{1}"><code>fetchData</code></codestep>에서 반환된 Promise가 캐싱 됩니다. 이후 조회 시, 같은 Promise를 반환합니다.<p>첫 번째<codestep step="{2}"><code>getData</code></codestep>호출은 <code>기다리지 않지만(await)</code><codestep step="{3}">두 번째</codestep>는 기다립니다. <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Operators/await"><code>await</code></a> 는 자바스크립트 연산자로, 기다렸다가 확정된 Promise의 결과를 반환합니다. 첫 번째<codestep step="{2}"><code>getData</code></codestep>은 단순히 조회할 두 번째<codestep step="{3}"><code>getData</code></codestep>에 대한 Promise를 캐싱하기 위해 <code>fetch</code>를 실행합니다.<p><codestep step="{3}">두 번째 호출</codestep>에서 Promise가 여전히 <em>보류 중</em>이면, 결과를 기다리는 동안 <code>await</code>가 일시 중지됩니다. 이 최적화는 데이터 불러오기를 기다리는 동안 React가 계산 작업을 계속할 수 있게 해<codestep step="{3}">두 번째 호출</codestep>에 대한 대기 시간을 줄일 수 있게 합니다.<p><em>완료된</em> 결과나 에러에 대한 Promise가 이미 정해진 경우, <code>await</code>는 즉시 값을 반환합니다. 두 결과 모두 성능상의 이점이 있습니다.</p><pitfall><section class="level5"aria-labelledby="컴포넌트-외부에서-메모화된-함수를-사용하면-캐시가-사용되지-않습니다-pitfall-memoized-call-outside-component"><h5 id="컴포넌트-외부에서-메모화된-함수를-사용하면-캐시가-사용되지-않습니다-pitfall-memoized-call-outside-component">컴포넌트 외부에서 메모화된 함수를 사용하면 캐시가 사용되지 않습니다. {/<em>pitfall-memoized-call-outside-component</em>/}</h5><pre class="language-jsx"><code class="language-jsx"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getUser <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">userId</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 🚩 Wrong: 컴포넌트 외부에서 메모화된 함수를 호출하면 메모화하지 않습니다.</span>
<span class="token function">getUser</span><span class="token punctuation">(</span><span class="token string">'demo-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">DemoProfile</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ✅ Good: `getUser`는 메모화 됩니다.</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token string">'demo-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">Profile</span></span> <span class="token attr-name">user</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>React는 컴포넌트에서 메모화된 함수의 캐시 접근만 제공합니다. 컴포넌트 외부에서<codestep step="{1}"><code>getUser</code></codestep>를 호출하면 여전히 함수를 실행하지만, 캐시를 읽거나 업데이트하지는 않습니다.<p>이는 컴포넌트에서만 접근할 수 있는 <a href="/learn/passing-data-deeply-with-context">컨텍스트</a>를 통해 캐시 접근이 제공되기 때문입니다.</section></pitfall><deepdive></deepdive></section><section class="level4"aria-labelledby="cache-memo-or-usememo-중-언제-어떤-걸-사용해야-하나요-cache-memo-usememo"><h4 id="cache-memo-or-usememo-중-언제-어떤-걸-사용해야-하나요-cache-memo-usememo"><code>cache</code>, <a href="/reference/react/memo"><code>memo</code></a>, or <a href="/reference/react/useMemo"><code>useMemo</code></a> 중 언제 어떤 걸 사용해야 하나요? {/<em>cache-memo-usememo</em>/}</h4><p>언급된 모든 API들은 메모이제이션을 제공하지만, 메모화 대상, 캐시 접근 권한, 캐시 무효화 시점에 차이가 있습니다.</section><section class="level4"aria-labelledby="usememo-deep-dive-use-memo"><h4 id="usememo-deep-dive-use-memo"><code>useMemo</code> {/<em>deep-dive-use-memo</em>/}</h4><p>일반적으로 <a href="/reference/react/useMemo"><code>useMemo</code></a>는 클라이언트 컴포넌트에서 렌더링에 걸쳐 고비용의 계산을 캐싱할 때 사용합니다. 예를 들어 컴포넌트 내에서 데이터의 변환을 메모화할 수 있습니다.<pre class="language-jsx"><code class="language-jsx"><span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">WeatherReport</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>record<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> avgTemp <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">calculateAvg</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">,</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> record <span class="token operator">=</span> <span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">WeatherReport</span></span> <span class="token attr-name">record</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>record<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">WeatherReport</span></span> <span class="token attr-name">record</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>record<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>이 예시에서 <code>App</code>은 두 개의 <code>WeatherReport</code>를 같은 데이터와 함께 렌더했습니다. 두 컴포넌트가 같은 작업을 수행했음에도 불구하고 서로 작업을 공유하지 않습니다. <code>useMemo</code>의 캐시는 해당 컴포넌트 내부에만 있습니다.<p>하지만 <code>useMemo</code>는 <code>App</code>이 다시 렌더링 되고 <code>record</code> 객체가 변경되지 않는 경우, 각 컴포넌트 인스턴스가 작업을 건너뛰고 메모화된 <code>avgTemp</code>의 값을 사용합니다. <code>useMemo</code>는 주어진 종속성을 가진 <code>avgTemp</code>의 마지막 계산만 캐싱합니다.</section><section class="level4"aria-labelledby="cache-deep-dive-cache"><h4 id="cache-deep-dive-cache"><code>cache</code> {/<em>deep-dive-cache</em>/}</h4><p>일반적으로 <code>cache</code>는 서버 컴포넌트에서 컴포넌트 간에 공유할 수 있는 작업을 메모화하기 위해 사용합니다.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> cachedFetchReport <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>fetchReport<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">WeatherReport</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>city<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">cachedFetchReport</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> city <span class="token operator">=</span> <span class="token string">"Los Angeles"</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">WeatherReport</span> city<span class="token operator">=</span><span class="token punctuation">{</span>city<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">WeatherReport</span> city<span class="token operator">=</span><span class="token punctuation">{</span>city<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>이전 예시를 <code>cache</code>를 이용해 재작성하면, 이 경우에<codestep step="{3}"><code>WeatherReport</code>의 두 번째 인스턴스</codestep>는 중복 작업을 생략하고<codestep step="{1}">첫 번째 <code>WeatherReport</code></codestep>와 같은 캐시를 읽게 됩니다. 이전 예시와 다른 점은 계산에만 사용되는 <code>useMemo</code>와 달리 <code>cache</code>는<codestep step="{2}">데이터 가져오기를 메모화하는 데</codestep>도 권장된다는 점입니다.<p>이때, <code>cache</code>는 서버 컴포넌트에서만 사용해야 하며 캐시는 서버 요청 전체에서 무효화가 됩니다.</section><section class="level4"aria-labelledby="memo-deep-dive-memo"><h4 id="memo-deep-dive-memo"><code>memo</code> {/<em>deep-dive-memo</em>/}</h4><p><a href="reference/react/memo"><code>memo</code></a>는 프로퍼티가 변경되지 않았을 때 컴포넌트가 재 렌더링 되는 것을 막기 위해 사용합니다.<pre class="language-js"><code class="language-js"><span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">WeatherReport</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>record<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> avgTemp <span class="token operator">=</span> <span class="token function">calculateAvg</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">MemoWeatherReport</span> <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token maybe-class-name">WeatherReport</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> record <span class="token operator">=</span> <span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MemoWeatherReport</span> record<span class="token operator">=</span><span class="token punctuation">{</span>record<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MemoWeatherReport</span> record<span class="token operator">=</span><span class="token punctuation">{</span>record<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>예시에서 <code>MemoWeatherReport</code> 컴포넌트 모두 첫 번째 렌더에서 <code>calculateAvg</code>를 호출합니다. 하지만 <code>App</code>이 재 렌더링 될 때 <code>record</code>의 변경이 없다면 프로퍼티의 변경이 없기 때문에 <code>MemoWeatherReport</code>가 다시 렌더링 되지 않습니다.<p><code>useMemo</code>와 비교하면 <code>memo</code>는 프로퍼티와 특정 계산을 기반으로 컴포넌트 렌더링을 메모화합니다. <code>useMemo</code>와 유사하게, 메모화된 컴포넌트는 마지막 프로퍼티 값에 대한 마지막 렌더링을 캐싱합니다. 프로퍼티가 변경되면, 캐쉬는 무효화되고 컴포넌트는 재 렌더링 됩니다.</section></deepdive></section></section><section class="level2"aria-labelledby="문제-해결-troubleshooting"><h2 id="문제-해결-troubleshooting">문제 해결 {/<em>troubleshooting</em>/}</h2><section class="level3"aria-labelledby="동일한-인수로-함수를-호출해도-메모된-함수가-계속-실행됩니다-memoized-function-still-runs"><h3 id="동일한-인수로-함수를-호출해도-메모된-함수가-계속-실행됩니다-memoized-function-still-runs">동일한 인수로 함수를 호출해도 메모된 함수가 계속 실행됩니다. {/<em>memoized-function-still-runs</em>/}</h3><p>앞서 언급된 주의 사항들을 확인하세요.<ul><li><a href="#pitfall-different-memoized-functions">다른 메모화된 함수를 호출하면 다른 캐시에서 읽습니다.</a><li><a href="#pitfall-memoized-call-outside-component">컴포넌트 외부에서 메모화된 함수를 사용하면 캐시가 사용되지 않습니다.</a></ul><p>위의 어느 것도 해당하지 않는다면, React가 캐시에 무엇이 존재하는지 확인하는 방식에 문제가 있을 수 있습니다.<p>인자가 <a href="https://developer.mozilla.org/ko/docs/Glossary/Primitive">원시 값</a>(객체, 함수, 배열 등) 이 아니라면, 같은 객체 참조를 넘겼는지 확인하세요.<p>메모화된 함수 호출 시, React는 입력된 인자값을 조회해 결과가 이미 캐싱 되어 있는지 확인합니다. React는 인수의 얕은 동등성을 사용해 캐시 히트가 있는지를 결정합니다.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> calculateNorm <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">vector</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MapMarker</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 🚩 Wrong: 인자가 매 렌더링마다 변경되는 객체입니다.</span>
  <span class="token keyword">const</span> length <span class="token operator">=</span> <span class="token function">calculateNorm</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> z<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> z<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>이 경우 두 <code>MapMarker</code>는 동일한 작업을 수행하고 동일한 값인 <code>{x: 10, y: 10, z:10}</code>와 함께 <code>calculateNorm</code>를 호출하는 듯 보입니다. 객체에 동일한 값이 포함되어 있더라도 각 컴포넌트가 자체 프로퍼티 객체를 생성하므로, 동일한 객체 참조가 아닙니다.<p>React는 입력에서 <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Object/is"><code>Object.is</code></a>를 호출해 캐시 히트가 있는지 확인합니다.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> calculateNorm <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MapMarker</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ✅ Good: 메모화 함수에 인자로 원시값 제공하기</span>
  <span class="token keyword">const</span> length <span class="token operator">=</span> <span class="token function">calculateNorm</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span><span class="token property-access">z</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> z<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> z<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>이 문제를 해결하는 한 가지 방법은 벡터 차원을 <code>calculateNorm</code>에 전달하는 것입니다. 차원 자체가 원시 값이기 때문에 가능합니다.<p>다른 방법은 벡터 객체를 컴포넌트의 프로퍼티로 전달하는 방법입니다. 두 컴포넌트 인스턴스에 동일한 객체를 전달해야 합니다.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> calculateNorm <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">vector</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MapMarker</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ✅ Good: 동일한 `vector` 객체를 넘겨줍니다.</span>
  <span class="token keyword">const</span> length <span class="token operator">=</span> <span class="token function">calculateNorm</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token property-access">vector</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> vector <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> vector<span class="token operator">=</span><span class="token punctuation">{</span>vector<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> vector<span class="token operator">=</span><span class="token punctuation">{</span>vector<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></canary></section>