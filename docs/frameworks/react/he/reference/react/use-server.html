<!doctype html><html lang="he"><meta charset="utf-8"><title>"'use server'"</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="use-server"><h1 id="use-server">"'use server'"</h1><p>titleForTitleTag: "'use server' directive" canary: true</p><canary><p><code>'use server'</code> is needed only if you're <a href="/learn/start-a-new-react-project#bleeding-edge-react-frameworks">using React Server Components</a> or building a library compatible with them.</p></canary><intro><p><code>'use server'</code> marks server-side functions that can be called from client-side code.</p></intro><inlinetoc><section class="level2"aria-labelledby="reference-reference"><h2 id="reference-reference">Reference {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="use-server-use-server"><h3 id="use-server-use-server"><code>'use server'</code> {/<em>use-server</em>/}</h3><p>Add <code>'use server'</code> at the top of an async function body to mark the function as callable by the client. We call these functions <em>Server Actions</em>.<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">'use server'</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>When calling a Server Action on the client, it will make a network request to the server that includes a serialized copy of any arguments passed. If the Server Action returns a value, that value will be serialized and returned to the client.<p>Instead of individually marking functions with <code>'use server'</code>, you can add the directive to the top of a file to mark all exports within that file as Server Actions that can be used anywhere, including imported in client code.<section class="level4"aria-labelledby="caveats-caveats"><h4 id="caveats-caveats">Caveats {/<em>caveats</em>/}</h4><ul><li><code>'use server'</code> must be at the very beginning of their function or module; above any other code including imports (comments above directives are OK). They must be written with single or double quotes, not backticks.<li><code>'use server'</code> can only be used in server-side files. The resulting Server Actions can be passed to Client Components through props. See supported <a href="#serializable-parameters-and-return-values">types for serialization</a>.<li>To import a Server Action from <a href="/reference/react/use-client">client code</a>, the directive must be used on a module level.<li>Because the underlying network calls are always asynchronous, <code>'use server'</code> can only be used on async functions.<li>Always treat arguments to Server Actions as untrusted input and authorize any mutations. See <a href="#security">security considerations</a>.<li>Server Actions should be called in a <a href="/reference/react/useTransition">transition</a>. Server Actions passed to <a href="/reference/react-dom/components/form#props"><code>&#x3C;form action></code></a> or <a href="/reference/react-dom/components/input#props"><code>formAction</code></a> will automatically be called in a transition.<li>Server Actions are designed for mutations that update server-side state; they are not recommended for data fetching. Accordingly, frameworks implementing Server Actions typically process one action at a time and do not have a way to cache the return value.</ul></section></section><section class="level3"aria-labelledby="security-considerations-security"><h3 id="security-considerations-security">Security considerations {/<em>security</em>/}</h3><p>Arguments to Server Actions are fully client-controlled. For security, always treat them as untrusted input, and make sure to validate and escape arguments as appropriate.<p>In any Server Action, make sure to validate that the logged-in user is allowed to perform that action.</p><wip><p>To prevent sending sensitive data from a Server Action, there are experimental taint APIs to prevent unique values and objects from being passed to client code.<p>See <a href="/reference/react/experimental_taintUniqueValue">experimental_taintUniqueValue</a> and <a href="/reference/react/experimental_taintObjectReference">experimental_taintObjectReference</a>.</p></wip></section><section class="level3"aria-labelledby="serializable-arguments-and-return-values-serializable-parameters-and-return-values"><h3 id="serializable-arguments-and-return-values-serializable-parameters-and-return-values">Serializable arguments and return values {/<em>serializable-parameters-and-return-values</em>/}</h3><p>As client code calls the Server Action over the network, any arguments passed will need to be serializable.<p>Here are supported types for Server Action arguments:<ul><li>Primitives<ul><li><a href="https://developer.mozilla.org/en-US/docs/Glossary/String">string</a><li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Number">number</a><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt">bigint</a><li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Boolean">boolean</a><li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Undefined">undefined</a><li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Null">null</a><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol">symbol</a>, only symbols registered in the global Symbol registry via <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/for"><code>Symbol.for</code></a></ul><li>Iterables containing serializable values<ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">String</a><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">Array</a><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray">TypedArray</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">ArrayBuffer</a></ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date">Date</a><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData">FormData</a> instances<li>Plain <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">objects</a>: those created with <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Object_initializer">object initializers</a>, with serializable properties<li>Functions that are Server Actions<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promises</a></ul><p>Notably, these are not supported:<ul><li>React elements, or <a href="/learn/writing-markup-with-jsx">JSX</a><li>Functions, including component functions or any other function that is not a Server Action<li><a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Classes_in_JavaScript">Classes</a><li>Objects that are instances of any class (other than the built-ins mentioned) or objects with <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object#null-prototype_objects">a null prototype</a><li>Symbols not registered globally, ex. <code>Symbol('my new symbol')</code></ul><p>Supported serializable return values are the same as <a href="/reference/react/use-client#passing-props-from-server-to-client-components">serializable props</a> for a boundary Client Component.</section></section><section class="level2"aria-labelledby="usage-usage"><h2 id="usage-usage">Usage {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="server-actions-in-forms-server-actions-in-forms"><h3 id="server-actions-in-forms-server-actions-in-forms">Server Actions in forms {/<em>server-actions-in-forms</em>/}</h3><p>The most common use case of Server Actions will be calling server functions that mutate data. On the browser, the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/form">HTML form element</a> is the traditional approach for a user to submit a mutation. With React Server Components, React introduces first-class support for Server Actions in <a href="/reference/react-dom/components/form">forms</a>.<p>Here is a form that allows a user to request a username.<pre class="language-js"><code class="language-js"><span class="token comment">// App.js</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">requestUsername</span><span class="token punctuation">(</span><span class="token parameter">formData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">'use server'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> username <span class="token operator">=</span> formData<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>requestUsername<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"username"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span><span class="token maybe-class-name">Request</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>In this example <code>requestUsername</code> is a Server Action passed to a <code>&#x3C;form></code>. When a user submits this form, there is a network request to the server function <code>requestUsername</code>. When calling a Server Action in a form, React will supply the form's<codestep step="{1}"><a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData">FormData</a></codestep>as the first argument to the Server Action.<p>By passing a Server Action to the form <code>action</code>, React can <a href="https://developer.mozilla.org/en-US/docs/Glossary/Progressive_Enhancement">progressively enhance</a> the form. This means that forms can be submitted before the JavaScript bundle is loaded.<section class="level4"aria-labelledby="handling-return-values-in-forms-handling-return-values"><h4 id="handling-return-values-in-forms-handling-return-values">Handling return values in forms {/<em>handling-return-values</em>/}</h4><p>In the username request form, there might be the chance that a username is not available. <code>requestUsername</code> should tell us if it fails or not.<p>To update the UI based on the result of a Server Action while supporting progressive enhancement, use <a href="/reference/react-dom/hooks/useFormState"><code>useFormState</code></a>.<pre class="language-js"><code class="language-js"><span class="token comment">// requestUsername.js</span>
<span class="token string">'use server'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">requestUsername</span><span class="token punctuation">(</span><span class="token parameter">formData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> username <span class="token operator">=</span> formData<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">canRequest</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword control-flow">return</span> <span class="token string">'successful'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token string">'failed'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// UsernameForm.js</span>
<span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useFormState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">requestUsername</span> <span class="token keyword module">from</span> <span class="token string">'./requestUsername'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">UsernameForm</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>returnValue<span class="token punctuation">,</span> action<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useFormState</span><span class="token punctuation">(</span>requestUsername<span class="token punctuation">,</span> <span class="token string">'n/a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>action<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"username"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span><span class="token maybe-class-name">Request</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Last</span> submission request returned<span class="token operator">:</span> <span class="token punctuation">{</span>returnValue<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Note that like most Hooks, <code>useFormState</code> can only be called in<codestep step="{1}"><a href="/reference/react/use-client">client code</a></codestep>.</section></section><section class="level3"aria-labelledby="calling-a-server-action-outside-of--calling-a-server-action-outside-of-form"><h3 id="calling-a-server-action-outside-of--calling-a-server-action-outside-of-form">Calling a Server Action outside of <code>&#x3C;form></code> {/<em>calling-a-server-action-outside-of-form</em>/}</h3><p>Server Actions are exposed server endpoints and can be called anywhere in client code.<p>When using a Server Action outside of a <a href="/reference/react-dom/components/form">form</a>, call the Server Action in a <a href="/reference/react/useTransition">transition</a>, which allows you to display a loading indicator, show <a href="/reference/react/useOptimistic">optimistic state updates</a>, and handle unexpected errors. Forms will automatically wrap Server Actions in transitions.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports">incrementLike</span> <span class="token keyword module">from</span> <span class="token string">'./actions'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useTransition <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">LikeButton</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isPending<span class="token punctuation">,</span> startTransition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useTransition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>likeCount<span class="token punctuation">,</span> setLikeCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> currentCount <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">incrementLike</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setLikeCount</span><span class="token punctuation">(</span>currentCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Total</span> <span class="token maybe-class-name">Likes</span><span class="token operator">:</span> <span class="token punctuation">{</span>likeCount<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span> disabled<span class="token operator">=</span><span class="token punctuation">{</span>isPending<span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Like</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// actions.js</span>
<span class="token string">'use server'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> likeCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">incrementLike</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  likeCount<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> likeCount<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>To read a Server Action return value, you'll need to <code>await</code> the promise returned. <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>