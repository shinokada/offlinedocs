<!doctype html>
<html lang="he">
  <head>
    <meta charset="utf-8">
    <title>העברת רפרנסים</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css">
  </head>
  <body>
    <section id="העברת-רפרנסים" class="level1">
      <h1>העברת רפרנסים</h1>
      <p>העברת רפרנסים היא טכניקה להעברה אוטומטית של <a href="./refs-and-the-dom.html">רפרנס</a> דרך קומפוננטה לאחד מקומפוננטות הילד שלה. בדרך כלל, זאת טכניקה שלא נחוצה לרוב הקומפוננטות באפליקציה, אבל יכולה להיות שימושית במצבים מסוימים, בעיקר בספריות קומפוננטות רב פעמיות. התרחישים הנפוצים ביותר מתוארים פה.</p>
      <section id="forwarding-refs-to-dom-components" class="level2">
        <h2>העברת רפרנסים לקומפוננטות ב-DOM</h2>
        <p>
          נקח לדוגמא קומפוננטת כפתור <code>FancyButton</code> שמרנדרת אלמנט כפתור פשוט בתוך ה-DOM:
          <code>embed:forwarding-refs/fancy-button-simple.js</code>
        </p>
        <p>קומפוננטות React מחביאות את פרטי הישום שלהן, כולל את הפלט המרונדר שלהן. קומפוננטות אחרות שמשתמשות ב-<code>FancyButton</code> <strong>בדרך כלל לא יצטרכו</strong> <a href="./refs-and-the-dom.html">להשיג רפרנס</a> לאלמנט הכפתור של ה-DOM שהיא מיישמת. זה דבר טוב, כי זה מונע מקומפוננטות לסמוך על מבנה ה-DOM אחת של השנייה יותר מדי.</p>
        <p>למרות שכימוס כזה רצויה בקומפוננטות ברמת האפליקציה כמו <code>FeedStory</code> או <code>Comment</code>, היא יכולה להפוך לפחות נוחה בזמן שימוש בקומפוננטות ״עלה״ שנועדות לשימוש חוזר כמו <code>FancyButton</code> או <code>MyTextInput</code>. השימוש בקומפוננטות האלה בדרך כלל חוזר על עצמו פעמים רבות באפליקציה, בדומה לשימוש ב- <code>button</code> ו- <code>input</code>, ולפעמים אין ברירה אלא לגשת ישירות לאלמנטי ה-DOM שלהן כדי לשנות פוקוס, בחירה או אנימציה.</p>
        <p><strong>העברת רפרנסים היא פיצ׳ר שמאפשר לקומפוננטות לקחת הפניה (<code>רפרנס</code>) שהם קיבלו ולהעביר אותה הלאה לקומפוננטת ילד</strong></p>
        <p>בדוגמא הנ״ל, הכפתור <code>FancyButton</code> משתמש ב-<code>React.forwardRef</code> כדי לקבל את הרפרנס שהועבר אליו, ואז מעביר אותו לאלמנט הכפתור שהוא מרנדר ב-DOM:</p>
        <p><code>embed:forwarding-refs/fancy-button-simple-ref.js</code></p>
        <p>בצורה זו, קומפוננטות שמשתמשות ב- <code>FancyButton</code> יכולות לקבל רפרנס לצומת הכפתור עצמה ולהשתמש בה בעת הצורך - כאילו הן השתמשו בכפתור ב-DOM באופן ישיר.</p>
        <p>להלן הסבר מפורט של מה שקורה בדוגמא לעיל:</p>
        <ol>
          <li>אנחנו יוצרים <a href="./refs-and-the-dom.html">רפרנס של React</a> ע״י שימוש ב- <code>React.createRef</code> ושמים אותו במשתנה ה-<code>ref</code>.</li>
          <li>אנחנו מעבירים את הרפרנס למטה ל- FancyButton בעזרת השימוש במאפיין ה-JSX: <code>&#x3C;FancyButton ref={ref}></code></li>
          <li>React מעבירה את הרפרנס לפונקציית ה- <code>(props, ref) => ...</code> כפרמטר השני בתוך <code>forwardRef</code>.</li>
          <li>אנחנו מעבירים את ארגומנט הרפרנס למטה לכפתור על ידי שימוש במאפיין ה-JSX: <code>&#x3C;button ref={ref}></code></li>
          <li>כשהרפרנס מחובר, <code>ref.current</code> יצביע לצומת הכפתור ב-DOM.</li>
        </ol>
        <blockquote>
          <p>הערה</p>
          <p>ארגומנט הרפרנס השני קיים רק כשמגדירים קומפוננטה עם קריאה ל- <code>React.forwardRef</code>. פונקציות רגילות או קומפוננטות מחלקה לא מקבלות את ארגומנט ה-<code>ref</code>, והוא גם לא זמין ב-props שלהן.</p>
          <p>העברת רפרנסים לא מוגבלת רק לקומפוננטות DOM. ניתן להעביר רפרנסים גם למופע של קומפוננטות מחלקה.</p>
        </blockquote>
      </section>
      <section id="note-for-component-library-maintainers" class="level2">
        <h2>הערה למתחזקי ספריות קומפוננטות</h2>
        <p><strong>כשמתחילים להשתמש ב- <code>forwardRef</code> בספריית קומפוננטות, צריך להתייחס לשינוי כשינוי שובר ולשחרר גרסה ראשית חדשה של הספרייה.</strong> הסיבה לכך היא שכעת לספרייה יש התנהגות נצפית שונה (כמו איזה רפרנסים מיושמים ואיזה סוגי אובייקטים מיוצאים), וזה יכול לשבור אפליקציות וספריות אחרות שהיו תלויות בהתנהגות הקודמת.</p>
        <p>השימוש המותנה ב- <code>React.forwardRef</code> כשהוא קיים גם כן לא מומלץ מאותה הסיבה: הוא משנה את התנהגות הספרייה ויכול לשבור את האפליקציות שמשתמשות בה כשהן משדגרות את גרסת ה-React עצמה.</p>
      </section>
      <section id="forwarding-refs-in-higher-order-components" class="level2">
        <h2>העברת רפרנסים בקומפוננטות מסדר גבוה יותר</h2>
        <p>
          הטכניקה הזאת יכולה להיות שימושית ביותר בשימוש עם <a href="./higher-order-components.html">קומפוננטות מסדר גבוה יותר</a> (שידועות גם כ-HOCs).
          נתחיל עם דוגמא של HOC שמתעדת props של קומפוננטות ל-console:
          <code>embed:forwarding-refs/log-props-before.js</code>
        </p>
        <p>
          ה-HOC "logProps" מעביר את כל ה-<code>props</code> דרכו לקומפוננטה שהוא עוטף, ולכן הפלט יהיה זהה. לדוגמא, אפשר להשתמש ב-HOC הזה כדי לתעד את כל ה-props שמועברים לקומפוננטת כפתור ה-"fancy button" שלנו:
          <code>embed:forwarding-refs/fancy-button.js</code>
        </p>
        <p>יש הסתייגות אחת לדוגמא שהצגנו: רפרנסים לא יועברו הלאה. הסיבה היא ש-<code>ref</code> הוא לא prop. כמו <code>key</code>, React מתייחס אליו בצורה קצת שונה. אם תוסיפו את הרפרנס לקומפוננטה מסדר גבוה יותר, הרפרנס יתייחס לקונטיינר הקומפוננטה החיצוני, ולא לקומפוננטה העטופה.</p>
        <p>
          זה אומר שרפרנסים שיועדו לקומפוננטת ה-<code>FancyButton</code> שלנו יהיו דווקא מקושרים לקומפוננטת ה- <code>LogProps</code>:
          <code>embed:forwarding-refs/fancy-button-ref.js</code>
        </p>
        <p>
          למזלנו, אפשר להעביר את הרפרנס בצורה מפורשת לקומפוננטה הפנימית <code>FancyButton</code> בעזרת הממשק <code>React.forwardRef</code>. <code>React.forwardRef</code> מקבל פונקציית רינדור עם פרמטרים <code>props</code> ו- <code>ref</code> ומחזיר צומת React. לדוגמא:
          <code>embed:forwarding-refs/log-props-after.js</code>
        </p>
      </section>
      <section id="displaying-a-custom-name-in-devtools" class="level2">
        <h2>הצגת שם מותאים בכלי פיתוח</h2>
        <p><code>React.forwardRef</code> מקבל פונקציית רינדור. כלי הפיתוח של React משתמשים בפונקציה הזאת כדי להחליט מה להציג עבור קומפוננטת העברת הרפרנסים.</p>
        <p>לדוגמא, הקומפוננטה הבאה תוצג כ: "<em>ForwardRef</em>" בכלי הפיתוח של React:</p>
        <p><code>embed:forwarding-refs/wrapped-component.js</code></p>
        <p>אם ניתן שם לפונקציית הרינדור, כלי הפיתוח יציגו גם אותו (לדוגמא "<em>ForwardRef(myFunction)</em>"):</p>
        <p><code>embed:forwarding-refs/wrapped-component-with-function-name.js</code></p>
        <p>אפשר לציין את ה-<code>displayName</code> של הפונקצייה בצורה שתכלול את הקומפוננטה העטופה:</p>
        <p>
          <code>embed:forwarding-refs/customized-display-name.js</code>
          <span style="float: footnote;"><a href="./index.html#toc">Go to TOC</a></span>
        </p>
      </section>
    </section>
  </body>
</html>
