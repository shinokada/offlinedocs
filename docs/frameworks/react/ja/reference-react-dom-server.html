<!doctype html><html lang="ja"><meta charset="utf-8"><title>ReactDOMServer</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="reactdomserver"class="level1"><h1>ReactDOMServer</h1><p><code>ReactDOMServer</code> オブジェクトはコンポーネントを静的なマークアップとして変換できるようにします。これは、一般的に Node サーバで使われます。<pre class="language-js"><code class="language-js"><span class="token comment">// ES modules</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> <span class="token maybe-class-name">ReactDOMServer</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/server'</span><span class="token punctuation">;</span>
<span class="token comment">// CommonJS</span>
<span class="token keyword">var</span> <span class="token maybe-class-name">ReactDOMServer</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react-dom/server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><section id="overview"class="level2"><h2>概要</h2><p>以下のメソッドは <strong><a href="https://nodejs.dev/learn/nodejs-streams">Node.js の Stream</a> 環境でのみ動作します</strong>：<ul><li><a href="#rendertopipeablestream"><code>renderToPipeableStream()</code></a><li><a href="#rendertonodestream"><code>renderToNodeStream()</code></a>（非推奨）<li><a href="#rendertostaticnodestream"><code>renderToStaticNodeStream()</code></a></ul><p>以下のメソッドは <strong><a href="https://developer.mozilla.org/en-US/docs/Web/API/Streams_API">Web Stream</a> の環境</strong>（ブラウザ、Deno やいくつかのモダンなエッジランタイム）でのみ動作します：<ul><li><a href="#rendertoreadablestream"><code>renderToReadableStream()</code></a></ul><p>以下のメソッドはストリームをサポートしない環境でも動作します：<ul><li><a href="#rendertostring"><code>renderToString()</code></a><li><a href="#rendertostaticmarkup"><code>renderToStaticMarkup()</code></a></ul></section><section id="reference"class="level2"><h2>リファレンス</h2><section id="rendertopipeablestream-rendertopipeablestream"class="level3"><h3><code>renderToPipeableStream()</code> {#rendertopipeablestream}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token maybe-class-name">ReactDOMServer</span><span class="token punctuation">.</span><span class="token method function property-access">renderToPipeableStream</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> options<span class="token punctuation">)</span></code></pre><p>React 要素を初期状態の HTML に変換します。出力をパイプするための <code>pipe(res)</code> メソッドとリクエストを中止するための <code>abort()</code> メソッドを持ったストリームを返します。サスペンスや、HTML をストリーミングして「遅れてやってくる」コンテンツのブロックをインライン <code>&#x3C;script></code> タグで埋めるための機能を完全にサポートしています。<a href="https://github.com/reactwg/react-18/discussions/37">詳細はこちら</a>。<p>このようにサーバでレンダーされたマークアップを有するノードに対して <a href="./react-dom-client.html#hydrateroot"><code>ReactDOM.hydrateRoot()</code></a> をコールすると、React はマークアップを保持してイベントハンドラだけをアタッチしますので、非常によい初回ロード体験が実現できます。<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> didError <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> stream <span class="token operator">=</span> <span class="token function">renderToPipeableStream</span><span class="token punctuation">(</span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token function">onShellReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// The content above all Suspense boundaries is ready.</span>
      <span class="token comment">// If something errored before we started streaming, we set the error code appropriately.</span>
      res<span class="token punctuation">.</span><span class="token property-access">statusCode</span> <span class="token operator">=</span> didError <span class="token operator">?</span> <span class="token number">500</span> <span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      stream<span class="token punctuation">.</span><span class="token method function property-access">pipe</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onShellError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Something errored before we could complete the shell so we emit an alternative shell.</span>
      res<span class="token punctuation">.</span><span class="token property-access">statusCode</span> <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>
        <span class="token string">'&#x3C;!doctype html>&#x3C;p>Loading...&#x3C;/p>&#x3C;script src="clientrender.js">&#x3C;/script>'</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onAllReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// If you don't want streaming, use this instead of onShellReady.</span>
      <span class="token comment">// This will fire after the entire page content is ready.</span>
      <span class="token comment">// You can use this for crawlers or static generation.</span>

      <span class="token comment">// res.statusCode = didError ? 500 : 200;</span>
      <span class="token comment">// res.setHeader('Content-type', 'text/html');</span>
      <span class="token comment">// stream.pipe(res);</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      didError <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><a href="https://github.com/facebook/react/blob/14c2be8dac2d5482fda8a0906a31d239df8551fc/packages/react-dom/src/server/ReactDOMFizzServerNode.js#L36-L46">オプションの全リスト</a>を参照。<blockquote><p>補足：<p>これは Node.js 専用の API です。Deno やモダンなエッジランタイムのような <a href="https://developer.mozilla.org/en-US/docs/Web/API/Streams_API">Web Stream</a> の環境では、代わりに <a href="#rendertoreadablestream"><code>renderToReadableStream</code></a> を使用してください。</blockquote><hr></section><section id="rendertoreadablestream-rendertoreadablestream"class="level3"><h3><code>renderToReadableStream()</code> {#rendertoreadablestream}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token maybe-class-name">ReactDOMServer</span><span class="token punctuation">.</span><span class="token method function property-access">renderToReadableStream</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>React 要素を初期状態の HTML にストリーミングします。<a href="https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream">Readable Stream</a> として resolve する Promise を返します。サスペンスと HTML ストリーミングを完全にサポートします。<a href="https://github.com/reactwg/react-18/discussions/127">詳細はこちら</a>。<p>このようにサーバでレンダーされたマークアップを有するノードに対して <a href="./react-dom-client.html#hydrateroot"><code>ReactDOM.hydrateRoot()</code></a> をコールすると、React はマークアップを保持してイベントハンドラだけをアタッチしますので、非常によい初回ロード体験が実現できます。<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> didError <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> stream <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">renderToReadableStream</span><span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>html<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>body<span class="token operator">></span><span class="token maybe-class-name">Success</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>body<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>html<span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span><span class="token property-access">signal</span><span class="token punctuation">,</span>
      <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        didError <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// This is to wait for all Suspense boundaries to be ready. You can uncomment</span>
  <span class="token comment">// this line if you want to buffer the entire HTML instead of streaming it.</span>
  <span class="token comment">// You can use this for crawlers or static generation:</span>

  <span class="token comment">// await stream.allReady;</span>

  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">status</span><span class="token operator">:</span> didError <span class="token operator">?</span> <span class="token number">500</span> <span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/html'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>
    <span class="token string">'&#x3C;!doctype html>&#x3C;p>Loading...&#x3C;/p>&#x3C;script src="clientrender.js">&#x3C;/script>'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
      <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/html'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><a href="https://github.com/facebook/react/blob/14c2be8dac2d5482fda8a0906a31d239df8551fc/packages/react-dom/src/server/ReactDOMFizzServerBrowser.js#L27-L35">オプションの全リスト</a>を参照。<blockquote><p>補足：<p>この API は <a href="https://developer.mozilla.org/en-US/docs/Web/API/Streams_API">Web Streams</a> に依存しています。Node.js では代わりに <a href="#rendertopipeablestream"><code>renderToPipeableStream</code></a> を使用してください。</blockquote><hr></section><section id="rendertonodestream"class="level3"><h3><code>renderToNodeStream()</code>（非推奨）</h3><pre class="language-javascript"><code class="language-javascript"><span class="token maybe-class-name">ReactDOMServer</span><span class="token punctuation">.</span><span class="token method function property-access">renderToNodeStream</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span></code></pre><p>React 要素を初期状態の HTML にストリーミングします。HTML 文字列を出力する <a href="https://nodejs.org/api/stream.html#stream_readable_streams">Node.js の 読み取りストリーム</a> を返します。このストリームからの HTML 出力は <a href="#rendertostring"><code>ReactDOMServer.renderToString</code></a> が返すものと全く同じです。このメソッドを使ってサーバで HTML を生成し、初回リクエスト時にマークアップを送信することで、ページロードを高速化し、SEO 目的でサーチエンジンがクロールできるようになります。<p>このようにサーバでレンダーされたマークアップを有するノードに対して <a href="./react-dom-client.html#hydrateroot"><code>ReactDOM.hydrateRoot()</code></a> をコールすると、React はマークアップを保持してイベントハンドラだけをアタッチしますので、非常によい初回ロード体験が実現できます。<blockquote><p>補足：<p>この API はサーバ専用です。ブラウザでは利用できません。<p>このメソッドが返すストリームは UTF-8 でエンコードされたバイトストリームを返します。別の方式でエンコードされたストリームが必要な場合、テキストのトランスコーディングのために変換ストリームを提供している <a href="https://www.npmjs.com/package/iconv-lite">iconv-lite</a> のようなプロジェクトを参照してください。</blockquote><hr></section><section id="rendertostaticnodestream-rendertostaticnodestream"class="level3"><h3><code>renderToStaticNodeStream()</code> {#rendertostaticnodestream}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token maybe-class-name">ReactDOMServer</span><span class="token punctuation">.</span><span class="token method function property-access">renderToStaticNodeStream</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span></code></pre><p>React が内部的に使用する <code>data-reactroot</code> のような追加の DOM 属性を作成しないことを除いて、<a href="#rendertonodestream"><code>renderToNodeStream</code></a> と同様の動作をします。このメソッドは React を単純な静的サイトジェネレータとして使用したい場合に便利で、追加の属性を省略することでバイト数を削減できます。<p>このストリームによる HTML 出力は <a href="#rendertostaticmarkup"><code>ReactDOMServer.renderToStaticMarkup</code></a> が返すものと全く同じです。<p>マークアップをインタラクティブなものにするために、クライアントで React を導入しようとしている場合は、このメソッドを使用しないでください。代わりに、サーバで <a href="#rendertonodestream"><code>renderToNodeStream</code></a> を、そしてクライアントで <a href="./react-dom-client.html#hydrateroot"><code>ReactDOM.hydrateRoot()</code></a> を使用してください。<blockquote><p>補足：<p>この API はサーバ専用です。ブラウザでは利用できません。<p>このメソッドが返すストリームは UTF-8 でエンコードされたバイトストリームを返します。別の方式でエンコードされたストリームが必要な場合、テキストのトランスコーディングのために変換ストリームを提供している <a href="https://www.npmjs.com/package/iconv-lite">iconv-lite</a> のようなプロジェクトを参照してください。</blockquote><hr></section><section id="rendertostring-rendertostring"class="level3"><h3><code>renderToString()</code> {#rendertostring}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token maybe-class-name">ReactDOMServer</span><span class="token punctuation">.</span><span class="token method function property-access">renderToString</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span></code></pre><p>React 要素を初期状態の HTML に変換します。React は HTML 文字列を返します。このメソッドを使ってサーバで HTML を生成し、初回リクエスト時にマークアップを送信することで、ページロードを高速化し、SEO 目的でサーチエンジンがクロールできるようになります。<p>このようにサーバでレンダーされたマークアップを有するノードに対して <a href="./react-dom-client.html#hydrateroot"><code>ReactDOM.hydrateRoot()</code></a> をコールすると、React はマークアップを保持してイベントハンドラだけをアタッチしますので、非常によい初回ロード体験が実現できます。<blockquote><p>補足<p>この API は Suspense を部分的にしかサポートしておらず、ストリーミングが行えません。<p>サーバサイドでは、<a href="#rendertopipeablestream"><code>renderToPipeableStream</code></a>（Node.js の場合）または <a href="#rendertoreadablestream"><code>renderToReadableStream</code></a>（Web Stream の場合）の利用をお勧めします。</blockquote><hr></section><section id="rendertostaticmarkup-rendertostaticmarkup"class="level3"><h3><code>renderToStaticMarkup()</code> {#rendertostaticmarkup}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token maybe-class-name">ReactDOMServer</span><span class="token punctuation">.</span><span class="token method function property-access">renderToStaticMarkup</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span></code></pre><p>React が内部的に使用する <code>data-reactroot</code> のような追加の DOM 属性を作成しないことを除いて、<a href="#rendertostring"><code>renderToString</code></a> と同様の動作をします。このメソッドは React を単純な静的サイトジェネレータとして使用したい場合に便利で、追加の属性を省略することでバイト数を削減できます。<p>クライアントで React を使ってマークアップをインタラクティブにする目的では、このメソッドは使わないでください。代わりにサーバで <a href="#rendertostring"><code>renderToString</code></a>、クライアントで <a href="./react-dom-client.html#hydrateroot"><code>ReactDOM.hydrateRoot()</code></a> を使うようにします。<span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section></section>