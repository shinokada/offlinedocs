<!doctype html><html lang="ja"><meta charset="utf-8"><title>静的型チェック</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="静的型チェック"class="level1"><h1>静的型チェック</h1><p><a href="https://flow.org/">Flow</a> や <a href="https://www.typescriptlang.org/">TypeScript</a> のような静的型チェッカーを使用することでコードを実行する前の早期段階に型不整合等の問題を検知することができます。他にも型解析言語を使用することで補完などの機能が追加され、開発体験を上げることができます。これらの理由から、大きいコードベースでは <code>PropTypes</code> の代わりに Flow や TypeScript を使うことをおすすめします。<section id="flow"class="level2"><h2>Flow</h2><p><a href="https://flow.org/">Flow</a> は JavaScript 用の静的型チェック機能です。Facebook で開発されており、React と一緒に使われることが多いです。変数、関数や React コンポーネントに型を足すことができ、型不整合を早期に発見できるようになります。<a href="https://flow.org/en/docs/getting-started/">はじめての Flow</a> に基本情報が記載されているので、それを読むと良いでしょう。<p>Flow を使用するには以下の手順を踏みます：<ul><li>Flow をプロジェクトの dependency に入れる。<li>Flow の型定義をコンパイル時にコードから剥がすように設定する。<li>型定義を追加し、Flow を起動して確認する。</ul><p>順を追って説明します。<section id="adding-flow-to-a-project"class="level3"><h3>Flow をプロジェクトに追加する</h3><p>まず、ターミナル上であなたのプロジェクトが含まれているディレクトリに入り、以下のコマンドを入力してください。<p><a href="https://yarnpkg.com/">Yarn</a> を使っている場合：<pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> --dev flow-bin</code></pre><p><a href="https://www.npmjs.com/">npm</a> を使っている場合：<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev flow-bin</code></pre><p>このコマンドによって Flow の最新版をあなたのプロジェクトに入れることができます。<p>次に、<code>package.json</code> の <code>"scripts"</code> に <code>flow</code> を追加しましょう。これで、ターミナルで Flow を実行できるようになります。<pre class="language-js{4}"><code class="language-js{4}">{
  // ...
  "scripts": {
    "flow": "flow",
    // ...
  },
  // ...
}</code></pre><p>最後に、以下のコマンドを実行します：<p><a href="https://yarnpkg.com/">Yarn</a> を使っている場合：<pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> run flow init</code></pre><p><a href="https://www.npmjs.com/">npm</a> を使っている場合：<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> run flow init</code></pre><p>このコマンドで Flow の設定ファイルを生成することができます。この設定ファイルはバージョン管理しましょう。</section><section id="stripping-flow-syntax-from-the-compiled-code"class="level3"><h3>Flow の型定義をコンパイル時にコードから剥がす</h3><p>Flow は JavaScript 言語を拡張し、型定義のための特殊な記法を使えるようにします。しかし、ブラウザはその記法について知らない為、ブラウザに送信されるコンパイル後の JavaScript バンドルに含まれないようにしなければいけません。<p>剥がす方法は使用している JavaScript のコンパイルツールによって変わってきます。<section id="create-react-app"class="level4"><h4>Create React App</h4><p>もし、あなたのプロジェクトが <a href="https://github.com/facebookincubator/create-react-app">Create React App</a> によって生成されている場合、おめでとうございます！ 既にビルド時に Flow の型定義は剥がされる設定になっているため、このステップで何もする必要はありません。</section><section id="babel"class="level4"><h4>Babel</h4><blockquote><p>補足:<p>以下の手順は Create React App で React をセットアップしている方向けでは<em>ありません</em>。Create React App も内部で Babel を使用していますが、既に Flow を使えるように設定されています。以下の手順は Create React App を使って<em>いない</em>場合のみ実行してください。</blockquote><p>もし、あなたが手動で Babel の設定を行っていた場合、以下のコマンドで Flow 用の Babel プリセットをインストールする必要があります。<p>yarn を使っている場合：<pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> --dev @babel/preset-flow</code></pre><p>npm を使っている場合：<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev @babel/preset-flow</code></pre><p>そして、<code>flow</code> のプリセットを <a href="https://babeljs.io/docs/usage/babelrc/">Babel の設定ファイル</a> に追加してください。例えば、Babel の設定を <code>.babelrc</code> ファイルで行っている場合は以下のようになります。<pre class="language-js{3}"><code class="language-js{3}">{
  "presets": [
    "@babel/preset-flow",
    "react"
  ]
}</code></pre><p>これであなたのコードで Flow の型定義が使えるようになります。<blockquote><p>補足:<p>Flow を使うためには必ず <code>react</code> のプリセットが必要というわけではありません。ただ、よく組み合わせて使われています。Flow はそのままでも JSX のシンタックスを認識できます。</blockquote></section><section id="other-build-setups"class="level4"><h4>他のビルド設定</h4><p>もし、Create React App も Babel も使用していない場合、<a href="https://github.com/flowtype/flow-remove-types">flow-remove-types</a> を使って Flow の型定義を剥がすことができます。</section></section><section id="running-flow"class="level3"><h3>Flow の実行</h3><p>もし、今までの手順を踏んでいる場合、以下のコマンドで Flow が実行されます。<pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> flow</code></pre><p>npm を使っている場合：<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> run flow</code></pre><p>以下のようなメッセージが表示されます。<pre class="language-text"><code class="language-text">No errors!
✨  Done in 0.17s.</code></pre></section><section id="adding-flow-type-annotations"class="level3"><h3>Flow の型定義の追記</h3><p>Flow の初期設定では、以下のコメントが含まれているファイルのみ型チェックを行います。<pre class="language-js"><code class="language-js"><span class="token comment">// @flow</span></code></pre><p>上記コメントは基本的にファイルの頭に記載します。あなたのプロジェクトのいくつかのファイルに足してみて、<code>yarn flow</code> や <code>npm run flow</code> を実行して Flow が何か問題を検知するかどうかを確認してみましょう。<p>Flow の型チェックを、コメントが含まれているかにかかわらず<em>全て</em>のファイルに対してかける<a href="https://flow.org/en/docs/config/options/#toc-all-boolean">設定</a>も存在します。これは既存のプロジェクトに対してかけると確認箇所が大量に出てしまいますが、新規プロジェクトの立ち上げで全てのファイルに型を入れたい場合は合理的な選択でしょう。<p>これで準備は整いました！ Flow についてより深く知りたい場合には以下の資料が役立つでしょう。<ul><li><a href="https://flow.org/en/docs/types/">Flow Documentation: Type Annotations</a><li><a href="https://flow.org/en/docs/editors/">Flow Documentation: Editors</a><li><a href="https://flow.org/en/docs/react/">Flow Documentation: React</a><li><a href="https://medium.com/flow-type/linting-in-flow-7709d7a7e969">Linting in Flow</a></ul></section></section><section id="typescript"class="level2"><h2>TypeScript</h2><p><a href="https://www.typescriptlang.org/">TypeScript</a> は Microsoft によって開発されたプログラミング言語です。型を所有した JavaScript のスーパーセットで、独自のコンパイラを所持しています。TypeScript は型言語であるため、実行前のビルド時にエラーやバグを検知することができます。React と TypeScript を組み合わせて使うことに関しては、<a href="https://github.com/Microsoft/TypeScript-React-Starter#typescript-react-starter">ここ</a>にも詳しく記載されています。<p>TypeScript を使うためには以下のことを行います。<ul><li>TypeScript をプロジェクトの dependency に入れる。<li>TypeScript のコンパイラの設定を行う。<li>TypeScript 用のファイル拡張子を使用する。<li>使用するライブラリの型定義をインストールする。</ul><p>順を追って説明します。<section id="using-typescript-with-create-react-app"class="level3"><h3>Create React App で TypeScript を使用する</h3><p>Create React App には最初から TypeScript のサポートが含まれています。<p>TypeScript サポートが含まれている<strong>新規プロジェクト</strong>を作成するには、以下のコマンドを実行します。<pre class="language-bash"><code class="language-bash">npx create-react-app my-app --template typescript</code></pre><p><a href="https://facebook.github.io/create-react-app/docs/adding-typescript">この資料に記載されているように、</a><strong>既存の Create React App のプロジェクト</strong>にも TypeScript のサポートを追加することができます。<blockquote><p>補足:<p>もし、Create React App を使っている場合、<strong>以下の記述は全て飛ばして大丈夫です</strong>。Create React App を使用していない場合のセットアップ手順について記載しています。</blockquote></section><section id="adding-typescript-to-a-project"class="level3"><h3>TypeScript をプロジェクトに追加する</h3><p>全ては TypeScript をインストールするところから始まります。プロジェクトが入っているフォルダで以下のコマンドを入力してください。<p><a href="https://yarnpkg.com/">Yarn</a> を使っている場合：<pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> --dev typescript</code></pre><p><a href="https://www.npmjs.com/">npm</a> を使っている場合：<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev typescript</code></pre><p>おめでとうございます！ これで最新の TypeScript があなたのプロジェクトにインストールされました。これによって、<code>tsc</code> コマンドが使えるようになります。設定をする前に、まずは <code>tsc</code> を <code>package.json</code> の <code>"scripts"</code> に追加しましょう。<pre class="language-js{4}"><code class="language-js{4}">{
  // ...
  "scripts": {
    "build": "tsc",
    // ...
  },
  // ...
}</code></pre></section><section id="configuring-the-typescript-compiler"class="level3"><h3>TypeScript コンパイラの設定</h3><p>コンパイラはこちらから設定しないと無価値です。TypeScript ではコンパイラの設定は <code>tsconfig.json</code> というファイルで定義します。このファイルを生成するには以下のコマンドを実行してください。<p><a href="https://yarnpkg.com/">Yarn</a> を使っている場合：<pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> run tsc --init</code></pre><p><a href="https://www.npmjs.com/">npm</a> を使っている場合：<pre class="language-bash"><code class="language-bash">npx tsc --init</code></pre><p>新しく生成された <code>tsconfig.json</code> を見てみると、コンパイラ設定用の様々なオプションがあることがわかります。これら全てのオプションの詳細に関しては<a href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html">こちら</a>を参照してください。<p>たくさんの設定の中から <code>rootDir</code> と <code>outDir</code> に注目します。本来、コンパイラは TypeScript のファイルから JavaScript のファイルを生成します。しかし、既存のソースコードと生成されたコードが混合してしまうことは避けるべきです。<p>以上の問題を 2 つの手順によって対応します。<ul><li>まず、プロジェクトの構成を以下のように変更しましょう。全てのソースコードを <code>src</code> ディレクトリに移動します。</ul><pre class="language-text"><code class="language-text">├── package.json
├── src
│   └── index.ts
└── tsconfig.json</code></pre><ul><li>次に、<code>tsconfig.json</code> を編集してコンパイラにソースコードの場所と生成する場所を設定します。</ul><pre class="language-js{6,7}"><code class="language-js{6,7}">// tsconfig.json

{
  "compilerOptions": {
    // ...
    "rootDir": "src",
    "outDir": "build"
    // ...
  },
}</code></pre><p>素晴らしい！ これで <code>build</code> のスクリプトを実行した際、コンパイラが生成したコードは <code>build</code> ディレクトリに格納されます。他の設定に関しては、<a href="https://github.com/Microsoft/TypeScript-React-Starter/blob/master/tsconfig.json">TypeScript React Starter</a> に React プロジェクト始めるのにおすすめな <code>tsconfig.json</code> を提供しているので、そちらを参照してください。<p>基本的に、生成された JavaScript のコードはバージョン管理するべきではありません。<code>build</code> フォルダは <code>.gitignore</code> に追記しましょう。</section><section id="file-extensions"class="level3"><h3>ファイル拡張子</h3><p>React ではおそらくコンポーネントを <code>.js</code> ファイルに書いていたと思います。TypeScript には 2 種類のファイル拡張子が存在します。<p><code>.ts</code> がデフォルトの拡張子で、<code>JSX</code> が含まれているファイルは <code>.tsx</code> を使います。</section><section id="running-typescript"class="level3"><h3>TypeScript の実行</h3><p>上記の手順を踏んでいれば、以下のコマンドで TypeScript を実行することができます。<pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> build</code></pre><p><a href="https://www.npmjs.com/">npm</a> を使っている場合：<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> run build</code></pre><p>実行結果に何も表示されない場合は、正常に完了したと言うことです。</section><section id="type-definitions"class="level3"><h3>型宣言</h3><p>他のライブラリを使用している時の型エラーやヒントを表示させるために、コンパイラは型宣言ファイルを参照します。型宣言ファイルにはそのライブラリが使用する全ての型の情報が含まれています。これを使うことによって、npm 等から取得した JavaScript のライブラリをそのまま使うことができます。<p>ライブラリの型宣言ファイルを取得するには主に以下の 2 つの方法があります。<p><strong>Bundled</strong> - これはライブラリ自体が型宣言ファイルを所有している場合です。この場合、ライブラリをインストールするだけでそのまま使用することができます。ライブラリが型宣言ファイルを所有しているかどうか確認するには、プロジェクトに <code>index.d.ts</code> ファイルがあるかどうかを見ます。一部のライブラリは <code>package.json</code> の <code>typings</code>、または <code>types</code> の下に型宣言ファイルのパスを指定しています。<p><strong><a href="https://github.com/DefinitelyTyped/DefinitelyTyped">DefinitelyTyped</a></strong> - DefinitelyTyped には型宣言ファイルがバンドルされていない様々なライブラリのための型定義が用意されています。これらの型定義はクラウドソースにより Microsoft とオープンソースのコントリビュータが管理しています。例えば、React には型宣言ファイルが含まれておりませんが、DefinitelyTyped から取得することができます。取得するにはターミナルに以下のコマンドを入力してください。<pre class="language-bash"><code class="language-bash"><span class="token comment"># yarn</span>
<span class="token function">yarn</span> <span class="token function">add</span> --dev @types/react

<span class="token comment"># npm</span>
<span class="token function">npm</span> i --save-dev @types/react</code></pre><p><strong>ローカル型定義</strong> もし、使用しているライブラリに型宣言ファイルが含まれておらず、DefinitelyTyped にも該当する型宣言ファイルがない場合、自前で型宣言ファイルを作成することができます。それを行うには <code>declarations.d.ts</code> をソースディレクトリのルートに作成します。型宣言は以下のように行なえます。<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'querystring'</span> <span class="token punctuation">{</span>
  <span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">stringify</span><span class="token punctuation">(</span>val<span class="token operator">:</span> object<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">parse</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> object
<span class="token punctuation">}</span></code></pre><p>これでコードを書く準備は整いました！ TypeScript についてより深く知りたい場合には以下の資料が役立つでしょう。<ul><li><a href="https://www.typescriptlang.org/docs/handbook/2/everyday-types.html">TypeScript Documentation: Everyday Types</a><li><a href="https://www.typescriptlang.org/docs/handbook/migrating-from-javascript.html">TypeScript Documentation: Migrating from JavaScript</a><li><a href="https://www.typescriptlang.org/docs/handbook/react-&#x26;-webpack.html">TypeScript Documentation: React and Webpack</a></ul></section></section><section id="rescript"class="level2"><h2>ReScript</h2><p><a href="https://rescript-lang.org/">ReScript</a> は JavaScript にコンパイルされる型付き言語です。コアの機能として、保証付きの 100% 型カバレッジ、高度な JSX サポート、<a href="https://rescript-lang.org/docs/react/latest/introduction">専用の React 対応コード</a>が含まれており、既存の JS / TS を使った React コードベースと結合することができます。<p>既存の JS / React コードベースに ReScript を統合するための情報は<a href="https://rescript-lang.org/docs/manual/latest/installation#integrate-into-an-existing-js-project">こちら</a>で参照可能です。</section><section id="kotlin"class="level2"><h2>Kotlin</h2><p><a href="https://kotlinlang.org/">Kotlin</a> は JetBrains により開発された静的型言語です。JVM、Android、LLVM、や <a href="https://kotlinlang.org/docs/reference/js-overview.html">JavaScript</a> といったプラットフォームを対象としています。<p>JetBrains は <a href="https://github.com/JetBrains/kotlin-wrappers">React bindings</a> や <a href="https://github.com/JetBrains/create-react-kotlin-app">Create React Kotlin App</a> のような様々な React コミュニティの為のツールの開発、運営を行っています。後者は React アプリをビルド設定いらずで Kotlin で書き始めることができます。</section><section id="other-languages"class="level2"><h2>他の言語</h2><p>JavaScript にコンパイルされ、React にも活用できる静的型言語は他にも存在します。例えば、<a href="https://fable.io/">F#/Fable</a> と <a href="https://elmish.github.io/react">elmish-react</a> の組み合わせです。詳細はそれぞれのサイトを確認してください。他にも React を活用できる静的型言語があれば、ぜひこのページに追記してください！ <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>