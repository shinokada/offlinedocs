<!doctype html><html lang="ja"><meta charset="utf-8"><title>サーバアクション</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="サーバアクション"><h1 id="サーバアクション">サーバアクション</h1><p>canary: true</p><intro><p>サーバアクション (Server Action) を使用することで、サーバで実行される非同期関数をクライアントコンポーネントから呼び出すことができます。</p></intro><inlinetoc><note><section class="level4"aria-labelledby="サーバアクションのサポートを追加する方法-how-do-i-build-support-for-server-actions"><h4 id="サーバアクションのサポートを追加する方法-how-do-i-build-support-for-server-actions">サーバアクションのサポートを追加する方法 {/<em>how-do-i-build-support-for-server-actions</em>/}</h4><p>React 19 のサーバアクションは安定しており、マイナーバージョン間での破壊的変更はありませんが、サーバコンポーネントのバンドラやフレームワーク内でサーバアクションを実装するために使用される、基盤となる API は semver に従いません。React 19.x のマイナーバージョン間で変更が生じる可能性があります。<p>サーバアクションをバンドラやフレームワークでサポートする場合は、特定の React バージョンに固定するか、Canary リリースを使用することをお勧めします。サーバアクションを実装するために使用される API を安定化させるため、今後もバンドラやフレームワークと連携を続けていきます。</section></note><p>サーバアクションが <code>"use server"</code> ディレクティブを付けて定義されると、フレームワークは自動的にそのサーバ関数への参照を作成し、その参照をクライアントコンポーネントに渡します。クライアントでこの関数が呼び出されると、React はサーバにリクエストを送信して元の関数を実行し、その結果を返します。<p>サーバアクションはサーバコンポーネント内で作成し、クライアントコンポーネントに props として渡すことができます。また、クライアントコンポーネントで直接インポートして使用することも可能です。<section class="level3"aria-labelledby="サーバコンポーネントからサーバアクションを作成する-creating-a-server-action-from-a-server-component"><h3 id="サーバコンポーネントからサーバアクションを作成する-creating-a-server-action-from-a-server-component">サーバコンポーネントからサーバアクションを作成する {/<em>creating-a-server-action-from-a-server-component</em>/}</h3><p>サーバコンポーネントは <code>"use server"</code> ディレクティブを使用してサーバアクションを定義できます。<pre class="language-js"><code class="language-js"><span class="token comment">// Server Component</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Button</span></span> <span class="token keyword module">from</span> <span class="token string">'./Button'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">EmptyNote</span></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createNoteAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Server Action</span>
    <span class="token string">'use server'</span><span class="token punctuation">;</span>
    
    <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token property-access">notes</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Button</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span>createNoteAction<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>React がサーバコンポーネントである <code>EmptyNote</code> をレンダーすると、<code>createNoteAction</code> 関数への参照を作成し、この参照をクライアントコンポーネントである <code>Button</code> に渡します。ボタンがクリックされると、React は渡された参照を使用してサーバにリクエストを送信し、<code>createNoteAction</code> 関数を実行します。<pre class="language-js"><code class="language-js"><span class="token string">"use client"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Button</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>onClick<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Create</span> <span class="token maybe-class-name">Empty</span> <span class="token maybe-class-name">Note</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token punctuation">}</span></code></pre><p>詳細については、<a href="/reference/rsc/use-server"><code>"use server"</code></a> のドキュメントを参照してください。</section><section class="level3"aria-labelledby="クライアントコンポーネントからサーバアクションをインポートする-importing-server-actions-from-client-components"><h3 id="クライアントコンポーネントからサーバアクションをインポートする-importing-server-actions-from-client-components">クライアントコンポーネントからサーバアクションをインポートする {/<em>importing-server-actions-from-client-components</em>/}</h3><p>クライアントコンポーネントは <code>"use server"</code> ディレクティブを使用するファイルから、サーバアクションをインポートできます。<pre class="language-js"><code class="language-js"><span class="token string">"use server"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createNoteAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token property-access">notes</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>バンドラがクライアントコンポーネントである <code>EmptyNote</code> をビルドする際に、バンドル内で <code>createNoteAction</code> 関数への参照を作成します。<code>button</code> がクリックされると、React は渡された参照を使用してサーバにリクエストを送信し、<code>createNoteAction</code> 関数を実行します。<pre class="language-js"><code class="language-js"><span class="token string">"use client"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>createNoteAction<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./actions'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">EmptyNote</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>createNoteAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>createNoteAction<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">}</span></code></pre><p>詳細については、<a href="/reference/rsc/use-server"><code>"use server"</code></a> のドキュメントを参照してください。</section><section class="level3"aria-labelledby="アクションとサーバアクションを組み合わせる-composing-server-actions-with-actions"><h3 id="アクションとサーバアクションを組み合わせる-composing-server-actions-with-actions">アクションとサーバアクションを組み合わせる {/<em>composing-server-actions-with-actions</em>/}</h3><p>サーバアクションはクライアントのアクションと組み合わせることができます。<pre class="language-js"><code class="language-js"><span class="token string">"use server"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">updateName</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span><span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">'Name is required'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token property-access">users</span><span class="token punctuation">.</span><span class="token method function property-access">updateName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token string">"use client"</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>updateName<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./actions'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">UpdateName</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>isPending<span class="token punctuation">,</span> startTransition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useTransition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">submitAction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>error<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">updateName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>submitAction<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"name"</span> disabled<span class="token operator">=</span><span class="token punctuation">{</span>isPending<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">error</span> <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span>span<span class="token operator">></span><span class="token maybe-class-name">Failed</span><span class="token operator">:</span> <span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">error</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><p>このようにクライアント側のアクションでラップすることで、サーバアクションによる <code>isPending</code> state にアクセスできます。<p>詳細については、<a href="/reference/rsc/use-server#calling-a-server-action-outside-of-form">フォーム外でサーバアクションを呼び出す</a>を参照してください。</section><section class="level3"aria-labelledby="フォームアクションとサーバアクション-form-actions-with-server-actions"><h3 id="フォームアクションとサーバアクション-form-actions-with-server-actions">フォームアクションとサーバアクション {/<em>form-actions-with-server-actions</em>/}</h3><p>サーバアクションは React 19 の新しいフォーム関連機能と連携します。<p>フォームにサーバアクションを渡すことで、自動的にフォームをサーバに送信できます。<pre class="language-js"><code class="language-js"><span class="token string">"use client"</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>updateName<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./actions'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">UpdateName</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>updateName<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"name"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><p>フォームの送信が成功すると、React は自動的にフォームをリセットします。<code>useActionState</code> を追加して、進行中 (pending) state や最終的なレスポンスにアクセスしたり、プログレッシブエンハンスメント (progressive enhancement) をサポートしたりすることが可能です。<p>詳細については、<a href="/reference/rsc/use-server#server-actions-in-forms">フォーム内でのサーバアクション</a>を参照してください。</section><section class="level3"aria-labelledby="useactionstate-とサーバアクション-server-actions-with-use-action-state"><h3 id="useactionstate-とサーバアクション-server-actions-with-use-action-state"><code>useActionState</code> とサーバアクション {/<em>server-actions-with-use-action-state</em>/}</h3><p><code>useActionState</code> とサーバアクションを組み合わせることで、アクションの進行中 state と最後に返されたレスポンスにアクセスする、という一般的なユースケースに対応できます。<pre class="language-js"><code class="language-js"><span class="token string">"use client"</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>updateName<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./actions'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">UpdateName</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> submitAction<span class="token punctuation">,</span> isPending<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>updateName<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>submitAction<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"name"</span> disabled<span class="token operator">=</span><span class="token punctuation">{</span>isPending<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">error</span> <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span>span<span class="token operator">></span><span class="token maybe-class-name">Failed</span><span class="token operator">:</span> <span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">error</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>サーバアクションと <code>useActionState</code> を使用する場合、React はハイドレーションの完了前に実行されたフォーム送信を自動的に再現します。これにより、ユーザはアプリのハイドレーションが起きる前からアプリを操作できるようになります。<p>詳細については、<a href="/reference/react-dom/hooks/useFormState"><code>useActionState</code></a> のドキュメントを参照してください。</section><section class="level3"aria-labelledby="useactionstate-を使用したプログレッシブエンハンスメント-progressive-enhancement-with-useactionstate"><h3 id="useactionstate-を使用したプログレッシブエンハンスメント-progressive-enhancement-with-useactionstate"><code>useActionState</code> を使用したプログレッシブエンハンスメント {/<em>progressive-enhancement-with-useactionstate</em>/}</h3><p>サーバアクションは <code>useActionState</code> の第 3 引数を使用してプログレッシブエンハンスメントもサポートします。<pre class="language-js"><code class="language-js"><span class="token string">"use client"</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>updateName<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./actions'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">UpdateName</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> submitAction<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>updateName<span class="token punctuation">,</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/name/update</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>submitAction<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token spread operator">...</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><codestep step="{2}">パーマリンク</codestep>が <code>useActionState</code> に渡された場合、JavaScript バンドルが読み込まれる前にフォームが送信されると、React はこの渡された URL にリダイレクトします。<p>詳しくは、<a href="/reference/react-dom/hooks/useFormState"><code>useActionState</code></a> のドキュメントを参照してください。 <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></inlinetoc></section>