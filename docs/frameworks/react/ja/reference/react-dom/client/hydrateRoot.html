<!doctype html><html lang="ja"><meta charset="utf-8"><title>hydrateRoot</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="hydrateroot"><h1 id="hydrateroot">hydrateRoot</h1><intro><p><code>hydrateRoot</code> を使用すると、<a href="/reference/react-dom/server"><code>react-dom/server</code></a> によって事前生成した HTML コンテンツが含まれるブラウザ DOM ノード内に、React コンポーネントを表示できます。<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">hydrateRoot</span><span class="token punctuation">(</span>domNode<span class="token punctuation">,</span> reactNode<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">)</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="リファレンス-reference"><h2 id="リファレンス-reference">リファレンス {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="hydraterootdomnode-reactnode-options-hydrateroot"><h3 id="hydraterootdomnode-reactnode-options-hydrateroot"><code>hydrateRoot(domNode, reactNode, options?)</code> {/<em>hydrateroot</em>/}</h3><p><code>hydrateRoot</code> を呼び出して、サーバ環境で事前に React がレンダーした HTML に対して React を「アタッチ」します。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrateRoot <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/client'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> domNode <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">hydrateRoot</span><span class="token punctuation">(</span>domNode<span class="token punctuation">,</span> reactNode<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>React は、<code>domNode</code> 内に存在する HTML にアタッチし、その内部の DOM の管理を引き継ぎます。React で完全に構築されたアプリには、ルートコンポーネントを引数にした <code>hydrateRoot</code> 呼び出しが通常 1 つのみ存在します。<p><a href="#usage">さらに例を見る</a><section class="level4"aria-labelledby="引数-parameters"><h4 id="引数-parameters">引数 {/<em>parameters</em>/}</h4><ul><li><p><code>domNode</code>: サーバ上でルート要素としてレンダーされた <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element">DOM 要素</a>。<li><p><code>reactNode</code>: 既存の初期 HTML をレンダーするために使用された "React ノード"。これは通常、<code>ReactDOM Server</code> のメソッド（例：<code>renderToPipeableStream(&#x3C;App />)</code>）でレンダーされた JSX、例えば <code>&#x3C;App /></code> になります。<li><p><strong>省略可能</strong> <code>options</code>: この React ルートのオプションを含むオブジェクト。<ul><li><strong>省略可能</strong> <code>onRecoverableError</code>: React が自動的にエラーから回復したときに呼び出されるコールバック。<li><strong>省略可能</strong> <code>identifierPrefix</code>: React が <a href="/reference/react/useId"><code>useId</code></a> によって生成する ID に使用する文字列プレフィックス。同じページ上に複数のルートを使用する際に、競合を避けるために用います。サーバ上で使用されたものと同じプレフィックスでなければなりません。</ul></ul></section><section class="level4"aria-labelledby="返り値-returns"><h4 id="返り値-returns">返り値 {/<em>returns</em>/}</h4><p><code>hydrateRoot</code> は、<a href="#root-render"><code>render</code></a> と <a href="#root-unmount"><code>unmount</code></a> の 2 つのメソッドを持つオブジェクトを返します。</section><section class="level4"aria-labelledby="注意点-caveats"><h4 id="注意点-caveats">注意点 {/<em>caveats</em>/}</h4><ul><li><code>hydrateRoot()</code> は、レンダーされたコンテンツがサーバでレンダーされたコンテンツと同一であることを期待しています。不一致はバグとして扱い修正する必要があります。<li>開発モードでは、React はハイドレーション中の不一致について警告します。不一致が発生した場合、属性の違いが修正される保証はありません。これはパフォーマンス上の理由から重要です。なぜならほとんどのアプリでは、不一致はまれであり、すべてのマークアップを検証することは非常に高コストになるからです。<li>アプリには通常、<code>hydrateRoot</code> 呼び出しは 1 つだけ存在します。フレームワークを使用している場合、フレームワークがこの呼び出しを行うかもしれません。<li>アプリがクライアントでレンダーする形式であり、事前レンダーされた HTML がない場合、<code>hydrateRoot()</code> は使用できません。代わりに <a href="/reference/react-dom/client/createRoot"><code>createRoot()</code></a> を使用してください。</ul></section></section><section class="level3"aria-labelledby="rootrenderreactnode-root-render"><h3 id="rootrenderreactnode-root-render"><code>root.render(reactNode)</code> {/<em>root-render</em>/}</h3><p><code>root.render</code> を呼び出して、ブラウザ DOM 要素内にハイドレーションされた React ルート内の React コンポーネントを更新します。<pre class="language-js"><code class="language-js">root<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>React はハイドレーションされた <code>root</code> 内の <code>&#x3C;App /></code> を更新します。<p><a href="#usage">さらに例を見る</a><section class="level4"aria-labelledby="引数-root-render-parameters"><h4 id="引数-root-render-parameters">引数 {/<em>root-render-parameters</em>/}</h4><ul><li><code>reactNode</code>: 更新したい "React ノード"。通常は <code>&#x3C;App /></code> のような JSX ですが、<a href="/reference/react/createElement"><code>createElement()</code></a> で構築した React 要素や、文字列、数値、<code>null</code>、または <code>undefined</code> を渡すこともできます。</ul></section><section class="level4"aria-labelledby="返り値-root-render-returns"><h4 id="返り値-root-render-returns">返り値 {/<em>root-render-returns</em>/}</h4><p><code>root.render</code> は <code>undefined</code> を返します。</section><section class="level4"aria-labelledby="注意点-root-render-caveats"><h4 id="注意点-root-render-caveats">注意点 {/<em>root-render-caveats</em>/}</h4><ul><li>ルートがハイドレーションを完了する前に <code>root.render</code> を呼び出すと、React は既存のサーバレンダリングされた HTML コンテンツをクリアし、ルート全体をクライアントでのレンダーに切り替えます。</ul></section></section><section class="level3"aria-labelledby="rootunmount-root-unmount"><h3 id="rootunmount-root-unmount"><code>root.unmount()</code> {/<em>root-unmount</em>/}</h3><p><code>root.unmount</code> を呼び出して、React ルート内にレンダーされたツリーを破棄します。<pre class="language-js"><code class="language-js">root<span class="token punctuation">.</span><span class="token method function property-access">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>React で完全に構築されたアプリには、通常、<code>root.unmount</code> の呼び出しは一切ありません。<p>これは主に、React ルートの DOM ノード（またはその祖先のいずれか）が他のコードによって DOM から削除される可能性がある場合に有用です。例えば、非アクティブなタブを DOM から削除する jQuery のタブパネルがあると想像してみてください。タブが削除されると、（React ルートを含んだ）内部のすべてが DOM から削除されます。その場合、削除されたルートのコンテンツの管理を「停止」するよう React に伝えるために <code>root.unmount</code> を呼び出す必要があります。そうしないと、削除されたルート内のコンポーネントは、データ購読などのグローバルリソースをクリーンアップして解放する必要があるということが分からないままになります。<p><code>root.unmount</code> を呼び出すことで、ルート内のすべてのコンポーネントがアンマウントされ、React がルート DOM ノードから「切り離され」ます。これには、ツリー内のイベントハンドラや state の削除も含まれます。<section class="level4"aria-labelledby="引数-root-unmount-parameters"><h4 id="引数-root-unmount-parameters">引数 {/<em>root-unmount-parameters</em>/}</h4><p><code>root.unmount</code> は引数を受け付けません。</section><section class="level4"aria-labelledby="返り値-root-unmount-returns"><h4 id="返り値-root-unmount-returns">返り値 {/<em>root-unmount-returns</em>/}</h4><p><code>root.unmount</code> は <code>undefined</code> を返します。</section><section class="level4"aria-labelledby="注意点-root-unmount-caveats"><h4 id="注意点-root-unmount-caveats">注意点 {/<em>root-unmount-caveats</em>/}</h4><ul><li><p><code>root.unmount</code> を呼び出すと、ツリー内のすべてのコンポーネントがアンマウントされ、React がルート DOM ノードから「切り離され」ます。<li><p><code>root.unmount</code> を呼び出した後、同一ルートで再度 <code>root.render</code> を呼び出すことはできません。アンマウント済みのルートで <code>root.render</code> を呼び出そうとすると、"Cannot update an unmounted root" というエラーがスローされます。</ul></section></section></section><section class="level2"aria-labelledby="使用法-usage"><h2 id="使用法-usage">使用法 {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="サーバでレンダーされた-html-のハイドレーション-hydrating-server-rendered-html"><h3 id="サーバでレンダーされた-html-のハイドレーション-hydrating-server-rendered-html">サーバでレンダーされた HTML のハイドレーション {/<em>hydrating-server-rendered-html</em>/}</h3><p>あなたのアプリの HTML が <a href="/reference/react-dom/client/createRoot"><code>react-dom/server</code></a> によって生成されている場合、クライアント上それに対する<em>ハイドレーション</em>を行う必要があります。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrateRoot <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/client'</span><span class="token punctuation">;</span>

<span class="token function">hydrateRoot</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>これにより、<codestep step="{1}">ブラウザ DOM ノード</codestep>内にあるサーバからの HTML がハイドレーションされ、あなたのアプリの<codestep step="{2}">React コンポーネント</codestep>となります。通常、これはスタートアップ時に一度のみ行います。フレームワークを使用している場合はあなたの代わりにこの呼び出しが自動で行われるかもしれません。<p>アプリのハイドレーション時に React は、サーバで生成された初期 HTML に、あなたのコンポーネントのロジックを「アタッチ」します。ハイドレーションにより、サーバからの初期 HTML スナップショットが、ブラウザで動作する完全にインタラクティブなアプリに変化します。</p><sandpack><pre class="language-html"><code class="language-html"><span class="token comment">&#x3C;!--
  HTML content inside &#x3C;div id="root">...&#x3C;/div>
  was generated from App by react-dom/server.
--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span>Hello, world!<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span><span class="token punctuation">></span></span>You clicked me <span class="token comment">&#x3C;!-- --></span>0<span class="token comment">&#x3C;!-- --></span> times<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token string">'./styles.css'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrateRoot <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/client'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">App</span></span> <span class="token keyword module">from</span> <span class="token string">'./App.js'</span><span class="token punctuation">;</span>

<span class="token function">hydrateRoot</span><span class="token punctuation">(</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Hello</span><span class="token punctuation">,</span> world<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Counter</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Counter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token maybe-class-name">You</span> clicked me <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>通常、<code>hydrateRoot</code> を再度呼び出したり、複数の場所で呼び出したりする必要はありません。ここから先は、React がアプリケーションの DOM を管理しています。UI を更新するには、コンポーネントは <a href="/reference/react/useState">state を使うことになるでしょう</a>。</p><pitfall><p><code>hydrateRoot</code> に渡す React ツリーは、サーバ上で行った出力と<strong>同じ出力</strong>を生成する必要があります。<p>これはユーザ体験にとって重要です。ユーザはあなたの JavaScript コードがロードされる前に、サーバが生成した HTML を一定時間見ています。サーバレンダリングによりアプリの出力の HTML スナップショットを表示することで、アプリが素早くロードされているという錯覚が作り出されます。突然異なるコンテンツを表示すると、その錯覚が壊れてしまいます。このため、サーバからのレンダーの出力はクライアント上での初期レンダーの出力と一致する必要があるのです。<p>ハイドレーションエラーを引き起こす最も一般的な原因としては以下のようなものがあります。<ul><li>ルートノード内の React が生成した HTML の周囲に余分な空白（改行など）がある。<li>レンダーのロジックで <code>typeof window !== 'undefined'</code> のようなチェックを使用している。<li>レンダーのロジックで <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/matchMedia"><code>window.matchMedia</code></a> のようなブラウザ専用の API を使用している。<li>サーバとクライアントで異なるデータをレンダーしている。</ul><p>React は一部のハイドレーションエラーから回復できますが、<strong>他のバグと同様にそれらを修正する必要があります</strong>。運がよければアプリが遅くなるだけですが、最悪の場合、イベントハンドラが誤った要素にアタッチされる可能性があります。</p></pitfall></section><section class="level3"aria-labelledby="ドキュメント全体のハイドレーション-hydrating-an-entire-document"><h3 id="ドキュメント全体のハイドレーション-hydrating-an-entire-document">ドキュメント全体のハイドレーション {/<em>hydrating-an-entire-document</em>/}</h3><p>React で完全に構築されたアプリケーションは、<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/html"><code>&#x3C;html></code></a> タグを含むドキュメント全体を JSX としてレンダーすることができます。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>html<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>head<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>meta charSet<span class="token operator">=</span><span class="token string">"utf-8"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"/styles.css"</span><span class="token operator">></span><span class="token operator">&#x3C;</span><span class="token operator">/</span>link<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>title<span class="token operator">></span><span class="token maybe-class-name">My</span> app<span class="token operator">&#x3C;</span><span class="token operator">/</span>title<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>head<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>body<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Router</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>body<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>html<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>ドキュメント全体をハイドレートするには、<code>hydrateRoot</code> の最初の引数として <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/document"><code>document</code></a> グローバル変数を渡します。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrateRoot <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/client'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">App</span></span> <span class="token keyword module">from</span> <span class="token string">'./App.js'</span><span class="token punctuation">;</span>

<span class="token function">hydrateRoot</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">,</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section class="level3"aria-labelledby="やむを得ないハイドレーション不一致エラーの抑制-suppressing-unavoidable-hydration-mismatch-errors"><h3 id="やむを得ないハイドレーション不一致エラーの抑制-suppressing-unavoidable-hydration-mismatch-errors">やむを得ないハイドレーション不一致エラーの抑制 {/<em>suppressing-unavoidable-hydration-mismatch-errors</em>/}</h3><p>サーバとクライアントの間で、単一の要素の属性やテキストコンテンツがやむを得ない理由で異なる場合（たとえば、タイムスタンプなど）、ハイドレーションの不一致警告を抑制することができます。<p>要素のハイドレーション警告を抑制するには、<code>suppressHydrationWarning={true}</code> を追加します。</p><sandpack><pre class="language-html"><code class="language-html"><span class="token comment">&#x3C;!--
  HTML content inside &#x3C;div id="root">...&#x3C;/div>
  was generated from App by react-dom/server.
--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span>Current Date: <span class="token comment">&#x3C;!-- --></span>01/01/2020<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token string">'./styles.css'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrateRoot <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/client'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">App</span></span> <span class="token keyword module">from</span> <span class="token string">'./App.js'</span><span class="token punctuation">;</span>

<span class="token function">hydrateRoot</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>h1 suppressHydrationWarning<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token maybe-class-name">Current</span> <span class="token known-class-name class-name">Date</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toLocaleDateString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>これは単一レベルの深さまでしか機能せず、避難ハッチとしての使用を意図しています。過度に使用しないでください。これを使用してもテキストコンテンツ以外の場合は React は違いを修正しようとはしないため、将来の更新まで一貫性が保たれない可能性があります。</section><section class="level3"aria-labelledby="クライアントとサーバで異なるコンテンツの処理-handling-different-client-and-server-content"><h3 id="クライアントとサーバで異なるコンテンツの処理-handling-different-client-and-server-content">クライアントとサーバで異なるコンテンツの処理 {/<em>handling-different-client-and-server-content</em>/}</h3><p>サーバとクライアントで意図的に異なるものをレンダーする必要がある場合、2 回に分けたレンダーを行うことができます。クライアントで異なるものをレンダーするコンポーネントは、<code>isClient</code> のような <a href="/reference/react/useState">state 変数</a>を読み取るようにし、この変数を<a href="/reference/react/useEffect">エフェクト</a>内で <code>true</code> に設定することができます。</p><sandpack><pre class="language-html"><code class="language-html"><span class="token comment">&#x3C;!--
  HTML content inside &#x3C;div id="root">...&#x3C;/div>
  was generated from App by react-dom/server.
--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span>Is Server<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token string">'./styles.css'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrateRoot <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/client'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">App</span></span> <span class="token keyword module">from</span> <span class="token string">'./App.js'</span><span class="token punctuation">;</span>

<span class="token function">hydrateRoot</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isClient<span class="token punctuation">,</span> setIsClient<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setIsClient</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>
      <span class="token punctuation">{</span>isClient <span class="token operator">?</span> <span class="token string">'Is Client'</span> <span class="token operator">:</span> <span class="token string">'Is Server'</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>この方法では、初回のレンダーはサーバと同じコンテンツをレンダーし、不一致を回避しますが、追加のレンダーがハイドレーションの直後に同期的に行われます。</p><pitfall><p>このアプローチではコンポーネントを 2 回レンダーする必要があるためハイドレーションが遅くなります。低速な接続におけるユーザ体験に注意してください。JavaScript コードは初期レンダーされた HTML よりもかなり遅く読み込まれる場合があるため、ハイドレーション直後に異なる UI をレンダーするとユーザに不快感を与えるかもしれません。</p></pitfall></section><section class="level3"aria-labelledby="ハイドレーションされたルートコンポーネントの更新-updating-a-hydrated-root-component"><h3 id="ハイドレーションされたルートコンポーネントの更新-updating-a-hydrated-root-component">ハイドレーションされたルートコンポーネントの更新 {/<em>updating-a-hydrated-root-component</em>/}</h3><p>ルートのハイドレーションが完了した後、<a href="#root-render"><code>root.render</code></a> を呼び出してルートの React コンポーネントを更新することができます。<strong><a href="/reference/react-dom/client/createRoot"><code>createRoot</code></a> の場合とは異なり、初期コンテンツはすでに HTML としてレンダーされているため、通常はこれを行う必要はありません</strong>。<p>ハイドレーションの後のどこかのタイミングで <code>root.render</code> を呼び出し、コンポーネントツリーの構造が以前にレンダーされたものと一致していれば、React は <a href="/learn/preserving-and-resetting-state">state を保持します</a>。以下の例で入力フィールドにタイプできることに着目してください。つまり毎秒 <code>render</code> が繰り返し呼び出されていますが、更新により DOM が破壊されていないということです。</p><sandpack><pre class="language-html"><code class="language-html"><span class="token comment">&#x3C;!--
  All HTML content inside &#x3C;div id="root">...&#x3C;/div> was
  generated by rendering &#x3C;App /> with react-dom/server.
--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span>Hello, world! <span class="token comment">&#x3C;!-- --></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Type something here<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrateRoot <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/client'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token string">'./styles.css'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">App</span></span> <span class="token keyword module">from</span> <span class="token string">'./App.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">hydrateRoot</span><span class="token punctuation">(</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> counter<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  root<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> counter<span class="token operator">=</span><span class="token punctuation">{</span>i<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  i<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>counter<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Hello</span><span class="token punctuation">,</span> world<span class="token operator">!</span> <span class="token punctuation">{</span>counter<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input placeholder<span class="token operator">=</span><span class="token string">"Type something here"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>ハイドレーションされたルートで <a href="#root-render"><code>root.render</code></a> を呼び出すことは滅多にありません。通常、代わりにコンポーネントの中で <a href="/reference/react/useState">state を更新</a> します。 <span style="float:footnote"><a href="../../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>