<!doctype html><html lang="ja"><meta charset="utf-8"><title>hydrate</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="hydrate"><h1 id="hydrate">hydrate</h1><deprecated><p>この API は、今後のメジャーバージョンの React で削除される予定です。<p>React 18 では、<code>hydrate</code> は <a href="/reference/react-dom/client/hydrateRoot"><code>hydrateRoot</code> に置き換えられました。</a>React 18 で <code>hydrate</code> を使用すると、アプリは React 17 を実行しているかのような振る舞いになるとの警告が表示されます。詳細は<a href="/blog/2022/03/08/react-18-upgrade-guide#updates-to-client-rendering-apis">こちらをご覧ください。</a></p></deprecated><intro><p><code>hydrate</code> を使用すると、React 17 以前の <a href="/reference/react-dom/server"><code>react-dom/server</code></a> によって事前生成した HTML コンテンツが含まれるブラウザ DOM ノード内に、React コンポーネントを表示できます。<pre class="language-js"><code class="language-js"><span class="token function">hydrate</span><span class="token punctuation">(</span>reactNode<span class="token punctuation">,</span> domNode<span class="token punctuation">,</span> callback<span class="token operator">?</span><span class="token punctuation">)</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="リファレンス-reference"><h2 id="リファレンス-reference">リファレンス {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="hydratereactnode-domnode-callback-hydrate"><h3 id="hydratereactnode-domnode-callback-hydrate"><code>hydrate(reactNode, domNode, callback?)</code> {/<em>hydrate</em>/}</h3><p>React 17 以前の環境で <code>hydrate</code> を呼び出して、サーバ環境で事前に React がレンダーした HTML に対して React を「アタッチ」します。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrate <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token function">hydrate</span><span class="token punctuation">(</span>reactNode<span class="token punctuation">,</span> domNode<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>React は、<code>domNode</code> 内に存在する HTML にアタッチし、その内部の DOM の管理を引き継ぎます。React で完全に構築されたアプリには、ルートコンポーネントを引数にした <code>hydrate</code> 呼び出しが通常 1 つのみ存在します。<p><a href="#usage">さらに例を見る</a><section class="level4"aria-labelledby="引数-parameters"><h4 id="引数-parameters">引数 {/<em>parameters</em>/}</h4><ul><li><p><code>reactNode</code>: 既存の初期 HTML をレンダーするのに使用された "React ノード"。これは通常、<code>ReactDOM Server</code> のメソッド（例：React 17 の <code>renderToString(&#x3C;App />)</code>）でレンダーされた JSX、例えば <code>&#x3C;App /></code> になります。<li><p><code>domNode</code>: サーバ上でルート要素としてレンダーされた <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element">DOM 要素</a>。<li><p><strong>省略可能</strong> <code>callback</code>: 関数。渡された場合、React はコンポーネントのハイドレーション後にそれを呼び出します。</ul></section><section class="level4"aria-labelledby="返り値-returns"><h4 id="返り値-returns">返り値 {/<em>returns</em>/}</h4><p><code>hydrate</code> は null を返します。</section><section class="level4"aria-labelledby="注意点-caveats"><h4 id="注意点-caveats">注意点 {/<em>caveats</em>/}</h4><ul><li><code>hydrate</code> は、レンダーされたコンテンツが、サーバでレンダーされたコンテンツと同一であることを期待しています。React はテキストコンテンツの差異を修正できますが、不一致はバグとして扱い修正する必要があります。<li>開発モードでは、React はハイドレーション中の不一致について警告します。不一致が発生した場合、属性の違いが修正される保証はありません。これはパフォーマンス上の理由から重要です。なぜならほとんどのアプリでは、不一致はまれであり、すべてのマークアップを検証することは非常に高コストになるからです。<li>アプリには通常、<code>hydrate</code> 呼び出しは 1 つだけ存在します。フレームワークを使用している場合、フレームワークがこの呼び出しを行うかもしれません。<li>アプリがクライアントでレンダーする形式であり、事前レンダーされた HTML がない場合、<code>hydrate()</code> は使用できません。代わりに、React 17 以前では <a href="/reference/react-dom/render">render()</a>、React 18 以降では <a href="/reference/react-dom/client/createRoot">createRoot()</a> を使用してください。</ul></section></section></section><section class="level2"aria-labelledby="使用法-usage"><h2 id="使用法-usage">使用法 {/<em>usage</em>/}</h2><p><code>hydrate</code> を呼び出して、<codestep step="{1}">React コンポーネント</codestep>をサーバでレンダーされた<codestep step="{2}">ブラウザの DOM ノード</codestep>にアタッチします。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrate <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token function">hydrate</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>hydrate()</code> を使用して、クライアントのみのアプリ（サーバでレンダーされた HTML がないアプリ）をレンダーすることはサポートされていません。代わりに、React 17 以前では <a href="/reference/react-dom/render"><code>render()</code></a>、React 18 以降では <a href="/reference/react-dom/client/createRoot"><code>createRoot()</code></a> を使用してください。<section class="level3"aria-labelledby="サーバでレンダーされた-html-のハイドレーション-hydrating-server-rendered-html"><h3 id="サーバでレンダーされた-html-のハイドレーション-hydrating-server-rendered-html">サーバでレンダーされた HTML のハイドレーション {/<em>hydrating-server-rendered-html</em>/}</h3><p>React では、"ハイドレーション (hydration)" とは、サーバ環境の React によって事前レンダーされている HTML に React が「アタッチ」することを指します。ハイドレーション中、React は既存のマークアップにイベントリスナをアタッチし、アプリのレンダー処理をクライアントに引き継ぎます。<p>React で完全に構築されたアプリでは、<strong>通常、アプリ全体の起動時に 1 つの「ルート」のハイドレーションを一度だけ行います</strong>。</p><sandpack><pre class="language-html"><code class="language-html"><span class="token comment">&#x3C;!--
  HTML content inside &#x3C;div id="root">...&#x3C;/div>
  was generated from App by react-dom/server.
--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span>Hello, world!<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token string">'./styles.css'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrate <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">App</span></span> <span class="token keyword module">from</span> <span class="token string">'./App.js'</span><span class="token punctuation">;</span>

<span class="token function">hydrate</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Hello</span><span class="token punctuation">,</span> world<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>通常、<code>hydrate</code> を再度呼び出したり、複数の場所で呼び出したりする必要はありません。ここから先は、React がアプリケーションの DOM を管理しています。UI を更新するには、コンポーネントは <a href="/reference/react/useState">state を使うことになるでしょう。</a><p>ハイドレーションに関する詳細は、<a href="/reference/react-dom/client/hydrateRoot"><code>hydrateRoot</code> のドキュメント</a>を参照してください。</section><section class="level3"aria-labelledby="やむを得ないハイドレーション不一致エラーの抑制-suppressing-unavoidable-hydration-mismatch-errors"><h3 id="やむを得ないハイドレーション不一致エラーの抑制-suppressing-unavoidable-hydration-mismatch-errors">やむを得ないハイドレーション不一致エラーの抑制 {/<em>suppressing-unavoidable-hydration-mismatch-errors</em>/}</h3><p>サーバとクライアントの間で、単一の要素の属性やテキストコンテンツがやむを得ない理由で異なる場合（たとえば、タイムスタンプなど）、ハイドレーションの不一致警告を抑制することができます。<p>要素のハイドレーション警告を抑制するには、<code>suppressHydrationWarning={true}</code> を追加します。</p><sandpack><pre class="language-html"><code class="language-html"><span class="token comment">&#x3C;!--
  HTML content inside &#x3C;div id="root">...&#x3C;/div>
  was generated from App by react-dom/server.
--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span>Current Date: 01/01/2020<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token string">'./styles.css'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrate <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">App</span></span> <span class="token keyword module">from</span> <span class="token string">'./App.js'</span><span class="token punctuation">;</span>

<span class="token function">hydrate</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>h1 suppressHydrationWarning<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token maybe-class-name">Current</span> <span class="token known-class-name class-name">Date</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toLocaleDateString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>これは単一レベルの深さまでしか機能せず、避難ハッチとしての使用を意図しています。過度に使用しないでください。これを使用してもテキストコンテンツ以外の場合は React は違いを修正しようとはしないため、将来の更新まで一貫性が保たれない可能性があります。</section><section class="level3"aria-labelledby="クライアントとサーバで異なるコンテンツの処理-handling-different-client-and-server-content"><h3 id="クライアントとサーバで異なるコンテンツの処理-handling-different-client-and-server-content">クライアントとサーバで異なるコンテンツの処理 {/<em>handling-different-client-and-server-content</em>/}</h3><p>サーバとクライアントで意図的に異なるものをレンダーする必要がある場合、2 回に分けたレンダーを行うことができます。クライアントで異なるものをレンダーするコンポーネントは、<code>isClient</code> のような <a href="/reference/react/useState">state 変数</a>を読み取るようにし、この変数を<a href="/reference/react/useEffect">エフェクト</a>内で <code>true</code> に設定することができます。</p><sandpack><pre class="language-html"><code class="language-html"><span class="token comment">&#x3C;!--
  HTML content inside &#x3C;div id="root">...&#x3C;/div>
  was generated from App by react-dom/server.
--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span>Is Server<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token string">'./styles.css'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> hydrate <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">App</span></span> <span class="token keyword module">from</span> <span class="token string">'./App.js'</span><span class="token punctuation">;</span>

<span class="token function">hydrate</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isClient<span class="token punctuation">,</span> setIsClient<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setIsClient</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>
      <span class="token punctuation">{</span>isClient <span class="token operator">?</span> <span class="token string">'Is Client'</span> <span class="token operator">:</span> <span class="token string">'Is Server'</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>この方法では、初回のレンダーはサーバと同じコンテンツをレンダーし、不一致を回避しますが、追加のレンダーがハイドレーションの直後に同期的に行われます。</p><pitfall><p>このアプローチではコンポーネントを 2 回レンダーする必要があるためハイドレーションが遅くなります。低速な接続におけるユーザ体験に注意してください。JavaScript コードは初期レンダーされた HTML よりもかなり遅く読み込まれる場合があるため、ハイドレーション直後に異なる UI をレンダーするとユーザに不快感を与えるかもしれません。</p></pitfall><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>