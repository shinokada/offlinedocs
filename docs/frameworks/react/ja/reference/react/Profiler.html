<!doctype html><html lang="ja"><meta charset="utf-8"><title>&#x3C;Profiler></title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="profiler"><h1 id="profiler"><profiler></profiler></h1><intro><p><code>&#x3C;Profiler></code> を使うことで、React ツリーのレンダリングパフォーマンスをプログラムで測定することができます。<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profiler</span> id<span class="token operator">=</span><span class="token string">"App"</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Profiler</span><span class="token operator">></span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="リファレンス-reference"><h2 id="リファレンス-reference">リファレンス {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="profiler-profiler"><h3 id="profiler-profiler"><code>&#x3C;Profiler></code> {/<em>profiler</em>/}</h3><p>コンポーネントツリーを <code>&#x3C;Profiler></code> でラップすることで、レンダーのパフォーマンスを測定することができます。<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profiler</span> id<span class="token operator">=</span><span class="token string">"App"</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Profiler</span><span class="token operator">></span></code></pre><section class="level4"aria-labelledby="props-props"><h4 id="props-props">props {/<em>props</em>/}</h4><ul><li><code>id</code>: UI のどの部分を測定対象としているのか識別するための文字列です。<li><code>onRender</code>: プロファイリング対象のツリー内のコンポーネントが更新されるたびに React が呼び出す <a href="#onrender-callback"><code>onRender</code> コールバック</a>。何がレンダーされ、それにどれだけの時間がかかったかについての情報を受け取ります。</ul></section><section class="level4"aria-labelledby="注意点-caveats"><h4 id="注意点-caveats">注意点 {/<em>caveats</em>/}</h4><ul><li>プロファイリングには追加のオーバーヘッドが発生するため、<strong>デフォルトでは本番用ビルドでは無効になっています</strong>。本番環境でプロファイリングを行うためには、<a href="https://fb.me/react-profiling">プロファイリングを有効にしたな特別な本番用ビルド</a>を明示的に用いる必要があります。</ul></section></section><section class="level3"aria-labelledby="onrender-コールバック-onrender-callback"><h3 id="onrender-コールバック-onrender-callback"><code>onRender</code> コールバック {/<em>onrender-callback</em>/}</h3><p>React は <code>onRender</code> コールバックを呼び出して、何がレンダーされたかについての情報を伝えます。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">onRender</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> phase<span class="token punctuation">,</span> actualDuration<span class="token punctuation">,</span> baseDuration<span class="token punctuation">,</span> startTime<span class="token punctuation">,</span> commitTime</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Aggregate or log render timings...</span>
<span class="token punctuation">}</span></code></pre><section class="level4"aria-labelledby="引数-onrender-parameters"><h4 id="引数-onrender-parameters">引数 {/<em>onrender-parameters</em>/}</h4><ul><li><code>id</code>: たった今コミットされたツリーに対応する <code>&#x3C;Profiler></code> の <code>id</code> プロパティ。複数のプロファイラを使用している場合に、どのツリーがコミットされたかをこれにより識別できます。<li><code>phase</code>: <code>"mount"</code>、<code>"update"</code>、または <code>"nested-update"</code>。これにより、ツリーが初めてマウントされたのか、props、state、またはフックの変更により再レンダーされたのかを知ることができます。<li><code>actualDuration</code>: 現在の更新のために <code>&#x3C;Profiler></code> とその子要素がレンダーに費やしたミリ秒数。これは、サブツリーがメモ化（例：<a href="/reference/react/memo"><code>memo</code></a> と <a href="/reference/react/useMemo"><code>useMemo</code></a>）をどれだけうまく利用できているかを示すものです。理想的には、子要素の多くが自身の props が変更された場合にのみ再レンダーされるようになることで、この値は初回マウント後に大幅に減少していくはずです。<li><code>baseDuration</code>: もし最適化なしで <code>&#x3C;Profiler></code> サブツリー全体を再レンダーした場合にかかる時間をミリ秒で推定した数値。ツリー内の各コンポーネントの最後のレンダーにかかった時間を合計することで計算されます。この値は、最悪のツリーのレンダーコスト（例：初回マウントやメモ化がない場合）を推定します。メモ化が機能しているかどうかを確認するには、この値を <code>actualDuration</code> と比較します。<li><code>startTime</code>: React が現在の更新のレンダーを開始した時刻のタイムスタンプ。<li><code>commitTime</code>: React が現在の更新をコミットした時刻のタイムスタンプ。この値は単一コミット内のすべてのプロファイラ間で共有されるため、必要に応じてグループ化するために利用できます。</ul></section></section></section><section class="level2"aria-labelledby="使用法-usage"><h2 id="使用法-usage">使用法 {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="レンダーのパフォーマンスをプログラムで測定する-measuring-rendering-performance-programmatically"><h3 id="レンダーのパフォーマンスをプログラムで測定する-measuring-rendering-performance-programmatically">レンダーのパフォーマンスをプログラムで測定する {/<em>measuring-rendering-performance-programmatically</em>/}</h3><p>React ツリーを <code>&#x3C;Profiler></code> コンポーネントで囲むことで、そのレンダーのパフォーマンスを測定します。<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profiler</span> id<span class="token operator">=</span><span class="token string">"Sidebar"</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Sidebar</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Profiler</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PageContent</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">App</span><span class="token operator">></span></code></pre><p><code>id</code>（文字列）と <code>onRender</code> コールバック（関数）の 2 つの props が必要です。React はツリー内のコンポーネントが更新を「コミット」するたびにこれを呼び出します。</p><pitfall><p>プロファイリングには追加のオーバーヘッドが発生するため、<strong>デフォルトでは本番用ビルドでは無効になっています</strong>。本番環境でプロファイリングを行うためには、<a href="https://fb.me/react-profiling">プロファイリングを有効にしたな特別な本番用ビルド</a>を明示的に用いる必要があります。</p></pitfall><note><p><code>&#x3C;Profiler></code> を使うことで測定結果をプログラムで収集することができます。対話型のプロファイラを使いたい場合は、<a href="/learn/react-developer-tools">React Developer Tools</a> の Profiler タブを試してみてください。これは同様の機能をブラウザの拡張機能として提供します。</p></note></section><section class="level3"aria-labelledby="アプリケーションの複数部位を測定する-measuring-different-parts-of-the-application"><h3 id="アプリケーションの複数部位を測定する-measuring-different-parts-of-the-application">アプリケーションの複数部位を測定する {/<em>measuring-different-parts-of-the-application</em>/}</h3><p>アプリケーションの複数の部位を測定するために、複数の <code>&#x3C;Profiler></code> コンポーネントを使用することができます。<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profiler</span> id<span class="token operator">=</span><span class="token string">"Sidebar"</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Sidebar</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Profiler</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profiler</span> id<span class="token operator">=</span><span class="token string">"Content"</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Content</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Profiler</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">App</span><span class="token operator">></span></code></pre><p>また、<code>&#x3C;Profiler></code> コンポーネントをネストすることもできます。<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profiler</span> id<span class="token operator">=</span><span class="token string">"Sidebar"</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Sidebar</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Profiler</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profiler</span> id<span class="token operator">=</span><span class="token string">"Content"</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Content</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profiler</span> id<span class="token operator">=</span><span class="token string">"Editor"</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Editor</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Profiler</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Preview</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Content</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Profiler</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">App</span><span class="token operator">></span></code></pre><p><code>&#x3C;Profiler></code> は軽量なコンポーネントですが、必要な場合にのみ使用するべきです。使用するたびにアプリケーションに一定の CPU とメモリのオーバーヘッドが生じます。<p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>