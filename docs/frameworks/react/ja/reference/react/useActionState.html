<!doctype html><html lang="ja"><meta charset="utf-8"><title>useActionState</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="useactionstate"><h1 id="useactionstate">useActionState</h1><p>canary: true</p><canary><p><code>useActionState</code> フックは、現在 React の Canary および experimental チャンネルでのみ利用可能です。<a href="/community/versioning-policy#all-release-channels">リリースチャンネルについてはこちらをご覧ください</a>。また、<code>useActionState</code> の利点をフルに活かすためには、<a href="/reference/rsc/use-client">React Server Components</a> をサポートするフレームワークを使用する必要があります。</p></canary><note><p>React Canary の以前のバージョンでは、この API は React DOM の一部であり <code>useFormState</code> という名前でした。</p></note><intro><p><code>useActionState</code> は、フォームアクションの結果に基づいて state を更新するためのフックです。<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> formAction<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> initialState<span class="token punctuation">,</span> permalink<span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="リファレンス-reference"><h2 id="リファレンス-reference">リファレンス {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="useactionstateaction-initialstate-permalink-useactionstate"><h3 id="useactionstateaction-initialstate-permalink-useactionstate"><code>useActionState(action, initialState, permalink?)</code> {/<em>useactionstate</em>/}</h3><p>{/<em> TODO T164397693: link to actions documentation once it exists </em>/}<p>コンポーネントのトップレベルで <code>useActionState</code> を呼び出してコンポーネントの state を作成し、<a href="/reference/react-dom/components/form">フォームアクションが呼び出されたとき</a>に更新されるようにします。既存のフォームアクション関数と初期 state を <code>useActionState</code> に渡し、フォームで使用する新しいアクションと最新のフォーム state が返されます。あなたが渡した関数にも、最新のフォーム state が渡されるようになります。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useActionState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token parameter">previousState<span class="token punctuation">,</span> formData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> previousState <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">StatefulForm</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> formAction<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>increment<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form<span class="token operator">></span>
      <span class="token punctuation">{</span>state<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>button formAction<span class="token operator">=</span><span class="token punctuation">{</span>formAction<span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Increment</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><p>フォーム state とは、フォームが最後に送信されたときにアクションによって返される値です。フォームがまだ送信されていない場合は、渡された初期 state が使われます。<p>サーバアクションと併用して <code>useActionState</code> を使うことで、ハイドレーションが完了する前にフォームが送信された場合でも、そのサーバからのレスポンスを表示できるようになります。<p><a href="#usage">さらに例を見る</a><section class="level4"aria-labelledby="引数-parameters"><h4 id="引数-parameters">引数 {/<em>parameters</em>/}</h4><ul><li><code>fn</code>: フォームが送信されたりボタンが押されたりしたときに呼び出される関数。この関数が呼び出される際には、1 番目の引数としてはフォームの前回 state（初回は渡した <code>initialState</code>、2 回目以降は前回の返り値）を受け取り、次の引数としてはフォームアクションが通常受け取る引数を受け取ります。<li><code>initialState</code>: state の初期値として使いたい値。シリアライズ可能な任意の値です。この引数はアクションが一度呼び出された後は無視されます。<li><strong>省略可能</strong> <code>permalink</code>: このフォームが書き換えの対象とするユニークなページ URL を含んだ文字列。ダイナミックなコンテンツ（ページフィードなど）のあるページでプログレッシブエンハンスメントを組み合わせる場合に使用します。<code>fn</code> が<a href="/reference/rsc/use-server">サーバアクション</a>であり、かつフォームが JavaScript バンドルの読み込み完了前に送信された場合、ブラウザは現在のページ URL ではなくこの指定されたパーマリンク用 URL に移動するようになります。React が state を正しく受け渡せるよう、移動先となるページでも（アクション <code>fn</code> と <code>permalink</code> も含む）同じフォームが必ずレンダーされるようにしてください。フォームのハイドレーションが完了した後は、このパラメータは無視されます。</ul><p>{/<em> TODO T164397693: link to serializable values docs once it exists </em>/}</section><section class="level4"aria-labelledby="返り値-returns"><h4 id="返り値-returns">返り値 {/<em>returns</em>/}</h4><p><code>useActionState</code> は 2 つの値を含む配列を返します。<ol><li>現在の state。初回レンダー時には、渡した <code>initialState</code> と等しくなります。アクションが呼び出された後は、そのアクションが返した値と等しくなります。<li>フォームコンポーネントの <code>action</code> プロパティや、フォーム内の任意の <code>button</code> コンポーネントの <code>formAction</code> プロパティとして渡すことができる新しいアクション。</ol></section><section class="level4"aria-labelledby="注意点-caveats"><h4 id="注意点-caveats">注意点 {/<em>caveats</em>/}</h4><ul><li>React Server Components をサポートするフレームワークで使用する場合、<code>useActionState</code> はクライアント上で JavaScript が実行される前にフォームを操作可能にできます。Server Components なしで使用する場合、コンポーネントのローカル state と同様のものになります。<li><code>useActionState</code> に渡される関数は、追加の 1 番目の引数として、前回 state ないし初期 state を受け取ります。従って <code>useActionState</code> を使用せずに直接フォームアクションとして使用する場合とは異なるシグネチャになります。</ul></section></section></section><section class="level2"aria-labelledby="使用法-usage"><h2 id="使用法-usage">使用法 {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="フォームアクションによって返された情報の使用-using-information-returned-by-a-form-action"><h3 id="フォームアクションによって返された情報の使用-using-information-returned-by-a-form-action">フォームアクションによって返された情報の使用 {/<em>using-information-returned-by-a-form-action</em>/}</h3><p>コンポーネントのトップレベルで <code>useActionState</code> を呼び出し、最後にフォームが送信された際のアクションの返り値にアクセスします。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useActionState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> action <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./actions.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> formAction<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>formAction<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span><span class="token comment">/* ... */</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><code>useActionState</code> は、2 つの項目を含む配列を返します。<ol><li>フォームの<codestep step="{1}">state の現在値</codestep>。初期値はあなたが渡した<codestep step="{4}">初期 state</codestep>となり、フォームが送信された後はあなたが渡した<codestep step="{3}">アクション</codestep>の返り値となります。<li><code>&#x3C;form></code> の props である <code>action</code> に渡せる<codestep step="{2}">新しいアクション</codestep>。</ol><p>フォームが送信されると、あなたが渡した<codestep step="{3}">アクション</codestep>関数が呼び出されます。その返り値が、新たなフォームの<codestep step="{1}">state 現在値</codestep>になります。<p>あなたが渡す<codestep step="{3}">アクション</codestep>は、新たな第 1 引数として、フォームの<codestep step="{1}">state の現在値</codestep>を受け取ります。フォームが初めて送信されるとき、これはあなたが渡した<codestep step="{4}">初期 state</codestep>と等しくなります。次回以降の送信では、アクションが前回呼び出されたときの返り値になります。残りの引数は <code>useActionState</code> を使用しなかった場合と同じです。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token parameter">currentState<span class="token punctuation">,</span> formData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword control-flow">return</span> <span class="token string">'next state'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><recipes titletext="フォーム送信後に情報を表示"titleid="display-information-after-submitting-a-form"><section class="level4"aria-labelledby="フォームエラーの表示-display-form-errors"><h4 id="フォームエラーの表示-display-form-errors">フォームエラーの表示 {/<em>display-form-errors</em>/}</h4><p>サーバアクションによって返されるメッセージをエラーメッセージやトーストとして表示するには、そのアクションを <code>useActionState</code> の呼び出しでラップします。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useActionState<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> addToCart <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"./actions.js"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AddToCartForm</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>itemID<span class="token punctuation">,</span> itemTitle<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> formAction<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>addToCart<span class="token punctuation">,</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>formAction<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token punctuation">{</span>itemTitle<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"hidden"</span> name<span class="token operator">=</span><span class="token string">"itemID"</span> value<span class="token operator">=</span><span class="token punctuation">{</span>itemID<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span><span class="token maybe-class-name">Add</span> to <span class="token maybe-class-name">Cart</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>message<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddToCartForm</span> itemID<span class="token operator">=</span><span class="token string">"1"</span> itemTitle<span class="token operator">=</span><span class="token string">"JavaScript: The Definitive Guide"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddToCartForm</span> itemID<span class="token operator">=</span><span class="token string">"2"</span> itemTitle<span class="token operator">=</span><span class="token string">"JavaScript: The Good Parts"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token string">"use server"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> queryData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> itemID <span class="token operator">=</span> queryData<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'itemID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>itemID <span class="token operator">===</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">"Added to cart"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">"Couldn't add to cart: the item is sold out."</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">form</span> <span class="token punctuation">{</span>
  <span class="token property">border</span><span class="token punctuation">:</span> solid <span class="token number">1</span><span class="token unit">px</span> <span class="token color">black</span><span class="token punctuation">;</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">24</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token unit">px</span>
<span class="token punctuation">}</span>

<span class="token selector">form button</span> <span class="token punctuation">{</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"canary"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"canary"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"^5.0.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"/index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section><section class="level4"aria-labelledby="フォーム送信後に構造化された情報を表示-display-structured-information-after-submitting-a-form"><h4 id="フォーム送信後に構造化された情報を表示-display-structured-information-after-submitting-a-form">フォーム送信後に構造化された情報を表示 {/<em>display-structured-information-after-submitting-a-form</em>/}</h4><p>サーバアクションからの返り値は、シリアライズ可能な値であれば任意です。例えばオブジェクトにして、アクションが成功したかどうかを示すブーリアン値や、エラーメッセージや、更新後の情報を含めることもできます。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useActionState<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> addToCart <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"./actions.js"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AddToCartForm</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>itemID<span class="token punctuation">,</span> itemTitle<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>formState<span class="token punctuation">,</span> formAction<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>addToCart<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>formAction<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token punctuation">{</span>itemTitle<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"hidden"</span> name<span class="token operator">=</span><span class="token string">"itemID"</span> value<span class="token operator">=</span><span class="token punctuation">{</span>itemID<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span><span class="token maybe-class-name">Add</span> to <span class="token maybe-class-name">Cart</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>formState<span class="token operator">?.</span>success <span class="token operator">&#x26;&#x26;</span>
        <span class="token operator">&#x3C;</span>div className<span class="token operator">=</span><span class="token string">"toast"</span><span class="token operator">></span>
          <span class="token maybe-class-name">Added</span> to cart<span class="token operator">!</span> <span class="token maybe-class-name">Your</span> cart now has <span class="token punctuation">{</span>formState<span class="token punctuation">.</span><span class="token property-access">cartSize</span><span class="token punctuation">}</span> items<span class="token punctuation">.</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">}</span>
      <span class="token punctuation">{</span>formState<span class="token operator">?.</span>success <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token operator">&#x26;&#x26;</span>
        <span class="token operator">&#x3C;</span>div className<span class="token operator">=</span><span class="token string">"error"</span><span class="token operator">></span>
          <span class="token maybe-class-name">Failed</span> to add to cart<span class="token operator">:</span> <span class="token punctuation">{</span>formState<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddToCartForm</span> itemID<span class="token operator">=</span><span class="token string">"1"</span> itemTitle<span class="token operator">=</span><span class="token string">"JavaScript: The Definitive Guide"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddToCartForm</span> itemID<span class="token operator">=</span><span class="token string">"2"</span> itemTitle<span class="token operator">=</span><span class="token string">"JavaScript: The Good Parts"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token string">"use server"</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> queryData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> itemID <span class="token operator">=</span> queryData<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'itemID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>itemID <span class="token operator">===</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cartSize</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"The item is sold out."</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">form</span> <span class="token punctuation">{</span>
  <span class="token property">border</span><span class="token punctuation">:</span> solid <span class="token number">1</span><span class="token unit">px</span> <span class="token color">black</span><span class="token punctuation">;</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">24</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token unit">px</span>
<span class="token punctuation">}</span>

<span class="token selector">form button</span> <span class="token punctuation">{</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"canary"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"canary"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"^5.0.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"/index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section></recipes></section></section><section class="level2"aria-labelledby="トラブルシューティング-troubleshooting"><h2 id="トラブルシューティング-troubleshooting">トラブルシューティング {/<em>troubleshooting</em>/}</h2><section class="level3"aria-labelledby="アクションが送信されたフォームデータを読み取れなくなった-my-action-can-no-longer-read-the-submitted-form-data"><h3 id="アクションが送信されたフォームデータを読み取れなくなった-my-action-can-no-longer-read-the-submitted-form-data">アクションが送信されたフォームデータを読み取れなくなった {/<em>my-action-can-no-longer-read-the-submitted-form-data</em>/}</h3><p><code>useActionState</code> でアクションをラップすると、追加の引数が <em>1 番目の引数として</em>加わります。したがって、通常は 1 番目の引数であるはずの送信フォームデータは、<em>2 番目の</em>引数になります。追加される新しい第 1 引数は、フォーム state の現在値です。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token parameter">currentState<span class="token punctuation">,</span> formData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>