<!doctype html><html lang="ja"><meta charset="utf-8"><title>useRef</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="useref"><h1 id="useref">useRef</h1><intro><p><code>useRef</code> は、レンダー時には不要な値を参照するための React フックです。<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">)</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="リファレンス-reference"><h2 id="リファレンス-reference">リファレンス {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="userefinitialvalue-useref"><h3 id="userefinitialvalue-useref"><code>useRef(initialValue)</code> {/<em>useref</em>/}</h3><p>コンポーネントのトップレベルで <code>useRef</code> を呼び出して、<a href="/learn/referencing-values-with-refs">ref</a> を宣言します。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> intervalRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p><a href="#usage">さらに例を見る</a><section class="level4"aria-labelledby="引数-parameters"><h4 id="引数-parameters">引数 {/<em>parameters</em>/}</h4><ul><li><code>initialValue</code>: ref オブジェクトの <code>current</code> プロパティの初期値として設定する値です。任意の型の値を指定できます。この引数は 2 回目以降のレンダーでは無視されます。</ul></section><section class="level4"aria-labelledby="返り値-returns"><h4 id="返り値-returns">返り値 {/<em>returns</em>/}</h4><p><code>useRef</code> は、以下の 1 つのプロパティだけを持つオブジェクトを返します。<ul><li><code>current</code>: 渡した <code>initialValue</code> が初期値に設定されます。あとから別の値に変更することができます。ref オブジェクトを JSX ノードの <code>ref</code> 属性として React に渡すと、React は <code>current</code> プロパティの値を設定します。</ul><p>2 回目以降のレンダーでは、<code>useRef</code> は同じオブジェクトを返します。</section><section class="level4"aria-labelledby="注意点-caveats"><h4 id="注意点-caveats">注意点 {/<em>caveats</em>/}</h4><ul><li><code>ref.current</code> プロパティは書き換えが可能です。つまり state と違いミュータブル (mutable) です。ただし、レンダーに利用されるオブジェクト（state の一部など）を保持している場合は、変更すべきではありません。<li><code>ref.current</code> プロパティを変更しても、React はコンポーネントを再レンダーしません。ref はただの JavaScript オブジェクトですので、変更されたとしても、それを React が知ることはできないのです。<li><a href="#avoiding-recreating-the-ref-contents">初期化</a>時を除いて、レンダー中に <code>ref.current</code> の値を<em>読み取ったり</em>書き込んだりしないでください。コンポーネントの振る舞いが予測不能になります。<li>Strict Mode では、<a href="/reference/react/useState#my-initializer-or-updater-function-runs-twice">純粋でない関数を見つけやすくするために</a>、コンポーネント関数が <strong>2 回呼び出されます</strong>。これは開発時のみの振る舞いであり、本番には影響しません。各 ref オブジェクトは 2 回生成されますが、そのうちの 1 つは破棄されます。コンポーネント関数が純粋であれば（そうであるべきです）、この振る舞いはロジックに影響しません。</ul></section></section></section><section class="level2"aria-labelledby="使用法-usage"><h2 id="使用法-usage">使用法 {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="ref-を使用して値を参照する-referencing-a-value-with-a-ref"><h3 id="ref-を使用して値を参照する-referencing-a-value-with-a-ref">ref を使用して値を参照する {/<em>referencing-a-value-with-a-ref</em>/}</h3><p>コンポーネントのトップレベルで <code>useRef</code> を呼び出し、1 つ以上の <a href="/learn/referencing-values-with-refs">ref</a> を宣言します。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Stopwatch</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> intervalRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p><code>useRef</code> は、唯一のプロパティである<codestep step="{2}"><code>current</code></codestep>に、指定された<codestep step="{3}">初期値</codestep>が設定された状態の<codestep step="{1}">ref オブジェクト</codestep>を返します。<p>次回以降のレンダーでも、<code>useRef</code> は同じオブジェクトを返します。このオブジェクトの <code>current</code> プロパティを書き換えることで情報を保存しておき、あとからその値を読み出すことができます。これは <a href="/reference/react/useState">state</a> と似ていますが、大きく違う点があります。<p>それは、<strong>ref を変更しても、再レンダーはトリガされない</strong>ということです。このことから、ref は、出力されるコンポーネントの外見に影響しないデータを保存するのに適しています。例えば、<a href="https://developer.mozilla.org/en-US/docs/Web/API/setInterval">インターバルの ID</a> を保持しておき、あとから利用したい場合、ref に保存することができます。ref 内の値を更新するには、<codestep step="{2}"><code>current</code> プロパティ</codestep>を手動で変更します。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">handleStartClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> intervalId <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  intervalRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> intervalId<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>そして、あとから、ref に保存されているインターバル ID を読み出すことができます。これで<a href="https://developer.mozilla.org/en-US/docs/Web/API/clearInterval">インターバルをクリアする関数</a>を呼び出し、インターバルを削除できます。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">handleStopClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> intervalId <span class="token operator">=</span> intervalRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">;</span>
  <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>ref を使用することで、次のことが保証されます。<ul><li>レンダーを跨いで<strong>情報を保存</strong>できます（通常の変数は、レンダーごとにリセットされます）。<li>変更しても<strong>再レンダーはトリガされません</strong>（state 変数は、変更すると再レンダーがトリガされます）。<li>保存された情報は、コンポーネントのインスタンスごとに<strong>固有</strong>です（コンポーネントの外側で定義された変数は、コンポーネントのインスタンス間で共有されます）。</ul><p>ref を変更しても再レンダーはトリガされないため、ref は画面に表示したい情報を保存するのには適していません。そのような場合は、代わりに useState を使用してください。<code>useRef</code> と <code>useState</code> の使い分けに関しては、<a href="/learn/referencing-values-with-refs#differences-between-refs-and-state">ref と state の違い</a>を参照してください。</p><recipes titletext="useRef を用いて値を参照する使用例"titleid="examples-value"><section class="level4"aria-labelledby="クリックカウンタ-click-counter"><h4 id="クリックカウンタ-click-counter">クリックカウンタ {/<em>click-counter</em>/}</h4><p>このコンポーネントは、ボタンがクリックされた回数を保存するために ref を使用しています。この例では、クリック回数の読み書きはイベントハンドラ内でのみ行われているため、state の代わりに ref を使用して構いません。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Counter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ref<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked '</span> <span class="token operator">+</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">+</span> <span class="token string">' times!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token maybe-class-name">Click</span> me<span class="token operator">!</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>JSX 内で <code>{ref.current}</code> を表示すると、クリックしても回数の表示は更新されません。これは、<code>ref.current</code> に新しい値を設定しても、再レンダーがトリガされないためです。レンダーに利用したい値は、代わりに state に保存してください。</p><solution></solution></section><section class="level4"aria-labelledby="ストップウォッチ-a-stopwatch"><h4 id="ストップウォッチ-a-stopwatch">ストップウォッチ {/<em>a-stopwatch</em>/}</h4><p>この例では、state と ref を組み合わせて使用しています。<code>startTime</code> と <code>now</code> はレンダーに利用されるため、state 変数となっています。また、ボタンを押したときにインターバルを停止するために、<a href="https://developer.mozilla.org/en-US/docs/Web/API/setInterval">インターバル ID</a> を保持しておく必要があります。インターバル ID はレンダー時には利用されないため、ref に保存し、手動で更新するのが適切です。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Stopwatch</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>startTime<span class="token punctuation">,</span> setStartTime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>now<span class="token punctuation">,</span> setNow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> intervalRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setStartTime</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setNow</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    intervalRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setNow</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> secondsPassed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>startTime <span class="token operator">!=</span> <span class="token keyword null nil">null</span> <span class="token operator">&#x26;&#x26;</span> now <span class="token operator">!=</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    secondsPassed <span class="token operator">=</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Time</span> passed<span class="token operator">:</span> <span class="token punctuation">{</span>secondsPassed<span class="token punctuation">.</span><span class="token method function property-access">toFixed</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleStart<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Start</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleStop<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Stop</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section></recipes><pitfall><p><strong>レンダー中に <code>ref.current</code> の値を<em>読み取ったり</em>書き込んだりしないでください</strong>。<p>React は、コンポーネント本体の関数が<a href="/learn/keeping-components-pure">純関数のように振る舞う</a>ことを期待しています。<ul><li>入力値（<a href="/learn/passing-props-to-a-component">props</a>、<a href="/learn/state-a-components-memory">state</a>、<a href="/learn/passing-data-deeply-with-context">context</a>）が同じなら、常に同じ JSX を返さなければなりません。<li>呼び出し順が変わったり、引数を変えて呼び出されたりしても、他の呼び出し結果に影響を与えてはいけません。</ul><p><strong>レンダー中に</strong> ref を読み書きすると、これらに違反してしまいます。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// 🚩 Don't write a ref during rendering</span>
  myRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// 🚩 Don't read a ref during rendering</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token punctuation">{</span>myOtherRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>代わりに、<strong>イベントハンドラやエフェクトから</strong> ref を読み書きしてください。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// ✅ You can read or write refs in effects</span>
    myRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ✅ You can read or write refs in event handlers</span>
    <span class="token function">doSomething</span><span class="token punctuation">(</span>myOtherRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>もし、レンダー中に何かを読み出したり<a href="/reference/react/useState#storing-information-from-previous-renders">書き込んだり</a><em>しなければならない</em>場合は、代わりに <a href="/reference/react/useState">useState</a> を使用してください。<p>これらのルールを破っていても、コンポーネントは正常に動作し続けるかもしれません。しかし、近いうちに React に追加される新機能の多くは、これらのルールが守られることを前提としています。詳しくは<a href="/learn/keeping-components-pure#where-you-_can_-cause-side-effects">コンポーネントを純粋に保つ</a>を参照してください。</p></pitfall></section><section class="level3"aria-labelledby="ref-で-dom-を操作する-manipulating-the-dom-with-a-ref"><h3 id="ref-で-dom-を操作する-manipulating-the-dom-with-a-ref">ref で DOM を操作する {/<em>manipulating-the-dom-with-a-ref</em>/}</h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTML_DOM_API">DOM</a> を操作したい場合、ref を利用することが非常に多いです。React は、DOM へのアクセスを組み込みでサポートしています。<p>最初に、<codestep step="{3}">初期値</codestep>を <code>null</code> に設定した<codestep step="{1}">ref オブジェクト</codestep>を宣言します。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p>次に、操作したい DOM ノードの JSX の <code>ref</code> 属性に、ref オブジェクトを渡します。<pre class="language-js"><code class="language-js">  <span class="token comment">// ...</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span></code></pre><p>この DOM ノードが生成され、画面に配置されると、ref オブジェクトの<codestep step="{2}"><code>current</code> プロパティ</codestep>にその DOM ノードが設定されます。これで、<code>&#x3C;input></code> の DOM ノードにアクセスして、<a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/focus"><code>focus()</code></a> のようなメソッドを呼び出すことができるようになります。<pre class="language-js"><code class="language-js">  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    inputRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre><p>React は、ノードが画面から削除されると <code>current</code> プロパティを <code>null</code> に戻します。<p>詳しくは、<a href="/learn/manipulating-the-dom-with-refs">ref を使用して DOM を操作する</a>を参照してください。</p><recipes titletext="useRef を使用して DOM を操作する例"titleid="examples-dom"><section class="level4"aria-labelledby="input-要素をフォーカス-focusing-a-text-input"><h4 id="input-要素をフォーカス-focusing-a-text-input">input 要素をフォーカス {/<em>focusing-a-text-input</em>/}</h4><p>この例では、ボタンをクリックすると input にフォーカスが当たります。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    inputRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Focus</span> the input
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section><section class="level4"aria-labelledby="スクロールして画像を表示-scrolling-an-image-into-view"><h4 id="スクロールして画像を表示-scrolling-an-image-into-view">スクロールして画像を表示 {/<em>scrolling-an-image-into-view</em>/}</h4><p>この例では、ボタンがクリックされると、その画像が画面に表示されるようにスクロールします。ref を使用してリストの DOM ノードを取得し、DOM の <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelectorAll"><code>querySelectorAll</code></a> API を呼び出して、スクロール先の画像を探しています。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">CatFriends</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> listRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">scrollToIndex</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> listNode <span class="token operator">=</span> listRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">;</span>
    <span class="token comment">// This line assumes a particular DOM structure:</span>
    <span class="token keyword">const</span> imgNode <span class="token operator">=</span> listNode<span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'li > img'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    imgNode<span class="token punctuation">.</span><span class="token method function property-access">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">behavior</span><span class="token operator">:</span> <span class="token string">'smooth'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">block</span><span class="token operator">:</span> <span class="token string">'nearest'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">inline</span><span class="token operator">:</span> <span class="token string">'center'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>nav<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">scrollToIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Neo</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">scrollToIndex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Millie</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">scrollToIndex</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Bella</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>nav<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>ul ref<span class="token operator">=</span><span class="token punctuation">{</span>listRef<span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span>li<span class="token operator">></span>
            <span class="token operator">&#x3C;</span>img
              src<span class="token operator">=</span><span class="token string">"https://placecats.com/neo/300/200"</span>
              alt<span class="token operator">=</span><span class="token string">"Neo"</span>
            <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>li<span class="token operator">></span>
            <span class="token operator">&#x3C;</span>img
              src<span class="token operator">=</span><span class="token string">"https://placecats.com/millie/200/200"</span>
              alt<span class="token operator">=</span><span class="token string">"Millie"</span>
            <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>li<span class="token operator">></span>
            <span class="token operator">&#x3C;</span>img
              src<span class="token operator">=</span><span class="token string">"https://placecats.com/bella/199/200"</span>
              alt<span class="token operator">=</span><span class="token string">"Bella"</span>
            <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">nav</span> <span class="token punctuation">{</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">button</span> <span class="token punctuation">{</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">.25</span><span class="token unit">rem</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">ul<span class="token punctuation">,</span>
li</span> <span class="token punctuation">{</span>
  <span class="token property">list-style</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token property">white-space</span><span class="token punctuation">:</span> nowrap<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">li</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> inline<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token unit">rem</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section><section class="level4"aria-labelledby="動画の再生停止-playing-and-pausing-a-video"><h4 id="動画の再生停止-playing-and-pausing-a-video">動画の再生・停止 {/<em>playing-and-pausing-a-video</em>/}</h4><p>この例では、ref を使用して <code>&#x3C;video></code> の DOM ノードの <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/play"><code>play()</code></a> と <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/pause"><code>pause()</code></a> を呼び出します。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">VideoPlayer</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isPlaying<span class="token punctuation">,</span> setIsPlaying<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> nextIsPlaying <span class="token operator">=</span> <span class="token operator">!</span>isPlaying<span class="token punctuation">;</span>
    <span class="token function">setIsPlaying</span><span class="token punctuation">(</span>nextIsPlaying<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>nextIsPlaying<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token punctuation">{</span>isPlaying <span class="token operator">?</span> <span class="token string">'Pause'</span> <span class="token operator">:</span> <span class="token string">'Play'</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>video
        width<span class="token operator">=</span><span class="token string">"250"</span>
        ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span>
        onPlay<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsPlaying</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        onPause<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsPlaying</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token operator">&#x3C;</span>source
          src<span class="token operator">=</span><span class="token string">"https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"</span>
          type<span class="token operator">=</span><span class="token string">"video/mp4"</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>video<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section><section class="level4"aria-labelledby="独自コンポーネントの-ref-を公開-exposing-a-ref-to-your-own-component"><h4 id="独自コンポーネントの-ref-を公開-exposing-a-ref-to-your-own-component">独自コンポーネントの ref を公開 {/<em>exposing-a-ref-to-your-own-component</em>/}</h4><p>親コンポーネントから、独自コンポーネント内の DOM を操作したい場合があります。たとえば、<code>MyInput</code> コンポーネントを作成しているとして、親コンポーネントが input にフォーカスを当てたい場合などです（親コンポーネントは、input にはアクセスできません）。この場合は、<code>useRef</code> と <a href="/reference/react/forwardRef"><code>forwardRef</code></a> を組み合わせて利用します。<code>useRef</code> で input を保持し、<code>forwardRef</code> で input への参照を親コンポーネントに公開します。詳しくは、<a href="/learn/manipulating-the-dom-with-refs#accessing-another-components-dom-nodes">別のコンポーネントの DOM ノードにアクセスする</a>を参照してください。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> forwardRef<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">MyInput</span> <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>input <span class="token punctuation">{</span><span class="token spread operator">...</span>props<span class="token punctuation">}</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    inputRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MyInput</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Focus</span> the input
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section></recipes></section><section class="level3"aria-labelledby="ref-の値の再生成を防ぐ-avoiding-recreating-the-ref-contents"><h3 id="ref-の値の再生成を防ぐ-avoiding-recreating-the-ref-contents">ref の値の再生成を防ぐ {/<em>avoiding-recreating-the-ref-contents</em>/}</h3><p>React は、初回に渡された ref の値を保存しますが、それ以降のレンダーではその値は無視します。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Video</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> playerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VideoPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p><code>new VideoPlayer()</code> の結果は初回レンダーでのみ利用されますが、すべてのレンダーで呼び出し自体は発生しています。これは、計算コストの高いオブジェクトを作成している場合に、無駄が多くなります。<p>これを解決するために、次のように ref を初期化することができます。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Video</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> playerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>playerRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">===</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    playerRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VideoPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span></code></pre><p>通常、レンダー中に <code>ref.current</code> の値を読み取ったり書き込んだりすることは許されていません。しかし、今回の場合は問題ありません。なぜなら、呼び出し結果は常に同じであり、条件分岐により書き込みは初期化時にのみ実行されるため、コンポーネントの振る舞いが完全に予測可能となるからです。</p><deepdive><section class="level4"aria-labelledby="useref-を遅延して初期化する場合に-null-チェックを回避する-how-to-avoid-null-checks-when-initializing-use-ref-later"><h4 id="useref-を遅延して初期化する場合に-null-チェックを回避する-how-to-avoid-null-checks-when-initializing-use-ref-later">useRef を遅延して初期化する場合に null チェックを回避する {/<em>how-to-avoid-null-checks-when-initializing-use-ref-later</em>/}</h4><p>型チェッカを使用しており <code>null</code> チェックを何度も行うのが煩わしい場合は、次のようなパターンを試してみてください。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Video</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> playerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">getPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>playerRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">!==</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> playerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> player <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VideoPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    playerRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> player<span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> player<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span></code></pre><p>この例では、<code>playerRef</code> 自体は null 許容です。しかし型チェッカに、<code>getPlayer()</code> は <code>null</code> を返す場合がないと判断させられるはずです。そこでイベントハンドラなどで <code>getPlayer()</code> を使用できます。</section></deepdive></section></section><section class="level2"aria-labelledby="トラブルシューティング-troubleshooting"><h2 id="トラブルシューティング-troubleshooting">トラブルシューティング {/<em>troubleshooting</em>/}</h2><section class="level3"aria-labelledby="独自コンポーネントへの-ref-を取得できない-i-cant-get-a-ref-to-a-custom-component"><h3 id="独自コンポーネントへの-ref-を取得できない-i-cant-get-a-ref-to-a-custom-component">独自コンポーネントへの ref を取得できない {/<em>i-cant-get-a-ref-to-a-custom-component</em>/}</h3><p>以下のようにして、独自コンポーネントに <code>ref</code> を渡そうとしている場合、<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MyInput</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span></code></pre><p>コンソールにこのようなエラーが表示されるかもしれません。</p><consoleblock level="error"><p>Warning: Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?</p></consoleblock><p>デフォルトでは、独自コンポーネントは、内部の DOM ノードへの ref を公開していません。<p>これを修正するには、まず、ref を取得したいコンポーネントを探します。<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyInput</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> value<span class="token punctuation">,</span> onChange <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>input
      value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span>
      onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>そして、次のように <a href="/reference/react/forwardRef"><code>forwardRef</code></a> でラップします。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> forwardRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">MyInput</span> <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> value<span class="token punctuation">,</span> onChange <span class="token punctuation">}</span><span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>input
      value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span>
      onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span>
      ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token maybe-class-name">MyInput</span><span class="token punctuation">;</span></code></pre><p>これで、親コンポーネントから ref を取得できるようになります。<p>詳しくは、<a href="/learn/manipulating-the-dom-with-refs#accessing-another-components-dom-nodes">別のコンポーネントの DOM ノードにアクセスする</a>を参照してください。 <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>