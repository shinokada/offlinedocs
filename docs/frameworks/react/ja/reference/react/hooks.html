<!doctype html><html lang="ja"><meta charset="utf-8"><title>"組み込みの React フック"</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="組み込みの-react-フック"><h1 id="組み込みの-react-フック">"組み込みの React フック"</h1><intro><p><em>フック</em>を用いると、コンポーネントから様々な React の機能を使えるようになります。組み込みのフックを使うこともできますし、組み合わせて自分だけのものを作ることもできます。このページでは、React に組み込まれたすべてのフックを説明します。</p></intro><section class="level2"aria-labelledby="state-フック-state-hooks"><h2 id="state-フック-state-hooks">state フック {/<em>state-hooks</em>/}</h2><p><em>state</em> を使うと、ユーザの入力などの情報を<a href="/learn/state-a-components-memory">コンポーネントに「記憶」</a>させることができます。例えば、フォームコンポーネントは入力された文字を保持し、画像ギャラリのコンポーネントは選択された画像を保持できます。<p>コンポーネントに state を追加するには、次のフックのいずれかを使います：<ul><li><a href="/reference/react/useState"><code>useState</code></a> は直接的に更新できる state 変数を定義します。<li><a href="/reference/react/useReducer"><code>useReducer</code></a> は、<a href="/learn/extracting-state-logic-into-a-reducer">リデューサ関数</a>内に書いたロジックを用いて更新を行う state 変数を定義します。</ul><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ImageGallery</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>index<span class="token punctuation">,</span> setIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre></section><section class="level2"aria-labelledby="コンテクストフック-context-hooks"><h2 id="コンテクストフック-context-hooks">コンテクストフック {/<em>context-hooks</em>/}</h2><p><em>コンテクスト</em>を用いると、コンポーネントは props を渡すことなく、<a href="/learn/passing-props-to-a-component">離れた親要素から情報を取得できるようになります</a>。例えば、アプリの最上位のコンポーネントが、現在の UI テーマをコンポーネントの階層に関係なくすべてのコンポーネントに渡すことができます。<ul><li><a href="/reference/react/useContext"><code>useContext</code></a> は、コンテクストの値を読み取り、変更を受け取れるようにします。</ul><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Button</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre></section><section class="level2"aria-labelledby="ref-フック-ref-hooks"><h2 id="ref-フック-ref-hooks">ref フック {/<em>ref-hooks</em>/}</h2><p><em>ref</em> を用いると、コンポーネントは DOM ノードやタイムアウト ID などの、<a href="/learn/referencing-values-with-refs">レンダーに用いない情報を保持</a>することができます。state と違い、ref の値を更新してもコンポーネントは再レンダーされません。ref は、React パラダイムからの「避難ハッチ」です。これらは組み込みのブラウザ API などの、React 外のシステムを取り扱うときに役立ちます。<ul><li><a href="/reference/react/useRef"><code>useRef</code></a> は ref を宣言します。useRef にはどんな値でも格納できますが、多くの場合、DOM ノードを格納するために使われます。<li><a href="/reference/react/useImperativeHandle"><code>useImperativeHandle</code></a> を用いると、コンポーネントが公開する ref をカスタマイズできます。これはほとんど用いられることはありません。</ul><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre></section><section class="level2"aria-labelledby="エフェクトフック-effect-hooks"><h2 id="エフェクトフック-effect-hooks">エフェクトフック {/<em>effect-hooks</em>/}</h2><p><em>エフェクト</em>を使うことで、<a href="/learn/synchronizing-with-effects">コンポーネントを外部システムに接続し、同期させる</a>ことができます。これには、ネットワーク、ブラウザの DOM、アニメーション、別の UI ライブラリを使って書かれたウィジェット、その他の非 React コードの処理が含まれます。<ul><li><a href="/reference/react/useEffect"><code>useEffect</code></a> は外部のシステムとコンポーネントを接続します。</ul><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p>エフェクトは、React パラダイムからの「脱出ハッチ」です。エフェクトをアプリケーションのデータフローを調整するために使ってはいけません。外部のシステムとやりとりを行わないならば、<a href="/learn/you-might-not-need-an-effect">エフェクトは必要ないかもしれません</a>。<p><code>useEffect</code> には、実行タイミングが異なり、まれに使われることのある 2 つのバリエーションがあります：<ul><li><a href="/reference/react/useLayoutEffect"><code>useLayoutEffect</code></a> はブラウザが画面を再描画する前に発火します。このフックでレイアウトを測定できます。<li><a href="/reference/react/useInsertionEffect"><code>useInsertionEffect</code></a> は React が DOM に変更を加える前に発火します。ライブラリは動的な CSS をこのフックで挿入できます。</ul></section><section class="level2"aria-labelledby="パフォーマンス関連フック-performance-hooks"><h2 id="パフォーマンス関連フック-performance-hooks">パフォーマンス関連フック {/<em>performance-hooks</em>/}</h2><p>再レンダーのパフォーマンスを最適化するためのよくある方法は、不要な処理を減らすことです。例えばキャッシュ済みの計算結果を再利用したり、データの変更がない場合の再レンダーをスキップしたりするよう、React に伝えることができます。<p>不要な計算やレンダーをスキップするためには、以下のフックを用いることができます：<ul><li><a href="/reference/react/useMemo"><code>useMemo</code></a> を用いると高負荷な計算の結果をキャッシュできます。<li><a href="/reference/react/useCallback"><code>useCallback</code></a> を用いると、最適化済みのコンポーネントに渡すために関数定義をキャッシュしておくことができます。</ul><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> todos<span class="token punctuation">,</span> tab<span class="token punctuation">,</span> theme <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> visibleTodos <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">filterTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> tab<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> tab<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>画面の更新が実際にあるため、再レンダーをスキップできない場合もあるでしょう。その場合、同期的に行う必要があるユーザインターフェイスをブロックする更新（ユーザの文字入力など）を、ユーザインターフェイスをブロックする必要のないノンブロッキングな更新（図の更新など）から分離することで、パフォーマンスを向上することができます。<p>レンダーの優先度付けを行うために、以下のフックを用いることができます：<ul><li><a href="/reference/react/useTransition"><code>useTransition</code></a> を用いることで、state の遷移をノンブロッキングなものとしてマークし、他の更新による割り込みを許可します。<li><a href="/reference/react/useDeferredValue"><code>useDeferredValue</code></a> を用いると、UI の重要でない部分の更新を遅延させて、他の部分を先に更新させることができます。</ul></section><section class="level2"aria-labelledby="リソース関連フック-resource-hooks"><h2 id="リソース関連フック-resource-hooks">リソース関連フック {/<em>resource-hooks</em>/}</h2><p><em>リソース (resource)</em> は state に入れずにコンポーネントからアクセスできます。例えばコンポーネントは Promise からメッセージを読み取ったり、コンテクストからスタイルに関する情報を読み取ったりできます。<p>リソースから値を読み取るには、以下のフックを用いることができます：<ul><li><a href="/reference/react/use"><code>use</code></a> を用いることで <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> や<a href="/learn/passing-data-deeply-with-context">コンテクスト</a>などのリソースから値を読み取ります。</ul><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MessageComponent</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> messagePromise <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span>messagePromise<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></section><section class="level2"aria-labelledby="その他のフック-other-hooks"><h2 id="その他のフック-other-hooks">その他のフック {/<em>other-hooks</em>/}</h2><p>これらのフックはライブラリの開発者には有用ですが、アプリケーションコードでは通常は用いられることはありません。<ul><li><a href="/reference/react/useDebugValue"><code>useDebugValue</code></a> を用いると、React DevTools が表示するカスタムフックのラベルをカスタマイズできます。<li><a href="/reference/react/useId"><code>useId</code></a> を用いると、コンポーネントにユニークな ID を関連付けることができます。通常はアクセシビリティ API とともに使用されます。<li><a href="/reference/react/useSyncExternalStore"><code>useSyncExternalStore</code></a> を用いると、コンポーネントは外部のストアを参照できるようになります。</ul></section><section class="level2"aria-labelledby="独自のフック-your-own-hooks"><h2 id="独自のフック-your-own-hooks">独自のフック {/<em>your-own-hooks</em>/}</h2><p>JavaScript の関数として<a href="/learn/reusing-logic-with-custom-hooks#extracting-your-own-custom-hook-from-a-component">独自のカスタムフックを定義</a>することもできます。<span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section>