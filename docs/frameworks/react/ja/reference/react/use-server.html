<!doctype html><html lang="ja"><meta charset="utf-8"><title>"'use server'"</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="use-server"><h1 id="use-server">"'use server'"</h1><p>canary: true</p><canary><p><code>'use server'</code> は、<a href="/learn/start-a-new-react-project#bleeding-edge-react-frameworks">React Server Components を使用している</a>場合や、それらと互換性のあるライブラリを構築している場合にのみ必要です。</p></canary><intro><p><code>'use server'</code> は、クライアントサイドのコードから呼び出し可能なサーバサイドの関数をマークします。</p></intro><inlinetoc><section class="level2"aria-labelledby="リファレンス-reference"><h2 id="リファレンス-reference">リファレンス {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="use-server-use-server"><h3 id="use-server-use-server"><code>'use server'</code> {/<em>use-server</em>/}</h3><p>非同期 (async) 関数の冒頭に <code>'use server';</code> を追加することで、その関数がクライアントから実行できることをマークします。<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">'use server'</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x3C;ProductDetailPage addToCart={addToCart} /></span></code></pre><p>このような関数は、クライアントに渡すことができます。この関数がクライアント側で呼び出されると、渡された引数がシリアライズされ、それを含んだネットワークリクエストをサーバに送信します。このサーバ関数が値を返す場合、シリアライズされてクライアントに返されます。<p>または、ファイルの最上部に <code>'use server';</code> を追加すると、そのファイル内のすべてのエクスポートが、クライアントコンポーネントファイルを含むあらゆる場所で使用できる非同期サーバ関数である、とマークします。<section class="level4"aria-labelledby="注意点-caveats"><h4 id="注意点-caveats">注意点 {/<em>caveats</em>/}</h4><ul><li><code>'use server'</code> でマークされた関数に渡される引数はクライアントで完全に制御可能です。セキュリティのため、引数を常に信頼できない入力として扱い、適切にバリデーションやエスケープを行うことを忘れないでください。<li>クライアント側とサーバ側のコードを同じファイルに混在させることによる混乱を避けるため、<code>'use server'</code> はサーバ側のファイルでのみ使用できます。結果として得られる関数は、props を通じてクライアントコンポーネントに渡すことができます。<li>内部で用いられるネットワーク呼び出しは常に非同期であるため、<code>'use server'</code> は非同期関数でのみ使用できます。<li><code>'use server'</code> のようなディレクティブは、関数やファイルの冒頭部分で、他のコード（インポートを含む）より上になければなりません（ただしコメントはディレクティブの上に記載できます）。シングルクォートまたはダブルクォートで書く必要があり、バックティックは使えません。（<code>'use xyz'</code> というディレクティブの形式は <code>useXyz()</code> というフックの命名規則に多少似ていますが、これは偶然です。）</ul></section></section></section><section class="level2"aria-labelledby="使用法-usage"><h2 id="使用法-usage">使用法 {/<em>usage</em>/}</h2><wip><p>このセクションは未完成です。<a href="https://beta.nextjs.org/docs/rendering/server-and-client-components">Next.js の Server Components についてのドキュメント</a>も参照してください。<p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></p></wip></section></inlinetoc></section>