<!doctype html><html lang="ja"><meta charset="utf-8"><title>"'use client'"</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="use-client"><h1 id="use-client">"'use client'"</h1><p>titleForTitleTag: "'use client' ディレクティブ" canary: true</p><canary><p><code>'use client'</code> は、<a href="/learn/start-a-new-react-project#bleeding-edge-react-frameworks">React Server Components を使用している</a>場合や、それらと互換性のあるライブラリを構築している場合にのみ必要です。</p><intro><p><code>'use client'</code> を使い、どのコードがクライアントで実行されるかをマークします。</p></intro><inlinetoc><section class="level2"aria-labelledby="リファレンス-reference"><h2 id="リファレンス-reference">リファレンス {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="use-client-use-client"><h3 id="use-client-use-client"><code>'use client'</code> {/<em>use-client</em>/}</h3><p>ファイルのトップに <code>'use client'</code> を加えることで、当該モジュールとそれが連動してインポートしている依存モジュールがクライアントコードであるとマークします。<pre class="language-js"><code class="language-js"><span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> formatDate <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./formatters'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Button</span></span> <span class="token keyword module">from</span> <span class="token string">'./button'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">RichTextEditor</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> timestamp<span class="token punctuation">,</span> text <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token function">formatDate</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> editButton <span class="token operator">=</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Button</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><code>'use client'</code> でマークされているファイルがサーバコンポーネントからインポートされた場合、<a href="/learn/start-a-new-react-project#bleeding-edge-react-frameworks">互換性のあるバンドラ</a>は当該モジュールのインポートを、サーバで実行されるコードとクライアントで実行されるコードの境界として扱います。<p>上記では <code>formatDate</code> と <code>Button</code> は <code>RichTextEditor</code> が依存するモジュールですので、これらのモジュール自体に <code>'use client'</code> ディレクティブが含まれているかどうかに関わらず、これらもクライアントで評価されます。ある単一のモジュールが、サーバコードからインポートされた場合はサーバで、クライアントコードからインポートされた場合はクライアントで評価される場合があることに注意してください。<section class="level4"aria-labelledby="注意点-caveats"><h4 id="注意点-caveats">注意点 {/<em>caveats</em>/}</h4><ul><li><code>'use client'</code> はファイルの冒頭、すなわちインポートや他のコードより先になければなりません（コメントは OK です）。シングルクォートまたはダブルクォートで書かれていなければならず、バックティックは無効です。<li><code>'use client'</code> モジュールが別のクライアントレンダーされるモジュールからインポートされた場合、ディレクティブの効果はありません。<li>コンポーネントモジュールに <code>'use client'</code> ディレクティブが含まれている場合、そのコンポーネントは必ずクライアントコンポーネントであることが保証されます。しかしコンポーネントに直接 <code>'use client'</code> ディレクティブがなくとも、クライアントで評価されることがあります。<ul><li>コンポーネントがクライアントコンポーネントと見なされるのは、それが <code>'use client'</code> ディレクティブを含むモジュールで定義されている場合、またはそれが <code>'use client'</code> ディレクティブを含むモジュールの間接的な依存モジュールである場合です。それ以外の場合、サーバコンポーネントとなります。</ul><li>クライアントで評価されるようマークされるコードとはコンポーネントに限りません。クライアントモジュールのサブツリーに含まれるすべてのコードは、クライアントに送信され、クライアントで実行されます。<li>サーバで評価されるモジュールが <code>'use client'</code> のモジュールから値をインポートする場合、その値は React コンポーネントであるか、またはクライアントコンポーネントに渡せるよう<a href="#passing-props-from-server-to-client-components">サポート済のシリアライズ可能な props の型</a>のいずれかでなければなりません。それ以外の方法で使用すると例外がスローされます。</ul></section></section><section class="level3"aria-labelledby="use-client-がクライアントコードをマークする方法-how-use-client-marks-client-code"><h3 id="use-client-がクライアントコードをマークする方法-how-use-client-marks-client-code"><code>'use client'</code> がクライアントコードをマークする方法 {/<em>how-use-client-marks-client-code</em>/}</h3><p>React アプリでは、コンポーネントはしばしば別々のファイル、すなわち<a href="/learn/importing-and-exporting-components#exporting-and-importing-a-component">モジュール</a>に分割されます。<p>React Server Components を使用するアプリでは、デフォルトでアプリはサーバでレンダーされます。<code>'use client'</code> は<a href="/learn/understanding-your-ui-as-a-tree#the-module-dependency-tree">モジュール依存関係ツリー</a>にサーバ・クライアント境界を導入、つまり実質的にはクライアントモジュールのサブツリーの作成を行います。<p>これをより具体的に示すために、以下の React Server Components アプリを考えてみましょう。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">FancyText</span></span> <span class="token keyword module">from</span> <span class="token string">'./FancyText'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">InspirationGenerator</span></span> <span class="token keyword module">from</span> <span class="token string">'./InspirationGenerator'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Copyright</span></span> <span class="token keyword module">from</span> <span class="token string">'./Copyright'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">FancyText</span> title text<span class="token operator">=</span><span class="token string">"Get Inspired App"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">InspirationGenerator</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Copyright</span> year<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">2004</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">InspirationGenerator</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FancyText</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>title<span class="token punctuation">,</span> text<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> title
    <span class="token operator">?</span> <span class="token operator">&#x3C;</span>h1 className<span class="token operator">=</span><span class="token string">'fancy title'</span><span class="token operator">></span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">:</span> <span class="token operator">&#x3C;</span>h3 className<span class="token operator">=</span><span class="token string">'fancy cursive'</span><span class="token operator">></span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h3<span class="token operator">></span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">inspirations</span> <span class="token keyword module">from</span> <span class="token string">'./inspirations'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">FancyText</span></span> <span class="token keyword module">from</span> <span class="token string">'./FancyText'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">InspirationGenerator</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>children<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>index<span class="token punctuation">,</span> setIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> quote <span class="token operator">=</span> inspirations<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">next</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> inspirations<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Your</span> inspirational quote is<span class="token operator">:</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">FancyText</span> text<span class="token operator">=</span><span class="token punctuation">{</span>quote<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>next<span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Inspire</span> me again<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Copyright</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>year<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>p className<span class="token operator">=</span><span class="token string">'small'</span><span class="token operator">></span>©️ <span class="token punctuation">{</span>year<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">[</span>
  <span class="token string">"Don’t let yesterday take up too much of today.” — Will Rogers"</span><span class="token punctuation">,</span>
  <span class="token string">"Ambition is putting a ladder against the sky."</span><span class="token punctuation">,</span>
  <span class="token string">"A joy that's shared is a joy made double."</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token class">.fancy</span></span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'Georgia'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.title</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#007AA3</span><span class="token punctuation">;</span>
  <span class="token property">text-decoration</span><span class="token punctuation">:</span> underline<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.cursive</span></span> <span class="token punctuation">{</span>
  <span class="token property">font-style</span><span class="token punctuation">:</span> italic<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.small</span></span> <span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>このサンプルアプリのモジュール依存関係ツリーでは、<code>InspirationGenerator.js</code> に書かれた <code>'use client'</code> ディレクティブが、当該モジュールとそのすべての間接的な依存モジュールをクライアントモジュールとしてマークします。これで <code>InspirationGenerator.js</code> から始まるサブツリー全体がクライアントモジュールとなるのです。</p><diagram name="use_client_module_dependency"height="{250}"width="{545}"alt="トップノードがモジュール &#x27;App.js&#x27; を表す木構造のグラフ。&#x27;App.js&#x27;には &#x27;Copyright.js&#x27;、&#x27;FancyText.js&#x27;、&#x27;InspirationGenerator.js&#x27; の 3 つの子ノードがある。&#x27;InspirationGenerator.js&#x27;には &#x27;FancyText.js&#x27;と&#x27;inspirations.js&#x27; の 2 つの子ノードがある。&#x27;InspirationGenerator.js&#x27;を含む下のノードには黄色い背景色が付けられており、&#x27;InspirationGenerator.js&#x27;の &#x27;use client&#x27; ディレクティブによってこのサブグラフがクライアント側でレンダーされることを示している。">`'use client'` は React Server Components アプリのモジュール依存関係ツリーを分割し、`InspirationGenerator.js` とそのすべての依存モジュールをクライアントレンダーされるものとしてマークする</diagram><p>レンダー中、フレームワークはルートコンポーネントから始め、<a href="/learn/understanding-your-ui-as-a-tree#the-render-tree">レンダーツリー</a>を順にレンダーしていきますが、その際にクライアントとマークされたものからインポートされたコードの評価を選択的に除外します。<p>その後レンダーツリーのうちサーバでレンダーされた部分が、クライアントに送信されます。クライアントは、ダウンロードしたクライアントコードを用いて、ツリーの残りの部分のレンダーを完了します。</p><diagram name="use_client_render_tree"height="{250}"width="{500}"alt="各ノードがコンポーネントを表し、その子要素を子コンポーネントとして表すツリーグラフ。トップレベルのノードは &#x27;App&#x27; とラベル付けされ、2つの子コンポーネント &#x27;InspirationGenerator&#x27; と &#x27;FancyText&#x27; を持っています。&#x27;InspirationGenerator&#x27; は2つの子コンポーネント、&#x27;FancyText&#x27; と &#x27;Copyright&#x27; を持っています。&#x27;InspirationGenerator&#x27; とその子コンポーネント &#x27;FancyText&#x27; はクライアントレンダリングされるとマークされています。">React Server Components アプリのレンダーツリー。`InspirationGenerator` とその子コンポーネント `FancyText` は、クライアントとマークされたコードからエクスポートされたコンポーネントであるため、クライアントコンポーネントと見なされる</diagram><p>ここで以下の定義を導入しましょう。<ul><li><strong>クライアントコンポーネント</strong>とは、レンダーツリーの中の、クライアントでレンダーされるコンポーネントです。<li><strong>サーバコンポーネント</strong>とは、レンダーツリーの中の、サーバでレンダーされるコンポーネントです。</ul><p>上記のサンプルアプリでは、<code>App</code>、<code>FancyText</code>、<code>Copyright</code> はすべてサーバでレンダーされるのでサーバコンポーネントと見なされます。<code>InspirationGenerator.js</code> とその間接的な依存モジュールはクライアントコードとしてマークされているため、コンポーネント <code>InspirationGenerator</code> とその子コンポーネントである <code>FancyText</code> はクライアントコンポーネントとなります。</p><deepdive>#### `FancyText` がサーバコンポーネントでありクライアントコンポーネントでもある理由 {/*how-is-fancytext-both-a-server-and-a-client-component*/}<p>上記の定義によれば、コンポーネント <code>FancyText</code> は、サーバコンポーネントでもありクライアントコンポーネントでもあることになります。どういうことでしょうか？<p>まずは "コンポーネント" という用語があまり厳密ではないことを明示的に意識しましょう。"コンポーネント" とは以下の 2 つの意味で使用されます。<ol><li>「コンポーネント」は<strong>コンポーネントの定義</strong>を指すことがあります。ほとんどの場合、これは関数です。</ol><pre class="language-js"><code class="language-js"><span class="token comment">// This is a definition of a component</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">My</span> <span class="token maybe-class-name">Component</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
<span class="token punctuation">}</span></code></pre><ol start="2"><li>「コンポーネント」はまた、その定義に従って<strong>使用されている個々のコンポーネント</strong>を指すこともあります。</ol><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">MyComponent</span></span> <span class="token keyword module">from</span> <span class="token string">'./MyComponent'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// This is a usage of a component</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MyComponent</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>ここが厳密でなくとも大抵の場合は概念を説明する際に問題とはなりませんが、この場合はそうではありません。<p>サーバコンポーネントやクライアントコンポーネントについて話すとき、コンポーネントの個々の使用法を指しています。<ul><li>コンポーネントが <code>'use client'</code> ディレクティブを含んだモジュールで定義されている場合や、コンポーネントが他のクライアントコンポーネントからインポートされコールされる場合、そのコンポーネントの使用法はクライアントコンポーネントであるということになります。<li>それ以外の場合、そのコンポーネントの使用法はサーバコンポーネントだということになります。</ul><p><diagram name="use_client_render_tree"height="{150}"width="{450}"alt="各ノードがコンポーネントを表し、その子供を子コンポーネントとして表すツリーグラフ。トップレベルのノードは &#x27;App&#x27; とラベル付けされており、&#x27;InspirationGenerator&#x27; と &#x27;FancyText&#x27; の 2 つの子コンポーネントを持っている。&#x27;InspirationGenerator&#x27; は &#x27;FancyText&#x27; と &#x27;Copyright&#x27; の 2 つの子コンポーネントを持っている。&#x27;InspirationGenerator&#x27; とその子コンポーネント &#x27;FancyText&#x27; はクライアントでレンダリングされるとマークされている。">コンポーネントの「使用法」を表すのがレンダーツリー</diagram><p><code>FancyText</code> の問題に戻りましょう。分かるのは、コンポーネントの定義として <code>'use client'</code> ディレクティブがないこと、そして使用法として 2 種類あることです。<p><code>FancyText</code> が <code>App</code> の子として使用されている場合、その使用法はサーバコンポーネントです。<code>FancyText</code> が <code>InspirationGenerator</code> の下でインポートされて呼び出されている場合、<code>InspirationGenerator</code> に <code>'use client'</code> ディレクティブが含まれているため、その <code>FancyText</code> の使用法はクライアントコンポーネントとなります。<p>つまり、<code>FancyText</code> のコンポーネント定義がサーバ上で評価される一方で、クライアントコンポーネントとして使用されるためクライアントにダウンロードもされる、ということになります。</p></deepdive><deepdive><section class="level4"aria-labelledby="copyright-がサーバコンポーネントである理由-why-is-copyright-a-server-component"><h4 id="copyright-がサーバコンポーネントである理由-why-is-copyright-a-server-component"><code>Copyright</code> がサーバコンポーネントである理由 {/<em>why-is-copyright-a-server-component</em>/}</h4><p><code>Copyright</code> はクライアントコンポーネントである <code>InspirationGenerator</code> の子としてレンダーされているので、それがサーバコンポーネントになっていることに驚くかもしれません。<p><code>'use client'</code> がサーバとクライアントのコードの境界を、レンダーツリーではなく<em>モジュール依存関係ツリー</em>上で定義することを思い出してください。</p><diagram name="use_client_module_dependency"height="{200}"width="{500}"alt="トップノードがモジュール &#x27;App.js&#x27; を表すツリーグラフ。&#x27;App.js&#x27; には &#x27;Copyright.js&#x27;、&#x27;FancyText.js&#x27;、&#x27;InspirationGenerator.js&#x27; の 3 つの子ノードがある。&#x27;InspirationGenerator.js&#x27; には &#x27;FancyText.js&#x27; と &#x27;inspirations.js&#x27; の 2 つの子ノードがある。&#x27;InspirationGenerator.js&#x27; 自体とそれ以下のノードは背景が黄色になっており、&#x27;InspirationGenerator.js&#x27; に &#x27;use client&#x27; ディレクティブがあるためこのサブグラフがクライアントでレンダーされることを示している。">`'use client'` はモジュール依存ツリー上でサーバとクライアントのコードの境界を定義する</diagram><p>モジュール依存関係ツリー上では、<code>App.js</code> が <code>Copyright.js</code> モジュールから <code>Copyright</code> をインポートして呼び出していることがわかります。<code>Copyright.js</code> には <code>'use client'</code> ディレクティブが含まれていないため、このコンポーネントはサーバレンダーで使用されています。<code>App</code> はルートコンポーネントでありサーバ上でレンダーされるからです。<p>クライアントコンポーネントがサーバコンポーネントをレンダーできるのは、JSX を props として渡すことができるためです。上記の例の場合、<code>InspirationGenerator</code> は <a href="/learn/passing-props-to-a-component#passing-jsx-as-children">children</a> として <code>Copyright</code> を受け取ります。しかし、<code>InspirationGenerator</code> モジュールは <code>Copyright</code> モジュールを直接インポートしたり、コンポーネントを呼び出したりしているわけではありません。それらはすべて <code>App</code> によって行われます。実際、<code>Copyright</code> コンポーネントは <code>InspirationGenerator</code> のレンダーすら始まらないうちに完全に実行されます。<p>つまり、コンポーネント間に親子関係があるからといって、同じ環境でレンダーされることが保証されるわけではない、ということを覚えておきましょう。</section></deepdive></section><section class="level3"aria-labelledby="use-client-をいつ使うべきか-when-to-use-use-client"><h3 id="use-client-をいつ使うべきか-when-to-use-use-client"><code>'use client'</code> をいつ使うべきか {/<em>when-to-use-use-client</em>/}</h3><p><code>'use client'</code> を使うことで、どのコンポーネントがクライアントコンポーネントであるかを決定できます。デフォルトはサーバコンポーネントですので、その利点と制限事項を簡単に概観することで、何をクライアントレンダーとしてマークする必要があるかを判断できるようにしましょう。<p>話を簡単にするためサーバコンポーネントについて説明しますが、サーバで実行されるアプリのすべてのコードに同じ原則が適用されます。<section class="level4"aria-labelledby="サーバコンポーネントの利点-advantages"><h4 id="サーバコンポーネントの利点-advantages">サーバコンポーネントの利点 {/<em>advantages</em>/}</h4><ul><li>サーバコンポーネントにより、クライアントに送信され実行されるコードの量を減らすことができます。バンドルされてクライアントで評価されるのはクライアントモジュールだけです。<li>サーバコンポーネントにはサーバ上で実行されることに伴う利点があります。ローカルファイルシステムにアクセスでき、データフェッチやネットワークリクエストのレイテンシが低い可能性があります。</ul></section><section class="level4"aria-labelledby="サーバコンポーネントの制限事項-limitations"><h4 id="サーバコンポーネントの制限事項-limitations">サーバコンポーネントの制限事項 {/<em>limitations</em>/}</h4><ul><li>サーバコンポーネントはユーザによるインタラクションをサポートできません。イベントハンドラはクライアントで登録されトリガされる必要があるためです。<ul><li>例えば、<code>onClick</code> のようなイベントハンドラはクライアントコンポーネントでのみ定義できます。</ul><li>サーバコンポーネントではほとんどのフックを使用できません。<ul><li>サーバコンポーネントがレンダーされるとき、その出力は本質的にクライアントでレンダーすべきコンポーネントのリストになります。サーバコンポーネントはレンダー後にメモリに残らないため、state を持つことはできません。</ul></ul></section></section><section class="level3"aria-labelledby="サーバコンポーネントから返せるシリアライズ可能な型-serializable-types"><h3 id="サーバコンポーネントから返せるシリアライズ可能な型-serializable-types">サーバコンポーネントから返せるシリアライズ可能な型 {/<em>serializable-types</em>/}</h3><p>React アプリケーションでは一般的に、親コンポーネントから子コンポーネントにデータを渡します。これらが異なる環境でレンダーされるため、サーバコンポーネントからクライアントコンポーネントにデータを渡す際には特別な配慮が必要です。<p>サーバコンポーネントからクライアントコンポーネントに渡される props の値は、シリアライズ可能 (serializable) である必要があります。<p>シリアライズ可能な props には以下のものがあります：<ul><li>プリミティブ<ul><li><a href="https://developer.mozilla.org/en-US/docs/Glossary/String">文字列</a><li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Number">数値</a><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt">bigint</a><li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Boolean">ブーリアン</a><li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Undefined">undefined</a><li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Null">null</a><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol">シンボル</a>、ただし <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/for"><code>Symbol.for</code></a> を通じてグローバルシンボルレジストリに登録されたシンボルのみ</ul><li>シリアライズ可能な値を含んだ Iterable<ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">文字列</a><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">配列</a><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray">TypedArray</a> と <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">ArrayBuffer</a></ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date">Date</a><li>プレーンな<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">オブジェクト</a>: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Object_initializer">オブジェクト初期化子</a>で作成され、シリアライズ可能なプロパティを持つもの<li><a href="/reference/react/use-server">サーバアクション (server action)</a> としての関数<li>クライアントまたはサーバコンポーネントの要素（JSX）<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">プロミス</a></ul><p>以下のものはサポートされていません。<ul><li>クライアントとマークされたモジュールからエクスポートされていない、または <a href="/reference/react/use-server"><code>'use server'</code></a> でマークされていない<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function">関数</a><li><a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Classes_in_JavaScript">クラス</a><li>任意のクラスのインスタンス（上記の組み込みクラスを除く）や、<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object#null-prototype_objects">null プロトタイプのオブジェクト</a><li>グローバルに登録されていないシンボル、例：<code>Symbol('my new symbol')</code></ul></section></section><section class="level2"aria-labelledby="使用法-usage"><h2 id="使用法-usage">使用法 {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="ユーザ操作や-state-を実装する-building-with-interactivity-and-state"><h3 id="ユーザ操作や-state-を実装する-building-with-interactivity-and-state">ユーザ操作や state を実装する {/<em>building-with-interactivity-and-state</em>/}</h3><sandpack><pre class="language-js"><code class="language-js"><span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Counter</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>initialValue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>countValue<span class="token punctuation">,</span> setCountValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setCountValue</span><span class="token punctuation">(</span>countValue <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">decrement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setCountValue</span><span class="token punctuation">(</span>countValue <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Count</span> <span class="token maybe-class-name">Value</span><span class="token operator">:</span> <span class="token punctuation">{</span>countValue<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>decrement<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p><code>Counter</code> は値を増減させるために <code>useState</code> フックとイベントハンドラを必要とするので、このコンポーネントはクライアントコンポーネントでなければならず、ファイル冒頭に <code>'use client'</code> ディレクティブが必要です。<p>対照的に、インタラクションなしで UI をレンダーするコンポーネントはクライアントコンポーネントである必要はありません。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> readFile <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'node:fs/promises'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Counter</span></span> <span class="token keyword module">from</span> <span class="token string">'./Counter'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">CounterContainer</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> initialValue <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/path/to/counter_value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Counter</span> initialValue<span class="token operator">=</span><span class="token punctuation">{</span>initialValue<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">}</span></code></pre><p>例えば、<code>Counter</code> の親コンポーネントである <code>CounterContainer</code> は、インタラクティブではなく state を使用しないため、<code>'use client'</code> は必要ありません。むしろ <code>CounterContainer</code> はサーバコンポーネントでなければなりません。サーバ上のローカルファイルシステムから読み取っており、それが可能なのはサーバコンポーネントだけだからです。<p>また、サーバやクライアント固有の機能を使用しないため、レンダーされるべき場所に関して関知しないコンポーネントもあります。先ほどの例でいうと、<code>FancyText</code> がそのようなコンポーネントです。<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FancyText</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>title<span class="token punctuation">,</span> text<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> title
    <span class="token operator">?</span> <span class="token operator">&#x3C;</span>h1 className<span class="token operator">=</span><span class="token string">'fancy title'</span><span class="token operator">></span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">:</span> <span class="token operator">&#x3C;</span>h3 className<span class="token operator">=</span><span class="token string">'fancy cursive'</span><span class="token operator">></span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h3<span class="token operator">></span>
<span class="token punctuation">}</span></code></pre><p>このような場合、<code>'use client'</code> ディレクティブを追加しません。その結果、サーバコンポーネントから参照されたときに、<code>FancyText</code> の（ソースコードではなく）<em>出力結果</em>が、ブラウザに送信されます。先ほどのアプリの例で示したように、<code>FancyText</code> はどこからインポートされ、どこで使用されるかによって、サーバコンポーネントになることもクライアントコンポーネントになることもあるのです。<p>しかし、<code>FancyText</code> の HTML 出力が（依存モジュールも含んだ）ソースコードに比べて大きいような場合は、必ずクライアントコンポーネントとなるように強制する方が効率的かもしれません。一例として、長い SVG パス文字列を返すようなコンポーネントは、強制的にクライアントコンポーネントとしてレンダーする方が効率的である可能性があるでしょう。</section><section class="level3"aria-labelledby="クライアント-api-の使用-using-client-apis"><h3 id="クライアント-api-の使用-using-client-apis">クライアント API の使用 {/<em>using-client-apis</em>/}</h3><p>あなたの React アプリでは、Web ストレージ、オーディオやビデオの操作、デバイスハードウェア、<a href="https://developer.mozilla.org/en-US/docs/Web/API">その他もろもろ</a>のブラウザ API といった、クライアント固有の API を使用することがあるでしょう。<p>以下の例では、コンポーネントは <a href="https://developer.mozilla.org/en-US/docs/Glossary/DOM">DOM API</a> を使用して <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/canvas"><code>canvas</code></a> 要素を操作しています。これらの API はブラウザでのみ利用可能なので、クライアントコンポーネントとしてマークする必要があります。<pre class="language-js"><code class="language-js"><span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>useRef<span class="token punctuation">,</span> useEffect<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Circle</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> canvas <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token method function property-access">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token method function property-access">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token method function property-access">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token method function property-access">arc</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token method function property-access">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>canvas ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section><section class="level3"aria-labelledby="サードパーティライブラリの使用-using-third-party-libraries"><h3 id="サードパーティライブラリの使用-using-third-party-libraries">サードパーティライブラリの使用 {/<em>using-third-party-libraries</em>/}</h3><p>React アプリでは、一般的な UI パターンやロジックを処理するためにサードパーティのライブラリがよく用いられます。<p>これらのライブラリがコンポーネントのフックやクライアント API に依存することがあります。以下のような React API を使用するサードパーティのコンポーネントは、クライアント上で実行する必要があります。<ul><li><a href="/reference/react/createContext">createContext</a><li><a href="/reference/react/hooks"><code>react</code></a> と <a href="/reference/react-dom/hooks"><code>react-dom</code></a> のフック、ただし <a href="/reference/react/use"><code>use</code></a> と <a href="/reference/react/useId"><code>useId</code></a> は除く<li><a href="/reference/react/forwardRef">forwardRef</a><li><a href="/reference/react/memo">memo</a><li><a href="/reference/react/startTransition">startTransition</a><li>DOM の挿入やネイティブプラットフォームビューなどその他のクライアント API</ul><p>ライブラリがサーバコンポーネントと互換性を有するように更新済みであれば、中に既に <code>'use client'</code> マーカが含まれていますので、サーバコンポーネントから直接使用することができます。ライブラリが更新されていない場合、あるいはコンポーネントが受け取る props にクライアントでのみ指定できるイベントハンドラのようなものが含まれている場合、サードパーティのクライアントコンポーネントとそれを使用したいサーバコンポーネントの間に、自分でクライアントコンポーネントファイルを追加する必要があるかもしれません。<p>[TODO]: &#x3C;> (Troubleshooting - need use-cases) <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></canary></section>