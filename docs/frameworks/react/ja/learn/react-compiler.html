<!doctype html><html lang="ja"><meta charset="utf-8"><title>React Compiler</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="react-compiler"><h1 id="react-compiler">React Compiler</h1><intro>このページでは、新しい実験的プロジェクトである React Compiler の概要と、試用の方法について説明します。</intro><wip>このドキュメントはまだ作成中です。詳細なドキュメントは [React Compiler Working Group リポジトリ](https://github.com/reactwg/react-compiler/discussions)にあり、安定化後にこちらのドキュメントに反映されます。</wip><youwilllearn><ul><li>コンパイラを使い始める<li>コンパイラと eslint プラグインのインストール<li>トラブルシューティング</ul></youwilllearn><note>React Compiler は実験的なコンパイラであり、コミュニティから早期フィードバックを得るためにオープンソース化したものです。まだ粗削りな部分があり、本番環境で使用できる準備は整っていません。<p>React Compiler の使用には React 19 RC が必要です。React 19 にアップグレードできない場合は、<a href="https://github.com/reactwg/react-compiler/discussions/6">Working Group</a> で説明されているように、キャッシュ関数に対するユーザスペースの実装を試すことができます。ただしこれは推奨されておらず、可能な限り React 19 にアップグレードするべきです。<p>React Compiler は実験的なコンパイラであり、コミュニティから早期フィードバックを得るためにオープンソース化したものです。これはビルド時のみに実行されるツールであり、あなたの React アプリを自動的に最適化します。プレーンな JavaScript で動作し、<a href="/reference/rules">React のルール</a>を理解しているため、コードを書き直す必要はありません。<p>コンパイラには、コンパイラの分析結果をエディタ内でその場で表示できる <a href="#installing-eslint-plugin-react-compiler">eslint プラグイン</a> も含まれています。このプラグインはコンパイラとは独立して動作し、アプリでコンパイラを使用していなくても利用できます。すべての React 開発者に、この eslint プラグインを使用してコードベースの品質向上を図ることをお勧めします。<section class="level3"aria-labelledby="コンパイラは何をするのか-what-does-the-compiler-do"><h3 id="コンパイラは何をするのか-what-does-the-compiler-do">コンパイラは何をするのか {/<em>what-does-the-compiler-do</em>/}</h3><p>アプリケーションを最適化するために、React Compiler は自動的にコードをメモ化します。現在皆さんは、<code>useMemo</code>、<code>useCallback</code>、<code>React.memo</code> などの API を使ったメモ化に慣れているかもしれません。これらの API を使用することで、入力が変更されていない場合にアプリケーションの特定部分を再計算する必要がないということを React に伝え、更新時の作業を減らすことができます。強力な機能ですが、いとも簡単にメモ化を適用し忘れたり、誤って適用したりしてしまいます。こうなると、意味のある変化がない部分の UI についても React がチェックしなければならないため、非効率的な更新が発生してしまう可能性があります。<p>このコンパイラは、JavaScript と React のルールに関する知識を使用して、コンポーネントやフック内にある値や値のグループを、自動的にメモ化します。ルールが守られていない部分を検出した場合、該当のコンポーネントやフックだけを自動的にスキップし、他のコードを安全にコンパイルし続けます。<p>コードベースがすでに非常によくメモ化されている場合、コンパイラによる大きなパフォーマンス向上は期待できないかもしれません。しかし現実的には、パフォーマンス問題を引き起こす依存値を手動で正しくメモ化していくのは困難です。</p><deepdive>#### React Compiler が行うメモ化の種類 {/*what-kind-of-memoization-does-react-compiler-add*/}<p>React Compiler の初期リリースでは、主に<strong>更新（既存コンポーネントの再レンダー）時のパフォーマンスの向上</strong>に焦点を当てており、以下の 2 つのユースケースに重点を置いています。<ol><li><strong>コンポーネントの連鎖的な再レンダーのスキップ</strong><ul><li><code>&#x3C;Parent /></code> を再レンダーすると、実際には <code>&#x3C;Parent /></code> そのものしか変更されていないにも関わらず、コンポーネントツリー内の多くのコンポーネントが再レンダーされる</ul><li><strong>React 外での高コストな計算のスキップ</strong><ul><li>例えば、コンポーネントやフック内で <code>expensivelyProcessAReallyLargeArrayOfObjects()</code> を呼び出してこのデータを取り出している</ul></ol><section class="level4"aria-labelledby="再レンダーの最適化-optimizing-re-renders"><h4 id="再レンダーの最適化-optimizing-re-renders">再レンダーの最適化 {/<em>optimizing-re-renders</em>/}</h4><p>React では、UI を現在の状態（具体的には props、state、コンテクスト）に対する関数として表現できます。現在の実装では、コンポーネントの state が変わると、React はそのコンポーネント<em>およびそのすべての子コンポーネント</em>を再レンダーします。<code>useMemo()</code>、<code>useCallback()</code>、または <code>React.memo()</code> を使用して手動でメモ化を適用していなければ、そうなります。例えば、次の例では、<code>&#x3C;FriendList></code> の state が変わるたびに、<code>&#x3C;MessageButton></code> が再レンダーされます。<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FriendList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> friends <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onlineCount <span class="token operator">=</span> <span class="token function">useFriendOnlineCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>friends<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">NoFriends</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>span<span class="token operator">></span><span class="token punctuation">{</span>onlineCount<span class="token punctuation">}</span> online<span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span>
      <span class="token punctuation">{</span>friends<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">friend</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">FriendListCard</span> key<span class="token operator">=</span><span class="token punctuation">{</span>friend<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span> friend<span class="token operator">=</span><span class="token punctuation">{</span>friend<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MessageButton</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><a href="https://playground.react.dev/#N4Igzg9grgTgxgUxALhAMygOzgFwJYSYAEAYjHgpgCYAyeYOAFMEWuZVWEQL4CURwADrEicQgyKEANnkwIAwtEw4iAXiJQwCMhWoB5TDLmKsTXgG5hRInjRFGbXZwB0UygHMcACzWr1ABn4hEWsYBBxYYgAeADkIHQ4uAHoAPksRbisiMIiYYkYs6yiqPAA3FMLrIiiwAAcAQ0wU4GlZBSUcbklDNqikusaKkKrgR0TnAFt62sYHdmp+VRT7SqrqhOo6Bnl6mCoiAGsEAE9VUfmqZzwqLrHqM7ubolTVol5eTOGigFkEMDB6u4EAAhKA4HCEZ5DNZ9ErlLIWYTcEDcIA"><em>React Compiler Playground でこの例を見る</em></a><p>React Compiler は手動によるメモ化と同等の処理を自動的に適用し、state の変化に応じてアプリの関連部分のみが再レンダーされるようにします。これは「細粒度リアクティビティ (fine-grained reactivity)」と呼ばれることもあります。上記の例では、React Compiler は <code>&#x3C;FriendListCard /></code> の返り値は <code>friends</code> が変わっても再利用できると判断し、この JSX の再作成<em>および</em> <code>count</code> が変わるときの <code>&#x3C;MessageButton></code> の再レンダーを回避できます。</section><section class="level4"aria-labelledby="高コストな計算もメモ化される-expensive-calculations-also-get-memoized"><h4 id="高コストな計算もメモ化される-expensive-calculations-also-get-memoized">高コストな計算もメモ化される {/<em>expensive-calculations-also-get-memoized</em>/}</h4><p>コンパイラは、レンダー中に使用される高コストな計算も自動的にメモ化できます。<pre class="language-js"><code class="language-js"><span class="token comment">// **Not** memoized by React Compiler, since this is not a component or hook</span>
<span class="token keyword">function</span> <span class="token function">expensivelyProcessAReallyLargeArrayOfObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>

<span class="token comment">// Memoized by React Compiler since this is a component</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TableContainer</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> items <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// This function call would be memoized:</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">expensivelyProcessAReallyLargeArrayOfObjects</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><a href="https://playground.react.dev/#N4Igzg9grgTgxgUxALhAejQAgFTYHIQAuumAtgqRAJYBeCAJpgEYCemASggIZyGYDCEUgAcqAGwQwANJjBUAdokyEAFlTCZ1meUUxdMcIcIjyE8vhBiYVECAGsAOvIBmURYSonMCAB7CzcgBuCGIsAAowEIhgYACCnFxioQAyXDAA5gixMDBcLADyzvlMAFYIvGAAFACUmMCYaNiYAHStOFgAvk5OGJgAshTUdIysHNy8AkbikrIKSqpaWvqGIiZmhE6u7p7ymAAqXEwSguZcCpKV9VSEFBodtcBOmAYmYHz0XIT6ALzefgFUYKhCJRBAxeLcJIsVIZLI5PKFYplCqVa63aoAbm6u0wMAQhFguwAPPRAQA+YAfL4dIloUmBMlODogDpAA"><em>React Compiler Playground でこの例を見る</em></a><p>ただし、<code>expensivelyProcessAReallyLargeArrayOfObjects</code> が本当に高コストな関数である場合は、React の外部で独自のメモ化を実装することを検討すべきかもしれません。<ul><li>React Compiler は React コンポーネントとフックのみをメモ化し、すべての関数をメモ化するわけではない<li>React Compiler のメモ化は複数のコンポーネントやフック間で共有されない</ul><p>従って、<code>expensivelyProcessAReallyLargeArrayOfObjects</code> が多くの異なるコンポーネントで使用されている場合、同じ items が渡されたとしても、高コストな計算が繰り返し実行さることになります。コードを複雑化する前に、まずは<a href="https://react.dev/reference/react/useMemo#how-to-tell-if-a-calculation-is-expensive">プロファイリング</a>して、それが本当に高コストかどうかを確認することをお勧めします。</section></deepdive></section><section class="level3"aria-labelledby="コンパイラが前提としていること-what-does-the-compiler-assume"><h3 id="コンパイラが前提としていること-what-does-the-compiler-assume">コンパイラが前提としていること {/<em>what-does-the-compiler-assume</em>/}</h3><p>React Compiler は、あなたのコードが以下ようになっていることを仮定します。<ol><li>有効でセマンティックな JavaScript であること。<li>nullable ないし省略可能な値について（例えば、TypeScript を使用している場合は <a href="https://www.typescriptlang.org/tsconfig/#strictNullChecks"><code>strictNullChecks</code></a> を使うなどで）チェックを行っていること。つまり <code>if (object.nullableProperty) { object.nullableProperty.foo }</code> とするか、オプショナルチェーンを使用して <code>object.nullableProperty?.foo</code> のようにしていること。<li><a href="https://react.dev/reference/rules">React のルール</a>に従っていること。</ol><p>React Comiler は多くの React のルールを静的に検証でき、エラーを検出した場合は安全にコンパイルをスキップします。エラーを確認するために、<a href="https://www.npmjs.com/package/eslint-plugin-react-compiler">eslint-plugin-react-compiler</a> のインストールもお勧めします。</section><section class="level3"aria-labelledby="コンパイラを試すべきか-should-i-try-out-the-compiler"><h3 id="コンパイラを試すべきか-should-i-try-out-the-compiler">コンパイラを試すべきか {/<em>should-i-try-out-the-compiler</em>/}</h3><p>コンパイラはまだ実験的であり、多くの粗削りな部分があります。Meta のような企業で本番環境で使用されてはいますが、アプリにコンパイラを本番導入すべきかどうかは、コードベースの健全性と <a href="/reference/rules">React のルール</a>にどれだけ従っているかに依存します。<p><strong>今すぐコンパイラを使用する必要はありません。安定版リリースを待ってから採用しても構いません</strong>。ただし、アプリで小規模な実験として試してみて、<a href="#reporting-issues">フィードバック</a>を提供していただれば、コンパイラの改善に役立ちます。</section><section class="level2"aria-labelledby="スタートガイド-getting-started"><h2 id="スタートガイド-getting-started">スタートガイド {/<em>getting-started</em>/}</h2><p>以下のドキュメントに加えて、コンパイラに関する追加情報やディスカッションについて <a href="https://github.com/reactwg/react-compiler">React Compiler Working Group</a> を確認することをお勧めします。<section class="level3"aria-labelledby="互換性の確認-checking-compatibility"><h3 id="互換性の確認-checking-compatibility">互換性の確認 {/<em>checking-compatibility</em>/}</h3><p>コンパイラをインストールする前に、まずコードベースが互換性があるかどうかを確認してください。</p><terminalblock>npx react-compiler-healthcheck@experimental</terminalblock><p>このスクリプトは以下をチェックします。<ul><li>どれだけ多くのコンポーネントが正常に最適化できるか：多いほど良い<li><code>&#x3C;StrictMode></code> の使用：これを有効にして指示に従っている場合、<a href="/reference/rules">React のルール</a>に従っている可能性が高い<li>非互換ライブラリの使用：コンパイラと互換性がないことが既知のライブラリ</ul><p>以下は実行例です。</p><terminalblock>Successfully compiled 8 out of 9 components. StrictMode usage not found. Found no usage of incompatible libraries.</terminalblock></section><section class="level3"aria-labelledby="eslint-plugin-react-compiler-のインストール-installing-eslint-plugin-react-compiler"><h3 id="eslint-plugin-react-compiler-のインストール-installing-eslint-plugin-react-compiler">eslint-plugin-react-compiler のインストール {/<em>installing-eslint-plugin-react-compiler</em>/}</h3><p>React Compiler は eslint プラグインも提供しています。eslint プラグインはコンパイラとは<strong>独立して</strong>使用できるため、コンパイラを使用しなくても eslint プラグインだけを使用できます。</p><terminalblock>npm install eslint-plugin-react-compiler@experimental</terminalblock><p>次に、eslint の設定に以下を追加します。<pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'eslint-plugin-react-compiler'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'react-compiler/react-compiler'</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre><p>eslint プラグインは、エディタ内で React のルールに関する違反を表示します。これが表示される場合、そのコンポーネントやフックの最適化をコンパイラがスキップしたということを意味します。これ自体は全く問題なく、コンパイラは他のコンポーネントの最適化を続けることができます。<p><strong>すべての eslint の違反をすぐに修正する必要はありません</strong>。ルール違反を自分のペースで修正しつつ、最適化されるコンポーネントやフックの数を徐々に増やしていくことができます。コンパイラを使用する前にすべてを修正する必要はありません。</section><section class="level3"aria-labelledby="コンパイラをコードベースに展開する-using-the-compiler-effectively"><h3 id="コンパイラをコードベースに展開する-using-the-compiler-effectively">コンパイラをコードベースに展開する {/<em>using-the-compiler-effectively</em>/}</h3><section class="level4"aria-labelledby="既存のプロジェクト-existing-projects"><h4 id="既存のプロジェクト-existing-projects">既存のプロジェクト {/<em>existing-projects</em>/}</h4><p>コンパイラは、<a href="/reference/rules">React のルール</a>に従う関数コンポーネントやフックをコンパイルするように設計されています。また、これらのルールを破っているコードもバイパス（スキップ）することで処理できます。しかし、JavaScript の柔軟性のため、コンパイラはすべての違反を検出することはできません。偽陰性、つまりルールを破っているコンポーネントやフックを見逃して誤ってコンパイルしてしまい、未定義の動作が発生する可能性があります。<p>このため、既存のプロジェクトでコンパイラをうまく導入するには、まず本番コードのうちの小さなディレクトリで実行することをお勧めします。そのためには、特定のディレクトリの組み合わせでのみコンパイラを実行するように設定します。<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token maybe-class-name">ReactCompilerConfig</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">sources</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> filename<span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span><span class="token string">'src/path/to/dir'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>稀なケースですが、<code>compilationMode: "annotation"</code> のオプションを使用してコンパイラを「オプトイン」モードで実行するように設定することもできます。これにより、<code>"use memo"</code> ディレクティブでラベル付けされたコンポーネントやフックのみがコンパイルされるようになります。<code>annotation</code> モードはアーリーアダプタを補助するための一時的なものであり、<code>"use memo"</code> ディレクティブを長期的に使用することは意図していないことに注意してください。<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token maybe-class-name">ReactCompilerConfig</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">compilationMode</span><span class="token operator">:</span> <span class="token string">"annotation"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// src/app.jsx</span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">"use memo"</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>コンパイラの本番採用に自信がついたら、他のディレクトリにも適用範囲を拡大していき、アプリ全体に徐々に展開していくことができます。</section><section class="level4"aria-labelledby="新規プロジェクト-new-projects"><h4 id="新規プロジェクト-new-projects">新規プロジェクト {/<em>new-projects</em>/}</h4><p>新しいプロジェクトを開始する場合、コードベース全体でコンパイラを有効化できます。これがデフォルトの動作です。</section></section></section><section class="level2"aria-labelledby="使用法-installation"><h2 id="使用法-installation">使用法 {/<em>installation</em>/}</h2><section class="level3"aria-labelledby="babel-usage-with-babel"><h3 id="babel-usage-with-babel">Babel {/<em>usage-with-babel</em>/}</h3><terminalblock>npm install babel-plugin-react-compiler@experimental</terminalblock><p>コンパイラには、ビルドパイプラインでコンパイラを実行するために使用できる Babel プラグインが含まれています。<p>インストール後、プラグインを Babel の設定に追加します。コンパイラがパイプライン内で<strong>最初に</strong>実行されることが重要です。<pre class="language-js"><code class="language-js"><span class="token comment">// babel.config.js</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">ReactCompilerConfig</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">[</span><span class="token string">'babel-plugin-react-compiler'</span><span class="token punctuation">,</span> <span class="token maybe-class-name">ReactCompilerConfig</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// must run first!</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><code>babel-plugin-react-compiler</code> は、他の Babel プラグインより前に、最初に実行される必要があります。コンパイラは、正確な解析のために入力ソース情報を必要とするためです。</section><section class="level3"aria-labelledby="vite-usage-with-vite"><h3 id="vite-usage-with-vite">Vite {/<em>usage-with-vite</em>/}</h3><p>Vite を使用する場合、vite-plugin-react にプラグインを追加できます。<pre class="language-js"><code class="language-js"><span class="token comment">// vite.config.js</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">ReactCompilerConfig</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">react</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">babel</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span><span class="token string">"babel-plugin-react-compiler"</span><span class="token punctuation">,</span> <span class="token maybe-class-name">ReactCompilerConfig</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section class="level3"aria-labelledby="nextjs-usage-with-nextjs"><h3 id="nextjs-usage-with-nextjs">Next.js {/<em>usage-with-nextjs</em>/}</h3><p>Next.js には React Compiler を有効にするための実験的な設定があります。これにより、Babel が <code>babel-plugin-react-compiler</code> と共に自動的にセットアップされます。<ul><li>React 19 Release Candidate を使用する Next.js canary をインストールする<li><code>babel-plugin-react-compiler</code> をインストールする</ul><terminalblock>npm install next@canary babel-plugin-react-compiler@experimental</terminalblock><p>次に以下のようにして <code>next.config.js</code> 内で実験的オプションを設定します。<pre class="language-js"><code class="language-js"><span class="token comment">// next.config.js</span>
<span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>NextConfig<span class="token punctuation">}</span></span> */</span>
<span class="token keyword">const</span> nextConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">experimental</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">reactCompiler</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> nextConfig<span class="token punctuation">;</span></code></pre><p>この実験的オプションを使用ことで、以下で React Compiler がサポートされるようになります。<ul><li>App Router<li>Pages Router<li>Webpack（デフォルト）<li>Turbopack（<code>--turbo</code> を通じてオプトイン）</ul></section><section class="level3"aria-labelledby="remix-usage-with-remix"><h3 id="remix-usage-with-remix">Remix {/<em>usage-with-remix</em>/}</h3><p><code>vite-plugin-babel</code> をインストールし、コンパイラ付属の Babel プラグインを追加します。</p><terminalblock>npm install vite-plugin-babel</terminalblock><pre class="language-js"><code class="language-js"><span class="token comment">// vite.config.js</span>
<span class="token keyword module">import</span> <span class="token imports">babel</span> <span class="token keyword module">from</span> <span class="token string">"vite-plugin-babel"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">ReactCompilerConfig</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">remix</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">/* ... */</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">filter</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.[jt]sx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">babelConfig</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@babel/preset-typescript"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// if you use TypeScript</span>
        <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">[</span><span class="token string">"babel-plugin-react-compiler"</span><span class="token punctuation">,</span> <span class="token maybe-class-name">ReactCompilerConfig</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section class="level3"aria-labelledby="webpack-usage-with-webpack"><h3 id="webpack-usage-with-webpack">Webpack {/<em>usage-with-webpack</em>/}</h3><p>React Compiler 用の独自のローダは、以下のようにして作成できます。<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token maybe-class-name">ReactCompilerConfig</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">BabelPluginReactCompiler</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babel-plugin-react-compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reactCompilerLoader</span><span class="token punctuation">(</span><span class="token parameter">sourceCode<span class="token punctuation">,</span> sourceMap</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">transformSync</span><span class="token punctuation">(</span>sourceCode<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">[</span><span class="token maybe-class-name">BabelPluginReactCompiler</span><span class="token punctuation">,</span> <span class="token maybe-class-name">ReactCompilerConfig</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">callback</span><span class="token punctuation">(</span>
      <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed to transform "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span><span class="token property-access">filename</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">callback</span><span class="token punctuation">(</span>
    <span class="token keyword null nil">null</span><span class="token punctuation">,</span>
    result<span class="token punctuation">.</span><span class="token property-access">code</span><span class="token punctuation">,</span>
    result<span class="token punctuation">.</span><span class="token property-access">map</span> <span class="token operator">===</span> <span class="token keyword null nil">null</span> <span class="token operator">?</span> <span class="token keyword nil">undefined</span> <span class="token operator">:</span> result<span class="token punctuation">.</span><span class="token property-access">map</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> reactCompilerLoader<span class="token punctuation">;</span></code></pre></section><section class="level3"aria-labelledby="expo-usage-with-expo"><h3 id="expo-usage-with-expo">Expo {/<em>usage-with-expo</em>/}</h3><p>Expo アプリで React Compiler を有効化する方法については <a href="https://docs.expo.dev/preview/react-compiler/">Expo のドキュメント</a>を参照してください。</section><section class="level3"aria-labelledby="metro-react-native-usage-with-react-native-metro"><h3 id="metro-react-native-usage-with-react-native-metro">Metro (React Native) {/<em>usage-with-react-native-metro</em>/}</h3><p>React Native は Metro 経由で Babel を使用するため、インストール手順については <a href="#usage-with-babel">Babel での使用</a>セクションを参照してください。</section><section class="level3"aria-labelledby="rspack-usage-with-rspack"><h3 id="rspack-usage-with-rspack">Rspack {/<em>usage-with-rspack</em>/}</h3><p>Rspack アプリで React Compiler を有効化する方法については <a href="https://rspack.dev/guide/tech/react#react-compiler">Rspack のドキュメント</a>を参照してください。</section><section class="level3"aria-labelledby="rsbuild-usage-with-rsbuild"><h3 id="rsbuild-usage-with-rsbuild">Rsbuild {/<em>usage-with-rsbuild</em>/}</h3><p>Rsbuild アプリで React Compiler を有効化する方法については <a href="https://rsbuild.dev/guide/framework/react#react-compiler">Rsbuild のドキュメント</a>を参照してください。</section></section><section class="level2"aria-labelledby="トラブルシューティング-troubleshooting"><h2 id="トラブルシューティング-troubleshooting">トラブルシューティング {/<em>troubleshooting</em>/}</h2><p>問題を報告するには、まず <a href="https://playground.react.dev/">React Compiler Playground</a> で最小限の再現コードを作成し、それをバグ報告に含めてください。問題は <a href="https://github.com/facebook/react/issues">facebook/react</a> リポジトリで報告できます。<p>また、メンバとして参加することで React Compiler Working Group にフィードバックを提供することもできます。参加方法の詳細については <a href="https://github.com/reactwg/react-compiler">README</a> を参照してください。<section class="level3"aria-labelledby="0--_c-is-not-a-function-エラー-0--_c-is-not-a-function-error"><h3 id="0--_c-is-not-a-function-エラー-0--_c-is-not-a-function-error"><code>(0 , _c) is not a function</code> エラー {/<em>0--_c-is-not-a-function-error</em>/}</h3><p>これは React 19 RC 以降を使用していない場合に発生します。これを修正するには、まず<a href="https://react.dev/blog/2024/04/25/react-19-upgrade-guide">アプリを React 19 RC にアップグレード</a>してください。<p>React 19 にアップグレードできない場合は、<a href="https://github.com/reactwg/react-compiler/discussions/6">Working Group</a> で説明されているように、キャッシュ関数に関するユーザスペースの実装を試すことができます。ただしこれは推奨されておらず、可能な限り React 19 にアップグレードするべきです。</section><section class="level3"aria-labelledby="コンポーネントが最適化されたかどうかを知る方法-how-do-i-know-my-components-have-been-optimized"><h3 id="コンポーネントが最適化されたかどうかを知る方法-how-do-i-know-my-components-have-been-optimized">コンポーネントが最適化されたかどうかを知る方法 {/<em>how-do-i-know-my-components-have-been-optimized</em>/}</h3><p><a href="/learn/react-developer-tools">React Devtools</a> (v5.0+) には React Compiler のサポートが組み込まれており、コンパイラによって最適化されたコンポーネントの横に "Memo ✨" バッジが表示されます。</section><section class="level3"aria-labelledby="コンパイル後に何かが動作しない場合-something-is-not-working-after-compilation"><h3 id="コンパイル後に何かが動作しない場合-something-is-not-working-after-compilation">コンパイル後に何かが動作しない場合 {/<em>something-is-not-working-after-compilation</em>/}</h3><p>eslint-plugin-react-compiler がインストールされている場合、コンパイラはエディタ内で React のルールに対する違反を表示します。これが表示された場合、コンパイラはそのコンポーネントやフックの最適化をスキップしたという意味です。これ自体は全く問題なく、コンパイラは他のコンポーネントの最適化を続けることができます。<strong>すべての eslint 違反をすぐに修正する必要はありません</strong>。自分のペースで対応して、最適化されるコンポーネントやフックの数を増やしていくことができます。<p>JavaScript の柔軟かつ動的な性質のため、すべてのケースを包括的に検出することはできません。無限ループなどのバグや未定義の動作が発生することがあります。<p>コンパイル後にアプリが正しく動作せず、eslint エラーも表示されない場合、コンパイラがコードを誤ってコンパイルしている可能性があります。これを確認するには、関連があると思われるコンポーネントやフックを明示的に <a href="#opt-out-of-the-compiler-for-a-component"><code>"use no memo"</code> ディレクティブ</a>を使って除外してみてください。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">SuspiciousComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">"use no memo"</span><span class="token punctuation">;</span> <span class="token comment">// opts out this component from being compiled by React Compiler</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><note>#### `"use no memo"` {/*use-no-memo*/}<p><code>"use no memo"</code> は、React Compiler によるコンパイルからコンポーネントやフックを一時的に除外するための<em>一時的な</em>避難ハッチです。このディレクティブは、例えば <a href="/reference/rsc/use-client"><code>"use client"</code></a> のように長期に渡って使用されることを意図したものではありません。<p>このディレクティブを使用するのは本当に必要な場合に限ることをお勧めします。一度コンポーネントやフックを除外してしまえば、ディレクティブを削除するまで永遠に除外され続けることになります。つまり、コードの問題を修正しても、ディレクティブを削除しない限りコンパイラはコンパイルを行わなくなります。<p>これでエラーが解消された場合、この除外ディレクティブを削除してみて問題が再発することを確認してください。その後、バグレポートを <a href="https://playground.react.dev">React Compiler Playground</a> を使って共有してください（小さな再現コードに削減するか、オープンソースコードであればソース全体を貼り付けることもできます）。これにより問題を特定して修正する手助けができるようになります。</p></note></section><section class="level3"aria-labelledby="その他の問題-other-issues"><h3 id="その他の問題-other-issues">その他の問題 {/<em>other-issues</em>/}</h3><p><a href="https://github.com/reactwg/react-compiler/discussions/7">https://github.com/reactwg/react-compiler/discussions/7</a> をご覧ください。 <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section></note></section>