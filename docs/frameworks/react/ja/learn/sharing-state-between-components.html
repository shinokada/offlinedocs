<!doctype html><html lang="ja"><meta charset="utf-8"><title>コンポーネント間で state を共有する</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="コンポーネント間で-state-を共有する"><h1 id="コンポーネント間で-state-を共有する">コンポーネント間で state を共有する</h1><intro><p>2 つのコンポーネントの state を常に同時に変更したいという場合があります。これを行うには、両方のコンポーネントから state を削除して最も近い共通の親へ移動し、そこから state を props 経由でコンポーネントへ渡します。これは <em>state のリフトアップ (lifting state up)</em> として知られているものであり、React コードを書く際に行う最も一般的な作業のひとつです。</p></intro><youwilllearn><ul><li>コンポーネント間で state を共有する方法<li>制御された (controlled) コンポーネントと非制御 (uncontrolled) コンポーネントとは何か</ul></youwilllearn><section class="level2"aria-labelledby="state-のリフトアップの例-lifting-state-up-by-example"><h2 id="state-のリフトアップの例-lifting-state-up-by-example">state のリフトアップの例 {/<em>lifting-state-up-by-example</em>/}</h2><p>以下の例では、親の <code>Accordion</code> コンポーネントが 2 つの別々の <code>Panel</code> をレンダーしています。<ul><li><code>Accordion</code><ul><li><code>Panel</code><li><code>Panel</code></ul></ul><p>各 <code>Panel</code> コンポーネントには、内容を表示中かどうかを決定するブール型の <code>isActive</code> という state があります。<p>両方のパネルで "Show" ボタンを押してみてください。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Panel</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> title<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isActive<span class="token punctuation">,</span> setIsActive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>section className<span class="token operator">=</span><span class="token string">"panel"</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h3<span class="token operator">></span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h3<span class="token operator">></span>
      <span class="token punctuation">{</span>isActive <span class="token operator">?</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Show</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>section<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Accordion</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Almaty</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Kazakhstan</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span> title<span class="token operator">=</span><span class="token string">"About"</span><span class="token operator">></span>
        <span class="token maybe-class-name">With</span> a population <span class="token keyword">of</span> about <span class="token number">2</span> million<span class="token punctuation">,</span> <span class="token maybe-class-name">Almaty</span> is <span class="token maybe-class-name">Kazakhstan</span>'s largest city<span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">From</span></span> <span class="token number">1929</span> to <span class="token number">1997</span><span class="token punctuation">,</span> it was its capital city<span class="token punctuation">.</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span> title<span class="token operator">=</span><span class="token string">"Etymology"</span><span class="token operator">></span>
        <span class="token maybe-class-name">The</span> name comes <span class="token keyword module">from</span> <span class="token operator">&#x3C;</span>span lang<span class="token operator">=</span><span class="token string">"kk-KZ"</span><span class="token operator">></span>алма<span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">,</span> the <span class="token maybe-class-name">Kazakh</span> word <span class="token keyword control-flow">for</span> <span class="token string">"apple"</span> and is often translated <span class="token keyword module">as</span> <span class="token string">"full of apples"</span><span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">In</span></span> fact<span class="token punctuation">,</span> the region surrounding <span class="token maybe-class-name">Almaty</span> is thought to be the ancestral home <span class="token keyword">of</span> the apple<span class="token punctuation">,</span> and the wild <span class="token operator">&#x3C;</span>i lang<span class="token operator">=</span><span class="token string">"la"</span><span class="token operator">></span><span class="token maybe-class-name">Malus</span> sieversii<span class="token operator">&#x3C;</span><span class="token operator">/</span>i<span class="token operator">></span> is considered a likely candidate <span class="token keyword control-flow">for</span> the ancestor <span class="token keyword">of</span> the modern domestic apple<span class="token punctuation">.</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">h3<span class="token punctuation">,</span> p</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span> <span class="token number">0</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.panel</span></span> <span class="token punctuation">{</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token hexcode color">#aaa</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>片方のパネルのボタンを押しても、もう片方のパネルには影響しません。2 つのパネルは独立していますね。</p><diagramgroup><diagram name="sharing_state_child"height="{367}"width="{477}"alt="Accordion というラベルが付いた親と、Panel というラベルが付いた 2 つの子からなる 3 つのコンポーネントのツリーを示す図。両方の Panel コンポーネントには、false の値を持った isActive が含まれている。"><p>最初は、各 <code>Panel</code> の <code>isActive</code> state は <code>false</code> なので、どちらも折りたたまれている</p></diagram><diagram name="sharing_state_child_clicked"height="{367}"width="{480}"alt="前の図と同様で、最初の子の Panel コンポーネントの isActive がクリックによりハイライトされ、値が true に設定されている。2 つ目の Panel コンポーネントは false のまま。"><p>どちらかの <code>Panel</code> のボタンをクリックすると、その <code>Panel</code> のみ <code>isActive</code> の state が更新される</p></diagram></diagramgroup><p><strong>ですが今回はこれを変更し、一度に 1 つのパネルだけが展開されるようにしたいとしましょう</strong>。この設計では、2 番目のパネルを展開すると 1 番目のパネルが折りたたまれます。どのようにして実現すればよいでしょうか？<p>これら 2 つのパネルを協調して動作させるためには、以下の 3 ステップで、親のコンポーネントに "state をリフトアップ" する必要があります。<ol><li>子コンポーネントから state を<strong>削除</strong>する。<li>共通の親からハードコードされた<strong>データを渡す</strong>。<li>共通の親に state を<strong>追加</strong>し、イベントハンドラと一緒に下に渡す。</ol><p>これにより、<code>Accordion</code> コンポーネントが両方の <code>Panel</code> の調整役となり、一度に一方だけを展開できるようになります。<section class="level3"aria-labelledby="ステップ-1子コンポーネントから-state-を削除する-step-1-remove-state-from-the-child-components"><h3 id="ステップ-1子コンポーネントから-state-を削除する-step-1-remove-state-from-the-child-components">ステップ 1：子コンポーネントから state を削除する {/<em>step-1-remove-state-from-the-child-components</em>/}</h3><p><code>Panel</code> の <code>isActive</code> の制御権を親コンポーネントに与えることになります。つまり、親コンポーネントが <code>isActive</code> を <code>Panel</code> に props として渡すということです。まずは <code>Panel</code> コンポーネントから<strong>以下の行を削除</strong>してください。<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>isActive<span class="token punctuation">,</span> setIsActive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>代わりに、<code>isActive</code> を <code>Panel</code> の props のリストに追加します。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Panel</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> title<span class="token punctuation">,</span> children<span class="token punctuation">,</span> isActive <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code></pre><p>これで、<code>Panel</code> の親コンポーネントは <code>isActive</code> を <a href="/learn/passing-props-to-a-component">props として渡すことで</a><em>制御</em>できます。逆に、<code>Panel</code> コンポーネントは <code>isActive</code> の値を自身で<em>制御できなく</em>なりました。制御が親コンポーネントに移ったのです！</section><section class="level3"aria-labelledby="ステップ-2共通の親からハードコードされたデータを渡す-step-2-pass-hardcoded-data-from-the-common-parent"><h3 id="ステップ-2共通の親からハードコードされたデータを渡す-step-2-pass-hardcoded-data-from-the-common-parent">ステップ 2：共通の親からハードコードされたデータを渡す {/<em>step-2-pass-hardcoded-data-from-the-common-parent</em>/}</h3><p>state をリフトアップするためには、協調動作させたい<em>すべての</em>子コンポーネントの、最も近い共通の親コンポーネントを特定する必要があります。<ul><li><code>Accordion</code> <em>（最も近い共通の親）</em><ul><li><code>Panel</code><li><code>Panel</code></ul></ul><p>この例では <code>Accordion</code> コンポーネントが該当します。両方のパネルの上にあり、それらの props を制御できるので、現在アクティブなパネルに関する "信頼できる情報源 (source of truth)" となります。<code>Accordion</code> コンポーネントからハードコードされた <code>isActive</code> の値（例えば、<code>true</code>）を両方のパネルに渡しましょう。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Accordion</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Almaty</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Kazakhstan</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span> title<span class="token operator">=</span><span class="token string">"About"</span> isActive<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">With</span> a population <span class="token keyword">of</span> about <span class="token number">2</span> million<span class="token punctuation">,</span> <span class="token maybe-class-name">Almaty</span> is <span class="token maybe-class-name">Kazakhstan</span>'s largest city<span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">From</span></span> <span class="token number">1929</span> to <span class="token number">1997</span><span class="token punctuation">,</span> it was its capital city<span class="token punctuation">.</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span> title<span class="token operator">=</span><span class="token string">"Etymology"</span> isActive<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">The</span> name comes <span class="token keyword module">from</span> <span class="token operator">&#x3C;</span>span lang<span class="token operator">=</span><span class="token string">"kk-KZ"</span><span class="token operator">></span>алма<span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">,</span> the <span class="token maybe-class-name">Kazakh</span> word <span class="token keyword control-flow">for</span> <span class="token string">"apple"</span> and is often translated <span class="token keyword module">as</span> <span class="token string">"full of apples"</span><span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">In</span></span> fact<span class="token punctuation">,</span> the region surrounding <span class="token maybe-class-name">Almaty</span> is thought to be the ancestral home <span class="token keyword">of</span> the apple<span class="token punctuation">,</span> and the wild <span class="token operator">&#x3C;</span>i lang<span class="token operator">=</span><span class="token string">"la"</span><span class="token operator">></span><span class="token maybe-class-name">Malus</span> sieversii<span class="token operator">&#x3C;</span><span class="token operator">/</span>i<span class="token operator">></span> is considered a likely candidate <span class="token keyword control-flow">for</span> the ancestor <span class="token keyword">of</span> the modern domestic apple<span class="token punctuation">.</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Panel</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> title<span class="token punctuation">,</span> children<span class="token punctuation">,</span> isActive <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>section className<span class="token operator">=</span><span class="token string">"panel"</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h3<span class="token operator">></span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h3<span class="token operator">></span>
      <span class="token punctuation">{</span>isActive <span class="token operator">?</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Show</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>section<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">h3<span class="token punctuation">,</span> p</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span> <span class="token number">0</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.panel</span></span> <span class="token punctuation">{</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token hexcode color">#aaa</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p><code>Accordion</code> コンポーネントにハードコードされた <code>isActive</code> の値を編集してみて、画面上で起きる結果を確認してください。</section><section class="level3"aria-labelledby="ステップ-3共通の親に-state-を追加する-step-3-add-state-to-the-common-parent"><h3 id="ステップ-3共通の親に-state-を追加する-step-3-add-state-to-the-common-parent">ステップ 3：共通の親に state を追加する {/<em>step-3-add-state-to-the-common-parent</em>/}</h3><p>state をリフトアップすることで、state として格納するデータの意味が変わることがあります。<p>今回の場合、一度に 1 つのパネルだけがアクティブであるべきです。つまり、共通の親コンポーネントである <code>Accordion</code> は、どのパネルがアクティブなのかを管理する必要があります。state 変数としては、<code>boolean</code> 値の代わりに、アクティブな <code>Panel</code> のインデックスを表す数値を使うことができます。<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>activeIndex<span class="token punctuation">,</span> setActiveIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>activeIndex</code> が <code>0</code> のときは 1 番目のパネルが、<code>1</code> のときは 2 番目のパネルがアクティブになります。<p>どちらの <code>Panel</code> の "Show" ボタンがクリックされた場合でも、<code>Accordion</code> のアクティブインデックスを変更する必要があります。<code>activeIndex</code> という state は <code>Accordion</code> 内に定義されるものであるため、<code>Panel</code> からそれを直接セットすることはできません。<code>Accordion</code> コンポーネントは、<a href="/learn/responding-to-events#passing-event-handlers-as-props">props として <code>onShow</code> イベントハンドラを下に渡すこと</a>で、<code>Panel</code> コンポーネントがアコーディオンの state を変更できるように<em>明示的に許可</em>する必要があります：<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span>
    isActive<span class="token operator">=</span><span class="token punctuation">{</span>activeIndex <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">}</span>
    onShow<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setActiveIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token operator">></span>
    <span class="token spread operator">...</span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span>
    isActive<span class="token operator">=</span><span class="token punctuation">{</span>activeIndex <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">}</span>
    onShow<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setActiveIndex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token operator">></span>
    <span class="token spread operator">...</span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span></code></pre><p>そして <code>Panel</code> 内の <code>&#x3C;button></code> は、クリックイベントハンドラとして props である <code>onShow</code> を使用します。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Accordion</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>activeIndex<span class="token punctuation">,</span> setActiveIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h2<span class="token operator">></span><span class="token maybe-class-name">Almaty</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Kazakhstan</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span>
        title<span class="token operator">=</span><span class="token string">"About"</span>
        isActive<span class="token operator">=</span><span class="token punctuation">{</span>activeIndex <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">}</span>
        onShow<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setActiveIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">With</span> a population <span class="token keyword">of</span> about <span class="token number">2</span> million<span class="token punctuation">,</span> <span class="token maybe-class-name">Almaty</span> is <span class="token maybe-class-name">Kazakhstan</span>'s largest city<span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">From</span></span> <span class="token number">1929</span> to <span class="token number">1997</span><span class="token punctuation">,</span> it was its capital city<span class="token punctuation">.</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Panel</span>
        title<span class="token operator">=</span><span class="token string">"Etymology"</span>
        isActive<span class="token operator">=</span><span class="token punctuation">{</span>activeIndex <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">}</span>
        onShow<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setActiveIndex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">></span>
        <span class="token maybe-class-name">The</span> name comes <span class="token keyword module">from</span> <span class="token operator">&#x3C;</span>span lang<span class="token operator">=</span><span class="token string">"kk-KZ"</span><span class="token operator">></span>алма<span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">,</span> the <span class="token maybe-class-name">Kazakh</span> word <span class="token keyword control-flow">for</span> <span class="token string">"apple"</span> and is often translated <span class="token keyword module">as</span> <span class="token string">"full of apples"</span><span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">In</span></span> fact<span class="token punctuation">,</span> the region surrounding <span class="token maybe-class-name">Almaty</span> is thought to be the ancestral home <span class="token keyword">of</span> the apple<span class="token punctuation">,</span> and the wild <span class="token operator">&#x3C;</span>i lang<span class="token operator">=</span><span class="token string">"la"</span><span class="token operator">></span><span class="token maybe-class-name">Malus</span> sieversii<span class="token operator">&#x3C;</span><span class="token operator">/</span>i<span class="token operator">></span> is considered a likely candidate <span class="token keyword control-flow">for</span> the ancestor <span class="token keyword">of</span> the modern domestic apple<span class="token punctuation">.</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Panel</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Panel</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  title<span class="token punctuation">,</span>
  children<span class="token punctuation">,</span>
  isActive<span class="token punctuation">,</span>
  onShow
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>section className<span class="token operator">=</span><span class="token string">"panel"</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h3<span class="token operator">></span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h3<span class="token operator">></span>
      <span class="token punctuation">{</span>isActive <span class="token operator">?</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onShow<span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Show</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>section<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">h3<span class="token punctuation">,</span> p</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span> <span class="token number">0</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.panel</span></span> <span class="token punctuation">{</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token hexcode color">#aaa</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>これで state のリフトアップが完了です！ state を共通の親コンポーネントに移動させることで、2 つのパネルを協調動作させられるようになりました。「表示中」フラグを 2 つ使う代わりにアクティブインデックスを使用することで、一度にアクティブなパネルが 1 つだけであることが保証されました。また、イベントハンドラを子に渡すことで、子に親の state を変更させることができました。</p><diagramgroup><diagram name="sharing_state_parent"height="{385}"width="{487}"alt="Accordion というラベルの親コンポーネントと、Panel というラベルの 2 つの子コンポーネントからなる 3 つのコンポーネントのツリーを示す図。最初 Accordion の activeIndex が 0 なので、最初の Panel が isActive = true を受け取る。"><p>最初、<code>Accordion</code> の <code>activeIndex</code> は <code>0</code> なので、最初の <code>Panel</code> が <code>isActive = true</code> を受け取る。</p></diagram><diagram name="sharing_state_parent_clicked"height="{385}"width="{521}"alt="前と同じ図だが、クリックによりハイライトされた親の Accordion コンポーネントの activeIndex が 1 に変わっている。両方の子の Panel コンポーネントもハイライトされており、isActive の値が逆転して渡されている。最初の Panel には false、2 番目の Panel には true。"><p><code>Accordion</code> の <code>activeIndex</code> state が <code>1</code> に変更されると、2 番目の <code>Panel</code> が <code>isActive = true</code> を受け取る。</p></diagram></diagramgroup><deepdive><section class="level4"aria-labelledby="制御されたコンポーネントと非制御コンポーネント-controlled-and-uncontrolled-components"><h4 id="制御されたコンポーネントと非制御コンポーネント-controlled-and-uncontrolled-components">制御されたコンポーネントと非制御コンポーネント {/<em>controlled-and-uncontrolled-components</em>/}</h4><p>一般的に、ローカル state を持つコンポーネントを "非制御 (uncontrolled)" であると呼びます。例えば、<code>isActive</code> という state 変数を持つ元の <code>Panel</code> コンポーネントは、パネルがアクティブかどうかに関して親が影響を与えることができないため、非制御コンポーネントです。<p>対照的に、重要な情報がローカル state ではなく props によって駆動されるとき、コンポーネントは "制御された (controlled)" ものと呼ばれることがあります。これにより、親コンポーネントがその振る舞いを完全に指定することができます。<code>isActive</code> を props として持つ最終的な <code>Panel</code> コンポーネントは、<code>Accordion</code> コンポーネントによって制御されていることになります。<p>非制御コンポーネントは、設定が少なくて済むので親コンポーネントの中に入れて使用することが簡単にできます。しかし、それらを協調動作させたい場合に柔軟性がありません。制御されたコンポーネントはとても柔軟ですが、親コンポーネントが props で完全に設定してあげる必要があります。<p>実際には、"制御された"、"非制御" は技術用語として厳密なものではありません。各コンポーネントは通常、ローカルな state と props の両方を、混在して持つものです。しかし、コンポーネントがどう設計されるか、どんな機能を持つかについて話す際には、このような考え方が役に立つでしょう。<p>コンポーネントを書くときには、その中のどの情報を（props で）制御し、どの情報を（state を使うことで）制御しないのかを検討してください。しかし後で考えを変えてリファクタリングすることはいつでも可能です。</section></deepdive></section></section><section class="level2"aria-labelledby="各-state-の信頼できる唯一の情報源-a-single-source-of-truth-for-each-state"><h2 id="各-state-の信頼できる唯一の情報源-a-single-source-of-truth-for-each-state">各 state の信頼できる唯一の情報源 {/<em>a-single-source-of-truth-for-each-state</em>/}</h2><p>React アプリケーションでは、多くのコンポーネントが自身の state を保持します。一部の state は、入力フィールドのような末梢コンポーネント（ツリーの最下部のコンポーネント）に近いところに存在します。一部の state はアプリの上部に近いところに存在することでしょう。例えば、クライアントサイドルーティングライブラリも、React の state に現在のルートを格納し、props を介して下に渡すことで実装されることが一般的です。<p><strong>それぞれの state について、それを「所有」するコンポーネントを選択してください</strong>。この原則は、<a href="https://en.wikipedia.org/wiki/Single_source_of_truth">"信頼できる唯一の情報源 (single source of truth)"</a> としても知られています。これは、すべての state が一箇所にまとまっているという意味ではありません。<em>それぞれの</em> state について、その情報を保持する<em>特定の</em>コンポーネントが存在すべきという意味です。コンポーネント間で共有される state は複製する代わりに、共通の親に<em>リフトアップ</em>して、それを必要とする子に<em>渡す</em>ようにしてください。<p>あなたのアプリは作業を進めるうちに変化していきます。まだそれぞれの state がどこに存在すべきか分からない間は、state を下に移動させたり、上に戻したりすることがよくあります。これは開発プロセスの一環です！<p>もう少し多くのコンポーネントが登場する例で実践的に感覚を理解したい場合は、<a href="/learn/thinking-in-react">React の流儀</a>を読んでみましょう。</p><recap><ul><li>2 つのコンポーネントを協調動作させたい場合は、state を共通の親に移動する。<li>次に、その共通の親から props 経由で情報を下に渡す。<li>最後に、子が親の state を変更できるよう、イベントハンドラを下に渡す。<li>コンポーネントを「制御された」（props によって駆動される）か「非制御」（state によって駆動される）かという観点で考えることが有用である。</ul></recap><challenges><section class="level4"aria-labelledby="入力欄の同期-synced-inputs"><h4 id="入力欄の同期-synced-inputs">入力欄の同期 {/<em>synced-inputs</em>/}</h4><p>以下の 2 つの入力欄は独立しています。同期して動作するようにしましょう。片方の入力欄を編集すると、他方の入力欄も同じテキストに更新されるようにしてください。</p><hint><p>親コンポーネントに state をリフトアップする必要があります。</p></hint><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">SyncedInputs</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Input</span> label<span class="token operator">=</span><span class="token string">"First input"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Input</span> label<span class="token operator">=</span><span class="token string">"Second input"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Input</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> label <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
      <span class="token punctuation">{</span>label<span class="token punctuation">}</span>
      <span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>input
        value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p><code>text</code> という state 変数と <code>handleChange</code> ハンドラを親コンポーネントに移動させます。次に、それらを両方の <code>Input</code> コンポーネントに props 経由で渡します。これにより、2 つの入力欄の同期が保たれます。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">SyncedInputs</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Input</span>
        label<span class="token operator">=</span><span class="token string">"First input"</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Input</span>
        label<span class="token operator">=</span><span class="token string">"Second input"</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Input</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> label<span class="token punctuation">,</span> value<span class="token punctuation">,</span> onChange <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
      <span class="token punctuation">{</span>label<span class="token punctuation">}</span>
      <span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>input
        value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack></solution></section><section class="level4"aria-labelledby="リストのフィルタリング-filtering-a-list"><h4 id="リストのフィルタリング-filtering-a-list">リストのフィルタリング {/<em>filtering-a-list</em>/}</h4><p>以下の例では、<code>SearchBar</code> は、テキスト入力を制御する <code>query</code> という独自の state を保持しています。親である <code>FilterableList</code> コンポーネントは項目の <code>List</code> を表示していますが、検索クエリが考慮されていません。<p><code>filterItems(foods, query)</code> 関数を使って、検索クエリに従ってリストの絞り込みを行ってください。変更をテストするには、入力欄に "s" と入力すると、"Sushi"、"Shish kebab"、"Dim sum" のようにリストが絞り込まれることを確認します。<p><code>filterItems</code> は既に実装されておりインポートされているので、自分で書く必要はありません！</p><hint><p><code>query</code> の state と <code>handleChange</code> ハンドラを <code>SearchBar</code> から削除し、<code>FilterableList</code> に移動します。その後、<code>query</code> および <code>onChange</code> を props として <code>SearchBar</code> に渡します。</p></hint><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> foods<span class="token punctuation">,</span> filterItems <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./data.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FilterableList</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">SearchBar</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">List</span> items<span class="token operator">=</span><span class="token punctuation">{</span>foods<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">SearchBar</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setQuery</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
      <span class="token literal-property property">Search</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>input
        value<span class="token operator">=</span><span class="token punctuation">{</span>query<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">List</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> items <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>table<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>tbody<span class="token operator">></span>
        <span class="token punctuation">{</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">food</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>tr key<span class="token operator">=</span><span class="token punctuation">{</span>food<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token operator">&#x3C;</span>td<span class="token operator">></span><span class="token punctuation">{</span>food<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>td<span class="token operator">></span>
            <span class="token operator">&#x3C;</span>td<span class="token operator">></span><span class="token punctuation">{</span>food<span class="token punctuation">.</span><span class="token property-access">description</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>td<span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>tr<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>tbody<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>table<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">filterItems</span><span class="token punctuation">(</span><span class="token parameter">items<span class="token punctuation">,</span> query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  query <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> items<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span>
    item<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">some</span><span class="token punctuation">(</span><span class="token parameter">word</span> <span class="token arrow operator">=></span>
      word<span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">startsWith</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">const</span> foods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Sushi'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'Sushi is a traditional Japanese dish of prepared vinegared rice'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Dal'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'The most common way of preparing dal is in the form of a soup to which onions, tomatoes and various spices may be added'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Pierogi'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'Pierogi are filled dumplings made by wrapping unleavened dough around a savoury or sweet filling and cooking in boiling water'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Shish kebab'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'Shish kebab is a popular meal of skewered and grilled cubes of meat.'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Dim sum'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'Dim sum is a large range of small dishes that Cantonese people traditionally enjoy in restaurants for breakfast and lunch'</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></sandpack><solution><p><code>query</code> の state を <code>FilterableList</code> コンポーネントにリフトアップします。フィルタリング済のリストを取得するために、<code>filterItems(foods, query)</code> を呼び出し、それを <code>List</code> に渡します。これで、query の入力を変更するとリストに反映されるようになります。</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> foods<span class="token punctuation">,</span> filterItems <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./data.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FilterableList</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token function">filterItems</span><span class="token punctuation">(</span>foods<span class="token punctuation">,</span> query<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setQuery</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">SearchBar</span>
        query<span class="token operator">=</span><span class="token punctuation">{</span>query<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">List</span> items<span class="token operator">=</span><span class="token punctuation">{</span>results<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">SearchBar</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> query<span class="token punctuation">,</span> onChange <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
      <span class="token literal-property property">Search</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>input
        value<span class="token operator">=</span><span class="token punctuation">{</span>query<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">List</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> items <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>table<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>tbody<span class="token operator">></span> 
        <span class="token punctuation">{</span>items<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">food</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>tr key<span class="token operator">=</span><span class="token punctuation">{</span>food<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token operator">&#x3C;</span>td<span class="token operator">></span><span class="token punctuation">{</span>food<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>td<span class="token operator">></span>
            <span class="token operator">&#x3C;</span>td<span class="token operator">></span><span class="token punctuation">{</span>food<span class="token punctuation">.</span><span class="token property-access">description</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>td<span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>tr<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>tbody<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>table<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">filterItems</span><span class="token punctuation">(</span><span class="token parameter">items<span class="token punctuation">,</span> query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  query <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> items<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span>
    item<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">some</span><span class="token punctuation">(</span><span class="token parameter">word</span> <span class="token arrow operator">=></span>
      word<span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">startsWith</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">const</span> foods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Sushi'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'Sushi is a traditional Japanese dish of prepared vinegared rice'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Dal'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'The most common way of preparing dal is in the form of a soup to which onions, tomatoes and various spices may be added'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Pierogi'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'Pierogi are filled dumplings made by wrapping unleavened dough around a savoury or sweet filling and cooking in boiling water'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Shish kebab'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'Shish kebab is a popular meal of skewered and grilled cubes of meat.'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Dim sum'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'Dim sum is a large range of small dishes that Cantonese people traditionally enjoy in restaurants for breakfast and lunch'</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></sandpack></solution><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></challenges></section></section>