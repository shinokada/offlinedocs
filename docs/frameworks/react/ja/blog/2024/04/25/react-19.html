<!doctype html><html lang="ja"><meta charset="utf-8"><title>"React 19 RC"</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="react-19-rc"><h1 id="react-19-rc">"React 19 RC"</h1><p>author: The React Team date: 2024/04/25 description: React 19 RC が npm で利用可能になりました！ この投稿では React 19 の新機能、およびそれらをどのように採用するかについて概説します。<p>April 25, 2024 by <a href="/community/team">The React Team</a></p><intro><p>npm で React 19 Beta が利用可能になりました！</p></intro><p><a href="/blog/2024/04/25/react-19-upgrade-guide">React 19 RC アップグレードガイド</a>では、アプリを React 19 にアップグレードするためのステップバイステップガイドをお示ししました。この投稿では、React 19 の新機能と、それらをどのように採用するかについて概説します。<ul><li><a href="#whats-new-in-react-19">React 19 の新機能</a><li><a href="#improvements-in-react-19">React 19 の改善点</a><li><a href="#how-to-upgrade">アップグレード方法</a></ul><p>破壊的変更のリストについては、<a href="/blog/2024/04/25/react-19-upgrade-guide">アップグレードガイド</a>を参照してください。<section class="level2"aria-labelledby="react-19-の新機能-whats-new-in-react-19"><h2 id="react-19-の新機能-whats-new-in-react-19">React 19 の新機能 {/<em>whats-new-in-react-19</em>/}</h2><section class="level3"aria-labelledby="アクション-action-actions"><h3 id="アクション-action-actions">アクション (Action) {/<em>actions</em>/}</h3><p>React アプリの一般的なユースケースは、データの書き換えを行い、それに応じて state を更新するというものです。例えば、ユーザがフォームを送信してユーザ名を変更する場合、API リクエストを発行し、そのレスポンスを処理します。これまでは、送信中 (pending) 状態、エラー、楽観的更新やリクエストの順序について、手動で管理する必要がありました。<p>例えば、送信中状態やエラーの処理は、以下のように <code>useState</code> を使って行っていました。<pre class="language-js"><code class="language-js"><span class="token comment">// Before Actions</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">UpdateName</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isPending<span class="token punctuation">,</span> setIsPending<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setIsPending</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">updateName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setIsPending</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
    <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">"/path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setName</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span> disabled<span class="token operator">=</span><span class="token punctuation">{</span>isPending<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Update</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>error <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token punctuation">{</span>error<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>React 19 では、トランジション内で非同期関数を使用することで、送信中状態、エラー、フォーム、楽観的更新を自動的に処理するためのサポートが追加されます。<p>例えば、<code>useTransition</code> を使用すれば以下のように送信中状態を処理できます。<pre class="language-js"><code class="language-js"><span class="token comment">// Using pending state from Actions</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">UpdateName</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isPending<span class="token punctuation">,</span> startTransition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useTransition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">updateName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> 
      <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">"/path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setName</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span> disabled<span class="token operator">=</span><span class="token punctuation">{</span>isPending<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Update</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>error <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token punctuation">{</span>error<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>この非同期トランジションは、開始直後に <code>isPending</code> 状態を true にセットし、非同期リクエストを実行し、すべてのトランジション終了後に <code>isPending</code> を false に切り替えます。これにより、データが変更されている最中も、現在の UI をレスポンシブかつインタラクティブに保つことができます。</p><note><section class="level4"aria-labelledby="非同期トランジションを使用する関数を規約としてアクションと呼ぶ-by-convention-functions-that-use-async-transitions-are-called-actions"><h4 id="非同期トランジションを使用する関数を規約としてアクションと呼ぶ-by-convention-functions-that-use-async-transitions-are-called-actions">非同期トランジションを使用する関数を規約として「アクション」と呼ぶ {/<em>by-convention-functions-that-use-async-transitions-are-called-actions</em>/}</h4><p>アクションはあなたの代わりに自動的にデータの送信を管理してくれます。<ul><li><strong>送信中状態</strong>：アクションは送信中状態を提供します。これはリクエストと共に開始され、最終的な state の更新がコミットされると自動的にリセットされます。<li><strong>楽観的更新</strong>：アクションは新しい <a href="#new-hook-optimistic-updates"><code>useOptimistic</code></a> フックをサポートしており、リクエスト送信中にユーザに対し即時のフィードバックを表示することができます。<li><strong>エラー処理</strong>：アクションはエラー処理を提供するため、リクエストが失敗した場合にエラーバウンダリを表示し、楽観的更新を自動的に元の状態に復元できます。<li><strong>フォーム</strong>：<code>&#x3C;form></code> 要素は、props である <code>action</code> および <code>formAction</code> に関数を渡すことをサポートするようになりました。<code>action</code> に関数を渡すことでデフォルトでアクションとして扱われ、送信後にフォームを自動的にリセットします。</ul></section></note><p>アクションの仕組みを土台として、React 19 では楽観的更新を管理するための <a href="#new-hook-optimistic-updates"><code>useOptimistic</code></a> と、アクションの一般的なユースケースを扱うための新しいフックである <a href="#new-hook-useactionstate"><code>React.useActionState</code></a> が導入されます。<code>react-dom</code> では、フォームを自動的に管理する <a href="#form-actions"><code>&#x3C;form></code> アクション</a>と、フォームにおけるアクションの一般的なユースケースをサポートする <a href="#new-hook-useformstatus"><code>useFormStatus</code></a> が追加されています。<p>React 19 では、上記の例は以下のように簡略化できます。<pre class="language-js"><code class="language-js"><span class="token comment">// Using &#x3C;form> Actions and useActionState</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChangeName</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> name<span class="token punctuation">,</span> setName <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> submitAction<span class="token punctuation">,</span> isPending<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>
    <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">previousState<span class="token punctuation">,</span> formData</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">updateName</span><span class="token punctuation">(</span>formData<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> error<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">"/path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword null nil">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>submitAction<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"name"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span> disabled<span class="token operator">=</span><span class="token punctuation">{</span>isPending<span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Update</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>error <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token punctuation">{</span>error<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>以下のセクションで、React 19 の新しいアクション関連機能を詳しく説明していきます。</section><section class="level3"aria-labelledby="新しいフックuseactionstate-new-hook-useactionstate"><h3 id="新しいフックuseactionstate-new-hook-useactionstate">新しいフック：<code>useActionState</code> {/<em>new-hook-useactionstate</em>/}</h3><p>アクションの一般的なユースケースを簡単に実現するため、<code>useActionState</code> という新しいフックを追加しました。<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> submitAction<span class="token punctuation">,</span> isPending<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>
  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">previousState<span class="token punctuation">,</span> newName</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">updateName</span><span class="token punctuation">(</span>newName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// You can return any result of the action.</span>
      <span class="token comment">// Here, we return only the error.</span>
      <span class="token keyword control-flow">return</span> error<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// handle success</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword null nil">null</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>useActionState</code> は関数（「アクション」本体）を受け取り、そのアクションをラップしたものを返します。これが動作するのはアクションのコンポジションが可能だからです。ラップされたアクションが呼び出されると、<code>useActionState</code> はアクションの最終結果を <code>data</code> として、アクションの進行中状態を <code>pending</code> として返します。</p><note><p><code>React.useActionState</code> は以前の Canary リリースでは <code>ReactDOM.useFormState</code> と呼ばれていましたが、名前を変更し、<code>useFormState</code> を非推奨にしました。<p>詳細は <a href="https://github.com/facebook/react/pull/28491">#28491</a> を参照してください。</p></note><p>詳細は、<a href="/reference/react/useActionState"><code>useActionState</code></a> のドキュメントをご覧ください。</section><section class="level3"aria-labelledby="react-dom-アクション-form-actions"><h3 id="react-dom-アクション-form-actions">React DOM：<code>&#x3C;form></code> アクション {/<em>form-actions</em>/}</h3><p>アクションはまた、<code>react-dom</code> における React 19 の新しい <code>&#x3C;form></code> 機能とも統合されています。<code>&#x3C;form></code>、<code>&#x3C;input></code>、<code>&#x3C;button></code> の各要素において、props である <code>action</code> および <code>formAction</code> に関数を渡すことがサポートされるようになりました。これによりアクションを用いて自動的にフォームの送信が可能です。<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>actionFunction<span class="token punctuation">}</span><span class="token operator">></span></code></pre><p><code>&#x3C;form></code> アクションが成功すると、React は非制御コンポーネントの場合にフォームを自動的にリセットします。手動で <code>&#x3C;form></code> をリセットする必要がある場合は、新しい React DOM の API である <code>requestFormReset</code> を呼び出すことができます。<p>詳細は、<code>react-dom</code> のドキュメントで <a href="/reference/react-dom/components/form"><code>&#x3C;form></code></a>、<a href="/reference/react-dom/components/input"><code>&#x3C;input></code></a>、<code>&#x3C;button></code> をご覧ください。</section><section class="level3"aria-labelledby="react-dom-の新しいフックuseformstatus-new-hook-useformstatus"><h3 id="react-dom-の新しいフックuseformstatus-new-hook-useformstatus">React DOM の新しいフック：<code>useFormStatus</code> {/<em>new-hook-useformstatus</em>/}</h3><p>デザインシステムにおいてはよく、props を深く受け渡すことなしに、自身の所属する <code>&#x3C;form></code> に関する情報にアクセスする必要があるデザインコンポーネントを書くことがあります。これはコンテクストを介して行うことも可能ですが、一般的なユースケースを簡単に行えるよう、新しいフックである <code>useFormStatus</code> を追加しました。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>useFormStatus<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">DesignButton</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>pending<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useFormStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span> disabled<span class="token operator">=</span><span class="token punctuation">{</span>pending<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">}</span></code></pre><p><code>useFormStatus</code> を使うことで、まるで親フォーム自体がコンテクストプロバイダであるかのように、親 <code>&#x3C;form></code> の状態を読み取れます。<p>詳細は、<code>react-dom</code> ドキュメントの <a href="/reference/react-dom/hooks/useFormStatus"><code>useFormStatus</code></a> をご覧ください。</section><section class="level3"aria-labelledby="新しいフックuseoptimistic-new-hook-optimistic-updates"><h3 id="新しいフックuseoptimistic-new-hook-optimistic-updates">新しいフック：<code>useOptimistic</code> {/<em>new-hook-optimistic-updates</em>/}</h3><p>データの書き換えを行う際に一般的な UI パターンは、非同期リクエストの進行中に、最終的にとるはずの状態を先に楽観的に表示しておくというものです。React 19 では、これを簡単に行うための新しいフックである <code>useOptimistic</code> を追加しています。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChangeName</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>currentName<span class="token punctuation">,</span> onUpdateName<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>optimisticName<span class="token punctuation">,</span> setOptimisticName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useOptimistic</span><span class="token punctuation">(</span>currentName<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">submitAction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token parameter">formData</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newName <span class="token operator">=</span> formData<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setOptimisticName</span><span class="token punctuation">(</span>newName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> updatedName <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">updateName</span><span class="token punctuation">(</span>newName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">onUpdateName</span><span class="token punctuation">(</span>updatedName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>submitAction<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Your</span> name is<span class="token operator">:</span> <span class="token punctuation">{</span>optimisticName<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>label<span class="token operator">></span><span class="token maybe-class-name">Change</span> <span class="token maybe-class-name">Name</span><span class="token operator">:</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"text"</span>
          name<span class="token operator">=</span><span class="token string">"name"</span>
          disabled<span class="token operator">=</span><span class="token punctuation">{</span>currentName <span class="token operator">!==</span> optimisticName<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><code>useOptimistic</code> フックは、<code>updateName</code> リクエストが進行中になると、<code>optimisticName</code> を即座にレンダーします。更新が完了するかエラーが発生すると、React は自動的に <code>currentName</code> の値に戻します。<p>詳細については、<a href="/reference/react/useOptimistic"><code>useOptimistic</code></a> のドキュメントをご覧ください。</section><section class="level3"aria-labelledby="新しい-apiuse-new-feature-use"><h3 id="新しい-apiuse-new-feature-use">新しい API：<code>use</code> {/<em>new-feature-use</em>/}</h3><p>React 19 では、レンダー中にリソースを読み取るための新しい API である <code>use</code> を導入しています。<p>たとえば、<code>use</code> でプロミスを読み取ることができます。プロミスが解決 (resolve) するまで React はサスペンドします。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>use<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Comments</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>commentsPromise<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// `use` will suspend until the promise resolves.</span>
  <span class="token keyword">const</span> comments <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span>commentsPromise<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> comments<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">comment</span> <span class="token arrow operator">=></span> <span class="token operator">&#x3C;</span>p key<span class="token operator">=</span><span class="token punctuation">{</span>comment<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>comment<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Page</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>commentsPromise<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// When `use` suspends in Comments,</span>
  <span class="token comment">// this Suspense boundary will be shown.</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">Loading</span><span class="token spread operator">...</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Comments</span> commentsPromise<span class="token operator">=</span><span class="token punctuation">{</span>commentsPromise<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><note><section class="level4"aria-labelledby="use-はレンダー中に作成されたプロミスをサポートしない-use-does-not-support-promises-created-in-render"><h4 id="use-はレンダー中に作成されたプロミスをサポートしない-use-does-not-support-promises-created-in-render"><code>use</code> はレンダー中に作成されたプロミスをサポートしない {/<em>use-does-not-support-promises-created-in-render</em>/}</h4><p>レンダー中に作成されたプロミスを <code>use</code> に渡そうとすると、React は警告を表示します。</p><consoleblockmulti><consolelogline level="error"><p>A component was suspended by an uncached promise. Creating promises inside a Client Component or hook is not yet supported, except via a Suspense-compatible library or framework.</p></consolelogline></consoleblockmulti><p>修正するには、プロミスをキャッシュできるサスペンス対応のライブラリまたはフレームワークで作られたプロミスを渡す必要があります。将来的には、レンダー中にプロミスをキャッシュしやすくする機能を提供する予定です。</section></note><p>また、<code>use</code> を使用してコンテクストを読み取ることもでき、早期リターンの後などに条件付きでコンテクストを読み取れるようになります。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>use<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ThemeContext</span></span> <span class="token keyword module">from</span> <span class="token string">'./ThemeContext'</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Heading</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>children<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>children <span class="token operator">==</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// This would not work with useContext</span>
  <span class="token comment">// because of the early return.</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>h1 style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span> theme<span class="token punctuation">.</span><span class="token property-access">color</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><code>use</code> API は、フックと同様にレンダー中にのみ呼び出すことができます。しかしフックとは異なり、<code>use</code> は条件分岐の中でも呼び出すことが可能です。将来的には、<code>use</code> を使用してレンダー中にリソースを使用する方法をさらに拡充する予定です。<p>詳細については、<a href="/reference/react/use"><code>use</code></a> のドキュメントをご覧ください。</section></section><section class="level2"aria-labelledby="react-server-components-react-server-components"><h2 id="react-server-components-react-server-components">React Server Components {/<em>react-server-components</em>/}</h2><section class="level3"aria-labelledby="サーバコンポーネント-server-components"><h3 id="サーバコンポーネント-server-components">サーバコンポーネント {/<em>server-components</em>/}</h3><p>サーバコンポーネントは、クライアントアプリケーションや SSR サーバとは別の環境で、バンドル前にコンポーネントを事前レンダーするための新しいオプションです。React Server Components の "server" とはこの別の環境を指しています。サーバコンポーネントは、CI サーバでビルド時に一度だけ実行することも、ウェブサーバを使用してリクエストごとに実行することもできます。<p>React 19 には、Canary チャンネルにあったすべての React Server Components の機能が含まれています。これにより、サーバコンポーネントを使用するライブラリは、React 19 を peer dependency としてターゲットにすることができ、<code>react-server</code> <a href="https://github.com/reactjs/rfcs/blob/main/text/0227-server-module-conventions.md#react-server-conditional-exports">エクスポート条件</a> を用いて<a href="/learn/start-a-new-react-project#which-features-make-up-the-react-teams-full-stack-architecture-vision">フルスタック React アーキテクチャ</a>をサポートするフレームワークで使用できます。</p><note><section class="level4"aria-labelledby="サーバコンポーネントのサポートを追加する方法-how-do-i-build-support-for-server-components"><h4 id="サーバコンポーネントのサポートを追加する方法-how-do-i-build-support-for-server-components">サーバコンポーネントのサポートを追加する方法 {/<em>how-do-i-build-support-for-server-components</em>/}</h4><p>React 19 の React Server Components は安定しており、メジャーバージョン間での破壊的変更はありませんが、サーバコンポーネントのバンドラやフレームワークを実装するために使用される基盤となる API は semver に従いません。React 19.x のマイナーバージョン間で変更が生じる可能性があります。<p>React Server Components をバンドラやフレームワークでサポートする場合は、特定の React バージョンに固定するか、Canary リリースを使用することをお勧めします。React Server Components を実装するために使用される API を安定化させるため、今後もバンドラやフレームワークと連携を続けていきます。</section></note><p>詳細については、<a href="/reference/rsc/server-components">React Server Components</a> のドキュメントをご覧ください。</section><section class="level3"aria-labelledby="サーバアクション-server-actions"><h3 id="サーバアクション-server-actions">サーバアクション {/<em>server-actions</em>/}</h3><p>サーバアクションにより、クライアントコンポーネントからサーバ上で実行される非同期関数を呼び出せるようになります。<p>サーバアクションが <code>"use server"</code> ディレクティブを用いて定義されると、フレームワークは自動的にサーバ関数への参照を作成し、その参照をクライアントコンポーネントに渡します。クライアントでその関数が呼び出されると、React はサーバにリクエストを送り、関数を実行し、その結果を返します。</p><note><section class="level4"aria-labelledby="サーバコンポーネントのためのディレクティブはない-there-is-no-directive-for-server-components"><h4 id="サーバコンポーネントのためのディレクティブはない-there-is-no-directive-for-server-components">サーバコンポーネントのためのディレクティブはない {/<em>there-is-no-directive-for-server-components</em>/}</h4><p>よくある誤解として、サーバコンポーネントを <code>"use server"</code> を用いて定義するものだと考えるというものがあります。サーバコンポーネントにはディレクティブがありません。<code>"use server"</code> ディレクティブは、サーバアクションのためのものです。<p>詳細については、<a href="/reference/rsc/directives">ディレクティブ</a>のドキュメントをご覧ください。</section></note><p>サーバアクションはサーバコンポーネントで作成され、props としてクライアントコンポーネントに渡すことも、クライアントコンポーネントでインポートして使用することもできます。<p>詳細については、<a href="/reference/rsc/server-actions">React サーバアクション</a>のドキュメントをご覧ください。</section></section><section class="level2"aria-labelledby="react-19-の改善点-improvements-in-react-19"><h2 id="react-19-の改善点-improvements-in-react-19">React 19 の改善点 {/<em>improvements-in-react-19</em>/}</h2><section class="level3"aria-labelledby="ref-が-props-に-ref-as-a-prop"><h3 id="ref-が-props-に-ref-as-a-prop"><code>ref</code> が props に {/<em>ref-as-a-prop</em>/}</h3><p>React 19 から、関数コンポーネントにおいて <code>ref</code> に props としてアクセスできるようになりました。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyInput</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>placeholder<span class="token punctuation">,</span> ref<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>input placeholder<span class="token operator">=</span><span class="token punctuation">{</span>placeholder<span class="token punctuation">}</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token comment">//...</span>
<span class="token operator">&#x3C;</span><span class="token maybe-class-name">MyInput</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span></code></pre><p>新しい関数コンポーネントでは <code>forwardRef</code> が不要になります。新しい props である <code>ref</code> を使用するようコンポーネントを自動的に更新する codemod を公開する予定です。将来のバージョンでは <code>forwardRef</code> は非推奨となり、削除されます。</p><note><p>クラスに渡された <code>ref</code> はコンポーネントインスタンスを参照するため、props としては渡されません。</p></note></section><section class="level3"aria-labelledby="ハイドレーションエラー時の差分表示-diffs-for-hydration-errors"><h3 id="ハイドレーションエラー時の差分表示-diffs-for-hydration-errors">ハイドレーションエラー時の差分表示 {/<em>diffs-for-hydration-errors</em>/}</h3><p><code>react-dom</code> におけるハイドレーションエラーのエラーレポートを改善しました。これまで開発時には、たとえば以下のようなエラーが複数ログとして記録されていましたが、ハイドレーション不一致に関する情報は含まれていませんでした。</p><consoleblockmulti><consolelogline level="error"><p>Warning: Text content did not match. Server: "Server" Client: "Client" {' '}at span {' '}at App</p></consolelogline><consolelogline level="error"><p>Warning: An error occurred during hydration. The server HTML was replaced with client content in &#x3C;div>.</p></consolelogline><consolelogline level="error"><p>Warning: Text content did not match. Server: "Server" Client: "Client" {' '}at span {' '}at App</p></consolelogline><consolelogline level="error"><p>Warning: An error occurred during hydration. The server HTML was replaced with client content in &#x3C;div>.</p></consolelogline><consolelogline level="error"><p>Uncaught Error: Text content does not match server-rendered HTML. {' '}at checkForUnmatchedText {' '}...</p></consolelogline></consoleblockmulti><p>今後は、不一致部分の差分を含んだ単一のメッセージがログに記録されるようになります。</p><consoleblockmulti><consolelogline level="error"><p>Uncaught Error: Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if an SSR-ed Client Component used:{'\n'} - A server/client branch <code>if (typeof window !== 'undefined')</code>. - Variable input such as <code>Date.now()</code> or <code>Math.random()</code> which changes each time it's called. - Date formatting in a user's locale which doesn't match the server. - External changing data without sending a snapshot of it along with the HTML. - Invalid HTML tag nesting.{'\n'} It can also happen if the client has a browser extension installed which messes with the HTML before React loaded.{'\n'} <a href="https://react.dev/link/hydration-mismatch">https://react.dev/link/hydration-mismatch</a> {'\n'} {' '}&#x3C;App> {' '}&#x3C;span> {'+ '}Client {'- '}Server{'\n'} {' '}at throwOnHydrationMismatch {' '}...</p></consolelogline></consoleblockmulti></section><section class="level3"aria-labelledby="-がプロバイダに-context-as-a-provider"><h3 id="-がプロバイダに-context-as-a-provider"><code>&#x3C;Context></code> がプロバイダに {/<em>context-as-a-provider</em>/}</h3><p>React 19 では、<code>&#x3C;Context.Provider></code> の代わりに <code>&#x3C;Context></code> をプロバイダとしてレンダーできます。<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token maybe-class-name">ThemeContext</span> <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>children<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ThemeContext</span> value<span class="token operator">=</span><span class="token string">"dark"</span><span class="token operator">></span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">ThemeContext</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span></code></pre><p>新しいコンテクストプロバイダは <code>&#x3C;Context></code> のように使用できるため、既存のプロバイダを変換するための codemod を公開する予定です。将来のバージョンでは <code>&#x3C;Context.Provider></code> を非推奨にする予定です。</section><section class="level3"aria-labelledby="ref-用のクリーンアップ関数-cleanup-functions-for-refs"><h3 id="ref-用のクリーンアップ関数-cleanup-functions-for-refs">ref 用のクリーンアップ関数 {/<em>cleanup-functions-for-refs</em>/}</h3><p><code>ref</code> コールバックからクリーンアップ関数を返すことがサポートされるようになりました。<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span>input
  ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">ref</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// ref created</span>

    <span class="token comment">// NEW: return a cleanup function to reset</span>
    <span class="token comment">// the ref when element is removed from DOM.</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// ref cleanup</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">/</span><span class="token operator">></span></code></pre><p>コンポーネントがアンマウントされると、React は <code>ref</code> コールバックから返されたクリーンアップ関数を呼び出します。これは DOM への ref、クラスコンポーネントへの ref、および <code>useImperativeHandle</code> のいずれに対しても機能します。</p><note><p>これまで、React はコンポーネントのアンマウント時に <code>ref</code> に渡された関数を <code>null</code> を引数にして呼び出していました。<code>ref</code> がクリーンアップ関数を返す場合、React はこのステップをスキップするようになります。<p>将来のバージョンでは、コンポーネントのアンマウント時に ref が <code>null</code> を引数に呼び出される動作は、非推奨になる予定です。</p></note><p>ref クリーンアップ関数の導入により、<code>ref</code> コールバックからそれ以外のものを返すことは TypeScript によって拒否されるようになりました。通常、これは暗黙の return をやめることで修正できます。例えば以下のようにします。<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> &#x3C;div ref={current => (instance = current)} />
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> &#x3C;div ref={current => {instance = current}} /></span></span></code></pre><p>元のコードは <code>HTMLDivElement</code> のインスタンスを返していますが、TypeScript はこれがクリーンアップ関数を返すつもりでミスをしたのか、クリーンアップ関数を返したくないのか判断できないのです。<p>このパターンは <a href="https://github.com/eps1lon/types-react-codemod/#no-implicit-ref-callback-return"><code>no-implicit-ref-callback-return</code></a> の codemod を用いて修正できます。</section><section class="level3"aria-labelledby="usedeferredvalue-の初期値-use-deferred-value-initial-value"><h3 id="usedeferredvalue-の初期値-use-deferred-value-initial-value"><code>useDeferredValue</code> の初期値 {/<em>use-deferred-value-initial-value</em>/}</h3><p><code>useDeferredValue</code> に <code>initialValue</code> オプションを追加しました。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Search</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>deferredValue<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// On initial render the value is ''.</span>
  <span class="token comment">// Then a re-render is scheduled with the deferredValue.</span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">useDeferredValue</span><span class="token punctuation">(</span>deferredValue<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Results</span> query<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><codestep step="{2}">initialValue</codestep>が指定された場合、<code>useDeferredValue</code> はコンポーネントの初期レンダーの際にそれを <code>value</code> として返し、バックグラウンドで<codestep step="{1}">deferredValue</codestep>を返すための再レンダーをスケジュールします。<p>詳細については、<a href="/reference/react/useDeferredValue"><code>useDeferredValue</code></a> をご覧ください。</section><section class="level3"aria-labelledby="ドキュメントメタデータのサポート-support-for-metadata-tags"><h3 id="ドキュメントメタデータのサポート-support-for-metadata-tags">ドキュメントメタデータのサポート {/<em>support-for-metadata-tags</em>/}</h3><p>HTML では、<code>&#x3C;title></code>、<code>&#x3C;link></code>、<code>&#x3C;meta></code> などのドキュメントメタデータタグは、ドキュメントの <code>&#x3C;head></code> セクションに配置されるよう決まっています。しかし React では、アプリに必要なメタデータを決めるコンポーネントが <code>&#x3C;head></code> をレンダーしている場所から非常に遠いことや、そもそも React が <code>&#x3C;head></code> をレンダーしないことがあります。過去には、これらの要素をエフェクトで手動で挿入するか <a href="https://github.com/nfl/react-helmet"><code>react-helmet</code></a> のようなライブラリを使用しつつ、React アプリケーションをサーバでレンダーする際に特別な注意を払う必要がありました。<p>React 19 では、コンポーネントでドキュメントメタデータタグをレンダーするネイティブのサポートを追加しました。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">BlogPost</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>post<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>article<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token punctuation">{</span>post<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>title<span class="token operator">></span><span class="token punctuation">{</span>post<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>title<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>meta name<span class="token operator">=</span><span class="token string">"author"</span> content<span class="token operator">=</span><span class="token string">"Josh"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>link rel<span class="token operator">=</span><span class="token string">"author"</span> href<span class="token operator">=</span><span class="token string">"https://twitter.com/joshcstory/"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>meta name<span class="token operator">=</span><span class="token string">"keywords"</span> content<span class="token operator">=</span><span class="token punctuation">{</span>post<span class="token punctuation">.</span><span class="token property-access">keywords</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Eee</span> equals em<span class="token operator">-</span>see<span class="token operator">-</span>squared<span class="token spread operator">...</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>article<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>React がこのコンポーネントをレンダーする際、<code>&#x3C;title></code>、<code>&#x3C;link></code>、<code>&#x3C;meta></code> タグを認識し、自動的にドキュメントの <code>&#x3C;head></code> セクションに移動させます。これらのメタデータタグをネイティブにサポートすることで、クライアントのみのアプリ、ストリーミング SSR、サーバコンポーネントのいずれでも動作することを保証できます。</p><note><section class="level4"aria-labelledby="メタデータライブラリはまだ必要-you-may-still-want-a-metadata-library"><h4 id="メタデータライブラリはまだ必要-you-may-still-want-a-metadata-library">メタデータライブラリはまだ必要 {/<em>you-may-still-want-a-metadata-library</em>/}</h4><p>単純なユースケースでは、タグとしてドキュメントメタデータをレンダーするので十分でしょうが、ライブラリは現在のルートに基づいて汎用メタデータを個別のメタデータで上書きするといった、より強力な機能を提供できます。これらの機能は、フレームワークや <a href="https://github.com/nfl/react-helmet"><code>react-helmet</code></a> のようなライブラリがメタデータタグをサポートしやすくするためのものであり、これらを置き換えるものではありません。</section></note><p>詳細については <a href="/reference/react-dom/components/title"><code>&#x3C;title></code></a>、<a href="/reference/react-dom/components/link"><code>&#x3C;link></code></a>、<a href="/reference/react-dom/components/meta"><code>&#x3C;meta></code></a> のドキュメントをご覧ください。</section><section class="level3"aria-labelledby="スタイルシートのサポート-support-for-stylesheets"><h3 id="スタイルシートのサポート-support-for-stylesheets">スタイルシートのサポート {/<em>support-for-stylesheets</em>/}</h3><p>スタイルシートには優先順位に関するルールがあるため、外部リンク (<code>&#x3C;link rel="stylesheet" href="..."></code>) される場合でもインライン (<code>&#x3C;style>...&#x3C;/style></code>) の場合でも、DOM 内での配置を慎重に考える必要があります。コンポーネントのコンポジション能力を保ちつつ、コンポーネント内でスタイルシート機能を構築することは困難です。そのためユーザはよく、スタイルに依存するコンポーネントから遠く離れた場所でスタイルをまとめてロードするか、この複雑さをカプセル化するスタイルライブラリを使用する必要がありました。<p>React 19 では、スタイルシートに対する組み込みのサポートを提供することでこの複雑さに対処し、またクライアントにおける並行レンダー機能やサーバにおけるストリーミングレンダー機能との深い統合を行います。スタイルシートの <code>precedence</code>（優先度）を React に伝えることで、スタイルシートの DOM への挿入順序を管理し、また外部スタイルシートの場合はそれがロードされてからそのスタイルルールに依存するコンテンツが表示されるよう保証します。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ComponentOne</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token string">"loading..."</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"foo"</span> precedence<span class="token operator">=</span><span class="token string">"default"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"bar"</span> precedence<span class="token operator">=</span><span class="token string">"high"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>article <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"foo-class bar-class"</span><span class="token operator">></span>
        <span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>article<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ComponentTwo</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"baz"</span> precedence<span class="token operator">=</span><span class="token string">"default"</span> <span class="token operator">/</span><span class="token operator">></span>  <span class="token operator">&#x3C;</span><span class="token operator">--</span> will be inserted between foo <span class="token operator">&#x26;</span> bar
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><p>サーバサイドレンダリングの場合、React は <code>&#x3C;head></code> にスタイルシートを含めることで、それをブラウザがロードするまで描画が起きないことを保証します。ストリーミングを既に開始した後でスタイルシートが見つかった場合でも、React はサスペンスバウンダリ内でスタイルシートに依存するコンテンツが表示される前に、クライアントの <code>&#x3C;head></code> にそのスタイルシートが挿入されることを保証します。<p>クライアントサイドレンダリングの場合、React は新しくレンダーされたスタイルシートが読み込まれるのを待ってからレンダーをコミットします。そのコンポーネントをアプリケーション内の複数の場所からレンダーする場合でも、React はドキュメントにスタイルシートを一度だけ挿入します。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ComponentOne</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token spread operator">...</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ComponentOne</span> <span class="token operator">/</span><span class="token operator">></span> <span class="token comment">// won't lead to a duplicate stylesheet link in the DOM</span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">}</span></code></pre><p>スタイルシートを手動で読み込むことに慣れているユーザにとっては、これはスタイルシートをそれに依存するコンポーネントの隣に配置することで局所的な理解をしやすくできる機会となり、また実際に使用するスタイルシートのみが読み込まれることを保証しやすくなるでしょう。<p>スタイル関連ライブラリやバンドラ統合のスタイル機能もこの新しい機能を採用できるため、自分でスタイルシートを直接レンダーしない場合でも、ツールがこの機能を使用するようにアップグレードされるにつれ、やはりメリットを享受できるようになるでしょう。<p>詳細については、<a href="/reference/react-dom/components/link"><code>&#x3C;link></code></a> と <a href="/reference/react-dom/components/style"><code>&#x3C;style></code></a> のドキュメントを参照してください。</section><section class="level3"aria-labelledby="非同期スクリプトのサポート-support-for-async-scripts"><h3 id="非同期スクリプトのサポート-support-for-async-scripts">非同期スクリプトのサポート {/<em>support-for-async-scripts</em>/}</h3><p>HTML では通常のスクリプト (<code>&#x3C;script src="..."></code>) と遅延スクリプト (<code>&#x3C;script defer="" src="..."></code>) はドキュメントの順序で読み込まれるため、コンポーネントツリーの深い部分でこれらのスクリプトをレンダーすることは困難です。しかし、非同期スクリプト (<code>&#x3C;script async="" src="..."></code>) は任意の順序で読み込まれます。<p>React 19 では、非同期スクリプトのサポートを拡充し、ツリーのどこにあっても、スクリプトを実際に使用するコンポーネント内でそれをレンダーできるようにします。これにより、スクリプトインスタンスの移動や重複解消処理の管理が不要になります。<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>script async<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span> src<span class="token operator">=</span><span class="token string">"..."</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token maybe-class-name">Hello</span> <span class="token maybe-class-name">World</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">&#x3C;</span>html<span class="token operator">></span>
    <span class="token operator">&#x3C;</span>body<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MyComponent</span><span class="token operator">></span>
      <span class="token spread operator">...</span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MyComponent</span><span class="token operator">></span> <span class="token comment">// won't lead to duplicate script in the DOM</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>body<span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span>html<span class="token operator">></span>
<span class="token punctuation">}</span></code></pre><p>すべてのレンダー環境で非同期スクリプトの重複解消処理が行われます。複数の異なるコンポーネントが同じスクリプトをレンダーしている場合でも、React はそれを一度だけ読み込み、実行します。<p>サーバサイドレンダリングでは、非同期スクリプトは <code>&#x3C;head></code> に挿入され、描画をブロックするスタイルシート・フォント・画像プリロードなどのより重要なリソースよりも低優先度で処理されます。<p>詳細については、<a href="/reference/react-dom/components/script"><code>&#x3C;script></code></a> のドキュメントを参照してください。</section><section class="level3"aria-labelledby="リソースのプリロードのサポート-support-for-preloading-resources"><h3 id="リソースのプリロードのサポート-support-for-preloading-resources">リソースのプリロードのサポート {/<em>support-for-preloading-resources</em>/}</h3><p>ドキュメントの初期読み込み時やクライアントでの画面更新時に、今後必要になりそうなリソースについてブラウザに可能な限り早く知らせておくことは、ページのパフォーマンスに劇的な影響を与えることがあります。<p>React 19 には、リソースの読み込みやプリロードのための新しい API が多数含まれています。非効率的なリソース読み込みによって阻害されることのない素晴らしいユーザ体験を、できるだけ容易に構築できるようになっています。<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> prefetchDNS<span class="token punctuation">,</span> preconnect<span class="token punctuation">,</span> preload<span class="token punctuation">,</span> preinit <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">preinit</span><span class="token punctuation">(</span><span class="token string">'https://.../path/to/some/script.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword module">as</span><span class="token operator">:</span> <span class="token string">'script'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// loads and executes this script eagerly</span>
  <span class="token function">preload</span><span class="token punctuation">(</span><span class="token string">'https://.../path/to/font.woff'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword module">as</span><span class="token operator">:</span> <span class="token string">'font'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// preloads this font</span>
  <span class="token function">preload</span><span class="token punctuation">(</span><span class="token string">'https://.../path/to/stylesheet.css'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword module">as</span><span class="token operator">:</span> <span class="token string">'style'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// preloads this stylesheet</span>
  <span class="token function">prefetchDNS</span><span class="token punctuation">(</span><span class="token string">'https://...'</span><span class="token punctuation">)</span> <span class="token comment">// when you may not actually request anything from this host</span>
  <span class="token function">preconnect</span><span class="token punctuation">(</span><span class="token string">'https://...'</span><span class="token punctuation">)</span> <span class="token comment">// when you will request something but aren't sure what</span>
<span class="token punctuation">}</span></code></pre><pre class="language-html"><code class="language-html"><span class="token comment">&#x3C;!-- the above would result in the following DOM/HTML --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>head</span><span class="token punctuation">></span></span>
    <span class="token comment">&#x3C;!-- links/scripts are prioritized by their utility to early loading, not call order --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prefetch-dns<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://...<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preconnect<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://...<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>font<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://.../path/to/font.woff<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>style<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://.../path/to/stylesheet.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span> <span class="token attr-name">async</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://.../path/to/some/script.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>body</span><span class="token punctuation">></span></span>
    ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>これらの API は、フォントなどのリソースをスタイルシート外に移動させて早期に発見できるようにすることで、ページの初期ロードを最適化するために利用できます。また、予想されるナビゲーションに応じて必要となるリソースのリストを先読みし、クリックあるいはホバー時に早期にプリロードを始めることで、クライアントでの更新を高速化することもできるでしょう。<p>詳細については、<a href="/reference/react-dom#resource-preloading-apis">リソースプリロード API</a> を参照してください。</section><section class="level3"aria-labelledby="サードパーティのスクリプトおよび拡張機能との互換性改善-compatibility-with-third-party-scripts-and-extensions"><h3 id="サードパーティのスクリプトおよび拡張機能との互換性改善-compatibility-with-third-party-scripts-and-extensions">サードパーティのスクリプトおよび拡張機能との互換性改善 {/<em>compatibility-with-third-party-scripts-and-extensions</em>/}</h3><p>サードパーティのスクリプトやブラウザ拡張機能の存在を考慮し、ハイドレーションの改善を行いました。<p>ハイドレーション時に、クライアントでレンダーされた要素がサーバから届いた HTML に書かれた要素と一致しない場合、React は強制的にクライアントで再レンダーを行って内容を修正します。これまで、サードパーティのスクリプトやブラウザ拡張機能によって何らかの要素が挿入された場合、不一致エラーとクライアントレンダーを引き起こしていました。<p>React 19 では、<code>&#x3C;head></code> および <code>&#x3C;body></code> 内にある予期しないタグをスキップし、不一致エラーが回避されるようになります。それ以外のハイドレーションの不一致によりドキュメント全体を再レンダーする必要がある場合でも、サードパーティのスクリプトやブラウザ拡張機能によって挿入された既存のスタイルシートはそのままにします。</section><section class="level3"aria-labelledby="エラー報告の改善-error-handling"><h3 id="エラー報告の改善-error-handling">エラー報告の改善 {/<em>error-handling</em>/}</h3><p>React 19 ではエラー処理を改善して重複エラーを削減しており、またキャッチされたエラーとキャッチされなかったエラーのそれぞれに対する処理オプションを提供します。たとえば、レンダー中にエラーが発生しエラーバウンダリでキャッチされた場合、これまで React ではそのエラーを 2 回スロー（1 回は元のエラー、もう 1 回は自動回復に失敗した後）し、その後エラーが発生した場所について <code>console.error</code> に記録していました。<p>これにより、キャッチされるエラーごとに以下のような 3 つのエラーが発生していました。</p><consoleblockmulti><consolelogline level="error"><p>Uncaught Error: hit {' '}at Throws {' '}at renderWithHooks {' '}...</p></consolelogline><consolelogline level="error"><p>Uncaught Error: hit<span class="ms-2 text-gray-30">{' &#x3C;--'} Duplicate</span> {' '}at Throws {' '}at renderWithHooks {' '}...</p></consolelogline><consolelogline level="error"><p>The above error occurred in the Throws component: {' '}at Throws {' '}at ErrorBoundary {' '}at App{'\n'} React will try to recreate this component tree from scratch using the error boundary you provided, ErrorBoundary.</p></consolelogline></consoleblockmulti><p>React 19 では、すべてのエラー情報を含む単一のエラーをログに記録します。</p><consoleblockmulti><consolelogline level="error"><p>Error: hit {' '}at Throws {' '}at renderWithHooks {' '}...{'\n'} The above error occurred in the Throws component: {' '}at Throws {' '}at ErrorBoundary {' '}at App{'\n'} React will try to recreate this component tree from scratch using the error boundary you provided, ErrorBoundary. {' '}at ErrorBoundary {' '}at App</p></consolelogline></consoleblockmulti><p>さらに、<code>onRecoverableError</code> を補完するために 2 つの新しいルートオプションを追加しました。<ul><li><code>onCaughtError</code>：エラーバウンダリで React がエラーをキャッチしたときに呼び出されます。<li><code>onUncaughtError</code>：エラーがスローされたがエラーバウンダリでキャッチされなかった場合に呼び出されます。<li><code>onRecoverableError</code>：エラーがスローされ、自動的に回復されたときに呼び出されます。</ul><p>詳細と例については、<a href="/reference/react-dom/client/createRoot"><code>createRoot</code></a> および <a href="/reference/react-dom/client/hydrateRoot"><code>hydrateRoot</code></a> のドキュメントを参照してください。</section><section class="level3"aria-labelledby="カスタム要素のサポート-support-for-custom-elements"><h3 id="カスタム要素のサポート-support-for-custom-elements">カスタム要素のサポート {/<em>support-for-custom-elements</em>/}</h3><p>React 19 はカスタム要素を完全にサポートし、<a href="https://custom-elements-everywhere.com/">Custom Elements Everywhere</a> のすべてのテストに合格しました。<p>過去のバージョンの React では、認識されない props を要素のプロパティではなく属性として扱っていたため、カスタム要素を使用することが困難でした。React 19 では、以下の戦略に従って、クライアントと SSR の両方で機能するプロパティがサポートされるようになります。<ul><li><strong>サーバサイドレンダリング</strong>：カスタム要素に渡される props は、その型が <code>string</code>、<code>number</code> のようなプリミティブである場合や値が <code>true</code> である場合、属性としてレンダーされる。<code>object</code>、<code>symbol</code>、<code>function</code> のような非プリミティブ値である場合や値が <code>false</code> である場合、その props は無視される。<li><strong>クライアントサイドレンダリング</strong>：カスタム要素のインスタンスのプロパティに一致する props はプロパティとして割り当てられ、それ以外の場合は属性として割り当てられる。</ul><p>React におけるカスタム要素のサポートに関し、設計と実装を推進した <a href="https://github.com/josepharhar">Joey Arhar</a> に感謝します。<section class="level4"aria-labelledby="アップグレード方法-how-to-upgrade"><h4 id="アップグレード方法-how-to-upgrade">アップグレード方法 {/<em>how-to-upgrade</em>/}</h4><p>アップグレードに関するステップバイステップのガイドや、重要な変更点の完全なリストについては、<a href="/blog/2024/04/25/react-19-upgrade-guide">React 19 アップグレードガイド</a>を参照してください。<p><span style="float:footnote"><a href="../../../../index.html#toc">Go to TOC</a></span></section></section></section></section>