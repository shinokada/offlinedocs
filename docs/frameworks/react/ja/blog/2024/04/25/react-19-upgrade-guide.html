<!doctype html><html lang="ja"><meta charset="utf-8"><title>"React 19 RC アップグレードガイド"</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="react-19-rc-アップグレードガイド"><h1 id="react-19-rc-アップグレードガイド">"React 19 RC アップグレードガイド"</h1><p>author: Ricky Hanlon date: 2024/04/25 description: React 19 に追加された改善にはいくつかの破壊的変更が必要ですが、アップグレードをできるだけスムーズに行えるよう努力しているため、ほとんどのアプリには影響が出ないことを予想しています。この投稿では、アプリやライブラリを React 19 にアップグレードする手順をご案内します。<p>April 25, 2024 by <a href="https://twitter.com/rickhanlonii">Ricky Hanlon</a></p><intro><p>React 19 に追加された改善にはいくつかの破壊的変更が必要ですが、アップグレードをできるだけスムーズに行えるよう努力しているため、ほとんどのアプリには影響が出ないことを予想しています。</p></intro><note><section class="level4"aria-labelledby="react-183-も公開されました-react-18-3"><h4 id="react-183-も公開されました-react-18-3">React 18.3 も公開されました {/<em>react-18-3</em>/}</h4><p>React 19 へのアップグレードを容易にするため、<code>react@18.3</code> リリースを公開しました。これは 18.2 とほぼ同一ですが、非推奨化 API や React 19 に向けて必要なその他の変更に対する警告が追加されています。<p>React 19 にアップグレードする前に、問題点を見つけるためにまず React 18.3 にアップグレードすることをお勧めします。<p>18.3 における変更点については、<a href="https://github.com/facebook/react/blob/main/CHANGELOG.md">リリースノート</a>をご覧ください。</section></note><p>この投稿では、React 19 にアップグレードする手順をご案内します。<ul><li><a href="#installing">インストール</a><li><a href="#codemods">Codemod</a><li><a href="#breaking-changes">破壊的変更</a><li><a href="#new-deprecations">新たな非推奨化</a><li><a href="#notable-changes">注目すべき変更点</a><li><a href="#typescript-changes">TypeScript 関連の変更</a><li><a href="#changelog">Changelog</a></ul><p>React 19 をテストしていただける方は、このアップグレードガイドに従い、遭遇した<a href="https://github.com/facebook/react/issues/new?assignees=&#x26;labels=React+19&#x26;projects=&#x26;template=19.md&#x26;title=%5BReact+19%5D">問題を報告</a>してください。React 19 に追加された新機能のリストについては、<a href="/blog/2024/04/25/react-19">React 19 リリースのお知らせ</a>をご覧ください。<section class="level2"aria-labelledby="インストール-installing"><h2 id="インストール-installing">インストール {/<em>installing</em>/}</h2><note><section class="level4"aria-labelledby="新しい-jsx-トランスフォームの必須化-new-jsx-transform-is-now-required"><h4 id="新しい-jsx-トランスフォームの必須化-new-jsx-transform-is-now-required">新しい JSX トランスフォームの必須化 {/<em>new-jsx-transform-is-now-required</em>/}</h4><p>2020 年に、バンドルサイズを改善し、React をインポートせずに JSX を使用できるようにするための<a href="https://legacy.reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html">新しい JSX トランスフォーム</a>を導入しました。React 19 では、ref を props として使用できるようにしたり JSX の速度を向上させたりといった追加の改善を行っており、これらには新しいトランスフォームが必須です。<p>新しいトランスフォームが有効になっていない場合、次の警告が表示されます。</p><consoleblockmulti><consolelogline level="error"><p>Your app (or one of its dependencies) is using an outdated JSX transform. Update to the modern JSX transform for faster performance: <a href="https://react.dev/link/new-jsx-transform">https://react.dev/link/new-jsx-transform</a></p></consolelogline></consoleblockmulti><p>ほとんどの環境ではこのトランスフォームがすでに有効になっているため、ほとんどのアプリは影響を受けないと予想されます。手動でアップグレードする方法については、<a href="https://legacy.reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html">告知記事</a>をご覧ください。</section></note><p>React と React DOM の最新バージョンをインストールするには以下のようにします。<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-exact react@rc react-dom@rc</code></pre><p>Yarn をお使いの場合は以下のようにします。<pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> --exact react@rc react-dom@rc</code></pre><p>TypeScript を使用している場合は、型も更新する必要があります。React 19 が安定版としてリリースされた後は、通常通り <code>@types/react</code> と <code>@types/react-dom</code> から型をインストールできます。安定版になるまでは <code>package.json</code> で強制的に別のパッケージを指定することで、新しい型を利用できます。<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"@types/react"</span><span class="token operator">:</span> <span class="token string">"npm:types-react@rc"</span><span class="token punctuation">,</span>
    <span class="token property">"@types/react-dom"</span><span class="token operator">:</span> <span class="token string">"npm:types-react-dom@rc"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"overrides"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"@types/react"</span><span class="token operator">:</span> <span class="token string">"npm:types-react@rc"</span><span class="token punctuation">,</span>
    <span class="token property">"@types/react-dom"</span><span class="token operator">:</span> <span class="token string">"npm:types-react-dom@rc"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>また、最も一般的な書き換えのための codemod も含まれています。下記の <a href="#typescript-changes">TypeScript 関連の変更</a>を参照してください。</section><section class="level2"aria-labelledby="codemod-codemods"><h2 id="codemod-codemods">codemod {/<em>codemods</em>/}</h2><p>アップグレードを支援するため、<a href="https://codemod.com">codemod.com</a> のチームと協力し、React 19 の新しい API やパターンにコードを自動的に更新するための codemod を公開しました。<p>すべての codemod は <a href="https://github.com/reactjs/react-codemod"><code>react-codemod</code> リポジトリ</a>で利用可能であり、Codemod チームも codemod の保守に参加しています。これらの codemod を実行するには、<code>react-codemod</code> コマンドではなく <code>codemod</code> コマンドの使用をお勧めします。こちらのコマンドの方が高速に実行され、複雑なコードの移行を処理でき、TypeScript のサポートもより良好です。</p><note><section class="level4"aria-labelledby="react-19-関連の-codemod-をすべて実行-run-all-react-19-codemods"><h4 id="react-19-関連の-codemod-をすべて実行-run-all-react-19-codemods">React 19 関連の codemod をすべて実行 {/<em>run-all-react-19-codemods</em>/}</h4><p>このガイドにある codemode をすべて実行するには React 19 の <code>codemod</code> レシピを以下のように実行します。<pre class="language-bash"><code class="language-bash">npx codemod@latest react/19/migration-recipe</code></pre><p>これにより以下の <code>react-codemod</code> の codemod が実行されます。<ul><li><a href="https://github.com/reactjs/react-codemod?tab=readme-ov-file#replace-reactdom-render"><code>replace-reactdom-render</code></a><li><a href="https://github.com/reactjs/react-codemod?tab=readme-ov-file#replace-string-ref"><code>replace-string-ref</code></a><li><a href="https://github.com/reactjs/react-codemod?tab=readme-ov-file#replace-act-import"><code>replace-act-import</code></a><li><a href="https://github.com/reactjs/react-codemod?tab=readme-ov-file#replace-use-form-state"><code>replace-use-form-state</code></a><li><a href="TODO"><code>prop-types-typescript</code></a></ul><p>これには TypeScript 関連の変更は含まれていません。以下の <a href="#typescript-changes">TypeScript 関連の変更</a>を参照してください。</section></note><p>変更のうち codemod が利用できるものは以下で紹介されています。<p>利用可能なすべての codemod の一覧については、<a href="https://github.com/reactjs/react-codemod"><code>react-codemod</code> リポジトリ</a>を参照してください。</section><section class="level2"aria-labelledby="破壊的変更-breaking-changes"><h2 id="破壊的変更-breaking-changes">破壊的変更 {/<em>breaking-changes</em>/}</h2><section class="level3"aria-labelledby="レンダー中のエラーは再スローされない-errors-in-render-are-not-re-thrown"><h3 id="レンダー中のエラーは再スローされない-errors-in-render-are-not-re-thrown">レンダー中のエラーは再スローされない {/<em>errors-in-render-are-not-re-thrown</em>/}</h3><p>これまでのバージョンの React では、レンダー中にスローされたエラーはキャッチされた後に再スローされていました。開発環境では、<code>console.error</code> にもログを出力していたため、エラーログの重複が発生していました。<p>React 19 では、重複を減らすためにエラーの扱いを<a href="/blog/2024/04/25/react-19#error-handling">改善し</a>、再スローは行わないようになりました。<ul><li><strong>キャッチされないエラー</strong>：エラーバウンダリによってキャッチされないエラーは <code>window.reportError</code> に報告されます。<li><strong>キャッチされたエラー</strong>：エラーバウンダリによってキャッチされたエラーは <code>console.error</code> に報告されます。</ul><p>この変更はほとんどのアプリに影響を与えないはずですが、本番環境におけるエラーレポートシステムが再スローの挙動に依存している場合は、エラー処理を更新する必要があります。これをサポートするために、カスタムのエラー処理を行うための新しい手段を <code>createRoot</code> と <code>hydrateRoot</code> に追加しました。<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">createRoot</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">onUncaughtError</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> errorInfo</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// ... log error report</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onCaughtError</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> errorInfo</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// ... log error report</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>詳細は、<a href="https://react.dev/reference/react-dom/client/createRoot"><code>createRoot</code></a> と <a href="https://react.dev/reference/react-dom/client/hydrateRoot"><code>hydrateRoot</code></a> のドキュメントを参照してください。</section><section class="level3"aria-labelledby="非推奨化-react-api-の削除-removed-deprecated-react-apis"><h3 id="非推奨化-react-api-の削除-removed-deprecated-react-apis">非推奨化 React API の削除 {/<em>removed-deprecated-react-apis</em>/}</h3><section class="level4"aria-labelledby="廃止関数コンポーネントの-proptypes-と-defaultprops-removed-proptypes-and-defaultprops"><h4 id="廃止関数コンポーネントの-proptypes-と-defaultprops-removed-proptypes-and-defaultprops">廃止：関数コンポーネントの <code>propTypes</code> と <code>defaultProps</code> {/<em>removed-proptypes-and-defaultprops</em>/}</h4><p><code>PropTypes</code> は <a href="https://legacy.reactjs.org/blog/2017/04/07/react-v15.5.0.html#new-deprecation-warnings">2017 年 4 月 (v15.5.0)</a> に非推奨化されました。<p>React 19 では、React パッケージから <code>propTypes</code> チェックが削除されており、使用しても無視されるようになります。<code>propTypes</code> を使用している場合は、TypeScript または他の型チェックソリューションへの移行をお勧めします。<p>また、関数コンポーネントから <code>defaultProps</code> を削除します。ES6 のデフォルトパラメータを代わりに使用してください。クラスコンポーネントでは ES6 による代替手段がないため、<code>defaultProps</code> を引き続きサポートします。<pre class="language-js"><code class="language-js"><span class="token comment">// Before</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">PropTypes</span></span> <span class="token keyword module">from</span> <span class="token string">'prop-types'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Heading</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>text<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token maybe-class-name">Heading</span><span class="token punctuation">.</span><span class="token property-access">propTypes</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token maybe-class-name">PropTypes</span><span class="token punctuation">.</span><span class="token property-access">string</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">Heading</span><span class="token punctuation">.</span><span class="token property-access">defaultProps</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'Hello, world!'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><pre class="language-ts"><code class="language-ts"><span class="token comment">// After</span>
<span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">Props</span></span> <span class="token punctuation">{</span>
  text<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Heading</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>text <span class="token operator">=</span> <span class="token string">'Hello, world!'</span><span class="token punctuation">}</span><span class="token operator">:</span> <span class="token maybe-class-name">Props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><note><p>codemod で以下のように <code>propTypes</code> を TypeScript に変換できます。<pre class="language-bash"><code class="language-bash">npx codemod@latest react/prop-types-typescript</code></pre></note></section><section class="level4"aria-labelledby="廃止contexttypes-と-getchildcontext-を使用したレガシーコンテクスト-removed-removing-legacy-context"><h4 id="廃止contexttypes-と-getchildcontext-を使用したレガシーコンテクスト-removed-removing-legacy-context">廃止：<code>contextTypes</code> と <code>getChildContext</code> を使用したレガシーコンテクスト {/<em>removed-removing-legacy-context</em>/}</h4><p>レガシーコンテクストは <a href="https://legacy.reactjs.org/blog/2018/10/23/react-v-16-6.html">2018 年 10 月 (v16.6.0)</a> に非推奨化されました。<p>レガシーコンテクストは、<code>contextTypes</code> と <code>getChildContext</code> を使用するクラスコンポーネントでのみ利用可能であり、見逃しやすい微妙なバグのため、のちに <code>contextType</code> に置き換えられました。React 19 では、React を少し小さく、速くするためにレガシーコンテクストを削除しています。<p>クラスコンポーネントでまだレガシーコンテクストを使用している場合、新しい <code>contextType</code> API に移行する必要があります。<pre class="language-js"><code class="language-js"><span class="token comment">// Before</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">PropTypes</span></span> <span class="token keyword module">from</span> <span class="token string">'prop-types'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> childContextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token maybe-class-name">PropTypes</span><span class="token punctuation">.</span><span class="token property-access">string</span><span class="token punctuation">.</span><span class="token property-access">isRequired</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">getChildContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Child</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> contextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token maybe-class-name">PropTypes</span><span class="token punctuation">.</span><span class="token property-access">string</span><span class="token punctuation">.</span><span class="token property-access">isRequired</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">context</span><span class="token punctuation">.</span><span class="token property-access">foo</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// After</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">FooContext</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">FooContext</span> value<span class="token operator">=</span><span class="token string">'bar'</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Child</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">FooContext</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> contextType <span class="token operator">=</span> <span class="token maybe-class-name">FooContext</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">context</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></section><section class="level4"aria-labelledby="削除文字列形式の-ref-removed-string-refs"><h4 id="削除文字列形式の-ref-removed-string-refs">削除：文字列形式の ref {/<em>removed-string-refs</em>/}</h4><p>文字列形式の ref は <a href="https://legacy.reactjs.org/blog/2018/03/27/update-on-async-rendering.html">2018 年 3 月 (v16.3.0)</a> に非推奨化されました。<p><a href="https://github.com/facebook/react/issues/1373">いくつかの問題</a>のためコールバック形式の ref に置き換えられるまで、クラスコンポーネントは文字列形式の ref をサポートしていました。React 19 では、React をよりシンプルで理解しやすくするため、文字列形式の ref を削除します。<p>クラスコンポーネントでまだ文字列形式の ref を使用している場合は、コールバック形式の ref に移行する必要があります。<pre class="language-js"><code class="language-js"><span class="token comment">// Before</span>
<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">refs</span><span class="token punctuation">.</span><span class="token property-access">input</span><span class="token punctuation">.</span><span class="token method function property-access">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>input ref<span class="token operator">=</span><span class="token string">'input'</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// After</span>
<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">input</span><span class="token punctuation">.</span><span class="token method function property-access">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">input</span> <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">input</span> <span class="token operator">=</span> input<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><note><p>codemod で以下のように文字列形式の ref をコールバック形式の <code>ref</code> に変換できます。<pre class="language-bash"><code class="language-bash">npx codemod@latest react/19/replace-string-ref</code></pre></note></section><section class="level4"aria-labelledby="削除モジュールパターンファクトリ-removed-module-pattern-factories"><h4 id="削除モジュールパターンファクトリ-removed-module-pattern-factories">削除：モジュールパターンファクトリ {/<em>removed-module-pattern-factories</em>/}</h4><p>モジュールパターンファクトリは <a href="https://legacy.reactjs.org/blog/2019/08/08/react-v16.9.0.html#deprecating-module-pattern-factories">2019 年 8 月 (v16.9.0)</a> に非推奨化されました。<p>このパターンはほとんど使用されておらず、サポートすることで React がわずかに大きく、遅くなる原因となっています。React 19 ではモジュールパターンファクトリのサポートが削除されており、通常の関数に移行する必要があります。<pre class="language-js"><code class="language-js"><span class="token comment">// Before</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FactoryComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>div <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// After</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">FactoryComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>div <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></section><section class="level4"aria-labelledby="削除reactcreatefactory-removed-createfactory"><h4 id="削除reactcreatefactory-removed-createfactory">削除：<code>React.createFactory</code> {/<em>removed-createfactory</em>/}</h4><p><code>createFactory</code> は <a href="https://legacy.reactjs.org/blog/2020/02/26/react-v16.13.0.html#deprecating-createfactory">2020 年 2 月 (v16.13.0)</a> に非推奨化されました。<p>JSX が広範にサポートされる以前は <code>createFactory</code> の使用が一般的でしたが、今ではほとんど使用されておらず、JSX に置き換えることができます。React 19 では <code>createFactory</code> が削除されており、JSX に移行する必要があります。<pre class="language-js"><code class="language-js"><span class="token comment">// Before</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createFactory <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> button <span class="token operator">=</span> <span class="token function">createFactory</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// After</span>
<span class="token keyword">const</span> button <span class="token operator">=</span> <span class="token operator">&#x3C;</span>button <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span></code></pre></section><section class="level4"aria-labelledby="削除react-test-renderershallow-removed-react-test-renderer-shallow"><h4 id="削除react-test-renderershallow-removed-react-test-renderer-shallow">削除：<code>react-test-renderer/shallow</code> {/<em>removed-react-test-renderer-shallow</em>/}</h4><p>React 18 において、<code>react-test-renderer/shallow</code> を更新して <a href="https://github.com/enzymejs/react-shallow-renderer">react-shallow-renderer</a> を再エクスポートするようにしていました。React 19 では、<code>react-test-render/shallow</code> が削除されており、代わりにこのパッケージを直接インストールするようになります。<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> react-shallow-renderer --save-dev</code></pre><pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import ShallowRenderer from 'react-test-renderer/shallow';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import ShallowRenderer from 'react-shallow-renderer';</span></span></code></pre><note><section class="level5"aria-labelledby="シャローレンダリングの再考を-please-reconsider-shallow-rendering"><h5 id="シャローレンダリングの再考を-please-reconsider-shallow-rendering">シャローレンダリングの再考を {/<em>please-reconsider-shallow-rendering</em>/}</h5><p>シャローレンダリングは React の内部構造に依存しており、将来のアップグレードの妨げとなる可能性があります。テストを <a href="https://testing-library.com/docs/react-testing-library/intro/">@testing-library/react</a> や <a href="https://testing-library.com/docs/react-native-testing-library/intro">@testing-library/react-native</a> に移行することをお勧めします。</section></note></section></section><section class="level3"aria-labelledby="非推奨化-react-dom-api-の削除-removed-deprecated-react-dom-apis"><h3 id="非推奨化-react-dom-api-の削除-removed-deprecated-react-dom-apis">非推奨化 React DOM API の削除 {/<em>removed-deprecated-react-dom-apis</em>/}</h3><section class="level4"aria-labelledby="削除react-domtest-utils-removed-react-dom-test-utils"><h4 id="削除react-domtest-utils-removed-react-dom-test-utils">削除：<code>react-dom/test-utils</code> {/<em>removed-react-dom-test-utils</em>/}</h4><p><code>act</code> を <code>react-dom/test-utils</code> から <code>react</code> パッケージに移動しました。</p><consoleblockmulti><consolelogline level="error"><p><code>ReactDOMTestUtils.act</code> is deprecated in favor of <code>React.act</code>. Import <code>act</code> from <code>react</code> instead of <code>react-dom/test-utils</code>. See <a href="https://react.dev/warnings/react-dom-test-utils">https://react.dev/warnings/react-dom-test-utils</a> for more info.</p></consolelogline></consoleblockmulti><p>この警告を修正するには、<code>act</code> を <code>react</code> からインポートするようにします。<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import {act} from 'react-dom/test-utils'
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import {act} from 'react';</span></span></code></pre><p>その他の <code>test-utils</code> 関数はすべて削除されました。これらのユーティリティは一般的ではなく、コンポーネントや React の低レベルな内部実装の詳細へ依存しやすくなってしまうものでした。React 19 でこれらの関数を呼び出すとエラーとなります。将来のバージョンではエクスポートが削除されます。<p>代替手段については、<a href="https://react.dev/warnings/react-dom-test-utils">警告ページ</a>をご覧ください。</p><note><p>codemod で以下のように <code>ReactDOMTestUtils.act</code> を <code>React.act</code> に変換できます。<pre class="language-bash"><code class="language-bash">npx codemod@latest react/19/replace-act-import</code></pre></note></section><section class="level4"aria-labelledby="削除reactdomrender-removed-reactdom-render"><h4 id="削除reactdomrender-removed-reactdom-render">削除：<code>ReactDOM.render</code> {/<em>removed-reactdom-render</em>/}</h4><p><code>ReactDOM.render</code> は <a href="https://react.dev/blog/2022/03/08/react-18-upgrade-guide">2022 年 3 月 (v18.0.0)</a> に非推奨化されました。React 19 では <code>ReactDOM.render</code> が削除されており、<a href="https://react.dev/reference/react-dom/client/createRoot"><code>ReactDOM.createRoot</code></a> を使用するよう移行する必要があります。<pre class="language-js"><code class="language-js"><span class="token comment">// Before</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>render<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// After</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>createRoot<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/client'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">createRoot</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><note><p>codemod で以下のように <code>ReactDOM.render</code> を <code>ReactDOMClient.createRoot</code> に変換できます。<pre class="language-bash"><code class="language-bash">npx codemod@latest react/19/replace-reactdom-render</code></pre></note></section><section class="level4"aria-labelledby="削除reactdomhydrate-removed-reactdom-hydrate"><h4 id="削除reactdomhydrate-removed-reactdom-hydrate">削除：<code>ReactDOM.hydrate</code> {/<em>removed-reactdom-hydrate</em>/}</h4><p><code>ReactDOM.hydrate</code> は <a href="https://react.dev/blog/2022/03/08/react-18-upgrade-guide">2022 年 3 月 (v18.0.0)</a> に非推奨化されました。React 19 では <code>ReactDOM.hydrate</code> が削除されており、<a href="https://react.dev/reference/react-dom/client/hydrateRoot"><code>ReactDOM.hydrateRoot</code></a> を使用するよう移行する必要があります。<pre class="language-js"><code class="language-js"><span class="token comment">// Before</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>hydrate<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token function">hydrate</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// After</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>hydrateRoot<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/client'</span><span class="token punctuation">;</span>
<span class="token function">hydrateRoot</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><note><p>codemod で以下のように <code>ReactDOM.hydrate</code> を <code>ReactDOMClient.hydrateRoot</code> に変換できます。<pre class="language-bash"><code class="language-bash">npx codemod@latest react/19/replace-reactdom-render</code></pre></note></section><section class="level4"aria-labelledby="削除unmountcomponentatnode-removed-unmountcomponentatnode"><h4 id="削除unmountcomponentatnode-removed-unmountcomponentatnode">削除：<code>unmountComponentAtNode</code> {/<em>removed-unmountcomponentatnode</em>/}</h4><p><code>ReactDOM.unmountComponentAtNode</code> は <a href="https://react.dev/blog/2022/03/08/react-18-upgrade-guide">2022 年 3 月 (v18.0.0)</a> に非推奨化されました。React 19 では、<code>root.unmount()</code> を使用するよう移行する必要があります。<pre class="language-js"><code class="language-js"><span class="token comment">// Before</span>
<span class="token function">unmountComponentAtNode</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// After</span>
root<span class="token punctuation">.</span><span class="token method function property-access">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>詳細については、<a href="https://react.dev/reference/react-dom/client/createRoot#root-unmount"><code>createRoot</code></a> と <a href="https://react.dev/reference/react-dom/client/hydrateRoot#root-unmount"><code>hydrateRoot</code></a> の <code>root.unmount()</code> をご覧ください。</p><note><p>codemod で以下のように <code>unmountComponentAtNode</code> を <code>root.unmount</code> に変換できます。<pre class="language-bash"><code class="language-bash">npx codemod@latest react/19/replace-reactdom-render</code></pre></note></section><section class="level4"aria-labelledby="削除reactdomfinddomnode-removed-reactdom-finddomnode"><h4 id="削除reactdomfinddomnode-removed-reactdom-finddomnode">削除：<code>ReactDOM.findDOMNode</code> {/<em>removed-reactdom-finddomnode</em>/}</h4><p><code>ReactDOM.findDOMNode</code> は <a href="https://legacy.reactjs.org/blog/2018/10/23/react-v-16-6.html#deprecations-in-strictmode">2018 年 10 月 (v16.6.0)</a> に非推奨化されました。<p><code>findDOMNode</code> はレガシーな避難ハッチであり、実行速度が遅く、リファクタリングが困難で、最初の子要素しか返せず、抽象化レイヤーを破壊するといった問題があるため（詳細は<a href="https://legacy.reactjs.org/docs/strict-mode.html#warning-about-deprecated-finddomnode-usage">こちら</a>）、削除されます。<code>ReactDOM.findDOMNode</code> は <a href="/learn/manipulating-the-dom-with-refs">DOM 用の ref</a> で置き換えることができます。<pre class="language-js"><code class="language-js"><span class="token comment">// Before</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>findDOMNode<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AutoselectingInput</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token function">findDOMNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    input<span class="token punctuation">.</span><span class="token method function property-access">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>input defaultValue<span class="token operator">=</span><span class="token string">"Hello"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// After</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AutoselectingInput</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> defaultValue<span class="token operator">=</span><span class="token string">"Hello"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">}</span></code></pre></section></section></section><section class="level2"aria-labelledby="新たな非推奨化-new-deprecations"><h2 id="新たな非推奨化-new-deprecations">新たな非推奨化 {/<em>new-deprecations</em>/}</h2><section class="level3"aria-labelledby="非推奨化elementref-deprecated-element-ref"><h3 id="非推奨化elementref-deprecated-element-ref">非推奨化：<code>element.ref</code> {/<em>deprecated-element-ref</em>/}</h3><p>React 19 では <a href="/blog/2024/04/25/react-19#ref-as-a-prop">props としての <code>ref</code></a> がサポートされるため、<code>element.ref</code> を非推奨化します。代わりに <code>element.props.ref</code> を使用します。<p><code>element.ref</code> にアクセスすると、以下の警告が表示されます。</p><consoleblockmulti><consolelogline level="error"><p>Accessing element.ref is no longer supported. ref is now a regular prop. It will be removed from the JSX Element type in a future release.</p></consolelogline></consoleblockmulti></section><section class="level3"aria-labelledby="非推奨化react-test-renderer-deprecated-react-test-renderer"><h3 id="非推奨化react-test-renderer-deprecated-react-test-renderer">非推奨化：<code>react-test-renderer</code> {/<em>deprecated-react-test-renderer</em>/}</h3><p><code>react-test-renderer</code> を非推奨化します。これはユーザが使用する環境とは異なる独自のレンダラ環境を実装しており、内部実装の詳細に対するテストを助長し、React 内部の構造に依存するものだからです。<p>このテストレンダラは、<a href="https://testing-library.com">React Testing Library</a> のようなより実用的なテスト戦略が利用可能になる前に作成されたものです。現在では、モダンなテストライブラリの使用が推奨されます。<p>React 19 では、<code>react-test-renderer</code> は非推奨警告をログに記録するようになり、また並行レンダーに切り替わりました。モダンかつよりよくサポートされたテスト体験のためには、テストを <a href="https://testing-library.com/docs/react-testing-library/intro/">@testing-library/react</a> または <a href="https://testing-library.com/docs/react-native-testing-library/intro">@testing-library/react-native</a> に移行することを推奨します。</section></section><section class="level2"aria-labelledby="注目すべき変更点-notable-changes"><h2 id="注目すべき変更点-notable-changes">注目すべき変更点 {/<em>notable-changes</em>/}</h2><section class="level3"aria-labelledby="strictmode-の変更点-strict-mode-improvements"><h3 id="strictmode-の変更点-strict-mode-improvements">StrictMode の変更点 {/<em>strict-mode-improvements</em>/}</h3><p>React 19 には、Strict Mode に関するいくつかの修正と改善が含まれています。<p>開発中に Strict Mode で二重レンダーが発生した際、<code>useMemo</code> と <code>useCallback</code> は 1 回目のレンダー時にメモ化された結果を 2 回目のレンダーで再利用します。既に Strict Mode に対応しているコンポーネントでは、挙動に違いを感じることはないはずです。<p>すべての Strict Mode の挙動と同様、これらの機能は開発中にコンポーネントのバグを積極的に目立たせて、本番環境にリリースされる前に修正できるよう設計されています。例えば、開発環境において Strict Mode は初回マウント時に ref コールバック関数を 2 回呼び出すことで、マウントされたコンポーネントがサスペンスフォールバックに置き換えられたときに何が起こるかをシミュレートします。</section><section class="level3"aria-labelledby="umd-ビルドの削除-umd-builds-removed"><h3 id="umd-ビルドの削除-umd-builds-removed">UMD ビルドの削除 {/<em>umd-builds-removed</em>/}</h3><p>UMD は過去には、ビルドステップなしで React を読み込むための便利な方法として広く使用されていました。現在では、HTML ドキュメント内でスクリプトとしてモジュールをロードするためのモダンな代替手段があります。テストとリリースプロセスの複雑性を軽減するため、React 19 からは UMD ビルドを生成しなくなります。<p>script タグで React 19 をロードしたい場合は、<a href="https://esm.sh/">esm.sh</a> などの ESM ベースの CDN を使用することを推奨します。<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">React</span></span> <span class="token keyword module">from</span> <span class="token string">"https://esm.sh/react@19/?dev"</span>
  <span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ReactDOMClient</span></span> <span class="token keyword module">from</span> <span class="token string">"https://esm.sh/react-dom@19/client?dev"</span>
  <span class="token spread operator">...</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span></code></pre></section><section class="level3"aria-labelledby="react-の内部構造に依存するライブラリはアップグレードできない原因となる-libraries-depending-on-react-internals-may-block-upgrades"><h3 id="react-の内部構造に依存するライブラリはアップグレードできない原因となる-libraries-depending-on-react-internals-may-block-upgrades">React の内部構造に依存するライブラリはアップグレードできない原因となる {/<em>libraries-depending-on-react-internals-may-block-upgrades</em>/}</h3><p>本リリースには、<code>SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED</code> のような内部構造を使用しないようにという私たちのお願いを無視しているライブラリに影響を与える可能性のある React 内部構造の変更が含まれています。これらの変更は React 19 における改善を実現するために必要なものであり、ガイドラインに従っているライブラリには影響を与えません。<p>私たちの<a href="https://react.dev/community/versioning-policy#what-counts-as-a-breaking-change">バージョニングポリシー</a>に基づき、このような更新は破壊的変更としてリストされませんし、アップグレード方法に関するドキュメントも提供されません。内部実装に依存するコードを削除することを推奨します。<p>内部構造を使用する影響を反映するために、<code>SECRET_INTERNALS</code> という接尾辞を以下のように変更します。<p><code>_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE</code><p>将来的には、React の内部構造へのアクセスをより積極的にブロックすることで使用を抑制し、ユーザのアップグレードの妨げとならないようにする予定です。</section></section><section class="level2"aria-labelledby="typescript-関連の変更-typescript-changes"><h2 id="typescript-関連の変更-typescript-changes">TypeScript 関連の変更 {/<em>typescript-changes</em>/}</h2><section class="level3"aria-labelledby="非推奨化-typescript-型を削除-removed-deprecated-typescript-types"><h3 id="非推奨化-typescript-型を削除-removed-deprecated-typescript-types">非推奨化 TypeScript 型を削除 {/<em>removed-deprecated-typescript-types</em>/}</h3><p>React 19 で削除された API に基づいて、TypeScript の型を整理しました。削除された型の一部は、より関連性の高いパッケージに移動され、他の型はもはや React の挙動を記述するために必要がなくなりました。</p><note>型関連の破壊的変更に関する移行のために、[`types-react-codemod`](https://github.com/eps1lon/types-react-codemod/) を公開しました。<pre class="language-bash"><code class="language-bash">npx types-react-codemod@latest preset-19 ./path-to-app</code></pre><p><code>element.props</code> への型安全ではないアクセスを多く行っている場合、以下の追加の codemod を実行できます。<pre class="language-bash"><code class="language-bash">npx types-react-codemod@latest react-element-default-any-props ./path-to-your-react-ts-files</code></pre></note><p>サポートされている書き換えのリストについては、<a href="https://github.com/eps1lon/types-react-codemod/"><code>types-react-codemod</code></a> をご覧ください。codemod が不足していると感じた場合は、<a href="https://github.com/eps1lon/types-react-codemod/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc+label%3A%22React+19%22+label%3Aenhancement">React 19 で不足している codemod のリスト</a>で追跡できます。</section><section class="level3"aria-labelledby="ref-クリーンアップの必須化-ref-cleanup-required"><h3 id="ref-クリーンアップの必須化-ref-cleanup-required"><code>ref</code> クリーンアップの必須化 {/<em>ref-cleanup-required</em>/}</h3><p><em>この変更は、<code>react-19</code> の codemod プリセットに <a href="https://github.com/eps1lon/types-react-codemod/#no-implicit-ref-callback-return"><code>no-implicit-ref-callback-return</code></a> として含まれています。</em><p>ref クリーンアップ関数の導入により、ref コールバックから何か他のものを返すと、TypeScript によって拒否されるようになります。通常、修正は、暗黙の return の使用をやめることです。<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> &#x3C;div ref={current => (instance = current)} />
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> &#x3C;div ref={current => {instance = current}} /></span></span></code></pre><p>元のコードは <code>HTMLDivElement</code> のインスタンスを返していますが、TypeScript はこれがクリーンアップ関数のつもりで書かれたものかどうかを判断できません。</section><section class="level3"aria-labelledby="useref-の引数の必須化-useref-requires-argument"><h3 id="useref-の引数の必須化-useref-requires-argument"><code>useRef</code> の引数の必須化 {/<em>useref-requires-argument</em>/}</h3><p><em>この変更は、<code>react-19</code> のコードモッドプリセットに <a href="https://github.com/eps1lon/types-react-codemod/#refobject-defaults"><code>refobject-defaults</code></a> として含まれています。</em><p>TypeScript と React の動作に関する長年の不満のひとつが <code>useRef</code> でした。今後 <code>useRef</code> には引数が必須になるよう型を変更することにしました。これにより、型シグネチャが大幅に簡素化されます。これで、<code>createContext</code> と同様に動作するようになります。<pre class="language-ts"><code class="language-ts"><span class="token comment">// @ts-expect-error: Expected 1 argument but saw none</span>
<span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Passes</span>
<span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword nil">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// @ts-expect-error: Expected 1 argument but saw none</span>
<span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Passes</span>
<span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword nil">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>これにより、すべての ref はミュータブルになります。<code>null</code> で初期化したために ref を変更できない、という問題で困ることはなくなるでしょう。<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">number</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cannot assign to 'current' because it is a read-only property</span>
ref<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></code></pre><p><code>MutableRef</code> は廃止され、<code>useRef</code> は常に単一の <code>RefObject</code> 型を返すようになりました。<pre class="language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name"><span class="token maybe-class-name">RefObject</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">{</span>
  current<span class="token operator">:</span> <span class="token constant">T</span>
<span class="token punctuation">}</span>

<span class="token keyword">declare</span> <span class="token keyword">function</span> useRef<span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span><span class="token operator">:</span> <span class="token maybe-class-name">RefObject</span><span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span></code></pre><p><code>useRef</code> には便宜上のオーバーロードがまだ存在し、<code>useRef&#x3C;T>(null)</code> は自動的に <code>RefObject&#x3C;T | null></code> を返すようになっています。<code>useRef</code> の引数必須化に対する移行を容易にするために、<code>useRef(undefined)</code> に対する実用的なオーバーロードが追加され、自動的に <code>RefObject&#x3C;T | undefined></code> 型を返すようになります。<p>この変更についてのこれまでの議論は、<a href="https://github.com/DefinitelyTyped/DefinitelyTyped/pull/64772">[RFC] Make all refs mutable</a> をご覧ください。</section><section class="level3"aria-labelledby="reactelement-typescript-型の変更-changes-to-the-reactelement-typescript-type"><h3 id="reactelement-typescript-型の変更-changes-to-the-reactelement-typescript-type"><code>ReactElement</code> TypeScript 型の変更 {/<em>changes-to-the-reactelement-typescript-type</em>/}</h3><p><em>この変更は <a href="https://github.com/eps1lon/types-react-codemod#react-element-default-any-props"><code>react-element-default-any-props</code></a> codemod に含まれています。</em><p>React 要素が <code>ReactElement</code> として型付けされている場合、その <code>props</code> のデフォルトの型は <code>any</code> ではなく <code>unknown</code> になります。<code>ReactElement</code> に型引数を渡している場合は、影響を受けません。<pre class="language-ts"><code class="language-ts"></code></pre><p>しかし、このデフォルトの型に依存していた場合、<code>unknown</code> を扱うようにする必要があります。<pre class="language-ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name"><span class="token maybe-class-name">Example</span></span> <span class="token operator">=</span> <span class="token maybe-class-name">ReactElement</span><span class="token punctuation">[</span><span class="token string">"props"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//   ^? Before, was 'any', now 'unknown'</span></code></pre><p>要素の props に対する型安全でないアクセスに依存している古いコードが多くある場合にのみ、これが必要です。要素の内部構造の参照は避難ハッチとしてのみ存在しており、props に安全でないアクセスを行う場合には、<code>any</code> を明示的に用いてそうであると明示するべきです。</section><section class="level3"aria-labelledby="typescript-における-jsx-名前空間-the-jsx-namespace-in-typescript"><h3 id="typescript-における-jsx-名前空間-the-jsx-namespace-in-typescript">TypeScript における JSX 名前空間 {/<em>the-jsx-namespace-in-typescript</em>/}</h3><p>この変更は <code>react-19</code> codemod プリセットに <a href="https://github.com/eps1lon/types-react-codemod#scoped-jsx"><code>scoped-jsx</code></a> として含まれています。<p>グローバルな <code>JSX</code> 名前空間を型から削除して <code>React.JSX</code> に置き換えるというのは長い間の要望でした。これにより、グローバル型の汚染を防ぎ、JSX を利用する異なる UI ライブラリ間での競合が防止できます。<p>これからは、JSX 名前空間のモジュール拡張 (module augumentation) は <code>declare module "....":</code> でラップする必要があります。<pre class="language-diff"><code class="language-diff">// global.d.ts
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> declare module "react" {
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   namespace JSX {
</span><span class="token prefix unchanged"> </span><span class="token line">     interface IntrinsicElements {
</span><span class="token prefix unchanged"> </span><span class="token line">       "my-element": {
</span><span class="token prefix unchanged"> </span><span class="token line">         myElementProps: string;
</span><span class="token prefix unchanged"> </span><span class="token line">       };
</span><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   }
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> }</span></span></code></pre><p>正確なモジュール指定子は、<code>tsconfig.json</code> の <code>compilerOptions</code> で指定した JSX ランタイムに依存します。<ul><li><code>"jsx": "react-jsx"</code> の場合は <code>react/jsx-runtime</code> です。<li><code>"jsx": "react-jsxdev"</code> の場合は <code>react/jsx-dev-runtime</code> です。<li><code>"jsx": "react"</code> および <code>"jsx": "preserve"</code> の場合は <code>react</code> です。</ul></section><section class="level3"aria-labelledby="usereducer-の型の改善-better-usereducer-typings"><h3 id="usereducer-の型の改善-better-usereducer-typings"><code>useReducer</code> の型の改善 {/<em>better-usereducer-typings</em>/}</h3><p><a href="https://github.com/mfp22">@mfp22</a> の協力により、<code>useReducer</code> の型推論が改善されました。<p>しかしこれには、<code>useReducer</code> がリデューサ全体の型を型パラメータとして受け取る代わりに、型を全く渡さない（型推論に任せる）か、もしくは state の型とアクションの型を両方渡すかのいずれかにする必要がある、という破壊的変更が必要でした。<p>新しいベストプラクティスは、<code>useReducer</code> に型引数を渡さないことです。<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> useReducer&#x3C;React.Reducer&#x3C;State, Action>>(reducer)
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> useReducer(reducer)</span></span></code></pre><p>これは一部の稀なケースでは機能しないかもしれませんが、その場合は state とアクションを明示的に型付けしつつ、<code>Action</code> をタプルで渡すことで解決できます。<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> useReducer&#x3C;React.Reducer&#x3C;State, Action>>(reducer)
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> useReducer&#x3C;State, [Action]>(reducer)</span></span></code></pre><p>リデューサをインラインで定義する場合は、関数パラメータに型注釈を付けることをお勧めします。<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> useReducer&#x3C;React.Reducer&#x3C;State, Action>>((state, action) => state)
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> useReducer((state: State, action: Action) => state)</span></span></code></pre><p>これは、<code>useReducer</code> 呼び出しの外にリデューサを移動する場合にも行うべきでしょう。<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token maybe-class-name">State</span><span class="token punctuation">,</span> action<span class="token operator">:</span> <span class="token maybe-class-name">Action</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> state<span class="token punctuation">;</span></code></pre></section></section><section class="level2"aria-labelledby="changelog-changelog"><h2 id="changelog-changelog">Changelog {/<em>changelog</em>/}</h2><section class="level3"aria-labelledby="その他の破壊的変更-other-breaking-changes"><h3 id="その他の破壊的変更-other-breaking-changes">その他の破壊的変更 {/<em>other-breaking-changes</em>/}</h3><ul><li><strong>react-dom</strong>: src/href での JavaScript URL に対するエラー <a href="https://github.com/facebook/react/pull/26507">#26507</a><li><strong>react-dom</strong>: <code>onRecoverableError</code> から <code>errorInfo.digest</code> を削除 <a href="https://github.com/facebook/react/pull/28222">#28222</a><li><strong>react-dom</strong>: <code>unstable_flushControlled</code> を削除 <a href="https://github.com/facebook/react/pull/26397">#26397</a><li><strong>react-dom</strong>: <code>unstable_createEventHandle</code> を削除 <a href="https://github.com/facebook/react/pull/28271">#28271</a><li><strong>react-dom</strong>: <code>unstable_renderSubtreeIntoContainer</code> を削除 <a href="https://github.com/facebook/react/pull/28271">#28271</a><li><strong>react-dom</strong>: <code>unstable_runWithPrioirty</code> を削除 <a href="https://github.com/facebook/react/pull/28271">#28271</a><li><strong>react-is</strong>: <code>react-is</code> から非推奨のメソッドを削除 <a href="https://github.com/facebook/react/pull/28224">28224</a></ul></section><section class="level3"aria-labelledby="その他の注目すべき変更点-other-notable-changes"><h3 id="その他の注目すべき変更点-other-notable-changes">その他の注目すべき変更点 {/<em>other-notable-changes</em>/}</h3><ul><li><strong>react</strong>: 同期・デフォルト・連続レーンのバッチ処理 <a href="https://github.com/facebook/react/pull/25700">#25700</a><li><strong>react</strong>: サスペンドされたコンポーネントの兄弟を事前レンダーしない <a href="https://github.com/facebook/react/pull/26380">#26380</a><li><strong>react</strong>: レンダーフェーズでの更新によって引き起こされる無限更新ループを検出 <a href="https://github.com/facebook/react/pull/26625">#26625</a><li><strong>react-dom</strong>: popstate でのトランジションを同期的に <a href="https://github.com/facebook/react/pull/26025">#26025</a><li><strong>react-dom</strong>: SSR 中のレイアウトエフェクト警告を削除 <a href="https://github.com/facebook/react/pull/26395">#26395</a><li><strong>react-dom</strong>: src/href に空文字列を設定しないよう警告（アンカータグを除く）<a href="https://github.com/facebook/react/pull/28124">#28124</a></ul><p>React 19 の安定版リリース時に、完全な変更履歴を公開します。<p>この投稿のレビューと編集に協力してくれた <a href="https://twitter.com/acdlite">Andrew Clark</a>、<a href="https://twitter.com/Eli_White">Eli White</a>、<a href="https://github.com/jackpope">Jack Pope</a>、<a href="https://github.com/kassens">Jan Kassens</a>、<a href="https://twitter.com/joshcstory">Josh Story</a>、<a href="https://twitter.com/mattcarrollcode">Matt Carroll</a>、<a href="https://twitter.com/noahlemen">Noah Lemen</a>、<a href="https://twitter.com/sophiebits">Sophie Alpert</a>、そして <a href="https://twitter.com/sebsilbermann">Sebastian Silbermann</a> に感謝します。 <span style="float:footnote"><a href="../../../../index.html#toc">Go to TOC</a></span></section></section></section>