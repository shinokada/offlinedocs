<!doctype html><html lang="ja"><meta charset="utf-8"><title>テストユーティリティ</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="テストユーティリティ"class="level1"><h1>テストユーティリティ</h1><p><strong>インポート</strong><pre class="language-javascript"><code class="language-javascript"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ReactTestUtils</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/test-utils'</span><span class="token punctuation">;</span> <span class="token comment">// ES6</span>
<span class="token keyword">var</span> <span class="token maybe-class-name">ReactTestUtils</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react-dom/test-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ES5 with npm</span></code></pre><section id="overview"class="level2"><h2>概要</h2><p><code>ReactTestUtils</code> はお好みのテストフレームワークで React コンポーネントをテストしやすくするものです。Facebook では快適に JavaScript をテストするために <a href="https://facebook.github.io/jest/">Jest</a> を使用しています。Jest のウェブサイトにある <a href="http://facebook.github.io/jest/docs/en/tutorial-react.html#content">React Tutorial</a> を通して Jest の始め方を学んでください。<blockquote><p>補足:<p><a href="https://testing-library.com/react"><code>react-testing-library</code></a> の使用をおすすめします。これは、エンドユーザがコンポーネントを使用するときと同様の方法でコンポーネントを使用するようなテストを書くことを可能にし、かつそれを促進するように設計されています。<p>バージョン 16 以下の React を使用している場合、<a href="http://airbnb.io/enzyme/">Enzyme</a> ライブラリを使うことで React コンポーネントの出力のアサート、操作、そして横断的な処理を簡単に行えます。</blockquote><ul><li><a href="#act"><code>act()</code></a><li><a href="#mockcomponent"><code>mockComponent()</code></a><li><a href="#iselement"><code>isElement()</code></a><li><a href="#iselementoftype"><code>isElementOfType()</code></a><li><a href="#isdomcomponent"><code>isDOMComponent()</code></a><li><a href="#iscompositecomponent"><code>isCompositeComponent()</code></a><li><a href="#iscompositecomponentwithtype"><code>isCompositeComponentWithType()</code></a><li><a href="#findallinrenderedtree"><code>findAllInRenderedTree()</code></a><li><a href="#scryrendereddomcomponentswithclass"><code>scryRenderedDOMComponentsWithClass()</code></a><li><a href="#findrendereddomcomponentwithclass"><code>findRenderedDOMComponentWithClass()</code></a><li><a href="#scryrendereddomcomponentswithtag"><code>scryRenderedDOMComponentsWithTag()</code></a><li><a href="#findrendereddomcomponentwithtag"><code>findRenderedDOMComponentWithTag()</code></a><li><a href="#scryrenderedcomponentswithtype"><code>scryRenderedComponentsWithType()</code></a><li><a href="#findrenderedcomponentwithtype"><code>findRenderedComponentWithType()</code></a><li><a href="#renderintodocument"><code>renderIntoDocument()</code></a><li><a href="#simulate"><code>Simulate</code></a></ul></section><section id="reference"class="level2"><h2>Reference</h2><section id="act-act"class="level3"><h3><code>act()</code> {#act}</h3><p>アサーション用のコンポーネントを準備するために、それをレンダーして更新を実行するコードを <code>act()</code> でラップします。これにより、テストはブラウザでの React の動作により近い状態で実行されます。<blockquote><p>補足<p><code>react-test-renderer</code> を使っている場合、それはこのメソッドと同じように振舞う <code>act</code> エクスポートも提供します。</blockquote><p>例えば、次のような <code>Counter</code> コンポーネントがあるとしましょう：<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleClick</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">handleClick</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">title</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">title</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">You</span> clicked <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">}</span> times<span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleClick</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Click</span> me
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>これをテストするには次のように書きます：<pre class="language-js{3,20-22,29-31}"><code class="language-js{3,20-22,29-31}">import React from 'react';
import ReactDOM from 'react-dom/client';
import { act } from 'react-dom/test-utils';
import Counter from './Counter';

let container;

beforeEach(() => {
  container = document.createElement('div');
  document.body.appendChild(container);
});

afterEach(() => {
  document.body.removeChild(container);
  container = null;
});

it('can render and update a counter', () => {
  // Test first render and componentDidMount
  act(() => {
    ReactDOM.createRoot(container).render(&#x3C;Counter />);
  });
  const button = container.querySelector('button');
  const label = container.querySelector('p');
  expect(label.textContent).toBe('You clicked 0 times');
  expect(document.title).toBe('You clicked 0 times');

  // Test second render and componentDidUpdate
  act(() => {
    button.dispatchEvent(new MouseEvent('click', {bubbles: true}));
  });
  expect(label.textContent).toBe('You clicked 1 times');
  expect(document.title).toBe('You clicked 1 times');
});</code></pre><ul><li><p>DOM イベントのディスパッチは、DOM コンテナが <code>document</code> に追加されたときだけ動作することを忘れないでください。<a href="https://testing-library.com/react">React Testing Library</a> のようなヘルパーを使えばボイラープレートのコードを減らせます。<li><p><a href="./testing-recipes.html"><code>recipes</code></a> ドキュメントには <code>act()</code> がどのように動作するのかについて例や使用法を交えた詳しい解説があります。</ul><hr></section><section id="mockcomponent-mockcomponent"class="level3"><h3><code>mockComponent()</code> {#mockcomponent}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">mockComponent</span><span class="token punctuation">(</span>
  componentClass<span class="token punctuation">,</span>
  <span class="token punctuation">[</span>mockTagName<span class="token punctuation">]</span>
<span class="token punctuation">)</span></code></pre><p>モック化されたコンポーネントモジュールをこのメソッドに渡すことで、ダミーの React コンポーネントとして使用できるようになる便利なメソッドを追加することができます。通常のレンダーの代わりに、コンポーネントは、与えられた子要素を含んだシンプルな <code>&#x3C;div></code>（もしくは <code>mockTagName</code> が与えられていれば他のタグ）になります。<blockquote><p>補足:<p><code>mockComponent()</code> はレガシーな API です。その代わりとして <a href="https://jestjs.io/docs/tutorial-react-native#mock-native-modules-using-jestmock"><code>jest.mock()</code></a> の使用をおすすめします。</blockquote><hr></section><section id="iselement-iselement"class="level3"><h3><code>isElement()</code> {#iselement}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">isElement</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span></code></pre><p><code>element</code> が任意の React 要素である場合 <code>true</code> を返します。<hr></section><section id="iselementoftype-iselementoftype"class="level3"><h3><code>isElementOfType()</code> {#iselementoftype}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">isElementOfType</span><span class="token punctuation">(</span>
  element<span class="token punctuation">,</span>
  componentClass
<span class="token punctuation">)</span></code></pre><p><code>element</code> が <code>componentClass</code> 型の React 要素である場合 <code>true</code> を返します。<hr></section><section id="isdomcomponent-isdomcomponent"class="level3"><h3><code>isDOMComponent()</code> {#isdomcomponent}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">isDOMComponent</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span></code></pre><p><code>instance</code> が DOM コンポーネント（<code>&#x3C;div></code> や <code>&#x3C;span></code> など）である場合 <code>true</code> を返します。<hr></section><section id="iscompositecomponent-iscompositecomponent"class="level3"><h3><code>isCompositeComponent()</code> {#iscompositecomponent}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">isCompositeComponent</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span></code></pre><p><code>instance</code> がクラスや関数のようなユーザ定義のコンポーネントである場合 <code>true</code> を返します。<hr></section><section id="iscompositecomponentwithtype-iscompositecomponentwithtype"class="level3"><h3><code>isCompositeComponentWithType()</code> {#iscompositecomponentwithtype}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">isCompositeComponentWithType</span><span class="token punctuation">(</span>
  instance<span class="token punctuation">,</span>
  componentClass
<span class="token punctuation">)</span></code></pre><p><code>instance</code> が React の <code>componentClass</code> 型のコンポーネントである場合 <code>true</code> を返します。<hr></section><section id="findallinrenderedtree-findallinrenderedtree"class="level3"><h3><code>findAllInRenderedTree()</code> {#findallinrenderedtree}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">findAllInRenderedTree</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  test
<span class="token punctuation">)</span></code></pre><p><code>tree</code> 中のすべてのコンポーネントを横断して <code>test(component)</code> が <code>true</code> である全てのコンポーネントを集め、その結果を返します。このメソッド自身はそれほど有用ではありませんが、他のテストユーティリティのための基本メソッドとして使用されます。<hr></section><section id="scryrendereddomcomponentswithclass-scryrendereddomcomponentswithclass"class="level3"><h3><code>scryRenderedDOMComponentsWithClass()</code> {#scryrendereddomcomponentswithclass}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">scryRenderedDOMComponentsWithClass</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  className
<span class="token punctuation">)</span></code></pre><p>レンダーされたツリー内に存在する、クラス名が <code>className</code> に一致する DOM コンポーネントが持つ全ての DOM 要素を探し、その結果を返します。<hr></section><section id="findrendereddomcomponentwithclass-findrendereddomcomponentwithclass"class="level3"><h3><code>findRenderedDOMComponentWithClass()</code> {#findrendereddomcomponentwithclass}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">findRenderedDOMComponentWithClass</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  className
<span class="token punctuation">)</span></code></pre><p><a href="#scryrendereddomcomponentswithclass"><code>scryRenderedDOMComponentsWithClass()</code></a> と同様のメソッドですが、このメソッドは結果が 1 つだけであることを期待しており、その 1 つの結果を返すか、一致するものが 1 つでなかった場合には例外をスローします。<hr></section><section id="scryrendereddomcomponentswithtag-scryrendereddomcomponentswithtag"class="level3"><h3><code>scryRenderedDOMComponentsWithTag()</code> {#scryrendereddomcomponentswithtag}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">scryRenderedDOMComponentsWithTag</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  tagName
<span class="token punctuation">)</span></code></pre><p>レンダーされたツリー内に存在する、タグ名が <code>tagName</code> に一致する DOM コンポーネントが持つ全ての DOM 要素を探し、その結果を返します。<hr></section><section id="findrendereddomcomponentwithtag-findrendereddomcomponentwithtag"class="level3"><h3><code>findRenderedDOMComponentWithTag()</code> {#findrendereddomcomponentwithtag}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">findRenderedDOMComponentWithTag</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  tagName
<span class="token punctuation">)</span></code></pre><p><a href="#scryrendereddomcomponentswithtag"><code>scryRenderedDOMComponentsWithTag()</code></a> と同様のメソッドですが、このメソッドは結果が 1 つだけであることを期待しており、その 1 つの結果を返すか、一致するものが 1 つでなかった場合には例外を返します。<hr></section><section id="scryrenderedcomponentswithtype-scryrenderedcomponentswithtype"class="level3"><h3><code>scryRenderedComponentsWithType()</code> {#scryrenderedcomponentswithtype}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">scryRenderedComponentsWithType</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  componentClass
<span class="token punctuation">)</span></code></pre><p>型が <code>componentClass</code> と同じコンポーネントのインスタンスを全て探し、その結果を返します。<hr></section><section id="findrenderedcomponentwithtype-findrenderedcomponentwithtype"class="level3"><h3><code>findRenderedComponentWithType()</code> {#findrenderedcomponentwithtype}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">findRenderedComponentWithType</span><span class="token punctuation">(</span>
  tree<span class="token punctuation">,</span>
  componentClass
<span class="token punctuation">)</span></code></pre><p><a href="#scryrenderedcomponentswithtype"><code>scryRenderedComponentsWithType()</code></a> と同様のメソッドですが、このメソッドは結果が 1 つだけであることを期待しており、その 1 つの結果を返すか、一致するものが 1 つでなかった場合には例外を返します。<hr></section><section id="renderintodocument-renderintodocument"class="level3"><h3><code>renderIntoDocument()</code> {#renderintodocument}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token function">renderIntoDocument</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span></code></pre><p>React 要素をドキュメントから切り離された DOM ノードにレンダーします。<strong>この関数を実行するには DOM が必要です。</strong>これは以下のコードと実質的に等価です：<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> domContainer <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">createRoot</span><span class="token punctuation">(</span>domContainer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>補足:<p>React をインポートする<strong>前</strong>に <code>window</code>, <code>window.document</code> および <code>window.document.createElement</code> をグローバルスコープに持っている必要があります。そうでなければ React は DOM にアクセスできないものと判断し <code>setState</code> のようなメソッドが動作しなくなります。</blockquote><hr></section></section><section id="other-utilities"class="level2"><h2>その他のユーティリティ</h2><section id="simulate-simulate"class="level3"><h3><code>Simulate</code> {#simulate}</h3><pre class="language-javascript"><code class="language-javascript"><span class="token maybe-class-name">Simulate</span><span class="token punctuation">.</span><span class="token punctuation">{</span>eventName<span class="token punctuation">}</span><span class="token punctuation">(</span>
  element<span class="token punctuation">,</span>
  <span class="token punctuation">[</span>eventData<span class="token punctuation">]</span>
<span class="token punctuation">)</span></code></pre><p>省略可能な <code>eventData</code> イベントデータを使って DOM ノード上のイベントディスパッチをシミュレートします。<p><code>Simulate</code> は <a href="./events.html#supported-events">React が理解している全てのイベント</a>それぞれに対応するメソッドを持っています。<p><strong>要素をクリックする</strong><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// &#x3C;button ref={(node) => this.button = node}>...&#x3C;/button></span>
<span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">button</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">ReactTestUtils</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Simulate</span></span><span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>入力フィールドの値を変更して ENTER キーを押す</strong><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// &#x3C;input ref={(node) => this.textInput = node} /></span>
<span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">textInput</span><span class="token punctuation">;</span>
node<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> <span class="token string">'giraffe'</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">ReactTestUtils</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Simulate</span></span><span class="token punctuation">.</span><span class="token method function property-access">change</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">ReactTestUtils</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Simulate</span></span><span class="token punctuation">.</span><span class="token method function property-access">keyDown</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">"Enter"</span><span class="token punctuation">,</span> <span class="token literal-property property">keyCode</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token literal-property property">which</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>補足<p>React はコンポーネントで使用しているイベントプロパティ（例えば keyCode、which など）を何も作成しないため、あなたはそれらを Simulate が持つメソッドに渡す必要があります。</blockquote><hr><p><span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section></section>