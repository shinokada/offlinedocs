<!doctypehtml><html lang="zh-hant"><meta charset="utf-8"><title>使用 State Hook</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css"><section id="使用-state-hook"class="level1"><h1>使用 State Hook</h1><p><em>Hook</em> 是 React 16.8 中增加的新功能。它讓你不必寫 class 就能使用 state 以及其他 React 的功能。<p><a href="./hooks-intro.html">介紹 Hook</a> 使用過這個範例讓我們熟悉 Hook：<pre class="language-js{4-5}"><code class="language-js{4-5}">import React, { useState } from 'react';

function Example() {
  // 宣告一個新的 state 變數，我們稱作為「count」。
  const [count, setCount] = useState(0);

  return (
    &#x3C;div>
      &#x3C;p>You clicked {count} times&#x3C;/p>
      &#x3C;button onClick={() => setCount(count + 1)}>
        Click me
      &#x3C;/button>
    &#x3C;/div>
  );
}</code></pre><p>我們會藉由在同樣的範例中使用 class 時有什麼差別來學習 Hook。<section id="equivalent-class-example"class="level2"><h2>相等的 Class 範例</h2><p>如果你以前在 React 中使用過 class，這段程式應該對你不陌生：<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">You</span> clicked <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">}</span> times<span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Click</span> me
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>State 從 <code>{ count: 0 }</code> 開始，當使用者點擊按鈕時，我們藉由呼叫 <code>this.setState()</code> 增加 <code>state.count</code>。在這ㄧ整頁，我們會使用這個 class 中的片段來說明。<blockquote><p>注意<p>你也許會好奇我們為什麼要用一個計數器，而不是一個更實際的例子。其實當我們還在學習怎麼使用 Hook 的時候，這有助於我們專注在 API 上面。</blockquote></section><section id="hooks-and-function-components"class="level2"><h2>Hook 和 Function Component</h2><p>提醒一下，在 React 中 function component 看起來像這樣：<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function"><span class="token maybe-class-name">Example</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 你可以在這裡使用 Hook！</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>div <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>或是：<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Example</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 你可以在這裡使用 Hook！</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>div <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>也許你知道它曾被稱作「stateless component」。但因為現在這些 component 也可以使用 React state 了，我們會比較喜歡「function component」這個稱呼。<p>Hook <strong>不會</strong>在 class 裡運作。但你可以使用它來取代 class。</section><section id="whats-a-hook"class="level2"><h2>什麼是 Hook？</h2><p>就從 React 引入 <code>useState</code> 來開始新的範例吧： <pre class="language-js{1}"><code class="language-js{1}">import React, { useState } from 'react';

function Example() {
  // ...
}</code></pre><p><strong>什麼是 Hook？</strong>Hook 是一個讓你可以使用 React 各項功能的特殊 function。舉例來說，<code>useState</code> 是一個讓你增加 React state 到 function component 的 Hook。在後面的章節我們會學習其他 Hook。<p><strong>什麼時候該使用 Hook？</strong>以前當你寫一個 function component 需要增加一些 state 時，你必須轉換成 class。現在你可以直接在 function component 中使用 Hook。我們現在就來試試看吧！<blockquote><p>注意<p>關於在 component 中哪裡可以使用 Hook，有一些特別的規則。我們會在 <a href="./hooks-rules.html">Hook 的規則</a>中學習。</blockquote></section><section id="declaring-a-state-variable"class="level2"><h2>宣告一個 State 變數</h2><p>在 class 中，藉由在 constructor 設定 <code>this.state</code> 成 <code>{ count: 0 }</code> 把 <code>count</code> 這個 state 起始值設為 <code>0</code>。<pre class="language-js{4-6}"><code class="language-js{4-6}">class Example extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      count: 0
    };
  }</code></pre><p>在 function component 中，我們沒有 <code>this</code>，所以我們沒辦法指定或讀取 <code>this.state</code>。相反地，我們可以直接在 component 中呼叫 <code>useState</code> Hook。<pre class="language-js{4,5}"><code class="language-js{4,5}">import React, { useState } from 'react';

function Example() {
  // 宣告一個新的 state 變數，我們稱作為「count」。
  const [count, setCount] = useState(0);</code></pre><p><strong>呼叫 <code>useState</code> 做了什麼？</strong>它宣告了一個「state 變數」。我們的變數叫做 <code>count</code>，也可以有其他稱呼，像是 <code>banana</code>。這是一個在 function 呼叫中「保留」變數的方法－<code>useState</code> 就像是 class 中 <code>this.state</code> 的功能一樣。一般情況下，變數會在 function 結束時「消失」，但 state 變數會被 React 保留起來。<p><strong>我們傳入什麼參數給 <code>useState</code>？</strong>唯一需要傳入 <code>useState()</code> Hook 的參數就是 state 的起始值。不像 class，這個 state 不需要是一個 object。我們可以使用我們所需的 number 或是 string。在範例中，我們只需要一個 number 記錄使用者點擊了多少次，所以我們傳入 <code>0</code> 來當作起始值。（如果要在 state 儲存兩個不同的值，可以呼叫 <code>useState()</code> 兩次。）<p><strong><code>useState</code> 回傳了什麼？</strong>它回傳了一對值：目前的 state 跟一個可以更新 state 的 function。這就是為什麼我們寫 <code>const [count, setCount] = useState()</code> 的原因。除了你是直接拿到一對，這跟 class 中的 <code>this.state.count</code> 和 <code>this.setState</code> 很類似。如果你對我們用的語法不熟悉，我們稍後會在<a href="./hooks-state.html#tip-what-do-square-brackets-mean">本頁的底部</a>討論它。<p>現在我們知道 <code>useState</code> Hook 做了什麼，我們的範例會看起來更有感覺：<pre class="language-js{4,5}"><code class="language-js{4,5}">import React, { useState } from 'react';

function Example() {
  // 宣告一個新的 state 變數，我們稱作為「count」。
  const [count, setCount] = useState(0);</code></pre><p>我們宣告了一個叫做 <code>count</code> 的 state 變數，並將起始值設成了 <code>0</code>。React 在 re-render 間會記住目前的值，並將它提供給我們的 function。如果我們需要更新目前的 <code>count</code>，我們可以呼叫 <code>setCount</code>。<blockquote><p>注意<p>你也許會好奇：為什麼 <code>useState</code> 不叫做 <code>createState</code>？<p>state 只會在第一次 render 時被建立，所以「Create」並不會比較精準。而在其後的 render，<code>useState</code> 只會給我們目前的 state。不然這就不叫做 state 啦！另外還有一個理由，為什麼 Hook <em>總是</em>以 <code>use</code> 起頭。我們稍後會在 <a href="./hooks-rules.html">Hook 規則</a>中了解。</blockquote></section><section id="reading-state"class="level2"><h2>讀取 State</h2><p>在 class 中我們要顯示目前的計數，我們使用 <code>this.state.count</code>：<pre class="language-js"><code class="language-js">  <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">You</span> clicked <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">}</span> times<span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span></code></pre><p>在 function 中，我們可以直接使用 <code>count</code>：<pre class="language-js"><code class="language-js">  <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">You</span> clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times<span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span></code></pre></section><section id="updating-state"class="level2"><h2>更新 State</h2><p>在 class 中，我們需要呼叫 <code>this.setState()</code> 來更新 <code>count</code> state：<pre class="language-js{1}"><code class="language-js{1}">  &#x3C;button onClick={() => this.setState({ count: this.state.count + 1 })}>
    Click me
  &#x3C;/button></code></pre><p>在 function 中，我們已經有 <code>setCount</code> 和 <code>count</code> 變數，所以我們不需要 <code>this</code>：<pre class="language-js{1}"><code class="language-js{1}">  &#x3C;button onClick={() => setCount(count + 1)}>
    Click me
  &#x3C;/button></code></pre></section><section id="recap"class="level2"><h2>總結</h2><p>我們來<strong>一行一行總結一下我們學了什麼</strong>，並確認我們都懂了。<pre class="language-js{1,4,9}"><code class="language-js{1,4,9}"> 1:  import React, { useState } from 'react';
 2:
 3:  function Example() {
 4:    const [count, setCount] = useState(0);
 5:
 6:    return (
 7:      &#x3C;div>
 8:        &#x3C;p>You clicked {count} times&#x3C;/p>
 9:        &#x3C;button onClick={() => setCount(count + 1)}>
10:         Click me
11:        &#x3C;/button>
12:      &#x3C;/div>
13:    );
14:  }</code></pre><ul><li><strong>第一行：</strong>我們從 React 引入 <code>useState</code> Hook。它讓我們可以在 function component 保留 local state。<li><strong>第四行：</strong>在 <code>Example</code> component 裡，我們呼叫 <code>useState</code> Hook 宣告了一個新的 state 變數。並回傳了一對由我們命名的值。我們將代表點擊數的變數命名為 <code>count</code>。我們將起始值設為 <code>0</code> 並傳入 <code>useState</code> 當作唯一參數。第二個回傳的值是個可以更新 <code>count</code> 的 function，所以我們命名為 <code>setCount</code>。<li><strong>第九行：</strong>當使用者點擊，我們就呼叫 <code>setCount</code> 並傳入新的值。然後 React 就會 re-render <code>Example</code> component，並傳入新的 <code>count</code> 值。</ul><p>別急！也許你需要好好消化一番。如果還是有些不懂，你可以試著再將上面那段程式從頭到尾看一下。我們保證一旦你試著把 class 的 state 運作方式「遺忘」，這一切會合理起來。<section id="tip-what-do-square-brackets-mean"class="level3"><h3>提示：方括號代表什麼?</h3><p>你也許注意到了，當我們宣告 state 變數時使用了方括號：<pre class="language-js"><code class="language-js">  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>等號左邊的並不是 React 的 API。你可以命名你自己的 state 變數：<pre class="language-js"><code class="language-js">  <span class="token keyword">const</span> <span class="token punctuation">[</span>fruit<span class="token punctuation">,</span> setFruit<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'banana'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>這個 JavaScript 語法叫做<a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#%E9%99%A3%E5%88%97%E8%A7%A3%E6%A7%8B">陣列解構賦值</a>。這代表我們宣告了兩個新的變數 <code>fruit</code> 和 <code>setFruit</code>，<code>fruit</code> 被設為 <code>useState</code> 回傳的第一個值，<code>setFruit</code> 則是第二個。跟下面這段程式相同：<pre class="language-js"><code class="language-js">  <span class="token keyword">var</span> fruitStateVariable <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'banana'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 回傳一對值</span>
  <span class="token keyword">var</span> fruit <span class="token operator">=</span> fruitStateVariable<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 第一個值</span>
  <span class="token keyword">var</span> setFruit <span class="token operator">=</span> fruitStateVariable<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 第二個值</span></code></pre><p>當我們使用 <code>useState</code> 宣告 state 變數，他會回傳一對在 array 裡的值。第一個值是目前 state 的值，第二個是一個可以更新 state 的 function。因為它們有特殊的意義，只用 <code>[0]</code> 和 <code>[1]</code> 來存取它們的話會令人困惑。所以我們使用陣列解構賦值來命名它們。<blockquote><p>注意<p>你也許會好奇既然我們沒有傳入任何東西像是 <code>this</code>，React 要怎麼知道哪個 component 對應到哪個 <code>useState</code>。我們會在 FAQ 章節解答<a href="./hooks-faq.html#how-does-react-associate-hook-calls-with-components">這個問題</a>和其他問題。</blockquote></section><section id="tip-using-multiple-state-variables"class="level3"><h3>提示: 使用多個 State 變數</h3><p>把 state 變數宣告成一對 <code>[something, setSomething]</code> 同時也很便利，因為如果想要使用超過一個 state 變數，這能讓我們對不同的 state 變數有<em>不同</em>的命名<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ExampleWithManyStates</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 宣告多個 state 變數！</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>age<span class="token punctuation">,</span> setAge<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>fruit<span class="token punctuation">,</span> setFruit<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'banana'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> setTodos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'Learn Hooks'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在上面的 component 中，我們的 local 變數有 <code>age</code>、<code>fruit</code> 和 <code>todos</code>，而且我們可以單獨更新它們。<pre class="language-js"><code class="language-js">  <span class="token keyword">function</span> <span class="token function">handleOrangeClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 類似於 this.setState({ fruit: 'orange' })</span>
    <span class="token function">setFruit</span><span class="token punctuation">(</span><span class="token string">'orange'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre><p>你<strong>不需要</strong>使用很多 state 變數。state 變數可以是 object 或是 array，所以你可以把相關的資料放在一起。然而，不像 class 裡的 <code>this.setState</code> 會合併原本的 state，這裡更新 state 變數會直接<em>取代</em>。<p>我們在 <a href="./hooks-faq.html#should-i-use-one-or-many-state-variables">FAQ 章節</a> 提供更多拆分獨立的 state 變數的建議。</section></section><section id="next-steps"class="level2"><h2>下一步</h2><p>在這一頁，我們學習了其中一個 React 提供的 Hook－<code>useState</code>。我們有時也稱它做「State Hook」。前所未有地，它讓我們能夠增加 local state 到 React function component！<p>我們同時也瞭解了更多什麼是 Hook。Hook 是可以讓你在 function component 使用 React 各項功能的 function。還有更多 Hook 我們還沒認識，而 Hook 的名字都會以 <code>use</code> 起頭。<p><strong>現在我們繼續<a href="./hooks-effect.html">學習下個 Hook：<code>useEffect</code></a>。</strong> 就像 class 的生命週期方法，它讓你能夠在 component 使用 side effect。 <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>