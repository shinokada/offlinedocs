<!doctype html><html lang="zh-hant"><meta charset="utf-8"><title>Render Props</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="render-props"class="level1"><h1>Render Props</h1><p><a href="https://cdb.reacttraining.com/use-a-render-prop-50de598f11ce">「render prop」</a>這個詞指的是一種用一個其值為函式的 prop 來在 React component 之間共享程式碼的技巧。<p>一個帶有 render prop 的 component 不會執行自己的 render 邏輯，而會接受一個回傳 React element 的函式並呼叫。<pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">DataProvider</span></span> <span class="token attr-name">render</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">data</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Hello </span><span class="token punctuation">{</span>data<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">/></span></span></code></pre><p>使用 render props 的函式庫包含 <a href="https://reacttraining.com/react-router/web/api/Route/render-func">React Router</a>、<a href="https://github.com/paypal/downshift">Downshift</a> 和 <a href="https://github.com/jaredpalmer/formik">Formik</a>。<p>以下我們會討論為什麼 render props 如此有用，以及怎麼實作自己的 render props。<section id="use-render-props-for-cross-cutting-concerns"class="level2"><h2>為橫切關注點使用 Render Props</h2><p>Component 是 React 中主要的程式碼重用單位，但如何將一個 component 所包含的 state 或行為共享給其他也同樣需要這些狀態或行為的 component 並不是那麼直觀。<p>例如，下面這個 component 負責在一個網頁應用中追蹤滑鼠游標的位置：<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">MouseTracker</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleMouseMove</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">handleMouseMove</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">handleMouseMove</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">x</span><span class="token operator">:</span> event<span class="token punctuation">.</span><span class="token property-access">clientX</span><span class="token punctuation">,</span>
      <span class="token literal-property property">y</span><span class="token operator">:</span> event<span class="token punctuation">.</span><span class="token property-access">clientY</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'100vh'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> onMouseMove<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleMouseMove</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Move</span> the mouse around<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">The</span> current mouse position <span class="token function">is</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>當游標在螢幕中移動時，這個 component 會在一個 <code>&#x3C;p></code> 中顯示它的 (x,y) 座標。<p>現在問題來了：我們該如何在其他 component 中重用這個行為呢？換句話說，如果另一個 component 需要知道游標的位置，我們能不能將這個行為封裝起來，讓其他的 component 能輕鬆地共享呢？<p>既然 component 是 React 中程式碼基本重用單位，我們來試試看重構這段程式碼，改成用一個 <code>&#x3C;Mouse></code> component 來封裝這些需要在其他地方重用的行為。<pre class="language-js"><code class="language-js"><span class="token comment">// &#x3C;Mouse> component 封裝我們所需的行為...</span>
<span class="token keyword">class</span> <span class="token class-name">Mouse</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleMouseMove</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">handleMouseMove</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">handleMouseMove</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">x</span><span class="token operator">:</span> event<span class="token punctuation">.</span><span class="token property-access">clientX</span><span class="token punctuation">,</span>
      <span class="token literal-property property">y</span><span class="token operator">:</span> event<span class="token punctuation">.</span><span class="token property-access">clientY</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'100vh'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> onMouseMove<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleMouseMove</span><span class="token punctuation">}</span><span class="token operator">></span>

        <span class="token punctuation">{</span><span class="token comment">/* ...但我們如何 render 除了 &#x3C;p> 以外的東西？ */</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">The</span> current mouse position <span class="token function">is</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MouseTracker</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Move</span> the mouse around<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Mouse</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>現在 <code>&#x3C;Mouse></code> component 封裝了全部跟監聽 <code>mousemove</code> 事件有關的行為，也儲存了游標的 (x,y) 位置，但它還不算真的可重用。<p>舉例來說，假設我們有一個 <code>&#x3C;Cat></code> component ，它會在螢幕中 render 追著滑鼠跑的貓咪圖片。我們可能會用一個 <code>&#x3C;Cat mouse={{ x, y }}></code> 的 prop 來告訴這個 component 滑鼠的座標，它便知道該把這張圖片放在螢幕中何處。<p>作為第一次嘗試，你可能會試著把 <code>&#x3C;Cat></code> 從 <em><code>&#x3C;Mouse></code>的 <code>render</code> 方法裡面</em> render 出來，像這樣：<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> mouse <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">mouse</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>img src<span class="token operator">=</span><span class="token string">"/cat.jpg"</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> mouse<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">,</span> <span class="token literal-property property">top</span><span class="token operator">:</span> mouse<span class="token punctuation">.</span><span class="token property-access">y</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MouseWithCat</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleMouseMove</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">handleMouseMove</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">handleMouseMove</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">x</span><span class="token operator">:</span> event<span class="token punctuation">.</span><span class="token property-access">clientX</span><span class="token punctuation">,</span>
      <span class="token literal-property property">y</span><span class="token operator">:</span> event<span class="token punctuation">.</span><span class="token property-access">clientY</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'100vh'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> onMouseMove<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleMouseMove</span><span class="token punctuation">}</span><span class="token operator">></span>

        <span class="token punctuation">{</span><span class="token comment">/*
          我們大可以在這裡把 &#x3C;p> 換成 &#x3C;Cat> ...但這樣我們就必須在每次用到它時，
          創建另外一個 &#x3C;MouseWithSomethingElse> component，
          所以 &#x3C;MouseWithCat> 的可重用性還不夠。
        */</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Cat</span> mouse<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MouseTracker</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Move</span> the mouse around<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MouseWithCat</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>此方法在特定案例中可行，但我們還未能以可重用的方法把這個行為封裝起來。現在，每次在不同案例中，如果我們需要知道滑鼠位置，便必須另外創建一個特定為該案例 render 某些東西的 component （換句話說，就是另一個 <code>&#x3C;MouseWithCat></code> ）<p>這就是 render prop 發揮功用的地方了：我們提供 <code>&#x3C;Mouse></code> 一個 function prop render prop，讓它能夠動態決定該 render 什麼，而不是把 <code>&#x3C;Cat></code> 寫死在 <code>&#x3C;Mouse></code> component 裡。<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> mouse <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">mouse</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>img src<span class="token operator">=</span><span class="token string">"/cat.jpg"</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> mouse<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">,</span> <span class="token literal-property property">top</span><span class="token operator">:</span> mouse<span class="token punctuation">.</span><span class="token property-access">y</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Mouse</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleMouseMove</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">handleMouseMove</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">handleMouseMove</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">x</span><span class="token operator">:</span> event<span class="token punctuation">.</span><span class="token property-access">clientX</span><span class="token punctuation">,</span>
      <span class="token literal-property property">y</span><span class="token operator">:</span> event<span class="token punctuation">.</span><span class="token property-access">clientY</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'100vh'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> onMouseMove<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">handleMouseMove</span><span class="token punctuation">}</span><span class="token operator">></span>

        <span class="token punctuation">{</span><span class="token comment">/*
          用 `render` prop 去動態決定該 render 什麼，而不是將 &#x3C;Mouse> render 的東西靜態表示出來。
        */</span><span class="token punctuation">}</span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MouseTracker</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Move</span> the mouse around<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Mouse</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">mouse</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Cat</span> mouse<span class="token operator">=</span><span class="token punctuation">{</span>mouse<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>現在，我們提供一個 <code>render</code> prop 給 <code>&#x3C;Mouse></code> ，讓它能夠動態決定它該 render 什麼，而不是為了一些特定案例，去複製 <code>&#x3C;Mouse></code> component 並在它的 <code>render</code> 方法中硬性寫入某些東西。<p>更具體地說，<strong>render prop 是一個讓 component 知道該 render 什麼的 function prop。</strong><p>這個技巧讓我們想共享的行為變得極為可轉移。要使用這個行為時，就 render 一個有 <code>render</code> prop 的 <code>&#x3C;Mouse></code>，讓 <code>render</code> prop 來告訴 <code>&#x3C;Mouse></code> 該用現在游標的 (x,y) render 什麼。<p>關於 render props 一件有趣的事是，你可以用包含 render prop 的普通 component 來實作 <a href="./higher-order-components.html">higher-order component</a>。舉例來說，如果你偏好用 <code>withMouse</code> HOC 而不是 <code>&#x3C;Mouse></code> component 的話，你可以輕易地用一個普通的 <code>&#x3C;Mouse></code> 加上 render prop 來建立：<pre class="language-js"><code class="language-js"><span class="token comment">// 如果你真的想用 HOC ，你可以輕易地用一個</span>
<span class="token comment">// 有 render prop 的普通 component 來建立！</span>
<span class="token keyword">function</span> <span class="token function">withMouse</span><span class="token punctuation">(</span><span class="token parameter"><span class="token maybe-class-name">Component</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Component</span></span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Mouse</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">mouse</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Component</span> <span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">}</span> mouse<span class="token operator">=</span><span class="token punctuation">{</span>mouse<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>因此 render prop 讓兩種模式皆可使用。</section><section id="使用-props-代替-render-using-props-other-than-render"class="level2"><h2>使用 Props 代替 <code>render</code> {#using-props-other-than-render}</h2><p>記住，只因為這個模式稱為 「render props」，不代表<em>你一定要用一個名為 <code>render</code> 的 prop來使用這個模式</em>。事實上，<a href="https://cdb.reacttraining.com/use-a-render-prop-50de598f11ce"><em>任何</em>是函式且被 component 用來認知該 render 什麼的 prop，都叫做 「redner prop」</a>。<p>雖然上述範例使用 <code>render</code>，我們可以同樣輕易地使用 <code>children</code> prop！<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Mouse</span> children<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">mouse</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
  <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">The</span> mouse position is <span class="token punctuation">{</span>mouse<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>mouse<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span></code></pre><p>記得，<code>children</code> prop 不需要在 JSX element 的屬性列表中註明。你可以直接把它放在 element <em>裡面</em>！<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Mouse</span><span class="token operator">></span>
  <span class="token punctuation">{</span><span class="token parameter">mouse</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">The</span> mouse position is <span class="token punctuation">{</span>mouse<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>mouse<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Mouse</span><span class="token operator">></span></code></pre><p>你會看到這個技巧在 <a href="https://github.com/chenglou/react-motion">react-motion</a> API 中被使用。<p>因為這個技巧有一點不常見，在設計像這樣的 API 時，你可能會想在 <code>propTypes</code> 明確地把 <code>children</code> 定義為一個函式。<pre class="language-js"><code class="language-js"><span class="token maybe-class-name">Mouse</span><span class="token punctuation">.</span><span class="token property-access">propTypes</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token maybe-class-name">PropTypes</span><span class="token punctuation">.</span><span class="token property-access">func</span><span class="token punctuation">.</span><span class="token property-access">isRequired</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></section><section id="caveats"class="level2"><h2>警告</h2><section id="be-careful-when-using-render-props-with-reactpurecomponent"class="level3"><h3>注意當 Render Props 使用在 React.PureComponent 時</h3><p>如果你在 <code>render</code> 方法中建立函式，使用 render prop 會讓 <a href="./react-api.html#reactpurecomponent"><code>React.PureComponent</code></a> 帶來的好處作廢。這是因為對新的 props 而言，prop 的淺比較會永遠回傳 <code>false</code>，並且每次 <code>render</code> 都會為 render prop 產生新的值。<p>例如，繼續我們上述的 <code>&#x3C;Mouse></code> component，如果 <code>Mouse</code> 繼承 <code>React.PureComponent</code> 而不是 <code>React.Component</code> 的話，我們的範例會像這樣：<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Mouse</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如上述實作內容...</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MouseTracker</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Move</span> the mouse around<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>

        <span class="token punctuation">{</span><span class="token comment">/*
          這很不好！render prop 的值在每次 render 都會不一樣。
        */</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Mouse</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">mouse</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Cat</span> mouse<span class="token operator">=</span><span class="token punctuation">{</span>mouse<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>在這個範例中，每次 <code>&#x3C;MouseTracker></code> render 時，它會產生一個新的函式，作為 <code>&#x3C;Mouse render></code> prop 的值，便使一開始 <code>&#x3C;Mouse></code> 繼承 <code>React.PureComponent</code> 的效果作廢！<p>為了避開這個問題，你有時候可以把這個 prop 定義為一個 instance 方法，像是：<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">MouseTracker</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token comment">// `this.renderTheCat` 被定義成一個 instance 方法</span>
  <span class="token comment">// 當我們在 render 使用到時，會永遠指向*相同的*函式</span>
  <span class="token function">renderTheCat</span><span class="token punctuation">(</span><span class="token parameter">mouse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Cat</span> mouse<span class="token operator">=</span><span class="token punctuation">{</span>mouse<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Move</span> the mouse around<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Mouse</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">renderTheCat</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>在不能把 prop 定義成靜態的案例中（例：因為你需要封閉 component 的 props 和/或 state），<code>&#x3C;Mouse></code> 應改為繼承 <code>React.Component</code>。 <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section></section>