<!doctypehtml><html lang="zh-hant"><meta charset="utf-8"><title>Shallow Renderer</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css"><section id="shallow-renderer"class="level1"><h1>Shallow Renderer</h1><p><strong>如何 Import</strong><pre class="language-javascript"><code class="language-javascript"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ShallowRenderer</span></span> <span class="token keyword module">from</span> <span class="token string">'react-test-renderer/shallow'</span><span class="token punctuation">;</span> <span class="token comment">// ES6</span>
<span class="token keyword">var</span> <span class="token maybe-class-name">ShallowRenderer</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react-test-renderer/shallow'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ES5 with npm</span></code></pre><section id="overview"class="level2"><h2>概觀</h2><p>當在為 React 寫單元測試時，shallow render 十分有用。Shallow render 可以只 render 「第一層」的 component，並且對 component 的 render 方法的回傳值進行 assert，不必擔心 child component 的行為，child component 並沒有被實例化或被 render。Shallow render 不依賴 DOM。<p>例如，假設你有下列 component：<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>span className<span class="token operator">=</span><span class="token string">"heading"</span><span class="token operator">></span><span class="token maybe-class-name">Title</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Subcomponent</span> foo<span class="token operator">=</span><span class="token string">"bar"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>你可以使用 assert：<pre class="language-javascript"><code class="language-javascript"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ShallowRenderer</span></span> <span class="token keyword module">from</span> <span class="token string">'react-test-renderer/shallow'</span><span class="token punctuation">;</span>

<span class="token comment">// in your test:</span>
<span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShallowRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
renderer<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">MyComponent</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> renderer<span class="token punctuation">.</span><span class="token method function property-access">getRenderOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token operator">&#x3C;</span>span className<span class="token operator">=</span><span class="token string">"heading"</span><span class="token operator">></span><span class="token maybe-class-name">Title</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">,</span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Subcomponent</span> foo<span class="token operator">=</span><span class="token string">"bar"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Shallow testing 目前有些限制，並不支援 refs。<blockquote><p>注意：<p>我們建議你可以查看 Enzyme 的 <a href="https://airbnb.io/enzyme/docs/api/shallow.html">Shallow Rendering API</a>。它在相同功能的基礎上提供更棒更高階的 API。</blockquote></section><section id="reference"class="level2"><h2>參考</h2><section id="shallowrendererrender-shallowrendererrender"class="level3"><h3><code>shallowRenderer.render()</code> {#shallowrendererrender}</h3><p>你可以把 shallowRenderer 想成一個用來 render 測試中 component 的「空間」，並且可以從中提取該 component 輸出的內容。<p><code>shallowRenderer.render()</code> 類似於 <a href="./react-dom-client.html#createroot"><code>root.render()</code></a>，但它不依賴 DOM 且只 render 一層。這意味著你可以對測試的 component 及其 child component 進行隔離測試。</section><section id="shallowrenderergetrenderoutput-shallowrenderergetrenderoutput"class="level3"><h3><code>shallowRenderer.getRenderOutput()</code> {#shallowrenderergetrenderoutput}</h3><p>在 <code>shallowRenderer.render()</code> 被呼叫後，你可以使用 <code>shallowRenderer.getRenderOutput()</code> 來取得該 component 第一層的輸出內容。<p>然後，就可以對輸出的內容進行 assert 操作。 <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section></section>