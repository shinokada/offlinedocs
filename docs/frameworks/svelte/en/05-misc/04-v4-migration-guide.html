<!doctype html><html lang="en"><meta charset="utf-8"><title>Svelte 4 migration guide</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="svelte-4-migration-guide"><h1 id="svelte-4-migration-guide">Svelte 4 migration guide</h1><p>This migration guide provides an overview of how to migrate from Svelte version 3 to 4. See the linked PRs for more details about each change. Use the migration script to migrate some of these automatically: <code>npx svelte-migrate@latest svelte-4</code><p>If you're a library author, consider whether to only support Svelte 4 or if it's possible to support Svelte 3 too. Since most of the breaking changes don't affect many people, this may be easily possible. Also remember to update the version range in your <code>peerDependencies</code>.<section class="level2"aria-labelledby="minimum-version-requirements"><h2 id="minimum-version-requirements">Minimum version requirements</h2><ul><li>Upgrade to Node 16 or higher. Earlier versions are no longer supported. (<a href="https://github.com/sveltejs/svelte/issues/8566">#8566</a>)<li>If you are using SvelteKit, upgrade to 1.20.4 or newer (<a href="https://github.com/sveltejs/kit/pull/10172">sveltejs/kit#10172</a>)<li>If you are using Vite without SvelteKit, upgrade to <code>vite-plugin-svelte</code> 2.4.1 or newer (<a href="https://github.com/sveltejs/svelte/issues/8516">#8516</a>)<li>If you are using webpack, upgrade to webpack 5 or higher and <code>svelte-loader</code> 3.1.8 or higher. Earlier versions are no longer supported. (<a href="https://github.com/sveltejs/svelte/issues/8515">#8515</a>, <a href="https://github.com/sveltejs/svelte/commit/198dbcf">198dbcf</a>)<li>If you are using Rollup, upgrade to <code>rollup-plugin-svelte</code> 7.1.5 or higher (<a href="https://github.com/sveltejs/svelte/commit/198dbcf">198dbcf</a>)<li>If you are using TypeScript, upgrade to TypeScript 5 or higher. Lower versions might still work, but no guarantees are made about that. (<a href="https://github.com/sveltejs/svelte/issues/8488">#8488</a>)</ul></section><section class="level2"aria-labelledby="browser-conditions-for-bundlers"><h2 id="browser-conditions-for-bundlers">Browser conditions for bundlers</h2><p>Bundlers must now specify the <code>browser</code> condition when building a frontend bundle for the browser. SvelteKit and Vite will handle this automatically for you. If you're using any others, you may observe lifecycle callbacks such as <code>onMount</code> not get called and you'll need to update the module resolution configuration.<ul><li>For Rollup this is done within the <code>@rollup/plugin-node-resolve</code> plugin by setting <code>browser: true</code> in its options. See the <a href="https://github.com/sveltejs/rollup-plugin-svelte/#usage"><code>rollup-plugin-svelte</code></a> documentation for more details<li>For wepback this is done by adding <code>"browser"</code> to the <code>conditionNames</code> array. You may also have to update your <code>alias</code> config, if you have set it. See the <a href="https://github.com/sveltejs/svelte-loader#usage"><code>svelte-loader</code></a> documentation for more details</ul><p>(<a href="https://github.com/sveltejs/svelte/issues/8516">#8516</a>)</section><section class="level2"aria-labelledby="removal-of-cjs-related-output"><h2 id="removal-of-cjs-related-output">Removal of CJS related output</h2><p>Svelte no longer supports the CommonJS (CJS) format for compiler output and has also removed the <code>svelte/register</code> hook and the CJS runtime version. If you need to stay on the CJS output format, consider using a bundler to convert Svelte's ESM output to CJS in a post-build step. (<a href="https://github.com/sveltejs/svelte/issues/8613">#8613</a>)</section><section class="level2"aria-labelledby="stricter-types-for-svelte-functions"><h2 id="stricter-types-for-svelte-functions">Stricter types for Svelte functions</h2><p>There are now stricter types for <code>createEventDispatcher</code>, <code>Action</code>, <code>ActionReturn</code>, and <code>onMount</code>:<ul><li><code>createEventDispatcher</code> now supports specifying that a payload is optional, required, or non-existent, and the call sites are checked accordingly (<a href="https://github.com/sveltejs/svelte/issues/7224">#7224</a>)</ul><pre class="language-ts"><code class="language-ts"><span class="token comment">// @errors: 2554 2345</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createEventDispatcher <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'svelte'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createEventDispatcher</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token punctuation">{</span>
	optional<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
	required<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
	noArgument<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Svelte version 3:</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'optional'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'required'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// I can still omit the detail argument</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'noArgument'</span><span class="token punctuation">,</span> <span class="token string">'surprise'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// I can still add a detail argument</span>

<span class="token comment">// Svelte version 4 using TypeScript strict mode:</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'optional'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'required'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error, missing argument</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'noArgument'</span><span class="token punctuation">,</span> <span class="token string">'surprise'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error, cannot pass an argument</span></code></pre><ul><li><code>Action</code> and <code>ActionReturn</code> have a default parameter type of <code>undefined</code> now, which means you need to type the generic if you want to specify that this action receives a parameter. The migration script will migrate this automatically (<a href="https://github.com/sveltejs/svelte/pull/7442">#7442</a>)</ul><pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">const action: Action = (node, params) => { .. } // this is now an error if you use params in any way
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">const action: Action&#x3C;HTMLElement, string> = (node, params) => { .. } // params is of type string</span></span></code></pre><ul><li><code>onMount</code> now shows a type error if you return a function asynchronously from it, because this is likely a bug in your code where you expect the callback to be called on destroy, which it will only do for synchronously returned functions (<a href="https://github.com/sveltejs/svelte/issues/8136">#8136</a>)</ul><pre class="language-diff"><code class="language-diff">// Example where this change reveals an actual bug
onMount(
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> // someCleanup() not called because function handed to onMount is async
</span><span class="token prefix deleted">-</span><span class="token line"> async () => {
</span><span class="token prefix deleted">-</span><span class="token line">   const something = await foo();
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> // someCleanup() is called because function handed to onMount is sync
</span><span class="token prefix inserted">+</span><span class="token line"> () => {
</span><span class="token prefix inserted">+</span><span class="token line">  foo().then(something =>  ..
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  // ..
</span><span class="token prefix unchanged"> </span><span class="token line">  return () => someCleanup();
</span></span>}
);</code></pre></section><section class="level2"aria-labelledby="custom-elements-with-svelte"><h2 id="custom-elements-with-svelte">Custom Elements with Svelte</h2><p>The creation of custom elements with Svelte has been overhauled and significantly improved. The <code>tag</code> option is deprecated in favor of the new <code>customElement</code> option:<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">&#x3C;svelte:options tag="my-component" />
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">&#x3C;svelte:options customElement="my-component" /></span></span></code></pre><p>This change was made to allow <a href="custom-elements-api#component-options">more configurability</a> for advanced use cases. The migration script will adjust your code automatically. The update timing of properties has changed slightly as well. (<a href="https://github.com/sveltejs/svelte/issues/8457">#8457</a>)</section><section class="level2"aria-labelledby="sveltecomponenttyped-is-deprecated"><h2 id="sveltecomponenttyped-is-deprecated">SvelteComponentTyped is deprecated</h2><p><code>SvelteComponentTyped</code> is deprecated, as <code>SvelteComponent</code> now has all its typing capabilities. Replace all instances of <code>SvelteComponentTyped</code> with <code>SvelteComponent</code>.<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import { SvelteComponentTyped } from 'svelte';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import { SvelteComponent } from 'svelte';
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> export class Foo extends SvelteComponentTyped&#x3C;{ aProp: string }> {}
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> export class Foo extends SvelteComponent&#x3C;{ aProp: string }> {}</span></span></code></pre><p>If you have used <code>SvelteComponent</code> as the component instance type previously, you may see a somewhat opaque type error now, which is solved by changing <code>: typeof SvelteComponent</code> to <code>: typeof SvelteComponent&#x3C;any></code>.<pre class="language-diff"><code class="language-diff"><span class="token deleted-arrow deleted"><span class="token prefix deleted">&#x3C;</span><span class="token line">script>
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> import ComponentA from './ComponentA.svelte';
</span><span class="token prefix unchanged"> </span><span class="token line"> import ComponentB from './ComponentB.svelte';
</span><span class="token prefix unchanged"> </span><span class="token line"> import { SvelteComponent } from 'svelte';
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  let component: typeof SvelteComponent;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  let component: typeof SvelteComponent&#x3C;any>;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function choseRandomly() {
</span><span class="token prefix unchanged"> </span><span class="token line">   component = Math.random() > 0.5 ? ComponentA : ComponentB;
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span><span class="token deleted-arrow deleted"><span class="token prefix deleted">&#x3C;</span><span class="token line">/script>
</span></span>
<span class="token deleted-arrow deleted"><span class="token prefix deleted">&#x3C;</span><span class="token line">button on:click={choseRandomly}>random&#x3C;/button>
</span><span class="token prefix deleted">&#x3C;</span><span class="token line">svelte:element this={component} /></span></span></code></pre><p>The migration script will do both automatically for you. (<a href="https://github.com/sveltejs/svelte/issues/8512">#8512</a>)</section><section class="level2"aria-labelledby="transitions-are-local-by-default"><h2 id="transitions-are-local-by-default">Transitions are local by default</h2><p>Transitions are now local by default to prevent confusion around page navigations. "local" means that a transition will not play if it's within a nested control flow block (<code>each/if/await/key</code>) and not the direct parent block but a block above it is created/destroyed. In the following example, the <code>slide</code> intro animation will only play when <code>success</code> goes from <code>false</code> to <code>true</code>, but it will <em>not</em> play when <code>show</code> goes from <code>false</code> to <code>true</code>:<pre class="language-svelte"><code class="language-svelte">{#if show}
	...
	{#if success}
		&#x3C;p in:slide>Success&#x3C;/p>
	{/each}
{/if}</code></pre><p>To make transitions global, add the <code>|global</code> modifier - then they will play when <em>any</em> control flow block above is created/destroyed. The migration script will do this automatically for you. (<a href="https://github.com/sveltejs/svelte/issues/6686">#6686</a>)</section><section class="level2"aria-labelledby="default-slot-bindings"><h2 id="default-slot-bindings">Default slot bindings</h2><p>Default slot bindings are no longer exposed to named slots and vice versa:<pre class="language-svelte"><code class="language-svelte">&#x3C;script>
	import Nested from './Nested.svelte';
&#x3C;/script>

&#x3C;Nested let:count>
	&#x3C;p>
		count in default slot - is available: {count}
	&#x3C;/p>
	&#x3C;p slot="bar">
		count in bar slot - is not available: {count}
	&#x3C;/p>
&#x3C;/Nested></code></pre><p>This makes slot bindings more consistent as the behavior is undefined when for example the default slot is from a list and the named slot is not. (<a href="https://github.com/sveltejs/svelte/issues/6049">#6049</a>)</section><section class="level2"aria-labelledby="preprocessors"><h2 id="preprocessors">Preprocessors</h2><p>The order in which preprocessors are applied has changed. Now, preprocessors are executed in order, and within one group, the order is markup, script, style.<pre class="language-js"><code class="language-js"><span class="token comment">// @errors: 2304</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> preprocess <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'svelte/compiler'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">preprocess</span><span class="token punctuation">(</span>
	source<span class="token punctuation">,</span>
	<span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			<span class="token function-variable function">markup</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
				<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'markup-1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function-variable function">script</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
				<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'script-1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function-variable function">style</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
				<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'style-1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span>
			<span class="token function-variable function">markup</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
				<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'markup-2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function-variable function">script</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
				<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'script-2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function-variable function">style</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
				<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'style-2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span>
		<span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'App.svelte'</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Svelte 3 logs:</span>
<span class="token comment">// markup-1</span>
<span class="token comment">// markup-2</span>
<span class="token comment">// script-1</span>
<span class="token comment">// script-2</span>
<span class="token comment">// style-1</span>
<span class="token comment">// style-2</span>

<span class="token comment">// Svelte 4 logs:</span>
<span class="token comment">// markup-1</span>
<span class="token comment">// script-1</span>
<span class="token comment">// style-1</span>
<span class="token comment">// markup-2</span>
<span class="token comment">// script-2</span>
<span class="token comment">// style-2</span></code></pre><p>This could affect you for example if you are using <code>MDsveX</code> - in which case you should make sure it comes before any script or style preprocessor.<pre class="language-diff"><code class="language-diff">preprocess: [
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">	vitePreprocess(),
</span><span class="token prefix deleted">-</span><span class="token line">	mdsvex(mdsvexConfig)
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">	mdsvex(mdsvexConfig),
</span><span class="token prefix inserted">+</span><span class="token line">	vitePreprocess()
</span></span>]</code></pre><p>Each preprocessor must also have a name. (<a href="https://github.com/sveltejs/svelte/issues/8618">#8618</a>)</section><section class="level2"aria-labelledby="new-eslint-package"><h2 id="new-eslint-package">New eslint package</h2><p><code>eslint-plugin-svelte3</code> is deprecated. It may still work with Svelte 4 but we make no guarantees about that. We recommend switching to our new package <a href="https://github.com/sveltejs/eslint-plugin-svelte">eslint-plugin-svelte</a>. See <a href="https://github.com/sveltejs/kit/issues/10242#issuecomment-1610798405">this Github post</a> for an instruction how to migrate. Alternatively, you can create a new project using <code>npm create svelte@latest</code>, select the eslint (and possibly TypeScript) option and then copy over the related files into your existing project.</section><section class="level2"aria-labelledby="other-breaking-changes"><h2 id="other-breaking-changes">Other breaking changes</h2><ul><li>the <code>inert</code> attribute is now applied to outroing elements to make them invisible to assistive technology and prevent interaction. (<a href="https://github.com/sveltejs/svelte/pull/8628">#8628</a>)<li>the runtime now uses <code>classList.toggle(name, boolean)</code> which may not work in very old browsers. Consider using a <a href="https://github.com/eligrey/classList.js">polyfill</a> if you need to support these browsers. (<a href="https://github.com/sveltejs/svelte/issues/8629">#8629</a>)<li>the runtime now uses the <code>CustomEvent</code> constructor which may not work in very old browsers. Consider using a <a href="https://github.com/theftprevention/event-constructor-polyfill/tree/master">polyfill</a> if you need to support these browsers. (<a href="https://github.com/sveltejs/svelte/pull/8775">#8775</a>)<li>people implementing their own stores from scratch using the <code>StartStopNotifier</code> interface (which is passed to the create function of <code>writable</code> etc) from <code>svelte/store</code> now need to pass an update function in addition to the set function. This has no effect on people using stores or creating stores using the existing Svelte stores. (<a href="https://github.com/sveltejs/svelte/issues/6750">#6750</a>)<li><code>derived</code> will now throw an error on falsy values instead of stores passed to it. (<a href="https://github.com/sveltejs/svelte/issues/7947">#7947</a>)<li>type definitions for <code>svelte/internal</code> were removed to further discourage usage of those internal methods which are not public API. Most of these will likely change for Svelte 5<li>Removal of DOM nodes is now batched which slightly changes its order, which might affect the order of events fired if you're using a <code>MutationObserver</code> on these elements (<a href="https://github.com/sveltejs/svelte/pull/8763">#8763</a>)<li>if you enhanced the global typings through the <code>svelte.JSX</code> namespace before, you need to migrate this to use the <code>svelteHTML</code> namespace. Similarly if you used the <code>svelte.JSX</code> namespace to use type definitions from it, you need to migrate those to use the types from <code>svelte/elements</code> instead. You can find more information about what to do <a href="https://github.com/sveltejs/language-tools/blob/master/docs/preprocessors/typescript.md#im-getting-deprecation-warnings-for-sveltejsx--i-want-to-migrate-to-the-new-typings">here</a> <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></ul></section></section>