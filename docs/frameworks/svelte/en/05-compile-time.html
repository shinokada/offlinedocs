<!doctypehtml><html lang="en"><meta charset="utf-8"><title>Compile time</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css"><section id="compile-time"class="level1"><h1>Compile time</h1><p>Typically, you won't interact with the Svelte compiler directly, but will instead integrate it into your build system using a bundler plugin. The bundler plugin that the Svelte team most recommends and invests in is <a href="https://github.com/sveltejs/vite-plugin-svelte">vite-plugin-svelte</a>. The <a href="https://kit.svelte.dev/">SvelteKit</a> framework provides a setup leveraging <code>vite-plugin-svelte</code> to build applications as well as a <a href="https://kit.svelte.dev/docs/packaging">tool for packaging Svelte component libraries</a>. Svelte Society maintains a list of <a href="https://sveltesociety.dev/tools/#bundling">other bundler plugins</a> for additional tools like Rollup and Webpack.<p>Nonetheless, it's useful to understand how to use the compiler, since bundler plugins generally expose compiler options to you.<section id="sveltecompile"class="level2"><h2><code>svelte.compile</code></h2><pre class="language-js"><code class="language-js"><span class="token literal-property property">result</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	js<span class="token punctuation">,</span>
	css<span class="token punctuation">,</span>
	ast<span class="token punctuation">,</span>
	warnings<span class="token punctuation">,</span>
	vars<span class="token punctuation">,</span>
	stats
<span class="token punctuation">}</span> <span class="token operator">=</span> svelte<span class="token punctuation">.</span><span class="token method function property-access">compile</span><span class="token punctuation">(</span>source<span class="token operator">:</span> string<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>This is where the magic happens. <code>svelte.compile</code> takes your component source code, and turns it into a JavaScript module that exports a class.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> svelte <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'svelte/compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> svelte<span class="token punctuation">.</span><span class="token method function property-access">compile</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token comment">// options</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The following options can be passed to the compiler. None are required:<p>| option | default | description | | | --- | --- | | <code>filename</code> | <code>null</code> | <code>string</code> used for debugging hints and sourcemaps. Your bundler plugin will set it automatically. | <code>name</code> | <code>"Component"</code> | <code>string</code> that sets the name of the resulting JavaScript class (though the compiler will rename it if it would otherwise conflict with other variables in scope). It will normally be inferred from <code>filename</code>. | <code>format</code> | <code>"esm"</code> | If <code>"esm"</code>, creates a JavaScript module (with <code>import</code> and <code>export</code>). If <code>"cjs"</code>, creates a CommonJS module (with <code>require</code> and <code>module.exports</code>), which is useful in some server-side rendering situations or for testing. | <code>generate</code> | <code>"dom"</code> | If <code>"dom"</code>, Svelte emits a JavaScript class for mounting to the DOM. If <code>"ssr"</code>, Svelte emits an object with a <code>render</code> method suitable for server-side rendering. If <code>false</code>, no JavaScript or CSS is returned; just metadata. | <code>errorMode</code> | <code>"throw"</code> | If <code>"throw"</code>, Svelte throws when a compilation error occurred. If <code>"warn"</code>, Svelte will treat errors as warnings and add them to the warning report. | <code>varsReport</code> | <code>"strict"</code> | If <code>"strict"</code>, Svelte returns a variables report with only variables that are not globals nor internals. If <code>"full"</code>, Svelte returns a variables report with all detected variables. If <code>false</code>, no variables report is returned. | <code>dev</code> | <code>false</code> | If <code>true</code>, causes extra code to be added to components that will perform runtime checks and provide debugging information during development. | <code>immutable</code> | <code>false</code> | If <code>true</code>, tells the compiler that you promise not to mutate any objects. This allows it to be less conservative about checking whether values have changed. | <code>hydratable</code> | <code>false</code> | If <code>true</code> when generating DOM code, enables the <code>hydrate: true</code> runtime option, which allows a component to upgrade existing DOM rather than creating new DOM from scratch. When generating SSR code, this adds markers to <code>&#x3C;head></code> elements so that hydration knows which to replace. | <code>legacy</code> | <code>false</code> | If <code>true</code>, generates code that will work in IE9 and IE10, which don't support things like <code>element.dataset</code>. | <code>accessors</code> | <code>false</code> | If <code>true</code>, getters and setters will be created for the component's props. If <code>false</code>, they will only be created for readonly exported values (i.e. those declared with <code>const</code>, <code>class</code> and <code>function</code>). If compiling with <code>customElement: true</code> this option defaults to <code>true</code>. | <code>customElement</code> | <code>false</code> | If <code>true</code>, tells the compiler to generate a custom element constructor instead of a regular Svelte component. | <code>tag</code> | <code>null</code> | A <code>string</code> that tells Svelte what tag name to register the custom element with. It must be a lowercase alphanumeric string with at least one hyphen, e.g. <code>"my-element"</code>. | <code>css</code> | <code>'injected'</code> | If <code>'injected'</code> (formerly <code>true</code>), styles will be included in the JavaScript class and injected at runtime for the components actually rendered. If <code>'external'</code> (formerly <code>false</code>), the CSS will be returned in the <code>css</code> field of the compilation result. Most Svelte bundler plugins will set this to <code>'external'</code> and use the CSS that is statically generated for better performance, as it will result in smaller JavaScript bundles and the output can be served as cacheable <code>.css</code> files. If <code>'none'</code>, styles are completely avoided and no CSS output is generated. | <code>cssHash</code> | See right | A function that takes a <code>{ hash, css, name, filename }</code> argument and returns the string that is used as a classname for scoped CSS. It defaults to returning <code>svelte-${hash(css)}</code> | <code>loopGuardTimeout</code> | 0 | A <code>number</code> that tells Svelte to break the loop if it blocks the thread for more than <code>loopGuardTimeout</code> ms. This is useful to prevent infinite loops. <strong>Only available when <code>dev: true</code></strong> | <code>preserveComments</code> | <code>false</code> | If <code>true</code>, your HTML comments will be preserved during server-side rendering. By default, they are stripped out. | <code>preserveWhitespace</code> | <code>false</code> | If <code>true</code>, whitespace inside and between elements is kept as you typed it, rather than removed or collapsed to a single space where possible. | <code>sourcemap</code> | <code>object \| string</code> | An initial sourcemap that will be merged into the final output sourcemap. This is usually the preprocessor sourcemap. | <code>enableSourcemap</code> | <code>boolean \| { js: boolean; css: boolean; }</code> | If <code>true</code>, Svelte generate sourcemaps for components. Use an object with <code>js</code> or <code>css</code> for more granular control of sourcemap generation. By default, this is <code>true</code>. | <code>outputFilename</code> | <code>null</code> | A <code>string</code> used for your JavaScript sourcemap. | <code>cssOutputFilename</code> | <code>null</code> | A <code>string</code> used for your CSS sourcemap. | <code>sveltePath</code> | <code>"svelte"</code> | The location of the <code>svelte</code> package. Any imports from <code>svelte</code> or <code>svelte/[module]</code> will be modified accordingly. | <code>namespace</code> | <code>"html"</code> | The namespace of the element; e.g., <code>"mathml"</code>, <code>"svg"</code>, <code>"foreign"</code>.<p>The returned <code>result</code> object contains the code for your component, along with useful bits of metadata.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span>
	js<span class="token punctuation">,</span>
	css<span class="token punctuation">,</span>
	ast<span class="token punctuation">,</span>
	warnings<span class="token punctuation">,</span>
	vars<span class="token punctuation">,</span>
	stats
<span class="token punctuation">}</span> <span class="token operator">=</span> svelte<span class="token punctuation">.</span><span class="token method function property-access">compile</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li><code>js</code> and <code>css</code> are objects with the following properties:<ul><li><code>code</code> is a JavaScript string<li><code>map</code> is a sourcemap with additional <code>toString()</code> and <code>toUrl()</code> convenience methods</ul><li><code>ast</code> is an abstract syntax tree representing the structure of your component.<li><code>warnings</code> is an array of warning objects that were generated during compilation. Each warning has several properties:<ul><li><code>code</code> is a string identifying the category of warning<li><code>message</code> describes the issue in human-readable terms<li><code>start</code> and <code>end</code>, if the warning relates to a specific location, are objects with <code>line</code>, <code>column</code> and <code>character</code> properties<li><code>frame</code>, if applicable, is a string highlighting the offending code with line numbers</ul><li><code>vars</code> is an array of the component's declarations, used by <a href="https://github.com/sveltejs/eslint-plugin-svelte3">eslint-plugin-svelte3</a> for example. Each variable has several properties:<ul><li><code>name</code> is self-explanatory<li><code>export_name</code> is the name the value is exported as, if it is exported (will match <code>name</code> unless you do <code>export...as</code>)<li><code>injected</code> is <code>true</code> if the declaration is injected by Svelte, rather than in the code you wrote<li><code>module</code> is <code>true</code> if the value is declared in a <code>context="module"</code> script<li><code>mutated</code> is <code>true</code> if the value's properties are assigned to inside the component<li><code>reassigned</code> is <code>true</code> if the value is reassigned inside the component<li><code>referenced</code> is <code>true</code> if the value is used in the template<li><code>referenced_from_script</code> is <code>true</code> if the value is used in the <code>&#x3C;script></code> outside the declaration<li><code>writable</code> is <code>true</code> if the value was declared with <code>let</code> or <code>var</code> (but not <code>const</code>, <code>class</code> or <code>function</code>)</ul><li><code>stats</code> is an object used by the Svelte developer team for diagnosing the compiler. Avoid relying on it to stay the same!</ul></section><section id="svelteparse"class="level2"><h2><code>svelte.parse</code></h2><pre class="language-js"><code class="language-js"><span class="token literal-property property">ast</span><span class="token operator">:</span> object <span class="token operator">=</span> svelte<span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span>
	<span class="token literal-property property">source</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
	options<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		filename<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
		customElement<span class="token operator">?</span><span class="token operator">:</span> boolean
	<span class="token punctuation">}</span>
<span class="token punctuation">)</span></code></pre><p>The <code>parse</code> function parses a component, returning only its abstract syntax tree. Unlike compiling with the <code>generate: false</code> option, this will not perform any validation or other analysis of the component beyond parsing it. Note that the returned AST is not considered public API, so breaking changes could occur at any point in time.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> svelte <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'svelte/compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ast <span class="token operator">=</span> svelte<span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'App.svelte'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="sveltepreprocess"class="level2"><h2><code>svelte.preprocess</code></h2><p>A number of <a href="https://sveltesociety.dev/tools#preprocessors">community-maintained preprocessing plugins</a> are available to allow you to use Svelte with tools like TypeScript, PostCSS, SCSS, and Less.<p>You can write your own preprocessor using the <code>svelte.preprocess</code> API.<pre class="language-js"><code class="language-js"><span class="token literal-property property">result</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">code</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
	<span class="token literal-property property">dependencies</span><span class="token operator">:</span> <span class="token known-class-name class-name">Array</span><span class="token operator">&#x3C;</span>string<span class="token operator">></span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> svelte<span class="token punctuation">.</span><span class="token method function property-access">preprocess</span><span class="token punctuation">(</span>
	<span class="token literal-property property">source</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
	<span class="token literal-property property">preprocessors</span><span class="token operator">:</span> <span class="token known-class-name class-name">Array</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span>
		markup<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">content</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">filename</span><span class="token operator">:</span> string <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span>
			<span class="token literal-property property">code</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
			dependencies<span class="token operator">?</span><span class="token operator">:</span> <span class="token known-class-name class-name">Array</span><span class="token operator">&#x3C;</span>string<span class="token operator">></span>
		<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">,</span>
		script<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">content</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">markup</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span>string<span class="token punctuation">,</span> string<span class="token operator">></span><span class="token punctuation">,</span> <span class="token literal-property property">filename</span><span class="token operator">:</span> string <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span>
			<span class="token literal-property property">code</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
			dependencies<span class="token operator">?</span><span class="token operator">:</span> <span class="token known-class-name class-name">Array</span><span class="token operator">&#x3C;</span>string<span class="token operator">></span>
		<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">,</span>
		style<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">content</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">markup</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token maybe-class-name">Record</span><span class="token operator">&#x3C;</span>string<span class="token punctuation">,</span> string<span class="token operator">></span><span class="token punctuation">,</span> <span class="token literal-property property">filename</span><span class="token operator">:</span> string <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token punctuation">{</span>
			<span class="token literal-property property">code</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
			dependencies<span class="token operator">?</span><span class="token operator">:</span> <span class="token known-class-name class-name">Array</span><span class="token operator">&#x3C;</span>string<span class="token operator">></span>
		<span class="token punctuation">}</span><span class="token operator">></span>
	<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">,</span>
	options<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		filename<span class="token operator">?</span><span class="token operator">:</span> string
	<span class="token punctuation">}</span>
<span class="token punctuation">)</span></code></pre><p>The <code>preprocess</code> function provides convenient hooks for arbitrarily transforming component source code. For example, it can be used to convert a <code>&#x3C;style lang="sass"></code> block into vanilla CSS.<p>The first argument is the component source code. The second is an array of <em>preprocessors</em> (or a single preprocessor, if you only have one), where a preprocessor is an object with <code>markup</code>, <code>script</code> and <code>style</code> functions, each of which is optional.<p>Each <code>markup</code>, <code>script</code> or <code>style</code> function must return an object (or a Promise that resolves to an object) with a <code>code</code> property, representing the transformed source code, and an optional array of <code>dependencies</code>.<p>The <code>markup</code> function receives the entire component source text, along with the component's <code>filename</code> if it was specified in the third argument.<blockquote><p>Preprocessor functions should additionally return a <code>map</code> object alongside <code>code</code> and <code>dependencies</code>, where <code>map</code> is a sourcemap representing the transformation.</blockquote><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> svelte <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'svelte/compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">MagicString</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'magic-string'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> svelte<span class="token punctuation">.</span><span class="token method function property-access">preprocess</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token function-variable function">markup</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> content<span class="token punctuation">,</span> filename <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> pos <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword control-flow">if</span><span class="token punctuation">(</span>pos <span class="token operator">&#x3C;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> content <span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MagicString</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token punctuation">{</span> filename <span class="token punctuation">}</span><span class="token punctuation">)</span>
		s<span class="token punctuation">.</span><span class="token method function property-access">overwrite</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> pos <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">storeName</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">code</span><span class="token operator">:</span> s<span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token literal-property property">map</span><span class="token operator">:</span> s<span class="token punctuation">.</span><span class="token method function property-access">generateMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'App.svelte'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>script</code> and <code>style</code> functions receive the contents of <code>&#x3C;script></code> and <code>&#x3C;style></code> elements respectively (<code>content</code>) as well as the entire component source text (<code>markup</code>). In addition to <code>filename</code>, they get an object of the element's attributes.<p>If a <code>dependencies</code> array is returned, it will be included in the result object. This is used by packages like <a href="https://github.com/sveltejs/rollup-plugin-svelte">rollup-plugin-svelte</a> to watch additional files for changes, in the case where your <code>&#x3C;style></code> tag has an <code>@import</code> (for example).<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> svelte <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'svelte/compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-sass'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> dirname <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> code<span class="token punctuation">,</span> dependencies <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> svelte<span class="token punctuation">.</span><span class="token method function property-access">preprocess</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token function-variable function">style</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> content<span class="token punctuation">,</span> attributes<span class="token punctuation">,</span> filename <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
		<span class="token comment">// only process &#x3C;style lang="sass"></span>
		<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>attributes<span class="token punctuation">.</span><span class="token property-access">lang</span> <span class="token operator">!==</span> <span class="token string">'sass'</span><span class="token punctuation">)</span> <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>

		<span class="token keyword">const</span> <span class="token punctuation">{</span> css<span class="token punctuation">,</span> stats <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> sass<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token literal-property property">file</span><span class="token operator">:</span> filename<span class="token punctuation">,</span>
			<span class="token literal-property property">data</span><span class="token operator">:</span> content<span class="token punctuation">,</span>
			<span class="token literal-property property">includePaths</span><span class="token operator">:</span> <span class="token punctuation">[</span>
				<span class="token function">dirname</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
			<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword control-flow">else</span> <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">code</span><span class="token operator">:</span> css<span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token literal-property property">dependencies</span><span class="token operator">:</span> stats<span class="token punctuation">.</span><span class="token property-access">includedFiles</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'App.svelte'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Multiple preprocessors can be used together. The output of the first becomes the input to the second. <code>markup</code> functions run first, then <code>script</code> and <code>style</code>.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> svelte <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'svelte/compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> svelte<span class="token punctuation">.</span><span class="token method function property-access">preprocess</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token punctuation">[</span>
	<span class="token punctuation">{</span>
		<span class="token function-variable function">markup</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
			<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'this runs first'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function-variable function">script</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
			<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'this runs third'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function-variable function">style</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
			<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'this runs fifth'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span>
		<span class="token function-variable function">markup</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
			<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'this runs second'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function-variable function">script</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
			<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'this runs fourth'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function-variable function">style</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
			<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'this runs sixth'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'App.svelte'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="sveltewalk"class="level2"><h2><code>svelte.walk</code></h2><pre class="language-js"><code class="language-js"><span class="token function">walk</span><span class="token punctuation">(</span>ast<span class="token operator">:</span> <span class="token maybe-class-name">Node</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token function">enter</span><span class="token punctuation">(</span>node<span class="token operator">:</span> <span class="token maybe-class-name">Node</span><span class="token punctuation">,</span> <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token maybe-class-name">Node</span><span class="token punctuation">,</span> <span class="token literal-property property">prop</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">index</span><span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
	<span class="token function">leave</span><span class="token punctuation">(</span>node<span class="token operator">:</span> <span class="token maybe-class-name">Node</span><span class="token punctuation">,</span> <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token maybe-class-name">Node</span><span class="token punctuation">,</span> <span class="token literal-property property">prop</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">index</span><span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>The <code>walk</code> function provides a way to walk the abstract syntax trees generated by the parser, using the compiler's own built-in instance of <a href="https://github.com/Rich-Harris/estree-walker">estree-walker</a>.<p>The walker takes an abstract syntax tree to walk and an object with two optional methods: <code>enter</code> and <code>leave</code>. For each node, <code>enter</code> is called (if present). Then, unless <code>this.skip()</code> is called during <code>enter</code>, each of the children are traversed, and then <code>leave</code> is called on the node.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> svelte <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'svelte/compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
svelte<span class="token punctuation">.</span><span class="token method function property-access">walk</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">do_something</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">should_skip_children</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">leave</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">do_something_else</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section id="svelteversion"class="level2"><h2><code>svelte.VERSION</code></h2><p>The current version, as set in package.json.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> svelte <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'svelte/compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">running svelte version </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>svelte<span class="token punctuation">.</span><span class="token constant">VERSION</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>