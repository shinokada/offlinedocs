<!doctypehtml><html lang="en"><meta charset="utf-8"><title>References</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css"><section id="references"class="level1"><h1>References</h1><ul><li><a href="#basic-structure">Basic structure</a><ul><li><a href="#example-group">Example group</a><ul><li><a href="#examplegroup--describe--context"><code>ExampleGroup</code> / <code>Describe</code> / <code>Context</code></a></ul><li><a href="#example">Example</a><ul><li><a href="#example--it--specify"><code>Example</code> / <code>It</code> / <code>Specify</code></a></ul><li><a href="#evaluation">Evaluation</a><ul><li><a href="#when-call"><code>When call</code></a><li><a href="#when-run"><code>When run</code></a><ul><li><a href="#about-calling-shell-function-with-run">about calling shell function with run</a></ul><li><a href="#when-run-command"><code>When run command</code></a><li><a href="#when-run-script"><code>When run script</code></a><li><a href="#when-run-source"><code>When run source</code></a><li><a href="#comparison">Comparison</a></ul><li><a href="#expectation">Expectation</a><ul><li><a href="#the--should-not"><code>The</code> ... <code>should (not)</code></a><li><a href="#assert"><code>Assert</code></a></ul><li><a href="#subjects">Subjects</a><ul><li><a href="#stdout-output-subject"><code>stdout</code> (<code>output</code>) subject</a><li><a href="#stderr-error-subject"><code>stderr</code> (<code>error</code>) subject</a><li><a href="#status-subject"><code>status</code> subject</a><li><a href="#line-subject"><code>line</code> subject</a><li><a href="#word-subject"><code>word</code> subject</a><li><a href="#path--file--directory-subject"><code>path</code> / <code>file</code> / <code>directory</code> subject</a><li><a href="#function-subject"><code>function</code> subject</a><li><a href="#value-subject"><code>value</code> subject</a><li><a href="#variable-subject"><code>variable</code> subject</a></ul><li><a href="#modifiers">Modifiers</a><ul><li><a href="#line-modifier"><code>line</code> modifier</a><li><a href="#lines-modifier"><code>lines</code> modifier</a><li><a href="#word-modifier"><code>word</code> modifier</a><li><a href="#length-modifier"><code>length</code> modifier</a><li><a href="#contents-modifier"><code>contents</code> modifier</a><li><a href="#result-modifier"><code>result</code> modifier</a></ul><li><a href="#matchers">Matchers</a><ul><li><a href="#satisfy-matcher"><code>satisfy</code> matcher</a><li><a href="#stat-matchers">stat matchers</a><ul><li><a href="#be-exist-matcher"><code>be exist</code> matcher</a><li><a href="#be-file-matcher"><code>be file</code> matcher</a><li><a href="#be-directory-matcher"><code>be directory</code> matcher</a><li><a href="#be-empty-file-matcher"><code>be empty file</code> matcher</a><li><a href="#be-empty-directory-matcher"><code>be empty directory</code> matcher</a><li><a href="#be-symlink-matcher"><code>be symlink</code> matcher</a><li><a href="#be-pipe-matcher"><code>be pipe</code> matcher</a><li><a href="#be-socket-matcher"><code>be socket</code> matcher</a><li><a href="#be-readable-matcher"><code>be readable</code> matcher</a><li><a href="#be-writable-matcher"><code>be writable</code> matcher</a><li><a href="#be-executable-matcher"><code>be executable</code> matcher</a><li><a href="#be-block_device-matcher"><code>be block_device</code> matcher</a><li><a href="#be-character_device-matcher"><code>be character_device</code> matcher</a><li><a href="#have-setgid-matcher"><code>have setgid</code> matcher</a><li><a href="#have-setuid-matcher"><code>have setuid</code> matcher</a></ul><li><a href="#status-matchers">status matchers</a><ul><li><a href="#be-success-matcher"><code>be success</code> matcher</a><li><a href="#be-failure-matcher"><code>be failure</code> matcher</a></ul><li><a href="#string-matchers">string matchers</a><ul><li><a href="#equal-matcher"><code>equal</code> matcher</a><li><a href="#start-with-matcher"><code>start with</code> matcher</a><li><a href="#end-with-matcher"><code>end with</code> matcher</a><li><a href="#include-matcher"><code>include</code> matcher</a><li><a href="#match-pattern-matcher"><code>match pattern</code> matcher</a></ul><li><a href="#successful-matcher"><code>successful</code> matcher</a><li><a href="#valid-matchers">valid matchers</a><li><a href="#variable-matchers">variable matchers</a><ul><li><a href="#be-defined-matcher"><code>be defined</code> matcher</a><li><a href="#be-undefined-matcher"><code>be undefined</code> matcher</a><li><a href="#be-present-matcher"><code>be present</code> matcher</a><li><a href="#be-blank-matcher"><code>be blank</code> matcher</a><li><a href="#be-exported-matcher"><code>be exported</code> matcher</a><li><a href="#be-readonly-matcher"><code>be readonly</code> matcher</a></ul></ul></ul><li><a href="#helper">Helper</a><ul><li><a href="#skip--pending">Skip / Pending</a><ul><li><a href="#skip"><code>Skip</code></a><li><a href="#skip-if"><code>Skip if</code></a><li><a href="#pending"><code>Pending</code></a><li><a href="#todo"><code>Todo</code></a></ul><li><a href="#data">Data</a><ul><li><a href="#dataraw"><code>Data[:raw]</code></a><li><a href="#dataexpand"><code>Data:expand</code></a><li><a href="#data-function"><code>Data &#x3C;FUNCTION></code></a><li><a href="#data-string"><code>Data "&#x3C;STRING>"</code></a><li><a href="#data--file"><code>Data &#x3C; "&#x3C;FILE>"</code></a></ul><li><a href="#parameters">Parameters</a><ul><li><a href="#parametersblock"><code>Parameters[:block]</code></a><li><a href="#parametersvalue"><code>Parameters:value</code></a><li><a href="#parametersmatrix"><code>Parameters:matrix</code></a><li><a href="#parametersdynamic"><code>Parameters:dynamic</code></a></ul><li><a href="#others">Others</a><ul><li><a href="#include"><code>Include</code></a><li><a href="#path--file--dir"><code>Path</code> / <code>File</code> / <code>Dir</code></a><li><a href="#intercept"><code>Intercept</code></a><li><a href="#set"><code>Set</code></a><li><a href="#dump"><code>Dump</code></a></ul></ul><li><a href="#hooks">Hooks</a><ul><li><a href="#before--after"><code>Before</code> / <code>After</code></a><li><a href="#beforeall--afterall"><code>BeforeAll</code> / <code>AfterAll</code></a><li><a href="#beforecall--aftercall"><code>BeforeCall</code> / <code>AfterCall</code></a><li><a href="#beforerun--afterrun"><code>BeforeRun</code> / <code>AfterRun</code></a></ul><li><a href="#directive">Directive</a><ul><li><a href="#const-"><code>%const</code> (<code>%</code>)</a><li><a href="#text"><code>%text</code></a><li><a href="#puts----putsn-"><code>%puts</code> (<code>%-</code>) / <code>%putsn</code> (<code>%=</code>)</a><li><a href="#preserve">%preserve</a><li><a href="#logger"><code>%logger</code></a></ul><li><a href="#special-environment-variables">Special environment Variables</a></ul><section id="basic-structure"class="level2"><h2>Basic structure</h2><p>You can write a structured <em>Example</em> by using the DSL shown below:<section id="example-group"class="level3"><h3>Example group</h3><table><thead><tr><th align="left">DSL<th align="left">Description<tbody><tr><td align="left">ExampleGroup ... End<td align="left">Define an example group.<tr><td align="left">Describe ... End<td align="left">Synonym for <code>ExampleGroup</code>.<tr><td align="left">Context ... End<td align="left">Synonym for <code>ExampleGroup</code>.</table><section id="examplegroup--describe--context"class="level4"><h4><code>ExampleGroup</code> / <code>Describe</code> / <code>Context</code></h4><p>Example groups are nestable.</section></section><section id="example"class="level3"><h3>Example</h3><table><thead><tr><th align="left">DSL<th align="left">Description<tbody><tr><td align="left">Example ... End<td align="left">Define an example.<tr><td align="left">It ... End<td align="left">Synonym for <code>Example</code>.<tr><td align="left">Specify ... End<td align="left">Synonym for <code>Example</code>.</table><section id="example--it--specify"class="level4"><h4><code>Example</code> / <code>It</code> / <code>Specify</code></h4></section></section><section id="evaluation"class="level3"><h3>Evaluation</h3><p>The line beginning with <code>When</code> is the evaluation.<table><thead><tr><th align="left">Evaluation<th align="left">Description<tbody><tr><td align="left">When call<td align="left">Call shell function without subshell.<tr><td align="left">When run<td align="left">Run shell function or external command within a subshell.<tr><td align="left">When run command<td align="left">Run external command (including non-shell scripts).<tr><td align="left">When run script<td align="left">Run shell script by new process of the current shell.<tr><td align="left">When run source<td align="left">Run shell script in the current shell by <code>.</code> command (aka <code>source</code>).</table><section id="when-call"class="level4"><h4><code>When call</code></h4><pre class="language-sh"><code class="language-sh">When call &#x3C;FUNCTION> [ARGUMENTS...]</code></pre><p>This is primarily designed for shell function calls. It is the recommended evaluation as a unit test. It does not use a subshell, therefore it is the fastest evaluation variant and you can assert variables.</section><section id="when-run"class="level4"><h4><code>When run</code></h4><pre class="language-sh"><code class="language-sh">When run &#x3C;FUNCTION | COMMAND> [ARGUMENTS...]</code></pre><p>This is primarily designed for external command calls. The external command does not have to be a shell script. Even shell scripts are executed as external commands according to the shebang, so they are not covered by the coverage.<section id="about-calling-shell-function-with-run"class="level5"><h5>about calling shell function with run</h5><p>If a shell function is specified, it will be executed in a subshell. The slight advantage of executing shell functions with <code>run</code> is that you can trap errors with <code>set -e</code>. Unlike <code>call</code>, it does not cause an error, so you can assert the exit status.<p>Also, because of the execution in the subshell, the variables which change values in the function are restored once <code>run</code> finishes. This is often a disadvantage, but tests of ShellSpec itself intentionally use <code>run</code> because changing internal variables confuses ShellSpec's behavior.<p>If you want to assert variables with <code>run</code>, use the <code>%preserve</code> directive in function called by <code>AfterRun</code> hook. It can preserve variables even if <code>run</code> exits the subshell.</section></section><section id="when-run-command"class="level4"><h4><code>When run command</code></h4><pre class="language-sh"><code class="language-sh">When run command &#x3C;COMMAND> [ARGUMENTS...]</code></pre><p>Run an external command explicitly. The external command does not have to be a shell script. Even shell scripts are executed as external commands according to the shebang, so they are not covered by the coverage.</section><section id="when-run-script"class="level4"><h4><code>When run script</code></h4><pre class="language-sh"><code class="language-sh">When run script &#x3C;SCRIPT> [ARGUMENTS...]</code></pre><p>Run the external shell script in the same shell as the currently running shell.</section><section id="when-run-source"class="level4"><h4><code>When run source</code></h4><pre class="language-sh"><code class="language-sh">When run source &#x3C;SCRIPT> [ARGUMENTS...]</code></pre><p>This is similar to <code>run script</code>, but simulates the running of shell scripts using the <code>.</code> command instead of running directly.<p>The advantage over <code>run script</code> is that you can use <code>Intercept</code> to intercept at any point in the external shell script. This is useful for preparation testing and mocking with shell functions.</section><section id="comparison"class="level4"><h4>Comparison</h4><table><thead><tr><th><th><code>call</code><th><code>run</code><th><code>run command</code><th><code>run script</code><th><code>run source</code><tbody><tr><td>Run in subshell<td>No<td>Yes<td>Yes<td>Yes<td>Yes<tr><td>Target<td>function<td>function / command<td>command<td>shell script<td>shell script<tr><td>Stop with <code>set -e</code><td>No<td>Yes<td>-<td>Yes<td>Yes<tr><td>Catch <code>exit</code><td>No<td>Yes<td>-<td>Yes<td>Yes<tr><td>Expectation Hooks<td>BeforeCall / AfterCall<td>BeforeRun / AfterRun<td>BeforeRun / AfterRun<td>BeforeRun / AfterRun<td>BeforeRun / AfterRun<tr><td>Intercept<td>No<td>No<td>-<td>No<td>Yes<tr><td>Coverage<td>Yes<td>Yes (function only)<td>No<td>Yes<td>Yes</table></section></section><section id="expectation"class="level3"><h3>Expectation</h3><section id="the--should-not"class="level4"><h4><code>The</code> ... <code>should (not)</code></h4><p>The line beginning with <code>The</code> is the evaluation. The <em>subject</em> or the <em>modifier</em> follows after <code>The</code>. And last is the <em>matcher</em>.<pre class="language-sh"><code class="language-sh">The [MODIFIER of...] &#x3C;SUBJECT> should &#x3C;MATCHER>
The [MODIFIER of...] &#x3C;SUBJECT> should not &#x3C;MATCHER></code></pre></section><section id="assert"class="level4"><h4><code>Assert</code></h4><pre class="language-sh"><code class="language-sh">Assert &#x3C;FUNCTION> [ARGUMENTS...]</code></pre></section></section><section id="subjects"class="level3"><h3>Subjects</h3><table><thead><tr><th align="left">Subject<th align="left">Description<tbody><tr><td align="left">stdout / output<td align="left">Use the stdout of <em>Evaluation</em> as subject.<tr><td align="left">line<td align="left">Same as <code>line NUMBER of stdout</code>.<tr><td align="left">word<td align="left">Same as <code>word NUMBER of stdout</code>.<tr><td align="left">stderr / error<td align="left">Use the stderr of <em>Evaluation</em> as subject.<tr><td align="left">status<td align="left">Use the status of <em>Evaluation</em> as subject.<tr><td align="left">path / file / directory<td align="left">Use the alias resolved path as the subject.<tr><td align="left">value<td align="left">Use the value as the subject.<tr><td align="left">function<td align="left">Use the function name as the subject.<tr><td align="left">variable<td align="left">Use the value of the variable as the subject.</table><section id="stdout-output-subject"class="level4"><h4><code>stdout</code> (<code>output</code>) subject</h4><pre class="language-sh"><code class="language-sh">The stdout should equal "foo"
The output should equal "foo"</code></pre></section><section id="stderr-error-subject"class="level4"><h4><code>stderr</code> (<code>error</code>) subject</h4><pre class="language-sh"><code class="language-sh">The stderr should equal "foo"
The error should equal "foo"</code></pre></section><section id="status-subject"class="level4"><h4><code>status</code> subject</h4><pre class="language-sh"><code class="language-sh">The status should be success</code></pre></section><section id="line-subject"class="level4"><h4><code>line</code> subject</h4><p>When combined with line, <code>stdout</code> can be omitted.<pre class="language-sh"><code class="language-sh">The line 1 of stdout should equal foo
The line 1 should equal foo # stdout omitted</code></pre></section><section id="word-subject"class="level4"><h4><code>word</code> subject</h4><p>When combined with word, <code>stdout</code> can be omitted.<pre class="language-sh"><code class="language-sh">The word 1 of stdout should equal foo
The word 1 should equal foo # stdout omitted</code></pre></section><section id="path--file--directory-subject"class="level4"><h4><code>path</code> / <code>file</code> / <code>directory</code> subject</h4><pre class="language-sh"><code class="language-sh">Path data-file=/tmp/data.txt
The path data-file should exist</code></pre></section><section id="function-subject"class="level4"><h4><code>function</code> subject</h4><pre class="language-sh"><code class="language-sh">The result of function foo should be successful
The result of "foo()" should be successful # shorthand</code></pre></section><section id="value-subject"class="level4"><h4><code>value</code> subject</h4><pre class="language-sh"><code class="language-sh">The value "foo" should equal "foo"</code></pre><p>I do not recommend using this subject as it may not generate clear failure messages. Use the <code>variable</code> subject instead.</section><section id="variable-subject"class="level4"><h4><code>variable</code> subject</h4><pre class="language-sh"><code class="language-sh">The variable var should equal "foo"</code></pre></section></section><section id="modifiers"class="level3"><h3>Modifiers</h3><table><thead><tr><th align="left">Modifier<th align="left">Description<tbody><tr><td align="left">line<td align="left">The specified line of the subject.<tr><td align="left">lines<td align="left">The number of lines of the subject.<tr><td align="left">word<td align="left">The specified word of the subject.<tr><td align="left">length<td align="left">The length of the subject.<tr><td align="left">contents<td align="left">The contents of the file as subject.<tr><td align="left">result<td align="left">The result of the function as subject.</table><section id="line-modifier"class="level4"><h4><code>line</code> modifier</h4><pre class="language-sh"><code class="language-sh">The line 1 of stdout should equal "line1"</code></pre></section><section id="lines-modifier"class="level4"><h4><code>lines</code> modifier</h4><pre class="language-sh"><code class="language-sh">The lines of stdout should equal 5</code></pre></section><section id="word-modifier"class="level4"><h4><code>word</code> modifier</h4><pre class="language-sh"><code class="language-sh">The word 2 of stdout should equal "word2"</code></pre></section><section id="length-modifier"class="level4"><h4><code>length</code> modifier</h4><pre class="language-sh"><code class="language-sh">The length of value "abcd" should equal 5</code></pre></section><section id="contents-modifier"class="level4"><h4><code>contents</code> modifier</h4><pre class="language-sh"><code class="language-sh">The contents of file "/tmp/file.txt" should equal "temp data"</code></pre></section><section id="result-modifier"class="level4"><h4><code>result</code> modifier</h4><pre class="language-sh"><code class="language-sh">get_version() {
  # The result of the evaluation is passed as arguments
  # $1: stdout, $2: stderr, $3: status
  echo "$1" | grep -o '[0-9.]*' | head -1
}

When call echo "GNU bash, version 4.4.20(1)-release (x86_64-pc-linux-gnu)"
The result of function get_version should equal "4.4.20"
The result of "get_version()" should equal "4.4.20" # shorthand</code></pre><pre class="language-sh"><code class="language-sh">check_version() {
  # The result of the evaluation is passed as arguments
  # $1: stdout, $2: stderr, $3: status
  [ "$("$1" | grep -o '[0-9.]*' | head -1)" = "4.4.20" ]
}

When call echo "GNU bash, version 4.4.20(1)-release (x86_64-pc-linux-gnu)"
The result of function check_version should be successful
The result of "check_version()" should be successful # shorthand</code></pre></section></section><section id="matchers"class="level3"><h3>Matchers</h3><section id="satisfy-matcher"class="level4"><h4><code>satisfy</code> matcher</h4><table><thead><tr><th align="left">Matcher<th align="left">Description<tbody><tr><td align="left">satisfy<td align="left">The subject should satisfy <code>&#x3C;FUNCTION></code></table><pre class="language-sh"><code class="language-sh">satisfy &#x3C;FUNCTION> [ARGUMENTS...]</code></pre><p>satisfy examples<pre class="language-sh"><code class="language-sh">value() {
  # The subject is stored in the same variable name as the function name
  test "${value:?}" "$1" "$2"
}

formula() {
  value=${formula:?}
  [ $(($1)) -eq 1 ]
}

When call echo "50"
The output should satisfy value -gt 10
The output should satisfy formula "10 &#x3C;= value &#x26;&#x26; value &#x3C;= 100"</code></pre></section><section id="stat-matchers"class="level4"><h4>stat matchers</h4><p>the subject expected file path<table><thead><tr><th align="left">Matcher<th align="left">Description<tbody><tr><td align="left">exist<td align="left">The file should exist.<tr><td align="left"><del>be exist</del><td align="left">The file should exist. (deprecated)<tr><td align="left">be file<td align="left">The file should be a file.<tr><td align="left">be directory<td align="left">The file should be a directory.<tr><td align="left">be empty file<td align="left">The file should be an empty file.<tr><td align="left">be empty directory<td align="left">The directory should be an empty directory.<tr><td align="left">be symlink<td align="left">The file should be a symlink.<tr><td align="left">be pipe<td align="left">The file should be a pipe.<tr><td align="left">be socket<td align="left">The file should be a socket.<tr><td align="left">be readable<td align="left">The file should be readable.<tr><td align="left">be writable<td align="left">The file should be writable.<tr><td align="left">be executable<td align="left">The file should be executable.<tr><td align="left">be block_device<td align="left">The file should be a block device.<tr><td align="left">be character_device<td align="left">The file should be a character device.<tr><td align="left"><del>has setgid</del><td align="left">The file should have the setgid flag set. (deprecated)<tr><td align="left">have setgid<td align="left">The file should have the setgid flag set.<tr><td align="left"><del>has setuid</del><td align="left">The file should have the setuid flag set. (deprecated)<tr><td align="left">have setuid<td align="left">The file should have the setuid flag set.</table><section id="exist-matcher"class="level5"><h5><code>exist</code> matcher</h5><pre class="language-sh"><code class="language-sh">The path /target/path should exist</code></pre><p>or<pre class="language-sh"><code class="language-sh">The path /target/path should be exist</code></pre></section><section id="be-file-matcher"class="level5"><h5><code>be file</code> matcher</h5><pre class="language-sh"><code class="language-sh">The path /target/path should be file</code></pre></section><section id="be-directory-matcher"class="level5"><h5><code>be directory</code> matcher</h5><pre class="language-sh"><code class="language-sh">The path /target/path should be directory
The path /target/path should be dir</code></pre></section><section id="be-empty-file-matcher"class="level5"><h5><code>be empty file</code> matcher</h5><pre class="language-sh"><code class="language-sh">The path /target/path should be empty file</code></pre></section><section id="be-empty-directory-matcher"class="level5"><h5><code>be empty directory</code> matcher</h5><pre class="language-sh"><code class="language-sh">The path /target/path should be empty directory
The path /target/path should be empty dir</code></pre></section><section id="be-symlink-matcher"class="level5"><h5><code>be symlink</code> matcher</h5><pre class="language-sh"><code class="language-sh">The path /target/path should be symlink</code></pre></section><section id="be-pipe-matcher"class="level5"><h5><code>be pipe</code> matcher</h5><pre class="language-sh"><code class="language-sh">The path /target/path should be pipe</code></pre></section><section id="be-socket-matcher"class="level5"><h5><code>be socket</code> matcher</h5><pre class="language-sh"><code class="language-sh">The path /target/path should be socket</code></pre></section><section id="be-readable-matcher"class="level5"><h5><code>be readable</code> matcher</h5><pre class="language-sh"><code class="language-sh">The path /target/path should be readable</code></pre></section><section id="be-writable-matcher"class="level5"><h5><code>be writable</code> matcher</h5><pre class="language-sh"><code class="language-sh">The path /target/path should be writable</code></pre></section><section id="be-executable-matcher"class="level5"><h5><code>be executable</code> matcher</h5><pre class="language-sh"><code class="language-sh">The path /target/path should be executable</code></pre></section><section id="be-block_device-matcher"class="level5"><h5><code>be block_device</code> matcher</h5><pre class="language-sh"><code class="language-sh">The path /target/path should be block_device</code></pre></section><section id="be-character_device-matcher"class="level5"><h5><code>be character_device</code> matcher</h5><pre class="language-sh"><code class="language-sh">The path /target/path should be character_device</code></pre></section><section id="have-setgid-matcher"class="level5"><h5><code>have setgid</code> matcher</h5><pre class="language-sh"><code class="language-sh">The path /target/path should have setgid</code></pre></section><section id="have-setuid-matcher"class="level5"><h5><code>have setuid</code> matcher</h5><pre class="language-sh"><code class="language-sh">The path /target/path should have setuid</code></pre></section></section><section id="status-matchers"class="level4"><h4>status matchers</h4><p>the subject expected status<table><thead><tr><th align="left">Matcher<th align="left">Description<tbody><tr><td align="left">be success<td align="left">The status should be success (<code>0</code>).<tr><td align="left">be failure<td align="left">The status should be failure (<code>1</code> - <code>255</code>).</table><section id="be-success-matcher"class="level5"><h5><code>be success</code> matcher</h5><pre class="language-sh"><code class="language-sh">The status should be success</code></pre></section><section id="be-failure-matcher"class="level5"><h5><code>be failure</code> matcher</h5><pre class="language-sh"><code class="language-sh">The status should be failure</code></pre></section></section><section id="string-matchers"class="level4"><h4>string matchers</h4><table><thead><tr><th align="left">Matcher<th align="left">Description<tbody><tr><td align="left">equal <code>&#x3C;STRING></code><br>eq <code>&#x3C;STRING></code><td align="left">The subject should equal <code>&#x3C;STRING></code><tr><td align="left">start with <code>&#x3C;STRING></code><td align="left">The subject should start with <code>&#x3C;STRING></code><tr><td align="left">end with <code>&#x3C;STRING></code><td align="left">The subject should end with <code>&#x3C;STRING></code><tr><td align="left">include <code>&#x3C;STRING></code><td align="left">The subject should include <code>&#x3C;STRING></code><tr><td align="left">match pattern <code>&#x3C;PATTERN></code><td align="left">The subject should match pattern <code>&#x3C;PATTERN></code></table><section id="equal-matcher"class="level5"><h5><code>equal</code> matcher</h5><pre class="language-sh"><code class="language-sh">The output should equal &#x3C;STRING>
The output should eq &#x3C;STRING></code></pre></section><section id="start-with-matcher"class="level5"><h5><code>start with</code> matcher</h5><pre class="language-sh"><code class="language-sh">The output should start with &#x3C;STRING></code></pre></section><section id="end-with-matcher"class="level5"><h5><code>end with</code> matcher</h5><pre class="language-sh"><code class="language-sh">The output should end with &#x3C;STRING></code></pre></section><section id="include-matcher"class="level5"><h5><code>include</code> matcher</h5><pre class="language-sh"><code class="language-sh">The output should include &#x3C;STRING></code></pre></section><section id="match-pattern-matcher"class="level5"><h5><code>match pattern</code> matcher</h5><pre class="language-sh"><code class="language-sh">The output should match pattern &#x3C;PATTERN></code></pre><p>PATTERN examples<ul><li><code>foo*</code><li><code>foo?</code><li><code>[fF]oo</code><li><code>[!F]oo</code><li><code>[a-z]</code><li><code>foo|bar</code></ul></section></section><section id="successful-matcher"class="level4"><h4><code>successful</code> matcher</h4><p>Use with <a href="#result">result</a> modifier.</section><section id="valid-matchers"class="level4"><h4>valid matchers</h4><p><strong>Plan to deprecate in the future.</strong><table><thead><tr><th align="left">Matcher<th align="left">Description<tbody><tr><td align="left">be valid number<td align="left">The subject should be a valid number.<tr><td align="left">be valid funcname<td align="left">The subject should be a valid funcname.</table></section><section id="variable-matchers"class="level4"><h4>variable matchers</h4><p>the subject expect variable<table><thead><tr><th align="left">Matcher<th align="left">Description<tbody><tr><td align="left">be defined<td align="left">The variable should be defined (set).<tr><td align="left">be undefined<td align="left">The variable should be undefined (unset).<tr><td align="left">be present<td align="left">The variable should be present (non-zero length string).<tr><td align="left">be blank<td align="left">The variable should be blank (unset or zero length string).<tr><td align="left">be exported<td align="left">The variable should be exported.<tr><td align="left">be readonly<td align="left">The variable should be readonly.</table><section id="be-defined-matcher"class="level5"><h5><code>be defined</code> matcher</h5><pre class="language-sh"><code class="language-sh">The variable VAR should be defined</code></pre></section><section id="be-undefined-matcher"class="level5"><h5><code>be undefined</code> matcher</h5><pre class="language-sh"><code class="language-sh">The variable VAR should be undefined</code></pre></section><section id="be-present-matcher"class="level5"><h5><code>be present</code> matcher</h5><pre class="language-sh"><code class="language-sh">The variable VAR should be present</code></pre></section><section id="be-blank-matcher"class="level5"><h5><code>be blank</code> matcher</h5><pre class="language-sh"><code class="language-sh">The variable VAR should be blank</code></pre></section><section id="be-exported-matcher"class="level5"><h5><code>be exported</code> matcher</h5><pre class="language-sh"><code class="language-sh">The variable VAR should be exported</code></pre></section><section id="be-readonly-matcher"class="level5"><h5><code>be readonly</code> matcher</h5><pre class="language-sh"><code class="language-sh">The variable VAR should be readonly</code></pre></section></section></section></section><section id="helper"class="level2"><h2>Helper</h2><section id="skip--pending"class="level3"><h3>Skip / Pending</h3><table><thead><tr><th align="left">DSL<th align="left">Description<tbody><tr><td align="left">Skip <code>&#x3C;REASON></code><td align="left">Skip current block.<tr><td align="left">Skip if <code>&#x3C;REASON></code> <code>&#x3C;FUNCTION> [ARGUMENTS...]</code><td align="left">Skip current block with conditional.<tr><td align="left">Pending <code>&#x3C;REASON></code><td align="left">Pending current block.<tr><td align="left">Todo<td align="left">Define pending example</table><section id="skip"class="level4"><h4><code>Skip</code></h4></section><section id="skip-if"class="level4"><h4><code>Skip if</code></h4></section><section id="pending"class="level4"><h4><code>Pending</code></h4></section><section id="todo"class="level4"><h4><code>Todo</code></h4></section></section><section id="data"class="level3"><h3>Data</h3><table><thead><tr><th align="left">DSL<th align="left">Description<tbody><tr><td align="left">Data[:raw]<br>#|...<br>End<td align="left">Define stdin data for evaluation (without expand variables).<tr><td align="left">Data:expand<br>#|...<br>End<td align="left">Define stdin data for evaluation (with expand variables).<tr><td align="left">Data <code>&#x3C;FUNCTION> [ARGUMENTS...]</code><td align="left">Use function for stdin data for evaluation.<tr><td align="left">Data <code>"&#x3C;STRING>"</code><br>Data <code>'&#x3C;STRING>'</code><td align="left">Use string for stdin data for evaluation.<tr><td align="left">Data <code>&#x3C; &#x3C;FILE></code><td align="left">Use file for stdin data for evaluation.</table><p>NOTE: The <code>Data</code> helper can also be used with filters.<pre class="language-sh"><code class="language-sh">Data | tr 'abc' 'ABC' # comment
#|aaa
#|bbb
#|ccc
End</code></pre><section id="dataraw"class="level4"><h4><code>Data[:raw]</code></h4><pre class="language-sh"><code class="language-sh">Describe 'Data helper'
  Example 'provide with Data helper block style'
    Data
      #|item1 123
      #|item2 456
      #|item3 789
    End
    When call awk '{total+=$2} END{print total}'
    The output should eq 1368
  End
End</code></pre></section><section id="dataexpand"class="level4"><h4><code>Data:expand</code></h4></section><section id="data-function"class="level4"><h4><code>Data &#x3C;FUNCTION></code></h4></section><section id="data-string"class="level4"><h4><code>Data "&#x3C;STRING>"</code></h4></section><section id="data--file"class="level4"><h4><code>Data &#x3C; "&#x3C;FILE>"</code></h4></section></section><section id="parameters"class="level3"><h3>Parameters</h3><table><thead><tr><th align="left">DSL<th align="left">Description<tbody><tr><td align="left">Parameters ... End<td align="left">Define parameters (block style)<tr><td align="left">Parameters:block ... End<td align="left">Same as Parameters<tr><td align="left">Parameters:value <code>[VALUES...]</code><td align="left">Define parameters (value style)<tr><td align="left">Parameters:matrix ... End<td align="left">Define parameters (matrix style)<tr><td align="left">Parameters:dynamic ... End<td align="left">Define parameters (dynamic style)</table><p>NOTE: Multiple <code>Parameters</code> definitions are merged.<section id="parametersblock"class="level4"><h4><code>Parameters[:block]</code></h4><pre class="language-sh"><code class="language-sh">Describe 'example'
  Parameters
    "#1" 1 2 3
    "#2" 1 2 3
  End

  Example "example $1"
    When call echo "$(($2 + $3))"
    The output should eq "$4"
  End
End</code></pre></section><section id="parametersvalue"class="level4"><h4><code>Parameters:value</code></h4><pre class="language-sh"><code class="language-sh">Parameters:value foo bar baz</code></pre></section><section id="parametersmatrix"class="level4"><h4><code>Parameters:matrix</code></h4><pre class="language-sh"><code class="language-sh">Parameters:matrix
  foo bar
  1 2

  # expanded as follows
  #   foo 1
  #   foo 2
  #   bar 1
  #   bar 2
End</code></pre></section><section id="parametersdynamic"class="level4"><h4><code>Parameters:dynamic</code></h4><pre class="language-sh"><code class="language-sh">Parameters:dynamic
  for i in 1 2 3; do
    %data "#$i" 1 2 3
  done
End</code></pre><p>Only <code>%data</code> directives can be used within a <code>Parameters:dynamic</code> block. You can not call a function or access variables defined within the specfile. You can refer to variables defined with <code>%const</code>.</section></section><section id="others"class="level3"><h3>Others</h3><table><thead><tr><th align="left">DSL<th align="left">Description<tbody><tr><td align="left">Include <code>&#x3C;NAME></code><td align="left">Include other files.<tr><td align="left">Path<br>File<br>Dir<td align="left">Define a path alias.<tr><td align="left">Intercept <code>[NAMES...]</code><td align="left">Define an interceptor.<tr><td align="left">Set <code>[OPTION:&#x3C;on | off>...]</code><td align="left">Set shell option before running each example.<tr><td align="left">Dump<td align="left">Dump stdout, stderr and status for debugging.</table><section id="include"class="level4"><h4><code>Include</code></h4></section><section id="path--file--dir"class="level4"><h4><code>Path</code> / <code>File</code> / <code>Dir</code></h4></section><section id="intercept"class="level4"><h4><code>Intercept</code></h4></section><section id="set"class="level4"><h4><code>Set</code></h4></section><section id="dump"class="level4"><h4><code>Dump</code></h4></section></section></section><section id="hooks"class="level2"><h2>Hooks</h2><table><thead><tr><th align="left">DSL<th align="left">Description<tbody><tr><td align="left">Before<td align="left">Define a hook called before running each example.<tr><td align="left">After<td align="left">Define a hook called after running each example.<tr><td align="left">BeforeAll<td align="left"><tr><td align="left">AfterAll<td align="left"><tr><td align="left">BeforeCall<td align="left"><tr><td align="left">AfterCall<td align="left"><tr><td align="left">BeforeRun<td align="left"><tr><td align="left">AfterRun<td align="left"></table><section id="before--after"class="level3"><h3><code>Before</code> / <code>After</code></h3></section><section id="beforeall--afterall"class="level3"><h3><code>BeforeAll</code> / <code>AfterAll</code></h3></section><section id="beforecall--aftercall"class="level3"><h3><code>BeforeCall</code> / <code>AfterCall</code></h3></section><section id="beforerun--afterrun"class="level3"><h3><code>BeforeRun</code> / <code>AfterRun</code></h3></section></section><section id="directive"class="level2"><h2>Directive</h2><table><thead><tr><th align="left">Directive<th align="left">Description<tbody><tr><td align="left">%const, %<td align="left">Define a constant variable.<tr><td align="left">%text<td align="left">Define a multiline texts to output to stdout.<tr><td align="left">%putsn, %=<td align="left">Output arguments with the newline.<tr><td align="left">%puts, %-<td align="left">Output arguments.<tr><td align="left">%logger<td align="left">Output log message.</table><section id="const-"class="level3"><h3><code>%const</code> (<code>%</code>)</h3><pre class="language-sh"><code class="language-sh">% &#x3C;VERNAME>: "&#x3C;VALUE>"</code></pre></section><section id="text"class="level3"><h3><code>%text</code></h3></section><section id="puts----putsn-"class="level3"><h3><code>%puts</code> (<code>%-</code>) / <code>%putsn</code> (<code>%=</code>)</h3></section><section id="preserve"class="level3"><h3>%preserve</h3><p>Use this with the <code>When run</code> evaluation.</section><section id="logger"class="level3"><h3><code>%logger</code></h3></section></section><section id="special-environment-variables"class="level2"><h2>Special environment Variables</h2><p>ShellSpec provides special environment variables with prefix <code>SHELLSPEC_</code>. They are useful for writing tests and extensions. I'll try to avoid making breaking changes to these, but can't guarantee it. There are many undocumented variables. You can use them at your own risk.<p>These variables can be overridden by the <code>--env-from</code> option, except for some variables. This is an assumed usage, but has not been fully tested. It is recommended to use it as read-only.<table><thead><tr><th align="left">Name<th align="left">Description<th>Value<tbody><tr><td align="left">SHELLSPEC_ROOT<td align="left">ShellSpec root directory<td><tr><td align="left">SHELLSPEC_LIB<td align="left">ShellSpec lib directory<td><code>${SHELLSPEC_ROOT}/lib</code><tr><td align="left">SHELLSPEC_LIBEXEC<td align="left">ShellSpec libexec directory<td><code>${SHELLSPEC_ROOT}/libexec</code><tr><td align="left">SHELLSPEC_TMPDIR<td align="left">Temporary directory<td><code>${TMPDIR}</code> or <code>/tmp</code> if not specified.<tr><td align="left">SHELLSPEC_TMPBASE<td align="left">Temporary directory used by ShellSpec<td><code>${SHELLSPEC_TMPDIR}/shellspec.${SHELLSPEC_UNIXTIME}.$$</code>.<tr><td align="left">SHELLSPEC_WORKDIR<td align="left">Temporary directory for each spec number<td><code>${SHELLSPEC_TMPBASE}/${SHELLSPEC_SPEC_NO}</code>.<tr><td align="left">SHELLSPEC_PROJECT_ROOT<td align="left">Where <code>.shellspec</code> is located<td><tr><td align="left"><del>SHELLSPEC_SPECDIR</del><td align="left">Specfiles directory<td><code>${SHELLSPEC_PROJECT_ROOT}/spec</code> [depricated]<tr><td align="left">SHELLSPEC_HELPERDIR<td align="left">spec_helper directory<td><code>${SHELLSPEC_PROJECT_ROOT}/spec</code> (default)<tr><td align="left">SHELLSPEC_LOAD_PATH<td align="left">Load path of library<td><code>${SHELLSPEC_SPECDIR}:${SHELLSPEC_LIB}:${SHELLSPEC_LIB}/formatters</code><tr><td align="left">SHELLSPEC_UNIXTIME<td align="left">Unix Time when ShellSpec starts<td><tr><td align="left">SHELLSPEC_SPECFILE<td align="left">Current running specfile path<td><tr><td align="left">SHELLSPEC_SPEC_NO<td align="left">Current specfile number<td><tr><td align="left">SHELLSPEC_GROUP_ID<td align="left">Current group ID<td>e.g. <code>1-2</code><tr><td align="left">SHELLSPEC_EXAMPLE_ID<td align="left">Current example ID (including group ID)<td>e.g. <code>1-2-3</code><tr><td align="left">SHELLSPEC_EXAMPLE_NO<td align="left">Current serial number of example<td></table><p><span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>