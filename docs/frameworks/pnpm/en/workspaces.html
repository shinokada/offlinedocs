<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Workspace</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css">
  </head>
  <body>
    <section id="workspace" class="level1">
      <h1>Workspace</h1>
      <p>
        pnpm has built-in support for monorepositories (AKA multi-package repositories,
        multi-project repositories, or monolithic repositories). You can create a
        workspace to unite multiple projects inside a single repository.
      </p>
      <p>
        A workspace must have a <a href="pnpm-workspace_yaml.html)"><code>pnpm-workspace.yaml</code></a> file in its
        root. A workspace also may have an <a href="npmrc.html)"><code>.npmrc</code></a> in its root.
      </p>
      <blockquote>
        <p>
          If you are looking into monorepo management, you might also want to look into [Bit].
          Bit uses pnpm under the hood but automates a lot of the things that are currently done manually in a traditional workspace managed by pnpm/npm/Yarn. There's an article about <code>bit install</code> that talks about it: [Painless Monorepo Dependency Management with Bit].
        </p>
      </blockquote>
      <p>
        <a href="https://bit.dev/?utm_source=pnpm&#x26;utm_medium=workspace_page">Bit</a>
        <a href="https://bit.cloud/blog/painless-monorepo-dependency-management-with-bit-l4f9fzyw?utm_source=pnpm&#x26;utm_medium=workspace_page">Painless Monorepo Dependency Management with Bit</a>
      </p>
      <section id="workspace-protocol-workspace" class="level2">
        <h2>Workspace protocol (workspace:)</h2>
        <p>
          By default, pnpm will link packages from the workspace if the available packages
          match the declared ranges. For instance, <code>foo@1.0.0</code> is linked into <code>bar</code> if
          <code>bar</code> has <code>foo: ^1.0.0</code> in its dependencies and <code>foo@1.0.0</code> is in the workspace. However, if <code>bar</code> has
          <code>foo: 2.0.0</code> in dependencies and <code>foo@2.0.0</code> is not in the workspace,
          <code>foo@2.0.0</code> will be installed from the registry. This behavior introduces some
          uncertainty.
        </p>
        <p>
          Luckily, pnpm supports the <code>workspace:</code> protocol. When
          this protocol is used, pnpm will refuse to resolve to anything other than a
          local workspace package. So, if you set <code>foo: workspace:2.0.0</code>, this time
          installation will fail because <code>foo@2.0.0</code> isn't present in the workspace.
        </p>
        <p>
          This protocol is especially useful when the <a href="npmrc.html)">link-workspace-packages</a> option is
          set to <code>false</code>. In that case, pnpm will only link packages from the workspace if
          the <code>workspace:</code> protocol is used.
        </p>
        <section id="referencing-workspace-packages-through-aliases" class="level3">
          <h3>Referencing workspace packages through aliases</h3>
          <p>
            Let's say you have a package in the workspace named <code>foo</code>. Usually, you would
            reference it as <code>foo: workspace:*</code>.
          </p>
          <p>
            If you want to use a different alias, the following syntax will work too:
            <code>bar: workspace:foo@*</code>.
          </p>
          <p>
            Before publish, aliases are converted to regular aliased dependencies. The above
            example will become: <code>bar: npm:foo@1.0.0</code>.
          </p>
        </section>
        <section id="referencing-workspace-packages-through-their-relative-path" class="level3">
          <h3>Referencing workspace packages through their relative path</h3>
          <p>In a workspace with 2 packages:</p>
          <pre class="language-text"><code class="language-text">+ packages
	+ foo
	+ bar</code></pre>
          <p>
            <code>bar</code> may have <code>foo</code> in its dependencies declared as
            <code>foo: workspace:../foo</code>. Before publishing, these specs are converted to
            regular version specs supported by all package managers.
          </p>
        </section>
        <section id="publishing-workspace-packages" class="level3">
          <h3>Publishing workspace packages</h3>
          <p>
            When a workspace package is packed into an archive (whether it's through
            <code>pnpm pack</code> or one of the publish commands like <code>pnpm publish</code>), we dynamically
            replace any <code>workspace:</code> dependency by:
          </p>
          <ul>
            <li>The corresponding version in the target workspace (if you use <code>workspace:*</code>, <code>workspace:~</code>, or <code>workspace:^</code>)</li>
            <li>The associated semver range (for any other range type)</li>
          </ul>
          <p>So for example, if we have <code>foo</code>, <code>bar</code>, <code>qar</code>, <code>zoo</code> in the workspace and they all are at version <code>1.5.0</code>, the following:</p>
          <pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
	dependencies<span class="token operator">:</span> <span class="token punctuation">{</span>
		foo<span class="token operator">:</span> workspace<span class="token operator">:</span>*<span class="token punctuation">,</span>
		bar<span class="token operator">:</span> workspace<span class="token operator">:</span>~<span class="token punctuation">,</span>
		qar<span class="token operator">:</span> workspace<span class="token operator">:</span>^<span class="token punctuation">,</span>
		zoo<span class="token operator">:</span> workspace<span class="token operator">:</span>^<span class="token number">1.5</span>.<span class="token number">0</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
          <p>Will be transformed into:</p>
          <pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
	dependencies<span class="token operator">:</span> <span class="token punctuation">{</span>
		foo<span class="token operator">:</span> <span class="token number">1.5</span>.<span class="token number">0</span><span class="token punctuation">,</span>
		bar<span class="token operator">:</span> ~<span class="token number">1.5</span>.<span class="token number">0</span><span class="token punctuation">,</span>
		qar<span class="token operator">:</span> ^<span class="token number">1.5</span>.<span class="token number">0</span><span class="token punctuation">,</span>
		zoo<span class="token operator">:</span> ^<span class="token number">1.5</span>.<span class="token number">0</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
          <p>
            This feature allows you to depend on your local workspace packages while still
            being able to publish the resulting packages to the remote registry without
            needing intermediary publish steps - your consumers will be able to use your
            published workspaces as any other package, still benefitting from the guarantees
            semver offers.
          </p>
        </section>
      </section>
      <section id="release-workflow" class="level2">
        <h2>Release workflow</h2>
        <p>
          Versioning packages inside a workspace is a complex task and pnpm currently does
          not provide a built-in solution for it. However, there are 2 well tested tools
          that handle versioning and support pnpm:
        </p>
        <ul>
          <li><a href="https://github.com/changesets/changesets">changesets</a>)</li>
          <li><a href="https://rushjs.io">Rush</a>.)</li>
        </ul>
        <p>For how to set up a repository using Rush, read [this page][rush-setup].</p>
        <p>For using Changesets with pnpm, read [this guide][changesets-guide].</p>
        <p>
          <a href="https://rushjs.io/pages/maintainer/setup_new_repo">rush-setup</a>
          [changesets-guide]: using-changesets.html)
        </p>
      </section>
      <section id="troubleshooting" class="level2">
        <h2>Troubleshooting</h2>
        <p>pnpm cannot guarantee that scripts will be run in topological order if there are cycles between workspace dependencies. If pnpm detects cyclic dependencies during installation, it will produce a warning. If pnpm is able to find out which dependencies are causing the cycles, it will display them too.</p>
        <p>If you see the message <code>There are cyclic workspace dependencies</code>, please inspect workspace dependencies declared in <code>dependencies</code>, <code>optionalDependencies</code> and <code>devDependencies</code>.</p>
      </section>
      <section id="usage-examples" class="level2">
        <h2>Usage examples</h2>
        <p>Here are a few of the most popular open source projects that use the workspace feature of pnpm:</p>
        <table>
          <thead>
            <tr>
              <th>Project</th>
              <th>Stars</th>
              <th>Migration date</th>
              <th>Migration commit</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><a href="https://github.com/vercel/next.js">Next.js</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/vercel/next.js">
              </td>
              <td>2022-05-29</td>
              <td><code>f7b81316aea4fc9962e5e54981a6d559004231aa</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/vitejs/vite">Vite</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/vitejs/vite">
              </td>
              <td>2021-09-26</td>
              <td><code>3e1cce01d01493d33e50966d0d0fd39a86d229f9</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/vuejs/vue-next">Vue 3.0</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/vuejs/vue-next">
              </td>
              <td>2021-10-09</td>
              <td><code>61c5fbd3e35152f5f32e95bf04d3ee083414cecb</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/prisma/prisma">Prisma</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/prisma/prisma">
              </td>
              <td>2021-09-21</td>
              <td><code>c4c83e788aa16d61bae7a6d00adc8a58b3789a06</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/slidevjs/slidev">Slidev</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/slidevjs/slidev">
              </td>
              <td>2021-04-12</td>
              <td><code>d6783323eb1ab1fc612577eb63579c8f7bc99c3a</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/element-plus/element-plus">Element Plus</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/element-plus/element-plus">
              </td>
              <td>2021-09-23</td>
              <td><code>f9e192535ff74d1443f1d9e0c5394fad10428629</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/verdaccio/verdaccio">Verdaccio</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/verdaccio/verdaccio">
              </td>
              <td>2021-09-21</td>
              <td><code>9dbf73e955fcb70b0a623c5ab89649b95146c744</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/withastro/astro">Astro</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/withastro/astro">
              </td>
              <td>2022-03-08</td>
              <td><code>240d88aefe66c7d73b9c713c5da42ae789c011ce</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/cyclejs/cyclejs">Cycle.js</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/cyclejs/cyclejs">
              </td>
              <td>2021-09-21</td>
              <td><code>f2187ab6688368edb904b649bd371a658f6a8637</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/vueuse/vueuse">VueUse</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/vueuse/vueuse">
              </td>
              <td>2021-09-25</td>
              <td><code>826351ba1d9c514e34426c85f3d69fb9875c7dd9</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/nextauthjs/next-auth">NextAuth.js</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/nextauthjs/next-auth">
              </td>
              <td>2022-05-03</td>
              <td><code>4f29d39521451e859dbdb83179756b372e3dd7aa</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/sveltejs/kit">SvelteKit</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/sveltejs/kit">
              </td>
              <td>2021-09-26</td>
              <td><code>b164420ab26fa04fd0fbe0ac05431f36a89ef193</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/Saul-Mirone/milkdown">Milkdown</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/Saul-Mirone/milkdown">
              </td>
              <td>2021-09-26</td>
              <td><code>4b2e1dd6125bc2198fd1b851c4f00eda70e9b913</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/vitest-dev/vitest">Vitest</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/vitest-dev/vitest">
              </td>
              <td>2021-12-13</td>
              <td><code>d6ff0ccb819716713f5eab5c046861f4d8e4f988</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/logto-io/logto">Logto</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/logto-io/logto">
              </td>
              <td>2021-07-29</td>
              <td><code>0b002e07850c8e6d09b35d22fab56d3e99d77043</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/nhost/nhost">Nhost</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/nhost/nhost">
              </td>
              <td>2022-02-07</td>
              <td><code>10a1799a1fef2f558f737de3bb6cadda2b50e58f</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/rollup/plugins">Rollup plugins</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/rollup/plugins">
              </td>
              <td>2021-09-21</td>
              <td><code>53fb18c0c2852598200c547a0b1d745d15b5b487</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/bytedance/byt.html">ByteMD</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/bytedance/byt.html">
              </td>
              <td>2021-02-18</td>
              <td><code>36ef25f1ea1cd0b08752df5f8c832302017bb7fb</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/ice-lab/icestark">icestark</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/ice-lab/icestark">
              </td>
              <td>2021-12-16</td>
              <td><code>4862326a8de53d02f617e7b1986774fd7540fccd</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/vuepress/vuepress-next">VuePress 2.0</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/vuepress/vuepress-next">
              </td>
              <td>2022-04-23</td>
              <td><code>b85b1c3b39e80a8de92a7469381061f75ef33623</code></td>
            </tr>
            <tr>
              <td><a href="https://github.com/vercel/turborepo">Turborepo</a></td>
              <td>
                <img src="https://img.shields.io/github/stars/vercel/turborepo">
              </td>
              <td>2022-03-02</td>
              <td><code>fd171519ec02a69c9afafc1bc5d9d1b481fba721</code></td>
            </tr>
          </tbody>
        </table>
        <p><span style="float: footnote;"><a href="./index.html#toc">Go to TOC</a></span></p>
      </section>
    </section>
  </body>
</html>
