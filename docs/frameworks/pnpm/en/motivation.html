<!doctype html><html lang="en"><meta charset="utf-8"><title>Motivation</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="motivation"><h1 id="motivation">Motivation</h1><section class="level2"aria-labelledby="saving-disk-space"><h2 id="saving-disk-space">Saving disk space</h2><figure><img src="/img/pnpm-store.svg"alt="An illustration of the pnpm content-addressable store. On the illustration there are two projects with node_modules. The files in the node_modules directories are hard links to the same files in the content-addressable store."><figcaption aria-hidden="true">An illustration of the pnpm content-addressable store. On the illustration there are two projects with node_modules. The files in the node_modules directories are hard links to the same files in the content-addressable store.</figcaption></figure><p>When using npm, if you have 100 projects using a dependency, you will have 100 copies of that dependency saved on disk. With pnpm, the dependency will be stored in a content-addressable store, so:<ol><li>If you depend on different versions of the dependency, only the files that differ are added to the store. For instance, if it has 100 files, and a new version has a change in only one of those files, <code>pnpm update</code> will only add 1 new file to the store, instead of cloning the entire dependency just for the singular change.<li>All the files are saved in a single place on the disk. When packages are installed, their files are hard-linked from that single place, consuming no additional disk space. This allows you to share dependencies of the same version across projects.</ol><p>As a result, you save a lot of space on your disk proportional to the number of projects and dependencies, and you have a lot faster installations!</section><section class="level2"aria-labelledby="boosting-installation-speed"><h2 id="boosting-installation-speed">Boosting installation speed</h2><p>pnpm perfoms installation in three stages:<ol><li>Dependency resolution. All required dependencies are identified and fetched to the store.<li>Directory structure calculation. The <code>node_modules</code> directory structure is calculated based on the dependencies.<li>Linking dependencies. All remaining dependencies are fetched and hard linked from the store to <code>node_modules</code>.</ol><figure><img src="/img/installation-stages-of-pnpm.svg"alt="An illustration of the pnpm install process. Packages are resolved, fetched, and hard linked as soon as possible."><figcaption aria-hidden="true">An illustration of the pnpm install process. Packages are resolved, fetched, and hard linked as soon as possible.</figcaption></figure><p>This approach is significantly faster than the traditional three-stage installation process of resolving, fetching, and writing all dependencies to <code>node_modules</code>.<figure><img src="/img/installation-stages-of-other-pms.svg"alt="An illustration of how package managers like Yarn Classic or npm install dependencies."><figcaption aria-hidden="true">An illustration of how package managers like Yarn Classic or npm install dependencies.</figcaption></figure></section><section class="level2"aria-labelledby="creating-a-non-flat-node_modules-directory"><h2 id="creating-a-non-flat-node_modules-directory">Creating a non-flat node_modules directory</h2><p>When installing dependencies with npm or Yarn Classic, all packages are hoisted to the root of the modules directory. As a result, source code has access to dependencies that are not added as dependencies to the project.<p>By default, pnpm uses symlinks to add only the direct dependencies of the project into the root of the modules directory.<figure><img src="/img/isolated-node-modules.svg"alt="An illustration of a node_modules directory created by pnpm. Packages in the root node_modules are symlinks to directories inside the node_modules/.pnpm directory"><figcaption aria-hidden="true">An illustration of a node_modules directory created by pnpm. Packages in the root node_modules are symlinks to directories inside the node_modules/.pnpm directory</figcaption></figure><p>If you'd like more details about the unique <code>node_modules</code> structure that pnpm creates and why it works fine with the Node.js ecosystem, read:<ul><li><a href="/blog/2020/05/27/flat-node-modules-is-not-the-only-way">Flat node_modules is not the only way</a><li><a href="symlinked-node-modules-structure.html">Symlinked node_modules structure</a></ul><blockquote><p>If your tooling doesn't work well with symlinks, you may still use pnpm and set the <a href="npmrc#node-linker">node-linker</a> setting to <code>hoisted</code>. This will instruct pnpm to create a node_modules directory that is similar to those created by npm and Yarn Classic.</blockquote><span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>