<!doctype html><html lang="en"><meta charset="utf-8"><title>ðŸš„ Performance</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="-performance"><h1 id="-performance">ðŸš„ Performance</h1><section class="level3"aria-labelledby="code-splitting"><h3 id="code-splitting">Code Splitting</h3><p>Code splitting involves splitting production JavaScript into smaller files to optimize application loading times. This technique enables the application to be downloaded in parts, fetching only the necessary code when required.<p>Ideally, code splitting should be implemented at the routes level, ensuring that only essential code is loaded initially, with additional parts fetched lazily as needed. It's important to avoid excessive code splitting, as this can lead to a performance decline due to the increased number of requests required to fetch all the code chunks. Strategic code splitting, focusing on critical parts of the application, helps balance performance optimization with efficient resource loading.<p><a href="../apps/react-vihttps://github.com/alan2207/bulletproof-react/tree/master/src/app/router.tsx">Code Splitting Example Code</a></section><section class="level3"aria-labelledby="component-and-state-optimizations"><h3 id="component-and-state-optimizations">Component and state optimizations</h3><ul><li><p>Do not put everything in a single state. That might trigger unnecessary re-renders. Instead split the global state into multiple states according to where they are being used.<li><p>Keep the state as close as possible to where it is being used. This will prevent re-rendering components that do not depend on the updated state.<li><p>If you have a piece of state that is initialized by an expensive computation, use the state initializer function instead of executing it directly because the expensive function will be run only once as it is supposed to. e.g:</ul><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// instead of this which would be executed on every re-render:</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">useState</span><span class="token punctuation">(</span><span class="token function">myExpensiveFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// prefer this which is executed only once:</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">myExpensiveFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li><p>If you develop an application that requires a state to track many elements at once, you might consider state management libraries with atomic updates such as <a href="https://jotai.pmnd.rs/">jotai</a>.<li><p>Use React Context wisely. React Context is good for low-velocity data like themes, user data, small local state etc. While dealing with medium-velocity/high-velocity data, you may consider using the <a href="https://github.com/dai-shi/use-context-selector">use-context-selector</a> library that supports selectors (selectors are already built-in in most popular state management libraries like <a href="https://docs.pmnd.rs/zustand/getting-started/introduction">zustand</a> or <a href="https://jotai.org/">jotai</a>). Important to remember, context is often used as the "golden tool" for props drilling, whereas in many scenarios you may satisfy your needs by <a href="https://react.dev/learn/sharing-state-between-components#lifting-state-up-by-example">lifting the state up</a> or <a href="https://react.dev/learn/passing-data-deeply-with-context#before-you-use-context">a proper composition of components</a>. Do not rush with context and global state.<li><p>If your application is expected to have frequent updates that might affect performance, consider switching from runtime styling solutions such as <a href="https://emotion.sh/docs/introduction">emotion</a>, <a href="https://styled-components.com/">styled-components</a> that generate styles during runtime) to zero runtime styling solutions (<a href="https://tailwindcss.com/">tailwind</a>, <a href="https://github.com/seek-oss/vanilla-extract">vanilla-extract</a>, <a href="https://github.com/css-modules/css-modules">CSS modules</a> which generate styles during build time).</ul></section><section class="level3"aria-labelledby="children-as-the-most-basic-optimization"><h3 id="children-as-the-most-basic-optimization">Children as the most basic optimization</h3><ul><li>The <code>children</code> prop is the most basic and easiest way to optimize your components. When applied properly, it eliminates a lot of unnecessary rerenders. The JSX, passed in the form of <code>children</code> prop, represents an isolated VDOM structure that does not need (and cannot) be re-rendered by its parent. Example below:</ul><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Not optimized example</span>
<span class="token keyword">const</span> <span class="token function-variable function"><span class="token maybe-class-name">App</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Counter</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function"><span class="token maybe-class-name">Counter</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        count is <span class="token punctuation">{</span>count<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PureComponent</span> <span class="token operator">/</span><span class="token operator">></span> <span class="token comment">// will rerender whenever "count" updates</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function"><span class="token maybe-class-name">PureComponent</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Pure</span> <span class="token maybe-class-name">Component</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token comment">// Optimized example</span>
<span class="token keyword">const</span> <span class="token function-variable function"><span class="token maybe-class-name">App</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Counter</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">PureComponent</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Counter</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function"><span class="token maybe-class-name">Counter</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        count is <span class="token punctuation">{</span>count<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span> <span class="token comment">// won't rerender whenever "count" updates</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function"><span class="token maybe-class-name">PureComponent</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Pure</span> <span class="token maybe-class-name">Component</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">;</span></code></pre></section><section class="level3"aria-labelledby="image-optimizations"><h3 id="image-optimizations">Image optimizations</h3><p>Consider lazy loading images that are not in the viewport.<p>Use modern image formats such as WEBP for faster image loading.<p>Use <code>srcset</code> to load the most optimal image for the clients screen size.</section><section class="level3"aria-labelledby="web-vitals"><h3 id="web-vitals">Web vitals</h3><p>Since Google started taking web vitals in account when indexing websites, you should keep an eye on web vitals scores from <a href="https://web.dev/measure/">Lighthouse</a> and <a href="https://pagespeed.web.dev/">Pagespeed Insights</a>.</section><section class="level3"aria-labelledby="data-prefetching"><h3 id="data-prefetching">Data prefetching</h3><p>It is possible to prefetch data before the user navigates to a page. This can be done by using the <code>queryClient.prefetchQuery</code> method from the <code>@tanstack/react-query</code> library. This method allows you to prefetch data for a specific query. This can be useful when you know that the user will navigate to a specific page and you want to prefetch the data before the user navigates to the page. This can help to improve the performance of the application by reducing the time it takes to load the data when the user navigates to the page.<p><a href="../apps/react-vihttps://github.com/alan2207/bulletproof-react/tree/master/src/features/discussions/components/discussions-list.tsx">Data Prefetching Example Code</a> <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>