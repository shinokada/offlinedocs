<!doctype html><html lang="en"><meta charset="utf-8"><title>Custom Directives</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="custom-directives"class="level1"><h1>Custom Directives</h1><script setup="">const vFocus={mounted:o=>{o.focus()}}</script><section id="introduction"class="level2"><h2>Introduction</h2><p>In addition to the default set of directives shipped in core (like <code>v-model</code> or <code>v-show</code>), Vue also allows you to register your own custom directives.<p>We have introduced two forms of code reuse in Vue: <a href="/guide/essentials/component-basics.html">components</a> and <a href="./composables">composables</a>. Components are the main building blocks, while composables are focused on reusing stateful logic. Custom directives, on the other hand, are mainly intended for reusing logic that involves low-level DOM access on plain elements.<p>A custom directive is defined as an object containing lifecycle hooks similar to those of a component. The hooks receive the element the directive is bound to. Here is an example of a directive that focuses an input when the element is inserted into the DOM by Vue:<div class="composition-api"><pre class="language-vue"><code class="language-vue">&#x3C;script setup>
// enables v-focus in templates
const vFocus = {
  mounted: (el) => el.focus()
}
&#x3C;/script>

&#x3C;template>
  &#x3C;input v-focus />
&#x3C;/template></code></pre></div><div class="options-api"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> focus <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">mounted</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> el<span class="token punctuation">.</span><span class="token method function property-access">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">directives</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// enables v-focus in template</span>
    focus
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-vue-html"><code class="language-vue-html">&#x3C;input v-focus /></code></pre></div><div class="demo"><input v-focus=""placeholder="This should be focused"></div><p>Assuming you haven't clicked elsewhere on the page, the input above should be auto-focused. This directive is more useful than the <code>autofocus</code> attribute because it works not just on page load - it also works when the element is dynamically inserted by Vue.<div class="composition-api"><p>In <code>&#x3C;script setup></code>, any camelCase variable that starts with the <code>v</code> prefix can be used as a custom directive. In the example above, <code>vFocus</code> can be used in the template as <code>v-focus</code>.<p>If not using <code>&#x3C;script setup></code>, custom directives can be registered using the <code>directives</code> option:<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/*...*/</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">directives</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// enables v-focus in template</span>
    <span class="token literal-property property">focus</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">/* ... */</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><div class="options-api"><p>Similar to components, custom directives must be registered so that they can be used in templates. In the example above, we are using local registration via the <code>directives</code> option.</div><p>It is also common to globally register custom directives at the app level:<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// make v-focus usable in all components</span>
app<span class="token punctuation">.</span><span class="token method function property-access">directive</span><span class="token punctuation">(</span><span class="token string">'focus'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>:::tip Custom directives should only be used when the desired functionality can only be achieved via direct DOM manipulation. Prefer declarative templating using built-in directives such as <code>v-bind</code> when possible because they are more efficient and server-rendering friendly. :::</section><section id="directive-hooks"class="level2"><h2>Directive Hooks</h2><p>A directive definition object can provide several hook functions (all optional):<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> myDirective <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// called before bound element's attributes</span>
  <span class="token comment">// or event listeners are applied</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// see below for details on arguments</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// called right before the element is inserted into the DOM.</span>
  <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// called when the bound element's parent component</span>
  <span class="token comment">// and all its children are mounted.</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// called before the parent component is updated</span>
  <span class="token function">beforeUpdate</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// called after the parent component and</span>
  <span class="token comment">// all of its children have updated</span>
  <span class="token function">updated</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// called before the parent component is unmounted</span>
  <span class="token function">beforeUnmount</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// called when the parent component is unmounted</span>
  <span class="token function">unmounted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><section id="hook-arguments"class="level3"><h3>Hook Arguments</h3><p>Directive hooks are passed these arguments:<ul><li><p><code>el</code>: the element the directive is bound to. This can be used to directly manipulate the DOM.<li><p><code>binding</code>: an object containing the following properties.<ul><li><code>value</code>: The value passed to the directive. For example in <code>v-my-directive="1 + 1"</code>, the value would be <code>2</code>.<li><code>oldValue</code>: The previous value, only available in <code>beforeUpdate</code> and <code>updated</code>. It is available whether or not the value has changed.<li><code>arg</code>: The argument passed to the directive, if any. For example in <code>v-my-directive:foo</code>, the arg would be <code>"foo"</code>.<li><code>modifiers</code>: An object containing modifiers, if any. For example in <code>v-my-directive.foo.bar</code>, the modifiers object would be <code>{ foo: true, bar: true }</code>.<li><code>instance</code>: The instance of the component where the directive is used.<li><code>dir</code>: the directive definition object.</ul><li><p><code>vnode</code>: the underlying VNode representing the bound element.<li><p><code>prevNode</code>: the VNode representing the bound element from the previous render. Only available in the <code>beforeUpdate</code> and <code>updated</code> hooks.</ul><p>As an example, consider the following directive usage:<pre class="language-vue-html"><code class="language-vue-html">&#x3C;div v-example:foo.bar="baz"></code></pre><p>The <code>binding</code> argument would be an object in the shape of:<pre class="language-js"><code class="language-js"><span class="token punctuation">{</span>
  <span class="token literal-property property">arg</span><span class="token operator">:</span> <span class="token string">'foo'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">modifiers</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">bar</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token comment">/* value of `baz` */</span><span class="token punctuation">,</span>
  <span class="token literal-property property">oldValue</span><span class="token operator">:</span> <span class="token comment">/* value of `baz` from previous update */</span>
<span class="token punctuation">}</span></code></pre><p>Similar to built-in directives, custom directive arguments can be dynamic. For example:<pre class="language-vue-html"><code class="language-vue-html">&#x3C;div v-example:[arg]="value">&#x3C;/div></code></pre><p>Here the directive argument will be reactively updated based on <code>arg</code> property in our component state.<p>:::tip Note Apart from <code>el</code>, you should treat these arguments as read-only and never modify them. If you need to share information across hooks, it is recommended to do so through element's <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/dataset">dataset</a>. :::</section></section><section id="function-shorthand"class="level2"><h2>Function Shorthand</h2><p>It's common for a custom directive to have the same behavior for <code>mounted</code> and <code>updated</code>, with no need for the other hooks. In such cases we can define the directive as a function:<pre class="language-vue-html"><code class="language-vue-html">&#x3C;div v-color="color">&#x3C;/div></code></pre><pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token method function property-access">directive</span><span class="token punctuation">(</span><span class="token string">'color'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// this will be called for both `mounted` and `updated`</span>
  el<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">color</span> <span class="token operator">=</span> binding<span class="token punctuation">.</span><span class="token property-access">value</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="object-literals"class="level2"><h2>Object Literals</h2><p>If your directive needs multiple values, you can also pass in a JavaScript object literal. Remember, directives can take any valid JavaScript expression.<pre class="language-vue-html"><code class="language-vue-html">&#x3C;div v-demo="{ color: 'white', text: 'hello!' }">&#x3C;/div></code></pre><pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token method function property-access">directive</span><span class="token punctuation">(</span><span class="token string">'demo'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>binding<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">.</span><span class="token property-access">color</span><span class="token punctuation">)</span> <span class="token comment">// => "white"</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>binding<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">)</span> <span class="token comment">// => "hello!"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></section><section id="usage-on-components"class="level2"><h2>Usage on Components</h2><p>When used on components, custom directives will always apply to a component's root node, similar to <a href="/guide/components/attrs.html">Fallthrough Attributes</a>.<pre class="language-vue-html"><code class="language-vue-html">&#x3C;MyComponent v-demo="test" /></code></pre><pre class="language-vue-html"><code class="language-vue-html">&#x3C;!-- template of MyComponent -->

&#x3C;div> &#x3C;!-- v-demo directive will be applied here -->
  &#x3C;span>My component content&#x3C;/span>
&#x3C;/div></code></pre><p>Note that components can potentially have more than one root node. When applied to a multi-root component, a directive will be ignored and a warning will be thrown. Unlike attributes, directives can't be passed to a different element with <code>v-bind="$attrs"</code>. In general, it is <strong>not</strong> recommended to use custom directives on components. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>