<!doctypehtml><html lang="en"><meta charset="utf-8"><title>KeepAlive</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css"><body><script setup="">import SwitchComponent from"./keep-alive-demos/SwitchComponent.vue"</script><section id="keepalive"class="level1"><h1>KeepAlive</h1><p><code>&#x3C;KeepAlive></code> is a built-in component that allows us to conditionally cache component instances when dynamically switching between multiple components.<section id="basic-usage"class="level2"><h2>Basic Usage</h2><p>In the Component Basics chapter, we introduced the syntax for <a href="/guide/essentials/component-basics.html#dynamic-components">Dynamic Components</a>, using the <code>&#x3C;component></code> special element:<pre class="language-vue-html"><code class="language-vue-html">&#x3C;component :is="activeComponent" /></code></pre><p>By default, an active component instance will be unmounted when switching away from it. This will cause any changed state it holds to be lost. When this component is displayed again, a new instance will be created with only the initial state.<p>In the example below, we have two stateful components - A contains a counter, while B contains a message synced with an input via <code>v-model</code>. Try updating the state of one of them, switch away, and then switch back to it:</p><switchcomponent><p>You'll notice that when switched back, the previous changed state would have been reset.<p>Creating fresh component instance on switch is normally useful behavior, but in this case, we'd really like the two component instances to be preserved even when they are inactive. To solve this problem, we can wrap our dynamic component with the <code>&#x3C;KeepAlive></code> built-in component:<pre class="language-vue-html"><code class="language-vue-html">&#x3C;!-- Inactive components will be cached! -->
&#x3C;KeepAlive>
  &#x3C;component :is="activeComponent" />
&#x3C;/KeepAlive></code></pre><p>Now, the state will be persisted across component switches:</p><switchcomponent use-keepalive=""><div class="composition-api"><p><a href="https://sfc.vuejs.org/#eyJBcHAudnVlIjoiPHNjcmlwdCBzZXR1cD5cbmltcG9ydCB7IHNoYWxsb3dSZWYgfSBmcm9tICd2dWUnXG5pbXBvcnQgQ29tcEEgZnJvbSAnLi9Db21wQS52dWUnXG5pbXBvcnQgQ29tcEIgZnJvbSAnLi9Db21wQi52dWUnXG5cbmNvbnN0IGN1cnJlbnQgPSBzaGFsbG93UmVmKENvbXBBKVxuPC9zY3JpcHQ+XG5cbjx0ZW1wbGF0ZT5cbiAgPGRpdiBjbGFzcz1cImRlbW9cIj5cbiAgICA8bGFiZWw+PGlucHV0IHR5cGU9XCJyYWRpb1wiIHYtbW9kZWw9XCJjdXJyZW50XCIgOnZhbHVlPVwiQ29tcEFcIiAvPiBBPC9sYWJlbD5cbiAgICA8bGFiZWw+PGlucHV0IHR5cGU9XCJyYWRpb1wiIHYtbW9kZWw9XCJjdXJyZW50XCIgOnZhbHVlPVwiQ29tcEJcIiAvPiBCPC9sYWJlbD5cbiAgICA8S2VlcEFsaXZlPlxuICAgICAgPGNvbXBvbmVudCA6aXM9XCJjdXJyZW50XCI+PC9jb21wb25lbnQ+XG4gICAgPC9LZWVwQWxpdmU+XG4gIDwvZGl2PlxuPC90ZW1wbGF0ZT5cbiIsImltcG9ydC1tYXAuanNvbiI6IntcbiAgXCJpbXBvcnRzXCI6IHtcbiAgICBcInZ1ZVwiOiBcImh0dHBzOi8vc2ZjLnZ1ZWpzLm9yZy92dWUucnVudGltZS5lc20tYnJvd3Nlci5qc1wiXG4gIH1cbn0iLCJDb21wQS52dWUiOiI8c2NyaXB0IHNldHVwPlxuaW1wb3J0IHsgcmVmIH0gZnJvbSAndnVlJ1xuXG5jb25zdCBjb3VudCA9IHJlZigwKVxuPC9zY3JpcHQ+XG5cbjx0ZW1wbGF0ZT5cbiAgPHA+Q3VycmVudCBjb21wb25lbnQ6IEE8L3A+XG4gIDxzcGFuPmNvdW50OiB7eyBjb3VudCB9fTwvc3Bhbj5cbiAgPGJ1dHRvbiBAY2xpY2s9XCJjb3VudCsrXCI+KzwvYnV0dG9uPlxuPC90ZW1wbGF0ZT5cbiIsIkNvbXBCLnZ1ZSI6IjxzY3JpcHQgc2V0dXA+XG5pbXBvcnQgeyByZWYgfSBmcm9tICd2dWUnXG5jb25zdCBtc2cgPSByZWYoJycpXG48L3NjcmlwdD5cblxuPHRlbXBsYXRlPlxuICA8cD5DdXJyZW50IGNvbXBvbmVudDogQjwvcD5cbiAgPHNwYW4+TWVzc2FnZSBpczoge3sgbXNnIH19PC9zcGFuPlxuICA8aW5wdXQgdi1tb2RlbD1cIm1zZ1wiPlxuPC90ZW1wbGF0ZT5cbiJ9">Try it in the Playground</a></div><div class="options-api"><p><a href="https://sfc.vuejs.org/#eyJBcHAudnVlIjoiPHNjcmlwdD5cbmltcG9ydCBDb21wQSBmcm9tICcuL0NvbXBBLnZ1ZSdcbmltcG9ydCBDb21wQiBmcm9tICcuL0NvbXBCLnZ1ZSdcbiAgXG5leHBvcnQgZGVmYXVsdCB7XG4gIGNvbXBvbmVudHM6IHsgQ29tcEEsIENvbXBCIH0sXG4gIGRhdGEoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGN1cnJlbnQ6ICdDb21wQSdcbiAgICB9XG4gIH1cbn1cbjwvc2NyaXB0PlxuXG48dGVtcGxhdGU+XG4gIDxkaXYgY2xhc3M9XCJkZW1vXCI+XG4gICAgPGxhYmVsPjxpbnB1dCB0eXBlPVwicmFkaW9cIiB2LW1vZGVsPVwiY3VycmVudFwiIHZhbHVlPVwiQ29tcEFcIiAvPiBBPC9sYWJlbD5cbiAgICA8bGFiZWw+PGlucHV0IHR5cGU9XCJyYWRpb1wiIHYtbW9kZWw9XCJjdXJyZW50XCIgdmFsdWU9XCJDb21wQlwiIC8+IEI8L2xhYmVsPlxuICAgIDxLZWVwQWxpdmU+XG4gICAgICA8Y29tcG9uZW50IDppcz1cImN1cnJlbnRcIj48L2NvbXBvbmVudD5cbiAgICA8L0tlZXBBbGl2ZT5cbiAgPC9kaXY+XG48L3RlbXBsYXRlPlxuIiwiaW1wb3J0LW1hcC5qc29uIjoie1xuICBcImltcG9ydHNcIjoge1xuICAgIFwidnVlXCI6IFwiaHR0cHM6Ly9zZmMudnVlanMub3JnL3Z1ZS5ydW50aW1lLmVzbS1icm93c2VyLmpzXCJcbiAgfVxufSIsIkNvbXBBLnZ1ZSI6IjxzY3JpcHQ+XG5leHBvcnQgZGVmYXVsdCB7XG4gIGRhdGEoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNvdW50OiAwXG4gICAgfVxuICB9XG59XG48L3NjcmlwdD5cblxuPHRlbXBsYXRlPlxuICA8cD5DdXJyZW50IGNvbXBvbmVudDogQTwvcD5cbiAgPHNwYW4+Y291bnQ6IHt7IGNvdW50IH19PC9zcGFuPlxuICA8YnV0dG9uIEBjbGljaz1cImNvdW50KytcIj4rPC9idXR0b24+XG48L3RlbXBsYXRlPlxuIiwiQ29tcEIudnVlIjoiPHNjcmlwdD5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgZGF0YSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbXNnOiAnJ1xuICAgIH1cbiAgfVxufVxuPC9zY3JpcHQ+XG5cblxuPHRlbXBsYXRlPlxuICA8cD5DdXJyZW50IGNvbXBvbmVudDogQjwvcD5cbiAgPHNwYW4+TWVzc2FnZSBpczoge3sgbXNnIH19PC9zcGFuPlxuICA8aW5wdXQgdi1tb2RlbD1cIm1zZ1wiPlxuPC90ZW1wbGF0ZT5cbiJ9">Try it in the Playground</a></div><p>:::tip When used in <a href="/guide/essentials/component-basics.html#dom-template-parsing-caveats">DOM templates</a>, it should be referenced as <code>&#x3C;keep-alive></code>. :::</p></switchcomponent></switchcomponent></section><section id="include-exclude"class="level2"><h2>Include / Exclude</h2><p>By default, <code>&#x3C;KeepAlive></code> will cache any component instance inside. We can customize this behavior via the <code>include</code> and <code>exclude</code> props. Both props can be a comma-delimited string, a <code>RegExp</code>, or an array containing either types:<pre class="language-vue-html"><code class="language-vue-html">&#x3C;!-- comma-delimited string -->
&#x3C;KeepAlive include="a,b">
  &#x3C;component :is="view" />
&#x3C;/KeepAlive>

&#x3C;!-- regex (use `v-bind`) -->
&#x3C;KeepAlive :include="/a|b/">
  &#x3C;component :is="view" />
&#x3C;/KeepAlive>

&#x3C;!-- Array (use `v-bind`) -->
&#x3C;KeepAlive :include="['a', 'b']">
  &#x3C;component :is="view" />
&#x3C;/KeepAlive></code></pre><p>The match is checked against the component's <a href="/api/options-misc.html#name"><code>name</code></a> option, so components that need to be conditionally cached by <code>KeepAlive</code> must explicitly declare a <code>name</code> option.<p>:::tip Since version 3.2.34, a single-file component using <code>&#x3C;script setup></code> will automatically infer its <code>name</code> option based on the filename, removing the need to manually declare the name. :::</section><section id="max-cached-instances"class="level2"><h2>Max Cached Instances</h2><p>We can limit the maximum number of component instances that can be cached via the <code>max</code> prop. When <code>max</code> is specified, <code>&#x3C;KeepAlive></code> behaves like an <a href="https://en.wikipedia.org/wiki/Cache_replacement_policies#Least_recently_used_(LRU)">LRU cache</a>: if the number of cached instances is about to exceed the specified max count, the least recently accessed cached instance will be destroyed to make room for the new one.<pre class="language-vue-html"><code class="language-vue-html">&#x3C;KeepAlive :max="10">
  &#x3C;component :is="activeComponent" />
&#x3C;/KeepAlive></code></pre></section><section id="lifecycle-of-cached-instance"class="level2"><h2>Lifecycle of Cached Instance</h2><p>When a component instance is removed from the DOM but is part of a component tree cached by <code>&#x3C;KeepAlive></code>, it goes into a <strong>deactivated</strong> state instead of being unmounted. When a component instance is inserted into the DOM as part of a cached tree, it is <strong>activated</strong>.<div class="composition-api"><p>A kept-alive component can register lifecycle hooks for these two states using <a href="/api/composition-api-lifecycle.html#onactivated"><code>onActivated()</code></a> and <a href="/api/composition-api-lifecycle.html#ondeactivated"><code>onDeactivated()</code></a>:<pre class="language-vue"><code class="language-vue">&#x3C;script setup>
import { onActivated, onDeactivated } from 'vue'

onActivated(() => {
  // called on initial mount
  // and every time it is re-inserted from the cache
})

onDeactivated(() => {
  // called when removed from the DOM into the cache
  // and also when unmounted
})
&#x3C;/script></code></pre></div><div class="options-api"><p>A kept-alive component can register lifecycle hooks for these two states using <a href="/api/options-lifecycle.html#activated"><code>activated</code></a> and <a href="/api/options-lifecycle.html#deactivated"><code>deactivated</code></a> hooks:<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token function">activated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// called on initial mount</span>
    <span class="token comment">// and every time it is re-inserted from the cache</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">deactivated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// called when removed from the DOM into the cache</span>
    <span class="token comment">// and also when unmounted</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p>Note that:<ul><li><p><span class="composition-api"><code>onActivated</code></span><span class="options-api"><code>activated</code></span> is also called on mount, and <span class="composition-api"><code>onDeactivated</code></span><span class="options-api"><code>deactivated</code></span> on unmount.<li><p>Both hooks work for not only the root component cached by <code>&#x3C;KeepAlive></code>, but also descendant components in the cached tree.</ul><hr><p><strong>Related</strong><ul><li><a href="/api/built-in-components.html#keepalive"><code>&#x3C;KeepAlive></code> API reference</a> <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></ul></section></section>